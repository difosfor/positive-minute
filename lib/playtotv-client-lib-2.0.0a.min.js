"use strict";!function(){function t(){var t,n=0,e=o.length;try{for(;n<e;n++)t=o[n],t.cb.apply(t.on,t.args)}finally{n<e&&++n<e&&u(),o.splice(0,n)}}function n(t,n,e){o.push({cb:t,on:n,args:e||[]}),u()}var e=new Function("return this")(),i=e.window||{},r=i.MutationObserver||i.WebKitMutationObserver,o=[],u=r?function(){var n=document.createElement("div");return new r(t).observe(n,{attributes:!0}),function(){n.setAttribute("x","x")}}():e.setImmediate?function(){var n=!1;return function(){n||(n=e.setImmediate(function(){n=!1,t()}))}}():i.addEventListener?function(){function n(n){n.source===i&&n.data===r&&(n.stopPropagation(),e=!1,t())}var e=!1,r="nextTick";return i.addEventListener("message",n,!0),function(){e||(i.postMessage(r,"*"),e=!0)}}():function(){var n=!1;return function(){n||(n=setTimeout(function(){n=!1,t()},0))}}();e.nextTick=n}();
"use strict";!function(){Object.assign(Promise.prototype,{catchIf:function(t,e){return this.catch(function(n){if(t(n))return e(n);throw n})},catchClass:function(t,e){return this.catch(function(n){if(n instanceof t)return e(n);throw n})},finally:function(t){var e=this.constructor;return this.then(function(n){return e.resolve(t()).then(function(){return n})},function(n){return e.resolve(t()).then(function(){throw n})})}}),Object.assign(Promise,{defer:function(){var t={};return t.promise=new this(function(e,n){t.resolve=e,t.reject=n}),t},delay:function(t){return new this(function(e){setTimeout(e,t)})},throttle:function(t,e){function n(){!i||u||o||(u=f.resolve(t.apply(r,i)),r=null,i=null,u.then(s.resolve,s.reject).finally(function(){u=null,n()}),s=f.defer(),o=setTimeout(function(){o=null,n()},e))}var r,i,o,u,f=this,s=f.defer();return function(){return r=this,i||u||o?i=arguments:(i=arguments,nextTick(n)),s.promise}},limit:function(t,e,n){function r(){var r=n.apply(this,arguments),u=o[r]||(o[r]={last:0}),f=Date.now();return!u.busy&&f>u.last+e&&(u.busy=!0,u.last=f,u.promise=i.resolve(t.apply(this,arguments)).finally(function(){u.busy=!1})),u.promise}n=n||t.getShard||function(){return JSON.stringify(Array.from(arguments))};var i=this,o={};return r.getShard=n,r},debounce:function(t,e,n){function r(){var r=this,u=arguments,f=n.apply(r,u),s=o[f]||(o[f]={});return s.deferred||(s.deferred=i.defer()),s.timeout&&clearTimeout(s.timeout),s.timeout=setTimeout(function(){s.timeout=0,i.resolve(t.apply(r,u)).then(s.deferred.resolve,s.deferred.reject).finally(function(){s.deferred=0})},e),s.deferred.promise}n=n||t.getShard||function(){return JSON.stringify(Array.from(arguments))};var i=this,o={};return r.getShard=n,r}})}();
"use strict";!function(){function r(r,t){for(var e in t)t.hasOwnProperty(e)&&(r[e]=t[e]);return r}function t(t,n,o,i){return r(n,t),r(n,o),i=r(e(t.prototype),i),n.prototype=i,i.constructor=n,n}var e=Object.create||function(r){function t(){}return t.prototype=r,new t},n=t(Error,function(r){this.message=r||"Cancelled",Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack},null,{name:"CancellationError"}),o=t(n,function(r){n.call(this,r||"Timed out")},null,{name:"TimeoutError"}),i=t(Promise,function(r){if(!(this instanceof i))throw new TypeError('Failed to construct "Cancellable": Please use the "new" operator.');if("function"!=typeof r)throw new TypeError("Cancellable constructor takes a function argument");var t,e;this._promise=new Promise(function(r,n){t=r,e=n}),this._parentPromises=[],this._reject=e;try{r.call(this,t,e)}catch(r){e(r)}},{resolve:Promise.resolve,reject:Promise.reject,defer:Promise.defer,all:function(r){var t,e,n=Promise.all.call(this,r),o=n._parentPromises,c=r.length;for(t=0;t<c;t++)e=r[t],e instanceof i&&o.push(e);return n},race:function(r){var t,e,n=Promise.race.call(this,r),o=n._parentPromises,c=r.length;for(t=0;t<c;t++)e=r[t],e instanceof i&&o.push(e);return n}},{then:function(r,t){var e="function"!=typeof r?r:function(t){var e=r(t);if(e===c)throw new TypeError("You can not resolve a promise with itself");return e instanceof i&&s.push(e),e},n="function"!=typeof t?t:function(r){var e=t(r);if(e===c)throw new TypeError("You can not reject a promise with itself");return e instanceof i&&s.push(e),e},o=this._promise,c=new i(function(r){r(o.then(e,n))}),s=c._parentPromises;return s.push(this),c},cancel:function(r){r=r||new n;var t=this._parentPromises,e=t.length;if(0===e)this._reject(r);else for(var o=0;o<e;o++)t[o].cancel(r)},setTimeout:function(r){function t(t,e){return r.apply(this,arguments)}return t.toString=function(){return r.toString()},t}(function(r,t){return t=t||new o("Timed out after "+r+"ms"),setTimeout(function(){this.cancel(t)}.bind(this),r)}),toPromise:function(){return this._promise}});r(Promise,{Cancellable:i,CancellationError:n,TimeoutError:o})}();
"use strict";!function(){window.$=window.$||function(n){var o=arguments.length<=1||void 0===arguments[1]?document:arguments[1];return o.querySelector(n)},window.$$=window.$$||function(n){var o=arguments.length<=1||void 0===arguments[1]?document:arguments[1];return Array.from(o.querySelectorAll(n))}}();
"use strict";!function(){var n=new Function("return this")(),r=n.playtotv={},t=[].forEach,e=1;Object.assign(r,{getUID:function(n){return e+=1,n?n+e:e},each:function(n,r,e){if(n)if(n.forEach)n.forEach(r,e);else if(n.length===+n.length)t.call(n,r,e);else{var o;for(o in n)n.hasOwnProperty(o)&&r.call(e,n[o],o,n)}},pluck:function(n,r){return n.map(function(n){return n[r]})},union:function n(){var n=[];return Array.from(arguments).forEach(function(r){r.forEach(function(r){n.indexOf(r)<0&&n.push(r)})}),n},pick:function(n,r){var t={};return r.forEach(function(r){r in n&&(t[r]=n[r])}),t},omit:function(n,r){var t={};for(var e in n)r.indexOf(e)===-1&&(t[e]=n[e]);return t},randomNr:function(n){var r=arguments.length<=1||void 0===arguments[1]?0:arguments[1],t=n-r;return r+Math.floor(Math.random()*t)},randomItem:function(n){return n[this.randomNr(n.length)]},shuffle:function(n){for(var r,t,e=n.length,o=n.slice(0);e>0;)t=Math.floor(Math.random()*e--),r=o[e],o[e]=o[t],o[t]=r;return o},throttle:function(n,r){function t(){o&&!i&&(n.apply(e,o),e=null,o=null,i=setTimeout(function(){i=null,t()},r))}var e,o,i;return function(){e=this,o||i?o=arguments:(o=arguments,nextTick(t))}},debounce:function(n,r){var t;return function(){var e=this,o=arguments;clearTimeout(t),t=setTimeout(function(){t=null,n.apply(e,o),e=null,o=null},r)}},unstack:function(n){function r(){n.apply(t,e),t=null,e=null}var t,e;return function(){t=this,e?e=arguments:(e=arguments,nextTick(r))}},once:function(n){var r,t=!1;return function(){return t?r:(t=!0,r=n.apply(this,arguments))}},defer:function(n,r){return function(){nextTick(n,r||this,arguments)}},REQUIRED:"__required__",bindMethods:function(n,r){r.forEach(function(r){n[r]=n[r].bind(n)})},params:function(n,t){return n=n||{},r.each(t,function(t,e){var o=n.hasOwnProperty(e);if(!o){if(t===r.REQUIRED)throw new Error("Missing required parameter: "+e);n[e]=t}}),r.each(n,function(n,r){if(!t.hasOwnProperty(r))throw new Error("Invalid parameter: "+r+" = "+n)}),n},spliceParams:function(n,t){n=n||{};var e=Object.keys(t),o=r.pick(n,e);return e.forEach(function(r){delete n[r]}),r.params(o,t)},loadScript:function(n,r){var t=Promise.defer(),e=document.createElement("script");e.type="text/javascript",e.async=r!==!1,e.src=n;var o=!1;return e.onload=e.onreadystatechange=function(){var n=this.readyState;o||void 0!==n&&"complete"!==n&&"loaded"!==n||(o=!0,t.resolve(e))},e.onerror=function(){t.reject(new Error("Error loading script: "+n))},document.head.appendChild(e),t.promise},dispose:function(n){Object.keys(n).forEach(function(r){delete n[r]}),n.dispose=function(){},n.disposed=!0}})}();
"use strict";!function(){if("undefined"!=typeof window){var t=playtotv,e=window.document,n=e.documentElement,r="data-em-uid",i={},o=n.matches||n.webkitMatchesSelector||n.mozMatchesSelector||n.msMatchesSelector||n.oMatchesSelector,a=window.Node;a&&a.prototype&&!a.prototype.contains&&(a.prototype.contains=function(t){return!!(16&this.compareDocumentPosition(t))}),function(t,e){if(e.classList.toggle("test",!1),e.classList.contains("test")){var n=t.prototype.toggle;t.prototype.toggle=function(t,e){return 1 in arguments&&this.contains(t)===e?e:n.call(this,t)}}}(window.DOMTokenList,e.createElement("_")),t.dom={matches:function(t,n){return!(!n||n===e)&&o.call(n,t)},last:function(t,e){var n=$$(t,e),r=Math.max(0,n.length-1);return n[r]},traverse:function(t,e,n){for(;e;){if(this.matches(t,e))return e;e=e[n]}return null},next:function(t,e){return this.traverse(t,e.nextSibling,"nextSibling")},previous:function(t,e){return this.traverse(t,e.previousSibling,"previousSibling")},closest:n.closest?function(t,e){return e.closest(t)}:function(t,e){return this.traverse(t,e,"parentNode")},any:function(t,e){var n=$$(t,e);return e&&this.matches(t,e)&&n.splice(0,0,e),n},filter:function(t,e){var n,r,i=[],o=e.length;for(n=0;n<o;n++)r=e[n],this.matches(t,r)&&i.push(r);return i},isNode:function(t){return t&&t.nodeType&&1===t.nodeType},isChild:function(t,e){return!!this.isNode(e)&&e.contains(t)},create:function(n,r,i){var o=e.createElement(n);return r&&t.each(r,function(t,e){o.setAttribute(e,t)}),i&&(void 0!==i.html&&(this.innerHTML=i.html),["appendTo","insertBefore","insertAfter","prependTo","replace"].forEach(function(e){var n=i[e];void 0!==n&&t.dom[e](o,n)}),void 0!==i.text&&o.appendChild(e.createTextNode(i.text))),o},remove:function(t){return t.parentNode.removeChild(t)},appendTo:function(t,e){return e.appendChild(t)},insertBefore:function(t,e){return e.parentNode.insertBefore(t,e)},insertAfter:function(t,e){return e.nextSibling?this.insertBefore(t,e.nextSibling):this.appendTo(t,e)},prependTo:function(t,e){return e.firstChild?this.insertBefore(t,e.firstChild):this.appendTo(t,e)},replace:function(t,e){return e.parentNode.replaceChild(t,e)},parseHTML:function(t){var n=e.createElement("div");n.innerHTML=t;var r,i=e.createDocumentFragment(),o=n.childNodes.length;for(r=0;r<o;r++)i.appendChild(n.firstChild);return i},getData:function(t,e){var n=t[r],o=n?i[n]:null;return o?o[e]:null},setData:function(e,n,o){var a=e[r];a||(a=t.getUID(),e[r]=a);var s=i[a];return s||(i[a]=s={}),s[n]=o,o},removeData:function(t,e){var n=t[r],o=i[n];o&&delete o[e]},getClosestAttr:function(t,e){return t=this.closest("["+e+"]",t),t?t.getAttribute(e):void 0},getDataSet:function(t){var e=t.dataset;if(!e)return Array.from(t.attributes).reduce(function(t,e){var n=e.name;return 0!==n.indexOf("data-")?t:(n=n.substr(5).replace(/-([a-z])/g,function(t,e){return e.toUpperCase()}),t[n]=e.value,t)},{});if(!e.hasOwnProperty){var n,r={};for(n in e)r[n]=e[n];e=r}return e}}}}();
"use strict";!function(){if("undefined"!=typeof window){var e=window.document,t=window.Event,n=window.MouseEvent,r=window.CustomEvent,o=function(){try{var e=new r("test");return e.preventDefault(),!0}catch(e){return!1}}();if(!o){var i=t.prototype;t=function(t,n){n=playtotv.params(n,{bubbles:!1,cancelable:!1});var r=e.createEvent("HTMLEvents");return r.initEvent(t,n.bubbles,n.cancelable),r},t.prototype=i,r=function(t,n){n=playtotv.params(n,{bubbles:!1,cancelable:!1,detail:null});var r=e.createEvent("CustomEvent");return r.initCustomEvent(t,n.bubbles,n.cancelable,n.detail),r},r.prototype=i,n=function(t,n){n=playtotv.params(n,{bubbles:!1,cancelable:!1,screenX:0,screenY:0,clientX:0,clientY:0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,buttons:0,relatedTarget:null});var r=e.createEvent("MouseEvent");return r.initMouseEvent(t,n.bubbles,n.cancelable,window,1,n.screenX,n.screenY,n.clientX,n.clientY,n.ctrlKey,n.altKey,n.shiftKey,n.metaKey,n.button,n.relatedTarget),r},n.prototype=i}var a=function(){function e(t,n,r){babelHelpers.classCallCheck(this,e),this.node=t,this.type=n,this.listener=r}return e.prototype.dispose=function(){delete this.node,delete this.type,delete this.listener},e}();playtotv.event={addListener:function(e,t,n){if(!e)throw new ReferenceError('Node is undefined at event.addListener for "'+t+'"');return e.addEventListener(t,n,!1),new a(e,t,n)},removeListener:function(e,t,n){var r=e;if(e instanceof a&&(n=e.listener,t=e.type,r=e.node,e.dispose()),!r)throw new ReferenceError('Node is undefined at event.removeListener for "'+t+'"');r.removeEventListener(t,n,!1)},dispatchEvent:function(e,t,n,o,i){return e.dispatchEvent(new r(t,{bubbles:n,cancelable:o,detail:i}))},triggerNative:function(e,r,o){o=Object.assign({bubbles:!0,cancelable:!0},o);var i=/mouse|click/.test(r)?new n(r,o):new t(r,o);return e.dispatchEvent(i)},preventDefault:function(e){return e.preventDefault(),!1},stopPropagation:function(e){e.stopPropagation()},addWindowOnError:function(e){var t=window.onerror;window.onerror=function(n,r,o,i,a){var s;return t&&(s=t.apply(this,arguments)),a||(a=new Error((n.match(/Error: (.*)/)||[])[1]||n),a.name=(n.match(/\w+Error/)||[])[0]||"Error",a.stack=r+":"+o+(void 0===i?"":":"+i)),e(a)||s}}},Object.assign(playtotv.event,{CustomEvent:r,Event:t,EventListener:a,MouseEvent:n})}}();
"use strict";!function(){function t(t){var e="";playtotv.each(r,function(n,r){e||0!==t.indexOf(r)||(e=n,t=t.replace(r,""))});var n=t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().replace(/\./g,"/")+".js";return e+n}function e(t,e){var r,o,i,a=n,u=t.split("."),c=u.length,l=c-1;for(r=0;r<c;r++)o=u[r],i=a[o],r<l?a=i||(a[o]={}):a[o]=i?Object.assign(e,i):e}var n=new Function("return this")(),r=playtotv.pkgURL={},o={},i=playtotv.definePromises={},a=playtotv.modules={};playtotv.getModule=function(e){var n=t(e)+"?nocache="+Date.now();return i[e]||o[e]||(o[e]=playtotv.loadScript(n).then(function(){if(!i[e])throw new Error(e+" was not defined by "+n);return i[e]}))},playtotv.define=function(t,n,r){if(3!==arguments.length)throw new Error("Three arguments required");return i[t]||(i[t]=Promise.all(n.map(playtotv.getModule)).then(function(o){var i={id:t,dependencies:n},u=r instanceof Function?r.apply(i,o):r;return a[t]=u,e(t,u),u}))},playtotv.require=function(t){return a[t]},playtotv.getModuleId=function(t){return Object.keys(a).find(function(e){return a[e]===t})},playtotv.importModules=function(t){var e,n,r,o=/[^.]+$/i,i={},u=t.length;for(e=0;e<u;e++)n=t[e],r=o.exec(n)[0],i[r]=a[n];return i}}();
"use strict";!function(){function e(e){return window.decodeURIComponent(e.replace(/\+/g," "))}var t=playtotv;t.util={EMAIL_REGEXP:new RegExp("^[A-Za-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[A-Za-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[A-Za-z0-9](?:[A-Za-z0-9-]*[A-Za-z0-9])?\\.)+[A-Za-z0-9](?:[A-Za-z0-9-]*[A-Za-z0-9])$"),URL_REGEXP:/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/gi,ORIGIN_REGEXP:/(\w+:)?\/{2,}[^\/]+/,escapeHtml:function(e){return t.dom.create("div",null,{text:e}).innerHTML},escapeRegEx:function(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},globToRegEx:function(e){return new RegExp("^"+this.escapeRegEx(e).replace(/\\\*/g,"(.*)")+"$")},glob:function(e,t){return this.globToRegEx(e).test(t)},addURLParam:function(e,t,n){var r=e.indexOf("?")!==-1?"&":"?";return e.replace(/((#.*)?$)/,r+encodeURIComponent(t)+"="+encodeURIComponent(n)+"$1")},addURLParams:function(e,n){return t.each(n,function(t,n){e=this.addURLParam(e,n,t)},this),e},getURLParams:function(t){t=t||window.location.href;for(var n,r=t.replace(/[^\?]*\??([^#]*)(#.*)?/,"$1"),i={},a=/([^&=]+)=?([^&]*)/g;n=a.exec(r);)i[e(n[1])]=e(n[2]);return i},getOrigin:function(e,t){var n=window.location;e=e||n.href,t=t||n.href;var r=e.match(this.ORIGIN_REGEXP),i=r?r[0]:t.match(this.ORIGIN_REGEXP)[0];return 0===i.indexOf("//")&&(i=n.protocol+i),0===i.indexOf("file://")&&(i="file://"),i},popup:function(e,t,n){t=t||"_blank",n=n||{};var r=n.width;if(r){var i=window.screen.width;n.width=r=Math.min(r,i),n.left=n.left||Math.round(i/2-r/2)}var a=n.height;if(a){var o=window.screen.height;n.height=a=Math.min(a,o),n.top=n.top||Math.round(o/2-a/2)}var s=Object.keys(n).map(function(e){return e+"="+n[e]}).join(",");return window.open(e,t,s)},pad:function(e,t,n){for(e=String(e),t=parseInt(t,10)||2,n=n||"0";e.length<t;)e=n+e;return e},timeStr:function(e,t){return e=e||new Date,this.pad(e.getHours())+":"+this.pad(e.getMinutes())+":"+this.pad(e.getSeconds())+(t?"."+this.pad(e.getMilliseconds(),3):"")},formatDate:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?new Date:arguments[1];n instanceof Date||(n=new Date(n));var r=n.getHours();return e.replace(/([a-zA-Z])\1*/g,function(i){var a=i[0],o=i.length,s="y"===a?2===o?String(n.getFullYear()).substr(2):n.getFullYear():"M"===a?n.getMonth()+1:"d"===a?n.getDate():"H"===a?r:"h"===a?r<=12?0===r?12:r:r-12:"m"===a?n.getMinutes():"s"===a?n.getSeconds():"S"===a?n.getMilliseconds():"a"===a?r<12?"AM":"PM":null;if(null===s)throw new Error("Unsupported letter: "+a+" in pattern: "+e);return o>1&&(s=t.pad(s,o)),s})},toCurrency:function(e,t){var n,r=parseFloat(e).toFixed(2).split("."),i=r[0].split(""),a=i.length-3;for(n=a;n>=1;n-=3)i.splice(n,0,".");return i.join("")+","+(t===!1?"-":r[1])},dashCase:function(e){return e.replace(/\W+/g,"-").replace(/\w+/g,function(e){return e.toLowerCase()})},titleCase:function(e){return e.replace(/[\W_]+/g," ").replace(/(\w)(\w*)/g,function(e,t,n){return t.toUpperCase()+n.toLowerCase()})},getPathHead:function(e){var t=arguments.length<=1||void 0===arguments[1]?".":arguments[1],n=e.indexOf(t);return n<0?e:e.substr(0,n)},getPathTail:function(e){var t=arguments.length<=1||void 0===arguments[1]?".":arguments[1],n=e.indexOf(t);return n<0?"":e.substr(n+1)},seekRef:function(e){var t=arguments.length<=1||void 0===arguments[1]?"":arguments[1],n=arguments.length<=2||void 0===arguments[2]?".":arguments[2];if(!t)return{object:e,key:"",value:e};if(e){var r=this.getPathHead(t,n),i=e[r];return r===t?{object:e,key:r,value:i}:this.seekRef(i,this.getPathTail(t,n))}},seek:function(e){var t=arguments.length<=1||void 0===arguments[1]?"":arguments[1],n=arguments.length<=2||void 0===arguments[2]?".":arguments[2],r=this.seekRef(e,t,n);return r&&r.value},resolvePath:function(e,t){if(0===t.indexOf("/"))return t.substr(1);for(var n=e.substr(0,e.lastIndexOf("/")+1);0===t.indexOf("../");)t=t.substr(3),n=n.replace(/[^\/]+\/$/,"");return n+t},getTimeZone:function(e){e=void 0===e?-1*((new Date).getTimezoneOffset()/60):e;var t=e<0?"-":"+";return e=Math.abs(e),"UTC"+t+this.pad(Math.floor(e))+":"+this.pad(60*e%60)},eval:function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0],t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=Object.keys(t),r=n.map(function(e){return t[e]});e=e.trim();var i=e.indexOf(";");i>=0&&i<e.length?(n.push("_script",'"use strict"; return eval(_script);'),r.push(e)):n.push('"use strict"; return '+e);try{var a=Function.apply(null,n);return a.apply(t,r)}catch(t){throw t.message+=" in script: "+e.trim().replace(/\s+/g," "),t}},filter:function(e,t,n,r){var i=this;if("string"==typeof n){var a=this.escapeRegEx(n),o={fuzzy:n.split("").map(function(e){return i.escapeRegEx(e)+".*"}).join(""),contains:a,startsWith:"^"+a,endsWith:a+"$",equals:"^"+a+"$"}[r];void 0!==o&&(n=new RegExp(o,"i"))}var s=n instanceof RegExp?n.test.bind(n):n instanceof Function?n.bind(e):void 0===n?function(e){return!!e}:function(e){return e===n};return e.filter(function(e){return s(i.seek(e,t))})},order:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?"":arguments[1],r=!(arguments.length<=2||void 0===arguments[2])&&arguments[2];return e=e.slice(0),e.sort(function(e,i){return e=t.seek(e,n),i=t.seek(i,n),(r?-1:1)*(e<i?-1:e>i?1:0)})},page:function(e){var t=arguments.length<=1||void 0===arguments[1]?1:arguments[1],n=arguments.length<=2||void 0===arguments[2]?10:arguments[2],r=Math.ceil(e.length/n);t=Math.max(1,t),t=Math.min(r,t);var i=e.slice((t-1)*n,t*n);return Object.assign(i,{page:t,prev:t>1&&t-1,next:t<r&&t+1,last:r}),i}}}();
"use strict";!function(){var e=playtotv,o=e.util,t={},n={SPAM:4,DEBUG:3,INFO:2,WARNING:1,ERROR:0,NONE:-1},i={SPAM:"log",DEBUG:"debug",INFO:"info",WARNING:"warn",ERROR:"error"},r="undefined"!=typeof window?o.getURLParams(window.location.href):{};r.fbl&&e.loadScript("//getfirebug.com/firebug-lite.js#startOpened",!1);var l=r.weinre;void 0!==l&&e.loadScript("https://weinre.exmachina.nl/target/target-script-min.js#"+(l||"anonymous"),!1);var s=function(){function r(o,t){babelHelpers.classCallCheck(this,r),this.name=o||e.getUID("logger-"),this.level=t}return r.get=function(e,o){var n=e&&t[e];return n?(o&&(n.level=o),n):(n=new r(e,o),t[e]=n,n)},r.prototype.isEnabled=function(e){var o=this.level||r.level;return n[o]>=n[e]},r.prototype.log=function(e,t){var n=this;if(console&&this.isEnabled(e)){t=Array.from(t),t=t.map(function(o){if(o instanceof Promise){var i=["[promise]"];return o.then(function(o){i.push("[resolved]",o),n.log(e,t)},function(o){i.push("[rejected]",o),n.log(e,t)}),i}return o});var l=o.timeStr(new Date,!0)+" ["+e+"] "+this.name+" |",s=Array.prototype.concat.apply([l],t),a=console[i[e]]||console.log;a.apply(console,r.join?[s.join(" ")]:s)}},r.prototype.trace=function(e){console&&console.trace&&(!e||this.isEnabled(e))&&console.trace()},r.prototype.s=function(){this.log("SPAM",arguments)},r.prototype.d=function(){this.log("DEBUG",arguments)},r.prototype.i=function(){this.log("INFO",arguments)},r.prototype.w=function(){this.log("WARNING",arguments)},r.prototype.e=function(){this.log("ERROR",arguments)},r}();Object.assign(s,{level:r.logLevel||"INFO",join:!!r.logJoin}),e.Logger=s}();

"use strict";playtotv.define("playtotv.analytics.ComScoreAnalytics",[],function(){var t=playtotv,e=t.util;return function(){function n(e){babelHelpers.classCallCheck(this,n),t.params(e,{url:t.REQUIRED}),this.url=e.url,window.udm_||(window.udm_=function(t){var e,n,r,a,c,i="comScore=",o=document,s=o.cookie,l="",u="indexOf",d="substring",p="length",m=2048,f="&ns_",w="&",_=window,h=_.encodeURIComponent||escape;if(s[u](i)+1)for(a=0,r=s.split(";"),c=r[p];a<c;a++)n=r[a][u](i),n+1&&(l=w+unescape(r[a][d](n+i[p])));t+=f+"_t="+ +new Date+f+"c="+(o.characterSet||o.defaultCharset||"")+"&c8="+h(o.title)+l+"&c7="+h(o.URL)+"&c9="+h(o.referrer),t[p]>m&&t[u](w)>0&&(e=t[d](0,m-8).lastIndexOf(w),t=(t[d](0,e)+f+"cut="+h(t[d](e+1)))[d](0,m)),o.images?(n=new Image,_.ns_p||(_.ns_p=n),n.src=t):o.write("<","p","><",'img src="',t,'" height="1" width="1" alt="*"',"><","/p",">")})}return n.prototype.udm=function(t,n){var r=this.url.replace(/__TAG__/g,t||"");r=e.addURLParams(r,n||{}),window.udm_(r)},n}()});
"use strict";playtotv.define("playtotv.analytics.GoogleAnalytics",[],function(){var e=playtotv,t=e.Logger.get(this.id);return function(){function i(t){babelHelpers.classCallCheck(this,i),e.params(t,{id:e.REQUIRED,name:null,fields:{},setFields:null,dimensionMap:{},metricMap:{},requires:[],skipView:!1}),window.ga||!function(e,t,i,n,s,o,r){e.GoogleAnalyticsObject=s,e[s]=e[s]||function(){(e[s].q=e[s].q||[]).push(arguments)},e[s].l=1*new Date,o=t.createElement(i),r=t.getElementsByTagName(i)[0],o.async=1,o.src=n,r.parentNode.insertBefore(o,r)}(window,document,"script","//www.google-analytics.com/analytics.js","ga");var n=t.name,s=t.fields,o=t.setFields,r="";n&&(r=n+".",s.name=n),this.prefix=r,this.mode=o&&o.appId?"app":"web",this.dimensionMap=t.dimensionMap,this.metricMap=t.metricMap,window.ga("create",t.id,s),o&&this.setFields(o),t.requires.forEach(function(e){e=["require"].concat(e),this.ga.apply(this,e)}.bind(this));var a=Promise.defer();this.trackerPromise=a.promise,window.ga(function(e){e=n?window.ga.getByName(n):e,this.tracker=e,a.resolve(e)}.bind(this)),t.skipView||this.sendView()}return i.prototype.sendView=function(e,t){return"app"===this.mode?this.sendScreenview(e,t):this.sendPageview(e,null,t)},i.prototype.sendError=function(e,t,i){i=i||{};var n=((e.stack||"").match(/[^\s\(@]*(:\d+)+/)||[])[0]||document.location,s=e.name+": "+e.message+" ["+n+"]";return"app"===this.mode?this.sendException(s,t,i):(i.nonInteraction=!0,this.sendEvent(t?"fatal":"error",s,i))},i.prototype.sendPageview=function(e,t,i){return i=i||{},e&&(i.page=e),t&&(i.title=t),this.send("pageview",i)},i.prototype.sendScreenview=function(e,t){return t=t||{},e&&(t.screenName=e),this.send("screenview",t)},i.prototype.sendException=function(e,t,i){return i=i||{},i.exDescription=e,i.exFatal=!!t,this.send("exception",i)},i.prototype.time=function(e,t,i,n){var s=Date.now();return e.then(function(){this.sendTiming(t,i,Date.now()-s,n)}.bind(this)),e},i.prototype.sendTiming=function(e,t,i,n){return n=n||{},n.timingCategory=e,n.timingVar=t,n.timingValue=i,this.send("timing",n)},i.prototype.sendEvent=function(e,t,i){return i=i||{},i.eventCategory=e,i.eventAction=t,this.send("event",i)},i.prototype.sendSocial=function(e,t,i,n){return n=n||{},n.socialNetwork=e,n.socialAction=t,n.socialTarget=i,this.send("social",n)},i.prototype.get=function(e){return this.trackerPromise.then(function(t){return t.get(e)})},i.prototype.set=function(e,t){var i={};i[e]=t,this.setFields(i)},i.prototype.setFields=function(e){e=this.processFields(e),this.ga("set",e)},i.prototype.processFields=function(t){var i=["dimension","metric"],n=e.omit(t,i);return i.forEach(function(i){var s=this[i+"Map"];e.each(t[i],function(e,t){var o=s[t];o&&(n[i+o]=e)})},this),n},i.prototype.send=function(e,t){t=this.processFields(t||{});var i=Promise.defer();return t.hitCallback=i.resolve,this.ga("send",e,t),i.promise},i.prototype.ga=function(){var e=this.prefix,i=Array.from(arguments),n=i.shift();t.s(e+n,i),i.unshift(e+n),window.ga.apply(window,i)},i}()});
"use strict";playtotv.define("playtotv.widget.Widget",[],function(){var t=playtotv,e=t.event;return function(){function i(t){babelHelpers.classCallCheck(this,i),this.node=t,this.eventListeners=[],this.subscriptionRecords=[],this.timeoutIds=[]}return i.prototype.getNode=function(){return this.node},i.prototype.addEventListener=function(t,i,s){var r=e.addListener(t,i,s);return this.eventListeners.push(r),r},i.prototype.removeEventListener=function(t){var i=this.eventListeners,s=i.indexOf(t),r=s>=0;return r&&(e.removeListener(t),i.splice(s,1)),r},i.prototype.subscribe=function(t){var e=Array.from(arguments).slice(1),i={pubsub:t,subscription:t.subscribe.apply(t,e)};return this.subscriptionRecords.push(i),i},i.prototype.unsubscribe=function(t){var e=this.subscriptionRecords,i=e?e.lastIndexOf(t):-1;return i!==-1&&(e.splice(i,1),t.pubsub.unsubscribe(t.subscription),delete t.pubsub,delete t.subscription,!0)},i.prototype.setTimeout=function(t){function e(e,i){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t,e){var i=setTimeout(t,e);return this.timeoutIds.push(i),i}),i.prototype.clearTimeout=function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t){var e=this.timeoutIds,i=e.indexOf(t),s=i>=0;return s&&(clearTimeout(t),e.splice(i,1)),s}),i.prototype.dispose=function(){this.eventListeners.forEach(e.removeListener),this.subscriptionRecords.forEach(function(t){t.pubsub.unsubscribe(t.subscription),delete t.pubsub,delete t.subscription}),this.timeoutIds.forEach(clearTimeout),t.dispose(this)},i}()});
"use strict";playtotv.define("playtotv.analytics.AnalyticsWidget",["playtotv.widget.Widget"],function(t){var e=playtotv;return function(t){function n(a,i){var r=this;babelHelpers.classCallCheck(this,n),i=e.params(i,{app:null,controller:e.REQUIRED,nonInteraction:/view|load/,separator:/,\s+/,view:"",load:"",click:"",submit:"",change:"",event:""});var o=i.controller,l=i.nonInteraction,c=i.separator;t.call(this,a);var s=e.omit(i,["controller","nonInteraction","separator"]);e.each(s,function(t,e){if(t){var n=t.split(c),i="event"===e?n.shift():e,s=l.test(i);if("view"===i)o.view(t,{nonInteraction:s});else{var v=function(){o.event(n[0],n[1]||i,{eventLabel:n[2],nonInteraction:s})};"load"===i?v():r.addEventListener(a,i,v)}}})}return babelHelpers.inherits(n,t),n}(t)});
"use strict";playtotv.define("playtotv.animationFrame",[],function(){if("undefined"!=typeof window){var n,e,i=window.requestAnimationFrame,t=window.cancelAnimationFrame,o=["webkit","moz","ms","o"],a=o.length;for(n=0;n<a&&!i;n++)e=o[n],i=window[e+"RequestAnimationFrame"],t=window[e+"CancelAnimationFrame"]||window[e+"CancelRequestAnimationFrame"];var r=0;return i=i?i.bind(window):function(n){var e=Date.now(),i=Math.max(0,16-(e-r));return r=e+i,setTimeout(function(){n(r)},i)},t=t?t.bind(window):function(n){clearTimeout(n)},{request:i,cancel:t}}});
"use strict";playtotv.define("playtotv.cookie",[],function(){var t={get:function(t){var e,n=t+"=",i=document.cookie.split(";"),r=i.length;for(e=0;e<r;e++){for(var o=i[e];" "===o.charAt(0);)o=o.substring(1,o.length);if(0===o.indexOf(n))return o.substring(n.length,o.length)}return null},set:function(t,e,n){var i="";if(n){var r=new Date;r.setTime(r.getTime()+24*n*60*60*1e3),i="; expires="+r.toGMTString()}document.cookie=t+"="+e+i+"; path=/"},remove:function(t){this.set(t,"",-1)}};return t});
"use strict";playtotv.define("playtotv.cron",[],function(){function e(){return Date.now()}function t(e,t){t.quiet||s.s("job #"+t.id+' "'+t.label+'": '+e)}function i(i){t("Scheduling repeat @ "+i.time,i),i.timeout=void 0,i.time=e()+i.repeat,f[i.id]=i,d||u()}function n(n){var r;if(void 0!==(r=v[n]))delete v[n];else{if(void 0===(r=f[n]))return;delete f[n]}var o=e(),a=r.time-o;a=a<0?a:"+"+a,t("Executing @ "+o+" ("+a+"ms)",r),b[n]=r;var l=r.func.apply(r.context,r.args);Promise.resolve(l).then(function(e){b[n]&&(delete b[n],r.repeat>0&&e!==!1&&i(r))},function(){delete b[n]})}function r(t){var i=f[t];if(i){var r=i.time-e();r<=0?n(t):r<p.tickInterval&&(delete f[t],v[t]=i,i.timeout=setTimeout(function(){n(t)},r))}}function o(e,t,i){i=Object.assign({context:t,args:[],repeat:0,label:"unlabeled",quiet:!1},i);var n=Object.assign({id:m,time:e,func:t},i);return f[m++]=n,s.s("at(): #"+n.id+' "'+n.label+'"',n),i.repeat>0&&i.repeat<p.tickInterval&&(p.tickInterval=i.repeat,s.d("Setting tick interval to "+p.tickInterval+" to keep up with job #"+n.id+" ("+n.label+")")),nextTick(u),n.id}function a(e){return f[e]||v[e]||b[e]}function l(e){var i;if(void 0!==(i=v[e]))clearTimeout(i.timeout),delete v[e];else if(void 0!==(i=b[e]))delete b[e];else{if(void 0===(i=f[e]))return!1;delete f[e]}return t("Cancelled",i),!0}function c(){return!!d&&(s.s("Halting.."),Object.keys(f).forEach(l),Object.keys(v).forEach(l),Object.keys(b).forEach(l),clearTimeout(d),d=null,!0)}var u,s=playtotv.Logger.get(this.id),d=null,f={},v={},b={},m=1;u=function(){d&&(clearTimeout(d),d=null),Object.keys(f).forEach(r),Object.keys(f).length>0&&(d=setTimeout(u,p.tickInterval))};var p={tickInterval:1e3,at:o,get:a,cancel:l,halt:c,debug:{jobs:f,timeoutJobs:v,promisedJobs:b}};return p});
"use strict";playtotv.define("playtotv.css.Vector",[],function(){var t=Math.min,n=Math.max,i=Math.sqrt,r=function(){function r(t,n){babelHelpers.classCallCheck(this,r),this.x=t,this.y=n}return r.prototype.add=function(t){return new r(this.x+t.x,this.y+t.y)},r.prototype.subtract=function(t){return new r(this.x-t.x,this.y-t.y)},r.prototype.multiply=function(t){return new r(this.x*t.x,this.y*t.y)},r.prototype.multiplyBy=function(t){return new r(this.x*t,this.y*t)},r.prototype.divide=function(t){return new r(this.x/t.x,this.y/t.y)},r.prototype.divideBy=function(t){return new r(this.x/t,this.y/t)},r.prototype.dot=function(t){var n=this.multiply(t);return n.x+n.y},r.prototype.magnitude=function(){var t=this.x,n=this.y;return i(t*t+n*n)},r.prototype.normalize=function(){var t=this.magnitude();return new r(this.x/t,this.y/t)},r.prototype.inverse=function(){return new r(-this.x,-this.y)},r.prototype.modulo=function(t){return new r(t.x?this.x%t.x:this.x,t.y?this.y%t.y:this.y)},r.prototype.exceeds=function(t){return this.x>t.x||this.y>t.y||!1},r.prototype.min=function(n){return new r(t(this.x,n.x),t(this.y,n.y))},r.prototype.max=function(t){return new r(n(this.x,t.x),n(this.y,t.y))},r.prototype.limit=function(i,e){return new r(t(n(this.x,i.x),e.x),t(n(this.y,i.y),e.y))},r.prototype.toString=function(t){return t=t||"px",this.x+t+","+this.y+t},r}();return Object.assign(r,{FREE:0,VERTICAL:1,HORIZONTAL:2,UP:3,RIGHT:4,DOWN:5,LEFT:6,ZERO:new r(0,0),parseFloat:function(t){function n(n,i){return t.apply(this,arguments)}return n.toString=function(){return t.toString()},n}(function(t,n){return t=parseFloat(t),n=arguments.length<2?t:parseFloat(n),new r(t,n)})}),r});
"use strict";playtotv.define("playtotv.css.Point",["playtotv.css.Vector"],function(t){var e=function(){function e(t,n,s){babelHelpers.classCallCheck(this,e),this.x=t,this.y=n,this.z=s}return e.prototype.toVector=function(){return new t(this.x,this.y)},e}();return e.parseFloat=function(t,n,s){return t=parseFloat(t),n=arguments.length<2?t:parseFloat(n),s=arguments.length<3?t:parseFloat(s),new e(t,n,s)},e});
"use strict";playtotv.define("playtotv.css.Matrix",["playtotv.css.Point"],function(t){function i(t){return n.test(t)?n.exec(t)[1].split(",").map(parseFloat):r}var r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e="m11,m12,m13,m14,m21,m22,m23,m24,m31,m32,m33,m34,m41,m42,m43,m44".split(","),n=/matrix3?d?\(([^\)]+)\)/;return function(){function n(t){babelHelpers.classCallCheck(this,n),this.setMatrixValue(t)}return n.prototype.setMatrixValue=function(t){var n="string"==typeof t?i(t):t||r;if(!(n instanceof Array))throw new Error("Failed to parse "+t);this.entities=n=6===n.length?[n[0],n[1],0,0,n[2],n[3],0,0,0,0,1,0,n[4],n[5],0,1]:n,e.forEach(function(t,i){this[t]=n[i]},this),this.a=this.m11,this.b=this.m12,this.c=this.m21,this.d=this.m22,this.e=this.m41,this.f=this.m42},n.prototype.multiply=function(t){var i,r,e,o,s=this.entities,a=t instanceof Array?t:t.entities,p=[];for(i=0;i<4;i++)for(r=0;r<4;r++){for(o=0,e=0;e<4;e++)o+=s[4*i+e]*a[4*e+r];p[4*i+r]=o}return new n(p)},n.prototype.translate=function(t){var i=t.x,r=t.y,e=t.z||0;return this.multiply([1,0,0,0,0,1,0,0,0,0,1,0,i,r,e,1])},n.prototype.scale=function(i){"number"==typeof i&&(i=t.parseFloat(i));var r=i.x,e=i.y,n=i.z||1;return this.multiply([r,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1])},n.prototype.rotate=function(t,i,r){return t=t||0,i=arguments.length<2?t:i,r=arguments.length<3?t:r,this.rotateX(t).rotateY(i).rotateZ(r)},n.prototype.rotateX=function(t){var i=Math.cos(t),r=Math.sin(t);return this.multiply([1,0,0,0,0,i,-r,0,0,r,i,0,0,0,0,1])},n.prototype.rotateY=function(t){var i=Math.cos(t),r=Math.sin(t);return this.multiply([i,0,r,0,0,1,0,0,-r,0,i,0,0,0,0,1])},n.prototype.rotateZ=function(t){var i=Math.cos(t),r=Math.sin(t);return this.multiply([i,-r,0,0,r,i,0,0,0,0,1,0,0,0,0,1])},n.prototype.inverse=function t(){var i=this.entities,r=i[0],e=i[1],o=i[2],s=i[4],a=i[5],p=i[6],u=i[8],h=i[9],l=i[10],m=a*l-p*h,c=p*u-s*l,f=s*h-a*u,y=o*h-e*l,v=r*l-o*u,x=e*u-r*h,M=e*p-o*a,g=o*s-r*p,w=r*a-e*s,d=r*m+e*c+o*f,t=new n([m/d,y/d,M/d,0,c/d,v/d,g/d,0,f/d,x/d,w/d,0,0,0,0,1]),b=new n([1,0,0,0,0,1,0,0,0,0,1,0,-i[12],-i[13],-i[14],1]);return b.multiply(t)},n.prototype.transformPoint=function(i){var r=this.entities,e=i.x,n=i.y,o=i.z||0;return new t(r[0]*e+r[4]*n+r[8]*o+r[12],r[1]*e+r[5]*n+r[9]*o+r[13],r[2]*e+r[6]*n+r[10]*o+r[14])},n.prototype.toString=function(){return"matrix3d("+this.entities.toString()+")"},n}()});
"use strict";playtotv.define("playtotv.css.style",["playtotv.css.Matrix","playtotv.css.Vector"],function(t,e){if("undefined"!=typeof window){var n=navigator.userAgent,o={gecko:/gecko\//i.test(n),trident:/trident\//i.test(n),webkit:/webkit\//i.test(n),presto:/presto\//i.test(n)},r="",i=o.webkit?"-webkit-":o.gecko?"-moz-":o.presto?"-o-":o.trident?"-ms-":"",s=i+"transform",f=i+"transform-origin",a=window.WebKitPoint&&window.webkitConvertPointFromPageToNode,u={set:window.getComputedStyle?function(t,e,n){t.style.setProperty(e,n,r)}:function(t,e,n){t.style[e]=n},get:window.getComputedStyle?function(t,e){var n=window.getComputedStyle(t,null);return n.getPropertyValue(e)}:function(t,e){var n=t.currentStyle||t.style;return n[e]},remove:window.getComputedStyle?function(t,e){t.style.removeProperty(e)}:function(t,e){t.style[e]=""},prefix:function(t){return i+t||""},getSize:function(t){return new e(t.offsetWidth,t.offsetHeight)},getInnerSize:function(t){return new e(t.clientWidth,t.clientHeight)},getOffset:function(t,n){for(var o=0,r=0;t&&t!==n;)o+=t.offsetLeft,r+=t.offsetTop,t=t.offsetParent;return new e(o,r)},fromNodeToPage:a?function(t,n){var o=new window.WebKitPoint(n.x,n.y),r=window.webkitConvertPointFromNodeToPage(t,o);return new e(r.x,r.y)}:function(t,e){var n=this.getFullTransform(t);return n.transformPoint(e).toVector()},fromPageToNode:a?function(t,n){var o=new window.WebKitPoint(n.x,n.y),r=window.webkitConvertPointFromPageToNode(t,o);return new e(r.x,r.y)}:function(t,e){var n=this.getFullTransform(t);return n.inverse().transformPoint(e).toVector()},setTransform:function(e,n){n instanceof t&&(n=n.toString()),this.set(e,s,n)},getTransform:function(e){var n=this.get(e,s);return new t(n)},removeTransform:function(t){this.remove(t,s)},getFullTransform:function(n){for(var o,r=new t;n;){if(o=this.getTransform(n)){var i=this.getTransformOrigin(n);i&&(o=(new t).translate(i.inverse()).multiply(o).translate(i)),r=r.multiply(o)}r=r.translate(new e(n.offsetLeft,n.offsetTop)),n=n.offsetParent}return r},getTransformOrigin:function(t){var n=(this.get(t,f)||"0 0").split(" ");return e.parseFloat(n[0],n[1])},setPosition:function(t,e){var n=t.style;n.left=e.x+"px",n.top=e.y+"px"},getPosition:function(t){return e.parseFloat(this.get(t,"left"),this.get(t,"top"))},setTranslate:function(t,e){this.set(t,s,"translate3d("+e+",0)")},getTranslate:function(t){var n=this.getTransform(t);return n.transformPoint(e.ZERO).toVector()}};return u}});
"use strict";playtotv.define("playtotv.episode.episodeSessionAPI",[],function(){return{get:{label:"episodeSession.get",url:"1/episodesessions/{episodeSessionId}"},getAsyncDataForEpisodeSession:{label:"episodeSession.getAsyncDataForEpisodeSession",url:"1/episodesessions/{episodeSessionId}/async",queryKeys:["phase"]},getEpisodeSessionStateAsChanges:{label:"episodeSession.getEpisodeSessionStateAsChanges",url:"1/episodesessions/{episodeSessionId}/statechanges/active"},getEpisodeSessionStateAsChangesSince:{label:"episodeSession.getEpisodeSessionStateAsChangesSince",url:"1/episodesessions/{episodeSessionId}/statechanges/active/{sinceVersion}"},getMaxScore:{label:"episodeSession.getMaxScore",url:"1/episodesessions/{episodeSessionId}/maxscore"},getNonClosedSessions:{label:"episodeSession.getNonClosedSessions",url:"1/episodesessions/nonclosed",queryKeys:["timeZone"]},getNonClosedSessionsForShow:{label:"episodeSession.getNonClosedSessionsForShow",url:"1/episodesessions/show/{showId}/nonclosed",queryKeys:["timeZone"]},getNonClosedSessionsForShowByName:{label:"episodeSession.getNonClosedSessionsForShowByName",url:"1/episodesessions/show/byname/{showName}/nonclosed",queryKeys:["timeZone"]},getSessionsInPhase:{label:"episodeSession.getSessionsInPhase",url:"1/episodesessions/state/{state}",queryKeys:["timeZone"]},getSessionsInPhaseForShow:{label:"episodeSession.getSessionsInPhaseForShow",url:"1/episodesessions/show/{showId}/state/{state}",queryKeys:["timeZone"]},getSessionsInPhaseForShowByName:{label:"episodeSession.getSessionsInPhaseForShowByName",url:"1/episodesessions/show/byname/{showName}/state/{state}",queryKeys:["timeZone"]},getUserStatistics:{label:"episodeSession.getUserStatistics",url:"1/episodesessions/{episodeSessionId}/users"},join:{label:"episodeSession.join",url:"1/episodesessions/{episodeSessionId}",type:"PUT"},joinAndGetState:{label:"episodeSession.joinAndGetState",url:"1/episodesessions/joinandgetstate",type:"PUT",queryKeys:["showName","showId","episodeSessionId","timeZone"]},joinInSync:{label:"episodeSession.joinInSync",url:"1/episodesessions/show/{showId}/episode/{episodeCode}/joinInSync",type:"PUT",dataKeys:["msSinceSessionStart","timeWindow","createIfNoneAvailable"]},leave:{label:"episodeSession.leave",url:"1/episodesessions/{episodeSessionId}",type:"DELETE"}}});
"use strict";playtotv.define("playtotv.facebook.FacebookAdapter",[],function(){return function(){function e(t){babelHelpers.classCallCheck(this,e),this.facebook=t}return e.prototype.getLoginParams=function(e,t){var n=this.facebook;return n.login(e).then(function(e){return n.call("api",t,"/me").then(function(t){return{facebookId:e,fbsr:n.signedRequest,displayName:t.name,avatarUrl:"//graph.facebook.com/"+e+"/picture",privateProperties:Object.keys(t).reduce(function(e,n){var o=t[n];return e[n]="object"==typeof o?JSON.stringify(o):o,e},{})}})})},e.prototype.getCredentialParams=function(e){var t=this.facebook;return t.login(e).then(function(e){return{facebookId:e,fbsr:t.signedRequest}})},e}()});
"use strict";playtotv.define("playtotv.facebook.FacebookPostWidget",["playtotv.widget.Widget"],function(t){var e="data-facebook-",o=playtotv.Logger.get(this.id);return function(t){function n(e,i){babelHelpers.classCallCheck(this,n),t.call(this,e),this.options=playtotv.params(i,{facebook:playtotv.REQUIRED,interactive:!0,timeout:void 0,content:{},process:function(t){return t},onResolve:function(t){o.d("onResolve, post id:",t)},onReject:function(t){o.d("onReject",t)}}),this.onClick=this.onClick.bind(this),this.addEventListener(e,"click",this.onClick)}return babelHelpers.inherits(n,t),n.prototype.onClick=function(t){return t.preventDefault(),this.post(),!1},n.prototype.post=function(){var t=this.node,o=this.options,n=o.facebook,i=Object.assign({},o.content);Array.from(t.attributes).forEach(function(t){0===t.name.indexOf(e)&&(i[t.name.substr(e.length)]=t.value)}),playtotv.each(i,function(t,e){i[e]=o.process(i[e],e)}),n.post(i,o.interactive,o.timeout).then(o.onResolve,o.onReject)},n}(t)});
"use strict";playtotv.define("playtotv.fx.Animation",["playtotv.animationFrame"],function(t){return function(){function e(t){babelHelpers.classCallCheck(this,e),this.settings=playtotv.params(t,{alternate:!1,cycles:1,duration:playtotv.REQUIRED,fps:0,rate:1,start:0})}return e.prototype.requestFrame=function(){var e=this;this.playing=t.request(function(){return e.onTick()})},e.prototype.cancelFrame=function(){this.playing&&(t.cancel(this.playing),delete this.playing)},e.prototype.play=function(t){this.playing&&this.stop(),this.animation=t=playtotv.params(t,this.settings),this.frame=t.fps?1e3/t.fps:0,this.startTime=t.start||Date.now(),this.frameTime=0,this.reversed=!1,this.onStart(),this.requestFrame()},e.prototype.pause=function(){this.playing&&(this.paused=!0,this.pauseTime=Date.now(),this.cancelFrame())},e.prototype.resume=function(){this.paused&&(delete this.paused,this.startTime=this.startTime+(Date.now()-this.pauseTime),this.requestFrame())},e.prototype.stop=function(t){this.cancelFrame(),t&&this.onFrame(0)},e.prototype.onTick=function(){var t=Date.now(),e=this.animation,i=e.cycles,s=(t-this.startTime)*e.rate,n=Math.max(0,s/e.duration),a=n>=i,r=i>1?n%1:Math.min(1,n);if(e.alternate){var o=n%2>1;o!==this.reversed&&(this.reversed=o,this.onCycle(o)),r=o?1-r:r}(!this.frame||a||t-this.frameTime>this.frame)&&(this.frameTime=t,this.onFrame(r)),a?this.onFinish():this.requestFrame()},e.prototype.onFrame=function(){throw new ReferenceError("Abstract function not implemented")},e.prototype.onStart=function(){},e.prototype.onCycle=function(){},e.prototype.onFinish=function(){},e}()});
"use strict";playtotv.define("playtotv.fx.easing",[],function(){var n={get:function(n){return this[n]||this.linear},set:function(n,t){if(this.hasOwnProperty(n))throw new Error('"'+n+'" easing is already defined.');return this[n]=t,t},linear:function(n){return n},quadin:function(n){return n*n},quadout:function(n){return n*(2-n)},quadinout:function(n){return n<.5?2*n*n:1-2*--n*n},cubicin:function(n){return n*n*n},cubicout:function(n){return--n*n*n+1},cubicinout:function(n){return n<.5?4*n*n*n:1+4*--n*n*n},quartin:function(n){return n*n*n*n},quartout:function(n){return-(--n*n*n*n-1)},quartinout:function(n){return n<.5?8*n*n*n*n:1-8*--n*n*n*n}};return n});
"use strict";playtotv.define("playtotv.fx.Timeline",["playtotv.fx.Animation"],function(t){return function(t){function n(i){babelHelpers.classCallCheck(this,n),t.call(this,i),this.actions=[]}return babelHelpers.inherits(n,t),n.prototype.add=function(t,n){return n=playtotv.params(n,{callback:playtotv.REQUIRED,context:void 0,args:[]}),this.actions.push(Object.assign(n,{time:t,run:!0})),n},n.prototype.remove=function(t){var n=this.actions.indexOf(t);n>=0&&this.actions.splice(n,1)},n.prototype.reset=function(){this.actions.forEach(function(t){t.run=!1})},n.prototype.onStart=function(){this.reset()},n.prototype.onCycle=function(){this.reset()},n.prototype.onFrame=function(t){var n=this.animation,i=t*n.duration,o=this.reversed;this.actions.forEach(function(t){var n=i>=t.time;!t.run&&(o&&!n||!o&&n)&&(t.run=!0,t.callback.apply(t.context,t.args))})},n}(t)});
"use strict";playtotv.define("playtotv.fx.Transition",["playtotv.fx.Animation","playtotv.fx.easing"],function(t,a){var e=["callback","easing","from","to"];return function(t){function i(a){babelHelpers.classCallCheck(this,i),a=playtotv.params(a,{alternate:!1,callback:playtotv.REQUIRED,cycles:1,duration:playtotv.REQUIRED,easing:"linear",fps:0,from:0,rate:1,start:0,to:1}),t.call(this,playtotv.omit(a,e)),this.settings=a}return babelHelpers.inherits(i,t),i.prototype.onFrame=function(t){var e=this.animation||this.settings,i=this.ease||(this.ease=a.get(e.easing));e.callback(e.from+(e.to-e.from)*i(t))},i}(t)});
"use strict";playtotv.define("playtotv.global.genericContentAPI",[],function(){return{getCategory:{label:"genericContent.getCategory",url:"1/genericcontent/{category}"}}});
"use strict";playtotv.define("playtotv.global.globalDataAPI",[],function(){return{get:{label:"globalData.get",url:"1/globaldata/",queryKeys:["timeZone"]}}});
"use strict";playtotv.define("playtotv.handlebars.hbsUtil",[],function(){var t={softException:function(t){var n=new Handlebars.Exception(t);return window.nextTick(function(){throw n}),""},getValue:function(t,n){return n instanceof Function?n.call(t):n},getHash:function(t,n){return Object.keys(n).reduce(function(e,r){return e[r]=this.getValue(t,n[r]),e}.bind(this),{})},getArgs:function(t,n,e,r,i){var a=this;n=Array.from(n);var o=n.pop();n=n.map(function(n){return a.getValue(t,n)});var c={args:n,options:o,hash:this.getHash(t,o.hash)};if(e){e=e.split(", ");var s=e.length;r=void 0!==r?r:s,i=void 0!==i?i:s-r;var u=n.length;if(u<r||u>r+i){var l=e.slice(0,r),f=e.slice(r,i);this.softException(o.name+" got invalid number of arguments,  expected: "+r+(i?" to "+(r+i):"")+" ("+l.concat(f.map(function(t){return"["+t+"]"})).join(", ")+"), but got: "+u+" ("+n.join(", ")+")")}e.forEach(function(t,e){c[t]=n[e]})}return c},extendContext:function(t,n){return n instanceof Object&&Object.keys(n).length>0?Object.assign({},t,n):t},callHelper:function(t,n){for(var e=arguments.length,r=Array(e>2?e-2:0),i=2;i<e;i++)r[i-2]=arguments[i];return Handlebars.helpers[t].apply(n,r)},delegateIfBlock:function(t,n,e,r,i){return r.fn?(i&&(r=Object.assign({},r,{hash:{}})),this.callHelper(t,n,e,r)):e}};return t});
"use strict";playtotv.define("playtotv.handlebars.helpers",["playtotv.handlebars.hbsUtil"],function(t){var e=playtotv,r=e.util,s={var:function(){var e=t.getArgs(this,arguments,""),r=e.options,s=e.hash,n=r.fn,a=r.data;return n&&(a=Handlebars.createFrame(a)),Object.assign(a,s),n?n(this,{data:a}):""},is:function(){var e=t.getArgs(this,arguments,"value1, value2"),r=e.value1,s=e.value2,n=e.options;return t.delegateIfBlock("if",this,r===s,n)},isnt:function(){var e=t.getArgs(this,arguments,"value1, value2"),r=e.value1,s=e.value2,n=e.options;return t.delegateIfBlock("if",this,r!==s,n)},default:function(){var e=t.getArgs(this,arguments,"value, def"),r=e.value,s=e.def;return void 0===r?s:r},switch:function(){var e=t.getArgs(this,arguments,"value, def",1),r=e.value,s=e.def,n=e.hash;return Object.keys(n).indexOf(r)>=0?n[r]:void 0===s?t.softException("No matching case or default for value: "+r):s},classes:function(){var r=t.getArgs(this,arguments),s=r.hash,n="";return e.each(s,function(t,e){t&&(n=n?n+" "+e:e)}.bind(this)),n},inc:function(){var e=t.getArgs(this,arguments,"x, y",1),r=e.x,s=e.y;return s=void 0===s?1:s,r+s},dec:function(){var e=t.getArgs(this,arguments,"x, y",1),r=e.x,s=e.y;return s=void 0===s?1:s,r-s},gt:function(){var e=t.getArgs(this,arguments,"x, y"),r=e.x,s=e.y,n=e.options;return t.delegateIfBlock("if",this,r>s,n)},lt:function(){var e=t.getArgs(this,arguments,"x, y"),r=e.x,s=e.y,n=e.options;return t.delegateIfBlock("if",this,r<s,n)},not:function(){var e=t.getArgs(this,arguments,"value"),r=e.value,s=e.options;return t.delegateIfBlock("if",this,!r,s)},or:function(){var e=t.getArgs(this,arguments),r=e.args,s=e.options,n=r.find(function(t){return t});return t.delegateIfBlock("if",this,n,s)},and:function(){var e=t.getArgs(this,arguments),r=e.args,s=e.options,n=r.reduce(function(t,e){return t&&e},!0);return t.delegateIfBlock("if",this,n,s)},inArray:function(){var e=t.getArgs(this,arguments,"list, value"),r=e.list,s=e.value,n=e.options;return t.delegateIfBlock("if",this,r.indexOf(s)>=0,n)},Array:function(){var e=t.getArgs(this,arguments),r=e.args,s=e.options;return t.delegateIfBlock("each",this,r,s)},Object:function(){var e=t.getArgs(this,arguments),r=e.options,s=e.hash;return t.delegateIfBlock("with",this,s,r)},toNumber:function(){var e=t.getArgs(this,arguments,"str"),r=e.str;return parseFloat(r)},toBool:function(){var e=t.getArgs(this,arguments,"str"),r=e.str;return"true"===r},lowerCase:function(){var e=t.getArgs(this,arguments,"text"),r=e.text;return(""+r).toLowerCase()},upperCase:function(){var e=t.getArgs(this,arguments,"text"),r=e.text;return(""+r).toUpperCase()},dashCase:function(){var e=t.getArgs(this,arguments,"text"),s=e.text;return r.dashCase(""+s)},sentenceCase:function(){var e=t.getArgs(this,arguments,"text"),r=e.text;return r=""+r,r[0].toUpperCase()+r.substr(1).toLowerCase()},titleCase:function(){var e=t.getArgs(this,arguments,"text"),s=e.text;return r.titleCase(""+s)},concat:function(){var e=t.getArgs(this,arguments),r=e.args;return r.join("")},join:function(){var e=t.getArgs(this,arguments,"array"),r=e.array,s=e.hash,n=e.options,a=n.fn,i=n.inverse,o=s.separator||", ",u=s.last||o;r=a?r.map(a):r.slice(0);var g=r.length;return 0===g?i?i(this):"":1===g?r[0]:r.slice(0,-1).join(o)+u+r[g-1]},split:function(){var e=t.getArgs(this,arguments,"str"),r=e.str,s=e.hash,n=e.options,a=s.separator||/,\s?/,i=r.length>0?r.split(a):[];return t.delegateIfBlock("each",this,i,n,!0)},inflect:function(){var e=t.getArgs(this,arguments,"count, singular, plural"),r=e.count,s=e.singular,n=e.plural,a=1===r?s:n;return a.replace(/%d/g,r)},truncate:function(){var e=t.getArgs(this,arguments,"str, len"),r=e.str,s=e.len,n=e.hash,a=n.dots||"..";return r.length>s&&(r=r.substr(0,s-a.length)+a),r},addURLParams:function(){var e=t.getArgs(this,arguments,"url",0),s=e.url,n=e.hash;return s=s||window.location.href,r.addURLParams(s,n)},getURLParams:function(){var e=t.getArgs(this,arguments,"url",0),s=e.url;return s=s||window.location.href,r.getURLParams(s)},getURLParam:function(){var e=t.getArgs(this,arguments,"urlOrKey, key",1),s=e.urlOrKey,n=e.key,a=n?s:"";return n=n||s,r.getURLParams(a)[n]},formatDate:function(){var e=t.getArgs(this,arguments,"pattern, date",1),s=e.pattern,n=e.date;return r.formatDate(s,n)},addCommas:function(){var e=t.getArgs(this,arguments,"number, separator",1,1),r=e.number,s=e.separator;void 0===s&&(s=",");var n=","===s?".":",",a=r.toString().split(".");return a[0].replace(/\B(?=(\d{3})+(?!\d))/g,s)+(a[1]?n+a[1]:"")},toFixed:function(){var e=t.getArgs(this,arguments,"value, digits",1,1),r=e.value,s=e.digits;return void 0===s&&(s=2),r.toFixed(s)},toString:function(){var e=t.getArgs(this,arguments,"value",1,0),r=e.value;return String(r)},pad:function(){var e=t.getArgs(this,arguments,"value, len, ch",1,2),s=e.value,n=e.len,a=e.ch;return r.pad(s,n,a)},seek:function(){var e=t.getArgs(this,arguments,"path, context",1),s=e.path,n=e.context;return n=n||this,r.seek(n,s)},eval:function(){var e=t.getArgs(this,arguments,"script, context",0),s=e.script,n=e.context,a=e.hash,i=e.options;return n=n||this,Object.keys(a).length>0&&(n=a),i.fn&&(s=i.fn(this)),r.eval(s,n)},take:function(){var e=t.getArgs(this,arguments,"array, nr",1),r=e.array,s=e.nr,n=e.options;s=void 0===s?1:s;var a=r.slice(0,s);return t.delegateIfBlock("each",this,a,n)},filter:function(){var e=t.getArgs(this,arguments,"list, path, value",1),s=e.list,n=e.path,a=e.value,i=e.hash,o=e.options,u=i.mode,g=r.filter(s,n,a,u);return t.delegateIfBlock("each",this,g,o,!0)},order:function(){var e=t.getArgs(this,arguments,"list, path",1),s=e.list,n=e.path,a=e.hash,i=e.options,o=a.desc,u=r.order(s,n,o);return t.delegateIfBlock("each",this,u,i,!0)},paginate:function(){var e=t.getArgs(this,arguments,"list, page, size",1),s=e.list,n=e.page,a=e.size,i=e.options;n=parseInt(n,10),a=parseInt(a,10);var o=r.page(s,n,a);return t.delegateIfBlock("each",this,o,i,!0)},json:function(){var e=t.getArgs(this,arguments,"obj"),r=e.obj,s=e.hash;return s.pretty?JSON.stringify(r,null,"\t"):JSON.stringify(r)},hash:function e(){var e=window.location.hash,s=t.getArgs(this,arguments),n=s.args,a=n.join("");if(!a)return e;var i=e.slice(1);return i&&(a=r.resolvePath(i,a)),"#"+a},helperMissing:function(){var e=arguments[arguments.length-1];t.softException("Unknown field or helper: "+e.name)}};return s});
"use strict";playtotv.define("playtotv.pubsub.Subscription",[],function(){var t=playtotv,e=t.util;return function(){function n(t,o){if(babelHelpers.classCallCheck(this,n),!("string"==typeof t||t instanceof RegExp))throw new TypeError("Invalid selector (not a string or RegExp)");if(!(o instanceof Function))throw new TypeError("Invalid handler (not a function)");"string"==typeof t&&t.indexOf("*")>=0&&(t=e.globToRegEx(t)),this.selector=t,this.handler=o}return n.prototype.match=function(t){var e=this.selector;return"string"==typeof e?e===t:e.test(t)},n.prototype.deliver=function(t,e){this.handler&&this.handler(t,e)},n.prototype.dispose=function(){t.dispose(this)},n}()});
"use strict";playtotv.define("playtotv.model.ModelSubscription",["playtotv.pubsub.Subscription"],function(e){var t=playtotv.util;return function(e){function i(l,n){if(babelHelpers.classCallCheck(this,i),!/^([\w\*]+:[\w\*\.]+(=.*)?)|\*$/.test(l))throw new Error("Invalid selector string: "+l);if("*"===l)l=/.*/;else{var r=l.indexOf("=")===-1;r&&(l+="="),(r||l.indexOf("*")!==-1)&&(l=t.escapeRegEx(l),l=l.replace(/\\\*/g,"[^:\\.=]+"),l=new RegExp("^"+l))}e.call(this,l,n)}return babelHelpers.inherits(i,e),i.prototype.deliver=function(e){this.handler&&this.handler(e.value,e.action,e.key)},i}(e)});
"use strict";playtotv.define("playtotv.pubsub.PubSub",["playtotv.pubsub.Subscription"],function(s){function t(s,t){var i=s.indexOf(t);return i!==-1&&(s.splice(i,1),!0)}var i=playtotv;return function(){function n(){babelHelpers.classCallCheck(this,n),this.subscriptions=[],this.cancellables=[]}return n.prototype.subscribe=function(t,i){var n=new s(t,i);return this.subscriptions.push(n),n},n.prototype.unsubscribe=function(s){var i=this.subscriptions;return s.dispose(),!!i&&t(i,s)},n.prototype.subscribeAll=function(s){var t,i=s.length,n=[];for(t=0;t<i;t++)n.push(this.subscribe.apply(this,s[t]));return n},n.prototype.unsubscribeAll=function(s){s=s||this.subscriptions;var t,i=s.length;for(t=0;t<i;t++)this.unsubscribe(s[t])},n.prototype.when=function(s){var i=this.cancellables,n=this;return new Promise.Cancellable(function(e){var r=this;i.push(r);var o=n.subscribe(s,function(s){e(s)});r.finally(function(){n.unsubscribe(o),t(i,r)})})},n.prototype.publish=function(s,t,i){var n,e,r,o=this.subscriptions,u=o.length;for(n=0;n<u;n++)e=o[n],r=e.match(s),r&&(i?e.deliver(t,s):nextTick(e.deliver,e,[t,s]))},n.prototype.dispose=function(){this.subscriptions.forEach(function(s){s.dispose()}),this.cancellables.forEach(function(s){s.cancel(new Promise.CancellationError("Disposed"))}),i.dispose(this)},n}()});
"use strict";playtotv.define("playtotv.mvc.Controller",["playtotv.pubsub.PubSub"],function(t){var e=playtotv,o=e.util,s=e.REQUIRED;return function(t){function i(o){babelHelpers.classCallCheck(this,i);var r=e.params(o,{name:s,app:s,store:{},stored:void 0}),n=r.name,p=r.app,a=r.store,u=r.stored;t.call(this),Object.assign(this,a,{name:n,app:p,storeKeys:Object.keys(a)}),this.deserialize(u)}return babelHelpers.inherits(i,t),i.prototype.serialize=function(){return e.pick(this,this.storeKeys)},i.prototype.deserialize=function(t){Object.assign(this,t)},i.prototype.log=function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];this.app.log(this.name+"."+t,e)},i.prototype.flush=function(){return this.app.flush(this.name)},i.prototype.setWidget=function(t,e){var o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];o.controller=this,this.app.setWidget(this.name+"."+t,e,o)},i.prototype.setWidgets=function(t){var e=this;t.forEach(function(t){return e.setWidget.apply(e,t)})},i.prototype.seek=function(t){return o.seek(this,t)},i.prototype.observe=function(t,e){return e(this.seek(t),t),this.subscribe(t,function(o){return e(o,t)})},i.prototype.set=function(t,s,i){i=e.params(i,{json:"object"==typeof s,force:!1});var r=o.seekRef(this,t);if(!r)throw new Error("Can not set property on undefined object: "+t);var n=r.value;(i.force||!i.json&&s!==n||i.json&&JSON.stringify(s)!==JSON.stringify(n))&&(r.object[r.key]=s,this.publish(t,s))},i.prototype.toggle=function(t,e){e=void 0===e?!this.seek(t):"string"==typeof e?"true"===e:!!e,this.set(t,e)},i}(t)});
"use strict";playtotv.define("playtotv.episode.EpisodeController",["playtotv.mvc.Controller","playtotv.episode.episodeSessionAPI"],function(t,e){var n=playtotv,i=n.util,o=n.Logger.get(this.id);return function(t){function s(e,o){babelHelpers.classCallCheck(this,s),o=n.params(o,{timeZone:i.getTimeZone(),showName:void 0,showId:void 0,episodeSessionId:void 0});var a=e.stored||{};t.call(this,e,{model:{current:null,waiting:!1,episodeInteractionUserDataMap:a.episodeInteractionUserDataMap||{}}}),this.options=o,this.addMethods(["getEpisode","getInteraction","getCurrentInteraction","getNextAsyncInteraction","submitInteraction"]),this.predictionTypes=["PREDICTION"],this.scope.observe("user.online",this.start.bind(this)),this.scope.subscribe("change:push.stream",this.onStreamChange.bind(this)),this.scope.subscribe("push.EPISODESESSION-STATECHANGE",this.onChangeEvent.bind(this)),this.scope.subscribe("push.EPISODESESSION-INTERACTIONSTATEUPDATE",this.onUpdateEvent.bind(this))}return babelHelpers.inherits(s,t),s.prototype.start=function(t){!this.hasStarted&&t&&(this.join(),this.hasStarted=!0)},s.prototype.adaptEpisode=function(t){return Object.assign(t,{interactionMap:{},interactionQueue:[],asyncInteractions:{},position:"BEFORE"})},s.prototype.join=function(){var t=this;return this.scope.call("server.call",e.joinAndGetState,this.options).then(function(e){var n=e.episodeSession;if(!n)return t.set("waiting",!0),Promise.race([t.scope.when("push.EPISODESESSION-OPENED"),t.scope.when("change:push.stream")]).then(function(){return t.join()});var i=t.adaptEpisode(n);return t.set("waiting",!1),t.set("current",i),e.state.stateChanges.forEach(function(e){t.onStateChange(e,!0)}),i}).catch(function(e){return o.e("join()",e),t.set("current",null),Promise.delay(5e3).then(function(){return t.join()})})},s.prototype.checkState=function(){var t=this,n=this.getEpisode();this.checkingState||(this.checkingState=!0,this.scope.call("server.call",e.getEpisodeSessionStateAsChangesSince,{episodeSessionId:n.id,sinceVersion:n.version?n.version+1:1}).then(function(e){e.stateChanges.forEach(function(e){return t.onStateChange(e)})}).finally(function(){t.checkingState=!1}))},s.prototype.getEpisode=function(){return this.model.current},s.prototype.getInteraction=function(t){var e=this.getEpisode();return e&&e.interactionMap[t]},s.prototype.getCurrentInteraction=function(){var t=this.getEpisode();return t&&t.interactionQueue[0]},s.prototype.getAsyncInteractions=function(t){var n=this,i=this.getEpisode();t=t||i.currentPhase;var o=i.asyncInteractions[t];return o?Promise.resolve(o):this.scope.call("server.call",e.getAsyncDataForEpisodeSession,{episodeSessionId:i.id,phase:t}).then(function(e){return o=e.map(function(t){var e=n.upsertInteraction(t);return e.state="ANSWER",e}),i.asyncInteractions[t]=o,o})},s.prototype.getNextAsyncInteraction=function(t){return t=t||this.getEpisode().currentPhase,this.getAsyncInteractions(t).then(function(t){return t.find(function(t){return!t.data})})},s.prototype.submitInteraction=function(t,e,n,i){var o=this;return this.scope.call("server.toServerTime").then(function(s){var a=o.getEpisode(),r=a.interactionMap[e],c=r.stateTimeMap.ANSWER;return n.episodeSessionId=a.id,n.clientAnswerTime&&(n.clientAnswerTime=s-c),o.scope.call("server.call",t,n).then(function(t){return i&&(t=i(r.data,t)),o.setInteractionUserData(a.id,r,t),o.publish("interaction-submitted-"+e,t),t})})},s.prototype.getInteractionUserData=function(t,e){var n=this.model.episodeInteractionUserDataMap[t];return n&&n[e]},s.prototype.setInteractionUserData=function(t,e,i){var o=n.pick(this.model.episodeInteractionUserDataMap,[t]),s=o[t]||(o[t]={});e.data=s[e.id]=i,this.set("episodeInteractionUserDataMap",o,{force:!0})},s.prototype.upsertInteraction=function(t){var e=t.interactionId,n=t.data||{},i=this.getEpisode(),o=i.interactionMap,s=o[e];return s||(s=o[e]={id:e,type:t.type,stateTimeMap:{},stateDurationMap:{},data:this.getInteractionUserData(i.id,e)}),n.interactionContent&&(s.content=n.interactionContent),n.interactionStats&&(s.stats=n.interactionStats),n.interactionUserData&&this.setInteractionUserData(i.id,s,n.interactionUserData),s},s.prototype.queueInteraction=function(t){var e=this.getEpisode(),n=e.interactionQueue,i=n.indexOf(t);i!==-1&&n.splice(i,1);var o=t.state,s=t.type;"FINISHED"===o||"AWAITING_RESULTS"===o&&this.predictionTypes.indexOf(s)>=0||n.unshift(t)},s.prototype.updateInteractionPosition=function(t){var e=t.content||{},n=this.getEpisode();n.position="FINISHED"===t.state&&"true"===e.lastquestion?"AFTER":"BETWEEN"},s.prototype.onStreamChange=function(){this.getEpisode()&&this.checkState()},s.prototype.onChangeEvent=function(t){var e=t.payload,n=this.getEpisode();n&&e.episodeSessionId===n.id&&this.onStateChange(e)},s.prototype.onStateChange=function(t,e){var n=this.getEpisode(),i=n.version,s=t.subject,a=t.version;if(a<=i)return void o.d("onStateChange: Skipping: "+a+" (already at: "+i+")");if(a>i+1)return o.d("onStateChange: Missed changes between: "+i+" and "+a),void this.checkState();var r=function(n){e||this.publish(n,t)}.bind(this);switch(s){case"PHASE":this.onPhaseChange(t,e);break;case"INTERACTION":this.onInteractionChange(t,e);break;case"LEADERBOARD_UPDATED":r("leaderboard-update");break;case"LEADERBOARD_FINAL":r("leaderboard-final");break;default:o.d("onStateChange: No handler defined for subject: "+s)}n.version=a},s.prototype.onPhaseChange=function(t,e){var n=this.getEpisode(),i=t.sessionPhase;n.currentPhase=i,e||this.publish("phase-change-"+i,t),"CLOSED"===i&&(this.set("current",null),this.join())},s.prototype.onInteractionChange=function(t,e){var n=this.upsertInteraction(t),i=t.interactionState;n.state=i,n.stateTimeMap[i]=t.time,n.stateDurationMap[i]=t.duration,t.interaction=n,this.queueInteraction(n),this.updateInteractionPosition(n),e||this.publish("interaction-change-"+t.interactionId,t)},s.prototype.onUpdateEvent=function(t){var e=t.payload,n=this.getEpisode();if(n&&e.episodeSessionId===n.id){var i=this.getInteraction(e.interactionId),o=i.state;if("RESULTS"!==o&&"FINISHED"!==o){var s=JSON.stringify(i),a=JSON.stringify(this.upsertInteraction(e));a!==s&&(e.interaction=i,this.publish("interaction-update-"+e.interactionId,e))}}},s.prototype.serialize=function(t){return n.pick(t,["episodeInteractionUserDataMap"])},s}(t)});
"use strict";playtotv.define("playtotv.fx.EffectsController",["playtotv.mvc.Controller"],function(t){var e=playtotv,n=e.dom;return function(t){function i(n,o){babelHelpers.classCallCheck(this,i),o=e.params(o,{transitions:{},defaults:{},fxDelay:250}),t.call(this,n),this.addMethods(["once"]),this.transitionMap=o.transitions,this.defaultMap=o.defaults,this.onceMap={},this.delay=o.fxDelay;var a=this.scope.view;a.nodeAddedListeners.push(this.onNodeAdded.bind(this)),a.nodeRemoveListeners.push(this.onNodeRemove.bind(this))}return babelHelpers.inherits(i,t),i.prototype.once=function(t,e){if(!this.transitionMap[e])throw new Error("Unknown transition: "+e);this.onceMap[t]=e},i.prototype.getSelectors=function(){return e.union(Object.keys(this.defaultMap),Object.keys(this.onceMap))},i.prototype.getTransition=function(t){var e=this.onceMap[t]||this.defaultMap[t];return this.transitionMap[e]},i.prototype.onNodeRemove=function(t){var e=this,i=!1;return this.getSelectors().filter(function(e){return n.matches(e,t)}).forEach(function(n){var o=e.getTransition(n);e.playAnimation(t,o.leave),i=!0}),i?this.delay:0},i.prototype.onNodeAdded=function(t){var e=this;this.getSelectors().filter(function(e){return n.matches(e,t)}).forEach(function(n){var i=e.getTransition(n);e.playAnimation(t,i.enter),delete e.onceMap[n]})},i.prototype.playAnimation=function(t,e){if(e){var i=n.getData(t,"fx-animation");i&&(n.removeData(t,"fx-animation"),t.classList.remove(i)),n.setData(t,"fx-animation",e),t.classList.add(e)}},i}(t)});
"use strict";playtotv.define("playtotv.global.GlobalController",["playtotv.global.genericContentAPI","playtotv.global.globalDataAPI","playtotv.mvc.Controller","playtotv.cron"],function(t,e,o,n){var a=playtotv,i=a.util;return function(o){function s(t,e){var l=this;babelHelpers.classCallCheck(this,s),e=a.params(e,{timeZone:i.getTimeZone()}),o.call(this,t),this.getContent=Promise.limit(this.getContentNow,6e5),this.addMethods(["update","getContent"]),this.options=e;var r=this.update.bind(this);n.at(Date.now(),r,{repeat:3e5}),this.scope.subscribe("push.GLOBALDATA-REPLACED",function(t){return l.onData(t.payload)}),this.scope.subscribe("push.GLOBALDATA-UPDATED",function(t){return l.onUpdate(t.payload)})}return babelHelpers.inherits(s,o),s.prototype.update=function(){this.scope.call("server.call",e.get,this.options).then(this.onData.bind(this))},s.prototype.getContentNow=function(e){return this.scope.call("server.call",t.getCategory,{category:e})},s.prototype.onData=function(t){var e=this;a.each(t,function(t,o){e.set(o,t)})},s.prototype.onUpdate=function(t){var e=t.category,o=t.object,n=t.uniqueIdField,a=this.model[e]||[],i=a.find(function(t){return t[n]===o[n]});i?Object.assign(i,o):a.push(o),this.set(e,a,{force:!0})},s}(o)});
"use strict";playtotv.define("playtotv.model.AbstractModel",["playtotv.model.ModelSubscription","playtotv.pubsub.PubSub"],function(t,e){return function(o){function r(){babelHelpers.classCallCheck(this,r),o.call(this)}return babelHelpers.inherits(r,o),r.prototype.toObject=function(){throw new ReferenceError("Abstract function not implemented")},r.prototype.updateModel=function(){throw new ReferenceError("Abstract function not implemented")},r.prototype.isRelatedModel=function(){throw new ReferenceError("Abstract function not implemented")},r.prototype.getSelectorAction=function(t){var e=t.indexOf(":");return e===-1?void 0:t.substr(0,e)},r.prototype.getSelectorKey=function(t){var e=t.indexOf(":");if(e!==-1){var o=t.substring(e+1),r=o.indexOf("=");return r===-1?o:o.substring(0,r)}},r.prototype.getSelectorValue=function(t){var e=t.indexOf("=");return e===-1?void 0:t.substring(e+1)},r.prototype.getSelectorMatches=function(t){var e=this.getSelectorAction(t)||"*",o=this.getSelectorKey(t)||"*",r=this.getSelectorValue(t);if("remove"===e)throw new Error("Matching with remove action selector is not supported: "+t);if(!o||o.indexOf(".")!==-1)throw new Error("Only basic key matching is supported: "+t);var n=[];return playtotv.each(this.toObject(),function(t,e){"*"!==o&&e!==o||void 0!==r&&String(t)!==r||n.push({key:e,value:t})}),n},r.prototype.subscribe=function(e,o,r){var n=new t(e,o);return r&&this.getSelectorMatches(e).forEach(function(t){var e=t.key,o=t.value,r="init:"+e+"="+o,i={key:e,action:"init",value:o};nextTick(n.deliver,n,[i,r])}),this.subscriptions.push(n),n},r.prototype.when=function(t){if(void 0!==this.getSelectorValue(t)){var o=this.getSelectorMatches(t);if(o.length>0)return Promise.Cancellable.resolve(o[0].value)}return e.prototype.when.call(this,t)},r.prototype.publish=function(t,o,r){var n=o+":"+t+"="+r,i={key:t,action:o,value:r};e.prototype.publish.call(this,n,i)},r}(e)});
"use strict";playtotv.define("playtotv.model.ObjectModel",["playtotv.model.AbstractModel"],function(t){return function(i){function e(t){babelHelpers.classCallCheck(this,e),i.call(this),this.propertyKeys=[],this.childSubscriptionMap={},t&&this.copyProperties(t)}return babelHelpers.inherits(e,i),e.prototype.toObject=function(){var t,i,e={},r=this.propertyKeys,o=r.length;for(t=0;t<o;t++)i=r[t],e[i]=this[i];return e},e.prototype.updateModel=function(t){var i=this.propertyKeys,e=Object.keys(t),r=[];return i.filter(function(t){return e.indexOf(t)===-1}).forEach(function(t){r.push(this.removeProperty(t))}.bind(this)),e.filter(function(t){return i.indexOf(t)===-1}).forEach(function(i){this.addProperty(i,t[i])}.bind(this)),e.filter(function(t){return i.indexOf(t)!==-1}).forEach(function(i){r.push(this.changeProperty(i,t[i]))}.bind(this)),r},e.prototype.isRelatedModel=function(i){if(this===i)return!0;var e,r,o=this.childSubscriptionMap,s=Object.keys(o),n=s.length;for(e=0;e<n;e++)if(r=o[s[e]].model,r instanceof t&&r.isRelatedModel(i))return!0;return!1},e.prototype.subscribeChild=function(t,i){var e=i.subscribe("*",function(i,e,r){this.publish(t+"."+r,e,i)}.bind(this));this.childSubscriptionMap[t]={model:i,subscription:e}},e.prototype.unsubscribeChild=function(t){var i=this.childSubscriptionMap,e=i[t];e.model.unsubscribe(e.subscription),delete i[t]},e.prototype.addProperty=function(i,e){var r=this.propertyKeys,o=e instanceof t;if(r.indexOf(i)!==-1)throw new Error("Property with specified key already exists: "+i);if(i in this)throw new Error("Specified key is reserved: "+i);if(o&&e.isRelatedModel(this))throw new Error("Value is a model in a cyclic relationship with this model");r.push(i),this[i]=e,o&&this.subscribeChild(i,e),this.publish(i,"add",e)},e.prototype.changeProperty=function(i,e,r){r=r||{};var o=this[i],s=e instanceof t;if(this.propertyKeys.indexOf(i)===-1)throw new Error("Property with specified key does not exist: "+i);if(!r.force){if(e===o||r.json&&JSON.stringify(e)===JSON.stringify(o))return;if(s&&e.isRelatedModel(this))throw new Error("Value is a model in a cyclic relationship with this model")}return o instanceof t&&this.unsubscribeChild(i),this[i]=e,s&&this.subscribeChild(i,e),this.publish(i,"change",e),o},e.prototype.removeProperty=function(i){var e=this.propertyKeys,r=e.indexOf(i),o=this[i];if(r===-1)throw new Error("Property with specified key does not exist: "+i);return o instanceof t&&this.unsubscribeChild(i),e.splice(r,1),delete this[i],this.publish(i,"remove",o),o},e.prototype.setProperty=function(t,i,e){return this.propertyKeys.indexOf(t)!==-1?this.changeProperty(t,i,e):void this.addProperty(t,i)},e.prototype.copyProperties=function(t){var i=[];for(var e in t)t.hasOwnProperty(e)&&i.push(this.setProperty(e,t[e]));return i},e.prototype.dispose=function(){playtotv.each(this.childSubscriptionMap,function(t){t.model.unsubscribe(t.subscription)}),t.prototype.dispose.call(this)},e}(t)});
"use strict";playtotv.define("playtotv.facebook.Facebook",["playtotv.model.ObjectModel"],function(t){var e=playtotv,i=e.util,s=e.Logger.get(this.id),o=e.REQUIRED;return function(t){function r(i){babelHelpers.classCallCheck(this,r),t.call(this,{status:null,id:null,accessToken:null,signedRequest:null}),i=e.params(i,{appId:o,version:"v2.3",cookie:!1,status:!0,xfbml:!1,frictionlessRequests:!1,hideFlashCallback:null,locale:"en_US",redirect:void 0,scope:void 0,timeout:2e4});var s=Promise.defer();this.appId=i.appId,this.version=i.version,this.locale=i.locale,this.redirect=i.redirect,this.scope=i.scope,this.initialized=new Promise.Cancellable(function(t,e){s.promise.then(t,e),i.timeout&&this.setTimeout(i.timeout)}),window.fbAsyncInit=function(){var t=window.FB;t.init(e.pick(i,["appId","version","cookie","status","xfbml","frictionlessRequests","hideFlashCallback"])),t.Event.subscribe("auth.authResponseChange",this.onStatusResponse.bind(this)),t.getLoginStatus(function(e){this.onStatusResponse(e),s.resolve(t)}.bind(this))}.bind(this),e.loadScript("//connect.facebook.net/"+this.locale+"/sdk.js",!0)}return babelHelpers.inherits(r,t),r.prototype.onStatusResponse=function(t){var e=t.authResponse||{};this.copyProperties({status:t.status,id:e.userID||null,accessToken:e.accessToken||null,signedRequest:e.signedRequest||null})},r.prototype.call=function(t,e){e=void 0!==e?e:2e4;var i=Array.from(arguments).slice(2),o={what:t,timeout:e,args:i};s.s("FB."+t+"(",i,"), timeout: "+e);var r=this.initialized.then(function(e){var s=Promise.defer();return i.push(function(t){t&&t.error?s.reject(Object.assign(new Error("Call failed"),o,t.error,{message:"Request error: "+t.error.message})):s.resolve(t)}),e[t].apply(e,i),s.promise});if(e){var n=Object.assign({message:"Request timeout"},o);r.setTimeout(e,n)}return r},r.prototype.api=function(){var t=Array.from(arguments);return t.unshift("api"),this.call.apply(this,t)},r.prototype.ui=function(){var t=Array.from(arguments);return t.unshift("ui",!1),this.call.apply(this,t)},r.prototype.getFriends=function(t){return this.api(t,"/me/friends").then(function(t){return t.data})},r.prototype.login=function(t){return this.initialized.then(function(){return this.id?Promise.resolve(this.id):t?this.redirect?(this.loginByRedirect(),Promise.defer().promise):this.loginByDialog():Promise.reject(new Error("Login requires user interaction"))}.bind(this))},r.prototype.loginByDialog=function(){return this.initialized.then(function(t){var e=Promise.defer();return t.login(function(t){t.authResponse&&t.authResponse.userID?e.resolve(t.authResponse.userID):e.reject(Object.assign(new Error("Login failed"),t))},{scope:this.scope}),e.promise}.bind(this))},r.prototype.loginByRedirect=function(t){window.top.location=i.addURLParams("https://www.facebook.com/"+this.version+"/dialog/oauth",{client_id:this.appId,response_type:"token",scope:this.scope||"",redirect_uri:t||this.redirect})},r.prototype.logout=function(t){return this.initialized.then(function(){return this.id?this.call("logout",t):Promise.resolve({status:this.status})}.bind(this))},r.prototype.post=function(t,e,i){return e&&this.redirect?(this.postByRedirect(t,this.redirect),Promise.defer().promise):this.login(e).then(function(){return e?this.postByDialog(t):this.postByAPI(t,i)}.bind(this))},r.prototype.postByAPI=function(t,e){return this.call("api",e,"/me/feed","post",t).then(function(t){return t.id})},r.prototype.postByDialog=function(t){return this.ui(Object.assign({method:"feed"},t)).then(function(t){return t&&t.post_id||Promise.reject(Object.assign(new Error("Post failed"),t))})},r.prototype.postByRedirect=function(t,e){window.top.location=i.addURLParams("https://www.facebook.com/dialog/feed",Object.assign({app_id:this.appId,redirect_uri:e||this.redirect},t))},r}(t)});
"use strict";playtotv.define("playtotv.model.ArrayModel",["playtotv.model.AbstractModel"],function(t){function i(t,i){var r,e=0,n=t.length;for(r=0;r<n;r++)t[r]===i&&e++;return e}return function(r){function e(t){babelHelpers.classCallCheck(this,e),r.call(this),this.array=[],this.childSubscriptions=[],t&&t.forEach(function(t){this.add(t)}.bind(this))}return babelHelpers.inherits(e,r),e.prototype.toObject=function(){return this.array.slice(0)},e.prototype.updateModel=function(t){var r,e,n=this.array,s=t.length,o=[];try{if(JSON.stringify(t)===JSON.stringify(n))return[]}catch(t){}for(r=n.length-1;r>=0;r--)e=n[r],i(t,e)<i(n,e)&&o.push(this.remove(r));for(r=0;r<s;r++)e=t[r],i(t,e)>i(n,e)&&this.add(e,r);for(r=0;r<s;r++)o.push(this.change(r,t[r]));return o},e.prototype.isRelatedModel=function(i){if(this===i)return!0;var r,e,n,s=this.childSubscriptions,o=s.length;for(r=0;r<o;r++)if(e=s[r],e&&(n=e.model,n instanceof t&&n.isRelatedModel(i)))return!0;return!1},e.prototype.subscribeChild=function(t,i){var r=this.childSubscriptions,e=i.subscribe("*",function(i,e,s){t=r.indexOf(n),this.publish(t+"."+s,e,i)}.bind(this)),n={model:i,subscription:e};r[t]=n},e.prototype.unsubscribeChild=function(t){var i=this.childSubscriptions,r=i[t];r.model.unsubscribe(r.subscription),i[t]=null},e.prototype.add=function(i,r){var e=this.array,n=e.length,s=this.childSubscriptions,o=i instanceof t;if(arguments.length<2&&(r=n),r<0)throw new RangeError("Index out of bounds: "+r);if(o&&i.isRelatedModel(this))throw new Error("Item is a model in a cyclic relationship with this model");r<n?(e.splice(r,0,i),s.splice(r,0,null)):(e[r]=i,s[r]=null),o&&this.subscribeChild(r,i),this.publish(r,"add",i)},e.prototype.change=function(i,r){var e=this.array,n=r instanceof t;if(i<0||i>=e.length)throw new RangeError("Index out of bounds: "+i);var s=e[i];if(r!==s){if(n&&r.isRelatedModel(this))throw new Error("Item is a model in a cyclic relationship with this model");return s instanceof t&&this.unsubscribeChild(i),e[i]=r,n&&this.subscribeChild(i,r),this.publish(i,"change",r),s}},e.prototype.remove=function(i){var r=this.array;if(arguments.length<1)i=0;else if(i<0||i>=r.length)throw new RangeError("Index out of bounds: "+i);var e=r[i];return e instanceof t&&this.unsubscribeChild(i),r.splice(i,1),this.childSubscriptions.splice(i,1),this.publish(i,"remove",e),e},e.prototype.removeWhere=function(t){if(!(t instanceof Function)){var i=t;t=function(t){return t===i}}for(var r=[],e=this.array,n=e.length-1;n>=0;n--)t(e[n])&&r.push(this.remove(n));return r},e.prototype.clear=function(){for(var t=[],i=this.array.length-1;i>=0;i--)t.push(this.remove(i));return t},e.prototype.set=function(t,i){return t<this.array.length?this.change(t,i):void this.add(i,t)},e.prototype.dispose=function(){this.array.length=0,this.childSubscriptions.forEach(function(t){t&&t.model.unsubscribe(t.subscription)}),t.prototype.dispose.call(this)},e}(t)});
"use strict";playtotv.define("playtotv.model.modelUtil",["playtotv.model.AbstractModel","playtotv.model.ArrayModel","playtotv.model.ObjectModel"],function(t,e,n){return{create:function(o,i){if(o instanceof t){if(i)return o;throw new TypeError("Value is already a Model")}if(o instanceof Array)return new e(o.map(function(t){return this.create(t,!0)}.bind(this)));if("object"==typeof o&&null!==o)return new n(Object.keys(o).reduce(function(t,e){return t[e]=this.create(o[e],!0),t}.bind(this),{}));if(i)return o;throw new TypeError("Value can not be modelified")},toObject:function(e){var n=e.toObject();return playtotv.each(n,function(e,o){e instanceof t&&(n[o]=this.toObject(e))}.bind(this)),n},update:function(o,i){if(!(o instanceof t))throw new TypeError("Model argument is not a model");if(i instanceof t)throw new TypeError("Source is already a Model");var r=o instanceof e,a=r?[]:{};playtotv.each(i,function(i,c){if(i instanceof t)throw new Error("Source value is already a Model");var s=r?o.array[c]:o[c],f=i instanceof Array,l=!f&&"object"==typeof i&&null!==i;l&&s instanceof n||f&&s instanceof e?(this.update(s,i),a[c]=s):l||f?a[c]=this.create(i):a[c]=i}.bind(this));var c=o.updateModel(a);c.filter(function(e){return e instanceof t}).forEach(function(t){this.dispose(t)}.bind(this))},dispose:function(e){playtotv.each(e.toObject(),function(e){e instanceof t&&this.dispose(e)}.bind(this)),e.dispose()}}});
"use strict";playtotv.define("playtotv.logUtil",["playtotv.model.modelUtil"],function(t){var n=playtotv,e=n.util;return{logPubSub:function(n,o){var r=arguments.length<=2||void 0===arguments[2]?{"*":"INFO"}:arguments[2],i=Object.keys(r).map(function(t){return{regex:e.globToRegEx(t),level:r[t]}});return n.subscribe("*",function(n,e){var r=i.find(function(t){return t.regex.test(e)}).level;if("IGNORE"!==r){n&&n.toObject&&(n=t.toObject(n));var l="object"==typeof n?[e,n]:[e+": "+n];o.log(r,l)}})},logModel:function(o,r,i){i=n.params(i,{blacklist:[],name:""});var l=i.blacklist.map(function(t){return e.globToRegEx(t)}),a=i.name;return a=a?a+" ":"",o.subscribe("*",function(n,e,o){if(!l.find(function(t){return t.test(o)})){n&&n.toObject&&(n=t.toObject(n));var i=a+e+" "+o;"object"==typeof n?r(i,n):r(i+" => "+n)}})},logMethod:function(t,n,e,o){o=o||n;var r=t[n];t[n]=function(){var n=Array.from(arguments);return e(o,n),r.apply(t,n)}},logMethods:function(t,o,r){r=n.params(r,{blacklist:[],name:""});var i=r.blacklist.map(function(t){return e.globToRegEx(t)}),l=r.name;l=l?l+".":"";for(var a in t)t[a]instanceof Function&&!i.find(function(t){return t.test(a)})&&this.logMethod(t,a,o,l+a)}}});
"use strict";playtotv.define("playtotv.MutationObserver",[],function(){if("undefined"!=typeof window){var t=playtotv.event,e={type:null,target:null,addedNodes:[],removedNodes:[],previousSibling:null,nextSibling:null,attributeName:null,attributeNamespace:null,oldValue:null},i={childList:!1,attributes:!1,characterData:!1,subtree:!1,attributeOldValue:!1,characterDataOldValue:!1,attributeFilter:!1},r={DOMNodeInserted:function(t,i,r){var n=t.target;return i.subtree||n.parentNode===r?playtotv.params({type:"childList",target:n.parentNode,addedNodes:[n],previousSibling:n.previousSibling,nextSibling:n.nextSibling},e):null},DOMNodeRemoved:function(t,i,r){var n=t.target;return i.subtree||n.parentNode===r?playtotv.params({type:"childList",target:n.parentNode,removedNodes:[n],previousSibling:n.previousSibling,nextSibling:n.nextSibling},e):null},DOMAttrModified:function(t,i,r){var n=t.attrName,o=i.attributeFilter;return!i.subtree&&t.target!==r||o&&!(o.indexOf(n)>=0)?null:playtotv.params({type:"attributes",target:t.target,attributeName:n,oldValue:i.attributeOldValue?t.prevValue:null},e)},DOMCharacterDataModified:function(t,i,r){return i.subtree||t.target===r?playtotv.params({type:"characterData",target:t.target,oldValue:i.characterDataOldValue?t.prevValue:null},e):null}},n=function(){function e(i,n,o){babelHelpers.classCallCheck(this,e),this.node=i,this.proxyEvent=n,this.observer=o,this.processor=r[n],this.onModified=this.onModified.bind(this),t.addListener(i,n,this.onModified)}return e.prototype.onModified=function(t){var e=this.observer,i=this.processor(t,e.options,this.node);i&&e.addRecord(i)},e.prototype.disconnect=function(){t.removeListener(this.node,this.proxyEvent,this.onModified),delete this.node,delete this.proxyEvent,delete this.observer,delete this.processor},e}(),o=function(){function t(e){babelHelpers.classCallCheck(this,t),this.callback=e,this.listeners=[],this.records=[]}return t.prototype.observe=function(t,e){if(e=this.options=playtotv.params(e,i),!e.childList&&!e.attributes&&!e.characterData)throw new Error("An invalid or illegal string was specified");var r=this.listeners;e.childList&&r.push(new n(t,"DOMNodeInserted",this),new n(t,"DOMNodeRemoved",this)),e.attributes&&r.push(new n(t,"DOMAttrModified",this)),e.characterData&&r.push(new n(t,"DOMCharacterDataModified",this))},t.prototype.addRecord=function(t){this.records.push(t),this.notify()},t.prototype.takeRecords=function(){var t=this.records;return this.records=[],t},t.prototype.notify=function(){var t=this.takeRecords();t.length&&this.callback(t)},t.prototype.disconnect=function(){this.listeners.forEach(function(t){t.disconnect()}),this.listeners=[]},t}();return window.MutationObserver||window.WebkitMutationObserver||window.MozMutationObserver||o}});
"use strict";playtotv.define("playtotv.mvc.BindWidget",["playtotv.widget.Widget"],function(t){var e=playtotv,p=e.event;return function(t){function a(p,i){var n=this;babelHelpers.classCallCheck(this,a),t.call(this,p);var s=e.params(i,{app:e.REQUIRED,path:e.REQUIRED}),h=s.app,r=s.path;this.app=h,this.path=r;var u=h.seek(r);void 0!==u?this.updateInput(u):this.updateApp();var c=function(){return n.updateApp()};this.addEventListener(p,"change",c),this.addEventListener(p,"keyup",c),this.subscribe(h,r,function(t){return n.updateInput(t)})}return babelHelpers.inherits(a,t),a.prototype.updateApp=function(){var t=this.node,e="checkbox"===t.type?t.checked:t.value;this.app.set(this.path,e)},a.prototype.updateInput=function(t){var e=this.node;"checkbox"===e.type?t!==e.checked&&(e.checked=t,p.triggerNative(e,"change")):t!==e.value&&(e.value=t)},a}(t)});
"use strict";playtotv.define("playtotv.mvc.helpers",["playtotv.handlebars.hbsUtil","playtotv.handlebars.helpers"],function(t,e){var a=playtotv,r=a.util,s=[];return Object.assign(e,{call:function(){var e=t.getArgs(this,arguments),a=e.args,s=e.hash,n=e.options,i=a.shift(),l=n.data.root;if("object"==typeof i&&(l=i,i=a.shift()),!i)return t.softException("Call methodPath argument missing");n.fn&&a.push(n.fn(this)),Object.keys(s).length>0&&a.push(s);var o=r.seekRef(l,i),h=o&&o.value;if(!h)return t.softException("Call method not found: "+i);try{return h.apply(o.object,a)}catch(e){return t.softException("Call "+e.name+":"+e.message)}},script:function e(){var a=t.getArgs(this,arguments,"script",0),e=a.script,r=a.hash,s=a.options;s.fn&&(e=s.fn(this)),e=e.trim().replace(/\s+/g," ");var n=Object.keys(r).length>0?JSON.stringify([e,r]):e;return n=Handlebars.Utils.escapeExpression(n),new Handlebars.SafeString(n)},on:function(){var t=Array.from(arguments),a=t.shift(),r=e.script.apply(this,t);return new Handlebars.SafeString("on-"+a+'="'+r+'"')},widgets:function(){var e=t.getArgs(this,arguments),a=e.args,r=JSON.stringify(a);return r=Handlebars.Utils.escapeExpression(r),new Handlebars.SafeString('widgets="'+r+'"')},widget:function(){var e=t.getArgs(this,arguments,"name"),a=e.name,r=e.hash;return[a,r]},templatePath:function(){var e=t.getArgs(this,arguments,"path",0),a=e.path,n=e.options,i=s[s.length-1]||n.data.root.router.pattern;return void 0===a?i:r.resolvePath(i,a)},partial:function e(){var a=t.getArgs(this,arguments,"path, context",1),r=a.path,n=a.context,i=a.hash,l=a.options;n=n||this,Object.keys(i).length>0&&(n=i,l.hash={});var o=l.fn;o&&(Handlebars.registerPartial("@partial-block",o),delete l.fn);var h=t.callHelper("templatePath",this,r,l),e=Handlebars.partials[h]||Handlebars.templates[h];if(!e)return t.softException("Partial not found: "+h);s.push(h);var p=new Handlebars.SafeString(e(n,l));return s.pop(),o&&Handlebars.unregisterPartial("@partial-block"),p},registerPartial:function(){var e=t.getArgs(this,arguments,"path"),a=e.path,r=e.options,s=t.callHelper("templatePath",this,a,r);Handlebars.registerPartial(s,r.fn)}})});
"use strict";playtotv.define("playtotv.mvc.Router",["playtotv.pubsub.PubSub"],function(t){var e=playtotv;return function(t){function r(n){babelHelpers.classCallCheck(this,r),n=e.params(n,{root:"index",rescue:"route-not-found",patterns:e.REQUIRED}),t.call(this),this.root=n.root,this.rescue=n.rescue,this.routes=n.patterns.map(function(t){return{pattern:t,regex:new RegExp("^"+t.replace(/__\w+__/g,"([^/]*)")+"$"),keys:(t.match(/__\w+__/g)||[]).map(function(t){return t.substr(2,t.length-4)})}}),window.onhashchange=this.update.bind(this),this.update()}return babelHelpers.inherits(r,t),r.prototype.find=function(t){return this.routes.find(function(e){return e.pattern===t})||this.routes.find(function(e){return e.regex.test(t)})},r.prototype.getParams=function(t,e){var r=(e.match(t.regex)||[]).slice(1);return r.reduce(function(e,r,n){return e[t.keys[n]]=r,e},{})},r.prototype.update=function(){var t=window.location,e=t.hash.substr(1);if(e||(e=this.root,t.hash="#"+e),/\/$/.test(e)&&(e+="index"),e!==this.path){this.path=e;var r,n=this.find(e);if(n)r=this.getParams(n,e);else{var s=this.rescue;if(n=this.find(s),!n)throw new Error("Could not find rescue route: "+s);r=Object.assign(this.getParams(n,s),{path:e})}var i=n.pattern;this.pattern=i,this.params=r,this.publish(i,r)}},r}(t)});
"use strict";playtotv.define("playtotv.mvc.UpdateWidget",["playtotv.widget.Widget","playtotv.cron"],function(t,e){var a=playtotv;return function(t){function p(r,i){babelHelpers.classCallCheck(this,p);var s=a.params(i,{app:a.REQUIRED,script:a.REQUIRED,start:Date.now(),repeat:6e5}),o=s.app,n=s.script,c=s.start,l=s.repeat;t.call(this,r),this.job=e.at(c,function(){o.runScript(n)},{repeat:l})}return babelHelpers.inherits(p,t),p.prototype.dispose=function(){e.cancel(this.job),t.prototype.dispose.call(this)},p}(t)});
"use strict";playtotv.define("playtotv.PauseDog",[],function(){var t=playtotv,e=new t.Logger(this.id);return function(){function s(){babelHelpers.classCallCheck(this,s),this.pauseCallbacks=[],this.interval=1e3,this.scheduleTick()}return s.prototype.scheduleTick=function(){this.lastTick=Date.now(),this.timeout=setTimeout(this.onTick.bind(this),this.interval)},s.prototype.add=function(t,e){var s={threshold:t,callback:e};return this.pauseCallbacks.push(s),s},s.prototype.remove=function(t){var e=this.pauseCallbacks,s=e.indexOf(t);s!==-1&&e.splice(s,1)},s.prototype.onTick=function(){var t=Date.now(),s=t-this.interval-this.lastTick,i="Paused: "+Math.round(s/1e3)+" seconds";s>1e4?e.d(i):s>1e3&&e.s(i),this.pauseCallbacks.filter(function(t){return s>t.threshold}).forEach(function(t){return t.callback(s)}),this.scheduleTick()},s.prototype.dispose=function(){this.pauseCallbacks.length=0,clearTimeout(this.timeout),t.dispose(this)},s}()});
"use strict";playtotv.define("playtotv.Timer",[],function(){return function(){function t(){babelHelpers.classCallCheck(this,t),this.t0=Date.now(),this.accounted=0,this.timings=[]}return t.prototype.start=function(){this.tx=Date.now()},t.prototype.end=function(t){var i=Date.now()-this.tx;delete this.tx,this.accounted+=i,this.timings.push(t+": "+i)},t.prototype.finish=function(){this.total=Date.now()-this.t0,this.unaccounted=this.total-this.accounted;var t=this.timings,i=this.total,n=this.unaccounted,s=i+"ms";return t.length>0&&(s+=" ("+t.join(", ")+")"),n&&(s+=" +"+n),this.string=s,s},t}()});
"use strict";playtotv.define("playtotv.mvc.View",["playtotv.pubsub.PubSub","playtotv.Timer"],function(e,t){function o(e){var t=window.Polymer;return t?t.dom(e):e}function r(e,t){e.domNode=t;var n,i=e.childNodes,d=o(t).childNodes,a=i.length;for(n=0;n<a;n++)r(i[n],d[n])}function n(e,t){var o=e.nodeType;if(o!==t.nodeType)return!1;if(o===h||o===f)return!0;if(e.nodeName!==t.nodeName)return!1;var r=e.id,n=t.id;if(r||n)return r===n;if(r=e.getAttribute("view-id"),n=t.getAttribute("view-id"),r||n)return r===n;var i,d,a,s,l=e.attributes;for(i=0,d=l.length;i<d;i++)if(a=l[i],s=a.name,"class"!==s&&t.getAttribute(s)!==a.value)return!1;for(l=t.attributes,i=0,d=l.length;i<d;i++)if(a=l[i],s=a.name,"class"!==s&&e.getAttribute(s)!==a.value)return!1;return!0}function i(e,t){var o,r,i=t.length;for(o=0;o<i;o++)if(r=t[o],n(e,r))return t.splice(o,1)[0]}function d(e,t,o,r){var n,i,d,a,s,l,u;for(n=t.attributes,i=0,d=n.length;i<d;i++)a=n[i],s=a.name,l=a.value,u=e.getAttribute(s),"class"!==s&&u!==l&&r.push({action:"set-attr",node:o,name:s,value:l,oldValue:u});for(n=e.attributes,i=0,d=n.length;i<d;i++)a=n[i],s=a.name,l=a.value,"class"===s||t.hasAttribute(s)||r.push({action:"remove-attr",node:o,name:s,value:l})}function a(e,t,o,r){var n,i,d,a=e.classList,s=t.classList;for(n=0,d=s.length;n<d;n++)i=s[n],a.contains(i)||r.push({action:"add-class",node:o,name:i});for(n=0,d=a.length;n<d;n++)i=a[n],s.contains(i)||r.push({action:"remove-class",node:o,name:i})}function s(e,t,o){var r,n,l,c,m=e.childNodes,v=Array.from(t.childNodes),p=1,N=e.domNode;t.domNode=N;var y=e.nodeType;if(y===h||y===f){var b=t.data;return b!==e.data&&o.push({action:"text",node:N,data:b}),p}for(y===u&&(d(e,t,N,o),a(e,t,N,o)),r=0,n=m.length;r<n;r++)l=m[r],c=i(l,v),c?p+=s(l,c,o):o.push({action:"remove",node:l});for(r=0,n=v.length;r<n;r++)c=v[r],o.push({action:"add",node:c});return p}function l(e){if(!e.hasAttribute||!e.hasAttribute("view-indented")){var t,o,r=e.childNodes,n=r.length;for(t=n-1;t>=0;t--)o=r[t],o.nodeType===h?/^[\t\n]+$/.test(o.data)&&e.removeChild(o):o.childNodes&&l(o)}}var u=1,h=3,f=8,c=playtotv,m=c.REQUIRED;return function(e){function n(t){babelHelpers.classCallCheck(this,n),c.params(t,{render:m,throttle:100,interval:1e4,onNodeAdded:function(){},onNodeRemove:function(){},onAttrSet:function(){},onAttrRemove:function(){}}),e.call(this),Object.assign(this,t);var o=this.parser=new window.DOMParser,r=this.oldHTML="",i=this.oldDoc=o.parseFromString(r,"text/html");i.domNode=document,["documentElement","head","body"].forEach(function(e){i[e].domNode=document[e]}),this.update=c.throttle(this.updateNow.bind(this),this.throttle)}return babelHelpers.inherits(n,e),n.prototype.updateNow=function(){var e=new t,o=this.oldHTML;clearTimeout(this.intervalTimeout),this.intervalTimeout=setTimeout(this.update,this.interval),e.start();var r=this.render();e.end("render");var n=[],i=0;if(r!==o){var d=this.oldDoc;e.start();var a=this.parser.parseFromString(r,"text/html");e.end("parse"),e.start(),l(a),e.end("prune"),e.start(),i=s(d,a,n),e.end("diff"),n.length>0&&(e.start(),this.applyDiffs(n),e.end("apply")),e.start(),this.fixNodeOrder(a),e.end("order"),this.oldDoc=a,this.oldHTML=r}e.finish(),this.publish("update",{nrDiffed:i,diffs:n,timer:e})},n.prototype.fixNodeOrder=function(e){var t,r,n,i=e.domNode,d=e.childNodes,a=d.length;for(t=a-1;t>0;t--)r=d[t].domNode,n=d[t-1].domNode,r.parentNode===n.parentNode&&r.compareDocumentPosition(n)&Node.DOCUMENT_POSITION_FOLLOWING&&o(i).insertBefore(n,r);for(t=0;t<a;t++)this.fixNodeOrder(d[t])},n.prototype.applyDiffs=function(e){var t,n,i=e.length;for(t=0;t<i;t++){n=e[t];var d=n,a=d.action,s=d.node,l=d.name,u=d.value;if("add"===a){var h=document.importNode(s,!0);r(s,h);var f=s.nextSibling,c=f&&f.domNode;c?o(s.parentNode.domNode).insertBefore(h,c):o(s.parentNode.domNode).appendChild(h),this.notifyNodeAdded(s)}else"remove"===a?(this.notifyNodeRemove(s),o(s.parentNode.domNode).removeChild(s.domNode)):"text"===a?s.data=n.data:"set-attr"===a?(s=o(s),this.onAttrSet(s,l,u,n.oldValue),s.setAttribute(l,u)):"remove-attr"===a?(s=o(s),this.onAttrRemove(s,l,u),s.removeAttribute(l)):"add-class"===a?o(s).classList.add(l):"remove-class"===a&&o(s).classList.remove(l)}},n.prototype.notifyNodeAdded=function(e){if(e.nodeType===u){var t=e.domNode;this.onNodeAdded(t);var o,r,n,i=e.attributes||[];for(o=0,r=i.length;o<r;o++)n=i[o],this.onAttrSet(t,n.name,n.value);var d=e.childNodes;for(o=0,r=d.length;o<r;o++)this.notifyNodeAdded(d[o])}},n.prototype.notifyNodeRemove=function(e){if(e.nodeType!==u)return 0;var t,o,r,n=e.domNode,i=e.attributes||[];for(t=0,o=i.length;t<o;t++)r=i[t],this.onAttrRemove(n,r.name,r.value);this.onNodeRemove(n);var d=e.childNodes;for(t=0,o=d.length;t<o;t++)this.notifyNodeRemove(d[t])},n.prototype.dispose=function(){clearTimeout(this.intervalTimeout),e.prototype.dispose.call(this)},n}(e)});
"use strict";playtotv.define("playtotv.native.NativeController",["playtotv.mvc.Controller"],function(e){var t=playtotv,o=t.REQUIRED,n=t.util,r=t.Logger.get(this.id),s=1;return function(e){function a(t){var o=this;babelHelpers.classCallCheck(this,a),e.call(this,t),this.addMethods(["getGatekeeper","getWrapper","sendMessage","sendCommand","popup","browser","overlay","dialog","isTwitterAvailable","tweet","fbLogin","fbLogout","fbGraph","fbShare","loadAudio","playAudio","stopAudio"]),this.wrapperPromise=this.when("Event.BridgeReady").then(this.onWrapper.bind(this)),this.gatekeeperPromise=this.when("Event.GatekeeperReady").then(this.onGatekeeper.bind(this)),this.subscribe("Event.BackButton",this.onBackButton.bind(this)),this.subscribe("Event.PushEnabled",this.onPushEnabled.bind(this)),this.model.subscribe("change:pushEnabled",this.onPushEnabledChange.bind(this));var n=window.nativeWrapper;if(n?(this.publish("Event.BridgeReady"),this.sendMessage({type:"Event",subject:"AppReady"})):n=window.nativeWrapper={},n.onMessage)throw new Error("onMessage handler already defined");n.onMessage=this.onMessage.bind(this),this.scope.pauseDog.add(1e4,function(){return o.publish("Event.AppResume",{})})}return babelHelpers.inherits(a,e),a.prototype.onMessage=function(e){var t=e.type||"Event",o=e.subject,n=t+"."+o;"CommandResult"===t&&(n+="."+e.commandId),this.publish(n,e)},a.prototype.sendMessage=function(e){return t.params(e,{type:o,subject:o,commandId:-1,payload:{}}),this.wrapperPromise.then(function(t){return t.sendMessage(e)})},a.prototype.sendCommand=function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],o=!(arguments.length<=2||void 0===arguments[2])&&arguments[2],n=s++,a=this.when("CommandResult."+e+"."+n).then(function(t){var n=t.error;if(n){if(o&&"UnsupportedCommand"===n.code)return r.i("Using UnsupportedCommand fallback for: "+e),"function"==typeof o?o():o;throw Object.assign(new Error(n.message||e+" rejected: "+n.code),n)}return t.payload||{}});return this.sendMessage({type:"Command",subject:e,commandId:n,payload:t}),a},a.prototype.onWrapper=function(){var e=window.nativeWrapper;return this.model.copyProperties(t.omit(e,["sendMessage","onMessage","gatekeeperResponse","gatekeeperTimestamp"])),e.gatekeeperResponse&&this.publish("Event.GatekeeperReady",{payload:t.pick(e,["gatekeeperResponse","gatekeeperTimestamp"])}),e},a.prototype.onGatekeeper=function(e){var t=e.payload;return{url:window.nativeWrapper.serverUrl,gatekeeperData:t.gatekeeperResponse,gatekeeperDataTime:t.gatekeeperTimestamp}},a.prototype.onBackButton=function(){var e=this;return window.location.hash==="#"+this.scope.router.root?this.dialog({message:"Are you sure you want to close "+this.model.name+"?",buttons:["YES","NO"]}).then(function(t){"YES"===t.pressed&&e.sendCommand("Close")}):void this.scope.back()},a.prototype.onPushEnabled=function(e){this.set("pushEnabled",e.payload.value)},a.prototype.onPushEnabledChange=function(e){var t=this;this.sendCommand("SetPushEnabled",{value:e}).catch(function(){t.set("pushEnabled",!1)})},a.prototype.getWrapper=function(){return this.wrapperPromise},a.prototype.getGatekeeper=function(){return this.gatekeeperPromise},a.prototype.dialog=function(e){return e=t.params(e,{title:this.model.name,message:"",buttons:["OK"]}),this.sendCommand("OpenDialog",e)},a.prototype.popup=function(e,t){return"overlay"===t?this.overlay(e):this.browser(e)},a.prototype.browser=function(e){return this.sendCommand("BrowserOpen",{url:e})},a.prototype.overlay=function(e){return this.sendCommand("OverlayOpen",{url:e})},a.prototype.itunes=function(e,o){var n=t.params(o,{affiliate:void 0}),r=n.affiliate;window.location="https://itunes.apple.com/dummy/id"+e+r?"?at="+r:""},a.prototype.isTwitterAvailable=function(){return this.sendCommand("IsTwitterAccountAvailable",{}).then(function(e){return e.available})},a.prototype.tweet=function(e){var t=n.addURLParams("https://twitter.com/intent/tweet",e);n.popup(t,"tweet",{width:550,height:420})},a.prototype.fbLogin=function(e){return e=t.params(e,{interactive:!1,permissions:[]}),"string"==typeof e.permissions&&(e.permissions=e.permissions.split(/\s*,\s*/)),this.sendCommand("FacebookLogin",e)},a.prototype.fbLogout=function(){return this.sendCommand("FacebookLogout")},a.prototype.fbGraph=function(e){var t=arguments.length<=1||void 0===arguments[1]?"get":arguments[1],o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];return this.sendCommand("FacebookGraphRequest",{path:e,parameters:o,httpMethod:t})},a.prototype.fbShare=function(e){e=t.params(e,{title:"",description:"",url:o,image:null});var n={contentTitle:e.title,contentDescription:e.description,contentURL:e.url};return e.image&&(n.imageURL=e.image),this.sendCommand("FacebookShare",n)},a.prototype.loadAudio=function(e){return this.sendCommand("LoadAudio",{url:e})},a.prototype.playAudio=function(e){return this.sendCommand("PlayAudio",{url:e})},a.prototype.stopAudio=function(e){return this.sendCommand("StopAudio",{url:e})},a}(e)});
"use strict";playtotv.define("playtotv.net.jsonp",[],function(){var t=0,e=this.id,o=function o(r,n,i){n=n||{},i=i||2e4;var a=Promise.defer(),l="cb"+(t+=1);n.callback=e+"."+l;var c,u=playtotv.util.addURLParams(r,n);return o[l]=function(t){a.resolve(t),delete o[l],clearTimeout(c)},playtotv.loadScript(u).then(function(t){playtotv.dom.remove(t)}),c=setTimeout(function(){a.reject(new Error("Timeout")),delete o[l]},i),a.promise};return o});
"use strict";playtotv.define("playtotv.net.xhrProxy",[],function(){function e(t){l="object"==typeof t.data,d.removeListener(window,"message",e)}function t(e){var t=s.create("iframe",{src:e});return Object.assign(t.style,{width:0,height:0,visibility:"hidden",overflow:"hidden",position:"absolute",display:"none"}),t}function n(e){var n=c[e];if(n)return n.promise;i.d("getWindow(): "+e);var a=c[e]=Promise.defer(),r=!1;a.promise.then(function(){r=!0});var o=e+"/xhr-proxy.html",u=t(o);return d.addListener(u,"load",function(){setTimeout(function(){r||(c[e]=null,s.remove(u),a.reject(new Error("Failed to initialize: "+o)))},1e3)}),s.appendTo(u,document.body),a.promise}function a(e,t,n){var a=p[n];if(a){var r=a._batch;if(0!==r.length){r.indexOf(h)>=0&&(delete p[n],r.length>1&&(r=[h]));var o={id:n,rpcs:r};t.postMessage(l?o:JSON.stringify(o),e),a._batch=[]}}}function r(e,t,n){var a=p[e];if(!a)throw new Error("xhr undefined: "+e);a._batch.push("abort"===t?h:{method:t,args:[].slice.call(n,0)}),a._execBatch()}function o(e,t){var n=p[e],a=t?n.upload:n;a._eventListenersMap={},a.addEventListener=function(n,o){var i=a._eventListenersMap[n];i||(i=a._eventListenersMap[n]=[],r(e,"addEventListener",[t,n])),i.push(o)}}if("undefined"!=typeof window){var i=playtotv.Logger.get(this.id),s=playtotv.dom,d=playtotv.event,u=["open","setRequestHeader","send","abort"],c={},p={},f=0,l=!1,h={method:"abort",args:[]};return d.addListener(window,"message",e),window.postMessage({},"*"),d.addListener(window,"message",function(e){var t=c[e.origin];if(t){var n="string"==typeof e.data?JSON.parse(e.data):e.data,a=n.type,r=p[n.id],o="onMessage: "+e.origin+": "+a;if((e.stopImmediatePropagation||e.stopPropagation).call(e),"initialized"===a)i.s(o),t.resolve({win:e.source});else if(r)if("event"===a){var s=n.upload,d=n.event,u=d.type;i.s(o+": "+(s?"upload: ":"")+u+": "+d.loaded);var f=s?r.upload:r,l=f._eventListenersMap[u];l.forEach(function(e){e(d)})}else"readyStateChange"===a?(r.status=n.status,r.responseText=n.responseText,r._readyStateChange(n.readyState)):i.w(o+": unsupported type");else i.d(o+": xhr: "+n.id+" is undefined")}}),{create:function(e){var t=f++,i=p[t]={_batch:[],_readyStateChange:function(e){i.readyState=e,i.onreadystatechange&&i.onreadystatechange(),4===e&&delete p[t]},_execBatch:playtotv.unstack(function(){n(e).then(function(n){a(e,n.win,t)},function(e){i.status="no-xhr-proxy",i.reason=e,i._readyStateChange(4)})}),upload:{},onreadystatechange:null,readyState:0,status:0,responseText:""};return u.forEach(function(e){i[e]=function(){r(t,e,arguments)}}),o(t,!1),o(t,!0),i},debug:{deferredWindows:c,xhrs:p}}}});
"use strict";playtotv.define("playtotv.net.request",["playtotv.net.xhrProxy"],function(e){var t=playtotv,r=t.Logger.get(this.id),a=t.util,n=function n(o,s){function i(e){if(!c){m&&clearTimeout(m);var t=l.responseText;if("json"===s.dataType)try{t=t?JSON.parse(t):{}}catch(e){}if(e>=200&&e<300||[304,1223].indexOf(e)!==-1)p.resolve(t);else{var r=new Error(t&&t.error&&t.error.message||"Request "+s.label+" failed with status "+e);p.reject(Object.assign(r,{label:s.label,status:e,xhr:l,data:t}))}c=!0}}var u=a.getOrigin(),d=a.getOrigin(o);s=t.params(s,{label:(s&&s.type||"GET")+" "+o,type:"GET",urlParams:{},headers:{},username:void 0,password:void 0,data:{},onProgressDown:void 0,onProgressUp:void 0,dataType:"text",xhrProxy:d!==u,cache:!0,timeout:0});var l,p=Promise.defer(),c=!1,m=null;r.s(s.label),l=s.xhrProxy?e.create(d):new XMLHttpRequest;var v="onload"in l,f="onerror"in l,g="onabort"in l,y="ontimeout"in l;o=a.addURLParams(o,s.urlParams),s.cache||(o=a.addURLParam(o,"nocache",Date.now())),l.open(s.type,o,!0,s.username,s.password),v?l.addEventListener("load",function(){i(l.status)},!1):l.onreadystatechange=function(){4===l.readyState&&i(l.status)},f&&l.addEventListener("error",function(){i(l.status)},!1),g&&l.addEventListener("abort",function(){i("abort")},!1),s.timeout&&(y?(l.addEventListener("timeout",function(){i("timeout")},!1),l.timeout=s.timeout):m=setTimeout(function(){i("timeout"),l.abort()},s.timeout));var h=s.onProgressDown;h&&l.addEventListener("progress",function(e){e.lengthComputable&&h(e)},!1);var P=s.onProgressUp;return P&&l.upload.addEventListener("progress",function(e){e.lengthComputable&&P(e)},!1),t.each(s.headers,function(e,t){l.setRequestHeader(t,e)}),"PUT"===s.type||"POST"===s.type?(l.setRequestHeader("Content-type","application/json"),l.send(JSON.stringify(s.data))):l.send(),n.taps.forEach(function(e){e(o,s.label,p.promise)}),p.promise};return n.taps=[],n});
"use strict";playtotv.define("playtotv.analytics.AnalyticsController",["playtotv.analytics.AnalyticsWidget","playtotv.analytics.ComScoreAnalytics","playtotv.analytics.GoogleAnalytics","playtotv.mvc.Controller","playtotv.net.request"],function(t,e,o,i,r){var n=playtotv,a=n.util,s=n.event,l=new n.Logger(this.id);return function(i){function c(r,a){babelHelpers.classCallCheck(this,c),a=n.params(a,{privateGoogle:{name:"private",id:"UA-20746434-1",fields:{sampleRate:1}},googles:[],comScore:null}),i.call(this,r),this.addMethods(["privateTime","privateError","privateEvent","view","event","setFields"]),this.addWidget("track",t);var l=this.privateGoogle=new o(a.privateGoogle),p=this.googles=[l];a.googles.forEach(function(t){t.id&&p.push(new o(t))});var v=a.comScore;v&&v.url&&(this.comScore=new e(v)),s.addWindowOnError(this.privateError.bind(this)),this.hookRequestTap()}return babelHelpers.inherits(c,i),c.prototype.hookRequestTap=function(){var t=this;r.taps.push(function(e,o,i){var r=e.replace(/.nocache=\d+/,"");a.getURLParams(e).timeout||t.privateTime(i,"request",o,{timingLabel:r}),i.catch(function(e){t.privateEvent("request","reject "+o+" "+e.status,{eventLabel:r,nonInteraction:!0})})})},c.prototype.privateTime=function(t,e,o,i){return this.privateGoogle.time(t,e,o,i)},c.prototype.privateError=function(t,e,o){return this.privateGoogle.sendError(t,e,o)},c.prototype.privateEvent=function(t,e,o){return this.privateGoogle.sendEvent(t,e,o)},c.prototype.view=function(t,e){l.d("view: "+t,e),this.lastView=t,this.googles.forEach(function(o){return o.sendView(t,e)}),this.udm(t)},c.prototype.event=function(t,e,o){l.d("event: "+t+", "+e,o),this.googles.forEach(function(i){return i.sendEvent(t,e,o)});var i=o&&o.eventLabel;this.udm(t+"."+e+(i?"."+i:""),{type:"hidden"})},c.prototype.setFields=function(t){this.googles.forEach(function(e){return e.setFields(t)})},c.prototype.udm=function(t,e){var o=this.comScore;o&&o.udm(t,e)},c}(i)});
"use strict";playtotv.define("playtotv.native.MockNativeController",["playtotv.facebook.Facebook","playtotv.native.NativeController","playtotv.net.request"],function(e,o,t){function a(e,o,t){var a=e.match(o);return a&&a[t||0]}var n=playtotv,i=n.dom,r=n.util,s=n.Logger.get(this.id);return function(o){function c(a,i){var r=this;babelHelpers.classCallCheck(this,c),n.params(i,{serverUrl:n.REQUIRED,facebook:null});var s=i.serverUrl;o.call(this,a),this.audioNodeMap={},i.facebook&&(this.facebook=new e(i.facebook));var d=window.nativeWrapper;Object.assign(d,this.getDevice(),{name:document.title,version:"1.0-mock",capabilities:[],pushEnabled:!1,serverUrl:s,sendMessage:this.sendMessage.bind(this)}),this.publish("Event.BridgeReady");var p=(/\/\//.test(s)?"":"//")+s,u="mock"===s?Promise.resolve({serverTime:Date.now(),status:"AVAILABLE",services:[]}):t(p+"/api/1/gatekeeper/init",{dataType:"json",cache:!1});u.then(function(e){e={gatekeeperResponse:e,gatekeeperTimestamp:Date.now()},Object.assign(d,e),r.mockMessage({type:"Event",subject:"GatekeeperReady",payload:e})}),this.initLoading()}return babelHelpers.inherits(c,o),c.prototype.initLoading=function(){var e=i.create("div",{className:"native-loading"},{text:"Loading..",appendTo:document.body});Object.assign(e.style,{position:"absolute",top:0,left:0,bottom:0,right:0,background:"rgba(255, 255, 255, 0.9)",color:"#000","text-align":"center","padding-top":"150px","z-index":99999}),this.loadingNode=e},c.prototype.getDevice=function(){var e=navigator.userAgent;return Object.assign({deviceName:"Mock Device",deviceModel:e},/android/i.test(e)?{os:"Android",osVersion:a(e,/android ([\d\.]+)/i,1)||"4.4"}:/ip(ad|hone)/i.test(e)?{os:"iOS",osVersion:a(e,/OS (\d)_\d/,1)||"8"}:{os:"Browser",osVersion:"1.0"})},c.prototype.mockMessage=function(e){Promise.resolve().then(function(){return window.nativeWrapper.onMessage(e)})},c.prototype.sendMessage=function(e){var o=this;if("Command"===e.type){var t=e.subject,a=this["onCommand"+t],n={type:"CommandResult",subject:t,commandId:e.commandId};a?Promise.resolve(a.call(this,e.payload)).then(function(e){o.mockMessage(Object.assign(n,{payload:e}))},function(e){o.mockMessage(Object.assign(n,{error:e}))}):s.w("No mock for: "+t,e.payload)}return Promise.resolve()},c.prototype.popup=function(e,o,t){var a=n.params(t,{width:0,height:0}),i=a.width,s=a.height;return r.popup(e,o,{width:i,height:s})},c.prototype.onCommandHideLoading=function(){i.remove(this.loadingNode)},c.prototype.onCommandOpenDialog=function(e){var o=e.buttons,t=e.title+"\n"+e.message+"\n["+o.join("], [")+"]",a=o.length>1?window.confirm(t):window.alert(t)||!0;return{pressed:o[a?0:1]}},c.prototype.onCommandSetPushEnabled=function(e){return e.value&&Math.random()>.8?Promise.reject({}):{}},c.prototype.onCommandIsTwitterAccountAvailable=function(){return this.wrapperPromise.then(function(e){return{available:"iOS"===e.os}})},c.prototype.onCommandFacebookLogin=function(e){var o=this;return this.facebook?this.facebook.login(e.interactive).then(function(){return{token:o.facebook.accessToken}}):{token:"mock-facebook-token"}},c.prototype.onCommandFacebookLogout=function(){if(this.facebook)return this.facebook.logout()},c.prototype.onCommandFacebookGraphRequest=function(e){if(this.facebook)return this.facebook.api(5e3,e.path,e.httpMethod,e.parameters);var o=e.path,t={data:[{name:"Peter Ex Machina",id:"100002151356216"}],paging:{next:""},summary:{total_count:1}};return{me:{id:"mock-facebook-id",permissions:{data:[{permission:"public_profile",status:"granted"},{permission:"user_friends",status:"granted"}]},first_name:"Peter Paul",last_name:"Ex Machina",name:"Peter Paul Ex Machina",picture:{data:{url:"//graph.facebook.com/100001721575332/picture"}},friends:t},"me/friends":t}[o]||Promise.reject(new Error("No mock response for FacebookGraphRequest path: "+o))},c.prototype.onCommandFacebookShare=function(e){var o={link:e.contentURL,name:e.contentTitle,description:e.contentDescription,picture:e.imageURL};return Object.keys(o).forEach(function(e){o[e]||delete o[e]}),this.facebook?this.facebook.postByDialog(o):void(window.location=r.addURLParams("https://www.facebook.com/dialog/feed",Object.assign({app_id:"160288680666821",redirect_uri:window.location.href},o)))},c.prototype.onCommandLoadAudio=function(e){var o=e.url,t=document.createElement("audio");t.src=o,t.load(),this.audioNodeMap[o]=t},c.prototype.onCommandPlayAudio=function(e){var o=e.url,t=this.audioNodeMap[o];t.play()},c.prototype.onCommandStopAudio=function(e){var o=e.url,t=this.audioNodeMap[o];t.stop()},c}(o)});
"use strict";playtotv.define("playtotv.push.PushController",["playtotv.mvc.Controller"],function(t){var e=playtotv,s=e.Logger.get(this.id),o={getEvents:{label:"pushPoll.getEvents",type:"GET",url:"1/events",queryKeys:["stream","timeout"]}};return function(t){function n(s,o){babelHelpers.classCallCheck(this,n),o=e.params(o,{pollTimeout:1e4}),t.call(this,s),this.pollTimeout=o.pollTimeout,this.scope.observe("user.online",this.start.bind(this))}return babelHelpers.inherits(n,t),n.prototype.start=function(t){!this.hasStarted&&t&&(this.poll(),this.hasStarted=!0)},n.prototype.poll=function(){var t=this;this.disposed||this.getEvents().then(function(e){e.forEach(function(e){return t.publish(e.subject+"-"+e.action,e)})}).catch(function(t){return s.i("poll: getEvents rejected, delaying next poll",t),Promise.delay(5e3)}).then(function(){return t.poll()})},n.prototype.getEvents=function(){var t=this,e=this.model,s=e.stream,n=this.pollTimeout;return this.scope.call("server.call",o.getEvents,{stream:s,timeout:n},{timeout:2e4+n}).then(function(e){return t.set("stream",e.stream),e.events})},n.prototype.serialize=function(){return!1},n}(t)});
"use strict";playtotv.define("playtotv.question.questionAPI",[],function(){return{getParticipantAnswers:{label:"question.getParticipantAnswers",url:"1/question/episodesession/{episodeSessionId}/stats"},getQuestion:{label:"question.getQuestion",url:"1/question/questions/{questionId}/episodesession/{episodeSessionId}"},getQuestionStats:{label:"question.getQuestionStats",url:"1/question/questions/{questionId}/episodesession/{episodeSessionId}/stats"},submitAnswer:{label:"question.submitAnswer",url:"1/question/questions/{questionId}/episodesession/{episodeSessionId}/answer",type:"PUT",dataKeys:["answerCodes","clientAnswerTime"]}}});
"use strict";playtotv.define("playtotv.question.QuestionController",["playtotv.mvc.Controller","playtotv.question.questionAPI"],function(t,e){var n=playtotv;return function(t){function s(e){babelHelpers.classCallCheck(this,s),t.call(this,e),this.addMethods(["submitAnswer","decorateAnswers"])}return babelHelpers.inherits(s,t),s.prototype.submitAnswer=function(t,s,i){var r=this;i=n.params(i,{delay:0});var o=t+"-"+s;return this.submitting=o,this.publish("submitting",this.submitting),Promise.delay(i.delay).then(function(){return r.scope.call("episode.submitInteraction",e.submitAnswer,t,{questionId:t,answerCodes:[s],clientAnswerTime:!0}).finally(function(){r.submitting===o&&delete r.submitting})})},s.prototype.decorateAnswers=function(t){var e=this,n=t.stats,s=t.data,i=n&&n.answers||[],r=s&&s.submittedAnswers||[];return t.content.answers.map(function(n){var s=n.code,o=i.find(function(t){return t.code===s});return Object.assign({question:t,submitting:e.submitting===t.id+"-"+s,submitted:r.indexOf(s)>=0},n,o)})},s}(t)});
"use strict";playtotv.define("playtotv.rating.ratingAPI",[],function(){return{getRating:{label:"rating.getRating",url:"1/rating/ratings/{ratingId}/episodesession/{episodeSessionId}"},getRatingStats:{label:"rating.getRatingStats",url:"1/rating/ratings/{ratingId}/episodesession/{episodeSessionId}/stats"},submitRating:{label:"rating.submitRating",url:"1/rating/ratings/{ratingId}/episodesession/{episodeSessionId}/answer",type:"PUT",dataKeys:["values"]}}});
"use strict";playtotv.define("playtotv.rating.RatingInputWidget",["playtotv.widget.Widget"],function(t){var e=playtotv,i=e.REQUIRED;return function(t){function n(s,a){babelHelpers.classCallCheck(this,n),e.params(a,{app:null,controller:i,id:i,code:i}),t.call(this,s),Object.assign(this,a),this.addEventListener(s,"change",this.onChange.bind(this))}return babelHelpers.inherits(n,t),n.prototype.onChange=function(){this.controller.submit(this.id,this.code,this.node.value)},n}(t)});
"use strict";playtotv.define("playtotv.rating.RatingController",["playtotv.mvc.Controller","playtotv.rating.ratingAPI","playtotv.rating.RatingInputWidget"],function(t,e,n){var a=10;return function(t){function r(e){babelHelpers.classCallCheck(this,r),t.call(this,e),this.addMethods(["submit","decorateSubjects"]),this.addWidgets([["input",n]])}return babelHelpers.inherits(r,t),r.prototype.submit=function(t,n,r){var i={};return i[n]=Math.round(r*a),this.scope.call("episode.submitInteraction",e.submitRating,t,{ratingId:t,values:i},function(t){return t=t||{},t[n]=r,t})},r.prototype.decorateSubjects=function(t){var e=t.stats,n=e&&e.values||[],r=t.data||{};return t.content.subjects.map(function(e){var i=e.code,o=n.find(function(t){return t.code===i});return Object.assign({rating:t,submitted:r[i],average:o&&o.value/a},e)})},r}(t)});
"use strict";playtotv.define("playtotv.relation.RelationSubscription",["playtotv.pubsub.Subscription"],function(e){var t=playtotv.util;return function(e){function i(r,n){babelHelpers.classCallCheck(this,i);var s="string"==typeof r;s&&(r=new RegExp("(\\s|^)("+t.escapeRegEx(r).replace(/\\\*/g,"\\S*?")+")(\\s|$)")),e.call(this,r,n),s&&(this.regexIndex=2)}return babelHelpers.inherits(i,e),i.prototype.deliver=function(e,t){if(this.handler){var i=this.regexIndex;void 0!==i&&(t=this.selector.exec(t)[i]),this.handler(e,t)}},i}(e)});
"use strict";playtotv.define("playtotv.relation.RelationManager",["playtotv.pubsub.PubSub","playtotv.relation.RelationSubscription"],function(t,e){var i=playtotv,n=i.dom,o=i.event;return function(i){function s(t){babelHelpers.classCallCheck(this,s),t=t||document,i.call(this),this.node=t,this.onClick=this.onClick.bind(this),o.addListener(t,"click",this.onClick)}return babelHelpers.inherits(s,i),s.prototype.subscribe=function(t,i){var n=new e(t,i);return this.subscriptions.push(n),n},s.prototype.onClick=function(t){var e=n.closest("a[rel]",t.target),i=e?e.rel:null;i&&(t.preventDefault(),this.publish(i,e,!0))},s.prototype.dispose=function(){o.removeListener(this.node,"click",this.onClick),t.prototype.dispose.call(this)},s}(t)});
"use strict";playtotv.define("playtotv.score.scoreAPI",[],function(){return{getCurrentLeaderboardPage:{label:"score.getCurrentLeaderboardPage",url:"1/score/show/{showId}/leaderboard",queryKeys:["pageIndex","pageSize"]},getCurrentLeaderboardPageForInterval:{label:"score.getCurrentLeaderboardPageForInterval",url:"1/score/show/{showId}/{interval}/leaderboard",queryKeys:["pageIndex","pageSize"]},getEpisodeLeaderboardPage:{label:"score.getEpisodeLeaderboardPage",url:"1/score/episodesession/{episodeSessionId}/leaderboard",queryKeys:["pageIndex","pageSize"]},getEpisodeScores:{label:"score.getEpisodeScores",url:"1/score/episodesession/{episodeSessionId}",queryKeys:["userIds","facebookIds","callId"]},getLeaderboardPageForInterval:{label:"score.getLeaderboardPageForInterval",url:"1/score/show/{showId}/time/{interval}/{year}/{subIntervalIndex}/leaderboard",queryKeys:["pageIndex","pageSize"]},getTimeSpanScores:{label:"score.getTimeSpanScores",url:"1/score/show/{showId}/time/{interval}/{year}/{subIntervalIndex}",queryKeys:["userIds","facebookIds","callId"]}}});
"use strict";playtotv.define("playtotv.server.gatekeeperAPI",[],function(){return{getInit:{label:"gatekeeper.getInit",url:"1/gatekeeper/init"}}});
"use strict";playtotv.define("playtotv.storage.MockStorage",[],function(){return function(){function t(){babelHelpers.classCallCheck(this,t),this.length=0,this._container={}}return t.prototype.key=function(t){return Object.keys(this._container)[t]},t.prototype.getItem=function(t){return Object.keys(this._container).indexOf(t)===-1?null:this._container[t]},t.prototype.setItem=function(t,e){this._container[t]=e,this._updateLength()},t.prototype.removeItem=function(t){delete this._container[t],this._updateLength()},t.prototype.clear=function(){this.length=0,this._container={}},t.prototype._updateLength=function(){this.length=Object.keys(this._container).length},t}()});
"use strict";playtotv.define("playtotv.storage.Storage",["playtotv.storage.MockStorage"],function(t){var e=playtotv.Logger.get(this.id);return function(){function o(e,r){babelHelpers.classCallCheck(this,o),this.storage=e||window.localStorage||new t,this.prefix=r||""}return o.prototype.get=function(t,e){var o=this.storage.getItem(this.prefix+t);if(null===o||void 0===o)return e;try{o=JSON.parse(o)}catch(t){}return o},o.prototype.set=function(t,e,o){if(o=o||this.quotaHandler,null===e||void 0===e)this.remove(t);else try{this.storage.setItem(this.prefix+t,JSON.stringify(e))}catch(r){if(!(r instanceof window.DOMException&&r.code===r.QUOTA_EXCEEDED_ERR))throw r;o.call(this,r,t,e)}},o.prototype.quotaHandler=function(t,o,r){e.e("Caught quota exception: "+t.name+", while setting: "+o,r,t)},o.prototype.remove=function(t){this.storage.removeItem(this.prefix+t)},o.prototype.clear=function(){for(var t=this.storage,e=0;e<t.length;){var o=t.key(e);0===o.indexOf(this.prefix)?t.removeItem(o):e++}},o.prototype.subStorage=function(t){return new o(this.storage,this.prefix+t)},o}()});
"use strict";playtotv.define("playtotv.storage.AsyncStorage",["playtotv.storage.Storage"],function(t){function r(t,r,e){return e=e||[],o.s(r,e),new Promise(function(n,o){t.transaction(function(t){t.executeSql(r,e,function(t,r){n(r)},function(t,r){o(r)})},o)})}var e=playtotv,n=this.id,o=e.Logger.get(n),i="keyvaluepairs";return function(){function e(a){babelHelpers.classCallCheck(this,e),this.prefix=a||"",this.ready=Promise.resolve().then(function(){var t=openDatabase(n,"1.0","",4980736),e="CREATE TABLE IF NOT EXISTS "+i+" (id INTEGER PRIMARY KEY, key unique, value)";return r(t,e).then(function(){return{db:t}})}).catch(function(r){return o.d("Falling back to localStorage",r),{storage:new t(window.localStorage,a)}})}return e.prototype.get=function(t,e){var n=this.prefix;return this.ready.then(function(o){var a=o.db;if(!a)return o.storage.get(t,e);var u="SELECT * FROM "+i+" WHERE key = ? LIMIT 1";return r(a,u,[n+t]).then(function(t){var r=t.rows;return r.length?JSON.parse(r.item(0).value):e})})},e.prototype.set=function(t,e){if(null===e||void 0===e)return this.remove(t);var n=this.prefix;return this.ready.then(function(o){var a=o.db;if(!a)return o.storage.set(t,e,function(t){throw new Error("Quota error: "+t.name)});var u="INSERT OR REPLACE INTO "+i+" (key, value) VALUES (?, ?)";return r(a,u,[n+t,JSON.stringify(e)])})},e.prototype.remove=function(t){var e=this.prefix;return this.ready.then(function(n){var o=n.db;return o?r(o,"DELETE FROM "+i+" WHERE key = ?",[e+t]):n.storage.remove(t)})},e.prototype.clear=function(){var t=this.prefix;return this.ready.then(function(e){var n=e.db;return n?r(n,"DELETE FROM "+i+' WHERE key LIKE "'+t+'%"'):e.storage.clear()})},e.prototype.subStorage=function(t){return new this.constructor(this.prefix+t)},e.prototype.sql=function(t,e){return this.ready.then(function(n){return r(n.db,t,e)})},e}()});
"use strict";playtotv.define("playtotv.storage.MockAsyncStorage",["playtotv.storage.AsyncStorage","playtotv.storage.MockStorage","playtotv.storage.Storage"],function(t,e,o){return function(t){function a(r){babelHelpers.classCallCheck(this,a),t.call(this,r),this.ready=Promise.resolve({storage:new o(new e,r)})}return babelHelpers.inherits(a,t),a}(t)});
"use strict";playtotv.define("playtotv.server.Server",["playtotv.server.gatekeeperAPI","playtotv.model.ObjectModel","playtotv.net.request","playtotv.storage.Storage"],function(e,t,r,i){var s=playtotv,n=s.REQUIRED,a=s.util,o=s.Logger.get(this.id),l=s.event,h=e.getInit;return h.gatekeeper=!0,function(e){function u(r){babelHelpers.classCallCheck(this,u),e.call(this,{urls:new t({}),status:void 0,timeOffset:void 0,clientMinimalVersion:{}}),r=s.params(r,{url:"",badDelay:5e3,onRetry:function(e,t){o.d("Retry: "+e+" ("+t+")")},gatekeeperData:void 0,gatekeeperDataTime:void 0});var n=r.url;n.length>0&&/^localhost|.+\..+/.test(n)&&n.indexOf("//")===-1&&(n="//"+n),this.badDelay=r.badDelay,this.onRetry=r.onRetry,this.serverUrl=n,this.serviceUrls={},this.urlPromises={},this.gatekeeperUrl=this.getGatekeeperServiceUrl(h.service||"API")+h.url,this.gatekeeperData=r.gatekeeperData,this.gatekeeperDataTime=r.gatekeeperDataTime,this.settings={cache:!1,dataType:"json",timeout:2e4,headers:{},urlParams:{}},this.retryDelay=5e3,this.resolveTaps=[],this.rejectTaps=[],this.storage=new i(window.localStorage,n+"/"),l.addListener(window,"offline",function(){o.d("Event: offline"),this.setStatus("BAD")}.bind(this)),l.addListener(window,"online",function(){o.d("Event: online"),this.setStatus("GOOD")}.bind(this)),this.setStatus=function(){function e(){t&&(t.changeProperty("status","BAD"),t=null)}var t=!1;return function(r){"BAD"===r?t||(t=this,setTimeout(e,this.badDelay)):(t=!1,this.changeProperty("status",r))}}(),this._getServiceUrls=this._getServiceUrls.bind(this),this.getServiceUrls=Promise.throttle(this._getServiceUrls,2e3),this.getServiceUrl("API")}return babelHelpers.inherits(u,e),u.prototype.urlKeys=function(e){var t=e.match(/\{(\w+)\}/g)||[];return t.map(function(e){return e.substr(1,e.length-2)})},u.prototype.validateCall=function(e,t,r){r=r||this.urlKeys(e.url);var i=e.label,s=e.dataKeys,n=Object.keys(t||{}),a=r.concat(e.queryKeys).concat(s),o=[];if(n.forEach(function(e){a.indexOf(e)===-1&&o.push(e)}),o.length>0)throw new Error(i+": invalid parameters: "+o.join(", "));var l=r.concat(s),h=[];if(l.forEach(function(e){void 0===t[e]&&h.push(e)}),h.length>0)throw new Error(i+": required parameters are undefined: "+h.join(", "))},u.prototype._getServiceUrls=function(){var e,t=this.gatekeeperData,r=this.gatekeeperDataTime;return t&&r?(t.serverTime+=Date.now()-r,e=Promise.resolve(t),delete this.gatekeeperData,delete this.gatekeeperDataTime):e=this.call(h),e.then(function(e){return e.status&&"AVAILABLE"!==e.status?(this.setStatus("BUSY"),this.onRetry(this.gatekeeperUrl,"busy-"+e.status.toLowerCase()),Promise.delay(this.retryDelay).then(this._getServiceUrls)):(this.setStatus("GOOD"),this.changeProperty("timeOffset",Date.now()-e.serverTime),this.changeProperty("clientMinimalVersion",e.clientMinimalVersion),e.services.reduce(function(e,t){return e[t.serviceType]=s.shuffle(t.serviceUrls.map(function(e){return e.replace(/\d+\/$/,"")})),e}.bind(this),{}))}.bind(this),function(e){return o.i("getServiceUrls: retry: "+e.status),this.setStatus("BAD"),this.onRetry(this.gatekeeperUrl,"status-"+e.status),Promise.delay(this.retryDelay).then(this._getServiceUrls)}.bind(this))},u.prototype.getGatekeeperServiceUrl=function(e){return this.serverUrl+"/"+e.toLowerCase()+"/"},u.prototype.getServiceUrl=function(e){var t=this.urlPromises;if(!t[e]){var r=this.serviceUrls,i=r[e]||[];i.length>0?t[e]=Promise.resolve(i.shift()):t[e]=this.getServiceUrls().then(function(t){s.each(t,function(e,t){r[t]=e});var i=t[e]||[];return 0===i.length?this.getGatekeeperServiceUrl(e):r[e].shift()}.bind(this))}return t[e]},u.prototype.invalidateServiceUrl=function(e,t){var r=this.urlPromises;r[e]===t&&(r[e]=null)},u.prototype.request=function(e,t,i){i=i||function(){return this.request(e,t,i)}.bind(this);var s=Object.assign({},this.settings,t);return r(e,s).then(function(e){return t.label===h.label&&e.status&&"AVAILABLE"!==e.status?e:(this.setStatus("GOOD"),e)}.bind(this),function(t){var r=t.status;return 0===r||"no-xhr-proxy"===r||r>12e3&&r<13e3?(this.onRetry(e,"status-"+r),this.setStatus("BAD"),Promise.delay(this.retryDelay).then(i)):503===r?(this.onRetry(e,"status-"+r),Promise.delay(this.retryDelay).then(i)):"timeout"===r?(this.onRetry(e,"timeout"),this.setStatus("BAD"),i()):Promise.reject(t)}.bind(this))},u.prototype.getUrlAndRequest=function(e,t,r){var i=this.getServiceUrl(e);return i.then(function(s){return this.urls.setProperty(e,s),this.request(s+t,r,function(){return this.invalidateServiceUrl(e,i),this.getUrlAndRequest(e,t,r)}.bind(this))}.bind(this))},u.prototype.tap=function(e,t){return t.then(function(t){this.resolveTaps.forEach(function(r){r.call(e,t)})}.bind(this),function(t){this.rejectTaps.forEach(function(r){r.call(e,t)})}.bind(this)),t},u.prototype.call=function(e,t,r){s.params(e,{label:void 0,service:"API",gatekeeper:!1,type:"GET",url:n,queryKeys:[],dataKeys:[]}),t=t||{},r=Object.assign({label:e.label,type:e.type},r);var i=e.url,o=this.urlKeys(i);this.validateCall(e,t,o),o.forEach(function(e){i=i.replace("{"+e+"}",encodeURIComponent(t[e]))}),e.queryKeys.forEach(function(e){void 0!==t[e]&&(i=a.addURLParam(i,e,t[e]))});var l=e.dataKeys;l.length>0&&(r.data={},l.forEach(function(e){r.data[e]=t[e]}));var h=e.service;if(e.gatekeeper){var u=this.getGatekeeperServiceUrl(h)+i;return this.tap(e,this.request(u,r))}return this.tap(e,this.getUrlAndRequest(h,i,r))},u.prototype.toClientTime=function(e){return e+this.timeOffset},u.prototype.toServerTime=function(e){return e=e||Date.now(),e-this.timeOffset},u.prototype.log=function(e,t,r,i){var s=this.call(e,t,r);return o.log(i||"DEBUG",[e.label,t,s]),s},u}(t)});
"use strict";playtotv.define("playtotv.server.ServerController",["playtotv.mvc.Controller","playtotv.server.Server"],function(e,t){var s=0;return function(e){function r(t,s){var n=this;babelHelpers.classCallCheck(this,r),e.call(this,t);var a=this.getServer(s),l=["status","timeOffset","clientMinimalVersion"];l.forEach(function(e){a.subscribe("change:"+e,function(t){return n.set(e,t)})}),a.urls.subscribe("*:API",function(e){return n.set("url",e)});var c=["call","toClientTime","toServerTime","log"];c.forEach(function(e){n[e]=a[e].bind(a),n.addMethod(e)}),this.rejectTaps=a.rejectTaps,this.addMethods(["addRejectTap","callAsync"]),this.asyncCalls=[],t.scope.subscribe("push.ASYNC-RESPONSE",this.onAsyncResponse.bind(this))}return babelHelpers.inherits(r,e),r.prototype.getServer=function(e){return new t(e)},r.prototype.addRejectTap=function(e,t){t=t||function(){return!0},this.rejectTaps.push(function(s){var r=this;t(s,r)&&e(s,r)})},r.prototype.callAsync=function(e,t,r){var n=this;return new Promise(function(a,l){var c=""+ ++s;n.call(e,t,Object.assign({},r,{urlParams:{callId:c}})).catch(l),n.asyncCalls.push({callId:c,label:e.label,resolve:a,reject:l})})},r.prototype.onAsyncResponse=function(e){var t=e.payload,s=t.callId,r=this.asyncCalls,n=r.find(function(e){return e.callId===s});if(n){r.splice(r.indexOf(n),1);var a=t.responseStatus,l=t.responseBody;if(a>=200&&a<300||304===a)n.resolve(l);else{var c=new Error("Async call "+n.label+" failed with status "+a);n.reject(Object.assign(c,{label:n.label,status:a,xhr:null,data:l}))}}},r}(e)});
"use strict";playtotv.define("playtotv.server.MockServer",["playtotv.server.gatekeeperAPI","playtotv.server.Server","playtotv.net.request"],function(e,t,r){return function(t){function a(r){babelHelpers.classCallCheck(this,a),r=playtotv.params(r,{mocks:{},base:"mock",value:{isDefaultValue:!0},render:null}),t.call(this);var s=this.mockMap=r.mocks;this.baseUrl=r.base,this.defaultValue=r.value,this.render=r.render;var l=e.getInit.label,n="pushPoll.getEvents";s[l]=s[l]||this.mockGatekeeper,s[n]=s[n]||this.mockPushPoll}return babelHelpers.inherits(a,t),a.prototype.call=function(e,t,a){playtotv.params(e,{label:void 0,service:"API",gatekeeper:!1,type:"GET",url:playtotv.REQUIRED,queryKeys:[],dataKeys:[]}),t=t||{},a=Object.assign({label:e.label,type:e.type},a),this.validateCall(e,t);var s=e.label||e.url.replace(/[\{\}]/g,"_")+(e.type?"/"+e.type:""),l=this.mockMap[s];if(l)return l instanceof Function&&(l=l(e,t,a)),this.tap(e,Promise.resolve(l).then(function(e){return"string"==typeof e?this.call({label:e},t,a):e}.bind(this)));var n=this.baseUrl+"/"+s+".json",i=this.render;return this.tap(e,r(n).then(function(r){var a=Object.assign({method:e},t),s=i?i(r,a):r;return JSON.parse(s)},function(){return this.defaultValue}.bind(this)))},a.prototype.mockGatekeeper=function(){return{serverTime:Date.now(),status:"AVAILABLE",services:[]}},a.prototype.mockPushPoll=function(){return Promise.delay(1e4).then(function(){return{stream:"mock-stream",events:[]}})},a}(t)});
"use strict";playtotv.define("playtotv.server.MockServerController",["playtotv.server.ServerController","playtotv.server.MockServer"],function(e,r){return function(e){function t(){babelHelpers.classCallCheck(this,t),e.apply(this,arguments)}return babelHelpers.inherits(t,e),t.prototype.getServer=function(){return this.server||(this.server=new r)},t.prototype.callAsync=function(){return this.call.apply(this,arguments)},t}(e)});
"use strict";playtotv.define("playtotv.touch.Sequence",["playtotv.css.Vector"],function(t){var e=Math.max,i=300,s=20;return function(){function n(e,i){babelHelpers.classCallCheck(this,n),this.target=e,this.id=i.pointerId||i.identifier,this.start=new t(i.clientX,i.clientY),this.screen=new t(i.screenX,i.screenY),this.point=this.start,this.offset=t.ZERO,this.velocity=t.ZERO,this.time=Date.now(),this.isTap=!0}return n.prototype.update=function(n){var h=this,c=Date.now(),o=new t(n.clientX,n.clientY),r=new t(n.screenX,n.screenY),a=this.start,p=this.point,l=c-this.time,u=1e3/e(l,40);this.velocity=new t((o.x-p.x)*u,(o.y-p.y)*u),this.offset=new t(o.x-a.x,o.y-a.y),this.isTap&&this.offset.magnitude()>s&&(delete this.isTap,this.isSwipe=setTimeout(function(){return h.clearSwipe()},i)),this.time=c,this.point=o,this.screen=r},n.prototype.clearSwipe=function(){clearTimeout(this.isSwipe),delete this.isSwipe},n}()});
"use strict";playtotv.define("playtotv.touch.Tracker",["playtotv.touch.Sequence"],function(t){var r=[].map;return function(){function e(){babelHelpers.classCallCheck(this,e),this.map={}}return e.prototype.add=function(e,n){return r.call(e,function(r){var e=r.pointerId||r.identifier,i=this.map[e]=new t(n,r);return i},this)},e.prototype.update=function(t){return r.call(t,function(t){var r=t.pointerId||t.identifier,e=this.map[r];return e.update(t),e},this)},e.prototype.remove=function(t){return r.call(t,function(t){var r=t.pointerId||t.identifier,e=this.map[r];return delete this.map[r],e},this)},e.prototype.toArray=function(){var t=[],r=this.map;for(var e in r)r.hasOwnProperty(e)&&t.push(r[e]);return t},e.prototype.empty=function(){var t=this.map;for(var r in t)if(t.hasOwnProperty(r))return!1;return!0},e}()});
"use strict";playtotv.define("playtotv.touch.TouchProxy",["playtotv.touch.Tracker"],function(t){function e(t){if(!(s||a&&0!==c))return!1;var e=navigator.userAgent,n=/Windows Phone/.test(e),i=/iP(hone|ad|od)/.test(e)&&!n;if(i)return!0;var o=/Android/.test(e)&&!n,r=/Chrome\/([0-9]+)/.test(e),h=/Firefox\/([0-9]+)/.test(e);if(r&&o||h){var u=$("meta[name=viewport]");if(u&&/user-scalable=no/.test(u.content))return!1}var p=t.currentStyle||t.style,v=p?p.touchAction||p.msTouchAction:null;return!v||!/none|manipulation/.test(v)}var n=playtotv,i=n.event,o=/input|textarea|select|option/i,r=500,s="ontouchstart"in window,a="onpointerdown"in window,c=navigator.maxTouchPoints||navigator.msMaxTouchPoints||0;return function(){function c(o,r){babelHelpers.classCallCheck(this,c),r=n.params(r,{fastClick:!0,preventNative:!0,propagateNative:!1}),n.bindMethods(this,["touchStart","touchMove","touchEnd"]),this.node=o,this.fastClick=r.fastClick&&e(o),this.preventNative=r.preventNative,this.propagateNative=r.propagateNative,this.startEvent=a?"pointerdown":s?"touchstart":"mousedown",this.moveEvent=a?"pointermove":s?"touchmove":"mousemove",this.endEvent=a?"pointerup":s?"touchend":"mouseup",this.tracker=new t,i.addListener(o,this.startEvent,this.touchStart)}return c.prototype.touchStart=function(t){var e=t.target;if(!o.test(e.nodeName)){var n,i=this.getChangedTouches(t),r=this.tracker.add(i,e),s=!1,a=r.length;for(n=0;n<a;n++)this.dispatchEvent("em:touchstart",r[n],t)===!1&&(s=!0);this.preventNative&&s&&t.preventDefault(),this.propagateNative||t.stopPropagation(),this.tracking||this.bindEvents()}},c.prototype.touchMove=function(t){var e,n=this.getChangedTouches(t),i=this.tracker.update(n),o=!1,r=i.length;for(e=0;e<r;e++)this.dispatchEvent("em:touchmove",i[e],t)===!1&&(o=!0);this.preventNative&&o&&t.preventDefault(),this.propagateNative||t.stopPropagation()},c.prototype.touchEnd=function(t){var e,n,o=this.getChangedTouches(t),r=this.tracker.remove(o),s=this.preventNative,a=!1,c=r.length;for(n=0;n<c;n++){if(e=r[n],this.dispatchEvent("em:touchend",e,t)===!1&&(a=!0),e.isTap&&this.fastClick){var h=new i.MouseEvent("click",{bubbles:!0,cancelable:!0,clientX:e.point.x,clientY:e.point.y,screenX:e.screen.x,screenY:e.screen.y});h.isFastClick=!0,e.target.dispatchEvent(h),this.preventNextClick(e.point)}e.isSwipe&&this.dispatchEvent("em:swipe",e,t)}s&&a&&t.preventDefault(),this.propagateNative||t.stopPropagation(),this.tracker.empty()&&this.unbindEvents()},c.prototype.dispatchEvent=function(t,e,n){return i.dispatchEvent(e.target,t,!0,!0,{proxy:this,sequence:e,nativeEvent:n})},c.prototype.bindEvents=function(){this.tracking||(i.addListener(document,this.moveEvent,this.touchMove),i.addListener(document,this.endEvent,this.touchEnd),this.tracking=!0)},c.prototype.unbindEvents=function(){this.tracking&&(i.removeListener(document,this.moveEvent,this.touchMove),i.removeListener(document,this.endEvent,this.touchEnd),this.tracking=!1)},c.prototype.getTouches=function(t){return t.touches||[t]},c.prototype.getChangedTouches=function(t){return t.changedTouches||[t]},c.prototype.getSequence=function(t){return this.tracker.map[t]},c.prototype.getSequences=function(){return this.tracker.toArray()},c.prototype.preventNextClick=function(t){var e=function(e){var n=e.clientX-t.x,i=e.clientY-t.y;!e.isFastClick&&Math.sqrt(n*n+i*i)<20&&(e.preventDefault(),e.stopPropagation())},n=this.node;n.addEventListener("click",e,!0),setTimeout(function(){n.removeEventListener("click",e,!0)},r)},c.prototype.dispose=function(){this.unbindEvents(),i.removeListener(this.node,this.startEvent,this.touchStart),delete this.node},c}()});
"use strict";playtotv.define("playtotv.touch.touchManager",["playtotv.css.Vector","playtotv.touch.TouchProxy"],function(t,e){var r=playtotv.dom,a="TouchEnabled",o={proxies:[],captureEvents:function(t,o){if(o=playtotv.params(o,{fastClick:!0,preventNative:!0,propagateNative:!1}),this.isCaptured(t))throw new Error("Node or ascendant is already captured by playtotv.touch");if(o.fastClick&&!o.preventNative)throw new Error("Ambiguous options: preventNative (false) is overruled by fastClick (true)");r.setData(t,a,!0);var i=new e(t,o);return this.proxies.push(i),i},releaseEvents:function(t){var e,o,i=this.proxies.length;for(e=0;e<i;e++)if(o=this.proxies[e],o.node===t)return r.removeData(t,a),this.proxies.splice(e,1),o.dispose(),!0;return!1},isCaptured:function(t){for(;t;){if(r.getData(t,a))return!0;t=t.parentNode}return!1},getAngle:function(t){var e=t.velocity;return Math.atan2(e.y,e.x)},getOrientation:function(e){var r=e.velocity;return Math.abs(r.x)>Math.abs(r.y)?t.HORIZONTAL:t.VERTICAL},getDirection:function(e){var r=e.velocity;return this.getOrientation(e)===t.HORIZONTAL?r.x>0?t.RIGHT:t.LEFT:r.y>0?t.DOWN:t.UP}};return o});
"use strict";playtotv.define("playtotv.mvc.App",["playtotv.model.modelUtil","playtotv.mvc.BindWidget","playtotv.mvc.Controller","playtotv.mvc.helpers","playtotv.mvc.Router","playtotv.mvc.UpdateWidget","playtotv.mvc.View","playtotv.storage.AsyncStorage","playtotv.storage.MockAsyncStorage","playtotv.touch.touchManager","playtotv.PauseDog"],function(t,e,o,r,i,n,s,a,p,u,c){var d=playtotv,h=d.util,l=d.event,v=Promise.Cancellable;return function(o){function f(t){var i=this;babelHelpers.classCallCheck(this,f);var s=window.Handlebars;s&&(t.templates=t.templates||s.templates,s.registerHelper(r)),d.params(t,{id:d.REQUIRED,templates:d.REQUIRED,store:{},log:{},storage:{},router:{},touch:{},view:{},reloadTime:144e5}),o.call(this,{name:"app",app:null,store:t.store}),this.app=this,this.id=t.id,this.templates=t.templates,this.logEnabled=this.constructLog(t.log),this.storage=this.constructStorage(t.storage),this.router=this.constructRouter(t.router),this.touchCaptured=this.constructTouch(t.touch),this.view=this.constructView(t.view),this.pauseDog=this.constructPauseDog(t.reloadTime),this.widgetMap={},this.widgets=[],this.scriptListeners=[],l.addWindowOnError(this.onError.bind(this)),l.addListener(window,"beforeUnload",function(){return i.dispose()}),this.setWidgets([["bind",e],["update",n]]),this.ready=this.storage.get("app").catch(function(){}).then(function(t){i.deserialize(t),i.subscribe("*",d.debounce(function(){return i.flush("app")},500))})}return babelHelpers.inherits(f,o),f.prototype.constructLog=function(){var t=this,e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return!!e&&(this.logger=d.Logger.get(this.id),d.each({error:"ERROR","view.slow":"WARNING","view.update":"DEBUG","view.diffs.*":"SPAM","*":"DEBUG"},function(t,o){e.hasOwnProperty(o)||(e[o]=t)}),this.logRules=Object.keys(e).map(function(t){return{selector:t.indexOf("*")>=0?h.globToRegEx(t):t,level:e[t]}}),this.subscribe("*",function(e,o){return t.log(o,e)}),!0)},f.prototype.constructStorage=function(t){var e=t.mock,o=e?p:a;return new o(this.id+".")},f.prototype.constructRouter=function(t){var e=this,o=new i(Object.assign({patterns:Object.keys(this.templates)},t));return o.subscribe("*",function(t,o){e.publish("route:"+o,t)}),o},f.prototype.constructTouch=function(t){return!!t&&(u.captureEvents(document,t),!0)},f.prototype.constructView=function(t){var e=this,o=d.params(t,{throttle:100,interval:1e4,isSlow:100}),r=o.throttle,i=o.interval,n=o.isSlow,a=new s({render:function(){return""+e.templates[e.router.pattern](e)},throttle:r,interval:i,onNodeAdded:this.onNodeAdded.bind(this),onNodeRemove:this.onNodeRemove.bind(this),onAttrSet:this.onAttrSet.bind(this),onAttrRemove:this.onAttrRemove.bind(this)});return a.subscribe("update",function(t){var o=t.timer,r=o.total,i=o.string,s=t.diffs;e.log("view."+(r>n?"slow":"update"),i),s.length>0&&e.log("view.diffs."+s.length,s)}),a},f.prototype.constructPauseDog=function(t){var e=this,o=new c;return o.add(t,function(){return e.reload()}),o},f.prototype.startView=function(){this.view.update(),this.subscribe("*",this.view.update)},f.prototype.addController=function(t,e,o){var r=this;return this.ready.then(function(){return r.storage.get(t).catch(function(){}).then(function(i){if(r[t])throw new Error("Controller name not available: "+t);var n=new e({name:t,app:r,stored:i},o);r[t]=n;var s=d.debounce(function(){return r.flush(t)},500);return n.subscribe("*",function(e,o){r.publish(t+"."+o,e),s()}),r.publish(t,n),n})})},f.prototype.addControllers=function(t){var e=this;return Promise.all(t.map(function(t){return e.addController.apply(e,t)}))},f.prototype.getController=function(t){var e=arguments.length<=1||void 0===arguments[1]?1e4:arguments[1],o=this[t];if(o)return v.resolve(o);var r=this.when(t);return e&&r.setTimeout(e),r},f.prototype.log=function(e){var o=arguments.length<=1||void 0===arguments[1]?null:arguments[1];if(this.logEnabled){var r=this.logRules.find(function(t){var o=t.selector;return"string"==typeof o?o===e:o.test(e)}),i=r&&r.level;if(i){o&&o.toObject&&(o=t.toObject(o));var n="object"==typeof o?[e,o]:[e+": "+o];return this.logger.log(i,n),i}}},f.prototype.flush=function(t){return this.storage.set(t,this[t].serialize())},f.prototype.set=function(t,e,r){var i=h.getPathHead(t),n=h.getPathTail(t);n?this[i].set(n,e,r):o.prototype.set.call(this,t,e,r)},f.prototype.setWidget=function(t,e){var o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];o.app=this,this.widgetMap[t]={WidgetClass:e,options:o}},f.prototype.instantiateWidget=function(t,e,o){var r=this.widgetMap[e];if(!r)throw new Error("Widget not found: "+e);var i=Object.assign({},r.options,o),n=new r.WidgetClass(t,i);return this.widgets.push({node:t,name:e,instance:n}),n},f.prototype.disposeWidgets=function(t,e){this.widgets=this.widgets.filter(function(o){return!(!t||o[t]===e)||(o.instance.dispose(),!1)})},f.prototype.setNodeWidgets=function(t,e,o){var r=this;o&&this.disposeWidgets("node",t),e=0===e.indexOf('[["')?JSON.parse(e):e.split(/\s+/).map(function(t){return[t,{}]}),e.forEach(function(e){var o=e[0],i=e[1];r.instantiateWidget(t,o,i)})},f.prototype.runScript=function(t,e,o){var r=this,i=new Promise(function(o){var i;if(0===t.indexOf('["')){var n=JSON.parse(t);t=n[0],i=n[1]}e=Object.assign({},r,i,e),o(h.eval(t,e))});return o?i:void i.catch(function(t){return r.onError(t)})},f.prototype.setNodeScript=function(t,e,o){var r=this,i=this.scriptListeners,n=i.find(function(o){return o.node===t&&o.type===e});n&&(l.removeListener(n),i.splice(i.indexOf(n),1)),o&&"node-added"!==e&&"node-remove"!==e&&(n=l.addListener(t,e,function(e){r.runScript(o,{node:t,event:e})}),i.push(n))},f.prototype.onNodeAdded=function(t){var e=t.getAttribute("on-node-added");e&&this.runScript(e,{node:t})},f.prototype.onNodeRemove=function(t){var e=t.getAttribute("on-node-remove");e&&this.runScript(e,{node:t})},f.prototype.onAttrSet=function(t,e,o,r){"widgets"===e?this.setNodeWidgets(t,o,r):0===e.indexOf("on-")&&this.setNodeScript(t,e.substr(3),o)},f.prototype.onAttrRemove=function(t,e){"widgets"===e?this.disposeWidgets("node",t):0===e.indexOf("on-")&&this.setNodeScript(t,e.substr(3),"")},f.prototype.open=function(t,e,o){return e?this.popup(t,e,o):void(window.location=t)},f.prototype.openify=function(t,e){var o=d.params(e,{target:""}),r=o.target;return t&&t.replace(/<a /g,"<a on-click=\"event.preventDefault(); app.open(node.href, '"+r+"')\" ")},f.prototype.popup=function(t,e,o){var r=d.params(o,{width:0,height:0}),i=r.width,n=r.height;return h.popup(t,e,{width:i,height:n})},f.prototype.back=function(){window.history.go(-1)},f.prototype.reload=function(){window.location.reload(!0)},f.prototype.reset=function(){var t=this;this.storage.clear().finally(function(){return t.reload()})},f.prototype.onError=function(t){var e=this.error;e&&t.name===e.name&&t.message===e.message||this.set("error",t,{json:!1})},f.prototype.clearError=function(){this.error&&(delete this.error,this.publish("error-cleared"))},f.prototype.dispose=function(){this.disposeWidgets(),this.pauseDog.dispose(),this.view.dispose(),this.touchCaptured&&u.releaseEvents(document),this.router.dispose(),o.prototype.dispose.call(this)},f}(o)});
"use strict";playtotv.define("playtotv.twitter.twitterAPI",[],function(){return{getRecentTweets:{label:"twitter.getRecentTweets",url:"1/twitter/recent"}}});
"use strict";playtotv.define("playtotv.twitter.TwitterController",["playtotv.mvc.Controller","playtotv.twitter.twitterAPI"],function(t,e){var n=playtotv,r=n.util;return function(t){function s(r,i){var a=this;babelHelpers.classCallCheck(this,s),i=n.params(i,{maxItems:25});var o=r.stored||{};t.call(this,r,{model:{tweets:o.tweets||[]}}),this.addMethods(["getTweetParts","intent"]),this.maxItems=i.maxItems,this.scope.call("server.call",e.getRecentTweets,{}).then(function(t){a.cap(t),a.set("tweets",t),a.scope.subscribe("push.TWITTER-POST",function(t){return a.addTweet(t.payload)})})}return babelHelpers.inherits(s,t),s.prototype.cap=function(t){t.length=Math.min(t.length,this.maxItems)},s.prototype.addTweet=function(t){var e=this.model.tweets;e.unshift(t),this.cap(e)},s.prototype.getTweetParts=function(t){var e=[{type:"url",regex:new RegExp(r.URL_REGEXP.source)},{type:"mention",regex:/@(\w+)/},{type:"hash",regex:/#(\w+)/}].reduce(function(e,n){var r=n.regex.exec(t);return r&&("text"===e.type||r.index<e.index)?{index:r.index,type:n.type,text:r[0],match:r[1]}:e},{index:0,type:"text",text:t}),n=[e],s=e.index;s>0&&n.unshift({type:"text",text:t.substr(0,s)});var i=t.substr(s+e.text.length);return i?n.concat(this.getTweetParts(i)):n},s.prototype.intent=function(t,e){var n=r.addURLParams("https://twitter.com/intent/"+t,e);this.scope.open(n,"twitter-intent",{width:550,height:420})},s}(t)});
"use strict";playtotv.define("playtotv.user.User",["playtotv.model.ObjectModel"],function(e){var r=playtotv;return function(t){function i(s,a){babelHelpers.classCallCheck(this,i),r.params(a,{id:r.REQUIRED,displayName:void 0,avatarUrl:void 0,profileProperties:{}}),t.call(this,{id:a.id,displayName:a.displayName,avatarUrl:a.avatarUrl,profileProperties:new e(a.profileProperties)}),this.server=s}return babelHelpers.inherits(i,t),i.prototype.dispose=function(){this.profileProperties.dispose(),e.prototype.dispose.call(this)},i}(e)});
"use strict";playtotv.define("playtotv.user.usersAPI",[],function(){return{addEmailCredentials:{label:"users.addEmailCredentials",url:"1/users/credentials/email",type:"POST",dataKeys:["email","password"]},addExternalIdCredentials:{label:"users.addExternalIdCredentials",url:"1/users/credentials/type/{type}",type:"POST",dataKeys:["externalId","signature"]},addFacebookCredentials:{label:"users.addFacebookCredentials",url:"1/users/credentials/facebook",type:"POST",dataKeys:["facebookId","fbsr"]},changePassword:{label:"users.changePassword",url:"1/users/credentials/changepassword",type:"POST",dataKeys:["oldPassword","newPassword"]},generatePassword:{label:"users.generatePassword",url:"1/users/credentials/generatepassword/email/{email}",type:"PUT"},getLoginCredentialStatus:{label:"users.getLoginCredentialStatus",url:"1/users/loginCredentialStatus"},getPrivateProperty:{label:"users.getPrivateProperty",url:"1/users/profile/{propertyName}/private"},getProfile:{label:"users.getProfile",url:"1/users/profile",queryKeys:["userId"]},getProfileProperty:{label:"users.getProfileProperty",url:"1/users/profile/{propertyName}",queryKeys:["userId"]},getUsers:{label:"users.getUsers",url:"1/users/",queryKeys:["userIds"]},loginByAuthenticationToken:{label:"users.loginByAuthenticationToken",url:"1/users/usersessions/authenticationToken",type:"POST",queryKeys:["runtimeId"],dataKeys:["authenticationToken"]},loginByEmail:{label:"users.loginByEmail",url:"1/users/usersessions/email",type:"POST",queryKeys:["runtimeId"],dataKeys:["email","password","rememberMe"]},loginByExternalId:{label:"users.loginByExternalId",url:"1/users/usersessions/externalId",type:"POST",queryKeys:["runtimeId"],dataKeys:["type","externalId","signature","displayName","avatarUrl","optionalValues"]},loginByFacebook:{label:"users.loginByFacebook",url:"1/users/usersessions/facebook",type:"POST",queryKeys:["runtimeId"],dataKeys:["facebookId","fbsr","displayName","avatarUrl","optionalValues"]},logout:{label:"users.logout",url:"1/users/usersessions/current",type:"DELETE",queryKeys:["runtimeId"]},logoutByPut:{label:"users.logoutByPut",url:"1/users/usersessions/current/logout",type:"PUT",queryKeys:["runtimeId"]},registerAsGuest:{label:"users.registerAsGuest",url:"1/users/register/guest",type:"POST",queryKeys:["runtimeId"],dataKeys:["optionalValues"]},registerByEmail:{label:"users.registerByEmail",url:"1/users/register/email",type:"POST",queryKeys:["runtimeId"],dataKeys:["displayName","avatarUrl","email","username","password","optionalValues"]},removeExternalId:{label:"users.removeExternalId",url:"1/users/credentials/type/{type}",type:"DELETE"},removeFacebookCredentials:{label:"users.removeFacebookCredentials",url:"1/users/credentials/facebook",type:"DELETE"},requestDeletion:{label:"users.requestDeletion",url:"1/users/",type:"POST",queryKeys:["runtimeId"]},requestEmailChange:{label:"users.requestEmailChange",url:"1/users/email/{email}",type:"PUT"},requestPasswordChange:{label:"users.requestPasswordChange",url:"1/users/credentials/changepassword/email/{email}",type:"PUT"},scheduleUserForDeletion:{label:"users.scheduleUserForDeletion",url:"1/users/scheduled",type:"POST",queryKeys:["runtimeId"],dataKeys:["reason"]},setPrivateProperty:{label:"users.setPrivateProperty",url:"1/users/profile/{propertyName}/private",type:"PUT",dataKeys:["value"]},setProfileProperty:{label:"users.setProfileProperty",url:"1/users/profile/{propertyName}",type:"PUT",dataKeys:["value"]},updateProfile:{label:"users.updateProfile",url:"1/users/profile",type:"PUT",dataKeys:["displayName","avatarUrl","properties","privateProperties"]},verifyEmail:{label:"users.verifyEmail",url:"1/users/verifyemail",type:"POST",dataKeys:["authenticationCode"]},verifyPasswordChange:{label:"users.verifyPasswordChange",url:"1/users/password",type:"PUT",dataKeys:["authenticationCode","password"]}}});
"use strict";playtotv.define("playtotv.user.LocalUser",["playtotv.model.ObjectModel","playtotv.user.User","playtotv.user.usersAPI"],function(e,t,i){var o=playtotv;return function(r){function s(t,i,a){babelHelpers.classCallCheck(this,s),a=o.params(a,{privateProperties:{},authenticationToken:void 0,pttvSession:void 0,email:void 0,username:void 0,facebookId:void 0}),r.call(this,t,i),this.storage=t.storage.subStorage("user/"+i.id+"/"),this.copyProperties({privateProperties:new e(a.privateProperties),authenticationToken:a.authenticationToken,pttvSession:a.pttvSession,email:a.email,username:a.username,facebookId:a.facebookId})}return babelHelpers.inherits(s,r),s.prototype.updateProfile=function(){return this.server.call(i.updateProfile,{displayName:this.displayName||null,avatarUrl:this.avatarUrl||null,properties:this.profileProperties.toObject(),privateProperties:this.privateProperties.toObject()})},s.prototype.dispose=function(){this.privateProperties.dispose(),t.prototype.dispose.call(this)},s}(t)});
"use strict";playtotv.define("playtotv.user.UserController",["playtotv.mvc.Controller","playtotv.user.usersAPI"],function(e,t){var r=playtotv,i=r.Logger.get(this.id);return function(e){function o(t){babelHelpers.classCallCheck(this,o);var r=t.stored||{};e.call(this,t,{model:{current:r.current||null,online:!1}}),this.addMethods(["logout","getPrivateProperty","setPrivateProperty","updateProfile","extendPrivateProfile"]),this.login()}return babelHelpers.inherits(o,e),o.prototype.loginBy=function(e,t){var r=this;return this.scope.call("server.call",e,t).then(function(e){return r.set("current",e),r.set("online",!0),e})},o.prototype.loginByToken=function(){var e=this.model.current,r=e&&e.authenticationToken;return r?this.loginBy(t.loginByAuthenticationToken,{authenticationToken:r}):Promise.reject()},o.prototype.registerAsGuest=function(){return this.loginBy(t.registerAsGuest,{optionalValues:null})},o.prototype.login=function(){var e=this;return this.loginByToken().catch(function(){return e.registerAsGuest().catch(function(t){return i.e("login(): registerAsGuest failed, retrying in 5s",t),Promise.delay(5e3).then(function(){return e.login()})})})},o.prototype.logout=function(){var e=this;return this.scope.call("server.call",t.logout).finally(function(){e.scope.reset()})},o.prototype.getPrivateProperty=function(e){var t=this.model.current;return t&&t.profile.privateProperties[e]},o.prototype.setPrivateProperty=function(e,r){var i=this,o=this.model.current;return this.scope.call("server.call",t.setPrivateProperty,{propertyName:e,value:r}).then(function(){o.profile.privateProperties[e]=r,i.publish("set-private-property-"+e,r)})},o.prototype.updateProfile=function(e){var i=this,o=this.model.current;return e=r.params(e,{displayName:o.displayName||null,avatarUrl:o.avatarUrl||null,properties:o.profile.profileProperties,privateProperties:o.profile.privateProperties}),this.scope.call("server.call",t.updateProfile,e).then(function(){o.displayName=e.displayName,o.avatarUrl=e.avatarUrl,o.profile.profileProperties=e.properties,o.profile.privateProperties=e.privateProperties,i.publish("update-profile",e)})},o.prototype.extendPrivateProfile=function(e){var t=this.model.current;return this.updateProfile({privateProperties:Object.assign({},t.profile.privateProperties,e)})},o}(e)});
"use strict";playtotv.define("playtotv.user.UserManager",["playtotv.pubsub.PubSub","playtotv.user.LocalUser","playtotv.user.usersAPI"],function(e,t,o){var i=playtotv,r=i.REQUIRED;return function(a){function s(e){babelHelpers.classCallCheck(this,s),a.call(this),this.baseParams={displayName:null,avatarUrl:null,runtimeId:void 0},this.optionalParams={teamTag:void 0,emailOptinMode:void 0,properties:void 0,privateProperties:void 0},this.server=e;var t=this.storage=e.storage;this.authenticationMethod=t.get("authenticationMethod"),this.authenticationToken=t.get("authenticationToken"),this.localUser=null,this.onServerReject=this.onServerReject.bind(this),e.rejectTaps.push(this.onServerReject)}return babelHelpers.inherits(s,a),s.prototype.saveAuthentication=function(e,t){this.authenticationMethod=e,this.storage.set("authenticationMethod",e),this.authenticationToken=t,this.storage.set("authenticationToken",t)},s.prototype.login=function(e,o,i){return this.server.call(e,o).then(function(o){var r=o.authenticationToken,a=o.profile||{},s=o.loginCredentialStatus||{};this.localUser&&this.onLogout();var n=new t(this.server,{id:o.userId,displayName:o.displayName,avatarUrl:o.avatarUrl,profileProperties:a.profileProperties},{privateProperties:a.privateProperties,authenticationToken:r,pttvSession:o.pttvSession,email:s.email,username:s.username,facebookId:s.facebookId});return this.localUser=n,i&&this.saveAuthentication(e.label,r),this.publish("login",n),n}.bind(this))},s.prototype.processParams=function(e){var t=Object.keys(this.optionalParams);return e.optionalValues=i.pick(e,t),i.omit(e,t)},s.prototype.registerAsGuest=function(e,t){return e=i.params(e,Object.assign({},this.baseParams,this.optionalParams)),e=this.processParams(e),this.login(o.registerAsGuest,e,t)},s.prototype.registerByEmail=function(e,t){return e=i.params(e,Object.assign({email:r,password:r,username:null},this.baseParams,this.optionalParams)),e=this.processParams(e),this.login(o.registerByEmail,e,t)},s.prototype.loginByEmail=function(e,t){return e=i.params(e,Object.assign({email:r,password:r,rememberMe:!1},this.baseParams)),this.login(o.loginByEmail,e,t)},s.prototype.loginByFacebook=function(e,t){return e=i.params(e,Object.assign({facebookId:r,fbsr:r},this.baseParams,this.optionalParams)),e=this.processParams(e),this.login(o.loginByFacebook,e,t)},s.prototype.addFacebookCredentials=function(e){e=i.params(e,{facebookId:r,fbsr:r});var t=this.localUser;return t?t.facebookId?Promise.reject(new Error("Local user already has Facebook Id")):this.server.call(o.addFacebookCredentials,e).then(function(){return t.changeProperty("facebookId",e.facebookId),t}):Promise.reject(new Error("Not logged in"))},s.prototype.removeFacebookCredentials=function(){var e=this.localUser;return e?e.facebookId?this.server.call(o.removeFacebookCredentials).then(function(){e.changeProperty("facebookId",void 0)}):Promise.reject(new Error("Local user does not have Facebook Id")):Promise.reject(new Error("Not logged in"))},s.prototype.loginByToken=function(e){return e=i.params(e,Object.assign({authenticationToken:this.authenticationToken},this.baseParams)),e.authenticationToken?this.login(o.loginByAuthenticationToken,e):Promise.reject(new Error("Missing required parameter: authenticationToken"))},s.prototype.logout=function(e){return e&&this.saveAuthentication(null,null),this.server.call(o.logout).then(function(){return this.onLogout()}.bind(this))},s.prototype.onLogout=function(){var e=this.localUser;return e&&(e.dispose(),this.localUser=null,this.publish("logout",e)),e},s.prototype.onExpire=function(){var e=this.localUser;this.authenticationMethod=null,this.authenticationToken=null,e&&(this.publish("expire",e),this.onLogout())},s.prototype.onServerReject=function(e){463===e.status&&this.onExpire()},s.prototype.dispose=function(){var t=this.server.rejectTaps;t.splice(t.indexOf(this.onServerReject),1);var o=this.localUser;o&&o.dispose(),e.prototype.dispose.call(this)},s}(e)});
"use strict";playtotv.define("playtotv.widget.CountdownWidget",["playtotv.widget.Widget"],function(t){var i=playtotv,e=i.util;return function(t){function s(e,h){babelHelpers.classCallCheck(this,s),i.params(h,{app:null,time:i.REQUIRED}),t.call(this,e),this.time=h.time,this.dd=$(".dd",e),this.hh=$(".hh",e),this.mm=$(".mm",e),this.ss=$(".ss",e),this.update()}return babelHelpers.inherits(s,t),s.prototype.update=function(){var t=this;if(this.node){var i=Math.max(0,this.time-Date.now())/1e3;this.updateDigit(this.dd,i/86400),this.updateDigit(this.hh,i%86400/3600),this.updateDigit(this.mm,i%3600/60),this.updateDigit(this.ss,i%60),setTimeout(function(){return t.update()},1e3)}},s.prototype.updateDigit=function(t,i){t&&(t.innerHTML=e.pad(Math.floor(i)))},s}(t)});
"use strict";playtotv.define("playtotv.widget.DraggableWidget",["playtotv.widget.Widget","playtotv.css.Vector","playtotv.fx.Transition","playtotv.animationFrame","playtotv.css.style","playtotv.touch.touchManager"],function(t,i,e,s,o,n){var r=playtotv,a=r.event,h=1,p=2,c="ontouchstart"in window;return function(d){function l(t,s){if(babelHelpers.classCallCheck(this,l),d.call(this,t),!n.isCaptured(t))throw new Error("Required events not captured via playtotv.touch");s=r.params(s,{orientation:i.VERTICAL,restrict:"inside",elastic:!1,inertia:!1,friction:50,priority:!1,handle:null}),this.start=i.ZERO,this.position=i.ZERO,this.transition=new e({callback:this.handleAnim,duration:1e3,easing:"cubicout"}),this.orientation=s.orientation,this.elastic=s.elastic,this.priority=s.priority,this.inertia=s.inertia,this.friction=s.friction,this.outside=!!/outside/i.test(s.restrict),this.limiter=new i(this.orientation===i.VERTICAL?0:1,this.orientation===i.HORIZONTAL?0:1),this.restricter=this.limiter.multiplyBy(.75);var o=s.handle;o&&(t=$(o,t)||t),r.bindMethods(this,["handleSwipe","handleFrame","handleAnim","dragStart","dragMove","dragEnd"]),this.addEventListener(t,"em:touchstart",this.dragStart),this.addEventListener(t,"em:touchmove",this.dragMove),this.addEventListener(t,"em:touchend",this.dragEnd),this.addEventListener(t,"em:swipe",this.handleSwipe),this.setup(),this.moveTo(this.start)}return babelHelpers.inherits(l,d),l.prototype.setup=function(){var t=this.node;this.content=o.getSize(t),this.view=o.getInnerSize(t.parentNode),this.space=this.view.subtract(this.content).multiply(this.limiter),this.min=this.space.min(i.ZERO),this.max=this.outside?i.ZERO:this.space.max(i.ZERO)},l.prototype.setState=function(t){this.state=t},l.prototype.getState=function(){return this.state},l.prototype.requestFrame=function(){this.request=s.request(this.handleFrame)},l.prototype.cancelFrame=function(){this.request&&(s.cancel(this.request),delete this.request)},l.prototype.dragStart=function(t){c||t.preventDefault(),this.touchId=t.detail.sequence.id,this.priority&&t.stopPropagation(),this.transition.playing&&(this.transition.stop(),this.setState(h)),this.start=this.position,this.lastOrientation=null,this.setup(),a.dispatchEvent(this.node,"em:dragstart",!1,!1,{offset:this.position})},l.prototype.dragMove=function(t){if(this.hasPriority(t)){t.preventDefault(),t.stopPropagation();var i=t.detail.sequence,e=this.start.add(i.offset),s=this.restrict(e,this.elastic);this.position=s,this.getState()!==p&&(this.setState(p),this.requestFrame())}},l.prototype.dragEnd=function(t){if(this.hasPriority(t))if(c||t.preventDefault(),t.stopPropagation(),delete this.touchId,this.inertia){var i=t.detail.sequence,e=i.velocity,s=Math.sqrt(e.magnitude())/this.friction,o=this.pulling?300:1e3*s;this.swipe(e.multiplyBy(s),o)}else this.handleStopped()},l.prototype.handleSwipe=function(t){this.hasPriority(t)&&t.stopPropagation()},l.prototype.hasPriority=function(t){var i=this.orientation,e=t.detail.sequence;return e.id===this.touchId&&(this.priority||!i||this.getOrientation(e)===i)},l.prototype.handleFrame=function(){this.moveTo(this.position),this.requestFrame()},l.prototype.handleStopped=function(){this.cancelFrame(),this.setState(h),a.dispatchEvent(this.node,"em:dragend",!1,!1,{offset:this.position})},l.prototype.moveTo=function(t){this.position=t,o.setTranslate(this.node,t),a.dispatchEvent(this.node,"em:dragmove",!1,!1,{offset:t})},l.prototype.moveBy=function(t){var i=this.position.add(t);this.moveTo(i)},l.prototype.moveIntoView=function(t,e){this.node.contains(t)&&(this.setup(),this.swipeTo(i.ZERO.subtract(o.getOffset(t)).add(o.getOffset(this.node)),e))},l.prototype.setRelative=function(t){this.moveTo(this.space.multiply(t))},l.prototype.getRelative=function(){var t=this.position,e=this.space;return new i(e.x?t.x/e.x:0,e.y?t.y/e.y:0)},l.prototype.getOrientation=function(t){return this.lastOrientation||(this.lastOrientation=n.getOrientation(t)),this.lastOrientation},l.prototype.getPosition=function(){return this.position},l.prototype.swipe=function(t,i){var e=this.position,s=this.restrict(e.add(t),!1);this.vector=s.subtract(e),this.start=e,this.cancelFrame(),this.transition.play({duration:i||1e3})},l.prototype.swipeTo=function(t,i){t=t.subtract(this.position),this.swipe(t,i)},l.prototype.handleAnim=function(t){var i=this.vector.multiplyBy(t);this.moveTo(this.start.add(i)),1===t&&this.handleStopped()},l.prototype.restrict=function(t,e){var s=this.limiter.multiply(t),o=this.min,n=this.max;if(e&&this.content.exceeds(this.view)){var r=s.x<o.x?s.x-o.x:s.x>n.x?s.x-n.x:0,a=s.y<o.y?s.y-o.y:s.y>n.y?s.y-n.y:0;this.pulling=!(!r&&!a);var h=this.restricter;return new i(s.x-r*h.x,s.y-a*h.y)}return s.limit(o,n)},l.prototype.dispose=function(){this.transition.playing&&this.transition.stop(),this.cancelFrame(),t.prototype.dispose.call(this)},l}(t)});
"use strict";playtotv.define("playtotv.widget.FormWidget",["playtotv.widget.Widget"],function(t){var e=playtotv,i=e.dom,r=e.event,a=function(){function t(i){babelHelpers.classCallCheck(this,t),i=e.params(i,{selector:e.REQUIRED,test:e.REQURIED,fallback:e.REQUIRED}),this.selector=i.selector,this.supported=i.test(),this.fallback=i.fallback}return t.prototype.validate=function(t){return!i.matches(this.selector,t)||(this.supported?t.checkValidity():this.fallback(t))},t}(),n=[{selector:"[required]",test:function(){var t=document.createElement("input");return t.setAttribute("required",!0),t.checkValidity&&t.checkValidity()===!1},fallback:function(t){if(/radio|check/i.test(t.type)){var e=t.form.elements[t.name];return e.length?Array.from(e).some(function(t){return t.checked}):t.checked}return!!t.value}},{selector:"[pattern]",test:function(){var t=document.createElement("input");return t.setAttribute("pattern","\\d+"),t.value="test",t.checkValidity&&t.checkValidity()===!1},fallback:function(t){return!t.value||new RegExp("^"+t.getAttribute("pattern")+"$").test(t.value)}},{selector:"[min],[max]",test:function(){var t=document.createElement("input");return t.setAttribute("type","number"),t.setAttribute("min",0),t.value=-1,"0"===t.value||t.checkValidity&&t.checkValidity()===!1},fallback:function(t){if(t.value){var e=parseFloat(t.value),i=t.getAttribute("min"),r=t.getAttribute("max");return!isNaN(e)&&(!i||e>=parseFloat(i))&&(!r||e<=parseFloat(r))}return!0}},{selector:"[type=date]",test:function(){var t=document.createElement("input");return t.setAttribute("type","date"),t.value="invalid",!t.value||t.checkValidity&&t.checkValidity()===!1},fallback:function(t){if(t.value){var e=Date.parse(t.value),i=t.getAttribute("min"),r=t.getAttribute("max");return!isNaN(e)&&(!i||e>=Date.parse(i))&&(!r||e<=Date.parse(r))}return!0}}];return function(t){function l(r,s){if(babelHelpers.classCallCheck(this,l),!i.matches("form",r))throw new Error("Form expected");s=e.params(s,{app:null,controller:null,highlight:"error",field:".field",preventNative:!0,validateChange:!0}),t.call(this,r),this.field=s.field,this.highlightClass=s.highlight,this.preventNative=s.preventNative,e.bindMethods(this,["onChange","onSubmit"]),this.addEventListener(r,"submit",this.onSubmit),s.validateChange&&this.addEventListener(r,"change",this.onChange),r.setAttribute("novalidate",!0),this.tests=n.map(function(t){return new a(t)})}return babelHelpers.inherits(l,t),l.prototype.onSubmit=function(t){var e=this;this.preventNative&&t.preventDefault();var i=this.validateForm();i.elements.forEach(function(t){e.highlight(t,!1)},this),i.errors.forEach(function(t){e.highlight(t,!0)},this),i.valid&&r.dispatchEvent(this.node,"submit-valid",!0,!0,{data:this.serialize(),validity:i,originalEvent:t})},l.prototype.onChange=function(t){var e=t.target,i=this.validateInput(e);this.highlight(e,!i)},l.prototype.highlight=function(t,e){var r=i.closest(this.field,t);r&&r.classList.toggle(this.highlightClass,e)},l.prototype.validateForm=function(){var t=this.getElements(),e=[];return t.forEach(function(t){this.validateInput(t)||e.push(t)},this),{elements:t,errors:e,valid:!e.length}},l.prototype.validateInput=function(t){var e=!t.checkValidity||t.checkValidity();return this.tests.forEach(function(i){e=e&&i.validate(t)}),e},l.prototype.getElements=function(){return Array.from(this.node.elements)},l.prototype.serialize=function(){var t=this.getElements(),e={};return t.forEach(function(t){var i=t.name,r=t.type,a=t.value;i&&(/check|radio/i.test(r)&&!t.checked||(a&&/number|range/i.test(r)&&(a=parseFloat(a)),"select-multiple"===r&&(a=Array.from(t.options).filter(function(t){return t.selected}).map(function(t){return t.value})),e[i]=a))}),e},l}(t)});
"use strict";playtotv.define("playtotv.widget.ScalableWidget",["playtotv.css.style","playtotv.widget.Widget"],function(e,t){return function(t){function s(e,i){var o=this;babelHelpers.classCallCheck(this,s),i=playtotv.params(i,{mode:"portrait",resize:!0}),t.call(this,e),this.mode=i.mode,this.resize=i.resize,this.addEventListener(window,"resize",playtotv.debounce(function(){return o.onResize()},100)),this.onResize()}return babelHelpers.inherits(s,t),s.prototype.onResize=function(){var e=this.node;if(e){var t=e.parentNode,s="landscape"===this.mode?t.offsetWidth/e.offsetWidth:t.offsetHeight/e.offsetHeight;this.setScale(s),this.resize&&this.sizeToScale()}},s.prototype.sizeToScale=function(){var t=this.node,s=t.parentNode,i="landscape"===this.mode,o=i?"height":"width",a=i?s.offsetHeight/this.scale:s.offsetWidth/this.scale;e.set(t,o,a+"px")},s.prototype.setScale=function(t){this.scale=t,e.setTransform(this.node,"scale("+t+")")},s.prototype.getScale=function(){return this.scale},s}(t)});
"use strict";playtotv.define("playtotv.widget.ScrollableWidget",["playtotv.widget.Widget","playtotv.widget.DraggableWidget","playtotv.css.Vector","playtotv.css.style"],function(t,e,i,s){var a=playtotv,o=a.dom;return function(t){function n(r,l){babelHelpers.classCallCheck(this,n),t.call(this,r),a.bindMethods(this,["handleStart","handleDrag","handleEnd"]),l=a.params(l,{orientation:i.VERTICAL,restrict:"outside",content:".content",thumbH:"thumb-horizontal",thumbV:"thumb-vertical",active:"scrolling",disabled:"disabled",elastic:!0,inertia:!0,friction:50,priority:!1,handle:null});var c=$(l.content,r);if(!c)throw new ReferenceError('Content node "'+l.content+'" expected');var h=s.get(r,"display");if(!/block/i.test(h))throw new Error('Display "block" or "inline-block" is required for scrollable nodes');var d=s.get(r,"overflow");if("hidden"!==d)throw new Error('Overflow "hidden" is required for scrollable nodes');this.content=c,this.activeClass=l.active,this.disabledClass=l.disabled;var p=l.orientation;this.pane=new e(c,{orientation:p,restrict:l.restrict,elastic:l.elastic,inertia:l.inertia,friction:l.friction,priority:l.priority,handle:l.handle}),!l.thumbH||p!==i.HORIZONTAL&&p!==i.FREE||(this.thumbH=o.create("span",{class:l.thumbH},{appendTo:r})),!l.thumbV||p!==i.VERTICAL&&p!==i.FREE||(this.thumbV=o.create("span",{class:l.thumbV},{appendTo:r})),this.addEventListener(c,"em:dragstart",this.handleStart),this.addEventListener(c,"em:dragmove",this.handleDrag),this.addEventListener(c,"em:dragend",this.handleEnd),this.updateThumbs()}return babelHelpers.inherits(n,t),n.prototype.updateThumbs=function(){var t=this.pane,e=t.getRelative(),a=t.position,o=t.min,n=t.view,r=t.content,l=n.divide(r.max(n)),c=this.disabledClass,h=a.max(o.subtract(a)).max(i.ZERO),d=n.multiply(l).subtract(h),p=n.subtract(d),u=e.multiply(p).limit(i.ZERO,p),g=this.thumbH;g&&(s.set(g,"width",d.x+"px"),s.setTranslate(g,u.x+"px, 0"),g.classList.toggle(c,l.x>=1));var b=this.thumbV;b&&(s.set(b,"height",d.y+"px"),s.setTranslate(b,"0, "+u.y+"px"),b.classList.toggle(c,l.y>=1))},n.prototype.toggleActive=function(t){t!==this.scrolling&&(this.scrolling=t,this.node.classList.toggle(this.activeClass,t))},n.prototype.scrollIntoView=function(t,e){this.pane.moveIntoView(t,e)},n.prototype.scrollTo=function(t,e){this.pane.swipeTo(i.ZERO.subtract(t),e)},n.prototype.handleStart=function(t){t.stopPropagation();var e=this.pane;this.indicate=e.content.exceeds(e.view);var s=this.node,a=s.scrollLeft,o=s.scrollTop;(a||o)&&(s.scrollTop=s.scrollLeft=0,e.moveBy(new i(-a,-o)),e.start=e.position)},n.prototype.handleDrag=function(t){if(t.stopPropagation(),this.indicate){var e=this.pane,i=e.start,s=e.position,a=s.subtract(i).magnitude();!this.scrolling&&a>20&&this.toggleActive(!0),this.updateThumbs()}},n.prototype.handleEnd=function(t){t.stopPropagation(),this.toggleActive(!1)},n}(t)});
"use strict";playtotv.define("playtotv.widget.ThemeWidget",["playtotv.widget.Widget"],function(t){var e=playtotv;return function(t){function s(i,a){babelHelpers.classCallCheck(this,s),e.params(a,{app:null,theme:e.REQUIRED,target:"body"}),t.call(this,i);var l=this.theme=a.theme,r=this.target=$(a.target);r&&r.classList.add(l)}return babelHelpers.inherits(s,t),s.prototype.dispose=function(){this.target&&this.target.classList.remove(this.theme),t.prototype.dispose.call(this)},s}(t)});
"use strict";playtotv.define("playtotv.widget.TimerWidget",["playtotv.css.style","playtotv.fx.Transition","playtotv.widget.Widget"],function(t,i,s){var r=playtotv;return function(s){function o(t,e){babelHelpers.classCallCheck(this,o),e=r.params(e,{app:null,indicator:".indicator",property:"width",inverted:!1,autoplay:!0,fps:1,start:0,time:0,end:0}),s.call(this,t),this.node=t,this.bar=$(e.indicator,t),this.property=e.property;var a=e.inverted;if(this.transition=new i({callback:this.handleFrame.bind(this),duration:1e3,from:a?1:0,to:a?0:1,fps:e.fps}),e.autoplay){var n=e,p=n.start,h=n.time,l=n.end,d=Date.now();p=p||d,h=h,l=l||p+h,this.start(l-p,p)}}return babelHelpers.inherits(o,s),o.prototype.start=function(t,i){if(isNaN(t))throw new TypeError("Duration is not a number");this.stop(),this.starttime=i||Date.now(),this.duration=t,this.transition.play({start:this.starttime,duration:this.duration})},o.prototype.stop=function(){this.transition.stop()},o.prototype.reset=function(){this.stop();var i=100*this.transition.settings.from;t.set(this.bar,this.property,i+"%")},o.prototype.handleFrame=function(i){t.set(this.bar,this.property,100*i+"%")},o.prototype.dispose=function(){this.stop(),s.prototype.dispose.call(this)},o}(s)});
"use strict";playtotv.define("playtotv.widget.TimestampWidget",["playtotv.widget.Widget"],function(t){var e=24,i=60,o=60,s=i*o,a=e*s,n=playtotv;return function(t){function l(e,i){babelHelpers.classCallCheck(this,l),n.params(i,{app:null,time:n.REQUIRED}),t.call(this,e),this.time=i.time,this.update()}return babelHelpers.inherits(l,t),l.prototype.update=function(){var t,n=this,l=Math.floor((Date.now()-this.time)/1e3);t=l>=a?Math.floor(l/a)+"d":l>=s?Math.floor(l/s)%e+"h":l>=o?Math.floor(l/o)%i+"m":l%o+"s",this.node.innerHTML!==t&&(this.node.innerHTML=t),this.timeout=setTimeout(function(){n.update()},l>o?6e4:1e3)},l.prototype.dispose=function(){clearTimeout(this.timeout),t.prototype.dispose.call(this)},l}(t)});
"use strict";playtotv.define("playtotv.widget.TransformableWidget",["playtotv.animationFrame","playtotv.css.Matrix","playtotv.css.style","playtotv.css.Vector","playtotv.widget.Widget"],function(t,e,a,s,i){var n=playtotv,o=new n.Logger(this.id),r=1,h=2;return function(i){function l(t,a){babelHelpers.classCallCheck(this,l),i.call(this,t),a=n.params(a,{translate:!0,scale:!0,rotate:!0}),this.touches=[],this.transform=new e,this.translation=new s(0,0),this.scaling=1,this.rotation=0,this.deltaMove=new s(0,0),this.deltaAngle=0,this.deltaScale=1,n.bindMethods(this,["handleFrame","touchStart","touchMove","touchEnd"]),this.addEventListener(t,"em:touchstart",this.touchStart),this.addEventListener(t,"em:touchmove",this.touchMove),this.addEventListener(t,"em:touchend",this.touchEnd)}return babelHelpers.inherits(l,i),l.prototype.setState=function(t){this.state=t},l.prototype.getState=function(){return this.state},l.prototype.requestFrame=function(){this.request=t.request(this.handleFrame)},l.prototype.cancelFrame=function(){this.request&&(t.cancel(this.request),delete this.request)},l.prototype.touchStart=function(t){t.preventDefault(),this.touches.push(t.detail.sequence.id)},l.prototype.touchMove=function(t){t.preventDefault();var e=t.detail.proxy,a=this.touches;if(a.length>0){var i=e.getSequence(a[0]),n=s.ZERO,o=0,r=1;if(a.length>1){var l=e.getSequence(a[1]),c=l.start.subtract(i.start),u=l.point.subtract(i.point);o=Math.atan2(-u.y,u.x)-Math.atan2(-c.y,c.x),r=u.magnitude()/c.magnitude(),n=i.offset.add(l.offset).divideBy(2)}this.deltaAngle=o,this.deltaScale=r,this.deltaMove=n,this.getState()!==h&&(this.setState(h),this.requestFrame())}},l.prototype.touchEnd=function(t){o.d(t),t.preventDefault();var e=this.touches,a=t.detail.sequence.id,s=e.indexOf(a);s>-1&&e.splice(s,1),this.translation=this.getTranslation(),this.rotation=this.getRotation(),this.scaling=this.getScaling(),this.cancelFrame(),this.setState(r)},l.prototype.getTranslation=function(){return this.translation.add(this.deltaMove)},l.prototype.getRotation=function(){return this.rotation+this.deltaAngle},l.prototype.getScaling=function(){return this.scaling*this.deltaScale},l.prototype.handleFrame=function(){var t=this.getTranslation(),e=this.getRotation(),s=this.getScaling(),i=this.transform.rotateZ(e).scale(s).translate(t);a.setTransform(this.node,i),this.requestFrame()},l}(i)});
"use strict";playtotv.define("playtotv.widget.VisualWidget",["playtotv.widget.Widget"],function(e){var t=playtotv;return function(e){function i(s,h){babelHelpers.classCallCheck(this,i),e.call(this,s),h=t.params(h,{mode:"cover",image:"img"}),this.image=$(h.image,s),this.mode=h.mode,this.handleResize=this.handleResize.bind(this),this.image&&(this.addEventListener(window,"resize",this.handleResize),this.addEventListener(this.image,"load",this.handleResize),this.handleResize())}return babelHelpers.inherits(i,e),i.prototype.handleResize=function(){if(this.node){var e=this.node,t=this.image,i=this.mode,s=t.style;t.removeAttribute("width"),t.removeAttribute("height"),s.margin=0;var h=e.offsetWidth,a=e.offsetHeight,n=t.offsetWidth/t.offsetHeight,d=h/a;d<n&&"contain"===i||d>n&&"cover"===i?(s.marginTop=-(h/n-a)/2+"px",t.setAttribute("width","100%")):(s.marginLeft=-(a*n-h)/2+"px",t.setAttribute("height","100%"))}},i}(e)});
"use strict";playtotv.define("playtotv.widget.WidgetManager",[],function(){var t=playtotv,e=t.dom;return function(){function o(e,s){babelHelpers.classCallCheck(this,o),this.node=e||document,this.attr=s,this.definitions=[],this.instances=[],t.bindMethods(this,["onMutations","onNodeAdded","onNodeRemoved"])}return o.prototype.register=function(t,e,o){var s=e.prototype;if(!s.getNode||!s.dispose)throw new ReferenceError("Class must define getNode() and dispose() methods");var n={selector:this.attr?"["+this.attr+'~="'+t+'"]':t,Class:e,options:o};return this.definitions.push(n),this.createInstances(this.node,n),n},o.prototype.unregister=function(t){if("object"!=typeof t)throw new TypeError("Object expected");var e=this.definitions,o=e.indexOf(t);o>-1&&(this.disposeInstances(this.node,t),e.splice(o,1))},o.prototype.onMutations=function(e){t.each(e,function(e){var o=e.removedNodes;o.length&&t.each(o,this.onNodeRemoved,this);var s=e.addedNodes;s.length&&t.each(s,this.onNodeAdded,this)},this)},o.prototype.onNodeAdded=function(t){e.isNode(t)&&this.definitions.forEach(function(e){this.createInstances(t,e)},this)},o.prototype.onNodeRemoved=function(t){e.isNode(t)&&this.disposeInstances(t)},o.prototype.createInstances=function(t,o){var s=e.any(o.selector,t);s.forEach(function(t){var e=o.Class;if(!this.getWidget(t,e)){var s=o.options;s=s instanceof Function?s(t):s,this.instances.push(new e(t,s))}},this)},o.prototype.disposeInstances=function(t,e){if(e&&!e.Class)throw new TypeError("Illegal definition");for(var o,s,n=this.instances,i=n.length-1,r=arguments.length<2,d=i;d>=0;d--)o=n[d],s=o.getNode(),!s||!t.contains(s)&&t!==s||!r&&o.constructor!==e.Class||(o.dispose(),n.splice(d,1))},o.prototype.getWidget=function(t,e){if(!e)throw new ReferenceError("Class expected");return this.instances.find(function(o){return o.getNode()===t&&o.constructor===e})},o.prototype.dispose=function(){this.disposeInstances(this.node),t.dispose(this)},o}()});
