!function(){"use strict";var t=[].slice,e=[].concat,r=Function.prototype;r.bind||(r.bind=function(r){var n=this;if(arguments.length>1){var i=t.call(arguments,1);return function(){var t=e.apply(i,arguments);return n.apply(r,t)}}return function(){return n.apply(r,arguments)}});var n=String.prototype;if(!n.trim){var i=/(^\s+)|(\s+)$/g;n.trim=function(){return this.replace(i,"")}}Date.now||(Date.now=function(){return(new Date).getTime()}),function(){var t=Date.parse("2011-06-02T09:34:29+02:00"),e=Date.parse("2011-06-02T09:34:29+0200");if(t!==e||1307000069e3!==t){var r=Date.parse;Date.parse=function(t){var e,n,i=/^(\d{4}\-\d\d\-\d\d([tT][\d:\.]*)?)([zZ]|([+\-])(\d\d):?(\d\d))?$/,a=i.exec(t)||[];if(a[1]){e=a[1].split(/\D/);for(var c=0,u=e.length;c<u;c++)e[c]=parseInt(e[c],10)||0;return e[1]-=1,e=new Date(Date.UTC.apply(Date,e)),e.getDate()?(a[5]&&(n=60*parseInt(a[5],10),a[6]&&(n+=parseInt(a[6],10)),"+"===a[4]&&(n*=-1),n&&e.setUTCMinutes(e.getUTCMinutes()+n)),e.getTime()):NaN}return r(t)}}}();var a=Array.prototype;a.indexOf||(a.indexOf=function(t,e){var r,n=Object(this),i=n.length;for(r=e||0;r<i;r++)if(r in n&&n[r]===t)return r;return-1}),a.lastIndexOf||(a.lastIndexOf=function(t,e){var r,n=Object(this),i=n.length;for(r=e||i-1;r>=0;r--)if(r in n&&n[r]===t)return r;return-1}),a.forEach||(a.forEach=function(t,e){var r,n=Object(this),i=n.length;for(r=0;r<i;r++)r in n&&t.call(e,n[r],r,n)}),a.map||(a.map=function(t,e){var r,n=[],i=Object(this),a=i.length;for(r=0;r<a;r++)r in i&&(n[r]=t.call(e,i[r],r,i));return n}),a.filter||(a.filter=function(t,e){var r,n,i=[],a=Object(this),c=a.length;for(r=0;r<c;r++)r in a&&(n=a[r],t.call(e,n,r,a)&&i.push(n));return i}),a.some||(a.some=function(t,e){var r,n=Object(this),i=n.length;for(r=0;r<i;r++)if(r in n&&t.call(e,n[r],r,n))return!0;return!1}),a.every||(a.every=function(t,e){var r,n=Object(this),i=n.length;for(r=0;r<i;r++)if(r in n&&!t.call(e,n[r],r,n))return!1;return!0}),a.reduce||(a.reduce=function(t,e){var r=0,n=Object(this),i=n.length;for(arguments.length<=1&&(e=n[0],r=1);r<i;r++)r in n&&(e=t(e,n[r],r,n));return e}),a.reduceRight||(a.reduceRight=function(t,e){var r=Object(this),n=r.length,i=n-1;for(arguments.length<=1&&(e=r[i],i=n-2);i>=0;i--)i in r&&(e=t(e,r[i],i,r));return e}),Object.keys||(Object.keys=function(t){var e,r=[],n=Object.prototype.hasOwnProperty;for(e in t)n.call(t,e)&&r.push(e);return r})}();
!function(){"use strict";Array.from||(Array.from=function(){var r=Object.prototype.toString,n=function(n){return"function"==typeof n||"[object Function]"===r.call(n)},t=function(r){var n=Number(r);return isNaN(n)?0:0!==n&&isFinite(n)?(n>0?1:-1)*Math.floor(Math.abs(n)):n},e=Math.pow(2,53)-1,o=function(r){var n=t(r);return Math.min(Math.max(n,0),e)};return function(r){var t=this,e=Object(r);if(null===r||void 0===r)throw new TypeError("Array.from requires an array-like object - not null or undefined");var i,a=arguments.length>1?arguments[1]:void 0;if("undefined"!=typeof a){if(!n(a))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(i=arguments[2])}for(var f,u=o(e.length),c=n(t)?Object(new t(u)):new Array(u),l=0;l<u;)f=e[l],a?c[l]="undefined"==typeof i?a(f,l):a.call(i,f,l):c[l]=f,l+=1;return c.length=u,c}}()),Array.prototype.find||(Array.prototype.find=function(r){for(var n,t=this,e=t.length,o=arguments[1],i=0;i<e;i++)if(n=t[i],r.call(o,n,i,t))return n})}();
!function(){"use strict";function t(){var t,n=0,e=o.length;try{for(;n<e;n++)t=o[n],t.cb.apply(t.on,t.args)}finally{n<e&&++n<e&&u(),o.splice(0,n)}}function n(t,n,e){o.push({cb:t,on:n,args:e||[]}),u()}var e=new Function("return this")(),i=e.window||{},r=i.MutationObserver||i.WebKitMutationObserver,o=[],u=r?function(){var n=document.createElement("div");return new r(t).observe(n,{attributes:!0}),function(){n.setAttribute("x","x")}}():e.setImmediate?function(){var n=!1;return function(){n||(n=e.setImmediate(function(){n=!1,t()}))}}():i.addEventListener?function(){function n(n){n.source===i&&n.data===r&&(n.stopPropagation(),e=!1,t())}var e=!1,r="nextTick";return i.addEventListener("message",n,!0),function(){e||(i.postMessage(r,"*"),e=!0)}}():function(){var n=!1;return function(){n||(n=setTimeout(function(){n=!1,t()},0))}}();e.nextTick=n}();
!function(){"use strict";function t(t){return"[object Array]"===Object.prototype.toString.call(t)}function e(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])}var r=new Function("return this")();r.Promise||(r.Promise=function(){function t(t){this._callbacks=[],this._errbacks=[],this.promise=t,this._status="pending",this._result=null}function r(t,e,r,n){return function(t){var i;try{i=n(t)}catch(t){return void r(t)}e(i)}}function n(e){if(!(this instanceof n))throw new TypeError('Failed to construct "Promise": Please use the "new" operator.');if("function"!=typeof e)throw new TypeError("Promise constructor takes a function argument");var r=new t(this);this._resolver=r;try{e(function(t){r.resolve(t)},function(t){r.reject(t)})}catch(t){r.reject(t)}}return e(t.prototype,{fulfill:function(t){var e=this._status;"pending"!==e&&"accepted"!==e||(this._result=t,this._status="fulfilled"),"fulfilled"===this._status&&(this._notify(this._callbacks,this._result),this._callbacks=[],this._errbacks=null)},reject:function(t){t===this.promise&&(t=new TypeError("You can not reject a promise with itself"));var e=this._status;"pending"!==e&&"accepted"!==e||(this._result=t,this._status="rejected"),"rejected"===this._status&&(this._notify(this._errbacks,this._result),this._callbacks=null,this._errbacks=[])},resolve:function(t){return t===this.promise?void this.reject(new TypeError("You can not resolve a promise with itself")):void("pending"===this._status&&(this._status="accepted",this._value=t,this._unwrap(this._value)))},_unwrap:function(t){var e,r=this,n=!1;if(!t||"object"!=typeof t&&"function"!=typeof t)return void r.fulfill(t);try{e=t.then,"function"==typeof e?e.call(t,function(t){n||(n=!0,r._unwrap(t))},function(t){n||(n=!0,r.reject(t))}):r.fulfill(t)}catch(t){n||r.reject(t)}},_addCallbacks:function(t,e){var r=this._callbacks,n=this._errbacks;switch(r&&r.push(t),n&&n.push(e),this._status){case"accepted":this._unwrap(this._value);break;case"fulfilled":this.fulfill(this._result);break;case"rejected":this.reject(this._result)}},_notify:function(t,e){t.length&&nextTick(function(){var r,n;for(r=0,n=t.length;r<n;++r)t[r](e)})}}),n.prototype.then=function(t,e){var n=this._resolver,i=new this.constructor(function(s,o){n._addCallbacks("function"==typeof t?r(i,s,o,t):s,"function"==typeof e?r(i,s,o,e):o)});return i},n}()),Promise.prototype.catch=function(t){return this.then(void 0,t)},e(Promise,{resolve:function(t){return t&&t.constructor===this?t:new this(function(e){e(t)})},reject:function(t){return new this(function(e,r){r(t)})},all:function(e){if(!t(e))throw new TypeError("Promise.all expects an array of values or promises");var r=this;return new r(function(t,n){function i(e){return function(r){u[e]=r,s--,s||t(u)}}var s=e.length,o=0,c=e.length,u=[];if(c<1)return t(u);for(;o<c;o++)r.resolve(e[o]).then(i(o),n)})},race:function(e){if(!t(e))throw new TypeError("Promise.race expects an array of values or promises");var r,n,i=this,s=e.length;for(r=0;r<s;r++)if(n=e[r],!n||!n.then||"function"!=typeof n.then)return i.resolve(n);return new i(function(t,n){for(r=0;r<s;r++)i.resolve(e[r]).then(t,n)})}}),r.Promise=Promise}();
!function(){"use strict";function t(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])}t(Promise.prototype,{catchIf:function(t,e){return this.catch(function(r){if(t(r))return e(r);throw r})},catchClass:function(t,e){return this.catch(function(r){if(r instanceof t)return e(r);throw r})},finally:function(t){var e=this.constructor;return this.then(function(r){return e.resolve(t()).then(function(){return r})},function(r){return e.resolve(t()).then(function(){throw r})})}}),t(Promise,{defer:function(){var t={};return t.promise=new this(function(e,r){t.resolve=e,t.reject=r}),t},delay:function(t){return new this(function(e){setTimeout(e,t)})},throttle:function(t,e){function r(){!i||u||o||(u=f.resolve(t.apply(n,i)),n=null,i=null,u.then(c.resolve,c.reject).finally(function(){u=null,r()}),c=f.defer(),o=setTimeout(function(){o=null,r()},e))}var n,i,o,u,f=this,c=f.defer();return function(){return n=this,i||u||o?i=arguments:(i=arguments,nextTick(r)),c.promise}},limit:function(t,e,r){function n(){var n=r.apply(this,arguments),u=o[n]||(o[n]={last:0}),f=Date.now();return!u.busy&&f>u.last+e&&(u.busy=!0,u.last=f,u.promise=i.resolve(t.apply(this,arguments)).finally(function(){u.busy=!1})),u.promise}r=r||t.getShard||function(){return JSON.stringify(Array.from(arguments))};var i=this,o={};return n.getShard=r,n},debounce:function(t,e,r){function n(){var n=this,u=arguments,f=r.apply(n,u),c=o[f]||(o[f]={});return c.deferred||(c.deferred=i.defer()),c.timeout&&clearTimeout(c.timeout),c.timeout=setTimeout(function(){c.timeout=0,i.resolve(t.apply(n,u)).then(c.deferred.resolve,c.deferred.reject).finally(function(){c.deferred=0})},e),c.deferred.promise}r=r||t.getShard||function(){return JSON.stringify(Array.from(arguments))};var i=this,o={};return n.getShard=r,n}})}();
!function(){"use strict";function e(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t]);return e}function r(r,n,o,i){return e(n,r),e(n,o),i=e(t(r.prototype),i),n.prototype=i,i.constructor=n,n}var t=Object.create||function(e){function r(){}return r.prototype=e,new r},n=r(Error,function(e){this.message=e||"Cancelled",Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack},null,{name:"CancellationError"}),o=r(n,function(e){n.call(this,e||"Timed out")},null,{name:"TimeoutError"}),i=r(Promise,function(e){if(!(this instanceof i))throw new TypeError('Failed to construct "Cancellable": Please use the "new" operator.');if("function"!=typeof e)throw new TypeError("Cancellable constructor takes a function argument");var r,t;this._promise=new Promise(function(e,n){r=e,t=n}),this._parentPromises=[],this._reject=t;try{e.call(this,r,t)}catch(e){t(e)}},{resolve:Promise.resolve,reject:Promise.reject,defer:Promise.defer,all:function(e){var r,t,n=Promise.all.call(this,e),o=n._parentPromises,s=e.length;for(r=0;r<s;r++)t=e[r],t instanceof i&&o.push(t);return n},race:function(e){var r,t,n=Promise.race.call(this,e),o=n._parentPromises,s=e.length;for(r=0;r<s;r++)t=e[r],t instanceof i&&o.push(t);return n}},{then:function(e,r){var t="function"!=typeof e?e:function(r){var t=e(r);if(t===s)throw new TypeError("You can not resolve a promise with itself");return t instanceof i&&c.push(t),t},n="function"!=typeof r?r:function(e){var t=r(e);if(t===s)throw new TypeError("You can not reject a promise with itself");return t instanceof i&&c.push(t),t},o=this._promise,s=new i(function(e){e(o.then(t,n))}),c=s._parentPromises;return c.push(this),s},cancel:function(e){e=e||new n;var r=this._parentPromises,t=r.length;if(0===t)this._reject(e);else for(var o=0;o<t;o++)r[o].cancel(e)},setTimeout:function(e,r){return r=r||new o("Timed out after "+e+"ms"),setTimeout(function(){this.cancel(r)}.bind(this),e)},toPromise:function(){return this._promise}});e(Promise,{Cancellable:i,CancellationError:n,TimeoutError:o})}();
!function(){"use strict";window.$=window.$||function(n){var o=arguments.length<=1||void 0===arguments[1]?document:arguments[1];return o.querySelector(n)},window.$$=window.$$||function(n){var o=arguments.length<=1||void 0===arguments[1]?document:arguments[1];return Array.from(o.querySelectorAll(n))}}();
!function(){"use strict";var n=new Function("return this")(),r=n.playtotv={},t=[].forEach,e=1;r.extend=function(n){var r,t,e,o=arguments.length;for(e=1;e<o;e++){r=arguments[e];for(t in r)r.hasOwnProperty(t)&&(n[t]=r[t])}return n},r.extend(r,{toArray:function(n){var r;if(n.toArray)r=n.toArray();else{var t=n.length;for(r=new Array(t);t--;)r[t]=n[t]}return r},getUID:function(n){return e+=1,n?n+e:e},each:function(n,r,e){if(n)if(n.forEach)n.forEach(r,e);else if(n.length===+n.length)t.call(n,r,e);else{var o;for(o in n)n.hasOwnProperty(o)&&r.call(e,n[o],o,n)}},find:function(n,r,t){var e;if(n instanceof Array){var o,i=n.length;for(o=0;o<i;o++)if(e=n[o],r.call(t,e,o,n))return e}else{var a;for(a in n)if(n.hasOwnProperty(a)&&(e=n[a],r.call(t,e,a,n)))return e}},pluck:function(n,r){return n.map(function(n){return n[r]})},union:function(){var n=[];return this.toArray(arguments).forEach(function(r){r.forEach(function(r){n.indexOf(r)<0&&n.push(r)})}),n},pick:function(n,r){var t={};return r.forEach(function(r){r in n&&(t[r]=n[r])}),t},omit:function(n,r){var t={};for(var e in n)r.indexOf(e)===-1&&(t[e]=n[e]);return t},randomNr:function(n){var r=arguments.length<=1||void 0===arguments[1]?0:arguments[1],t=n-r;return r+Math.floor(Math.random()*t)},randomItem:function(n){return n[this.randomNr(n.length)]},shuffle:function(n){for(var r,t,e=n.length,o=n.slice(0);e>0;)t=Math.floor(Math.random()*e--),r=o[e],o[e]=o[t],o[t]=r;return o},throttle:function(n,r){function t(){o&&!i&&(n.apply(e,o),e=null,o=null,i=setTimeout(function(){i=null,t()},r))}var e,o,i;return function(){e=this,o||i?o=arguments:(o=arguments,nextTick(t))}},debounce:function(n,r){var t;return function(){var e=this,o=arguments;clearTimeout(t),t=setTimeout(function(){t=null,n.apply(e,o),e=null,o=null},r)}},unstack:function(n){function r(){n.apply(t,e),t=null,e=null}var t,e;return function(){t=this,e?e=arguments:(e=arguments,nextTick(r))}},once:function(n){var r,t=!1;return function(){return t?r:(t=!0,r=n.apply(this,arguments))}},defer:function(n,r){return function(){nextTick(n,r||this,arguments)}},AbstractFunction:function(){throw new ReferenceError("Abstract function not implemented.")},REQUIRED:"__required__",params:function(n,t){return n=n||{},r.each(t,function(t,e){var o=n.hasOwnProperty(e);if(!o){if(t===r.REQUIRED)throw new Error("Missing required parameter: "+e);n[e]=t}}),r.each(n,function(n,r){if(!t.hasOwnProperty(r))throw new Error("Invalid parameter: "+r+" = "+n)}),n},spliceParams:function(n,t){n=n||{};var e=Object.keys(t),o=r.pick(n,e);return e.forEach(function(r){delete n[r]}),r.params(o,t)},loadScript:function(n,r){var t=Promise.defer(),e=document.createElement("script");e.type="text/javascript",e.async=r!==!1,e.src=n;var o=!1;return e.onload=e.onreadystatechange=function(){var n=this.readyState;o||void 0!==n&&"complete"!==n&&"loaded"!==n||(o=!0,t.resolve(e))},e.onerror=function(){t.reject(new Error("Error loading script: "+n))},document.head.appendChild(e),t.promise},dispose:function(n){Object.keys(n).forEach(function(r){delete n[r]}),n.dispose=function(){},n.disposed=!0}})}();
!function(){"use strict";var t=Object.create||function(t){function n(){}return n.prototype=t,new n};playtotv.Class=function(t){var n,e,o,r,i={},a=[];for(r in t)if(t.hasOwnProperty(r))switch(o=t[r],r){case"initialize":n=o;break;case"extend":e=o;break;case"callbacks":a=o;break;default:i[r]=o}if(e&&!(e instanceof Function))throw new TypeError("Function expected using 'extend' with playtotv.Class");return n||(n=e?function(){this._super.apply(this,arguments)}:function(){}),(e||a.length>0)&&(n=this.wrap(n,e,a)),playtotv.extend(n.prototype,i),n},playtotv.Class.prototype={wrap:function(n,e,o){var r=function(){return o.forEach(function(t){var n=this[t];if(!(n instanceof Function))throw new ReferenceError('Callback "'+t+'" is undefined or not a Function');this[t]=n.bind(this)},this),this._super=e||void 0,n.apply(this,arguments)};return e&&(r.prototype=t(e.prototype),r.prototype.constructor=r),r}},playtotv.Class.getInstance=function(t){var n=new playtotv.Class(t);return new n}}();
!function(){"use strict";if("undefined"!=typeof window){var t=playtotv,e=window.document,n=e.documentElement,r="data-em-uid",i={},o=n.matches||n.webkitMatchesSelector||n.mozMatchesSelector||n.msMatchesSelector||n.oMatchesSelector,a=window.Node;a&&a.prototype&&!a.prototype.contains&&(a.prototype.contains=function(t){return!!(16&this.compareDocumentPosition(t))}),function(t,e){if(e.classList.toggle("test",!1),e.classList.contains("test")){var n=t.prototype.toggle;t.prototype.toggle=function(t,e){return 1 in arguments&&this.contains(t)===e?e:n.call(this,t)}}}(window.DOMTokenList,e.createElement("_")),t.dom={find:function(n,r){return t.toArray((r||e).querySelectorAll(n))},matches:function(t,n){return!(!n||n===e)&&o.call(n,t)},first:function(t,n){return(n||e).querySelector(t)},last:function(t,e){var n=this.find(t,e),r=Math.max(0,n.length-1);return n[r]},traverse:function(t,e,n){for(;e;){if(this.matches(t,e))return e;e=e[n]}return null},next:function(t,e){return this.traverse(t,e.nextSibling,"nextSibling")},previous:function(t,e){return this.traverse(t,e.previousSibling,"previousSibling")},closest:n.closest?function(t,e){return e.closest(t)}:function(t,e){return this.traverse(t,e,"parentNode")},any:function(t,e){var n=this.find(t,e);return e&&this.matches(t,e)&&n.splice(0,0,e),n},filter:function(t,e){var n,r,i=[],o=e.length;for(n=0;n<o;n++)r=e[n],this.matches(t,r)&&i.push(r);return i},isNode:function(t){return t&&t.nodeType&&1===t.nodeType},isChild:function(t,e){return!!this.isNode(e)&&e.contains(t)},create:function(n,r,i){var o=e.createElement(n);return r&&t.each(r,function(t,e){o.setAttribute(e,t)}),i&&(void 0!==i.html&&(this.innerHTML=i.html),["appendTo","insertBefore","insertAfter","prependTo","replace"].forEach(function(e){var n=i[e];void 0!==n&&t.dom[e](o,n)}),void 0!==i.text&&o.appendChild(e.createTextNode(i.text))),o},remove:function(t){return t.parentNode.removeChild(t)},appendTo:function(t,e){return e.appendChild(t)},insertBefore:function(t,e){return e.parentNode.insertBefore(t,e)},insertAfter:function(t,e){return e.nextSibling?this.insertBefore(t,e.nextSibling):this.appendTo(t,e)},prependTo:function(t,e){return e.firstChild?this.insertBefore(t,e.firstChild):this.appendTo(t,e)},replace:function(t,e){return e.parentNode.replaceChild(t,e)},parseHTML:function(t){var n=e.createElement("div");n.innerHTML=t;var r,i=e.createDocumentFragment(),o=n.childNodes.length;for(r=0;r<o;r++)i.appendChild(n.firstChild);return i},getData:function(t,e){var n=t[r],o=n?i[n]:null;return o?o[e]:null},setData:function(e,n,o){var a=e[r];a||(a=t.getUID(),e[r]=a);var s=i[a];return s||(i[a]=s={}),s[n]=o,o},removeData:function(t,e){var n=t[r],o=i[n];o&&delete o[e]},getClosestAttr:function(t,e){return t=this.closest("["+e+"]",t),t?t.getAttribute(e):void 0},getDataSet:function(e){var n=e.dataset;if(!n)return t.toArray(e.attributes).reduce(function(t,e){var n=e.name;return 0!==n.indexOf("data-")?t:(n=n.substr(5).replace(/-([a-z])/g,function(t,e){return e.toUpperCase()}),t[n]=e.value,t)},{});if(!n.hasOwnProperty){var r,i={};for(r in n)i[r]=n[r];n=i}return n}}}}();
!function(){"use strict";if("undefined"!=typeof window){var e=window.document,t=window.Event,n=window.MouseEvent,r=window.CustomEvent,o=function(){try{var e=new r("test");return e.preventDefault(),!0}catch(e){return!1}}();if(!o){var i=t.prototype;t=function(t,n){n=playtotv.params(n,{bubbles:!1,cancelable:!1});var r=e.createEvent("HTMLEvents");return r.initEvent(t,n.bubbles,n.cancelable),r},t.prototype=i,r=function(t,n){n=playtotv.params(n,{bubbles:!1,cancelable:!1,detail:null});var r=e.createEvent("CustomEvent");return r.initCustomEvent(t,n.bubbles,n.cancelable,n.detail),r},r.prototype=i,n=function(t,n){n=playtotv.params(n,{bubbles:!1,cancelable:!1,screenX:0,screenY:0,clientX:0,clientY:0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,buttons:0,relatedTarget:null});var r=e.createEvent("MouseEvent");return r.initMouseEvent(t,n.bubbles,n.cancelable,window,1,n.screenX,n.screenY,n.clientX,n.clientY,n.ctrlKey,n.altKey,n.shiftKey,n.metaKey,n.button,n.relatedTarget),r},n.prototype=i}var a=new playtotv.Class({initialize:function(e,t,n){this.node=e,this.type=t,this.listener=n},dispose:function(){delete this.node,delete this.type,delete this.listener}});playtotv.event={addListener:function(e,t,n){if(!e)throw new ReferenceError('Node is undefined at event.addListener for "'+t+'"');return e.addEventListener(t,n,!1),new a(e,t,n)},removeListener:function(e,t,n){var r=e;if(e instanceof a&&(n=e.listener,t=e.type,r=e.node,e.dispose()),!r)throw new ReferenceError('Node is undefined at event.removeListener for "'+t+'"');r.removeEventListener(t,n,!1)},dispatchEvent:function(e,t,n,o,i){return e.dispatchEvent(new r(t,{bubbles:n,cancelable:o,detail:i}))},triggerNative:function(e,r,o){o=playtotv.extend({bubbles:!0,cancelable:!0},o);var i=/mouse|click/.test(r)?new n(r,o):new t(r,o);return e.dispatchEvent(i)},preventDefault:function(e){return e.preventDefault(),!1},stopPropagation:function(e){e.stopPropagation()},addWindowOnError:function(e){var t=window.onerror;window.onerror=function(n,r,o,i,a){var s;return t&&(s=t.apply(this,arguments)),a||(a=new Error((n.match(/Error: (.*)/)||[])[1]||n),a.name=(n.match(/\w+Error/)||[])[0]||"Error",a.stack=r+":"+o+(void 0===i?"":":"+i)),e(a)||s}}},playtotv.extend(playtotv.event,{CustomEvent:r,Event:t,EventListener:a,MouseEvent:n})}}();
!function(){"use strict";function t(t){var e="";playtotv.each(r,function(n,r){e||0!==t.indexOf(r)||(e=n,t=t.replace(r,""))});var n=t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().replace(/\./g,"/")+".js";return e+n}function e(t,e){var r,o,a,i=n,u=t.split("."),l=u.length,c=l-1;for(r=0;r<l;r++)o=u[r],a=i[o],r<c?i=a||(i[o]={}):i[o]=a?playtotv.extend(e,a):e}var n=new Function("return this")(),r=playtotv.pkgURL={},o={},a=playtotv.definePromises={},i=playtotv.modules={};playtotv.getModule=function(e){var n=t(e)+"?nocache="+Date.now();return a[e]||o[e]||(o[e]=playtotv.loadScript(n).then(function(){if(!a[e])throw new Error(e+" was not defined by "+n);return a[e]}))},playtotv.define=function(t,n,r){if(3!==arguments.length)throw new Error("Three arguments required");return a[t]||(a[t]=Promise.all(n.map(playtotv.getModule)).then(function(o){var a={id:t,dependencies:n},u=r instanceof Function?r.apply(a,o):r;return i[t]=u,e(t,u),u}))},playtotv.require=function(t){return i[t]},playtotv.getModuleId=function(t){return playtotv.find(Object.keys(i),function(e){return i[e]===t})},playtotv.importModules=function(t){var e,n,r,o=/[^.]+$/i,a={},u=t.length;for(e=0;e<u;e++)n=t[e],r=o.exec(n)[0],a[r]=i[n];return a}}();
!function(){"use strict";function e(e){return window.decodeURIComponent(e.replace(/\+/g," "))}var t=playtotv;t.util={EMAIL_REGEXP:new RegExp("^[A-Za-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[A-Za-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[A-Za-z0-9](?:[A-Za-z0-9-]*[A-Za-z0-9])?\\.)+[A-Za-z0-9](?:[A-Za-z0-9-]*[A-Za-z0-9])$"),URL_REGEXP:/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/gi,ORIGIN_REGEXP:/(\w+:)?\/{2,}[^\/]+/,escapeHtml:function(e){return t.dom.create("div",null,{text:e}).innerHTML},escapeRegEx:function(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},globToRegEx:function(e){return new RegExp("^"+this.escapeRegEx(e).replace(/\\\*/g,"(.*)")+"$")},glob:function(e,t){return this.globToRegEx(e).test(t)},addURLParam:function(e,t,n){var r=e.indexOf("?")!==-1?"&":"?";return e.replace(/((#.*)?$)/,r+encodeURIComponent(t)+"="+encodeURIComponent(n)+"$1")},addURLParams:function(e,n){return t.each(n,function(t,n){e=this.addURLParam(e,n,t)},this),e},getURLParams:function(t){t=t||window.location.href;for(var n,r=t.replace(/[^\?]*\??([^#]*)(#.*)?/,"$1"),i={},a=/([^&=]+)=?([^&]*)/g;n=a.exec(r);)i[e(n[1])]=e(n[2]);return i},getOrigin:function(e,t){var n=window.location;e=e||n.href,t=t||n.href;var r=e.match(this.ORIGIN_REGEXP),i=r?r[0]:t.match(this.ORIGIN_REGEXP)[0];return 0===i.indexOf("//")&&(i=n.protocol+i),0===i.indexOf("file://")&&(i="file://"),i},popup:function(e,t,n){t=t||"_blank",n=n||{};var r=n.width;if(r){var i=window.screen.width;n.width=r=Math.min(r,i),n.left=n.left||Math.round(i/2-r/2)}var a=n.height;if(a){var o=window.screen.height;n.height=a=Math.min(a,o),n.top=n.top||Math.round(o/2-a/2)}var s=Object.keys(n).map(function(e){return e+"="+n[e]}).join(",");return window.open(e,t,s)},pad:function(e,t,n){for(e=String(e),t=parseInt(t,10)||2,n=n||"0";e.length<t;)e=n+e;return e},timeStr:function(e,t){return e=e||new Date,this.pad(e.getHours())+":"+this.pad(e.getMinutes())+":"+this.pad(e.getSeconds())+(t?"."+this.pad(e.getMilliseconds(),3):"")},formatDate:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?new Date:arguments[1];n instanceof Date||(n=new Date(n));var r=n.getHours();return e.replace(/([a-zA-Z])\1*/g,function(i){var a=i[0],o=i.length,s="y"===a?2===o?String(n.getFullYear()).substr(2):n.getFullYear():"M"===a?n.getMonth()+1:"d"===a?n.getDate():"H"===a?r:"h"===a?r<=12?0===r?12:r:r-12:"m"===a?n.getMinutes():"s"===a?n.getSeconds():"S"===a?n.getMilliseconds():"a"===a?r<12?"AM":"PM":null;if(null===s)throw new Error("Unsupported letter: "+a+" in pattern: "+e);return o>1&&(s=t.pad(s,o)),s})},toCurrency:function(e,t){var n,r=parseFloat(e).toFixed(2).split("."),i=r[0].split(""),a=i.length-3;for(n=a;n>=1;n-=3)i.splice(n,0,".");return i.join("")+","+(t===!1?"-":r[1])},dashCase:function(e){return e.replace(/\W+/g,"-").replace(/\w+/g,function(e){return e.toLowerCase()})},titleCase:function(e){return e.replace(/[\W_]+/g," ").replace(/(\w)(\w*)/g,function(e,t,n){return t.toUpperCase()+n.toLowerCase()})},getPathHead:function(e){var t=arguments.length<=1||void 0===arguments[1]?".":arguments[1],n=e.indexOf(t);return n<0?e:e.substr(0,n)},getPathTail:function(e){var t=arguments.length<=1||void 0===arguments[1]?".":arguments[1],n=e.indexOf(t);return n<0?"":e.substr(n+1)},seekRef:function(e){var t=arguments.length<=1||void 0===arguments[1]?"":arguments[1],n=arguments.length<=2||void 0===arguments[2]?".":arguments[2];if(!t)return{object:e,key:"",value:e};if(e){var r=this.getPathHead(t,n),i=e[r];return r===t?{object:e,key:r,value:i}:this.seekRef(i,this.getPathTail(t,n))}},seek:function(e){var t=arguments.length<=1||void 0===arguments[1]?"":arguments[1],n=arguments.length<=2||void 0===arguments[2]?".":arguments[2],r=this.seekRef(e,t,n);return r&&r.value},resolvePath:function(e,t){if(0===t.indexOf("/"))return t.substr(1);for(var n=e.substr(0,e.lastIndexOf("/")+1);0===t.indexOf("../");)t=t.substr(3),n=n.replace(/[^\/]+\/$/,"");return n+t},getTimeZone:function(e){e=void 0===e?-1*((new Date).getTimezoneOffset()/60):e;var t=e<0?"-":"+";return e=Math.abs(e),"UTC"+t+this.pad(Math.floor(e))+":"+this.pad(60*e%60)},eval:function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0],t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=Object.keys(t),r=n.map(function(e){return t[e]});e=e.trim();var i=e.indexOf(";");i>=0&&i<e.length?(n.push("_script",'"use strict"; return eval(_script);'),r.push(e)):n.push('"use strict"; return '+e);try{var a=Function.apply(null,n);return a.apply(t,r)}catch(t){throw t.message+=" in script: "+e.trim().replace(/\s+/g," "),t}},filter:function(e,t,n,r){var i=this;if("string"==typeof n){var a=this.escapeRegEx(n),o={fuzzy:n.split("").map(function(e){return i.escapeRegEx(e)+".*"}).join(""),contains:a,startsWith:"^"+a,endsWith:a+"$",equals:"^"+a+"$"}[r];void 0!==o&&(n=new RegExp(o,"i"))}var s=n instanceof RegExp?n.test.bind(n):n instanceof Function?n.bind(e):void 0===n?function(e){return!!e}:function(e){return e===n};return e.filter(function(e){return s(i.seek(e,t))})},order:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?"":arguments[1],r=!(arguments.length<=2||void 0===arguments[2])&&arguments[2];return e=e.slice(0),e.sort(function(e,i){return e=t.seek(e,n),i=t.seek(i,n),(r?-1:1)*(e<i?-1:e>i?1:0)})},page:function(e){var n=arguments.length<=1||void 0===arguments[1]?1:arguments[1],r=arguments.length<=2||void 0===arguments[2]?10:arguments[2],i=Math.ceil(e.length/r);n=Math.max(1,n),n=Math.min(i,n);var a=e.slice((n-1)*r,n*r);return t.extend(a,{page:n,prev:n>1&&n-1,next:n<i&&n+1,last:i}),a}}}();
!function(){"use strict";var n=playtotv,e=n.util,t={},o={SPAM:4,DEBUG:3,INFO:2,WARNING:1,ERROR:0,NONE:-1},i={SPAM:"log",DEBUG:"debug",INFO:"info",WARNING:"warn",ERROR:"error"},l="undefined"!=typeof window?e.getURLParams(window.location.href):{};l.fbl&&n.loadScript("//getfirebug.com/firebug-lite.js#startOpened",!1);var r=l.weinre;void 0!==r&&n.loadScript("https://weinre.exmachina.nl/target/target-script-min.js#"+(r||"anonymous"),!1);var s=new n.Class({initialize:function(e,t){this.name=e||n.getUID("logger-"),this.level=t},isEnabled:function(n){var e=this.level||s.level;return o[e]>=o[n]},log:function(t,o){if(console&&this.isEnabled(t)){o=n.toArray(o),o=o.map(function(n){if(n instanceof Promise){var e=["[promise]"];return n.then(function(n){e.push("[resolved]",n),this.log(t,o)}.bind(this),function(n){e.push("[rejected]",n),this.log(t,o)}.bind(this)),e}return n},this);var l=e.timeStr(new Date,!0)+" ["+t+"] "+this.name+" |",r=Array.prototype.concat.apply([l],o),a=console[i[t]]||console.log;"function"==typeof a.apply?a.apply(console,s.join?[r.join(" ")]:r):a(r.join(" "))}},trace:function(n){console&&console.trace&&(!n||this.isEnabled(n))&&console.trace()},s:function(){this.log("SPAM",arguments)},d:function(){this.log("DEBUG",arguments)},i:function(){this.log("INFO",arguments)},w:function(){this.log("WARNING",arguments)},e:function(){this.log("ERROR",arguments)}});n.extend(s,{level:l.logLevel||"INFO",join:!!l.logJoin,get:function(n,e){var o=n&&t[n];return o?(e&&(o.level=e),o):(o=new s(n,e),t[n]=o,o)}}),n.Logger=s}();

playtotv.define("playtotv.analytics.ComScoreAnalytics",[],function(){"use strict";var t=playtotv,e=t.util;return t.Class({initialize:function(e){t.params(e,{url:t.REQUIRED}),this.url=e.url,window.udm_||(window.udm_=function(t){var e,n,i,a,r,c="comScore=",s=document,o=s.cookie,u="",l="indexOf",d="substring",m="length",p=2048,w="&ns_",f="&",_=window,h=_.encodeURIComponent||escape;if(o[l](c)+1)for(a=0,i=o.split(";"),r=i[m];a<r;a++)n=i[a][l](c),n+1&&(u=f+unescape(i[a][d](n+c[m])));t+=w+"_t="+ +new Date+w+"c="+(s.characterSet||s.defaultCharset||"")+"&c8="+h(s.title)+u+"&c7="+h(s.URL)+"&c9="+h(s.referrer),t[m]>p&&t[l](f)>0&&(e=t[d](0,p-8).lastIndexOf(f),t=(t[d](0,e)+w+"cut="+h(t[d](e+1)))[d](0,p)),s.images?(n=new Image,_.ns_p||(_.ns_p=n),n.src=t):s.write("<","p","><",'img src="',t,'" height="1" width="1" alt="*"',"><","/p",">")})},udm:function(t,n){var i=this.url.replace(/__TAG__/g,t||"");i=e.addURLParams(i,n||{}),window.udm_(i)}})});
playtotv.define("playtotv.analytics.GoogleAnalytics",[],function(){"use strict";var e=playtotv,i=e.Logger.get(this.id);return new e.Class({initialize:function(i){e.params(i,{id:e.REQUIRED,name:null,fields:{},setFields:null,dimensionMap:{},metricMap:{},requires:[],skipView:!1}),window.ga||!function(e,i,n,t,s,r,a){e.GoogleAnalyticsObject=s,e[s]=e[s]||function(){(e[s].q=e[s].q||[]).push(arguments)},e[s].l=1*new Date,r=i.createElement(n),a=i.getElementsByTagName(n)[0],r.async=1,r.src=t,a.parentNode.insertBefore(r,a)}(window,document,"script","//www.google-analytics.com/analytics.js","ga");var n=i.name,t=i.fields,s=i.setFields,r="";n&&(r=n+".",t.name=n),this.prefix=r,this.mode=s&&s.appId?"app":"web",this.dimensionMap=i.dimensionMap,this.metricMap=i.metricMap,window.ga("create",i.id,t),s&&this.setFields(s),i.requires.forEach(function(e){e=["require"].concat(e),this.ga.apply(this,e)}.bind(this));var a=Promise.defer();this.trackerPromise=a.promise,window.ga(function(e){e=n?window.ga.getByName(n):e,this.tracker=e,a.resolve(e)}.bind(this)),i.skipView||this.sendView()},sendView:function(e,i){return"app"===this.mode?this.sendScreenview(e,i):this.sendPageview(e,null,i)},sendError:function(e,i,n){n=n||{};var t=((e.stack||"").match(/[^\s\(@]*(:\d+)+/)||[])[0]||document.location,s=e.name+": "+e.message+" ["+t+"]";return"app"===this.mode?this.sendException(s,i,n):(n.nonInteraction=!0,this.sendEvent(i?"fatal":"error",s,n))},sendPageview:function(e,i,n){return n=n||{},e&&(n.page=e),i&&(n.title=i),this.send("pageview",n)},sendScreenview:function(e,i){return i=i||{},e&&(i.screenName=e),this.send("screenview",i)},sendException:function(e,i,n){return n=n||{},n.exDescription=e,n.exFatal=!!i,this.send("exception",n)},time:function(e,i,n,t){var s=Date.now();return e.then(function(){this.sendTiming(i,n,Date.now()-s,t)}.bind(this)),e},sendTiming:function(e,i,n,t){return t=t||{},t.timingCategory=e,t.timingVar=i,t.timingValue=n,this.send("timing",t)},sendEvent:function(e,i,n){return n=n||{},n.eventCategory=e,n.eventAction=i,this.send("event",n)},sendSocial:function(e,i,n,t){return t=t||{},t.socialNetwork=e,t.socialAction=i,t.socialTarget=n,this.send("social",t)},get:function(e){return this.trackerPromise.then(function(i){return i.get(e)})},set:function(e,i){var n={};n[e]=i,this.setFields(n)},setFields:function(e){e=this.processFields(e),this.ga("set",e)},processFields:function(i){var n=["dimension","metric"],t=e.omit(i,n);return n.forEach(function(n){var s=this[n+"Map"];e.each(i[n],function(e,i){var r=s[i];r&&(t[n+r]=e)})},this),t},send:function(e,i){i=this.processFields(i||{});var n=Promise.defer();return i.hitCallback=n.resolve,this.ga("send",e,i),n.promise},ga:function(){var n=this.prefix,t=e.toArray(arguments),s=t.shift();i.s(n+s,t),t.unshift(n+s),window.ga.apply(window,t)}})});
playtotv.define("playtotv.widget.Widget",[],function(){"use strict";var e=playtotv,t=e.event;return new e.Class({initialize:function(e){this.node=e,this.eventListeners=[],this.subscriptionRecords=[],this.timeoutIds=[]},getNode:function(){return this.node},addEventListener:function(e,s,i){var n=t.addListener(e,s,i);return this.eventListeners.push(n),n},removeEventListener:function(e){var s=this.eventListeners,i=s.indexOf(e),n=i>=0;return n&&(t.removeListener(e),s.splice(i,1)),n},subscribe:function(t){var s=e.toArray(arguments).slice(1),i={pubsub:t,subscription:t.subscribe.apply(t,s)};return this.subscriptionRecords.push(i),i},unsubscribe:function(e){var t=this.subscriptionRecords,s=t?t.lastIndexOf(e):-1;return s!==-1&&(t.splice(s,1),e.pubsub.unsubscribe(e.subscription),delete e.pubsub,delete e.subscription,!0)},setTimeout:function(e,t){var s=setTimeout(e,t);return this.timeoutIds.push(s),s},clearTimeout:function(e){var t=this.timeoutIds,s=t.indexOf(e),i=s>=0;return i&&(clearTimeout(e),t.splice(s,1)),i},dispose:function(){this.eventListeners.forEach(t.removeListener),this.subscriptionRecords.forEach(function(e){e.pubsub.unsubscribe(e.subscription),delete e.pubsub,delete e.subscription}),this.timeoutIds.forEach(clearTimeout),e.dispose(this)}})});
function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}playtotv.define("playtotv.analytics.AnalyticsWidget",["playtotv.widget.Widget"],function(t){"use strict";var e=playtotv;return function(t){function n(o,r){var a=this;_classCallCheck(this,n),r=e.params(r,{app:null,controller:e.REQUIRED,nonInteraction:/view|load/,separator:/,\s+/,view:"",load:"",click:"",submit:"",change:"",event:""});var i=r.controller,c=r.nonInteraction,l=r.separator;t.call(this,o);var s=e.omit(r,["controller","nonInteraction","separator"]);e.each(s,function(t,e){if(t){var n=t.split(l),r="event"===e?n.shift():e,s=c.test(r);if("view"===r)i.view(t,{nonInteraction:s});else{var p=function(){i.event(n[0],n[1]||r,{eventLabel:n[2],nonInteraction:s})};"load"===r?p():a.addEventListener(o,r,p)}}})}return _inherits(n,t),n}(t)});
playtotv.define("playtotv.animationFrame",[],function(){"use strict";if("undefined"!=typeof window){var n,e,i=window.requestAnimationFrame,t=window.cancelAnimationFrame,o=["webkit","moz","ms","o"],a=o.length;for(n=0;n<a&&!i;n++)e=o[n],i=window[e+"RequestAnimationFrame"],t=window[e+"CancelAnimationFrame"]||window[e+"CancelRequestAnimationFrame"];var r=0;return i=i?i.bind(window):function(n){var e=Date.now(),i=Math.max(0,16-(e-r));return r=e+i,setTimeout(function(){n(r)},i)},t=t?t.bind(window):function(n){clearTimeout(n)},{request:i,cancel:t}}});
playtotv.define("playtotv.cookie",[],function(){"use strict";var t={get:function(t){var e,n=t+"=",i=document.cookie.split(";"),r=i.length;for(e=0;e<r;e++){for(var o=i[e];" "===o.charAt(0);)o=o.substring(1,o.length);if(0===o.indexOf(n))return o.substring(n.length,o.length)}return null},set:function(t,e,n){var i="";if(n){var r=new Date;r.setTime(r.getTime()+24*n*60*60*1e3),i="; expires="+r.toGMTString()}document.cookie=t+"="+e+i+"; path=/"},remove:function(t){this.set(t,"",-1)}};return t});
playtotv.define("playtotv.cron",[],function(){"use strict";function e(){return Date.now()}function t(e,t){t.quiet||d.s("job #"+t.id+' "'+t.label+'": '+e)}function i(i){t("Scheduling repeat @ "+i.time,i),i.timeout=void 0,i.time=e()+i.repeat,f[i.id]=i,v||u()}function n(n){var r;if(void 0!==(r=s[n]))delete s[n];else{if(void 0===(r=f[n]))return;delete f[n]}var o=e(),l=r.time-o;l=l<0?l:"+"+l,t("Executing @ "+o+" ("+l+"ms)",r),m[n]=r;var a=r.func.apply(r.context,r.args);Promise.resolve(a).then(function(e){m[n]&&(delete m[n],r.repeat>0&&e!==!1&&i(r))},function(){delete m[n]})}function r(t){var i=f[t];if(i){var r=i.time-e();r<=0?n(t):r<b.tickInterval&&(delete f[t],s[t]=i,i.timeout=setTimeout(function(){n(t)},r))}}function o(e,t,i){i=playtotv.extend({context:t,args:[],repeat:0,label:"unlabeled",quiet:!1},i);var n=playtotv.extend({id:p,time:e,func:t},i);return f[p++]=n,d.s("at(): #"+n.id+' "'+n.label+'"',n),i.repeat>0&&i.repeat<b.tickInterval&&(b.tickInterval=i.repeat,d.d("Setting tick interval to "+b.tickInterval+" to keep up with job #"+n.id+" ("+n.label+")")),nextTick(u),n.id}function l(e){return f[e]||s[e]||m[e]}function a(e){var i;if(void 0!==(i=s[e]))clearTimeout(i.timeout),delete s[e];else if(void 0!==(i=m[e]))delete m[e];else{if(void 0===(i=f[e]))return!1;delete f[e]}return t("Cancelled",i),!0}function c(){return!!v&&(d.s("Halting.."),Object.keys(f).forEach(a),Object.keys(s).forEach(a),Object.keys(m).forEach(a),clearTimeout(v),v=null,!0)}var u,d=playtotv.Logger.get(this.id),v=null,f={},s={},m={},p=1;u=function(){v&&(clearTimeout(v),v=null),Object.keys(f).forEach(r),Object.keys(f).length>0&&(v=setTimeout(u,b.tickInterval))};var b={tickInterval:1e3,at:o,get:l,cancel:a,halt:c,debug:{jobs:f,timeoutJobs:s,promisedJobs:m}};return b});
playtotv.define("playtotv.css.Vector",[],function(){"use strict";var t=Math.min,n=Math.max,i=Math.sqrt,e=new playtotv.Class({initialize:function(t,n){this.x=t,this.y=n},add:function(t){return new e(this.x+t.x,this.y+t.y)},subtract:function(t){return new e(this.x-t.x,this.y-t.y)},multiply:function(t){return new e(this.x*t.x,this.y*t.y)},multiplyBy:function(t){return new e(this.x*t,this.y*t)},divide:function(t){return new e(this.x/t.x,this.y/t.y)},divideBy:function(t){return new e(this.x/t,this.y/t)},dot:function(t){var n=this.multiply(t);return n.x+n.y},magnitude:function(){var t=this.x,n=this.y;return i(t*t+n*n)},normalize:function(){var t=this.magnitude();return new e(this.x/t,this.y/t)},inverse:function(){return new e(-this.x,-this.y)},modulo:function(t){return new e(t.x?this.x%t.x:this.x,t.y?this.y%t.y:this.y)},exceeds:function(t){return this.x>t.x||this.y>t.y||!1},min:function(n){return new e(t(this.x,n.x),t(this.y,n.y))},max:function(t){return new e(n(this.x,t.x),n(this.y,t.y))},limit:function(i,r){return new e(t(n(this.x,i.x),r.x),t(n(this.y,i.y),r.y))},toString:function(t){return t=t||"px",this.x+t+","+this.y+t}});return playtotv.extend(e,{FREE:0,VERTICAL:1,HORIZONTAL:2,UP:3,RIGHT:4,DOWN:5,LEFT:6,ZERO:new e(0,0),parseFloat:function(t,n){return t=parseFloat(t),n=arguments.length<2?t:parseFloat(n),new e(t,n)}}),e});
playtotv.define("playtotv.css.Point",["playtotv.css.Vector"],function(t){"use strict";var n=new playtotv.Class({initialize:function(t,n,e){this.x=t,this.y=n,this.z=e},toVector:function(){return new t(this.x,this.y)}});return n.parseFloat=function(t,e,s){return t=parseFloat(t),e=arguments.length<2?t:parseFloat(e),s=arguments.length<3?t:parseFloat(s),new n(t,e,s)},n});
playtotv.define("playtotv.css.Matrix",["playtotv.css.Point"],function(t){"use strict";function i(t){return e.test(t)?e.exec(t)[1].split(",").map(parseFloat):n}var n=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],r="m11,m12,m13,m14,m21,m22,m23,m24,m31,m32,m33,m34,m41,m42,m43,m44".split(","),e=/matrix3?d?\(([^\)]+)\)/,s=new playtotv.Class({initialize:function(t){this.setMatrixValue(t)},setMatrixValue:function(t){var e="string"==typeof t?i(t):t||n;if(!(e instanceof Array))throw new Error("Failed to parse "+t);this.entities=e=6===e.length?[e[0],e[1],0,0,e[2],e[3],0,0,0,0,1,0,e[4],e[5],0,1]:e,r.forEach(function(t,i){this[t]=e[i]},this),this.a=this.m11,this.b=this.m12,this.c=this.m21,this.d=this.m22,this.e=this.m41,this.f=this.m42},multiply:function(t){var i,n,r,e,a=this.entities,o=t instanceof Array?t:t.entities,u=[];for(i=0;i<4;i++)for(n=0;n<4;n++){for(e=0,r=0;r<4;r++)e+=a[4*i+r]*o[4*r+n];u[4*i+n]=e}return new s(u)},translate:function(t){var i=t.x,n=t.y,r=t.z||0;return this.multiply([1,0,0,0,0,1,0,0,0,0,1,0,i,n,r,1])},scale:function(i){"number"==typeof i&&(i=t.parseFloat(i));var n=i.x,r=i.y,e=i.z||1;return this.multiply([n,0,0,0,0,r,0,0,0,0,e,0,0,0,0,1])},rotate:function(t,i,n){return t=t||0,i=arguments.length<2?t:i,n=arguments.length<3?t:n,this.rotateX(t).rotateY(i).rotateZ(n)},rotateX:function(t){var i=Math.cos(t),n=Math.sin(t);return this.multiply([1,0,0,0,0,i,-n,0,0,n,i,0,0,0,0,1])},rotateY:function(t){var i=Math.cos(t),n=Math.sin(t);return this.multiply([i,0,n,0,0,1,0,0,-n,0,i,0,0,0,0,1])},rotateZ:function(t){var i=Math.cos(t),n=Math.sin(t);return this.multiply([i,-n,0,0,n,i,0,0,0,0,1,0,0,0,0,1])},inverse:function(){var t=this.entities,i=t[0],n=t[1],r=t[2],e=t[4],a=t[5],o=t[6],u=t[8],h=t[9],m=t[10],l=a*m-o*h,c=o*u-e*m,f=e*h-a*u,p=r*h-n*m,y=i*m-r*u,v=n*u-i*h,x=n*o-r*a,M=r*e-i*o,w=i*a-n*e,g=i*l+n*c+r*f,d=new s([l/g,p/g,x/g,0,c/g,y/g,M/g,0,f/g,v/g,w/g,0,0,0,0,1]),z=new s([1,0,0,0,0,1,0,0,0,0,1,0,-t[12],-t[13],-t[14],1]);return z.multiply(d)},transformPoint:function(i){var n=this.entities,r=i.x,e=i.y,s=i.z||0;return new t(n[0]*r+n[4]*e+n[8]*s+n[12],n[1]*r+n[5]*e+n[9]*s+n[13],n[2]*r+n[6]*e+n[10]*s+n[14])},toString:function(){return"matrix3d("+this.entities.toString()+")"}});return s});
playtotv.define("playtotv.css.style",["playtotv.css.Matrix","playtotv.css.Vector"],function(t,e){"use strict";if("undefined"!=typeof window){var n=navigator.userAgent,o={gecko:/gecko\//i.test(n),trident:/trident\//i.test(n),webkit:/webkit\//i.test(n),presto:/presto\//i.test(n)},r="",i=o.webkit?"-webkit-":o.gecko?"-moz-":o.presto?"-o-":o.trident?"-ms-":"",s=i+"transform",f=i+"transform-origin",a=window.WebKitPoint&&window.webkitConvertPointFromPageToNode,u={set:window.getComputedStyle?function(t,e,n){t.style.setProperty(e,n,r)}:function(t,e,n){t.style[e]=n},get:window.getComputedStyle?function(t,e){var n=window.getComputedStyle(t,null);return n.getPropertyValue(e)}:function(t,e){var n=t.currentStyle||t.style;return n[e]},remove:window.getComputedStyle?function(t,e){t.style.removeProperty(e)}:function(t,e){t.style[e]=""},prefix:function(t){return i+t||""},getSize:function(t){return new e(t.offsetWidth,t.offsetHeight)},getInnerSize:function(t){return new e(t.clientWidth,t.clientHeight)},getOffset:function(t,n){for(var o=0,r=0;t&&t!==n;)o+=t.offsetLeft,r+=t.offsetTop,t=t.offsetParent;return new e(o,r)},fromNodeToPage:a?function(t,n){var o=new window.WebKitPoint(n.x,n.y),r=window.webkitConvertPointFromNodeToPage(t,o);return new e(r.x,r.y)}:function(t,e){var n=this.getFullTransform(t);return n.transformPoint(e).toVector()},fromPageToNode:a?function(t,n){var o=new window.WebKitPoint(n.x,n.y),r=window.webkitConvertPointFromPageToNode(t,o);return new e(r.x,r.y)}:function(t,e){var n=this.getFullTransform(t);return n.inverse().transformPoint(e).toVector()},setTransform:function(e,n){n instanceof t&&(n=n.toString()),this.set(e,s,n)},getTransform:function(e){var n=this.get(e,s);return new t(n)},removeTransform:function(t){this.remove(t,s)},getFullTransform:function(n){for(var o,r=new t;n;){if(o=this.getTransform(n)){var i=this.getTransformOrigin(n);i&&(o=(new t).translate(i.inverse()).multiply(o).translate(i)),r=r.multiply(o)}r=r.translate(new e(n.offsetLeft,n.offsetTop)),n=n.offsetParent}return r},getTransformOrigin:function(t){var n=(this.get(t,f)||"0 0").split(" ");return e.parseFloat(n[0],n[1])},setPosition:function(t,e){var n=t.style;n.left=e.x+"px",n.top=e.y+"px"},getPosition:function(t){return e.parseFloat(this.get(t,"left"),this.get(t,"top"))},setTranslate:function(t,e){this.set(t,s,"translate3d("+e+",0)")},getTranslate:function(t){var n=this.getTransform(t);return n.transformPoint(e.ZERO).toVector()}};return u}});
playtotv.define("playtotv.episode.episodeSessionAPI",[],function(){"use strict";return{get:{label:"episodeSession.get",url:"1/episodesessions/{episodeSessionId}"},getAsyncDataForEpisodeSession:{label:"episodeSession.getAsyncDataForEpisodeSession",url:"1/episodesessions/{episodeSessionId}/async",queryKeys:["phase"]},getEpisodeSessionStateAsChanges:{label:"episodeSession.getEpisodeSessionStateAsChanges",url:"1/episodesessions/{episodeSessionId}/statechanges/active"},getEpisodeSessionStateAsChangesSince:{label:"episodeSession.getEpisodeSessionStateAsChangesSince",url:"1/episodesessions/{episodeSessionId}/statechanges/active/{sinceVersion}"},getMaxScore:{label:"episodeSession.getMaxScore",url:"1/episodesessions/{episodeSessionId}/maxscore"},getNonClosedSessions:{label:"episodeSession.getNonClosedSessions",url:"1/episodesessions/nonclosed",queryKeys:["timeZone"]},getNonClosedSessionsForShow:{label:"episodeSession.getNonClosedSessionsForShow",url:"1/episodesessions/show/{showId}/nonclosed",queryKeys:["timeZone"]},getNonClosedSessionsForShowByName:{label:"episodeSession.getNonClosedSessionsForShowByName",url:"1/episodesessions/show/byname/{showName}/nonclosed",queryKeys:["timeZone"]},getSessionsInPhase:{label:"episodeSession.getSessionsInPhase",url:"1/episodesessions/state/{state}",queryKeys:["timeZone"]},getSessionsInPhaseForShow:{label:"episodeSession.getSessionsInPhaseForShow",url:"1/episodesessions/show/{showId}/state/{state}",queryKeys:["timeZone"]},getSessionsInPhaseForShowByName:{label:"episodeSession.getSessionsInPhaseForShowByName",url:"1/episodesessions/show/byname/{showName}/state/{state}",queryKeys:["timeZone"]},getUserStatistics:{label:"episodeSession.getUserStatistics",url:"1/episodesessions/{episodeSessionId}/users"},join:{label:"episodeSession.join",url:"1/episodesessions/{episodeSessionId}",type:"PUT"},joinAndGetState:{label:"episodeSession.joinAndGetState",url:"1/episodesessions/joinandgetstate",type:"PUT",queryKeys:["showName","showId","episodeSessionId","timeZone"]},joinInSync:{label:"episodeSession.joinInSync",url:"1/episodesessions/show/{showId}/episode/{episodeCode}/joinInSync",type:"PUT",dataKeys:["msSinceSessionStart","timeWindow","createIfNoneAvailable"]},leave:{label:"episodeSession.leave",url:"1/episodesessions/{episodeSessionId}",type:"DELETE"}}});
playtotv.define("playtotv.facebook.FacebookAdapter",[],function(){"use strict";var e=playtotv;return new e.Class({initialize:function(e){this.facebook=e},getLoginParams:function(e,t){var n=this.facebook;return n.login(e).then(function(e){return n.call("api",t,"/me").then(function(t){return{facebookId:e,fbsr:n.signedRequest,displayName:t.name,avatarUrl:"//graph.facebook.com/"+e+"/picture",privateProperties:Object.keys(t).reduce(function(e,n){var o=t[n];return e[n]="object"==typeof o?JSON.stringify(o):o,e},{})}})})},getCredentialParams:function(e){var t=this.facebook;return t.login(e).then(function(e){return{facebookId:e,fbsr:t.signedRequest}})}})});
playtotv.define("playtotv.facebook.FacebookPostWidget",["playtotv.widget.Widget"],function(t){"use strict";var o="data-facebook-",e=playtotv.Logger.get(this.id);return new playtotv.Class({extend:t,initialize:function(t,o){this._super(t),this.options=playtotv.params(o,{facebook:playtotv.REQUIRED,interactive:!0,timeout:void 0,content:{},process:function(t){return t},onResolve:function(t){e.d("onResolve, post id:",t)},onReject:function(t){e.d("onReject",t)}}),this.addEventListener(t,"click",this.onClick)},onClick:function(t){return t.preventDefault(),this.post(),!1},post:function(){var t=this.node,e=this.options,n=e.facebook,i=playtotv.extend({},e.content);playtotv.toArray(t.attributes).forEach(function(t){0===t.name.indexOf(o)&&(i[t.name.substr(o.length)]=t.value)}),playtotv.each(i,function(t,o){i[o]=e.process(i[o],o)}),n.post(i,e.interactive,e.timeout).then(e.onResolve,e.onReject)},callbacks:["onClick"]})});
playtotv.define("playtotv.fx.Animation",["playtotv.animationFrame"],function(t){"use strict";var i=new playtotv.Class({initialize:function(t){this.settings=playtotv.params(t,{alternate:!1,cycles:1,duration:playtotv.REQUIRED,fps:0,rate:1,start:0})},requestFrame:function(){this.playing=t.request(this.onTick)},cancelFrame:function(){this.playing&&(t.cancel(this.playing),delete this.playing)},play:function(t){this.playing&&this.stop(),this.animation=t=playtotv.params(t,this.settings),this.frame=t.fps?1e3/t.fps:0,this.startTime=t.start||Date.now(),this.frameTime=0,this.reversed=!1,this.onStart(),this.requestFrame()},pause:function(){this.playing&&(this.paused=!0,this.pauseTime=Date.now(),this.cancelFrame())},resume:function(){this.paused&&(delete this.paused,this.startTime=this.startTime+(Date.now()-this.pauseTime),this.requestFrame())},stop:function(t){this.cancelFrame(),t&&this.onFrame(0)},onTick:function(){var t=Date.now(),i=this.animation,e=i.cycles,a=(t-this.startTime)*i.rate,s=Math.max(0,a/i.duration),n=s>=e,r=e>1?s%1:Math.min(1,s);if(i.alternate){var o=s%2>1;o!==this.reversed&&(this.reversed=o,this.onCycle(o)),r=o?1-r:r}(!this.frame||n||t-this.frameTime>this.frame)&&(this.frameTime=t,this.onFrame(r)),n?this.onFinish():this.requestFrame()},onFrame:playtotv.AbstractFunction,onStart:function(){},onCycle:function(){},onFinish:function(){},callbacks:["onTick"]});return i});
playtotv.define("playtotv.fx.easing",[],function(){"use strict";var n={get:function(n){return this[n]||this.linear},set:function(n,t){if(this.hasOwnProperty(n))throw new Error('"'+n+'" easing is already defined.');return this[n]=t,t},linear:function(n){return n},quadin:function(n){return n*n},quadout:function(n){return n*(2-n)},quadinout:function(n){return n<.5?2*n*n:1-2*--n*n},cubicin:function(n){return n*n*n},cubicout:function(n){return--n*n*n+1},cubicinout:function(n){return n<.5?4*n*n*n:1+4*--n*n*n},quartin:function(n){return n*n*n*n},quartout:function(n){return-(--n*n*n*n-1)},quartinout:function(n){return n<.5?8*n*n*n*n:1-8*--n*n*n*n}};return n});
playtotv.define("playtotv.fx.Timeline",["playtotv.fx.Animation"],function(t){"use strict";var n=new playtotv.Class({extend:t,initialize:function(t){this._super(t),this.actions=[]},add:function(t,n){return n=playtotv.params(n,{callback:playtotv.REQUIRED,context:void 0,args:[]}),this.actions.push(playtotv.extend(n,{time:t,run:!0})),n},remove:function(t){var n=this.actions.indexOf(t);n>=0&&this.actions.splice(n,1)},reset:function(){this.actions.forEach(function(t){t.run=!1})},onStart:function(){this.reset()},onCycle:function(){this.reset()},onFrame:function(t){var n=this.animation,i=t*n.duration,a=this.reversed;this.actions.forEach(function(t){var n=i>=t.time;!t.run&&(a&&!n||!a&&n)&&(t.run=!0,t.callback.apply(t.context,t.args))})}});return n});
playtotv.define("playtotv.fx.Transition",["playtotv.fx.Animation","playtotv.fx.easing"],function(t,a){"use strict";var i=["callback","easing","from","to"],n=new playtotv.Class({extend:t,initialize:function(t){t=playtotv.params(t,{alternate:!1,callback:playtotv.REQUIRED,cycles:1,duration:playtotv.REQUIRED,easing:"linear",fps:0,from:0,rate:1,start:0,to:1}),this._super(playtotv.omit(t,i)),this.settings=t},onFrame:function(t){var i=this.animation||this.settings,n=this.ease||(this.ease=a.get(i.easing));i.callback(i.from+(i.to-i.from)*n(t))}});return n});
playtotv.define("playtotv.global.genericContentAPI",[],function(){"use strict";return{getCategory:{label:"genericContent.getCategory",url:"1/genericcontent/{category}"}}});
playtotv.define("playtotv.global.globalDataAPI",[],function(){"use strict";return{get:{label:"globalData.get",url:"1/globaldata/",queryKeys:["timeZone"]}}});
playtotv.define("playtotv.handlebars.hbsUtil",[],function(){"use strict";var t=playtotv,n={softException:function(t){var n=new Handlebars.Exception(t);return window.nextTick(function(){throw n}),""},getValue:function(t,n){return n instanceof Function?n.call(t):n},getHash:function(t,n){return Object.keys(n).reduce(function(e,r){return e[r]=this.getValue(t,n[r]),e}.bind(this),{})},getArgs:function(n,e,r,a,i){var o=this;e=t.toArray(e);var c=e.pop();e=e.map(function(t){return o.getValue(n,t)});var u={args:e,options:c,hash:this.getHash(n,c.hash)};if(r){r=r.split(", ");var s=r.length;a=void 0!==a?a:s,i=void 0!==i?i:s-a;var l=e.length;if(l<a||l>a+i){var f=r.slice(0,a),h=r.slice(a,i);this.softException(c.name+" got invalid number of arguments,  expected: "+a+(i?" to "+(a+i):"")+" ("+f.concat(h.map(function(t){return"["+t+"]"})).join(", ")+"), but got: "+l+" ("+e.join(", ")+")")}r.forEach(function(t,n){u[t]=e[n]})}return u},extendContext:function(n,e){return e instanceof Object&&Object.keys(e).length>0?t.extend({},n,e):n},callHelper:function(t,n){for(var e=arguments.length,r=Array(e>2?e-2:0),a=2;a<e;a++)r[a-2]=arguments[a];return Handlebars.helpers[t].apply(n,r)},delegateIfBlock:function(n,e,r,a,i){return a.fn?(i&&(a=t.extend({},a,{hash:{}})),this.callHelper(n,e,r,a)):r}};return n});
playtotv.define("playtotv.handlebars.helpers",["playtotv.handlebars.hbsUtil"],function(t){"use strict";var e=playtotv,r=e.util,n={var:function(){var r=t.getArgs(this,arguments,""),n=r.options,s=r.hash,a=n.fn,i=n.data;return a&&(i=Handlebars.createFrame(i)),e.extend(i,s),a?a(this,{data:i}):""},is:function(){var e=t.getArgs(this,arguments,"value1, value2"),r=e.value1,n=e.value2,s=e.options;return t.delegateIfBlock("if",this,r===n,s)},isnt:function(){var e=t.getArgs(this,arguments,"value1, value2"),r=e.value1,n=e.value2,s=e.options;return t.delegateIfBlock("if",this,r!==n,s)},default:function(){var e=t.getArgs(this,arguments,"value, def"),r=e.value,n=e.def;return void 0===r?n:r},switch:function(){var e=t.getArgs(this,arguments,"value, def",1),r=e.value,n=e.def,s=e.hash;return Object.keys(s).indexOf(r)>=0?s[r]:void 0===n?t.softException("No matching case or default for value: "+r):n},classes:function(){var r=t.getArgs(this,arguments),n=r.hash,s="";return e.each(n,function(t,e){t&&(s=s?s+" "+e:e)}.bind(this)),s},inc:function(){var e=t.getArgs(this,arguments,"x, y",1),r=e.x,n=e.y;return n=void 0===n?1:n,r+n},dec:function(){var e=t.getArgs(this,arguments,"x, y",1),r=e.x,n=e.y;return n=void 0===n?1:n,r-n},gt:function(){var e=t.getArgs(this,arguments,"x, y"),r=e.x,n=e.y,s=e.options;return t.delegateIfBlock("if",this,r>n,s)},lt:function(){var e=t.getArgs(this,arguments,"x, y"),r=e.x,n=e.y,s=e.options;return t.delegateIfBlock("if",this,r<n,s)},not:function(){var e=t.getArgs(this,arguments,"value"),r=e.value,n=e.options;return t.delegateIfBlock("if",this,!r,n)},or:function(){var e=t.getArgs(this,arguments),r=e.args,n=e.options,s=r.find(function(t){return t});return t.delegateIfBlock("if",this,s,n)},and:function(){var e=t.getArgs(this,arguments),r=e.args,n=e.options,s=r.reduce(function(t,e){return t&&e},!0);return t.delegateIfBlock("if",this,s,n)},inArray:function(){var e=t.getArgs(this,arguments,"list, value"),r=e.list,n=e.value,s=e.options;return t.delegateIfBlock("if",this,r.indexOf(n)>=0,s)},Array:function(){var e=t.getArgs(this,arguments),r=e.args,n=e.options;return t.delegateIfBlock("each",this,r,n)},Object:function(){var e=t.getArgs(this,arguments),r=e.options,n=e.hash;return t.delegateIfBlock("with",this,n,r)},toNumber:function(){var e=t.getArgs(this,arguments,"str"),r=e.str;return parseFloat(r)},toBool:function(){var e=t.getArgs(this,arguments,"str"),r=e.str;return"true"===r},lowerCase:function(){var e=t.getArgs(this,arguments,"text"),r=e.text;return(""+r).toLowerCase()},upperCase:function(){var e=t.getArgs(this,arguments,"text"),r=e.text;return(""+r).toUpperCase()},dashCase:function(){var e=t.getArgs(this,arguments,"text"),n=e.text;return r.dashCase(""+n)},sentenceCase:function(){var e=t.getArgs(this,arguments,"text"),r=e.text;return r=""+r,r[0].toUpperCase()+r.substr(1).toLowerCase()},titleCase:function(){var e=t.getArgs(this,arguments,"text"),n=e.text;return r.titleCase(""+n)},concat:function(){var e=t.getArgs(this,arguments),r=e.args;return r.join("")},join:function(){var e=t.getArgs(this,arguments,"array"),r=e.array,n=e.hash,s=e.options,a=s.fn,i=s.inverse,o=n.separator||", ",u=n.last||o;r=a?r.map(a):r.slice(0);var g=r.length;return 0===g?i?i(this):"":1===g?r[0]:r.slice(0,-1).join(o)+u+r[g-1]},split:function(){var e=t.getArgs(this,arguments,"str"),r=e.str,n=e.hash,s=e.options,a=n.separator||/,\s?/,i=r.length>0?r.split(a):[];return t.delegateIfBlock("each",this,i,s,!0)},inflect:function(){var e=t.getArgs(this,arguments,"count, singular, plural"),r=e.count,n=e.singular,s=e.plural,a=1===r?n:s;return a.replace(/%d/g,r)},truncate:function(){var e=t.getArgs(this,arguments,"str, len"),r=e.str,n=e.len,s=e.hash,a=s.dots||"..";return r.length>n&&(r=r.substr(0,n-a.length)+a),r},addURLParams:function(){var e=t.getArgs(this,arguments,"url",0),n=e.url,s=e.hash;return n=n||window.location.href,r.addURLParams(n,s)},getURLParams:function(){var e=t.getArgs(this,arguments,"url",0),n=e.url;return n=n||window.location.href,r.getURLParams(n)},getURLParam:function(){var e=t.getArgs(this,arguments,"urlOrKey, key",1),n=e.urlOrKey,s=e.key,a=s?n:"";return s=s||n,r.getURLParams(a)[s]},formatDate:function(){var e=t.getArgs(this,arguments,"pattern, date",1),n=e.pattern,s=e.date;return r.formatDate(n,s)},addCommas:function(){var e=t.getArgs(this,arguments,"number, separator",1,1),r=e.number,n=e.separator;void 0===n&&(n=",");var s=","===n?".":",",a=r.toString().split(".");return a[0].replace(/\B(?=(\d{3})+(?!\d))/g,n)+(a[1]?s+a[1]:"")},toFixed:function(){var e=t.getArgs(this,arguments,"value, digits",1,1),r=e.value,n=e.digits;return void 0===n&&(n=2),r.toFixed(n)},toString:function(){var e=t.getArgs(this,arguments,"value",1,0),r=e.value;return String(r)},pad:function(){var e=t.getArgs(this,arguments,"value, len, ch",1,2),n=e.value,s=e.len,a=e.ch;return r.pad(n,s,a)},seek:function(){var e=t.getArgs(this,arguments,"path, context",1),n=e.path,s=e.context;return s=s||this,r.seek(s,n)},eval:function(){var e=t.getArgs(this,arguments,"script, context",0),n=e.script,s=e.context,a=e.hash,i=e.options;return s=s||this,Object.keys(a).length>0&&(s=a),i.fn&&(n=i.fn(this)),r.eval(n,s)},filter:function(){var e=t.getArgs(this,arguments,"list, path, value",1),n=e.list,s=e.path,a=e.value,i=e.hash,o=e.options,u=i.mode,g=r.filter(n,s,a,u);return t.delegateIfBlock("each",this,g,o,!0)},order:function(){var e=t.getArgs(this,arguments,"list, path",1),n=e.list,s=e.path,a=e.hash,i=e.options,o=a.desc,u=r.order(n,s,o);return t.delegateIfBlock("each",this,u,i,!0)},paginate:function(){var e=t.getArgs(this,arguments,"list, page, size",1),n=e.list,s=e.page,a=e.size,i=e.options;s=parseInt(s,10),a=parseInt(a,10);var o=r.page(n,s,a);return t.delegateIfBlock("each",this,o,i,!0)},json:function(){var e=t.getArgs(this,arguments,"obj"),r=e.obj,n=e.hash;return n.pretty?JSON.stringify(r,null,"\t"):JSON.stringify(r)},hash:function(){var e=window.location.hash,r=t.getArgs(this,arguments),n=r.args,s=n.join("");if(!s)return e;var a=e.slice(1);return a&&(s=t.pathResolve(a,s)),"#"+s},helperMissing:function(){var e=arguments[arguments.length-1];t.softException("Unknown field or helper: "+e.name)}};return n});
playtotv.define("playtotv.pubsub.Subscription",[],function(){"use strict";var t=playtotv,e=t.util;return new t.Class({initialize:function(t,n){if(!("string"==typeof t||t instanceof RegExp))throw new TypeError("Invalid selector (not a string or RegExp)");if(!(n instanceof Function))throw new TypeError("Invalid handler (not a function)");"string"==typeof t&&t.indexOf("*")>=0&&(t=new RegExp("^"+e.escapeRegEx(t).replace(/\\\*/g,".*?")+"$")),this.selector=t,this.handler=n},match:function(t){var e=this.selector;return"string"==typeof e?e===t:e.test(t)},deliver:function(t,e){this.handler&&this.handler(t,e)},dispose:function(){t.dispose(this)}})});
playtotv.define("playtotv.model.ModelSubscription",["playtotv.pubsub.Subscription"],function(e){"use strict";var t=playtotv.util;return new playtotv.Class({extend:e,selectorRegex:/^([\w\*]+:[\w\*\.]+(=.*)?)|\*$/,initialize:function(e,i){if(!this.selectorRegex.test(e))throw new Error("Invalid selector string: "+e);if("*"===e)e=/.*/;else{var n=e.indexOf("=")===-1;n&&(e+="="),(n||e.indexOf("*")!==-1)&&(e=t.escapeRegEx(e),e=e.replace(/\\\*/g,"[^:\\.=]+"),e=new RegExp("^"+e))}this._super(e,i)},deliver:function(e){this.handler&&this.handler(e.value,e.action,e.key)}})});
playtotv.define("playtotv.pubsub.PubSub",["playtotv.pubsub.Subscription"],function(s){"use strict";function i(s,i){var n=s.indexOf(i);return n!==-1&&(s.splice(n,1),!0)}var n=playtotv;return new n.Class({initialize:function(){this.subscriptions=[],this.cancellables=[]},subscribe:function(i,n){var t=new s(i,n);return this.subscriptions.push(t),t},unsubscribe:function(s){var n=this.subscriptions;return s.dispose(),!!n&&i(n,s)},subscribeAll:function(s){var i,n=s.length,t=[];for(i=0;i<n;i++)t.push(this.subscribe.apply(this,s[i]));return t},unsubscribeAll:function(s){s=s||this.subscriptions;var i,n=s.length;for(i=0;i<n;i++)this.unsubscribe(s[i])},when:function(s){var n=this.cancellables,t=this;return new Promise.Cancellable(function(u){var e=this;n.push(e);var r=t.subscribe(s,function(s){u(s)});e.finally(function(){t.unsubscribe(r),i(n,e)})})},publish:function(s,i,n){var t,u,e,r=this.subscriptions,c=r.length;for(t=0;t<c;t++)u=r[t],e=u.match(s),e&&(n?u.deliver(i,s):nextTick(u.deliver,u,[i,s]))},dispose:function(){this.subscriptions.forEach(function(s){s.dispose()}),this.cancellables.forEach(function(s){s.cancel(new Promise.CancellationError("Disposed"))}),n.dispose(this)}})});
playtotv.define("playtotv.model.AbstractModel",["playtotv.model.ModelSubscription","playtotv.pubsub.PubSub"],function(t,e){"use strict";return new playtotv.Class({extend:e,initialize:function(){this._super()},toObject:playtotv.AbstractFunction,updateModel:playtotv.AbstractFunction,isRelatedModel:playtotv.AbstractFunction,getSelectorAction:function(t){var e=t.indexOf(":");return e===-1?void 0:t.substr(0,e)},getSelectorKey:function(t){var e=t.indexOf(":");if(e!==-1){var i=t.substring(e+1),n=i.indexOf("=");return n===-1?i:i.substring(0,n)}},getSelectorValue:function(t){var e=t.indexOf("=");return e===-1?void 0:t.substring(e+1)},getSelectorMatches:function(t){var e=this.getSelectorAction(t)||"*",i=this.getSelectorKey(t)||"*",n=this.getSelectorValue(t);if("remove"===e)throw new Error("Matching with remove action selector is not supported: "+t);if(!i||i.indexOf(".")!==-1)throw new Error("Only basic key matching is supported: "+t);var o=[];return playtotv.each(this.toObject(),function(t,e){"*"!==i&&e!==i||void 0!==n&&String(t)!==n||o.push({key:e,value:t})}),o},subscribe:function(e,i,n){var o=new t(e,i);return n&&this.getSelectorMatches(e).forEach(function(t){var e=t.key,i=t.value,n="init:"+e+"="+i,r={key:e,action:"init",value:i};nextTick(o.deliver,o,[r,n])}),this.subscriptions.push(o),o},when:function(t){if(void 0!==this.getSelectorValue(t)){var i=this.getSelectorMatches(t);if(i.length>0)return Promise.Cancellable.resolve(i[0].value)}return e.prototype.when.call(this,t)},publish:function(t,i,n){var o=i+":"+t+"="+n,r={key:t,action:i,value:n};e.prototype.publish.call(this,o,r)}})});
playtotv.define("playtotv.model.ObjectModel",["playtotv.model.AbstractModel"],function(i){"use strict";return new playtotv.Class({extend:i,initialize:function(i){this._super(),this.propertyKeys=[],this.childSubscriptionMap={},i&&this.copyProperties(i)},toObject:function(){var i,t,e={},r=this.propertyKeys,s=r.length;for(i=0;i<s;i++)t=r[i],e[t]=this[t];return e},updateModel:function(i){var t=this.propertyKeys,e=Object.keys(i),r=[];return t.filter(function(i){return e.indexOf(i)===-1}).forEach(function(i){r.push(this.removeProperty(i))}.bind(this)),e.filter(function(i){return t.indexOf(i)===-1}).forEach(function(t){this.addProperty(t,i[t])}.bind(this)),e.filter(function(i){return t.indexOf(i)!==-1}).forEach(function(t){r.push(this.changeProperty(t,i[t]))}.bind(this)),r},isRelatedModel:function(t){if(this===t)return!0;var e,r,s=this.childSubscriptionMap,n=Object.keys(s),o=n.length;for(e=0;e<o;e++)if(r=s[n[e]].model,r instanceof i&&r.isRelatedModel(t))return!0;return!1},subscribeChild:function(i,t){var e=t.subscribe("*",function(t,e,r){this.publish(i+"."+r,e,t)}.bind(this));this.childSubscriptionMap[i]={model:t,subscription:e}},unsubscribeChild:function(i){var t=this.childSubscriptionMap,e=t[i];e.model.unsubscribe(e.subscription),delete t[i]},addProperty:function(t,e){var r=this.propertyKeys,s=e instanceof i;if(r.indexOf(t)!==-1)throw new Error("Property with specified key already exists: "+t);if(t in this)throw new Error("Specified key is reserved: "+t);if(s&&e.isRelatedModel(this))throw new Error("Value is a model in a cyclic relationship with this model");r.push(t),this[t]=e,s&&this.subscribeChild(t,e),this.publish(t,"add",e)},changeProperty:function(t,e,r){r=r||{};var s=this[t],n=e instanceof i;if(this.propertyKeys.indexOf(t)===-1)throw new Error("Property with specified key does not exist: "+t);if(!r.force){if(e===s||r.json&&JSON.stringify(e)===JSON.stringify(s))return;if(n&&e.isRelatedModel(this))throw new Error("Value is a model in a cyclic relationship with this model")}return s instanceof i&&this.unsubscribeChild(t),this[t]=e,n&&this.subscribeChild(t,e),this.publish(t,"change",e),s},removeProperty:function(t){var e=this.propertyKeys,r=e.indexOf(t),s=this[t];if(r===-1)throw new Error("Property with specified key does not exist: "+t);return s instanceof i&&this.unsubscribeChild(t),e.splice(r,1),delete this[t],this.publish(t,"remove",s),s},setProperty:function(i,t,e){return this.propertyKeys.indexOf(i)!==-1?this.changeProperty(i,t,e):void this.addProperty(i,t)},copyProperties:function(i){var t=[];for(var e in i)i.hasOwnProperty(e)&&t.push(this.setProperty(e,i[e]));return t},dispose:function(){playtotv.each(this.childSubscriptionMap,function(i){i.model.unsubscribe(i.subscription)}),i.prototype.dispose.call(this)}})});
playtotv.define("playtotv.facebook.Facebook",["playtotv.model.ObjectModel"],function(e){"use strict";var t=playtotv,i=t.util,s=t.Logger.get(this.id),n=t.REQUIRED;return new t.Class({extend:e,initialize:function(e){this._super({status:null,id:null,accessToken:null,signedRequest:null}),e=t.params(e,{appId:n,version:"v2.3",cookie:!1,status:!0,xfbml:!1,frictionlessRequests:!1,hideFlashCallback:null,locale:"en_US",redirect:void 0,scope:void 0,timeout:2e4});var i=Promise.defer();this.appId=e.appId,this.version=e.version,this.locale=e.locale,this.redirect=e.redirect,this.scope=e.scope,this.initialized=new Promise.Cancellable(function(t,s){i.promise.then(t,s),e.timeout&&this.setTimeout(e.timeout)}),window.fbAsyncInit=function(){var s=window.FB;s.init(t.pick(e,["appId","version","cookie","status","xfbml","frictionlessRequests","hideFlashCallback"])),s.Event.subscribe("auth.authResponseChange",this.onStatusResponse),s.getLoginStatus(function(e){this.onStatusResponse(e),i.resolve(s)}.bind(this))}.bind(this),t.loadScript("//connect.facebook.net/"+this.locale+"/sdk.js",!0)},onStatusResponse:function(e){var t=e.authResponse||{};this.copyProperties({status:e.status,id:t.userID||null,accessToken:t.accessToken||null,signedRequest:t.signedRequest||null})},call:function(e,i){i=void 0!==i?i:2e4;var n=t.toArray(arguments).slice(2),o={what:e,timeout:i,args:n};s.s("FB."+e+"(",n,"), timeout: "+i);var r=this.initialized.then(function(i){var s=Promise.defer();return n.push(function(e){e&&e.error?s.reject(t.extend(new Error("Call failed"),o,e.error,{message:"Request error: "+e.error.message})):s.resolve(e)}),i[e].apply(i,n),s.promise});if(i){var a=t.extend({message:"Request timeout"},o);r.setTimeout(i,a)}return r},api:function(){var e=t.toArray(arguments);return e.unshift("api"),this.call.apply(this,e)},ui:function(){var e=t.toArray(arguments);return e.unshift("ui",!1),this.call.apply(this,e)},getFriends:function(e){return this.api(e,"/me/friends").then(function(e){return e.data})},login:function(e){return this.initialized.then(function(){return this.id?Promise.resolve(this.id):e?this.redirect?(this.loginByRedirect(),Promise.defer().promise):this.loginByDialog():Promise.reject(new Error("Login requires user interaction"))}.bind(this))},loginByDialog:function(){return this.initialized.then(function(e){var i=Promise.defer();return e.login(function(e){e.authResponse&&e.authResponse.userID?i.resolve(e.authResponse.userID):i.reject(t.extend(new Error("Login failed"),e))},{scope:this.scope}),i.promise}.bind(this))},loginByRedirect:function(e){window.top.location=i.addURLParams("https://www.facebook.com/"+this.version+"/dialog/oauth",{client_id:this.appId,response_type:"token",scope:this.scope||"",redirect_uri:e||this.redirect})},logout:function(e){return this.initialized.then(function(){return this.id?this.call("logout",e):Promise.resolve({status:this.status})}.bind(this))},post:function(e,t,i){return t&&this.redirect?(this.postByRedirect(e,this.redirect),Promise.defer().promise):this.login(t).then(function(){return t?this.postByDialog(e):this.postByAPI(e,i)}.bind(this))},postByAPI:function(e,t){return this.call("api",t,"/me/feed","post",e).then(function(e){return e.id})},postByDialog:function(e){return this.ui(t.extend({method:"feed"},e)).then(function(e){return e&&e.post_id||Promise.reject(t.extend(new Error("Post failed"),e))})},postByRedirect:function(e,s){window.top.location=i.addURLParams("https://www.facebook.com/dialog/feed",t.extend({app_id:this.appId,redirect_uri:s||this.redirect},e))},callbacks:["onStatusResponse"]})});
playtotv.define("playtotv.model.ArrayModel",["playtotv.model.AbstractModel"],function(i){"use strict";function t(i,t){var n,r=0,s=i.length;for(n=0;n<s;n++)i[n]===t&&r++;return r}return new playtotv.Class({extend:i,initialize:function(i){this._super(),this.array=[],this.childSubscriptions=[],i&&i.forEach(function(i){this.add(i)}.bind(this))},toObject:function(){return this.array.slice(0)},updateModel:function(i){var n,r,s=this.array,e=i.length,o=[];try{if(JSON.stringify(i)===JSON.stringify(s))return[]}catch(i){}for(n=s.length-1;n>=0;n--)r=s[n],t(i,r)<t(s,r)&&o.push(this.remove(n));for(n=0;n<e;n++)r=i[n],t(i,r)>t(s,r)&&this.add(r,n);for(n=0;n<e;n++)o.push(this.change(n,i[n]));return o},isRelatedModel:function(t){if(this===t)return!0;var n,r,s,e=this.childSubscriptions,o=e.length;for(n=0;n<o;n++)if(r=e[n],r&&(s=r.model,s instanceof i&&s.isRelatedModel(t)))return!0;return!1},subscribeChild:function(i,t){var n=this.childSubscriptions,r=t.subscribe("*",function(t,r,e){i=n.indexOf(s),this.publish(i+"."+e,r,t)}.bind(this)),s={model:t,subscription:r};n[i]=s},unsubscribeChild:function(i){var t=this.childSubscriptions,n=t[i];n.model.unsubscribe(n.subscription),t[i]=null},add:function(t,n){var r=this.array,s=r.length,e=this.childSubscriptions,o=t instanceof i;if(arguments.length<2&&(n=s),n<0)throw new RangeError("Index out of bounds: "+n);if(o&&t.isRelatedModel(this))throw new Error("Item is a model in a cyclic relationship with this model");n<s?(r.splice(n,0,t),e.splice(n,0,null)):(r[n]=t,e[n]=null),o&&this.subscribeChild(n,t),this.publish(n,"add",t)},change:function(t,n){var r=this.array,s=n instanceof i;if(t<0||t>=r.length)throw new RangeError("Index out of bounds: "+t);var e=r[t];if(n!==e){if(s&&n.isRelatedModel(this))throw new Error("Item is a model in a cyclic relationship with this model");return e instanceof i&&this.unsubscribeChild(t),r[t]=n,s&&this.subscribeChild(t,n),this.publish(t,"change",n),e}},remove:function(t){var n=this.array;if(arguments.length<1)t=0;else if(t<0||t>=n.length)throw new RangeError("Index out of bounds: "+t);var r=n[t];return r instanceof i&&this.unsubscribeChild(t),n.splice(t,1),this.childSubscriptions.splice(t,1),this.publish(t,"remove",r),r},removeWhere:function(i){if(!(i instanceof Function)){var t=i;i=function(i){return i===t}}for(var n=[],r=this.array,s=r.length-1;s>=0;s--)i(r[s])&&n.push(this.remove(s));return n},clear:function(){for(var i=[],t=this.array.length-1;t>=0;t--)i.push(this.remove(t));return i},set:function(i,t){return i<this.array.length?this.change(i,t):void this.add(t,i)},dispose:function(){this.array.length=0,this.childSubscriptions.forEach(function(i){i&&i.model.unsubscribe(i.subscription)}),i.prototype.dispose.call(this)}})});
playtotv.define("playtotv.model.modelUtil",["playtotv.model.AbstractModel","playtotv.model.ArrayModel","playtotv.model.ObjectModel"],function(t,e,n){"use strict";return{create:function(o,i){if(o instanceof t){if(i)return o;throw new TypeError("Value is already a Model")}if(o instanceof Array)return new e(o.map(function(t){return this.create(t,!0)}.bind(this)));if("object"==typeof o&&null!==o)return new n(Object.keys(o).reduce(function(t,e){return t[e]=this.create(o[e],!0),t}.bind(this),{}));if(i)return o;throw new TypeError("Value can not be modelified")},toObject:function(e){var n=e.toObject();return playtotv.each(n,function(e,o){e instanceof t&&(n[o]=this.toObject(e))}.bind(this)),n},update:function(o,i){if(!(o instanceof t))throw new TypeError("Model argument is not a model");if(i instanceof t)throw new TypeError("Source is already a Model");var r=o instanceof e,a=r?[]:{};playtotv.each(i,function(i,c){if(i instanceof t)throw new Error("Source value is already a Model");var s=r?o.array[c]:o[c],f=i instanceof Array,l=!f&&"object"==typeof i&&null!==i;l&&s instanceof n||f&&s instanceof e?(this.update(s,i),a[c]=s):l||f?a[c]=this.create(i):a[c]=i}.bind(this));var c=o.updateModel(a);c.filter(function(e){return e instanceof t}).forEach(function(t){this.dispose(t)}.bind(this))},dispose:function(e){playtotv.each(e.toObject(),function(e){e instanceof t&&this.dispose(e)}.bind(this)),e.dispose()}}});
playtotv.define("playtotv.logUtil",["playtotv.model.modelUtil"],function(t){"use strict";var n=playtotv,o=n.util;return{logPubSub:function(e,r,a){a=n.params(a,{blacklist:[],name:""});var i=a.blacklist.map(function(t){return o.globToRegEx(t)}),l=a.name;return l=l?l+".":"",e.subscribe(/.*/,function(n,o){if(!i.find(function(t){return t.test(o)})){n&&n.toObject&&(n=t.toObject(n));var e=l+o;"object"==typeof n?r(e,n):r(e+": "+n)}})},logModel:function(e,r,a){a=n.params(a,{blacklist:[],name:""});var i=a.blacklist.map(function(t){return o.globToRegEx(t)}),l=a.name;return l=l?l+" ":"",e.subscribe("*",function(n,o,e){if(!i.find(function(t){return t.test(e)})){n&&n.toObject&&(n=t.toObject(n));var a=l+o+" "+e;"object"==typeof n?r(a,n):r(a+" => "+n)}})},logMethod:function(t,o,e,r){r=r||o;var a=t[o];t[o]=function(){var o=n.toArray(arguments);return e(r,o),a.apply(t,o)}},logMethods:function(t,e,r){r=n.params(r,{blacklist:[],name:""});var a=r.blacklist.map(function(t){return o.globToRegEx(t)}),i=r.name;i=i?i+".":"";for(var l in t)t[l]instanceof Function&&!a.find(function(t){return t.test(l)})&&this.logMethod(t,l,e,i+l)}}});
playtotv.define("playtotv.MutationObserver",[],function(){"use strict";if("undefined"!=typeof window){var t=playtotv.event,e={type:null,target:null,addedNodes:[],removedNodes:[],previousSibling:null,nextSibling:null,attributeName:null,attributeNamespace:null,oldValue:null},i={childList:!1,attributes:!1,characterData:!1,subtree:!1,attributeOldValue:!1,characterDataOldValue:!1,attributeFilter:!1},r={DOMNodeInserted:function(t,i,r){var a=t.target;return i.subtree||a.parentNode===r?playtotv.params({type:"childList",target:a.parentNode,addedNodes:[a],previousSibling:a.previousSibling,nextSibling:a.nextSibling},e):null},DOMNodeRemoved:function(t,i,r){var a=t.target;return i.subtree||a.parentNode===r?playtotv.params({type:"childList",target:a.parentNode,removedNodes:[a],previousSibling:a.previousSibling,nextSibling:a.nextSibling},e):null},DOMAttrModified:function(t,i,r){var a=t.attrName,n=i.attributeFilter;return!i.subtree&&t.target!==r||n&&!(n.indexOf(a)>=0)?null:playtotv.params({type:"attributes",target:t.target,attributeName:a,oldValue:i.attributeOldValue?t.prevValue:null},e)},DOMCharacterDataModified:function(t,i,r){return i.subtree||t.target===r?playtotv.params({type:"characterData",target:t.target,oldValue:i.characterDataOldValue?t.prevValue:null},e):null}},a=new playtotv.Class({initialize:function(e,i,a){this.node=e,this.proxyEvent=i,this.observer=a,this.processor=r[i],t.addListener(e,i,this.onModified)},onModified:function(t){var e=this.observer,i=this.processor(t,e.options,this.node);i&&e.addRecord(i)},disconnect:function(){t.removeListener(this.node,this.proxyEvent,this.onModified),delete this.node,delete this.proxyEvent,delete this.observer,delete this.processor},callbacks:["onModified"]}),n=window.MutationObserver||window.WebkitMutationObserver||window.MozMutationObserver||new playtotv.Class({initialize:function(t){this.callback=t,this.listeners=[],this.records=[]},observe:function(t,e){if(e=this.options=playtotv.params(e,i),!e.childList&&!e.attributes&&!e.characterData)throw new Error("An invalid or illegal string was specified");var r=this.listeners;e.childList&&r.push(new a(t,"DOMNodeInserted",this),new a(t,"DOMNodeRemoved",this)),e.attributes&&r.push(new a(t,"DOMAttrModified",this)),e.characterData&&r.push(new a(t,"DOMCharacterDataModified",this))},addRecord:function(t){this.records.push(t),this.notify()},takeRecords:function(){var t=this.records;return this.records=[],t},notify:function(){var t=this.takeRecords();t.length&&this.callback(t)},disconnect:function(){this.listeners.forEach(function(t){t.disconnect()}),this.listeners=[]}});return n}});
playtotv.define("playtotv.mvc.helpers",["playtotv.handlebars.hbsUtil","playtotv.handlebars.helpers"],function(t,e){"use strict";var a=playtotv,r=a.util,n=[];return a.extend(e,{call:function(){var e=t.getArgs(this,arguments),a=e.args,n=e.hash,s=e.options,i=a.shift(),l=s.data.root;if("object"==typeof i&&(l=i,i=a.shift()),!i)return t.softException("Call methodPath argument missing");s.fn&&a.push(s.fn(this)),Object.keys(n).length>0&&a.push(n);var o=r.seekRef(l,i),h=o&&o.value;if(!h)return t.softException("Call method not found: "+i);try{return h.apply(o.object,a)}catch(e){return t.softException("Call "+e.name+":"+e.message)}},script:function(){var e=t.getArgs(this,arguments,"script",0),a=e.script,r=e.hash,n=e.options;n.fn&&(a=n.fn(this)),a=a.trim().replace(/\s+/g," ");var s=Object.keys(r).length>0?JSON.stringify([a,r]):a;return s=Handlebars.Utils.escapeExpression(s),new Handlebars.SafeString(s)},on:function(){var t=a.toArray(arguments),r=t.shift(),n=e.script.apply(this,t);return new Handlebars.SafeString("on-"+r+'="'+n+'"')},widgets:function(){var e=t.getArgs(this,arguments),a=e.args,r=JSON.stringify(a);return r=Handlebars.Utils.escapeExpression(r),new Handlebars.SafeString('widgets="'+r+'"')},widget:function(){var e=t.getArgs(this,arguments,"name"),a=e.name,r=e.hash;return[a,r]},templatePath:function(){var e=t.getArgs(this,arguments,"path",0),a=e.path,s=e.options,i=n[n.length-1]||s.data.root.router.pattern;return void 0===a?i:r.resolvePath(i,a)},partial:function(){var e=t.getArgs(this,arguments,"path, context",1),a=e.path,r=e.context,s=e.hash,i=e.options;r=r||this,Object.keys(s).length>0&&(r=s,i.hash={});var l=i.fn;l&&(Handlebars.registerPartial("@partial-block",l),delete i.fn);var o=t.callHelper("templatePath",this,a,i),h=Handlebars.partials[o]||Handlebars.templates[o];if(!h)return t.softException("Partial not found: "+o);n.push(o);var p=new Handlebars.SafeString(h(r,i));return n.pop(),l&&Handlebars.unregisterPartial("@partial-block"),p},registerPartial:function(){var e=t.getArgs(this,arguments,"path"),a=e.path,r=e.options,n=t.callHelper("templatePath",this,a,r);Handlebars.registerPartial(n,r.fn)}})});
playtotv.define("playtotv.mvc.Router",["playtotv.pubsub.PubSub"],function(t){"use strict";var e=playtotv;return new e.Class({extend:t,initialize:function(t){t=e.params(t,{root:"index",rescue:"route-not-found",patterns:e.REQUIRED}),this._super(),this.root=t.root,this.rescue=t.rescue,this.routes=t.patterns.map(function(t){return{pattern:t,regex:new RegExp("^"+t.replace(/__\w+__/g,"([^/]*)")+"$"),keys:(t.match(/__\w+__/g)||[]).map(function(t){return t.substr(2,t.length-4)})}}),window.onhashchange=this.update.bind(this),this.update()},find:function(t){return e.find(this.routes,function(e){return e.pattern===t})||e.find(this.routes,function(e){return e.regex.test(t)})},getParams:function(t,e){var r=(e.match(t.regex)||[]).slice(1);return r.reduce(function(e,r,n){return e[t.keys[n]]=r,e},{})},update:function(){var t=window.location,r=t.hash.substr(1);if(r||(r=this.root,t.hash="#"+r),/\/$/.test(r)&&(r+="index"),r!==this.path){this.path=r;var n,s=this.find(r);if(s)n=this.getParams(s,r);else{var i=this.rescue;if(s=this.find(i),!s)throw new Error("Could not find rescue route: "+i);n=e.extend(this.getParams(s,i),{path:r})}var a=s.pattern;this.pattern=a,this.params=n,this.publish(a,n)}}})});
function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}playtotv.define("playtotv.PauseDog",[],function(){"use strict";var t=playtotv,e=new t.Logger(this.id);return function(){function s(){_classCallCheck(this,s),this.pauseCallbacks=[],this.interval=1e3,this.scheduleTick()}return s.prototype.scheduleTick=function(){this.lastTick=Date.now(),this.timeout=setTimeout(this.onTick.bind(this),this.interval)},s.prototype.add=function(t,e){var s={threshold:t,callback:e};return this.pauseCallbacks.push(s),s},s.prototype.remove=function(t){var e=this.pauseCallbacks,s=e.indexOf(t);s!==-1&&e.splice(s,1)},s.prototype.onTick=function(){var t=Date.now(),s=t-this.interval-this.lastTick,i="Paused: "+Math.round(s/1e3)+" seconds";s>1e4?e.d(i):s>1e3&&e.s(i),this.pauseCallbacks.filter(function(t){return s>t.threshold}).forEach(function(t){return t.callback(s)}),this.scheduleTick()},s.prototype.dispose=function(){this.pauseCallbacks.length=0,clearTimeout(this.timeout),t.dispose(this)},s}()});
function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}playtotv.define("playtotv.mvc.BindWidget",["playtotv.widget.Widget"],function(t){"use strict";var e=playtotv,n=e.event;return function(t){function o(n,r){var a=this;_classCallCheck(this,o),t.call(this,n);var i=e.params(r,{app:null,controller:e.REQUIRED,path:e.REQUIRED}),c=i.controller,l=i.path;e.extend(this,r);var u=c.seek(l);void 0!==u?this.updateInput(u):this.updateController();var p=function(){return a.updateController()};this.addEventListener(n,"change",p),this.addEventListener(n,"keyup",p),this.subscribe(c,l,function(t){return a.updateInput(t)})}return _inherits(o,t),o.prototype.updateController=function(){var t=this.node,e="checkbox"===t.type?t.checked:t.value;this.controller.set(this.path,e)},o.prototype.updateInput=function(t){var e=this.node;"checkbox"===e.type?t!==e.checked&&(e.checked=t,n.triggerNative(e,"change")):t!==e.value&&(e.value=t)},o}(t)});
function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}playtotv.define("playtotv.mvc.UpdateWidget",["playtotv.widget.Widget","playtotv.cron"],function(t,e){"use strict";var o=playtotv;return function(t){function n(r,a){_classCallCheck(this,n),a=o.params(a,{app:null,controller:o.REQUIRED,callback:null,repeat:6e5}),t.call(this,r);var l=a.controller,c=a.callback||l.update.bind(l);this.job=e.at(0,c,{repeat:a.repeat})}return _inherits(n,t),n.prototype.dispose=function(){e.cancel(this.job),t.prototype.dispose.call(this)},n}(t)});
function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}playtotv.define("playtotv.mvc.Controller",["playtotv.mvc.BindWidget","playtotv.mvc.UpdateWidget","playtotv.pubsub.PubSub"],function(t,e,o){"use strict";var r=playtotv,n=r.util,i=r.REQUIRED;return function(o){function s(n){_classCallCheck(this,s);var p=r.params(n,{name:i,app:i,stored:void 0,store:{}}),a=p.name,c=p.app,u=p.stored,l=p.store;o.call(this),this.name=a,this.app=c,this.storeKeys=Object.keys(l),this.deserialize(l,u),this.setWidgets([["bind",t],["update",e]])}return _inherits(s,o),s.prototype.serialize=function(){return r.pick(this,this.storeKeys)},s.prototype.deserialize=function(t,e){r.extend(this,t,e)},s.prototype.setWidget=function(t,e){var o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];return o.controller=this,this.app.setWidget(this.name+"-"+t,e,o)},s.prototype.setWidgets=function(t){var e=this;t.forEach(function(t){return e.setWidget.apply(e,t)})},s.prototype.flush=function(){return this.app.flush(this.name)},s.prototype.seek=function(t){return n.seek(this,t)},s.prototype.set=function(t,e,o){o=r.params(o,{json:"object"==typeof e,force:!1});var i=n.seekRef(this,t);if(!i)throw new Error("Can not set property on undefined object: "+t);var s=i.value;(o.force||!o.json&&e!==s||o.json&&JSON.stringify(e)!==JSON.stringify(s))&&(i.object[i.key]=e,this.publish(t,e))},s.prototype.toggle=function(t,e){e=void 0===e?!this.seek(t):"string"==typeof e?"true"===e:!!e,this.set(t,e)},s}(o)});
function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}playtotv.define("playtotv.episode.EpisodeController",["playtotv.mvc.Controller","playtotv.episode.episodeSessionAPI"],function(t,e){"use strict";var n=playtotv,i=n.util,o=n.Logger.get(this.id);return function(t){function s(e,o){_classCallCheck(this,s),o=n.params(o,{timeZone:i.getTimeZone(),showName:void 0,showId:void 0,episodeSessionId:void 0});var a=e.stored||{};t.call(this,e,{model:{current:null,waiting:!1,episodeInteractionUserDataMap:a.episodeInteractionUserDataMap||{}}}),this.options=o,this.addMethods(["getEpisode","getInteraction","getCurrentInteraction","getNextAsyncInteraction","submitInteraction"]),this.predictionTypes=["PREDICTION"],this.scope.observe("user.online",this.start.bind(this)),this.scope.subscribe("change:push.stream",this.onStreamChange.bind(this)),this.scope.subscribe("push.EPISODESESSION-STATECHANGE",this.onChangeEvent.bind(this)),this.scope.subscribe("push.EPISODESESSION-INTERACTIONSTATEUPDATE",this.onUpdateEvent.bind(this))}return _inherits(s,t),s.prototype.start=function(t){!this.hasStarted&&t&&(this.join(),this.hasStarted=!0)},s.prototype.adaptEpisode=function(t){return n.extend(t,{interactionMap:{},interactionQueue:[],asyncInteractions:{},position:"BEFORE"})},s.prototype.join=function(){var t=this;return this.scope.call("server.call",e.joinAndGetState,this.options).then(function(e){var n=e.episodeSession;if(!n)return t.set("waiting",!0),Promise.race([t.scope.when("push.EPISODESESSION-OPENED"),t.scope.when("change:push.stream")]).then(function(){return t.join()});var i=t.adaptEpisode(n);return t.set("waiting",!1),t.set("current",i),e.state.stateChanges.forEach(function(e){t.onStateChange(e,!0)}),i}).catch(function(e){return o.e("join()",e),t.set("current",null),Promise.delay(5e3).then(function(){return t.join()})})},s.prototype.checkState=function(){var t=this,n=this.getEpisode();this.checkingState||(this.checkingState=!0,this.scope.call("server.call",e.getEpisodeSessionStateAsChangesSince,{episodeSessionId:n.id,sinceVersion:n.version?n.version+1:1}).then(function(e){e.stateChanges.forEach(function(e){return t.onStateChange(e)})}).finally(function(){t.checkingState=!1}))},s.prototype.getEpisode=function(){return this.model.current},s.prototype.getInteraction=function(t){var e=this.getEpisode();return e&&e.interactionMap[t]},s.prototype.getCurrentInteraction=function(){var t=this.getEpisode();return t&&t.interactionQueue[0]},s.prototype.getAsyncInteractions=function(t){var n=this,i=this.getEpisode();t=t||i.currentPhase;var o=i.asyncInteractions[t];return o?Promise.resolve(o):this.scope.call("server.call",e.getAsyncDataForEpisodeSession,{episodeSessionId:i.id,phase:t}).then(function(e){return o=e.map(function(t){var e=n.upsertInteraction(t);return e.state="ANSWER",e}),i.asyncInteractions[t]=o,o})},s.prototype.getNextAsyncInteraction=function(t){return t=t||this.getEpisode().currentPhase,this.getAsyncInteractions(t).then(function(t){return t.find(function(t){return!t.data})})},s.prototype.submitInteraction=function(t,e,n,i){var o=this;return this.scope.call("server.toServerTime").then(function(s){var a=o.getEpisode(),r=a.interactionMap[e],c=r.stateTimeMap.ANSWER;return n.episodeSessionId=a.id,n.clientAnswerTime&&(n.clientAnswerTime=s-c),o.scope.call("server.call",t,n).then(function(t){return i&&(t=i(r.data,t)),o.setInteractionUserData(a.id,r,t),o.publish("interaction-submitted-"+e,t),t})})},s.prototype.getInteractionUserData=function(t,e){var n=this.model.episodeInteractionUserDataMap[t];return n&&n[e]},s.prototype.setInteractionUserData=function(t,e,i){var o=n.pick(this.model.episodeInteractionUserDataMap,[t]),s=o[t]||(o[t]={});e.data=s[e.id]=i,this.set("episodeInteractionUserDataMap",o,{force:!0})},s.prototype.upsertInteraction=function(t){var e=t.interactionId,n=t.data||{},i=this.getEpisode(),o=i.interactionMap,s=o[e];return s||(s=o[e]={id:e,type:t.type,stateTimeMap:{},stateDurationMap:{},data:this.getInteractionUserData(i.id,e)}),n.interactionContent&&(s.content=n.interactionContent),n.interactionStats&&(s.stats=n.interactionStats),n.interactionUserData&&this.setInteractionUserData(i.id,s,n.interactionUserData),s},s.prototype.queueInteraction=function(t){var e=this.getEpisode(),n=e.interactionQueue,i=n.indexOf(t);i!==-1&&n.splice(i,1);var o=t.state,s=t.type;"FINISHED"===o||"AWAITING_RESULTS"===o&&this.predictionTypes.indexOf(s)>=0||n.unshift(t)},s.prototype.updateInteractionPosition=function(t){var e=t.content||{},n=this.getEpisode();n.position="FINISHED"===t.state&&"true"===e.lastquestion?"AFTER":"BETWEEN"},s.prototype.onStreamChange=function(){this.getEpisode()&&this.checkState()},s.prototype.onChangeEvent=function(t){var e=t.payload,n=this.getEpisode();n&&e.episodeSessionId===n.id&&this.onStateChange(e)},s.prototype.onStateChange=function(t,e){var n=this.getEpisode(),i=n.version,s=t.subject,a=t.version;if(a<=i)return void o.d("onStateChange: Skipping: "+a+" (already at: "+i+")");if(a>i+1)return o.d("onStateChange: Missed changes between: "+i+" and "+a),void this.checkState();var r=function(n){e||this.publish(n,t)}.bind(this);switch(s){case"PHASE":this.onPhaseChange(t,e);break;case"INTERACTION":this.onInteractionChange(t,e);break;case"LEADERBOARD_UPDATED":r("leaderboard-update");break;case"LEADERBOARD_FINAL":r("leaderboard-final");break;default:o.d("onStateChange: No handler defined for subject: "+s)}n.version=a},s.prototype.onPhaseChange=function(t,e){var n=this.getEpisode(),i=t.sessionPhase;n.currentPhase=i,e||this.publish("phase-change-"+i,t),"CLOSED"===i&&(this.set("current",null),this.join())},s.prototype.onInteractionChange=function(t,e){var n=this.upsertInteraction(t),i=t.interactionState;n.state=i,n.stateTimeMap[i]=t.time,n.stateDurationMap[i]=t.duration,t.interaction=n,this.queueInteraction(n),this.updateInteractionPosition(n),e||this.publish("interaction-change-"+t.interactionId,t)},s.prototype.onUpdateEvent=function(t){var e=t.payload,n=this.getEpisode();if(n&&e.episodeSessionId===n.id){var i=JSON.stringify(this.getInteraction(e.interactionId)),o=this.upsertInteraction(e);JSON.stringify(o)!==i&&(e.interaction=o,this.publish("interaction-update-"+e.interactionId,e))}},s.prototype.serialize=function(t){return n.pick(t,["episodeInteractionUserDataMap"])},s}(t)});
function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}playtotv.define("playtotv.fx.EffectsController",["playtotv.mvc.Controller"],function(t){"use strict";var e=playtotv,n=e.dom;return function(t){function o(n,i){_classCallCheck(this,o),i=e.params(i,{transitions:{},defaults:{},fxDelay:250}),t.call(this,n),this.addMethods(["once"]),this.transitionMap=i.transitions,this.defaultMap=i.defaults,this.onceMap={},this.delay=i.fxDelay;var a=this.scope.view;a.nodeAddedListeners.push(this.onNodeAdded.bind(this)),a.nodeRemoveListeners.push(this.onNodeRemove.bind(this))}return _inherits(o,t),o.prototype.once=function(t,e){if(!this.transitionMap[e])throw new Error("Unknown transition: "+e);this.onceMap[t]=e},o.prototype.getSelectors=function(){return e.union(Object.keys(this.defaultMap),Object.keys(this.onceMap))},o.prototype.getTransition=function(t){var e=this.onceMap[t]||this.defaultMap[t];return this.transitionMap[e]},o.prototype.onNodeRemove=function(t){var e=this,o=!1;return this.getSelectors().filter(function(e){return n.matches(e,t)}).forEach(function(n){var i=e.getTransition(n);e.playAnimation(t,i.leave),o=!0}),o?this.delay:0},o.prototype.onNodeAdded=function(t){var e=this;this.getSelectors().filter(function(e){return n.matches(e,t)}).forEach(function(n){var o=e.getTransition(n);e.playAnimation(t,o.enter),delete e.onceMap[n]})},o.prototype.playAnimation=function(t,e){if(e){var o=n.getData(t,"fx-animation");o&&(n.removeData(t,"fx-animation"),t.classList.remove(o)),n.setData(t,"fx-animation",e),t.classList.add(e)}},o}(t)});
function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}playtotv.define("playtotv.global.GlobalController",["playtotv.global.genericContentAPI","playtotv.global.globalDataAPI","playtotv.mvc.Controller","playtotv.cron"],function(t,e,o,n){"use strict";var a=playtotv,r=a.util;return function(o){function i(t,e){var s=this;_classCallCheck(this,i),e=a.params(e,{timeZone:r.getTimeZone()}),o.call(this,t),this.getContent=Promise.limit(this.getContentNow,6e5),this.addMethods(["update","getContent"]),this.options=e;var l=this.update.bind(this);n.at(Date.now(),l,{repeat:3e5}),this.scope.subscribe("push.GLOBALDATA-REPLACED",function(t){return s.onData(t.payload)}),this.scope.subscribe("push.GLOBALDATA-UPDATED",function(t){return s.onUpdate(t.payload)})}return _inherits(i,o),i.prototype.update=function(){this.scope.call("server.call",e.get,this.options).then(this.onData.bind(this))},i.prototype.getContentNow=function(e){return this.scope.call("server.call",t.getCategory,{category:e})},i.prototype.onData=function(t){var e=this;a.each(t,function(t,o){e.set(o,t)})},i.prototype.onUpdate=function(t){var e=t.category,o=t.object,n=t.uniqueIdField,r=this.model[e]||[],i=r.find(function(t){return t[n]===o[n]});i?a.extend(i,o):r.push(o),this.set(e,r,{force:!0})},i}(o)});
function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}playtotv.define("playtotv.Timer",[],function(){"use strict";return function(){function t(){_classCallCheck(this,t),this.t0=Date.now(),this.accounted=0,this.timings=[]}return t.prototype.now=function(){return Date.now()},t.prototype.start=function(){this.tx=Date.now()},t.prototype.end=function(t){var n=Date.now()-this.tx;delete this.tx,this.accounted+=n,this.timings.push(t+": "+n)},t.prototype.toString=function(){var t=Date.now()-this.t0,n=this.timings.join(", "),i=t-this.accounted;return t+"ms ("+n+") +"+i},t}()});
function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}playtotv.define("playtotv.mvc.View",["playtotv.pubsub.PubSub","playtotv.Timer"],function(e,t){"use strict";function o(e){var t=window.Polymer;return t?t.dom(e):e}function r(e,t){e.domNode=t;var n,i=e.childNodes,a=o(t).childNodes,d=i.length;for(n=0;n<d;n++)r(i[n],a[n])}function n(e,t){var o=e.nodeType;if(o!==t.nodeType)return!1;if(o===c||o===h)return!0;if(e.nodeName!==t.nodeName)return!1;var r=e.id,n=t.id;if(r||n)return r===n;if(r=e.getAttribute("view-id"),n=t.getAttribute("view-id"),r||n)return r===n;var i,a,d,s,l=e.attributes;for(i=0,a=l.length;i<a;i++)if(d=l[i],s=d.name,"class"!==s&&t.getAttribute(s)!==d.value)return!1;for(l=t.attributes,i=0,a=l.length;i<a;i++)if(d=l[i],s=d.name,"class"!==s&&e.getAttribute(s)!==d.value)return!1;return!0}function i(e,t){var o,r,i=t.length;for(o=0;o<i;o++)if(r=t[o],n(e,r))return t.splice(o,1)[0]}function a(e,t,o,r){var n,i,a,d,s,l;for(n=t.attributes,i=0,a=n.length;i<a;i++)d=n[i],s=d.name,l=d.value,"class"!==s&&e.getAttribute(s)!==d.value&&r.push({action:"set-attr",node:o,name:s,value:l});for(n=e.attributes,i=0,a=n.length;i<a;i++)d=n[i],s=d.name,"class"===s||t.hasAttribute(s)||r.push({action:"remove-attr",node:o,name:s})}function d(e,t,o,r){var n,i,a,d=e.classList,s=t.classList;for(n=0,a=s.length;n<a;n++)i=s[n],d.contains(i)||r.push({action:"add-class",node:o,name:i});for(n=0,a=d.length;n<a;n++)i=d[n],s.contains(i)||r.push({action:"remove-class",node:o,name:i})}function s(e,t,o){var r,n,l,f,p=e.childNodes,m=Array.from(t.childNodes),v=e.domNode;t.domNode=v;var N=e.nodeType;if(N===c||N===h){var b=t.data;return void(b!==e.data&&o.push({action:"text",node:v,data:b}))}for(N===u&&(a(e,t,v,o),d(e,t,v,o)),r=0,n=p.length;r<n;r++)l=p[r],f=i(l,m),f?s(l,f,o):o.push({action:"remove",node:l});for(r=0,n=m.length;r<n;r++)f=m[r],o.push({action:"add",node:f})}function l(e){if(!e.hasAttribute||!e.hasAttribute("view-indented")){var t,o,r=e.childNodes,n=r.length;for(t=n-1;t>=0;t--)o=r[t],o.nodeType===c?/^[\t\n]+$/.test(o.data)&&e.removeChild(o):o.childNodes&&l(o)}}var u=1,c=3,h=8,f=playtotv,p=f.REQUIRED;return function(e){function n(t){_classCallCheck(this,n),f.params(t,{render:p,throttle:100,interval:1e4}),e.call(this),this.render=t.render;var o=t.throttle;this.interval=t.interval;var r=this.parser=new window.DOMParser;this.nodeAddedListeners=[],this.nodeRemoveListeners=[];var i=this.oldHTML="",a=this.oldDoc=r.parseFromString(i,"text/html");a.domNode=document,["documentElement","head","body"].forEach(function(e){a[e].domNode=document[e]}),this.update=Promise.throttle(this.updateNow.bind(this),o)}return _inherits(n,e),n.prototype.updateNow=function(){var e=this,o=new t,r=this.oldHTML;clearTimeout(this.intervalTimeout),this.intervalTimeout=setTimeout(this.update,this.interval),o.start();var n=this.render();if(o.end("render"),n===r)return void this.publish("update",o.toString());var i=this.oldDoc;o.start();var a=this.parser.parseFromString(n,"text/html");o.end("parse"),l(a),o.start();var d=[];s(i,a,d),o.end("diff");var u=function(){e.fixNodeOrder(a),e.oldDoc=a,e.oldHTML=n,e.publish("update",o.toString())};if(0===d.length)return void u();var c=this.getDiffsDelay(d);o.t0+=c;var h=function(){e.publish("diffs",d),o.start(),e.applyDiffs(d),o.end("apply"),u()};return c?Promise.delay(c).then(h):h()},n.prototype.fixNodeOrder=function(e){var t,r,n,i=e.domNode,a=e.childNodes,d=a.length;for(t=d-1;t>0;t--)r=a[t].domNode,n=a[t-1].domNode,r.parentNode===n.parentNode&&r.compareDocumentPosition(n)&Node.DOCUMENT_POSITION_FOLLOWING&&(this.publish("fix-node-order",n),o(i).insertBefore(n,r));for(t=0;t<d;t++)this.fixNodeOrder(a[t])},n.prototype.getDiffsDelay=function(e){var t,o,r,n=0,i=e.length;for(t=0;t<i;t++)o=e[t],r=o.node,"remove"===o.action&&(n=Math.max(n,this.onNodeRemove(r)));return n},n.prototype.applyDiffs=function(e){var t,n,i,a,d,s,l=e.length;for(t=0;t<l;t++)switch(n=e[t],i=n.node,n.action){case"add":a=document.importNode(i,!0),r(i,a),(d=i.nextSibling)&&(s=d.domNode)?o(i.parentNode.domNode).insertBefore(a,s):o(i.parentNode.domNode).appendChild(a),this.onNodeAdded(i);break;case"remove":o(i.parentNode.domNode).removeChild(i.domNode);break;case"text":i.data=n.data;break;case"set-attr":o(i).setAttribute(n.name,n.value);break;case"remove-attr":o(i).removeAttribute(n.name);break;case"add-class":o(i).classList.add(n.name);break;case"remove-class":o(i).classList.remove(n.name)}},n.prototype.onNodeAdded=function(e){if(e.nodeType===u){var t,o=e.domNode,r=this.nodeAddedListeners,n=r.length;for(t=0;t<n;t++)r[t](o);var i=e.childNodes;for(n=i.length,t=0;t<n;t++)this.onNodeAdded(i[t])}},n.prototype.onNodeRemove=function(e){if(e.nodeType!==u)return 0;var t,o=e.domNode,r=this.nodeRemoveListeners,n=0,i=r.length;for(t=0;t<i;t++)n=Math.max(n,r[t](o)||0);var a=e.childNodes;for(i=a.length,t=0;t<i;t++)n=Math.max(n,this.onNodeRemove(a[t]));return n},n.prototype.dispose=function(){clearTimeout(this.intervalTimeout),e.prototype.dispose.call(this)},n}(e)});
function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}playtotv.define("playtotv.native.NativeController",["playtotv.mvc.Controller"],function(e){"use strict";var t=playtotv,o=t.REQUIRED,n=t.util,r=1;return function(e){function s(t){var o=this;_classCallCheck(this,s),e.call(this,t),this.addMethods(["getGatekeeper","getWrapper","sendMessage","sendCommand","popup","browser","overlay","dialog","isTwitterAvailable","tweet","fbLogin","fbLogout","fbGraph","fbShare","loadAudio","playAudio","stopAudio"]),this.wrapperPromise=this.when("Event.BridgeReady").then(this.onWrapper.bind(this)),this.gatekeeperPromise=this.when("Event.GatekeeperReady").then(this.onGatekeeper.bind(this)),this.subscribe("Event.BackButton",this.onBackButton.bind(this)),this.subscribe("Event.PushEnabled",this.onPushEnabled.bind(this)),this.model.subscribe("change:pushEnabled",this.onPushEnabledChange.bind(this));var n=window.nativeWrapper;if(n?(this.publish("Event.BridgeReady"),this.sendMessage({type:"Event",subject:"AppReady"})):n=window.nativeWrapper={},n.onMessage)throw new Error("onMessage handler already defined");n.onMessage=this.onMessage.bind(this),this.scope.pauseDog.add(1e4,function(){return o.publish("Event.AppResume",{})})}return _inherits(s,e),s.prototype.onMessage=function(e){var t=e.type||"Event",o=e.subject,n=t+"."+o;"CommandResult"===t&&(n+="."+e.commandId),this.publish(n,e)},s.prototype.sendMessage=function(e){return t.params(e,{type:o,subject:o,commandId:-1,payload:{}}),this.wrapperPromise.then(function(t){return t.sendMessage(e)})},s.prototype.sendCommand=function(e,o){var n=r++,s=this.when("CommandResult."+e+"."+n).then(function(e){var o=e.error;if(o)throw t.extend(new Error(o.message||"Command rejected: "+o.code),o);return e.payload||{}});return this.sendMessage({type:"Command",subject:e,commandId:n,payload:o}),s},s.prototype.onWrapper=function(){var e=window.nativeWrapper;return this.model.copyProperties(t.omit(e,["sendMessage","onMessage","gatekeeperResponse","gatekeeperTimestamp"])),e.gatekeeperResponse&&this.publish("Event.GatekeeperReady",{payload:t.pick(e,["gatekeeperResponse","gatekeeperTimestamp"])}),e},s.prototype.onGatekeeper=function(e){var t=e.payload;return{url:window.nativeWrapper.serverUrl,gatekeeperData:t.gatekeeperResponse,gatekeeperDataTime:t.gatekeeperTimestamp}},s.prototype.onBackButton=function(){var e=this;return window.location.hash==="#"+this.scope.router.root?this.dialog({message:"Are you sure you want to close "+this.model.name+"?",buttons:["YES","NO"]}).then(function(t){"YES"===t.pressed&&e.sendCommand("Close")}):void this.scope.back()},s.prototype.onPushEnabled=function(e){this.set("pushEnabled",e.payload.value)},s.prototype.onPushEnabledChange=function(e){var t=this;this.sendCommand("SetPushEnabled",{value:e}).catch(function(){t.set("pushEnabled",!1)})},s.prototype.getWrapper=function(){return this.wrapperPromise},s.prototype.getGatekeeper=function(){return this.gatekeeperPromise},s.prototype.dialog=function(e){return e=t.params(e,{title:this.model.name,message:"",buttons:["OK"]}),this.sendCommand("OpenDialog",e)},s.prototype.popup=function(e,t){return"overlay"===t?this.overlay(e):this.browser(e)},s.prototype.browser=function(e){return this.sendCommand("BrowserOpen",{url:e})},s.prototype.overlay=function(e){return this.sendCommand("OverlayOpen",{url:e})},s.prototype.itunes=function(e,o){var n=t.params(o,{affiliate:void 0}),r=n.affiliate;window.location="https://itunes.apple.com/dummy/id"+e+r?"?at="+r:""},s.prototype.isTwitterAvailable=function(){return this.sendCommand("IsTwitterAccountAvailable",{}).then(function(e){return e.available})},s.prototype.tweet=function(e){var t=n.addURLParams("https://twitter.com/intent/tweet",e);n.popup(t,"tweet",{width:550,height:420})},s.prototype.fbLogin=function(e){return e=t.params(e,{interactive:!1,permissions:[]}),"string"==typeof e.permissions&&(e.permissions=e.permissions.split(/\s*,\s*/)),this.sendCommand("FacebookLogin",e)},s.prototype.fbLogout=function(){return this.sendCommand("FacebookLogout")},s.prototype.fbGraph=function(e){var t=arguments.length<=1||void 0===arguments[1]?"get":arguments[1],o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];return this.sendCommand("FacebookGraphRequest",{path:e,parameters:o,httpMethod:t})},s.prototype.fbShare=function(e){e=t.params(e,{title:"",description:"",url:o,image:null});var n={contentTitle:e.title,contentDescription:e.description,contentURL:e.url};return e.image&&(n.imageURL=e.image),this.sendCommand("FacebookShare",n)},s.prototype.loadAudio=function(e){return this.sendCommand("LoadAudio",{url:e})},s.prototype.playAudio=function(e){return this.sendCommand("PlayAudio",{url:e})},s.prototype.stopAudio=function(e){return this.sendCommand("StopAudio",{url:e})},s}(e)});
playtotv.define("playtotv.net.jsonp",[],function(){"use strict";var t=0,e=this.id,o=function(r,n,i){n=n||{},i=i||2e4;var a=Promise.defer(),l="cb"+(t+=1);n.callback=e+"."+l;var c,u=playtotv.util.addURLParams(r,n);return o[l]=function(t){a.resolve(t),delete o[l],clearTimeout(c)},playtotv.loadScript(u).then(function(t){playtotv.dom.remove(t)}),c=setTimeout(function(){a.reject(new Error("Timeout")),delete o[l]},i),a.promise};return o});
playtotv.define("playtotv.net.xhrProxy",[],function(){"use strict";function e(t){l="object"==typeof t.data,d.removeListener(window,"message",e)}function t(e){var t=s.create("iframe",{src:e});return playtotv.extend(t.style,{width:0,height:0,visibility:"hidden",overflow:"hidden",position:"absolute",display:"none"}),t}function n(e){var n=p[e];if(n)return n.promise;i.d("getWindow(): "+e);var a=p[e]=Promise.defer(),r=!1;a.promise.then(function(){r=!0});var o=e+"/xhr-proxy.html",u=t(o);return d.addListener(u,"load",function(){setTimeout(function(){r||(p[e]=null,s.remove(u),a.reject(new Error("Failed to initialize: "+o)))},1e3)}),s.appendTo(u,document.body),a.promise}function a(e,t,n){var a=c[n];if(a){var r=a._batch;if(0!==r.length){r.indexOf(h)>=0&&(delete c[n],r.length>1&&(r=[h]));var o={id:n,rpcs:r};t.postMessage(l?o:JSON.stringify(o),e),a._batch=[]}}}function r(e,t,n){var a=c[e];if(!a)throw new Error("xhr undefined: "+e);a._batch.push("abort"===t?h:{method:t,args:[].slice.call(n,0)}),a._execBatch()}function o(e,t){var n=c[e],a=t?n.upload:n;a._eventListenersMap={},a.addEventListener=function(n,o){var i=a._eventListenersMap[n];i||(i=a._eventListenersMap[n]=[],r(e,"addEventListener",[t,n])),i.push(o)}}if("undefined"!=typeof window){var i=playtotv.Logger.get(this.id),s=playtotv.dom,d=playtotv.event,u=["open","setRequestHeader","send","abort"],p={},c={},f=0,l=!1,h={method:"abort",args:[]};return d.addListener(window,"message",e),window.postMessage({},"*"),d.addListener(window,"message",function(e){var t=p[e.origin];if(t){var n="string"==typeof e.data?JSON.parse(e.data):e.data,a=n.type,r=c[n.id],o="onMessage: "+e.origin+": "+a;if((e.stopImmediatePropagation||e.stopPropagation).call(e),"initialized"===a)i.s(o),t.resolve({win:e.source});else if(r)if("event"===a){var s=n.upload,d=n.event,u=d.type;i.s(o+": "+(s?"upload: ":"")+u+": "+d.loaded);var f=s?r.upload:r,l=f._eventListenersMap[u];l.forEach(function(e){e(d)})}else"readyStateChange"===a?(r.status=n.status,r.responseText=n.responseText,r._readyStateChange(n.readyState)):i.w(o+": unsupported type");else i.d(o+": xhr: "+n.id+" is undefined")}}),{create:function(e){var t=f++,i=c[t]={_batch:[],_readyStateChange:function(e){i.readyState=e,i.onreadystatechange&&i.onreadystatechange(),4===e&&delete c[t]},_execBatch:playtotv.unstack(function(){n(e).then(function(n){a(e,n.win,t)},function(e){i.status="no-xhr-proxy",i.reason=e,i._readyStateChange(4)})}),upload:{},onreadystatechange:null,readyState:0,status:0,responseText:""};return u.forEach(function(e){i[e]=function(){r(t,e,arguments)}}),o(t,!1),o(t,!0),i},debug:{deferredWindows:p,xhrs:c}}}});
playtotv.define("playtotv.net.request",["playtotv.net.xhrProxy"],function(e){"use strict";var t=playtotv,r=t.Logger.get(this.id),a=t.util,n=function(o,s){function i(e){if(!c){m&&clearTimeout(m);var r=l.responseText;if("json"===s.dataType)try{r=r?JSON.parse(r):{}}catch(e){}if(e>=200&&e<300||[304,1223].indexOf(e)!==-1)p.resolve(r);else{var a=new Error(r&&r.error&&r.error.message||"Request "+s.label+" failed with status "+e);p.reject(t.extend(a,{label:s.label,status:e,xhr:l,data:r}))}c=!0}}var u=a.getOrigin(),d=a.getOrigin(o);s=t.params(s,{label:(s&&s.type||"GET")+" "+o,type:"GET",urlParams:{},headers:{},username:void 0,password:void 0,data:{},onProgressDown:void 0,onProgressUp:void 0,dataType:"text",xhrProxy:d!==u,cache:!0,timeout:0});var l,p=Promise.defer(),c=!1,m=null;r.s(s.label),l=s.xhrProxy?e.create(d):new XMLHttpRequest;var v="onload"in l,f="onerror"in l,y="onabort"in l,g="ontimeout"in l;o=a.addURLParams(o,s.urlParams),s.cache||(o=a.addURLParam(o,"nocache",Date.now())),l.open(s.type,o,!0,s.username,s.password),v?l.addEventListener("load",function(){i(l.status)},!1):l.onreadystatechange=function(){4===l.readyState&&i(l.status)},f&&l.addEventListener("error",function(){i(l.status)},!1),y&&l.addEventListener("abort",function(){i("abort")},!1),s.timeout&&(g?(l.addEventListener("timeout",function(){i("timeout")},!1),l.timeout=s.timeout):m=setTimeout(function(){i("timeout"),l.abort()},s.timeout));var h=s.onProgressDown;h&&l.addEventListener("progress",function(e){e.lengthComputable&&h(e)},!1);var P=s.onProgressUp;return P&&l.upload.addEventListener("progress",function(e){e.lengthComputable&&P(e)},!1),t.each(s.headers,function(e,t){l.setRequestHeader(t,e)}),"PUT"===s.type||"POST"===s.type?(l.setRequestHeader("Content-type","application/json"),l.send(JSON.stringify(s.data))):l.send(),n.taps.forEach(function(e){e(o,s.label,p.promise)}),p.promise};return n.taps=[],n});
function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}playtotv.define("playtotv.analytics.AnalyticsController",["playtotv.analytics.AnalyticsWidget","playtotv.analytics.ComScoreAnalytics","playtotv.analytics.GoogleAnalytics","playtotv.mvc.Controller","playtotv.net.request"],function(t,e,o,r,n){"use strict";var i=playtotv,a=i.util,s=i.event,c=new i.Logger(this.id);return function(r){function l(n,a){_classCallCheck(this,l),a=i.params(a,{privateGoogle:{name:"private",id:"UA-20746434-1",fields:{sampleRate:1}},googles:[],comScore:null}),r.call(this,n),this.addMethods(["privateTime","privateError","privateEvent","view","event","setFields"]),this.addWidget("track",t);var c=this.privateGoogle=new o(a.privateGoogle),p=this.googles=[c];a.googles.forEach(function(t){t.id&&p.push(new o(t))});var u=a.comScore;u&&u.url&&(this.comScore=new e(u)),s.addWindowOnError(this.privateError.bind(this)),this.hookRequestTap()}return _inherits(l,r),l.prototype.hookRequestTap=function(){var t=this;n.taps.push(function(e,o,r){var n=e.replace(/.nocache=\d+/,"");a.getURLParams(e).timeout||t.privateTime(r,"request",o,{timingLabel:n}),r.catch(function(e){t.privateEvent("request","reject "+o+" "+e.status,{eventLabel:n,nonInteraction:!0})})})},l.prototype.privateTime=function(t,e,o,r){return this.privateGoogle.time(t,e,o,r)},l.prototype.privateError=function(t,e,o){return this.privateGoogle.sendError(t,e,o)},l.prototype.privateEvent=function(t,e,o){return this.privateGoogle.sendEvent(t,e,o)},l.prototype.view=function(t,e){c.d("view: "+t,e),this.lastView=t,this.googles.forEach(function(o){return o.sendView(t,e)}),this.udm(t)},l.prototype.event=function(t,e,o){c.d("event: "+t+", "+e,o),this.googles.forEach(function(r){return r.sendEvent(t,e,o)});var r=o&&o.eventLabel;this.udm(t+"."+e+(r?"."+r:""),{type:"hidden"})},l.prototype.setFields=function(t){this.googles.forEach(function(e){return e.setFields(t)})},l.prototype.udm=function(t,e){var o=this.comScore;o&&o.udm(t,e)},l}(r)});
function _classCallCheck(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}function _inherits(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+typeof o);e.prototype=Object.create(o&&o.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(e,o):e.__proto__=o)}playtotv.define("playtotv.native.MockNativeController",["playtotv.facebook.Facebook","playtotv.native.NativeController","playtotv.net.request"],function(e,o,t){"use strict";function n(e,o,t){var n=e.match(o);return n&&n[t||0]}var a=playtotv,i=a.dom,r=a.util,s=a.Logger.get(this.id);return function(o){function c(n,i){var r=this;_classCallCheck(this,c),a.params(i,{serverUrl:a.REQUIRED,facebook:null});var s=i.serverUrl;o.call(this,n),this.audioNodeMap={},i.facebook&&(this.facebook=new e(i.facebook));var p=window.nativeWrapper;a.extend(p,this.getDevice(),{name:document.title,version:"1.0-mock",capabilities:[],pushEnabled:!1,serverUrl:s,sendMessage:this.sendMessage.bind(this)}),this.publish("Event.BridgeReady");var d=(/\/\//.test(s)?"":"//")+s,u="mock"===s?Promise.resolve({serverTime:Date.now(),status:"AVAILABLE",services:[]}):t(d+"/api/1/gatekeeper/init",{dataType:"json",cache:!1});u.then(function(e){e={gatekeeperResponse:e,gatekeeperTimestamp:Date.now()},a.extend(p,e),r.mockMessage({type:"Event",subject:"GatekeeperReady",payload:e})}),this.initLoading()}return _inherits(c,o),c.prototype.initLoading=function(){var e=i.create("div",{className:"native-loading"},{text:"Loading..",appendTo:document.body});a.extend(e.style,{position:"absolute",top:0,left:0,bottom:0,right:0,background:"rgba(255, 255, 255, 0.9)",color:"#000","text-align":"center","padding-top":"150px","z-index":99999}),this.loadingNode=e},c.prototype.getDevice=function(){var e=navigator.userAgent;return a.extend({deviceName:"Mock Device",deviceModel:e},/android/i.test(e)?{os:"Android",osVersion:n(e,/android ([\d\.]+)/i,1)||"4.4"}:/ip(ad|hone)/i.test(e)?{os:"iOS",osVersion:n(e,/OS (\d)_\d/,1)||"8"}:{os:"Browser",osVersion:"1.0"})},c.prototype.mockMessage=function(e){Promise.resolve().then(function(){return window.nativeWrapper.onMessage(e)})},c.prototype.sendMessage=function(e){var o=this;if("Command"===e.type){var t=e.subject,n=this["onCommand"+t],i={type:"CommandResult",subject:t,commandId:e.commandId};n?Promise.resolve(n.call(this,e.payload)).then(function(e){o.mockMessage(a.extend(i,{payload:e}))},function(e){o.mockMessage(a.extend(i,{error:e}))}):s.d(t,e.payload)}return Promise.resolve()},c.prototype.popup=function(e,o,t){var n=a.params(t,{width:0,height:0}),i=n.width,s=n.height;return r.popup(e,o,{width:i,height:s})},c.prototype.onCommandHideLoading=function(){i.remove(this.loadingNode)},c.prototype.onCommandOpenDialog=function(e){var o=e.buttons,t=e.title+"\n"+e.message+"\n["+o.join("], [")+"]",n=o.length>1?window.confirm(t):window.alert(t)||!0;return{pressed:o[n?0:1]}},c.prototype.onCommandSetPushEnabled=function(e){return e.value&&Math.random()>.8?Promise.reject({}):{}},c.prototype.onCommandIsTwitterAccountAvailable=function(){return this.wrapperPromise.then(function(e){return{available:"iOS"===e.os}})},c.prototype.onCommandFacebookLogin=function(e){var o=this;return this.facebook?this.facebook.login(e.interactive).then(function(){return{token:o.facebook.accessToken}}):{token:"mock-facebook-token"}},c.prototype.onCommandFacebookLogout=function(){if(this.facebook)return this.facebook.logout()},c.prototype.onCommandFacebookGraphRequest=function(e){if(this.facebook)return this.facebook.api(5e3,e.path,e.httpMethod,e.parameters);var o=e.path,t={data:[{name:"Peter Ex Machina",id:"100002151356216"}],paging:{next:""},summary:{total_count:1}};return{me:{id:"mock-facebook-id",permissions:{data:[{permission:"public_profile",status:"granted"},{permission:"user_friends",status:"granted"}]},first_name:"Peter Paul",last_name:"Ex Machina",name:"Peter Paul Ex Machina",picture:{data:{url:"//graph.facebook.com/100001721575332/picture"}},friends:t},"me/friends":t}[o]||Promise.reject(new Error("No mock response for FacebookGraphRequest path: "+o))},c.prototype.onCommandFacebookShare=function(e){var o={link:e.contentURL,name:e.contentTitle,description:e.contentDescription,picture:e.imageURL};return Object.keys(o).forEach(function(e){o[e]||delete o[e]}),this.facebook?this.facebook.postByDialog(o):void(window.location=r.addURLParams("https://www.facebook.com/dialog/feed",a.extend({app_id:"160288680666821",redirect_uri:window.location.href},o)))},c.prototype.onCommandLoadAudio=function(e){var o=e.url,t=document.createElement("audio");t.src=o,t.load(),this.audioNodeMap[o]=t},c.prototype.onCommandPlayAudio=function(e){var o=e.url,t=this.audioNodeMap[o];t.play()},c.prototype.onCommandStopAudio=function(e){var o=e.url,t=this.audioNodeMap[o];t.stop()},c}(o)});
function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}playtotv.define("playtotv.push.PushController",["playtotv.mvc.Controller"],function(t){"use strict";var e=playtotv,o=e.Logger.get(this.id),n={getEvents:{label:"pushPoll.getEvents",type:"GET",url:"1/events",queryKeys:["stream","timeout"]}};return function(t){function r(o,n){_classCallCheck(this,r),n=e.params(n,{pollTimeout:1e4}),t.call(this,o),this.pollTimeout=n.pollTimeout,this.scope.observe("user.online",this.start.bind(this))}return _inherits(r,t),r.prototype.start=function(t){!this.hasStarted&&t&&(this.poll(),this.hasStarted=!0)},r.prototype.poll=function(){var t=this;this.disposed||this.getEvents().then(function(e){e.forEach(function(e){return t.publish(e.subject+"-"+e.action,e)})}).catch(function(t){return o.i("poll: getEvents rejected, delaying next poll",t),Promise.delay(5e3)}).then(function(){return t.poll()})},r.prototype.getEvents=function(){var t=this,e=this.model,o=e.stream,r=this.pollTimeout;return this.scope.call("server.call",n.getEvents,{stream:o,timeout:r},{timeout:2e4+r}).then(function(e){return t.set("stream",e.stream),e.events})},r.prototype.serialize=function(){return!1},r}(t)});
playtotv.define("playtotv.question.questionAPI",[],function(){"use strict";return{getParticipantAnswers:{label:"question.getParticipantAnswers",url:"1/question/episodesession/{episodeSessionId}/stats"},getQuestion:{label:"question.getQuestion",url:"1/question/questions/{questionId}/episodesession/{episodeSessionId}"},getQuestionStats:{label:"question.getQuestionStats",url:"1/question/questions/{questionId}/episodesession/{episodeSessionId}/stats"},submitAnswer:{label:"question.submitAnswer",url:"1/question/questions/{questionId}/episodesession/{episodeSessionId}/answer",type:"PUT",dataKeys:["answerCodes","clientAnswerTime"]}}});
function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}playtotv.define("playtotv.question.QuestionController",["playtotv.mvc.Controller","playtotv.question.questionAPI"],function(t,e){"use strict";var n=playtotv;return function(t){function i(e){_classCallCheck(this,i),t.call(this,e),this.addMethods(["submitAnswer","decorateAnswers"])}return _inherits(i,t),i.prototype.submitAnswer=function(t,i,s){var o=this;s=n.params(s,{delay:0});var r=t+"-"+i;return this.submitting=r,this.publish("submitting",this.submitting),Promise.delay(s.delay).then(function(){return o.scope.call("episode.submitInteraction",e.submitAnswer,t,{questionId:t,answerCodes:[i],clientAnswerTime:!0}).finally(function(){o.submitting===r&&delete o.submitting})})},i.prototype.decorateAnswers=function(t){var e=this,i=t.stats,s=t.data,o=i&&i.answers||[],r=s&&s.submittedAnswers||[];return t.content.answers.map(function(i){var s=i.code,u=o.find(function(t){return t.code===s});return n.extend({question:t,submitting:e.submitting===t.id+"-"+s,submitted:r.indexOf(s)>=0},i,u)})},i}(t)});
playtotv.define("playtotv.rating.ratingAPI",[],function(){"use strict";return{getRating:{label:"rating.getRating",url:"1/rating/ratings/{ratingId}/episodesession/{episodeSessionId}"},getRatingStats:{label:"rating.getRatingStats",url:"1/rating/ratings/{ratingId}/episodesession/{episodeSessionId}/stats"},submitRating:{label:"rating.submitRating",url:"1/rating/ratings/{ratingId}/episodesession/{episodeSessionId}/answer",type:"PUT",dataKeys:["values"]}}});
function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}playtotv.define("playtotv.rating.RatingInputWidget",["playtotv.widget.Widget"],function(t){"use strict";var e=playtotv,n=e.REQUIRED;return function(t){function o(i,r){_classCallCheck(this,o),e.params(r,{app:null,controller:n,id:n,code:n}),t.call(this,i),e.extend(this,r),this.addEventListener(i,"change",this.onChange.bind(this))}return _inherits(o,t),o.prototype.onChange=function(){this.controller.submit(this.id,this.code,this.node.value)},o}(t)});
function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}playtotv.define("playtotv.rating.RatingController",["playtotv.mvc.Controller","playtotv.rating.ratingAPI","playtotv.rating.RatingInputWidget"],function(t,e,n){"use strict";var o=10,r=playtotv;return function(t){function a(e){_classCallCheck(this,a),t.call(this,e),this.addMethods(["submit","decorateSubjects"]),this.addWidgets([["input",n]])}return _inherits(a,t),a.prototype.submit=function(t,n,r){var a={};return a[n]=Math.round(r*o),this.scope.call("episode.submitInteraction",e.submitRating,t,{ratingId:t,values:a},function(t){return t=t||{},t[n]=r,t})},a.prototype.decorateSubjects=function(t){var e=t.stats,n=e&&e.values||[],a=t.data||{};return t.content.subjects.map(function(e){var i=e.code,u=n.find(function(t){return t.code===i});return r.extend({rating:t,submitted:a[i],average:u&&u.value/o},e)})},a}(t)});
playtotv.define("playtotv.relation.RelationSubscription",["playtotv.pubsub.Subscription"],function(e){"use strict";var t=playtotv.util;return new playtotv.Class({extend:e,initialize:function(e,i){"string"==typeof e&&(e=new RegExp("(\\s|^)("+t.escapeRegEx(e).replace(/\\\*/g,"\\S*?")+")(\\s|$)"),this.regexIndex=2),this._super(e,i)},deliver:function(e,t){if(this.handler){var i=this.regexIndex;void 0!==i&&(t=this.selector.exec(t)[i]),this.handler(e,t)}}})});
playtotv.define("playtotv.relation.RelationManager",["playtotv.pubsub.PubSub","playtotv.relation.RelationSubscription"],function(t,i){"use strict";var e=playtotv,n=e.dom,s=e.event;return new e.Class({extend:t,initialize:function(t){t=t||document,this._super(),this.node=t,s.addListener(t,"click",this.onClick)},subscribe:function(t,e){var n=new i(t,e);return this.subscriptions.push(n),n},onClick:function(t){var i=n.closest("a[rel]",t.target),e=i?i.rel:null;e&&(t.preventDefault(),this.publish(e,i,!0))},dispose:function(){s.removeListener(this.node,"click",this.onClick),t.prototype.dispose.call(this)},callbacks:["onClick"]})});
playtotv.define("playtotv.score.scoreAPI",[],function(){"use strict";return{getCurrentLeaderboardPage:{label:"score.getCurrentLeaderboardPage",url:"1/score/show/{showId}/leaderboard",queryKeys:["pageIndex","pageSize"]},getCurrentLeaderboardPageForInterval:{label:"score.getCurrentLeaderboardPageForInterval",url:"1/score/show/{showId}/{interval}/leaderboard",queryKeys:["pageIndex","pageSize"]},getEpisodeLeaderboardPage:{label:"score.getEpisodeLeaderboardPage",url:"1/score/episodesession/{episodeSessionId}/leaderboard",queryKeys:["pageIndex","pageSize"]},getEpisodeScores:{label:"score.getEpisodeScores",url:"1/score/episodesession/{episodeSessionId}",queryKeys:["userIds","facebookIds","callId"]},getLeaderboardPageForInterval:{label:"score.getLeaderboardPageForInterval",url:"1/score/show/{showId}/time/{interval}/{year}/{subIntervalIndex}/leaderboard",queryKeys:["pageIndex","pageSize"]},getTimeSpanScores:{label:"score.getTimeSpanScores",url:"1/score/show/{showId}/time/{interval}/{year}/{subIntervalIndex}",queryKeys:["userIds","facebookIds","callId"]}}});
playtotv.define("playtotv.server.gatekeeperAPI",[],function(){"use strict";return{getInit:{label:"gatekeeper.getInit",url:"1/gatekeeper/init"}}});
playtotv.define("playtotv.storage.MockStorage",[],function(){"use strict";return new playtotv.Class({initialize:function(){this.length=0,this._container={}},key:function(t){return Object.keys(this._container)[t]},getItem:function(t){return Object.keys(this._container).indexOf(t)===-1?null:this._container[t]},setItem:function(t,e){this._container[t]=e,this._updateLength()},removeItem:function(t){delete this._container[t],this._updateLength()},clear:function(){this.length=0,this._container={}},_updateLength:function(){this.length=Object.keys(this._container).length}})});
playtotv.define("playtotv.storage.Storage",["playtotv.storage.MockStorage"],function(t){"use strict";var e=playtotv.Logger.get(this.id),i=new playtotv.Class({initialize:function(e,i){this.storage=e||window.localStorage||new t,this.prefix=i||""},get:function(t,e){var i=this.storage.getItem(this.prefix+t);if(null===i||void 0===i)return e;try{i=JSON.parse(i)}catch(t){}return i},set:function(t,e,i){if(i=i||this.quotaHandler,null===e||void 0===e)this.remove(t);else try{this.storage.setItem(this.prefix+t,JSON.stringify(e))}catch(o){if(!(o instanceof window.DOMException&&o.code===o.QUOTA_EXCEEDED_ERR))throw o;i.call(this,o,t,e)}},quotaHandler:function(t,i,o){e.e("Caught quota exception: "+t.name+", while setting: "+i,o,t)},remove:function(t){this.storage.removeItem(this.prefix+t)},clear:function(){for(var t=this.storage,e=0;e<t.length;){var i=t.key(e);0===i.indexOf(this.prefix)?t.removeItem(i):e++}},subStorage:function(t){return new i(this.storage,this.prefix+t)}});return i});
playtotv.define("playtotv.storage.AsyncStorage",["playtotv.storage.Storage"],function(t){"use strict";function r(t,r,e){return e=e||[],i.s(r,e),new Promise(function(n,i){t.transaction(function(t){t.executeSql(r,e,function(t,r){n(r)},function(t,r){i(r)})},i)})}var e=playtotv,n=this.id,i=e.Logger.get(n),o="keyvaluepairs";return new e.Class({initialize:function(e){this.prefix=e||"",this.ready=Promise.resolve().then(function(){var t=openDatabase(n,"1.0","",4980736),e="CREATE TABLE IF NOT EXISTS "+o+" (id INTEGER PRIMARY KEY, key unique, value)";return r(t,e).then(function(){return{db:t}})}).catch(function(r){return i.d("Falling back to localStorage",r),{storage:new t(window.localStorage,e)}})},get:function(t,e){var n=this.prefix;return this.ready.then(function(i){var a=i.db;if(!a)return i.storage.get(t,e);var u="SELECT * FROM "+o+" WHERE key = ? LIMIT 1";return r(a,u,[n+t]).then(function(t){var r=t.rows;return r.length?JSON.parse(r.item(0).value):e})})},set:function(t,e){if(null===e||void 0===e)return this.remove(t);var n=this.prefix;return this.ready.then(function(i){var a=i.db;if(!a)return i.storage.set(t,e,function(t){throw new Error("Quota error: "+t.name)});var u="INSERT OR REPLACE INTO "+o+" (key, value) VALUES (?, ?)";return r(a,u,[n+t,JSON.stringify(e)])})},remove:function(t){var e=this.prefix;return this.ready.then(function(n){var i=n.db;return i?r(i,"DELETE FROM "+o+" WHERE key = ?",[e+t]):n.storage.remove(t)})},clear:function(){var t=this.prefix;return this.ready.then(function(e){var n=e.db;return n?r(n,"DELETE FROM "+o+' WHERE key LIKE "'+t+'%"'):e.storage.clear()})},subStorage:function(t){return new this.constructor(this.prefix+t)},sql:function(t,e){return this.ready.then(function(n){return r(n.db,t,e)})}})});
function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}playtotv.define("playtotv.storage.MockAsyncStorage",["playtotv.storage.AsyncStorage","playtotv.storage.MockStorage","playtotv.storage.Storage"],function(t,e,o){"use strict";return function(t){function r(n){_classCallCheck(this,r),t.call(this,n),this.ready=Promise.resolve({storage:new o(new e,n)})}return _inherits(r,t),r}(t)});
playtotv.define("playtotv.server.Server",["playtotv.server.gatekeeperAPI","playtotv.model.ObjectModel","playtotv.net.request","playtotv.storage.Storage"],function(e,t,r,i){"use strict";var s=playtotv,n=s.REQUIRED,a=s.util,o=s.Logger.get(this.id),l=s.event,u=e.getInit;return u.gatekeeper=!0,new s.Class({extend:t,initialize:function(e){this._super({urls:new t({}),status:void 0,timeOffset:void 0,clientMinimalVersion:{}}),e=s.params(e,{url:"",badDelay:5e3,onRetry:function(e,t){o.d("Retry: "+e+" ("+t+")")},gatekeeperData:void 0,gatekeeperDataTime:void 0});var r=e.url;r.length>0&&/^localhost|.+\..+/.test(r)&&r.indexOf("//")===-1&&(r="//"+r),this.badDelay=e.badDelay,this.onRetry=e.onRetry,this.serverUrl=r,this.serviceUrls={},this.urlPromises={},this.gatekeeperUrl=this.getGatekeeperServiceUrl(u.service||"API")+u.url,this.gatekeeperData=e.gatekeeperData,this.gatekeeperDataTime=e.gatekeeperDataTime,this.settings={cache:!1,dataType:"json",timeout:2e4,headers:{},urlParams:{}},this.retryDelay=5e3,this.resolveTaps=[],this.rejectTaps=[],this.storage=new i(window.localStorage,r+"/"),l.addListener(window,"offline",function(){o.d("Event: offline"),this.setStatus("BAD")}.bind(this)),l.addListener(window,"online",function(){o.d("Event: online"),this.setStatus("GOOD")}.bind(this)),this.getServiceUrl("API")},setStatus:function(){function e(){t&&(t.changeProperty("status","BAD"),t=null)}var t=!1;return function(r){"BAD"===r?t||(t=this,setTimeout(e,this.badDelay)):(t=!1,this.changeProperty("status",r))}}(),urlKeys:function(e){var t=e.match(/\{(\w+)\}/g)||[];return t.map(function(e){return e.substr(1,e.length-2)})},validateCall:function(e,t,r){r=r||this.urlKeys(e.url);var i=e.label,s=e.dataKeys,n=Object.keys(t||{}),a=r.concat(e.queryKeys).concat(s),o=[];if(n.forEach(function(e){a.indexOf(e)===-1&&o.push(e)}),o.length>0)throw new Error(i+": invalid parameters: "+o.join(", "));var l=r.concat(s),u=[];if(l.forEach(function(e){void 0===t[e]&&u.push(e)}),u.length>0)throw new Error(i+": required parameters are undefined: "+u.join(", "))},_getServiceUrls:function(){var e,t=this.gatekeeperData,r=this.gatekeeperDataTime;return t&&r?(t.serverTime+=Date.now()-r,e=Promise.resolve(t),delete this.gatekeeperData,delete this.gatekeeperDataTime):e=this.call(u),e.then(function(e){return e.status&&"AVAILABLE"!==e.status?(this.setStatus("BUSY"),this.onRetry(this.gatekeeperUrl,"busy-"+e.status.toLowerCase()),Promise.delay(this.retryDelay).then(this._getServiceUrls)):(this.setStatus("GOOD"),this.changeProperty("timeOffset",Date.now()-e.serverTime),this.changeProperty("clientMinimalVersion",e.clientMinimalVersion),e.services.reduce(function(e,t){return e[t.serviceType]=s.shuffle(t.serviceUrls.map(function(e){return e.replace(/\d+\/$/,"")})),e}.bind(this),{}))}.bind(this),function(e){return o.i("getServiceUrls: retry: "+e.status),this.setStatus("BAD"),this.onRetry(this.gatekeeperUrl,"status-"+e.status),Promise.delay(this.retryDelay).then(this._getServiceUrls)}.bind(this))},getServiceUrls:Promise.throttle(function(){return this._getServiceUrls()},2e3),getGatekeeperServiceUrl:function(e){return this.serverUrl+"/"+e.toLowerCase()+"/"},getServiceUrl:function(e){var t=this.urlPromises;if(!t[e]){var r=this.serviceUrls,i=r[e]||[];i.length>0?t[e]=Promise.resolve(i.shift()):t[e]=this.getServiceUrls().then(function(t){s.each(t,function(e,t){r[t]=e});var i=t[e]||[];return 0===i.length?this.getGatekeeperServiceUrl(e):r[e].shift()}.bind(this))}return t[e]},invalidateServiceUrl:function(e,t){var r=this.urlPromises;r[e]===t&&(r[e]=null)},request:function(e,t,i){i=i||function(){return this.request(e,t,i)}.bind(this);var n=s.extend({},this.settings,t);return r(e,n).then(function(e){return t.label===u.label&&e.status&&"AVAILABLE"!==e.status?e:(this.setStatus("GOOD"),e)}.bind(this),function(t){var r=t.status;return 0===r||"no-xhr-proxy"===r||r>12e3&&r<13e3?(this.onRetry(e,"status-"+r),this.setStatus("BAD"),Promise.delay(this.retryDelay).then(i)):503===r?(this.onRetry(e,"status-"+r),Promise.delay(this.retryDelay).then(i)):"timeout"===r?(this.onRetry(e,"timeout"),this.setStatus("BAD"),i()):Promise.reject(t)}.bind(this))},getUrlAndRequest:function(e,t,r){var i=this.getServiceUrl(e);return i.then(function(s){return this.urls.setProperty(e,s),this.request(s+t,r,function(){return this.invalidateServiceUrl(e,i),this.getUrlAndRequest(e,t,r)}.bind(this))}.bind(this))},tap:function(e,t){return t.then(function(t){this.resolveTaps.forEach(function(r){r.call(e,t)})}.bind(this),function(t){this.rejectTaps.forEach(function(r){r.call(e,t)})}.bind(this)),t},call:function(e,t,r){s.params(e,{label:void 0,service:"API",gatekeeper:!1,type:"GET",url:n,queryKeys:[],dataKeys:[]}),t=t||{},r=s.extend({label:e.label,type:e.type},r);var i=e.url,o=this.urlKeys(i);this.validateCall(e,t,o),o.forEach(function(e){i=i.replace("{"+e+"}",encodeURIComponent(t[e]))}),e.queryKeys.forEach(function(e){void 0!==t[e]&&(i=a.addURLParam(i,e,t[e]))});var l=e.dataKeys;l.length>0&&(r.data={},l.forEach(function(e){r.data[e]=t[e]}));var u=e.service;if(e.gatekeeper){var h=this.getGatekeeperServiceUrl(u)+i;return this.tap(e,this.request(h,r))}return this.tap(e,this.getUrlAndRequest(u,i,r))},toClientTime:function(e){return e+this.timeOffset},toServerTime:function(e){return e=e||Date.now(),e-this.timeOffset},log:function(e,t,r,i){var s=this.call(e,t,r);return o.log(i||"DEBUG",[e.label,t,s]),s},callbacks:["_getServiceUrls"]})});
function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}playtotv.define("playtotv.server.ServerController",["playtotv.mvc.Controller","playtotv.server.Server"],function(e,t){"use strict";var r=playtotv,n=0;return function(e){function s(t,r){var n=this;_classCallCheck(this,s),e.call(this,t);var o=this.getServer(r),a=["status","timeOffset","clientMinimalVersion"];a.forEach(function(e){o.subscribe("change:"+e,function(t){return n.set(e,t)})}),o.urls.subscribe("*:API",function(e){return n.set("url",e)});var l=["call","toClientTime","toServerTime","log"];l.forEach(function(e){n[e]=o[e].bind(o),n.addMethod(e)}),this.rejectTaps=o.rejectTaps,this.addMethods(["addRejectTap","callAsync"]),this.asyncCalls=[],t.scope.subscribe("push.ASYNC-RESPONSE",this.onAsyncResponse.bind(this))}return _inherits(s,e),s.prototype.getServer=function(e){return new t(e)},s.prototype.addRejectTap=function(e,t){t=t||function(){return!0},this.rejectTaps.push(function(r){var n=this;t(r,n)&&e(r,n)})},s.prototype.callAsync=function(e,t,s){var o=this;return new Promise(function(a,l){var c=""+ ++n;o.call(e,t,r.extend({},s,{urlParams:{callId:c}})).catch(l),o.asyncCalls.push({callId:c,label:e.label,resolve:a,reject:l})})},s.prototype.onAsyncResponse=function(e){var t=e.payload,n=t.callId,s=this.asyncCalls,o=s.find(function(e){return e.callId===n});if(o){s.splice(s.indexOf(o),1);var a=t.responseStatus,l=t.responseBody;if(a>=200&&a<300||304===a)o.resolve(l);else{var c=new Error("Async call "+o.label+" failed with status "+a);o.reject(r.extend(c,{label:o.label,status:a,xhr:null,data:l}))}}},s}(e)});
playtotv.define("playtotv.server.MockServer",["playtotv.server.gatekeeperAPI","playtotv.server.Server","playtotv.net.request"],function(e,t,r){"use strict";return new playtotv.Class({extend:t,initialize:function(t){t=playtotv.params(t,{mocks:{},base:"mock",value:{isDefaultValue:!0},render:null});var r=this.mockMap=t.mocks;this.baseUrl=t.base,this.defaultValue=t.value,this.render=t.render;var a=e.getInit.label,s="pushPoll.getEvents";r[a]=r[a]||this.mockGatekeeper,r[s]=r[s]||this.mockPushPoll,this._super()},call:function(e,t,a){playtotv.params(e,{label:void 0,service:"API",gatekeeper:!1,type:"GET",url:playtotv.REQUIRED,queryKeys:[],dataKeys:[]}),t=t||{},a=playtotv.extend({label:e.label,type:e.type},a),this.validateCall(e,t);var s=e.label||e.url.replace(/[\{\}]/g,"_")+(e.type?"/"+e.type:""),l=this.mockMap[s];if(l)return l instanceof Function&&(l=l(e,t,a)),this.tap(e,Promise.resolve(l).then(function(e){return"string"==typeof e?this.call({label:e},t,a):e}.bind(this)));var n=this.baseUrl+"/"+s+".json",i=this.render;return this.tap(e,r(n).then(function(r){var a=playtotv.extend({method:e},t),s=i?i(r,a):r;return JSON.parse(s)},function(){return this.defaultValue}.bind(this)))},mockGatekeeper:function(){return{serverTime:Date.now(),status:"AVAILABLE",services:[]}},mockPushPoll:function(){return Promise.delay(1e4).then(function(){return{stream:"mock-stream",events:[]}})}})});
function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}playtotv.define("playtotv.server.MockServerController",["playtotv.server.ServerController","playtotv.server.MockServer"],function(t,e){"use strict";return function(t){function r(){_classCallCheck(this,r),t.apply(this,arguments)}return _inherits(r,t),r.prototype.getServer=function(){return this.server||(this.server=new e)},r.prototype.callAsync=function(){return this.call.apply(this,arguments)},r}(t)});
playtotv.define("playtotv.touch.Sequence",["playtotv.css.Vector"],function(t){"use strict";var e=Math.max,i=300,s=20,n=new playtotv.Class({initialize:function(e,i){this.target=e,this.id=i.pointerId||i.identifier,this.start=new t(i.clientX,i.clientY),this.screen=new t(i.screenX,i.screenY),this.point=this.start,this.offset=t.ZERO,this.velocity=t.ZERO,this.time=Date.now(),this.isTap=!0},update:function(n){var a=Date.now(),c=new t(n.clientX,n.clientY),h=new t(n.screenX,n.screenY),o=this.start,r=this.point,l=a-this.time,p=1e3/e(l,40);this.velocity=new t((c.x-r.x)*p,(c.y-r.y)*p),this.offset=new t(c.x-o.x,c.y-o.y),this.isTap&&this.offset.magnitude()>s&&(delete this.isTap,this.isSwipe=setTimeout(this.clearSwipe,i)),this.time=a,this.point=c,this.screen=h},clearSwipe:function(){clearTimeout(this.isSwipe),delete this.isSwipe},callbacks:["clearSwipe"]});return n});
playtotv.define("playtotv.touch.Tracker",["playtotv.touch.Sequence"],function(t){"use strict";var r=[].map,n=new playtotv.Class({initialize:function(){this.map={}},add:function(n,i){return r.call(n,function(r){var n=r.pointerId||r.identifier,e=this.map[n]=new t(i,r);return e},this)},update:function(t){return r.call(t,function(t){var r=t.pointerId||t.identifier,n=this.map[r];return n.update(t),n},this)},remove:function(t){return r.call(t,function(t){var r=t.pointerId||t.identifier,n=this.map[r];return delete this.map[r],n},this)},toArray:function(){var t=[],r=this.map;for(var n in r)r.hasOwnProperty(n)&&t.push(r[n]);return t},empty:function(){var t=this.map;for(var r in t)if(t.hasOwnProperty(r))return!1;return!0}});return n});
playtotv.define("playtotv.touch.TouchProxy",["playtotv.touch.Tracker"],function(t){"use strict";function e(t){if(!(a||r&&0!==c))return!1;var e=navigator.userAgent,n=/Windows Phone/.test(e),o=/iP(hone|ad|od)/.test(e)&&!n;if(o)return!0;var s=/Android/.test(e)&&!n,h=/Chrome\/([0-9]+)/.test(e),u=/Firefox\/([0-9]+)/.test(e);if(h&&s||u){var v=i.first("meta[name=viewport]");if(v&&/user-scalable=no/.test(v.content))return!1}var p=t.currentStyle||t.style,d=p?p.touchAction||p.msTouchAction:null;return!d||!/none|manipulation/.test(d)}var n=playtotv.event,i=playtotv.dom,o=/input|textarea|select|option/i,s=500,a="ontouchstart"in window,r="onpointerdown"in window,c=navigator.maxTouchPoints||navigator.msMaxTouchPoints||0,h=new playtotv.Class({initialize:function(i,o){o=playtotv.params(o,{fastClick:!0,preventNative:!0,propagateNative:!1}),this.node=i,this.fastClick=o.fastClick&&e(i),this.preventNative=o.preventNative,this.propagateNative=o.propagateNative,this.startEvent=r?"pointerdown":a?"touchstart":"mousedown",this.moveEvent=r?"pointermove":a?"touchmove":"mousemove",this.endEvent=r?"pointerup":a?"touchend":"mouseup",this.tracker=new t,n.addListener(i,this.startEvent,this.touchStart)},touchStart:function(t){var e=t.target;if(!o.test(e.nodeName)){var n,i=this.getChangedTouches(t),s=this.tracker.add(i,e),a=!1,r=s.length;for(n=0;n<r;n++)this.dispatchEvent("em:touchstart",s[n],t)===!1&&(a=!0);this.preventNative&&a&&t.preventDefault(),this.propagateNative||t.stopPropagation(),this.tracking||this.bindEvents()}},touchMove:function(t){var e,n=this.getChangedTouches(t),i=this.tracker.update(n),o=!1,s=i.length;for(e=0;e<s;e++)this.dispatchEvent("em:touchmove",i[e],t)===!1&&(o=!0);this.preventNative&&o&&t.preventDefault(),this.propagateNative||t.stopPropagation()},touchEnd:function(t){var e,i,o=this.getChangedTouches(t),s=this.tracker.remove(o),a=this.preventNative,r=!1,c=s.length;for(i=0;i<c;i++){if(e=s[i],this.dispatchEvent("em:touchend",e,t)===!1&&(r=!0),e.isTap&&this.fastClick){var h=new n.MouseEvent("click",{bubbles:!0,cancelable:!0,clientX:e.point.x,clientY:e.point.y,screenX:e.screen.x,screenY:e.screen.y});h.isFastClick=!0,e.target.dispatchEvent(h),this.preventNextClick(e.point)}e.isSwipe&&this.dispatchEvent("em:swipe",e,t)}a&&r&&t.preventDefault(),this.propagateNative||t.stopPropagation(),this.tracker.empty()&&this.unbindEvents()},dispatchEvent:function(t,e,i){return n.dispatchEvent(e.target,t,!0,!0,{proxy:this,sequence:e,nativeEvent:i})},bindEvents:function(){this.tracking||(n.addListener(document,this.moveEvent,this.touchMove),n.addListener(document,this.endEvent,this.touchEnd),this.tracking=!0)},unbindEvents:function(){this.tracking&&(n.removeListener(document,this.moveEvent,this.touchMove),n.removeListener(document,this.endEvent,this.touchEnd),this.tracking=!1)},getTouches:function(t){return t.touches||[t]},getChangedTouches:function(t){return t.changedTouches||[t]},getSequence:function(t){return this.tracker.map[t]},getSequences:function(){return this.tracker.toArray()},preventNextClick:function(t){var e=function(e){var n=e.clientX-t.x,i=e.clientY-t.y;!e.isFastClick&&Math.sqrt(n*n+i*i)<20&&(e.preventDefault(),e.stopPropagation())},n=this.node;n.addEventListener("click",e,!0),setTimeout(function(){n.removeEventListener("click",e,!0)},s)},dispose:function(){this.unbindEvents(),n.removeListener(this.node,this.startEvent,this.touchStart),delete this.node},callbacks:["touchStart","touchMove","touchEnd"]});return h});
playtotv.define("playtotv.touch.touchManager",["playtotv.css.Vector","playtotv.touch.TouchProxy"],function(t,e){"use strict";var r=playtotv.dom,a="TouchEnabled",o={proxies:[],captureEvents:function(t,o){if(o=playtotv.params(o,{fastClick:!0,preventNative:!0,propagateNative:!1}),this.isCaptured(t))throw new Error("Node or ascendant is already captured by playtotv.touch");if(o.fastClick&&!o.preventNative)throw new Error("Ambiguous options: preventNative (false) is overruled by fastClick (true)");r.setData(t,a,!0);var i=new e(t,o);return this.proxies.push(i),i},releaseEvents:function(t){var e,o,i=this.proxies.length;for(e=0;e<i;e++)if(o=this.proxies[e],o.node===t)return r.removeData(t,a),this.proxies.splice(e,1),o.dispose(),!0;return!1},isCaptured:function(t){for(;t;){if(r.getData(t,a))return!0;t=t.parentNode}return!1},getAngle:function(t){var e=t.velocity;return Math.atan2(e.y,e.x)},getOrientation:function(e){var r=e.velocity;return Math.abs(r.x)>Math.abs(r.y)?t.HORIZONTAL:t.VERTICAL},getDirection:function(e){var r=e.velocity;return this.getOrientation(e)===t.HORIZONTAL?r.x>0?t.RIGHT:t.LEFT:r.y>0?t.DOWN:t.UP}};return o});
function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}playtotv.define("playtotv.mvc.App",["playtotv.mvc.Controller","playtotv.mvc.helpers","playtotv.mvc.Router","playtotv.mvc.View","playtotv.pubsub.PubSub","playtotv.storage.AsyncStorage","playtotv.storage.MockAsyncStorage","playtotv.touch.touchManager","playtotv.logUtil","playtotv.PauseDog"],function(t,e,o,r,n,i,s,a,u,p){"use strict";var c=playtotv,h=c.util,d=c.event,l=c.Logger.get(this.id),f=Promise.Cancellable;return function(t){function n(o){var r=this;_classCallCheck(this,n);var i=window.Handlebars;i&&(o.templates=o.templates||i.templates,i.registerHelper(e)),c.params(o,{id:c.REQUIRED,templates:c.REQUIRED,mockStorage:!1,router:{},touch:{},view:{},reloadTime:144e5}),t.call(this),this.id=o.id,this.templates=o.templates,this.storage=this.constructStorage(o.mockStorage),this.router=this.constructRouter(o.router),this.touchCaptured=this.constructTouch(o.touch),this.view=this.constructView(o.view),this.pauseDog=this.constructPauseDog(o.reloadTime),this.widgetMap={},this.widgets=[],d.addWindowOnError(this.onError.bind(this)),d.addListener(window,"beforeUnload",function(){return r.dispose()}),this.startLog()}return _inherits(n,t),n.prototype.constructStorage=function(t){var e=t?s:i;return new e(this.id+".")},n.prototype.constructRouter=function(t){var e=this,r=new o(c.extend({patterns:Object.keys(this.templates)},t));return r.subscribe("*",function(t,o){e.publish("route:"+o,t)}),r},n.prototype.constructTouch=function(t){return!!t&&(a.captureEvents(document,t),!0)},n.prototype.constructView=function(t){var e=this,o=new r(c.extend({render:function(){return e.templates[e.router.pattern](e)}},t));return o.nodeAddedListeners.push(this.onNodeAdded.bind(this)),o.nodeRemoveListeners.push(this.onNodeRemove.bind(this)),o},n.prototype.constructPauseDog=function(t){var e=this,o=new p;return o.add(t,function(){return e.reload()}),o},n.prototype.startLog=function(){var t=c.Logger.get(this.id);u.logPubSub(this,t.d.bind(t),{blacklist:["push.*","change:twitter.tweets"]}),this.view.subscribe("diffs",function(e){return t.d("view.diffs: "+e.length)}),this.subscribe("push.*",function(e,o){return t.s(o,e)}),u.logPubSub(this.view,t.s.bind(t),{name:"view"})},n.prototype.startView=function(){return this.view.update(),this.subscribe("*",this.view.update),this.view.when("change")},n.prototype.flush=function(t){return this.storage.set(t,this[t].serialize())},n.prototype.addController=function(t,e,o){var r=this;return this.storage.get(t).catch(function(){}).then(function(n){if(r[t])throw new Error("Controller name not available: "+t);var i=new e({name:t,app:r,stored:n},o);r[t]=i;var s=c.debounce(function(){return r.flush(t)},500);return i.subscribe("*",function(e,o){r.publish(t+"."+o,e),s()}),r.publish(t,i),i})},n.prototype.addControllers=function(t){var e=this;return Promise.all(t.map(function(t){return e.addController.apply(e,t)}))},n.prototype.setWidget=function(t,e){var o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];o.app=this,this.widgetMap[t]={WidgetClass:e,options:o}},n.prototype.setWidgets=function(t){var e=this;t.forEach(function(t){return e.setWidget.apply(e,t)})},n.prototype.instantiateWidget=function(t,e,o){var r=this.widgetMap[e];if(!r)throw new Error("Widget not found: "+e);var n=c.extend({},r.options,o),i=new r.WidgetClass(t,n);return this.widgets.push({node:t,name:e,instance:i}),i},n.prototype.removeWidgets=function(t,e){this.widgets=this.widgets.filter(function(o){var r=o[t]===e;return r&&o.instance.dispose(),!r})},n.prototype.runScript=function(t,e){var o=this;return new Promise(function(r){var n;if(0===t.indexOf('["')){var i=JSON.parse(t);t=i[0],n=i[1]}e=c.extend({app:o},o,n,e),r(h.eval(t,e))})},n.prototype.onNodeAdded=function(t){var e=this,o=t.getAttribute("widgets");o&&(o=0===o.indexOf('[["')?JSON.parse(o):o.split(/\s+/).map(function(t){return[t,{}]}),o.forEach(function(o){var r=o[0],n=o[1];e.instantiateWidget(t,r,n)})),Array.from(t.attributes||[]).forEach(function(o){var r=o.name.match(/on-(.*)/);if(r){var n=r[1],i=function(e){var r=this,n={node:t,event:e};this.runScript(o.value,n).catch(function(t){return r.onError(t)})}.bind(e);"node-added"===n?i():"node-remove"===n?t.onNodeRemove=i:d.addListener(t,n,i)}})},n.prototype.onNodeRemove=function(t){var e=t.onNodeRemove;e&&e(),this.removeWidgets("node",t)},n.prototype.get=function(t){var e=arguments.length<=1||void 0===arguments[1]?1e4:arguments[1],o=this[t];if(o)return f.resolve(o);var r=this.when(t);return e&&r.setTimeout(e),r},n.prototype.seek=function(t){var e=h.getPathHead(t),o=h.getPathTail(t);return this.get(e).then(function(t){return t.seek(o)})},n.prototype.observe=function(t,e){return this.seek(t).then(function(o){return e(o,t)}),this.subscribe(t,function(o){return e(o,t)})},n.prototype.unobserve=function(t){return this.unsubscribe(t)},n.prototype.call=function(t){var e=Array.from(arguments).slice(1);return this.get(h.getPathHead(t)).then(function(o){var r=o[h.getPathTail(t)];if(!r)throw new Error("Method not found: "+t);return r.apply(o,e)})},n.prototype.open=function(t,e,o){return e?this.popup(t,e,o):void(window.location=t)},n.prototype.openify=function(t,e){var o=c.params(e,{target:""}),r=o.target;return t&&t.replace(/<a /g,"<a on-click=\"event.preventDefault(); app.open(node.href, '"+r+"')\" ")},n.prototype.popup=function(t,e,o){var r=c.params(o,{width:0,height:0}),n=r.width,i=r.height;return h.popup(t,e,{width:n,height:i})},n.prototype.back=function(){window.history.go(-1)},n.prototype.reload=function(){window.location.reload(!0)},n.prototype.reset=function(){var t=this;this.storage.clear().finally(function(){return t.reload()})},n.prototype.onError=function(t){l.e(t),window.confirm(t.name+": "+t.message+".\n\nPress OK to reload and try again.")&&window.location.reload(!0)},n.prototype.dispose=function(){this.widgets.forEach(function(t){return t.dispose()}),this.pauseDog.dispose(),this.view.dispose(),this.touchCaptured&&a.releaseEvents(document),this.router.dispose(),t.prototype.dispose.call(this)},n}(n)});
playtotv.define("playtotv.twitter.twitterAPI",[],function(){"use strict";return{getRecentTweets:{label:"twitter.getRecentTweets",url:"1/twitter/recent"}}});
function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}playtotv.define("playtotv.twitter.TwitterController",["playtotv.mvc.Controller","playtotv.twitter.twitterAPI"],function(t,e){"use strict";var n=playtotv,r=n.util;return function(t){function o(r,i){var s=this;_classCallCheck(this,o),i=n.params(i,{maxItems:25});var a=r.stored||{};t.call(this,r,{model:{tweets:a.tweets||[]}}),this.addMethods(["getTweetParts","intent"]),this.maxItems=i.maxItems,this.scope.call("server.call",e.getRecentTweets,{}).then(function(t){s.cap(t),s.set("tweets",t),s.scope.subscribe("push.TWITTER-POST",function(t){return s.addTweet(t.payload)})})}return _inherits(o,t),o.prototype.cap=function(t){t.length=Math.min(t.length,this.maxItems)},o.prototype.addTweet=function(t){var e=this.model.tweets;e.unshift(t),this.cap(e)},o.prototype.getTweetParts=function(t){var e=[{type:"url",regex:new RegExp(r.URL_REGEXP.source)},{type:"mention",regex:/@(\w+)/},{type:"hash",regex:/#(\w+)/}].reduce(function(e,n){var r=n.regex.exec(t);return r&&("text"===e.type||r.index<e.index)?{index:r.index,type:n.type,text:r[0],match:r[1]}:e},{index:0,type:"text",text:t}),n=[e],o=e.index;o>0&&n.unshift({type:"text",text:t.substr(0,o)});var i=t.substr(o+e.text.length);return i?n.concat(this.getTweetParts(i)):n},o.prototype.intent=function(t,e){var n=r.addURLParams("https://twitter.com/intent/"+t,e);this.scope.open(n,"twitter-intent",{width:550,height:420})},o}(t)});
playtotv.define("playtotv.user.User",["playtotv.model.ObjectModel"],function(e){"use strict";var i=playtotv;return new i.Class({extend:e,initialize:function(t,r){this.server=t,i.params(r,{id:i.REQUIRED,displayName:void 0,avatarUrl:void 0,profileProperties:{}}),this._super({id:r.id,displayName:r.displayName,avatarUrl:r.avatarUrl,profileProperties:new e(r.profileProperties)})},dispose:function(){this.profileProperties.dispose(),e.prototype.dispose.call(this)}})});
playtotv.define("playtotv.user.usersAPI",[],function(){"use strict";return{addEmailCredentials:{label:"users.addEmailCredentials",url:"1/users/credentials/email",type:"POST",dataKeys:["email","password"]},addExternalIdCredentials:{label:"users.addExternalIdCredentials",url:"1/users/credentials/type/{type}",type:"POST",dataKeys:["externalId","signature"]},addFacebookCredentials:{label:"users.addFacebookCredentials",url:"1/users/credentials/facebook",type:"POST",dataKeys:["facebookId","fbsr"]},changePassword:{label:"users.changePassword",url:"1/users/credentials/changepassword",type:"POST",dataKeys:["oldPassword","newPassword"]},generatePassword:{label:"users.generatePassword",url:"1/users/credentials/generatepassword/email/{email}",type:"PUT"},getLoginCredentialStatus:{label:"users.getLoginCredentialStatus",url:"1/users/loginCredentialStatus"},getPrivateProperty:{label:"users.getPrivateProperty",url:"1/users/profile/{propertyName}/private"},getProfile:{label:"users.getProfile",url:"1/users/profile",queryKeys:["userId"]},getProfileProperty:{label:"users.getProfileProperty",url:"1/users/profile/{propertyName}",queryKeys:["userId"]},getUsers:{label:"users.getUsers",url:"1/users/",queryKeys:["userIds"]},loginByAuthenticationToken:{label:"users.loginByAuthenticationToken",url:"1/users/usersessions/authenticationToken",type:"POST",queryKeys:["runtimeId"],dataKeys:["authenticationToken"]},loginByEmail:{label:"users.loginByEmail",url:"1/users/usersessions/email",type:"POST",queryKeys:["runtimeId"],dataKeys:["email","password","rememberMe"]},loginByExternalId:{label:"users.loginByExternalId",url:"1/users/usersessions/externalId",type:"POST",queryKeys:["runtimeId"],dataKeys:["type","externalId","signature","displayName","avatarUrl","optionalValues"]},loginByFacebook:{label:"users.loginByFacebook",url:"1/users/usersessions/facebook",type:"POST",queryKeys:["runtimeId"],dataKeys:["facebookId","fbsr","displayName","avatarUrl","optionalValues"]},logout:{label:"users.logout",url:"1/users/usersessions/current",type:"DELETE",queryKeys:["runtimeId"]},logoutByPut:{label:"users.logoutByPut",url:"1/users/usersessions/current/logout",type:"PUT",queryKeys:["runtimeId"]},registerAsGuest:{label:"users.registerAsGuest",url:"1/users/register/guest",type:"POST",queryKeys:["runtimeId"],dataKeys:["optionalValues"]},registerByEmail:{label:"users.registerByEmail",url:"1/users/register/email",type:"POST",queryKeys:["runtimeId"],dataKeys:["displayName","avatarUrl","email","username","password","optionalValues"]},removeExternalId:{label:"users.removeExternalId",url:"1/users/credentials/type/{type}",type:"DELETE"},removeFacebookCredentials:{label:"users.removeFacebookCredentials",url:"1/users/credentials/facebook",type:"DELETE"},requestDeletion:{label:"users.requestDeletion",url:"1/users/",type:"POST",queryKeys:["runtimeId"]},requestEmailChange:{label:"users.requestEmailChange",url:"1/users/email/{email}",type:"PUT"},requestPasswordChange:{label:"users.requestPasswordChange",url:"1/users/credentials/changepassword/email/{email}",type:"PUT"},scheduleUserForDeletion:{label:"users.scheduleUserForDeletion",url:"1/users/scheduled",type:"POST",queryKeys:["runtimeId"],dataKeys:["reason"]},setPrivateProperty:{label:"users.setPrivateProperty",url:"1/users/profile/{propertyName}/private",type:"PUT",dataKeys:["value"]},setProfileProperty:{label:"users.setProfileProperty",url:"1/users/profile/{propertyName}",type:"PUT",dataKeys:["value"]},updateProfile:{label:"users.updateProfile",url:"1/users/profile",type:"PUT",dataKeys:["displayName","avatarUrl","properties","privateProperties"]},verifyEmail:{label:"users.verifyEmail",url:"1/users/verifyemail",type:"POST",dataKeys:["authenticationCode"]},verifyPasswordChange:{label:"users.verifyPasswordChange",url:"1/users/password",type:"PUT",dataKeys:["authenticationCode","password"]}}});
playtotv.define("playtotv.user.LocalUser",["playtotv.model.ObjectModel","playtotv.user.User","playtotv.user.usersAPI"],function(e,t,i){"use strict";var o=playtotv;return new o.Class({extend:t,initialize:function(t,i,r){r=o.params(r,{privateProperties:{},authenticationToken:void 0,pttvSession:void 0,email:void 0,username:void 0,facebookId:void 0}),this._super(t,i),this.storage=t.storage.subStorage("user/"+i.id+"/"),this.copyProperties({privateProperties:new e(r.privateProperties),authenticationToken:r.authenticationToken,pttvSession:r.pttvSession,email:r.email,username:r.username,facebookId:r.facebookId})},updateProfile:function(){return this.server.call(i.updateProfile,{displayName:this.displayName||null,avatarUrl:this.avatarUrl||null,properties:this.profileProperties.toObject(),privateProperties:this.privateProperties.toObject()})},dispose:function(){this.privateProperties.dispose(),t.prototype.dispose.call(this)}})});
function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}playtotv.define("playtotv.user.UserController",["playtotv.mvc.Controller","playtotv.user.usersAPI"],function(e,t){"use strict";var r=playtotv,o=r.Logger.get(this.id);return function(e){function i(t){_classCallCheck(this,i);var r=t.stored||{};e.call(this,t,{model:{current:r.current||null,online:!1}}),this.addMethods(["logout","getPrivateProperty","setPrivateProperty","updateProfile","extendPrivateProfile"]),this.login()}return _inherits(i,e),i.prototype.loginBy=function(e,t){var r=this;return this.scope.call("server.call",e,t).then(function(e){return r.set("current",e),r.set("online",!0),e})},i.prototype.loginByToken=function(){var e=this.model.current,r=e&&e.authenticationToken;return r?this.loginBy(t.loginByAuthenticationToken,{authenticationToken:r}):Promise.reject()},i.prototype.registerAsGuest=function(){return this.loginBy(t.registerAsGuest,{optionalValues:null})},i.prototype.login=function(){var e=this;return this.loginByToken().catch(function(){return e.registerAsGuest().catch(function(t){return o.e("login(): registerAsGuest failed, retrying in 5s",t),Promise.delay(5e3).then(function(){return e.login()})})})},i.prototype.logout=function(){var e=this;return this.scope.call("server.call",t.logout).finally(function(){e.scope.reset()})},i.prototype.getPrivateProperty=function(e){var t=this.model.current;return t&&t.profile.privateProperties[e]},i.prototype.setPrivateProperty=function(e,r){var o=this,i=this.model.current;return this.scope.call("server.call",t.setPrivateProperty,{propertyName:e,value:r}).then(function(){i.profile.privateProperties[e]=r,o.publish("set-private-property-"+e,r)})},i.prototype.updateProfile=function(e){var o=this,i=this.model.current;return e=r.params(e,{displayName:i.displayName||null,avatarUrl:i.avatarUrl||null,properties:i.profile.profileProperties,privateProperties:i.profile.privateProperties}),this.scope.call("server.call",t.updateProfile,e).then(function(){i.displayName=e.displayName,i.avatarUrl=e.avatarUrl,i.profile.profileProperties=e.properties,i.profile.privateProperties=e.privateProperties,o.publish("update-profile",e)})},i.prototype.extendPrivateProfile=function(e){var t=this.model.current;return this.updateProfile({privateProperties:r.extend({},t.profile.privateProperties,e)})},i}(e)});
playtotv.define("playtotv.user.UserManager",["playtotv.pubsub.PubSub","playtotv.user.LocalUser","playtotv.user.usersAPI"],function(e,t,o){"use strict";var i=playtotv,a=i.REQUIRED;return new i.Class({extend:e,initialize:function(e){this._super(),this.server=e;var t=this.storage=e.storage;this.authenticationMethod=t.get("authenticationMethod"),this.authenticationToken=t.get("authenticationToken"),this.localUser=null,e.rejectTaps.push(this.onServerReject)},saveAuthentication:function(e,t){this.authenticationMethod=e,this.storage.set("authenticationMethod",e),this.authenticationToken=t,this.storage.set("authenticationToken",t)},login:function(e,o,i){return this.server.call(e,o).then(function(o){var a=o.authenticationToken,r=o.profile||{},s=o.loginCredentialStatus||{};this.localUser&&this.onLogout();var n=new t(this.server,{id:o.userId,displayName:o.displayName,avatarUrl:o.avatarUrl,profileProperties:r.profileProperties},{privateProperties:r.privateProperties,authenticationToken:a,pttvSession:o.pttvSession,email:s.email,username:s.username,facebookId:s.facebookId});return this.localUser=n,i&&this.saveAuthentication(e.label,a),this.publish("login",n),n}.bind(this))},baseParams:{displayName:null,avatarUrl:null,runtimeId:void 0},optionalParams:{teamTag:void 0,emailOptinMode:void 0,properties:void 0,privateProperties:void 0},processParams:function(e){var t=Object.keys(this.optionalParams);return e.optionalValues=i.pick(e,t),i.omit(e,t)},registerAsGuest:function(e,t){return e=i.params(e,i.extend({},this.baseParams,this.optionalParams)),e=this.processParams(e),this.login(o.registerAsGuest,e,t)},registerByEmail:function(e,t){return e=i.params(e,i.extend({email:a,password:a,username:null},this.baseParams,this.optionalParams)),e=this.processParams(e),this.login(o.registerByEmail,e,t)},loginByEmail:function(e,t){return e=i.params(e,i.extend({email:a,password:a,rememberMe:!1},this.baseParams)),this.login(o.loginByEmail,e,t)},loginByFacebook:function(e,t){return e=i.params(e,i.extend({facebookId:a,fbsr:a},this.baseParams,this.optionalParams)),e=this.processParams(e),this.login(o.loginByFacebook,e,t)},addFacebookCredentials:function(e){e=i.params(e,{facebookId:a,fbsr:a});var t=this.localUser;return t?t.facebookId?Promise.reject(new Error("Local user already has Facebook Id")):this.server.call(o.addFacebookCredentials,e).then(function(){return t.changeProperty("facebookId",e.facebookId),t}):Promise.reject(new Error("Not logged in"))},removeFacebookCredentials:function(){var e=this.localUser;return e?e.facebookId?this.server.call(o.removeFacebookCredentials).then(function(){e.changeProperty("facebookId",void 0)}):Promise.reject(new Error("Local user does not have Facebook Id")):Promise.reject(new Error("Not logged in"))},loginByToken:function(e){return e=i.params(e,i.extend({authenticationToken:this.authenticationToken},this.baseParams)),e.authenticationToken?this.login(o.loginByAuthenticationToken,e):Promise.reject(new Error("Missing required parameter: authenticationToken"))},logout:function(e){return e&&this.saveAuthentication(null,null),this.server.call(o.logout).then(function(){return this.onLogout()}.bind(this))},onLogout:function(){var e=this.localUser;return e&&(e.dispose(),this.localUser=null,this.publish("logout",e)),e},onExpire:function(){var e=this.localUser;this.authenticationMethod=null,this.authenticationToken=null,e&&(this.publish("expire",e),this.onLogout())},onServerReject:function(e){463===e.status&&this.onExpire()},dispose:function(){var t=this.server.rejectTaps;t.splice(t.indexOf(this.onServerReject),1);var o=this.localUser;o&&o.dispose(),e.prototype.dispose.call(this)},callbacks:["onServerReject"]})});
function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function _inherits(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}playtotv.define("playtotv.widget.CountdownWidget",["playtotv.widget.Widget"],function(t){"use strict";var i=playtotv,e=i.dom,o=i.util;return function(t){function s(o,n){_classCallCheck(this,s),i.params(n,{app:null,time:i.REQUIRED}),t.call(this,o),this.time=n.time,this.dd=e.first(".dd",o),this.hh=e.first(".hh",o),this.mm=e.first(".mm",o),this.ss=e.first(".ss",o),this.update()}return _inherits(s,t),s.prototype.update=function(){var t=this;if(this.node){var i=Math.max(0,this.time-Date.now())/1e3;this.updateDigit(this.dd,i/86400),this.updateDigit(this.hh,i%86400/3600),this.updateDigit(this.mm,i%3600/60),this.updateDigit(this.ss,i%60),setTimeout(function(){return t.update()},1e3)}},s.prototype.updateDigit=function(t,i){t&&(t.innerHTML=o.pad(Math.floor(i)))},s}(t)});
playtotv.define("playtotv.widget.DraggableWidget",["playtotv.widget.Widget","playtotv.css.Vector","playtotv.fx.Transition","playtotv.animationFrame","playtotv.css.style","playtotv.touch.touchManager"],function(t,i,e,s,n,a){"use strict";var o=playtotv.dom,r=playtotv.event,h=1,c=2,d="ontouchstart"in window,l=new playtotv.Class({extend:t,initialize:function(t,s){if(this._super(t),!a.isCaptured(t))throw new Error("Required events not captured via playtotv.touch");s=playtotv.params(s,{orientation:i.VERTICAL,restrict:"inside",elastic:!1,inertia:!1,friction:50,priority:!1,handle:null}),this.start=i.ZERO,this.position=i.ZERO,this.transition=new e({callback:this.handleAnim,duration:1e3,easing:"cubicout"}),this.orientation=s.orientation,this.elastic=s.elastic,this.priority=s.priority,this.inertia=s.inertia,this.friction=s.friction,this.outside=!!/outside/i.test(s.restrict),this.limiter=new i(this.orientation===i.VERTICAL?0:1,this.orientation===i.HORIZONTAL?0:1),this.restricter=this.limiter.multiplyBy(.75);var n=s.handle;n&&(t=o.first(n,t)||t),this.addEventListener(t,"em:touchstart",this.dragStart),this.addEventListener(t,"em:touchmove",this.dragMove),this.addEventListener(t,"em:touchend",this.dragEnd),this.addEventListener(t,"em:swipe",this.handleSwipe),this.setup(),this.moveTo(this.start)},setup:function(){var t=this.node;this.content=n.getSize(t),this.view=n.getInnerSize(t.parentNode),this.space=this.view.subtract(this.content).multiply(this.limiter),this.min=this.space.min(i.ZERO),this.max=this.outside?i.ZERO:this.space.max(i.ZERO)},setState:function(t){this.state=t},getState:function(){return this.state},requestFrame:function(){this.request=s.request(this.handleFrame)},cancelFrame:function(){this.request&&(s.cancel(this.request),delete this.request)},dragStart:function(t){d||t.preventDefault(),this.touchId=t.detail.sequence.id,this.priority&&t.stopPropagation(),this.transition.playing&&(this.transition.stop(),this.setState(h)),this.start=this.position,this.lastOrientation=null,this.setup(),r.dispatchEvent(this.node,"em:dragstart",!1,!1,{offset:this.position})},dragMove:function(t){if(this.hasPriority(t)){t.preventDefault(),t.stopPropagation();var i=t.detail.sequence,e=this.start.add(i.offset),s=this.restrict(e,this.elastic);this.position=s,this.getState()!==c&&(this.setState(c),this.requestFrame())}},dragEnd:function(t){if(this.hasPriority(t))if(d||t.preventDefault(),t.stopPropagation(),delete this.touchId,this.inertia){var i=t.detail.sequence,e=i.velocity,s=Math.sqrt(e.magnitude())/this.friction,n=this.pulling?300:1e3*s;this.swipe(e.multiplyBy(s),n)}else this.handleStopped()},handleSwipe:function(t){this.hasPriority(t)&&t.stopPropagation()},hasPriority:function(t){var i=this.orientation,e=t.detail.sequence;return e.id===this.touchId&&(this.priority||!i||this.getOrientation(e)===i)},handleFrame:function(){this.moveTo(this.position),this.requestFrame()},handleStopped:function(){this.cancelFrame(),this.setState(h),r.dispatchEvent(this.node,"em:dragend",!1,!1,{offset:this.position})},moveTo:function(t){this.position=t,n.setTranslate(this.node,t),r.dispatchEvent(this.node,"em:dragmove",!1,!1,{offset:t})},moveBy:function(t){var i=this.position.add(t);this.moveTo(i)},moveIntoView:function(t,e){this.node.contains(t)&&(this.setup(),this.swipeTo(i.ZERO.subtract(n.getOffset(t)).add(n.getOffset(this.node)),e))},setRelative:function(t){this.moveTo(this.space.multiply(t))},getRelative:function(){var t=this.position,e=this.space;return new i(e.x?t.x/e.x:0,e.y?t.y/e.y:0)},getOrientation:function(t){return this.lastOrientation||(this.lastOrientation=a.getOrientation(t)),this.lastOrientation},getPosition:function(){return this.position},swipe:function(t,i){var e=this.position,s=this.restrict(e.add(t),!1);this.vector=s.subtract(e),this.start=e,this.cancelFrame(),this.transition.play({duration:i||1e3})},swipeTo:function(t,i){t=t.subtract(this.position),this.swipe(t,i)},handleAnim:function(t){var i=this.vector.multiplyBy(t);this.moveTo(this.start.add(i)),1===t&&this.handleStopped()},restrict:function(t,e){var s=this.limiter.multiply(t),n=this.min,a=this.max;if(e&&this.content.exceeds(this.view)){var o=s.x<n.x?s.x-n.x:s.x>a.x?s.x-a.x:0,r=s.y<n.y?s.y-n.y:s.y>a.y?s.y-a.y:0;this.pulling=!(!o&&!r);var h=this.restricter;return new i(s.x-o*h.x,s.y-r*h.y)}return s.limit(n,a)},dispose:function(){this.transition.playing&&this.transition.stop(),this.cancelFrame(),t.prototype.dispose.call(this)},callbacks:["handleSwipe","handleFrame","handleAnim","dragStart","dragMove","dragEnd"]});return l});
playtotv.define("playtotv.widget.FormWidget",["playtotv.widget.Widget"],function(t){"use strict";var e=playtotv,i=e.dom,a=e.event,n=new e.Class({initialize:function(t){t=e.params(t,{selector:e.REQUIRED,test:e.REQURIED,fallback:e.REQUIRED}),this.selector=t.selector,this.supported=t.test(),this.fallback=t.fallback},validate:function(t){return!i.matches(this.selector,t)||(this.supported?t.checkValidity():this.fallback(t))}}),r=[{selector:"[required]",test:function(){var t=document.createElement("input");return t.setAttribute("required",!0),t.checkValidity&&t.checkValidity()===!1},fallback:function(t){if(/radio|check/i.test(t.type)){var i=t.form.elements[t.name];return i.length?e.toArray(i).some(function(t){return t.checked}):t.checked}return!!t.value}},{selector:"[pattern]",test:function(){var t=document.createElement("input");return t.setAttribute("pattern","\\d+"),t.value="test",t.checkValidity&&t.checkValidity()===!1},fallback:function(t){return!t.value||new RegExp("^"+t.getAttribute("pattern")+"$").test(t.value)}},{selector:"[min],[max]",test:function(){var t=document.createElement("input");return t.setAttribute("type","number"),t.setAttribute("min",0),t.value=-1,"0"===t.value||t.checkValidity&&t.checkValidity()===!1},fallback:function(t){if(t.value){var e=parseFloat(t.value),i=t.getAttribute("min"),a=t.getAttribute("max");return!isNaN(e)&&(!i||e>=parseFloat(i))&&(!a||e<=parseFloat(a))}return!0}},{selector:"[type=date]",test:function(){var t=document.createElement("input");return t.setAttribute("type","date"),t.value="invalid",!t.value||t.checkValidity&&t.checkValidity()===!1},fallback:function(t){if(t.value){var e=Date.parse(t.value),i=t.getAttribute("min"),a=t.getAttribute("max");return!isNaN(e)&&(!i||e>=Date.parse(i))&&(!a||e<=Date.parse(a))}return!0}}],l=new e.Class({extend:t,initialize:function(t,a){if(!i.matches("form",t))throw new Error("Form expected");a=e.params(a,{app:null,controller:null,highlight:"error",field:".field",preventNative:!0,validateChange:!0}),this._super(t),this.field=a.field,this.highlightClass=a.highlight,this.preventNative=a.preventNative,this.addEventListener(t,"submit",this.onSubmit),a.validateChange&&this.addEventListener(t,"change",this.onChange),t.setAttribute("novalidate",!0),this.tests=r.map(function(t){return new n(t)})},onSubmit:function(t){var e=this;this.preventNative&&t.preventDefault();var i=this.validateForm();i.elements.forEach(function(t){e.highlight(t,!1)},this),i.errors.forEach(function(t){e.highlight(t,!0)},this),i.valid&&a.dispatchEvent(this.node,"submit-valid",!0,!0,{data:this.serialize(),validity:i,originalEvent:t})},onChange:function(t){var e=t.target,i=this.validateInput(e);this.highlight(e,!i)},highlight:function(t,e){var a=i.closest(this.field,t);a&&a.classList.toggle(this.highlightClass,e)},validateForm:function(){var t=this.getElements(),e=[];return t.forEach(function(t){this.validateInput(t)||e.push(t)},this),{elements:t,errors:e,valid:!e.length}},validateInput:function(t){var e=!t.checkValidity||t.checkValidity();return this.tests.forEach(function(i){e=e&&i.validate(t)}),e},getElements:function(){return e.toArray(this.node.elements)},serialize:function(){var t=this.getElements(),e={};return t.forEach(function(t){var i=t.name,a=t.type,n=t.value;i&&(/check|radio/i.test(a)&&!t.checked||(n&&/number|range/i.test(a)&&(n=parseFloat(n)),"select-multiple"===a&&(n=playtotv.toArray(t.options).filter(function(t){return t.selected}).map(function(t){return t.value})),e[i]=n))}),e},callbacks:["onChange","onSubmit"]});return l});
playtotv.define("playtotv.widget.ScalableWidget",["playtotv.css.style","playtotv.widget.Widget"],function(e,t){"use strict";var s=new playtotv.Class({extend:t,initialize:function(e,t){t=playtotv.params(t,{mode:"portrait",resize:!0}),this._super(e),this.mode=t.mode,this.resize=t.resize,this.addEventListener(window,"resize",playtotv.debounce(this.onResize,100)),this.onResize()},onResize:function(){var e=this.node;if(e){var t=e.parentNode,s="landscape"===this.mode?t.offsetWidth/e.offsetWidth:t.offsetHeight/e.offsetHeight;this.setScale(s),this.resize&&this.sizeToScale()}},sizeToScale:function(){var t=this.node,s=t.parentNode,i="landscape"===this.mode,o=i?"height":"width",a=i?s.offsetHeight/this.scale:s.offsetWidth/this.scale;e.set(t,o,a+"px")},setScale:function(t){this.scale=t,e.setTransform(this.node,"scale("+t+")")},getScale:function(){return this.scale},callbacks:["onResize"]});return s});
playtotv.define("playtotv.widget.ScrollableWidget",["playtotv.widget.Widget","playtotv.widget.DraggableWidget","playtotv.css.Vector","playtotv.css.style"],function(t,e,i,s){"use strict";var a=playtotv.dom,n=new playtotv.Class({extend:t,initialize:function(t,n){this._super(t),n=playtotv.params(n,{orientation:i.VERTICAL,restrict:"outside",content:".content",thumbH:"thumb-horizontal",thumbV:"thumb-vertical",active:"scrolling",disabled:"disabled",elastic:!0,inertia:!0,friction:50,priority:!1,handle:null});var o=a.first(n.content,t);if(!o)throw new ReferenceError('Content node "'+n.content+'" expected');var r=s.get(t,"display");if(!/block/i.test(r))throw new Error('Display "block" or "inline-block" is required for scrollable nodes');var l=s.get(t,"overflow");if("hidden"!==l)throw new Error('Overflow "hidden" is required for scrollable nodes');this.content=o,this.activeClass=n.active,this.disabledClass=n.disabled;var c=n.orientation;this.pane=new e(o,{orientation:c,restrict:n.restrict,elastic:n.elastic,inertia:n.inertia,friction:n.friction,priority:n.priority,handle:n.handle}),!n.thumbH||c!==i.HORIZONTAL&&c!==i.FREE||(this.thumbH=a.create("span",{class:n.thumbH},{appendTo:t})),!n.thumbV||c!==i.VERTICAL&&c!==i.FREE||(this.thumbV=a.create("span",{class:n.thumbV},{appendTo:t})),this.addEventListener(o,"em:dragstart",this.handleStart),this.addEventListener(o,"em:dragmove",this.handleDrag),this.addEventListener(o,"em:dragend",this.handleEnd),this.updateThumbs()},updateThumbs:function(){var t=this.pane,e=t.getRelative(),a=t.position,n=t.min,o=t.view,r=t.content,l=o.divide(r.max(o)),c=this.disabledClass,d=a.max(n.subtract(a)).max(i.ZERO),h=o.multiply(l).subtract(d),p=o.subtract(h),u=e.multiply(p).limit(i.ZERO,p),v=this.thumbH;v&&(s.set(v,"width",h.x+"px"),s.setTranslate(v,u.x+"px, 0"),v.classList.toggle(c,l.x>=1));var g=this.thumbV;g&&(s.set(g,"height",h.y+"px"),s.setTranslate(g,"0, "+u.y+"px"),g.classList.toggle(c,l.y>=1))},toggleActive:function(t){t!==this.scrolling&&(this.scrolling=t,this.node.classList.toggle(this.activeClass,t))},scrollIntoView:function(t,e){this.pane.moveIntoView(t,e)},scrollTo:function(t,e){this.pane.swipeTo(i.ZERO.subtract(t),e)},handleStart:function(t){t.stopPropagation();var e=this.pane;this.indicate=e.content.exceeds(e.view);var s=this.node,a=s.scrollLeft,n=s.scrollTop;(a||n)&&(s.scrollTop=s.scrollLeft=0,e.moveBy(new i(-a,-n)),e.start=e.position)},handleDrag:function(t){if(t.stopPropagation(),this.indicate){var e=this.pane,i=e.start,s=e.position,a=s.subtract(i).magnitude();!this.scrolling&&a>20&&this.toggleActive(!0),this.updateThumbs()}},handleEnd:function(t){t.stopPropagation(),this.toggleActive(!1)},callbacks:["handleStart","handleDrag","handleEnd"]});return n});
function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}playtotv.define("playtotv.widget.ThemeWidget",["playtotv.widget.Widget"],function(t){"use strict";var e=playtotv,o=e.dom;return function(t){function r(i,s){_classCallCheck(this,r),e.params(s,{app:null,theme:e.REQUIRED,target:"body"}),t.call(this,i);var n=this.theme=s.theme,a=this.target=o.first(s.target);a&&a.classList.add(n)}return _inherits(r,t),r.prototype.dispose=function(){this.target&&this.target.classList.remove(this.theme),t.prototype.dispose.call(this)},r}(t)});
function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function _inherits(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}playtotv.define("playtotv.widget.TimerWidget",["playtotv.css.style","playtotv.fx.Transition","playtotv.widget.Widget"],function(t,i,o){"use strict";var r=playtotv,e=r.dom;return function(o){function n(t,s){_classCallCheck(this,n),s=r.params(s,{app:null,indicator:".indicator",property:"width",inverted:!1,autoplay:!0,fps:1,start:0,time:0,end:0}),o.call(this,t),this.node=t,this.bar=e.first(s.indicator,t),this.property=s.property;var a=s.inverted;if(this.transition=new i({callback:this.handleFrame.bind(this),duration:1e3,from:a?1:0,to:a?0:1,fps:s.fps}),s.autoplay){var p=s,l=p.start,c=p.time,h=p.end,u=Date.now();l=l||u,c=c,h=h||l+c,this.start(h-l,l)}}return _inherits(n,o),n.prototype.start=function(t,i){if(isNaN(t))throw new TypeError("Duration is not a number");this.stop(),this.starttime=i||Date.now(),this.duration=t,this.transition.play({start:this.starttime,duration:this.duration})},n.prototype.stop=function(){this.transition.stop()},n.prototype.reset=function(){this.stop();var i=100*this.transition.settings.from;t.set(this.bar,this.property,i+"%")},n.prototype.handleFrame=function(i){t.set(this.bar,this.property,100*i+"%")},n.prototype.dispose=function(){this.stop(),o.prototype.dispose.call(this)},n}(o)});
function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}playtotv.define("playtotv.widget.TimestampWidget",["playtotv.widget.Widget"],function(t){"use strict";var e=24,o=60,i=60,n=o*i,r=e*n,a=playtotv;return function(t){function s(e,o){_classCallCheck(this,s),a.params(o,{app:null,time:a.REQUIRED}),t.call(this,e),this.time=o.time,this.update()}return _inherits(s,t),s.prototype.update=function(){var t,a=this,s=Math.floor((Date.now()-this.time)/1e3);t=s>=r?Math.floor(s/r)+"d":s>=n?Math.floor(s/n)%e+"h":s>=i?Math.floor(s/i)%o+"m":s%i+"s",this.node.innerHTML!==t&&(this.node.innerHTML=t),this.timeout=setTimeout(function(){a.update()},s>i?6e4:1e3)},s.prototype.dispose=function(){clearTimeout(this.timeout),t.prototype.dispose.call(this)},s}(t)});
playtotv.define("playtotv.widget.TransformableWidget",["playtotv.animationFrame","playtotv.css.Matrix","playtotv.css.style","playtotv.css.Vector","playtotv.widget.Widget"],function(t,e,a,i,s){"use strict";var n=new playtotv.Logger(this.id),o=1,h=2;return new playtotv.Class({extend:s,initialize:function(t,a){this._super(t),a=playtotv.params(a,{translate:!0,scale:!0,rotate:!0}),this.touches=[],this.transform=new e,this.translation=new i(0,0),this.scaling=1,this.rotation=0,this.deltaMove=new i(0,0),this.deltaAngle=0,this.deltaScale=1,this.addEventListener(t,"em:touchstart",this.touchStart),this.addEventListener(t,"em:touchmove",this.touchMove),this.addEventListener(t,"em:touchend",this.touchEnd)},setState:function(t){this.state=t},getState:function(){return this.state},requestFrame:function(){this.request=t.request(this.handleFrame)},cancelFrame:function(){this.request&&(t.cancel(this.request),delete this.request)},touchStart:function(t){t.preventDefault(),this.touches.push(t.detail.sequence.id)},touchMove:function(t){t.preventDefault();var e=t.detail.proxy,a=this.touches;if(a.length>0){var s=e.getSequence(a[0]),n=i.ZERO,o=0,r=1;if(a.length>1){var l=e.getSequence(a[1]),c=l.start.subtract(s.start),u=l.point.subtract(s.point);o=Math.atan2(-u.y,u.x)-Math.atan2(-c.y,c.x),r=u.magnitude()/c.magnitude(),n=s.offset.add(l.offset).divideBy(2)}this.deltaAngle=o,this.deltaScale=r,this.deltaMove=n,this.getState()!==h&&(this.setState(h),this.requestFrame())}},touchEnd:function(t){n.d(t),t.preventDefault();var e=this.touches,a=t.detail.sequence.id,i=e.indexOf(a);i>-1&&e.splice(i,1),this.translation=this.getTranslation(),this.rotation=this.getRotation(),this.scaling=this.getScaling(),this.cancelFrame(),this.setState(o)},getTranslation:function(){return this.translation.add(this.deltaMove)},getRotation:function(){return this.rotation+this.deltaAngle},getScaling:function(){return this.scaling*this.deltaScale},handleFrame:function(){var t=this.getTranslation(),e=this.getRotation(),i=this.getScaling(),s=this.transform.rotateZ(e).scale(i).translate(t);a.setTransform(this.node,s),this.requestFrame()},callbacks:["handleFrame","touchStart","touchMove","touchEnd"]})});
playtotv.define("playtotv.widget.VisualWidget",["playtotv.widget.Widget"],function(t){"use strict";var e=playtotv.dom,i=new playtotv.Class({extend:t,initialize:function(t,i){this._super(t),i=playtotv.params(i,{mode:"cover",image:"img"}),this.image=e.first(i.image,t),this.mode=i.mode,this.image&&(this.addEventListener(window,"resize",this.handleResize),this.addEventListener(this.image,"load",this.handleResize),this.handleResize())},handleResize:function(){if(this.node){var t=this.node,e=this.image,i=this.mode,s=e.style;e.removeAttribute("width"),e.removeAttribute("height"),s.margin=0;var a=t.offsetWidth,h=t.offsetHeight,d=e.offsetWidth/e.offsetHeight,n=a/h;n<d&&"contain"===i||n>d&&"cover"===i?(s.marginTop=-(a/d-h)/2+"px",e.setAttribute("width","100%")):(s.marginLeft=-(h*d-a)/2+"px",e.setAttribute("height","100%"))}},callbacks:["handleResize"]});return i});
playtotv.define("playtotv.widget.WidgetManager",[],function(){"use strict";var e=playtotv,t=e.dom,n=new e.Class({initialize:function(e,t){this.node=e||document,this.attr=t,this.definitions=[],this.instances=[]},register:function(e,t,n){var s=t.prototype;if(!s.getNode||!s.dispose)throw new ReferenceError("Class must define getNode() and dispose() methods");var i={selector:this.attr?"["+this.attr+'~="'+e+'"]':e,Class:t,options:n};return this.definitions.push(i),this.createInstances(this.node,i),i},unregister:function(e){if("object"!=typeof e)throw new TypeError("Object expected");var t=this.definitions,n=t.indexOf(e);n>-1&&(this.disposeInstances(this.node,e),t.splice(n,1))},onMutations:function(t){e.each(t,function(t){var n=t.removedNodes;n.length&&e.each(n,this.onNodeRemoved,this);var s=t.addedNodes;s.length&&e.each(s,this.onNodeAdded,this)},this)},onNodeAdded:function(e){t.isNode(e)&&this.definitions.forEach(function(t){this.createInstances(e,t)},this)},onNodeRemoved:function(e){t.isNode(e)&&this.disposeInstances(e)},createInstances:function(e,n){var s=t.any(n.selector,e);s.forEach(function(e){var t=n.Class;if(!this.getWidget(e,t)){var s=n.options;s=s instanceof Function?s(e):s,this.instances.push(new t(e,s))}},this)},disposeInstances:function(e,t){if(t&&!t.Class)throw new TypeError("Illegal definition");for(var n,s,i=this.instances,o=i.length-1,d=arguments.length<2,r=o;r>=0;r--)n=i[r],s=n.getNode(),!s||!e.contains(s)&&e!==s||!d&&n.constructor!==t.Class||(n.dispose(),i.splice(r,1))},getWidget:function(t,n){if(!n)throw new ReferenceError("Class expected");return e.find(this.instances,function(e){return e.getNode()===t&&e.constructor===n})},dispose:function(){this.disposeInstances(this.node),e.dispose(this)},callbacks:["onMutations","onNodeAdded","onNodeRemoved"]});return n});
