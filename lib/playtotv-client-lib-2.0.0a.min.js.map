{
	"version": 3,
	"sources": [
		"lib/next-tick.js",
		"lib/promise-em.js",
		"lib/promise-cancellable.js",
		"lib/dollar.js",
		"lib/playtotv.js",
		"lib/playtotv/dom.js",
		"lib/playtotv/event.js",
		"lib/playtotv/define.js",
		"lib/playtotv/util.js",
		"lib/playtotv/logger.js",
		"src/analytics/com-score-analytics.js",
		"src/analytics/google-analytics.js",
		"src/widget/widget.js",
		"src/analytics/analytics-widget.js",
		"src/animation-frame.js",
		"src/cookie.js",
		"src/cron.js",
		"src/css/vector.js",
		"src/css/point.js",
		"src/css/matrix.js",
		"src/css/style.js",
		"src/episode/episode-session-api.js",
		"src/facebook/facebook-adapter.js",
		"src/facebook/facebook-post-widget.js",
		"src/fx/animation.js",
		"src/fx/easing.js",
		"src/fx/timeline.js",
		"src/fx/transition.js",
		"src/global/generic-content-api.js",
		"src/global/global-data-api.js",
		"src/handlebars/hbs-util.js",
		"src/handlebars/helpers.js",
		"src/pubsub/subscription.js",
		"src/model/model-subscription.js",
		"src/pubsub/pub-sub.js",
		"src/mvc/controller.js",
		"src/episode/episode-controller.js",
		"src/fx/effects-controller.js",
		"src/global/global-controller.js",
		"src/model/abstract-model.js",
		"src/model/object-model.js",
		"src/facebook/facebook.js",
		"src/model/array-model.js",
		"src/model/model-util.js",
		"src/log-util.js",
		"src/mutation-observer.js",
		"src/mvc/bind-widget.js",
		"src/mvc/helpers.js",
		"src/mvc/router.js",
		"src/mvc/update-widget.js",
		"src/pause-dog.js",
		"src/timer.js",
		"src/mvc/view.js",
		"src/native/native-controller.js",
		"src/net/jsonp.js",
		"src/net/xhr-proxy.js",
		"src/net/request.js",
		"src/analytics/analytics-controller.js",
		"src/native/mock-native-controller.js",
		"src/push/push-controller.js",
		"src/question/question-api.js",
		"src/question/question-controller.js",
		"src/rating/rating-api.js",
		"src/rating/rating-input-widget.js",
		"src/rating/rating-controller.js",
		"src/relation/relation-subscription.js",
		"src/relation/relation-manager.js",
		"src/score/score-api.js",
		"src/server/gatekeeper-api.js",
		"src/storage/mock-storage.js",
		"src/storage/storage.js",
		"src/storage/async-storage.js",
		"src/storage/mock-async-storage.js",
		"src/server/server.js",
		"src/server/server-controller.js",
		"src/server/mock-server.js",
		"src/server/mock-server-controller.js",
		"src/touch/sequence.js",
		"src/touch/tracker.js",
		"src/touch/touch-proxy.js",
		"src/touch/touch-manager.js",
		"src/mvc/app.js",
		"src/twitter/twitter-api.js",
		"src/twitter/twitter-controller.js",
		"src/user/user.js",
		"src/user/users-api.js",
		"src/user/local-user.js",
		"src/user/user-controller.js",
		"src/user/user-manager.js",
		"src/widget/countdown-widget.js",
		"src/widget/draggable-widget.js",
		"src/widget/form-widget.js",
		"src/widget/scalable-widget.js",
		"src/widget/scrollable-widget.js",
		"src/widget/theme-widget.js",
		"src/widget/timer-widget.js",
		"src/widget/timestamp-widget.js",
		"src/widget/transformable-widget.js",
		"src/widget/visual-widget.js",
		"src/widget/widget-manager.js"
	],
	"names": [
		"tick",
		"task",
		"i",
		"len",
		"tasks",
		"length",
		"cb",
		"apply",
		"on",
		"args",
		"requestTick",
		"splice",
		"nextTick",
		"callback",
		"thisArg",
		"push",
		"global",
		"Function",
		"window",
		"MutationObserver",
		"WebKitMutationObserver",
		"el",
		"document",
		"createElement",
		"observe",
		"attributes",
		"setAttribute",
		"setImmediate",
		"pending",
		"addEventListener",
		"onMessage",
		"e",
		"source",
		"data",
		"msg",
		"stopPropagation",
		"postMessage",
		"setTimeout",
		"Object",
		"assign",
		"Promise",
		"prototype",
		"catchIf",
		"predicate",
		"onReject",
		"this",
		"reason",
		"catchClass",
		"Class",
		"finally",
		"Constructor",
		"constructor",
		"then",
		"value",
		"resolve",
		"defer",
		"deferred",
		"promise",
		"reject",
		"delay",
		"ms",
		"throttle",
		"interval",
		"call",
		"timeout",
		"arguments",
		"limit",
		"getShard",
		"limited",
		"key",
		"shard",
		"shardMap",
		"last",
		"now",
		"Date",
		"busy",
		"JSON",
		"stringify",
		"Array",
		"from",
		"debounce",
		"debounced",
		"clearTimeout",
		"extend",
		"dst",
		"src",
		"hasOwnProperty",
		"createClass",
		"Extend",
		"stat",
		"proto",
		"objectCreate",
		"create",
		"F",
		"CancellationError",
		"Error",
		"message",
		"captureStackTrace",
		"stack",
		"name",
		"TimeoutError",
		"Cancellable",
		"fn",
		"TypeError",
		"_promise",
		"_resolve",
		"_reject",
		"_parentPromises",
		"all",
		"values",
		"cancellable",
		"parents",
		"race",
		"onResolve",
		"onThenResolve",
		"result",
		"thenCancellable",
		"onThenReject",
		"cancel",
		"parentsLen",
		"_setTimeout",
		"_x",
		"_x2",
		"toString",
		"bind",
		"toPromise",
		"$",
		"selector",
		"context",
		"undefined",
		"querySelector",
		"$$",
		"querySelectorAll",
		"ptv",
		"playtotv",
		"nativeEach",
		"forEach",
		"uid",
		"getUID",
		"prefix",
		"each",
		"list",
		"pluck",
		"map",
		"item",
		"union",
		"array",
		"indexOf",
		"pick",
		"obj",
		"keys",
		"copy",
		"omit",
		"randomNr",
		"max",
		"min",
		"delta",
		"Math",
		"floor",
		"random",
		"randomItem",
		"shuffle",
		"temp",
		"rand",
		"cursor",
		"shuffled",
		"slice",
		"unstack",
		"once",
		"memo",
		"ran",
		"REQUIRED",
		"bindMethods",
		"instance",
		"methodNames",
		"params",
		"options",
		"defaults",
		"hasKey",
		"spliceParams",
		"spliced",
		"loadScript",
		"async",
		"script",
		"type",
		"loaded",
		"onload",
		"onreadystatechange",
		"rs",
		"readyState",
		"onerror",
		"head",
		"appendChild",
		"dispose",
		"disposed",
		"documentElement",
		"dataAttr",
		"dataMap",
		"matchesImplementation",
		"matches",
		"webkitMatchesSelector",
		"mozMatchesSelector",
		"msMatchesSelector",
		"oMatchesSelector",
		"Node",
		"contains",
		"arg",
		"compareDocumentPosition",
		"DOMTokenList",
		"node",
		"classList",
		"toggle",
		"_toggle",
		"token",
		"force",
		"dom",
		"index",
		"traverse",
		"sibling",
		"next",
		"nextSibling",
		"previous",
		"previousSibling",
		"closest",
		"any",
		"nodes",
		"filter",
		"l",
		"isNode",
		"nodeType",
		"isChild",
		"attr",
		"html",
		"innerHTML",
		"target",
		"text",
		"createTextNode",
		"remove",
		"parentNode",
		"removeChild",
		"appendTo",
		"refnode",
		"insertBefore",
		"insertAfter",
		"prependTo",
		"firstChild",
		"replace",
		"replaceChild",
		"parseHTML",
		"div",
		"fragment",
		"createDocumentFragment",
		"childNodes",
		"getData",
		"setData",
		"removeData",
		"getClosestAttr",
		"getAttribute",
		"getDataSet",
		"dataset",
		"reduce",
		"substr",
		"match",
		"letter",
		"toUpperCase",
		"Event",
		"MouseEvent",
		"CustomEvent",
		"supportsCustom",
		"custom",
		"preventDefault",
		"eventProto",
		"event",
		"bubbles",
		"cancelable",
		"evt",
		"createEvent",
		"initEvent",
		"detail",
		"initCustomEvent",
		"screenX",
		"screenY",
		"clientX",
		"clientY",
		"ctrlKey",
		"altKey",
		"shiftKey",
		"metaKey",
		"button",
		"buttons",
		"relatedTarget",
		"initMouseEvent",
		"EventListener",
		"listener",
		"babelHelpers",
		"classCallCheck",
		"addListener",
		"ReferenceError",
		"removeListener",
		"subject",
		"removeEventListener",
		"dispatchEvent",
		"triggerNative",
		"test",
		"addWindowOnError",
		"originalOnError",
		"errorMsg",
		"url",
		"line",
		"column",
		"error",
		"originalReturnValue",
		"getModuleURL",
		"id",
		"base",
		"pkgURL",
		"pkg",
		"path",
		"toLowerCase",
		"registerModule",
		"module",
		"current",
		"space",
		"spaces",
		"split",
		"loadPromises",
		"definePromises",
		"modules",
		"getModule",
		"define",
		"deps",
		"factory",
		"dependencies",
		"require",
		"getModuleId",
		"find",
		"importModules",
		"ids",
		"nameReg",
		"exec",
		"decodeURIComponent",
		"s",
		"util",
		"EMAIL_REGEXP",
		"RegExp",
		"URL_REGEXP",
		"ORIGIN_REGEXP",
		"escapeHtml",
		"unescaped",
		"escapeRegEx",
		"globToRegEx",
		"glob",
		"_glob",
		"candidate",
		"addURLParam",
		"sep",
		"encodeURIComponent",
		"addURLParams",
		"getURLParams",
		"location",
		"href",
		"query",
		"regex",
		"getOrigin",
		"baseUrl",
		"loc",
		"origin",
		"protocol",
		"popup",
		"width",
		"winWidth",
		"screen",
		"left",
		"round",
		"height",
		"winHeight",
		"top",
		"features",
		"join",
		"open",
		"pad",
		"str",
		"ch",
		"String",
		"parseInt",
		"timeStr",
		"date",
		"getHours",
		"getMinutes",
		"getSeconds",
		"getMilliseconds",
		"formatDate",
		"pattern",
		"_this",
		"hours",
		"letters",
		"output",
		"getFullYear",
		"getMonth",
		"getDate",
		"toCurrency",
		"number",
		"cents",
		"parseFloat",
		"toFixed",
		"nr",
		"dashCase",
		"m",
		"titleCase",
		"p1",
		"p2",
		"getPathHead",
		"getPathTail",
		"seekRef",
		"object",
		"seek",
		"ref",
		"resolvePath",
		"to",
		"fromDir",
		"lastIndexOf",
		"getTimeZone",
		"getTimezoneOffset",
		"sign",
		"abs",
		"eval",
		"trim",
		"semiIndex",
		"mode",
		"_this2",
		"escapedValue",
		"regexStr",
		"fuzzy",
		"startsWith",
		"endsWith",
		"equals",
		"filterFn",
		"order",
		"_this3",
		"desc",
		"sort",
		"a",
		"b",
		"page",
		"_page",
		"size",
		"ceil",
		"paged",
		"prev",
		"loggers",
		"numericLevelMap",
		"SPAM",
		"DEBUG",
		"INFO",
		"WARNING",
		"ERROR",
		"NONE",
		"logFuncMap",
		"urlParams",
		"fbl",
		"weinre",
		"Logger",
		"level",
		"get",
		"logger",
		"isEnabled",
		"myLevel",
		"log",
		"console",
		"p",
		"processed",
		"concat",
		"trace",
		"d",
		"w",
		"logLevel",
		"logJoin",
		"ComScoreAnalytics",
		"config",
		"udm_",
		"f",
		"h",
		"v",
		"t",
		"n",
		"r",
		"cookie",
		"o",
		"u",
		"c",
		"g",
		"escape",
		"unescape",
		"characterSet",
		"defaultCharset",
		"title",
		"URL",
		"referrer",
		"images",
		"Image",
		"ns_p",
		"write",
		"udm",
		"tag",
		"GoogleAnalytics",
		"fields",
		"setFields",
		"dimensionMap",
		"metricMap",
		"requires",
		"skipView",
		"ga",
		"q",
		"getElementsByTagName",
		"appId",
		"trackerPromise",
		"tracker",
		"getByName",
		"sendView",
		"sendScreenview",
		"sendPageview",
		"sendError",
		"isFatal",
		"description",
		"sendException",
		"nonInteraction",
		"sendEvent",
		"send",
		"screenName",
		"exDescription",
		"exFatal",
		"time",
		"category",
		"variable",
		"start",
		"sendTiming",
		"timingCategory",
		"timingVar",
		"timingValue",
		"action",
		"eventCategory",
		"eventAction",
		"sendSocial",
		"network",
		"socialNetwork",
		"socialAction",
		"socialTarget",
		"fieldName",
		"set",
		"processFields",
		"hitType",
		"hitCallback",
		"method",
		"shift",
		"unshift",
		"Widget",
		"eventListeners",
		"subscriptionRecords",
		"timeoutIds",
		"getNode",
		"eventListener",
		"found",
		"subscribe",
		"pubsub",
		"record",
		"subscription",
		"unsubscribe",
		"records",
		"_clearTimeout",
		"_x3",
		"_Widget",
		"AnalyticsWidget",
		"app",
		"controller",
		"separator",
		"view",
		"load",
		"click",
		"submit",
		"change",
		"nonInteractionRE",
		"eventOptions",
		"parts",
		"onEvent",
		"eventLabel",
		"inherits",
		"vendor",
		"request",
		"requestAnimationFrame",
		"cancelAnimationFrame",
		"vendors",
		"callTime",
		"nameEQ",
		"ca",
		"charAt",
		"substring",
		"days",
		"expires",
		"setTime",
		"getTime",
		"toGMTString",
		"labelledLog",
		"job",
		"quiet",
		"label",
		"repeat",
		"jobs",
		"tickTimeout",
		"timeoutJobs",
		"_now",
		"promisedJobs",
		"returnValueOrPromise",
		"func",
		"returnValue",
		"process",
		"timeLeft",
		"cron",
		"tickInterval",
		"at",
		"halt",
		"debug",
		"_min",
		"_max",
		"_sqrt",
		"sqrt",
		"Vector",
		"x",
		"y",
		"add",
		"subtract",
		"multiply",
		"multiplyBy",
		"divide",
		"divideBy",
		"dot",
		"magnitude",
		"normalize",
		"inverse",
		"modulo",
		"exceeds",
		"unit",
		"FREE",
		"VERTICAL",
		"HORIZONTAL",
		"UP",
		"RIGHT",
		"DOWN",
		"LEFT",
		"ZERO",
		"_parseFloat",
		"Point",
		"z",
		"toVector",
		"parseCSSMatrix",
		"matrix",
		"regMatrix",
		"IDENTITY",
		"entityMap",
		"Matrix",
		"setMatrixValue",
		"entities",
		"m11",
		"m12",
		"m21",
		"m22",
		"m41",
		"m42",
		"j",
		"k",
		"translate",
		"_translate",
		"scale",
		"_scale",
		"rotate",
		"rotateX",
		"rotateY",
		"rotateZ",
		"angle",
		"cos",
		"sin",
		"A",
		"B",
		"C",
		"D",
		"E",
		"G",
		"H",
		"K",
		"det",
		"transformPoint",
		"ua",
		"navigator",
		"userAgent",
		"browser",
		"gecko",
		"trident",
		"webkit",
		"presto",
		"PRIORITY",
		"_prefix",
		"cssTransform",
		"cssOrigin",
		"webkitConvert",
		"WebKitPoint",
		"webkitConvertPointFromPageToNode",
		"style",
		"getComputedStyle",
		"property",
		"setProperty",
		"computed",
		"getPropertyValue",
		"currentStyle",
		"removeProperty",
		"getSize",
		"offsetWidth",
		"offsetHeight",
		"getInnerSize",
		"clientWidth",
		"clientHeight",
		"getOffset",
		"parent",
		"offsetLeft",
		"offsetTop",
		"offsetParent",
		"fromNodeToPage",
		"vector",
		"point",
		"converted",
		"webkitConvertPointFromNodeToPage",
		"transform",
		"getFullTransform",
		"fromPageToNode",
		"setTransform",
		"getTransform",
		"removeTransform",
		"nodeTransform",
		"getTransformOrigin",
		"setPosition",
		"css",
		"getPosition",
		"setTranslate",
		"getTranslate",
		"getAsyncDataForEpisodeSession",
		"queryKeys",
		"getEpisodeSessionStateAsChanges",
		"getEpisodeSessionStateAsChangesSince",
		"getMaxScore",
		"getNonClosedSessions",
		"getNonClosedSessionsForShow",
		"getNonClosedSessionsForShowByName",
		"getSessionsInPhase",
		"getSessionsInPhaseForShow",
		"getSessionsInPhaseForShowByName",
		"getUserStatistics",
		"joinAndGetState",
		"joinInSync",
		"dataKeys",
		"leave",
		"FacebookAdapter",
		"facebook",
		"getLoginParams",
		"interactive",
		"login",
		"facebookId",
		"fbsr",
		"signedRequest",
		"displayName",
		"avatarUrl",
		"privateProperties",
		"props",
		"getCredentialParams",
		"ATTR_PREFIX",
		"FacebookPostWidget",
		"content",
		"postId",
		"onClick",
		"post",
		"animationFrame",
		"Animation",
		"settings",
		"alternate",
		"cycles",
		"duration",
		"fps",
		"rate",
		"requestFrame",
		"playing",
		"onTick",
		"cancelFrame",
		"play",
		"stop",
		"animation",
		"frame",
		"startTime",
		"frameTime",
		"reversed",
		"onStart",
		"pause",
		"paused",
		"pauseTime",
		"resume",
		"reset",
		"onFrame",
		"anim",
		"totalTime",
		"cycle",
		"finished",
		"onCycle",
		"onFinish",
		"easing",
		"linear",
		"quadin",
		"quadout",
		"quadinout",
		"cubicin",
		"cubicout",
		"cubicinout",
		"quartin",
		"quartout",
		"quartinout",
		"_Animation",
		"Timeline",
		"actions",
		"run",
		"reverse",
		"passed",
		"transitionOptions",
		"Transition",
		"ease",
		"getCategory",
		"hbsUtil",
		"softException",
		"exception",
		"Handlebars",
		"Exception",
		"getValue",
		"getHash",
		"hash",
		"newHash",
		"getArgs",
		"names",
		"nrRequired",
		"nrOptional",
		"pop",
		"nrNames",
		"nrArgs",
		"requiredNames",
		"optionalNames",
		"extendContext",
		"callHelper",
		"_len",
		"_key",
		"helpers",
		"delegateIfBlock",
		"helperName",
		"clearHash",
		"var",
		"_hbsUtil$getArgs",
		"createFrame",
		"is",
		"_hbsUtil$getArgs2",
		"value1",
		"value2",
		"isnt",
		"_hbsUtil$getArgs3",
		"default",
		"_hbsUtil$getArgs4",
		"def",
		"switch",
		"_hbsUtil$getArgs5",
		"classes",
		"_hbsUtil$getArgs6",
		"inc",
		"_hbsUtil$getArgs7",
		"dec",
		"_hbsUtil$getArgs8",
		"gt",
		"_hbsUtil$getArgs9",
		"lt",
		"_hbsUtil$getArgs10",
		"not",
		"_hbsUtil$getArgs11",
		"or",
		"_hbsUtil$getArgs12",
		"and",
		"_hbsUtil$getArgs13",
		"inArray",
		"_hbsUtil$getArgs14",
		"_hbsUtil$getArgs15",
		"_hbsUtil$getArgs16",
		"toNumber",
		"_hbsUtil$getArgs17",
		"toBool",
		"_hbsUtil$getArgs18",
		"lowerCase",
		"_hbsUtil$getArgs19",
		"upperCase",
		"_hbsUtil$getArgs20",
		"_hbsUtil$getArgs21",
		"sentenceCase",
		"_hbsUtil$getArgs22",
		"_hbsUtil$getArgs23",
		"_hbsUtil$getArgs24",
		"_hbsUtil$getArgs25",
		"_hbsUtil$getArgs26",
		"inflect",
		"_hbsUtil$getArgs27",
		"count",
		"singular",
		"plural",
		"truncate",
		"_hbsUtil$getArgs28",
		"dots",
		"_hbsUtil$getArgs29",
		"_hbsUtil$getArgs30",
		"getURLParam",
		"_hbsUtil$getArgs31",
		"urlOrKey",
		"_hbsUtil$getArgs32",
		"addCommas",
		"_hbsUtil$getArgs33",
		"decimal",
		"_hbsUtil$getArgs34",
		"digits",
		"_hbsUtil$getArgs35",
		"_hbsUtil$getArgs36",
		"_hbsUtil$getArgs37",
		"_hbsUtil$getArgs38",
		"take",
		"_hbsUtil$getArgs39",
		"taken",
		"_hbsUtil$getArgs40",
		"filtered",
		"_hbsUtil$getArgs41",
		"ordered",
		"paginate",
		"_hbsUtil$getArgs42",
		"json",
		"_hbsUtil$getArgs43",
		"pretty",
		"_hbsUtil$getArgs44",
		"helperMissing",
		"Subscription",
		"handler",
		"channel",
		"deliver",
		"_Subscription",
		"ModelSubscription",
		"noValue",
		"PubSub",
		"subscriptions",
		"cancellables",
		"subscribeAll",
		"unsubscribeAll",
		"when",
		"publish",
		"sync",
		"_PubSub",
		"Controller",
		"_ptv$params",
		"store",
		"stored",
		"storeKeys",
		"deserialize",
		"serialize",
		"code",
		"details",
		"flush",
		"setWidget",
		"WidgetClass",
		"setWidgets",
		"widgets",
		"episodeSessionAPI",
		"_Controller",
		"EpisodeController",
		"timeZone",
		"showName",
		"showId",
		"episodeSessionId",
		"model",
		"waiting",
		"episodeInteractionUserDataMap",
		"addMethods",
		"predictionTypes",
		"scope",
		"onStreamChange",
		"onChangeEvent",
		"onUpdateEvent",
		"online",
		"hasStarted",
		"adaptEpisode",
		"interactionMap",
		"interactionQueue",
		"asyncInteractions",
		"position",
		"episodeData",
		"episodeSession",
		"episode",
		"state",
		"stateChanges",
		"onStateChange",
		"checkState",
		"getEpisode",
		"checkingState",
		"sinceVersion",
		"version",
		"getInteraction",
		"getCurrentInteraction",
		"getAsyncInteractions",
		"phase",
		"currentPhase",
		"interactions",
		"interaction",
		"upsertInteraction",
		"getNextAsyncInteraction",
		"submitInteraction",
		"interactionId",
		"adaptor",
		"_this4",
		"serverTime",
		"stateTime",
		"stateTimeMap",
		"ANSWER",
		"clientAnswerTime",
		"setInteractionUserData",
		"getInteractionUserData",
		"episodeId",
		"interactionUserDataMap",
		"payload",
		"stateDurationMap",
		"interactionContent",
		"interactionStats",
		"stats",
		"interactionUserData",
		"queueInteraction",
		"queue",
		"updateInteractionPosition",
		"lastquestion",
		"newVersion",
		"publishIfNotQuiet",
		"onPhaseChange",
		"onInteractionChange",
		"sessionPhase",
		"interactionState",
		"oldJSON",
		"newJSON",
		"EffectsController",
		"transitions",
		"fxDelay",
		"transitionMap",
		"defaultMap",
		"onceMap",
		"nodeAddedListeners",
		"onNodeAdded",
		"nodeRemoveListeners",
		"onNodeRemove",
		"transitionName",
		"getSelectors",
		"getTransition",
		"affected",
		"transition",
		"playAnimation",
		"enter",
		"prevAnimation",
		"genericContentAPI",
		"globalDataAPI",
		"GlobalController",
		"getContent",
		"getContentNow",
		"update",
		"onData",
		"onUpdate",
		"uniqueIdField",
		"items",
		"AbstractModel",
		"toObject",
		"updateModel",
		"isRelatedModel",
		"getSelectorAction",
		"colonIndex",
		"getSelectorKey",
		"eqIndex",
		"getSelectorValue",
		"getSelectorMatches",
		"val",
		"init",
		"_AbstractModel",
		"ObjectModel",
		"propertyKeys",
		"childSubscriptionMap",
		"copyProperties",
		"keysLength",
		"sourceKeys",
		"removedValues",
		"sourceKey",
		"addProperty",
		"changeProperty",
		"root",
		"childModel",
		"subscribeChild",
		"child",
		"childValue",
		"childAction",
		"childKey",
		"unsubscribeChild",
		"childSubscription",
		"valueIsModel",
		"oldValue",
		"_ObjectModel",
		"Facebook",
		"status",
		"accessToken",
		"xfbml",
		"frictionlessRequests",
		"hideFlashCallback",
		"locale",
		"redirect",
		"initialized",
		"fbAsyncInit",
		"FB",
		"onStatusResponse",
		"getLoginStatus",
		"response",
		"authResponse",
		"userID",
		"what",
		"timeoutDetails",
		"api",
		"ui",
		"getFriends",
		"loginByRedirect",
		"loginByDialog",
		"client_id",
		"response_type",
		"redirect_uri",
		"logout",
		"postByRedirect",
		"postByDialog",
		"postByAPI",
		"post_id",
		"app_id",
		"countEqualItems",
		"ArrayModel",
		"childSubscriptions",
		"sourceLength",
		"removedItems",
		"arrayLength",
		"itemIsModel",
		"RangeError",
		"oldItem",
		"removeWhere",
		"condition",
		"removed",
		"clear",
		"doNotThrow",
		"isArray",
		"updatedSource",
		"sValue",
		"mValue",
		"svIsArray",
		"svIsObject",
		"rValue",
		"rModel",
		"modelUtil",
		"logPubSub",
		"levelMap",
		"*",
		"rules",
		"rule",
		"logModel",
		"blacklist",
		"pak",
		"logMethod",
		"methodName",
		"logName",
		"logMethods",
		"mutationRecord",
		"addedNodes",
		"removedNodes",
		"attributeName",
		"attributeNamespace",
		"mutationOptions",
		"childList",
		"characterData",
		"subtree",
		"attributeOldValue",
		"characterDataOldValue",
		"attributeFilter",
		"processors",
		"DOMNodeInserted",
		"inserted",
		"DOMNodeRemoved",
		"DOMAttrModified",
		"attrName",
		"prevValue",
		"DOMCharacterDataModified",
		"MutationProxy",
		"proxyEvent",
		"observer",
		"processor",
		"onModified",
		"addRecord",
		"disconnect",
		"listeners",
		"notify",
		"takeRecords",
		"WebkitMutationObserver",
		"MozMutationObserver",
		"BindWidget",
		"updateInput",
		"updateApp",
		"onInputChange",
		"checked",
		"templateStack",
		"methodPath",
		"methodRef",
		"serialized",
		"Utils",
		"escapeExpression",
		"SafeString",
		"widget",
		"templatePath",
		"router",
		"partial",
		"partialBlock",
		"registerPartial",
		"partials",
		"templates",
		"unregisterPartial",
		"Router",
		"rescue",
		"patterns",
		"routes",
		"onhashchange",
		"getParams",
		"route",
		"UpdateWidget",
		"runScript",
		"PauseDog",
		"pauseCallbacks",
		"scheduleTick",
		"lastTick",
		"threshold",
		"pauseCallback",
		"pcb",
		"Timer",
		"t0",
		"accounted",
		"timings",
		"tx",
		"end",
		"finish",
		"total",
		"unaccounted",
		"string",
		"pdom",
		"Polymer",
		"linkNode",
		"domNode",
		"domChildNodes",
		"nodesEqual",
		"node1",
		"node2",
		"TEXT_NODE",
		"COMMENT_NODE",
		"nodeName",
		"id1",
		"id2",
		"popEqualNode",
		"candidates",
		"addAttributeDiffs",
		"oldNode",
		"newNode",
		"diffs",
		"hasAttribute",
		"addClassDiffs",
		"oldClassList",
		"newClassList",
		"diffNodes",
		"oldChild",
		"newChild",
		"oldChildren",
		"newChildren",
		"nrDiffed",
		"ELEMENT_NODE",
		"pruneIndentation",
		"children",
		"View",
		"render",
		"onAttrSet",
		"onAttrRemove",
		"parser",
		"DOMParser",
		"oldHTML",
		"oldDoc",
		"parseFromString",
		"prop",
		"updateNow",
		"timer",
		"intervalTimeout",
		"newHTML",
		"newDoc",
		"applyDiffs",
		"fixNodeOrder",
		"newDomChild",
		"prevDomChild",
		"parentDomNode",
		"DOCUMENT_POSITION_FOLLOWING",
		"diff",
		"_diff",
		"importedNode",
		"importNode",
		"domSibling",
		"notifyNodeAdded",
		"notifyNodeRemove",
		"removeAttribute",
		"commandIdCounter",
		"NativeController",
		"wrapperPromise",
		"onWrapper",
		"gatekeeperPromise",
		"onGatekeeper",
		"onBackButton",
		"onPushEnabled",
		"onPushEnabledChange",
		"wrapper",
		"nativeWrapper",
		"sendMessage",
		"pauseDog",
		"commandId",
		"sendCommand",
		"fallback",
		"resultPromise",
		"gatekeeperResponse",
		"serverUrl",
		"gatekeeperData",
		"gatekeeperDataTime",
		"gatekeeperTimestamp",
		"dialog",
		"pressed",
		"back",
		"enabled",
		"getWrapper",
		"getGatekeeper",
		"overlay",
		"itunes",
		"affiliate",
		"isTwitterAvailable",
		"available",
		"tweet",
		"fbLogin",
		"permissions",
		"fbLogout",
		"fbGraph",
		"parameters",
		"httpMethod",
		"fbShare",
		"image",
		"contentTitle",
		"contentDescription",
		"contentURL",
		"imageURL",
		"loadAudio",
		"playAudio",
		"stopAudio",
		"jsonp",
		"timeoutId",
		"supportsObjectTestHandler",
		"supportsObject",
		"createIFrame",
		"iframe",
		"visibility",
		"overflow",
		"display",
		"getWindow",
		"deferredWindow",
		"deferredWindows",
		"body",
		"execBatch",
		"originWindow",
		"xhr",
		"xhrs",
		"batch",
		"_batch",
		"rpcAbort",
		"rpcs",
		"_execBatch",
		"addEventSupport",
		"upload",
		"_eventListenersMap",
		"xhrMethods",
		"xhrCounter",
		"parse",
		"stopImmediatePropagation",
		"win",
		"uploadEvent",
		"eventType",
		"responseText",
		"_readyStateChange",
		"xhrProxy",
		"timeoutRef",
		"responseData",
		"dataType",
		"windowOrigin",
		"urlOrigin",
		"headers",
		"username",
		"password",
		"onProgressDown",
		"onProgressUp",
		"cache",
		"XMLHttpRequest",
		"loadEventSupported",
		"errorEventSupported",
		"abortEventSupported",
		"timeoutEventSupported",
		"abort",
		"lengthComputable",
		"setRequestHeader",
		"taps",
		"tap",
		"AnalyticsController",
		"privateGoogle",
		"sampleRate",
		"googles",
		"comScore",
		"addWidget",
		"googleOptions",
		"comScoreOptions",
		"privateError",
		"hookRequestTap",
		"cleanUrl",
		"privateTime",
		"timingLabel",
		"privateEvent",
		"lastView",
		"google",
		"getMatch",
		"idx",
		"_NativeController",
		"MockNativeController",
		"audioNodeMap",
		"getDevice",
		"capabilities",
		"pushEnabled",
		"requestUrl",
		"gatekeeperDataPromise",
		"services",
		"mockMessage",
		"initLoading",
		"loadingNode",
		"className",
		"bottom",
		"right",
		"background",
		"color",
		"text-align",
		"padding-top",
		"z-index",
		"deviceName",
		"deviceModel",
		"os",
		"osVersion",
		"onCommandHideLoading",
		"onCommandOpenDialog",
		"ok",
		"confirm",
		"alert",
		"onCommandSetPushEnabled",
		"onCommandIsTwitterAccountAvailable",
		"onCommandFacebookLogin",
		"onCommandFacebookLogout",
		"onCommandFacebookGraphRequest",
		"friends",
		"paging",
		"summary",
		"total_count",
		"me",
		"permission",
		"first_name",
		"last_name",
		"picture",
		"me/friends",
		"onCommandFacebookShare",
		"link",
		"onCommandLoadAudio",
		"onCommandPlayAudio",
		"onCommandStopAudio",
		"pushPollAPI",
		"getEvents",
		"PushController",
		"pollTimeout",
		"poll",
		"events",
		"stream",
		"getParticipantAnswers",
		"getQuestion",
		"getQuestionStats",
		"submitAnswer",
		"questionAPI",
		"QuestionController",
		"idCode",
		"submitting",
		"questionId",
		"answerCodes",
		"decorateAnswers",
		"question",
		"statsAnswers",
		"answers",
		"submittedAnswerCodes",
		"submittedAnswers",
		"answer",
		"answerCode",
		"answerStats",
		"submitted",
		"getRating",
		"getRatingStats",
		"submitRating",
		"RatingInputWidget",
		"onChange",
		"ratingAPI",
		"FACTOR",
		"RatingController",
		"addWidgets",
		"valueMap",
		"ratingId",
		"submittedValueMap",
		"decorateSubjects",
		"rating",
		"subjectAverages",
		"subjects",
		"subjectCode",
		"subjectAverage",
		"average",
		"RelationSubscription",
		"isStr",
		"regexIndex",
		"RelationManager",
		"rel",
		"getCurrentLeaderboardPage",
		"getCurrentLeaderboardPageForInterval",
		"getEpisodeLeaderboardPage",
		"getEpisodeScores",
		"getLeaderboardPageForInterval",
		"getTimeSpanScores",
		"getInit",
		"MockStorage",
		"_container",
		"getItem",
		"setItem",
		"_updateLength",
		"removeItem",
		"Storage",
		"storage",
		"localStorage",
		"defaultValue",
		"quotaHandler",
		"DOMException",
		"QUOTA_EXCEEDED_ERR",
		"subStorage",
		"subPrefix",
		"_sql",
		"db",
		"transaction",
		"executeSql",
		"results",
		"moduleId",
		"TABLE",
		"AsyncStorage",
		"ready",
		"openDatabase",
		"rows",
		"sql",
		"_AsyncStorage",
		"MockAsyncStorage",
		"gatekeeperAPI",
		"_request",
		"_log",
		"gatekeeperInit",
		"gatekeeper",
		"Server",
		"urls",
		"timeOffset",
		"clientMinimalVersion",
		"badDelay",
		"onRetry",
		"serviceUrls",
		"urlPromises",
		"gatekeeperUrl",
		"getGatekeeperServiceUrl",
		"service",
		"retryDelay",
		"resolveTaps",
		"rejectTaps",
		"setStatus",
		"checkBad",
		"badPending",
		"_getServiceUrls",
		"getServiceUrls",
		"getServiceUrl",
		"urlKeys",
		"placeholders",
		"placeholder",
		"validateCall",
		"validKeys",
		"invalidKeys",
		"requiredKeys",
		"undefinedKeys",
		"dataPromise",
		"serviceType",
		"myServiceUrls",
		"newServiceUrls",
		"urlsService",
		"myNewServiceUrls",
		"invalidateServiceUrl",
		"retry",
		"currentSettings",
		"getUrlAndRequest",
		"methodUrl",
		"urlPromise",
		"serviceUrl",
		"requestPromise",
		"methodService",
		"gatekeeperMethodUrl",
		"toClientTime",
		"toServerTime",
		"clientTime",
		"callAsyncCounter",
		"ServerController",
		"server",
		"getServer",
		"properties",
		"methods",
		"addMethod",
		"asyncCalls",
		"onAsyncResponse",
		"addRejectTap",
		"tapFn",
		"callAsync",
		"callId",
		"responseStatus",
		"responseBody",
		"_Server",
		"MockServer",
		"mocks",
		"isDefaultValue",
		"mockMap",
		"gatekeeperLabel",
		"pushPollLabel",
		"mockGatekeeper",
		"mockPushPoll",
		"mock",
		"template",
		"_ServerController",
		"MockServerController",
		"SWIPE_DELAY",
		"SENSITIVITY",
		"Sequence",
		"pointerId",
		"identifier",
		"offset",
		"velocity",
		"isTap",
		"isSwipe",
		"clearSwipe",
		"nativeMap",
		"Tracker",
		"touches",
		"touch",
		"sequence",
		"toArray",
		"empty",
		"needsFastClick",
		"nativeTouch",
		"nativePointers",
		"maxPointers",
		"winMobile",
		"iOs",
		"android",
		"chrome",
		"firefox",
		"viewMeta",
		"touchAction",
		"msTouchAction",
		"inputReg",
		"CLICK_DELAY",
		"maxTouchPoints",
		"msMaxTouchPoints",
		"TouchProxy",
		"fastClick",
		"preventNative",
		"propagateNative",
		"startEvent",
		"moveEvent",
		"endEvent",
		"touchStart",
		"changed",
		"getChangedTouches",
		"added",
		"prevent",
		"tracking",
		"bindEvents",
		"touchMove",
		"touchEnd",
		"isFastClick",
		"preventNextClick",
		"unbindEvents",
		"proxy",
		"nativeEvent",
		"getTouches",
		"changedTouches",
		"getSequence",
		"getSequences",
		"nextClick",
		"dx",
		"dy",
		"TOUCH_ENABLED",
		"touchManager",
		"proxies",
		"captureEvents",
		"isCaptured",
		"releaseEvents",
		"getAngle",
		"atan2",
		"getOrientation",
		"getDirection",
		"App",
		"registerHelper",
		"reloadTime",
		"logEnabled",
		"constructLog",
		"constructStorage",
		"constructRouter",
		"touchCaptured",
		"constructTouch",
		"constructView",
		"constructPauseDog",
		"widgetMap",
		"scriptListeners",
		"onError",
		"view.slow",
		"view.update",
		"view.diffs.*",
		"logRules",
		"StorageClass",
		"isSlow",
		"_update$timer",
		"_this5",
		"reload",
		"startView",
		"addController",
		"ControllerClass",
		"_this6",
		"debouncedFlush",
		"addControllers",
		"controllers",
		"_this7",
		"getController",
		"tail",
		"instantiateWidget",
		"instanceOptions",
		"disposeWidgets",
		"by",
		"setNodeWidgets",
		"oldWidgets",
		"_this8",
		"ret",
		"_this9",
		"scriptContext",
		"_JSON$parse",
		"setNodeScript",
		"_this10",
		"openify",
		"_ptv$params2",
		"_ptv$params3",
		"history",
		"go",
		"_this11",
		"lastError",
		"clearError",
		"getRecentTweets",
		"twitterAPI",
		"TwitterController",
		"maxItems",
		"tweets",
		"cap",
		"addTweet",
		"getTweetParts",
		"part",
		"intent",
		"User",
		"profileProperties",
		"addEmailCredentials",
		"addExternalIdCredentials",
		"addFacebookCredentials",
		"changePassword",
		"generatePassword",
		"getLoginCredentialStatus",
		"getPrivateProperty",
		"getProfile",
		"getProfileProperty",
		"getUsers",
		"loginByAuthenticationToken",
		"loginByEmail",
		"loginByExternalId",
		"loginByFacebook",
		"logoutByPut",
		"registerAsGuest",
		"registerByEmail",
		"removeExternalId",
		"removeFacebookCredentials",
		"requestDeletion",
		"requestEmailChange",
		"requestPasswordChange",
		"scheduleUserForDeletion",
		"setPrivateProperty",
		"setProfileProperty",
		"updateProfile",
		"verifyEmail",
		"verifyPasswordChange",
		"usersAPI",
		"_User",
		"LocalUser",
		"user",
		"authenticationToken",
		"pttvSession",
		"email",
		"UserController",
		"loginBy",
		"loginByToken",
		"optionalValues",
		"profile",
		"propertyName",
		"extendPrivateProfile",
		"UserManager",
		"baseParams",
		"runtimeId",
		"optionalParams",
		"teamTag",
		"emailOptinMode",
		"authenticationMethod",
		"localUser",
		"onServerReject",
		"saveAuthentication",
		"remember",
		"credentials",
		"loginCredentialStatus",
		"onLogout",
		"userId",
		"processParams",
		"optionalKeys",
		"rememberMe",
		"forget",
		"onExpire",
		"CountdownWidget",
		"dd",
		"hh",
		"mm",
		"ss",
		"updateDigit",
		"STATE_PASSIVE",
		"STATE_ACTIVE",
		"DraggableWidget",
		"orientation",
		"restrict",
		"elastic",
		"inertia",
		"friction",
		"priority",
		"handle",
		"handleAnim",
		"outside",
		"limiter",
		"restricter",
		"dragStart",
		"dragMove",
		"dragEnd",
		"handleSwipe",
		"setup",
		"moveTo",
		"setState",
		"getState",
		"handleFrame",
		"touchId",
		"lastOrientation",
		"hasPriority",
		"restricted",
		"factor",
		"pulling",
		"swipe",
		"handleStopped",
		"requested",
		"moveBy",
		"moveIntoView",
		"swipeTo",
		"setRelative",
		"getRelative",
		"moved",
		"pos",
		"ex",
		"ey",
		"res",
		"ValidityTest",
		"REQURIED",
		"supported",
		"validate",
		"input",
		"checkValidity",
		"validityTests",
		"form",
		"elements",
		"some",
		"isNaN",
		"FormWidget",
		"highlight",
		"field",
		"validateChange",
		"highlightClass",
		"onSubmit",
		"tests",
		"validateForm",
		"errors",
		"valid",
		"validity",
		"originalEvent",
		"validateInput",
		"getElements",
		"element",
		"option",
		"selected",
		"ScalableWidget",
		"resize",
		"onResize",
		"setScale",
		"sizeToScale",
		"landscape",
		"offside",
		"getScale",
		"ScrollableWidget",
		"thumbH",
		"thumbV",
		"active",
		"disabled",
		"activeClass",
		"disabledClass",
		"dir",
		"pane",
		"class",
		"handleStart",
		"handleDrag",
		"handleEnd",
		"updateThumbs",
		"relative",
		"elasticity",
		"thumbSize",
		"thumbSpace",
		"thumbPos",
		"horizontal",
		"vertical",
		"toggleActive",
		"scrolling",
		"scrollIntoView",
		"scrollTo",
		"indicate",
		"sx",
		"scrollLeft",
		"sy",
		"scrollTop",
		"ThemeWidget",
		"theme",
		"TimerWidget",
		"indicator",
		"inverted",
		"autoplay",
		"bar",
		"inv",
		"_options",
		"_start",
		"starttime",
		"DAY_HOURS",
		"HOUR_MINUTES",
		"MINUTE_SECONDS",
		"HOUR_SECONDS",
		"DAY_SECONDS",
		"TimestampWidget",
		"seconds",
		"TransformableWidget",
		"translation",
		"scaling",
		"rotation",
		"deltaMove",
		"deltaAngle",
		"deltaScale",
		"begin",
		"getTranslation",
		"getRotation",
		"getScaling",
		"VisualWidget",
		"handleResize",
		"img",
		"margin",
		"imageRatio",
		"viewRatio",
		"marginTop",
		"marginLeft",
		"WidgetManager",
		"definitions",
		"instances",
		"register",
		"definition",
		"createInstances",
		"unregister",
		"disposeInstances",
		"onMutations",
		"mutations",
		"mutation",
		"onNodeRemoved",
		"getWidget"
	],
	"mappings": "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2CFuhC,cACC/qC,MAAO,qBACPzS,IAAK,6BACL3H,KAAM,OACN+iB,WACC,aAEDa,UACC,QACA,WACA,eAuDFwhC,mBACChrC,MAAO,0BACPzS,IAAK,kCACL3H,KAAM,OACN+iB,WACC,aAEDa,UACC,OACA,aACA,YACA,cACA,YACA,mBAsDFyhC,iBACCjrC,MAAO,wBACPzS,IAAK,gCACL3H,KAAM,OACN+iB,WACC,aAEDa,UACC,aACA,OACA,cACA,YACA,mBAUF2X,QACCnhB,MAAO,eACPzS,IAAK,+BACL3H,KAAM,SACN+iB,WACC,cAUFuiC,aACClrC,MAAO,oBACPzS,IAAK,sCACL3H,KAAM,MACN+iB,WACC,cAkDFwiC,iBACCnrC,MAAO,wBACPzS,IAAK,yBACL3H,KAAM,OACN+iB,WACC,aAEDa,UACC,mBAuDF4hC,iBACCprC,MAAO,wBACPzS,IAAK,yBACL3H,KAAM,OACN+iB,WACC,aAEDa,UACC,cACA,YACA,QACA,WACA,WACA,mBAUF6hC,kBACCrrC,MAAO,yBACPzS,IAAK,kCACL3H,KAAM,UAOP0lD,2BACCtrC,MAAO,kCACPzS,IAAK,+BACL3H,KAAM,UASP2lD,iBACCvrC,MAAO,wBACPzS,IAAK,WACL3H,KAAM,OACN+iB,WACC,cAUF6iC,oBACCxrC,MAAO,2BACPzS,IAAK,wBACL3H,KAAM,OASP6lD,uBACCzrC,MAAO,8BACPzS,IAAK,mDACL3H,KAAM,OAUP8lD,yBACC1rC,MAAO,gCACPzS,IAAK,oBACL3H,KAAM,OACN+iB,WACC,aAEDa,UACC,WAWFmiC,oBACC3rC,MAAO,2BACPzS,IAAK,yCACL3H,KAAM,MACN4jB,UACC,UAWFoiC,oBACC5rC,MAAO,2BACPzS,IAAK,iCACL3H,KAAM,MACN4jB,UACC,UAaFqiC,eACC7rC,MAAO,sBACPzS,IAAK,kBACL3H,KAAM,MACN4jB,UACC,cACA,YACA,aACA,sBAUFsiC,aACC9rC,MAAO,oBACPzS,IAAK,sBACL3H,KAAM,OACN4jB,UACC,uBAWFuiC,sBACC/rC,MAAO,6BACPzS,IAAK,mBACL3H,KAAM,MACN4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",
	"file": "playtotv-client-lib-2.0.0a.min.js",
	"sourcesContent": [
		"(function() {\n\n\t'use strict';\n\n\t// Reliably get a global reference on all platforms by looking at a non-strict function's \"this\"\n\tvar global = /*jshint evil:true*/ new Function('return this')(); /*jshint evil:false*/\n\tvar window = global.window || {};\n\tvar MutationObserver = window.MutationObserver || window.WebKitMutationObserver;\n\tvar tasks = [];\n\n\tfunction tick() {\n\t\t// Note current length, any tasks beyond should be processed in the next tick\n\t\tvar i = 0;\n\t\tvar len = tasks.length;\n\t\tvar task;\n\n\t\t// Catch exceptions without actually catching them to leave stack traces nice and pristine\n\t\ttry {\n\t\t\tfor (; i < len; i++) {\n\t\t\t\ttask = tasks[i];\n\t\t\t\ttask.cb.apply(task.on, task.args);\n\t\t\t}\n\t\t} finally {\n\t\t\t// If we did not cleanly finish the iteration then move past the task that threw the exception\n\t\t\t// and request another tick if necessary to finish processing the remaining tasks\n\t\t\tif (i < len && ++i < len) {\n\t\t\t\trequestTick();\n\t\t\t}\n\n\t\t\t// Remove tasks that were called in this tick\n\t\t\ttasks.splice(0, i);\n\t\t}\n\t}\n\n\tvar requestTick =\n\n\t\t// MutationObserver is crazy fast (micro task)\n\t\t// Supported by: Chrome, FF, Safari, IE11+\n\t\tMutationObserver ?\n\t\t(function() {\n\t\t\tvar el = document.createElement('div');\n\t\t\tnew MutationObserver(tick).observe(el, { attributes: true });\n\t\t\t// MutationObserver already takes care of batching observer callbacks itself so forget about pending\n\t\t\treturn function() {\n\t\t\t\tel.setAttribute('x', 'x');\n\t\t\t};\n\t\t}()) :\n\n\t\t// setImmediate is 3 times faster then message events in IE10 and very fast in Node\n\t\t// Supported by: IE10+, Node 0.10+\n\t\tglobal.setImmediate ?\n\t\t(function() {\n\t\t\tvar pending = false;\n\t\t\treturn function() {\n\t\t\t\tif (!pending) {\n\t\t\t\t\tpending = global.setImmediate(function() {\n\t\t\t\t\t\tpending = false;\n\t\t\t\t\t\ttick();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\t\t}()) :\n\n\t\t// Window message events are about 25 times slower then MutationObserver, but still fast\n\t\t// Supported by: IE9, IE10, Android\n\t\t// Note: IE8 does have message support using attachEvent instead of addEventListener, but is not asynchronous\n\t\twindow.addEventListener ?\n\t\t(function() {\n\t\t\tvar pending = false;\n\t\t\tvar msg = 'nextTick';\n\t\t\tfunction onMessage(e) {\n\t\t\t\tif (e.source === window && e.data === msg) {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tpending = false;\n\t\t\t\t\ttick();\n\t\t\t\t}\n\t\t\t}\n\t\t\twindow.addEventListener('message', onMessage, true);\n\t\t\treturn function() {\n\t\t\t\tif (!pending) {\n\t\t\t\t\twindow.postMessage(msg, '*');\n\t\t\t\t\tpending = true;\n\t\t\t\t}\n\t\t\t};\n\t\t}()) :\n\n\t\t// setTimeout is about 500 times slower then MutationObserver\n\t\t// Supported by: everything\n\t\t(function() {\n\t\t\tvar pending = false;\n\t\t\treturn function() {\n\t\t\t\tif (!pending) {\n\t\t\t\t\tpending = setTimeout(function() {\n\t\t\t\t\t\tpending = false;\n\t\t\t\t\t\ttick();\n\t\t\t\t\t}, 0);\n\t\t\t\t}\n\t\t\t};\n\t\t}());\n\n\t/**\n\t * Call the specified callback asynchronously, but as soon as possible.\n\t *\n\t * The name is inspired by Node.js' process.nextTick.\n\t *\n\t * The similar setImmediate function was drafted for W3C but remains impopular with FireFox and Chrome developers\n\t * (<a href=\"http://www.nczonline.net/blog/2013/07/09/the-case-for-setimmediate/\">more info</a>).\n\t *\n\t * This either uses MutationObserver, setImmediate, window message events or plain old setTimeout.\n\t *\n\t * Callbacks are batched to improve performance.\n\t * If an exception is thrown by a callback it is not caught to prevent losing valuable stack trace information.\n\t * In such a case the remainder of the batch of callbacks will still be executed, but not on the same tick to\n\t * prevent issues due to excessive recursion.\n\t *\n\t * Note: Do not immediately call nextTick again from each tick callback.\n\t *\n\t * TODO: Replace by setImmediate shim (is also in https://github.com/zloirock/core-js)\n\t *\n\t * @param {Function} callback\n\t * @param {Object} [thisArg=undefined]\n\t * @param {Array} [args=[]]\n\t */\n\tfunction nextTick(callback, thisArg, args) {\n\t\ttasks.push({ cb: callback, on: thisArg, args: args || [] });\n\t\trequestTick();\n\t}\n\n\t// Expose function\n\tglobal.nextTick = nextTick;\n\n}());\n",
		"/*\nFor lack of possibility of extending Promise (https://github.com/slightlyoff/Promises/issues/71) we will extend the\nglobal Promise instead. It's not ideal, but it's the best we can do for now.\n\nStill passes promises-aplus-tests (https://github.com/promises-aplus/promises-tests).\n*/\n(function() {\n\n\t'use strict';\n\n\tObject.assign(Promise.prototype, {\n\t\t/** @lends Promise.prototype */\n\n\t\t/**\n\t\t * Extended version of {@link Promise#catch} with predicate function argument to filter by.\n\t\t *\n\t\t * If predicate returns true for rejection reason then onReject will be called and returned\n\t\t * otherwise the original reason will be re-thrown.\n\t\t *\n\t\t * @param {Function} predicate\n\t\t * @param {Function} onReject\n\t\t * @returns {Promise}\n\t\t */\n\t\tcatchIf: function(predicate, onReject) {\n\t\t\treturn this.catch(function(reason) {\n\t\t\t\tif (predicate(reason)) {\n\t\t\t\t\treturn onReject(reason);\n\t\t\t\t} else {\n\t\t\t\t\tthrow(reason);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Extended version of {@link Promise#catch} with Class argument to filter by.\n\t\t *\n\t\t * If rejection reason is an instance of specified Class then onReject will be called and returned\n\t\t * otherwise the original reason will be re-thrown.\n\t\t *\n\t\t * @param {Function} Class\n\t\t * @param {Function} onReject\n\t\t * @returns {Promise}\n\t\t */\n\t\tcatchClass: function(Class, onReject) {\n\t\t\treturn this.catch(function(reason) {\n\t\t\t\tif (reason instanceof Class) {\n\t\t\t\t\treturn onReject(reason);\n\t\t\t\t} else {\n\t\t\t\t\tthrow(reason);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Call specified callback when this Promise either resolves or rejects.\n\t\t * Returns a Promise that resolves/rejects with the original value/reason when the callback result is resolved.\n\t\t * If the callback throws or the result is rejected the returned Promise will reject with that reason.\n\t\t *\n\t\t * @param {Function} callback\n\t\t * @returns {Promise}\n\t\t */\n\t\tfinally: function(callback) {\n\t\t\tvar Constructor = this.constructor;\n\t\t\treturn this.then(function(value) {\n\t\t\t\treturn Constructor.resolve(callback()).then(function() {\n\t\t\t\t\treturn value;\n\t\t\t\t});\n\t\t\t}, function(reason) {\n\t\t\t\treturn Constructor.resolve(callback()).then(function() {\n\t\t\t\t\tthrow reason;\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t});\n\n\tObject.assign(Promise, {\n\t\t/** @lends Promise */\n\n\t\t/**\n\t\t * Returns a deferred object with promise, resolve and reject properties.\n\t\t *\n\t\t * Use of this is generally discouraged, but can be practical in specific cases and eases porting of old code.\n\t\t *\n\t\t * @returns {Object}\n\t\t */\n\t\tdefer: function() {\n\t\t\tvar deferred = {};\n\t\t\tdeferred.promise = new this(function(resolve, reject) {\n\t\t\t\tdeferred.resolve = resolve;\n\t\t\t\tdeferred.reject = reject;\n\t\t\t});\n\t\t\treturn deferred;\n\t\t},\n\n\t\t/**\n\t\t * Returns a Promise that resolves after specified amount of milliseconds.\n\t\t *\n\t\t * @param {number} ms\n\t\t * @returns {Promise}\n\t\t */\n\t\tdelay: function(ms) {\n\t\t\treturn new this(function(resolve) {\n\t\t\t\tsetTimeout(resolve, ms);\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Returns a function that will unstack calls using {@link nextTick} and then call callback after any previous\n\t\t * callback has resolved/rejected and with at least the specified interval in ms between callbacks.\n\t\t * When callback is called it will use the arguments of the most recent call.\n\t\t * Any extra calls made in the meantime are ignored; they will not cause callback to be called and their\n\t\t * arguments will be discarded.\n\t\t *\n\t\t * TODO: Improve this JSDOC and also JSDOC limit() and debounce()\n\t\t * TODO: Add support for getShard argument like in limit()\n\t\t *\n\t\t * @param {Function} callback\n\t\t * @param {number} interval\n\t\t * @returns {Function}\n\t\t */\n\t\tthrottle: function(callback, interval) {\n\t\t\t// TODO: Ensure this and limit and debounce also work like they should in Cancellable\n\t\t\t// E.g: throttled.cancel() should cancel any Cancellable returned by callback\n\n\t\t\tvar Promise = this;\n\t\t\tvar thisArg, args, timeout, promise;\n\t\t\tvar deferred = Promise.defer();\n\n\t\t\tfunction call() {\n\t\t\t\tif (!args || promise || timeout) {\n\t\t\t\t\treturn; // wait for timeout/promise to call when it is finished\n\t\t\t\t}\n\n\t\t\t\tpromise = Promise.resolve(callback.apply(thisArg, args));\n\t\t\t\tthisArg = null;\n\t\t\t\targs = null;\n\n\t\t\t\tpromise.then(deferred.resolve, deferred.reject).finally(function() {\n\t\t\t\t\tpromise = null;\n\t\t\t\t\tcall();\n\t\t\t\t});\n\n\t\t\t\tdeferred = Promise.defer();\n\n\t\t\t\ttimeout = setTimeout(function() {\n\t\t\t\t\ttimeout = null;\n\t\t\t\t\tcall();\n\t\t\t\t}, interval);\n\t\t\t}\n\n\t\t\treturn function() {\n\t\t\t\tthisArg = this;\n\t\t\t\tif (args || promise || timeout) { // already waiting for tick, promise or timeout\n\t\t\t\t\targs = arguments;\n\t\t\t\t} else {\n\t\t\t\t\targs = arguments;\n\t\t\t\t\tnextTick(call);\n\t\t\t\t}\n\t\t\t\treturn deferred.promise;\n\t\t\t};\n\t\t},\n\n\t\t// Like throttle, but without the trailing call\n\t\t// Returns previous call's promise when called during wait\n\t\t// Otherwise calls and returns that promise\n\t\tlimit: function(callback, interval, getShard) {\n\t\t\tgetShard = getShard || callback.getShard || function() {\n\t\t\t\treturn JSON.stringify(Array.from(arguments));\n\t\t\t};\n\n\t\t\tvar Promise = this;\n\t\t\tvar shardMap = {};\n\n\t\t\tfunction limited() {\n\t\t\t\t/*jshint validthis: true */\n\t\t\t\tvar key = getShard.apply(this, arguments);\n\t\t\t\tvar shard = shardMap[key] || (shardMap[key] = { last: 0 });\n\t\t\t\tvar now = Date.now();\n\n\t\t\t\tif (!shard.busy && now > shard.last + interval) {\n\t\t\t\t\tshard.busy = true;\n\t\t\t\t\tshard.last = now;\n\n\t\t\t\t\tshard.promise = Promise.resolve(callback.apply(this, arguments)).finally(function() {\n\t\t\t\t\t\tshard.busy = false;\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn shard.promise;\n\t\t\t}\n\n\t\t\tlimited.getShard = getShard;\n\n\t\t\treturn limited;\n\t\t},\n\n\t\t// Waits for an interval to pass without being called again before calling callback\n\t\t// Returns promise of that call's return value\n\t\tdebounce: function(callback, interval, getShard) {\n\t\t\tgetShard = getShard || callback.getShard || function() {\n\t\t\t\treturn JSON.stringify(Array.from(arguments));\n\t\t\t};\n\n\t\t\tvar Promise = this;\n\t\t\tvar shardMap = {};\n\n\t\t\tfunction debounced() {\n\t\t\t\t/*jshint validthis: true */\n\t\t\t\tvar thisArg = this;\n\t\t\t\tvar args = arguments;\n\t\t\t\tvar key = getShard.apply(thisArg, args);\n\t\t\t\tvar shard = shardMap[key] || (shardMap[key] = {});\n\n\t\t\t\tif (!shard.deferred) {\n\t\t\t\t\tshard.deferred = Promise.defer();\n\t\t\t\t}\n\t\t\t\tif (shard.timeout) {\n\t\t\t\t\tclearTimeout(shard.timeout);\n\t\t\t\t}\n\t\t\t\t// TODO: Double check that this acts reasonably when callback takes longer to resolve then interval\n\t\t\t\tshard.timeout = setTimeout(function() {\n\t\t\t\t\tshard.timeout = 0;\n\t\t\t\t\tPromise.resolve(callback.apply(thisArg, args)).\n\t\t\t\t\t\tthen(shard.deferred.resolve, shard.deferred.reject).\n\t\t\t\t\t\tfinally(function() {\n\t\t\t\t\t\t\tshard.deferred = 0;\n\t\t\t\t\t\t});\n\t\t\t\t}, interval);\n\n\t\t\t\treturn shard.deferred.promise;\n\t\t\t}\n\n\t\t\tdebounced.getShard = getShard;\n\n\t\t\treturn debounced;\n\t\t}\n\t});\n}());\n",
		"/*\nDefines Promise.Cancellable, CancellationError and TimeoutError to facilitate cancelling functions returning Promises.\n\nPasses promises-aplus-tests (https://github.com/promises-aplus/promises-tests).\n */\n(function() {\n\n\t'use strict';\n\n\tfunction extend(dst, src) {\n\t\tfor (var key in src) {\n\t\t\tif (src.hasOwnProperty(key)) {\n\t\t\t\tdst[key] = src[key];\n\t\t\t}\n\t\t}\n\t\treturn dst;\n\t}\n\n\t// Minimal Object.create shim for IE8\n\tvar objectCreate = Object.create || function(proto) {\n\t\tfunction F() {}\n\t\tF.prototype = proto;\n\t\treturn new F();\n\t};\n\n\tfunction createClass(Extend, Constructor, stat, proto) {\n\t\textend(Constructor, Extend);\n\t\textend(Constructor, stat);\n\t\tproto = extend(objectCreate(Extend.prototype), proto);\n\t\tConstructor.prototype = proto;\n\t\tproto.constructor = Constructor;\n\t\treturn Constructor;\n\t}\n\n\t/**\n\t * Error class that can be used to recognize rejection due to cancellation.\n\t *\n\t * @name CancellationError\n\t * @memberOf Promise\n\t * @class\n\t * @extends Error\n\t * @param {string} [message='Cancelled']\n\t */\n\tvar CancellationError = createClass(Error, function(message) {\n\t\tthis.message = message || 'Cancelled';\n\t\t// Workarounds for not being able to properly extend Error\n\t\tif (Error.captureStackTrace) {\n\t\t\tError.captureStackTrace(this, this.constructor);\n\t\t} else {\n\t\t\tthis.stack = new Error().stack;\n\t\t}\n\t}, null, { name: 'CancellationError' });\n\n\t/**\n\t * Error class that can be used to recognize cancellation due to timeout.\n\t *\n\t * @name TimeoutError\n\t * @memberOf Promise\n\t * @class\n\t * @extends Promise.CancellationError\n\t * @param {string} [message='Timed out']\n\t */\n\tvar TimeoutError = createClass(CancellationError, function(message) {\n\t\tCancellationError.call(this, message || 'Timed out');\n\t}, null, { name: 'TimeoutError' });\n\n\t/**\n\t * A special kind of Promise that can be cancelled.\n\t *\n\t * The fn callback will be called with the Cancellable instance as 'this' argument.\n\t * This facilitates immediately registering a cancellation callback with access to your function scope.\n\t *\n\t * @example\n\t * function request(method, url) {\n\t *   return new Cancellable(function(resolve, reject) {\n\t *     var xhr = new XMLHttpRequest();\n\t *     xhr.addEventListener('load', function() {\n\t *       resolve(xhr.responseText);\n\t *     });\n\t *     xhr.addEventListener('error', function() {\n\t *       reject(xhr.status);\n\t *     });\n\t *     xhr.open(method, url, true);\n\t *     xhr.send();\n\t *     this.catchClass(Promise.CancellationError, function() {\n\t *       xhr.abort();\n\t *     });\n\t *   });\n\t * }\n\t *\n\t * @name Cancellable\n\t * @memberOf Promise\n\t * @class\n\t * @extends Promise\n\t * @param {Function} fn\n\t */\n\tvar Cancellable = createClass(Promise, function(fn) {\n\n\t\tif (!(this instanceof Cancellable)) {\n\t\t\tthrow new TypeError('Failed to construct \"Cancellable\": Please use the \"new\" operator.');\n\t\t}\n\t\tif (typeof fn !== 'function') {\n\t\t\tthrow new TypeError('Cancellable constructor takes a function argument');\n\t\t}\n\n\t\tvar resolve, reject;\n\t\tthis._promise = new Promise(function(_resolve, _reject) {\n\t\t\tresolve = _resolve;\n\t\t\treject = _reject;\n\t\t});\n\t\tthis._parentPromises = [];\n\t\tthis._reject = reject;\n\n\t\ttry {\n\t\t\tfn.call(this, resolve, reject);\n\t\t} catch (e) {\n\t\t\treject(e);\n\t\t}\n\n\t}, {\n\t\t/** @lends Promise.Cancellable */\n\n\t\t// Note: Need to manually link these static methods since they do not show up in extend: for (i in Promise)\n\t\tresolve: Promise.resolve,\n\t\treject: Promise.reject,\n\t\tdefer: Promise.defer,\n\n\t\t/**\n\t\t * Extended version of {@link Promise.all} that adds all Cancellable values as parents to the returned\n\t\t * Cancellable.\n\t\t *\n\t\t * @param {Array} values\n\t\t * @returns {Cancellable}\n\t\t */\n\t\tall: function(values) {\n\t\t\tvar cancellable = Promise.all.call(this, values);\n\n\t\t\tvar parents = cancellable._parentPromises;\n\t\t\tvar i, value, length = values.length;\n\t\t\tfor (i = 0; i < length; i++) {\n\t\t\t\tvalue = values[i];\n\t\t\t\tif (value instanceof Cancellable) {\n\t\t\t\t\tparents.push(value);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn cancellable;\n\t\t},\n\n\t\t/**\n\t\t * Extended version of {@link Promise.race} that adds all Cancellable values as parents to the returned\n\t\t * Cancellable.\n\t\t *\n\t\t * @param {Array} values\n\t\t * @returns {Cancellable}\n\t\t */\n\t\trace: function(values) {\n\t\t\tvar cancellable = Promise.race.call(this, values);\n\n\t\t\tvar parents = cancellable._parentPromises;\n\t\t\tvar i, value, length = values.length;\n\t\t\tfor (i = 0; i < length; i++) {\n\t\t\t\tvalue = values[i];\n\t\t\t\tif (value instanceof Cancellable) {\n\t\t\t\t\tparents.push(value);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn cancellable;\n\t\t}\n\n\t}, {\n\t\t/** @lends Promise.Cancellable.prototype */\n\n\t\t/**\n\t\t * Extended version of {@link Promise#then} that adds this Cancellable and any Cancellable returned by\n\t\t * onResolve or onReject to the returned Cancellable's parents.\n\t\t *\n\t\t * @param {Function} [onResolve]\n\t\t * @param {Function} [onReject]\n\t\t * @returns {Cancellable}\n\t\t */\n\t\tthen: function(onResolve, onReject) {\n\t\t\tvar onThenResolve = typeof onResolve !== 'function' ? onResolve : function(value) {\n\t\t\t\tvar result = onResolve(value);\n\t\t\t\tif (result === thenCancellable) {\n\t\t\t\t\tthrow new TypeError('You can not resolve a promise with itself');\n\t\t\t\t}\n\t\t\t\tif (result instanceof Cancellable) {\n\t\t\t\t\tparents.push(result);\n\t\t\t\t}\n\t\t\t\treturn result;\n\t\t\t};\n\t\t\tvar onThenReject = typeof onReject !== 'function' ? onReject : function(value) {\n\t\t\t\tvar result = onReject(value);\n\t\t\t\tif (result === thenCancellable) {\n\t\t\t\t\tthrow new TypeError('You can not reject a promise with itself');\n\t\t\t\t}\n\t\t\t\tif (result instanceof Cancellable) {\n\t\t\t\t\tparents.push(result);\n\t\t\t\t}\n\t\t\t\treturn result;\n\t\t\t};\n\n\t\t\tvar promise = this._promise;\n\t\t\tvar thenCancellable = new Cancellable(function(resolve) {\n\t\t\t\tresolve(promise.then(onThenResolve, onThenReject));\n\t\t\t});\n\n\t\t\tvar parents = thenCancellable._parentPromises;\n\t\t\tparents.push(this);\n\n\t\t\treturn thenCancellable;\n\t\t},\n\n\t\t/**\n\t\t * If this Cancellable has parents then cancel those, otherwise reject this promise, with specified reason.\n\t\t *\n\t\t * @param {Object} [reason=new Promise.CancellationError()]\n\t\t */\n\t\tcancel: function(reason) {\n\t\t\treason = reason || new CancellationError();\n\t\t\tvar parents = this._parentPromises;\n\t\t\tvar parentsLen = parents.length;\n\t\t\tif (parentsLen === 0) {\n\t\t\t\tthis._reject(reason);\n\t\t\t} else {\n\t\t\t\tfor (var i = 0; i < parentsLen; i++) {\n\t\t\t\t\tparents[i].cancel(reason);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Cancel with specified reason after specified time.\n\t\t *\n\t\t * @param {number} ms Time in milliseconds after which to time out\n\t\t * @param {Object} [reason=new Promise.TimeoutError('Timed out after ' + ms + 'ms')]\n\t\t * @returns {number} setTimeout() id, can be cleared with clearTimeout()\n\t\t */\n\t\tsetTimeout: function(ms, reason) {\n\t\t\treason = reason || new TimeoutError('Timed out after ' + ms + 'ms');\n\n\t\t\treturn setTimeout(function() {\n\t\t\t\tthis.cancel(reason);\n\t\t\t}.bind(this), ms);\n\t\t},\n\n\t\t/**\n\t\t * Returns a plain Promise version of this Cancellable.\n\t\t *\n\t\t * This can be useful if you want to prevent another scope from cancelling this Cancellable.\n\t\t *\n\t\t * @returns {Promise}\n\t\t */\n\t\ttoPromise: function() {\n\t\t\treturn this._promise;\n\t\t}\n\t});\n\n\t// Expose Cancellable etc. as static properties on Promise\n\textend(Promise, {\n\t\tCancellable: Cancellable,\n\t\tCancellationError: CancellationError,\n\t\tTimeoutError: TimeoutError\n\t});\n}());\n",
		"/**\n * Dollar shortcuts to querySelector() and querySelectorAll() like commonly provided by browser console API's.\n */\n(function() {\n\n\t'use strict';\n\n\t// Hmm.. If we depend on this, our code might break when mixed with jQuery or something else :(\n\n\twindow.$ = window.$ || function(selector, context = document) {\n\t\treturn context.querySelector(selector);\n\t};\n\n\twindow.$$ = window.$$ || function(selector, context = document) {\n\t\treturn Array.from(context.querySelectorAll(selector));\n\t};\n}());\n",
		"(function() {\n\n\t'use strict';\n\n\t// Reliably get a global reference on all platforms by looking at a non-strict function's \"this\"\n\tvar global = /*jshint evil:true*/ new Function('return this')(); /*jshint evil:false*/\n\n\t/**\n\t * Global playtotv namespace, contains everything.\n\t *\n\t * @name playtotv\n\t * @namespace\n\t */\n\tvar ptv = global.playtotv = {};\n\n\tvar nativeEach = [].forEach;\n\tvar uid = 1;\n\n\t/**\n\t * Core playtotv features\n\t *\n\t */\n\tObject.assign(ptv, {\n\n\t\t/** @lends playtotv */\n\n\t\t/**\n\t\t * Gets a unique ID.\n\t\t *\n\t\t * @param {string} [prefix]\n\t\t * @returns {number} uid\n\t\t */\n\t\tgetUID: function(prefix) {\n\t\t\tuid += 1;\n\t\t\treturn prefix ? (prefix + uid) : uid;\n\t\t},\n\n\t\t/**\n\t\t * Slightly smarter each, does nodelists and object literals too.\n\t\t *\n\t\t * @param {Object} list\n\t\t * @param {Function} callback\n\t\t * @param {Object} [thisArg]\n\t\t */\n\t\teach: function(list, callback, thisArg) {\n\t\t\tif (!list) {\n\t\t\t\treturn;\n\t\t\t} else if (list.forEach) {\n\t\t\t\tlist.forEach(callback, thisArg);\n\t\t\t} else if (list.length === +list.length) {\n\t\t\t\tnativeEach.call(list, callback, thisArg);\n\t\t\t} else {\n\t\t\t\tvar key;\n\t\t\t\tfor (key in list) {\n\t\t\t\t\tif (list.hasOwnProperty(key)) {\n\t\t\t\t\t\tcallback.call(thisArg, list[key], key, list);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Returns an array of property values from an array of objects.\n\t\t *\n\t\t * @param {Array} list\n\t\t * @param {string} key\n\t\t * @returns {Array}\n\t\t */\n\t\tpluck: function(list, key) {\n\t\t\treturn list.map((item) => item[key]);\n\t\t},\n\n\t\t/**\n\t\t * Creates an array of unique values, in order, from all of the provided arrays.\n\t\t *\n\t\t * @returns {Array} The new array of combined values\n\t\t */\n\t\tunion: function() {\n\t\t\tvar union = [];\n\t\t\tArray.from(arguments).forEach(function(array) {\n\t\t\t\tarray.forEach(function(item) {\n\t\t\t\t\tif (union.indexOf(item) < 0) {\n\t\t\t\t\t\tunion.push(item);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t\treturn union;\n\t\t},\n\n\t\t/**\n\t\t * Returns a copy of the object only containing the whitelisted properties.\n\t\t *\n\t\t * @param {Object} obj\n\t\t * @param {[string]} keys\n\t\t * @returns {Object}\n\t\t */\n\t\tpick: function(obj, keys) {\n\t\t\tvar copy = {};\n\t\t\tkeys.forEach(function(key) {\n\t\t\t\tif (key in obj) {\n\t\t\t\t\tcopy[key] = obj[key];\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn copy;\n\t\t},\n\n\t\t/**\n\t\t * Returns a copy of the object without the blacklisted properties.\n\t\t *\n\t\t * @param {Object} obj\n\t\t * @param {[string]} keys\n\t\t * @returns {Object}\n\t\t */\n\t\tomit: function(obj, keys) {\n\t\t\tvar copy = {};\n\t\t\tfor (var key in obj) {\n\t\t\t\tif (keys.indexOf(key) === -1) {\n\t\t\t\t\tcopy[key] = obj[key];\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn copy;\n\t\t},\n\n\t\t// TODO: Move these (also shuffle?) into util?\n\t\trandomNr: function(max, min = 0) {\n\t\t\tvar delta = max - min;\n\t\t\treturn min + Math.floor(Math.random() * delta);\n\t\t},\n\n\t\trandomItem: function(array) {\n\t\t\treturn array[this.randomNr(array.length)];\n\t\t},\n\n\t\t/**\n\t\t * Returns a copy of specified array with it's items shuffled randomly.\n\t\t *\n\t\t * @param {Array} array Array of items to shuffle\n\t\t * @returns {Array} Shuffled array\n\t\t */\n\t\tshuffle: function(array) {\n\t\t\tvar cursor = array.length;\n\t\t\tvar shuffled = array.slice(0); // start with a copy\n\t\t\tvar temp, rand;\n\t\t\twhile (cursor > 0) { // go from tail to head\n\t\t\t\trand = Math.floor(Math.random() * cursor--); // pick a random preceding index\n\t\t\t\ttemp = shuffled[cursor]; // remember value at cursor\n\t\t\t\tshuffled[cursor] = shuffled[rand]; // swap cursor value with random index value\n\t\t\t\tshuffled[rand] = temp; // swap random index value with cursor value\n\t\t\t}\n\t\t\treturn shuffled;\n\t\t},\n\n\t\t/**\n\t\t * Returns a function that will unstack calls using {@link nextTick} and then call callback with at least the\n\t\t * specified time in ms between callbacks.\n\t\t * When callback is called it will use the arguments of the most recent call.\n\t\t * Any extra calls made in the meantime are ignored; they will not cause callback to be called and their\n\t\t * arguments will be discarded.\n\t\t *\n\t\t * @param {Function} callback\n\t\t * @param {number} ms\n\t\t * @returns {Function}\n\t\t */\n\t\tthrottle: function(callback, ms) {\n\t\t\tvar thisArg, args, timeout;\n\n\t\t\tfunction call() {\n\t\t\t\tif (args && !timeout) {\n\t\t\t\t\tcallback.apply(thisArg, args);\n\t\t\t\t\tthisArg = null;\n\t\t\t\t\targs = null;\n\n\t\t\t\t\ttimeout = setTimeout(function() {\n\t\t\t\t\t\ttimeout = null;\n\t\t\t\t\t\tcall();\n\t\t\t\t\t}, ms);\n\t\t\t\t} // else wait for timeout to call when it is finished\n\t\t\t}\n\n\t\t\treturn function() {\n\t\t\t\tthisArg = this;\n\t\t\t\tif (args || timeout) { // already waiting for tick or timeout\n\t\t\t\t\targs = arguments;\n\t\t\t\t} else {\n\t\t\t\t\targs = arguments;\n\t\t\t\t\tnextTick(call);\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t/**\n\t\t * Returns a function that will call the callback function after it has not been called for ms. If it is called\n\t\t * again within that time the previously scheduled callback will be cancelled and another period of waiting\n\t\t * will be started. This will effectively result in the callback only being called after a period of quiet.\n\t\t *\n\t\t * @param {Function} callback\n\t\t * @param {number} ms\n\t\t * @returns {Function}\n\t\t */\n\t\tdebounce: function(callback, ms) {\n\t\t\tvar timeout;\n\n\t\t\treturn function() {\n\t\t\t\tvar thisArg = this;\n\t\t\t\tvar args = arguments;\n\n\t\t\t\tclearTimeout(timeout);\n\n\t\t\t\ttimeout = setTimeout(function() {\n\t\t\t\t\ttimeout = null;\n\t\t\t\t\tcallback.apply(thisArg, args);\n\t\t\t\t\tthisArg = null;\n\t\t\t\t\targs = null;\n\t\t\t\t}, ms);\n\t\t\t};\n\t\t},\n\n\t\t/**\n\t\t * Returns a function that will call the callback function once after the stack has cleared (using\n\t\t * {@link nextTick}).\n\t\t * This effectively consolidates multiple calls from a single stack into one.\n\t\t *\n\t\t * @param {Function} callback\n\t\t * @return {Function}\n\t\t */\n\t\tunstack: function(callback) {\n\t\t\tvar thisArg, args;\n\n\t\t\tfunction call() {\n\t\t\t\tcallback.apply(thisArg, args);\n\t\t\t\tthisArg = null;\n\t\t\t\targs = null;\n\t\t\t}\n\n\t\t\treturn function() {\n\t\t\t\tthisArg = this;\n\t\t\t\tif (args) { // already waiting for tick\n\t\t\t\t\targs = arguments;\n\t\t\t\t} else {\n\t\t\t\t\targs = arguments;\n\t\t\t\t\tnextTick(call);\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t/**\n\t\t * Returns a function that will only call the callback function if it has not been called already.\n\t\t *\n\t\t * @param {Function} callback\n\t\t * @returns {Function}\n\t\t */\n\t\tonce: function(callback) {\n\t\t\tvar ran = false, memo;\n\t\t\treturn function() {\n\t\t\t\tif (ran) {\n\t\t\t\t\treturn memo;\n\t\t\t\t}\n\t\t\t\tran = true;\n\t\t\t\tmemo = callback.apply(this, arguments);\n\t\t\t\treturn memo;\n\t\t\t};\n\t\t},\n\n\t\t/**\n\t\t * Returns a function that will defer calling the callback function untill the current call stack is empty\n\t\t * (using {@link nextTick}).\n\t\t *\n\t\t * @param {Function} callback\n\t\t * @param {Object} [thisArg]\n\t\t * @returns {Function}\n\t\t */\n\t\tdefer: function(callback, thisArg) {\n\t\t\treturn function() {\n\t\t\t\tnextTick(callback, thisArg || this, arguments);\n\t\t\t};\n\t\t},\n\n\t\t/**\n\t\t * May be used to make a param required for playtotv.params and the playtotv.Options mixin.\n\t\t * @property REQUIRED\n\t\t * @type String\n\t\t * @default \"__required__\"\n\t\t */\n\t\tREQUIRED: '__required__',\n\n\t\tbindMethods: function(instance, methodNames) {\n\t\t\tmethodNames.forEach(name => {\n\t\t\t\tinstance[name] = instance[name].bind(instance);\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Augments an options object with properties from a defaults object if undefined. If a default\n\t\t * property is required to have a value, and is not stated in the options, an error is thrown.\n\t\t * Likewise, options that are not present on the defaults throw an error. Note that the original\n\t\t * options parameter is modified, not cloned or used as a reference.\n\t\t *\n\t\t * @param {Object} options\n\t\t * @param {Object} defaults\n\t\t * @returns {Object}\n\t\t */\n\t\tparams: function(options, defaults) {\n\t\t\toptions = options || {};\n\n\t\t\t// assign options only via keys from defaults, and error on missing required params\n\t\t\tptv.each(defaults, function(value, key) {\n\t\t\t\tvar hasKey = options.hasOwnProperty(key);\n\t\t\t\tif (!hasKey) {\n\t\t\t\t\tif (value === ptv.REQUIRED) {\n\t\t\t\t\t\tthrow new Error('Missing required parameter: ' + key);\n\t\t\t\t\t}\n\n\t\t\t\t\toptions[key] = value;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// check options for any unrecognized params\n\t\t\tptv.each(options, function(value, key) {\n\t\t\t\tif (!defaults.hasOwnProperty(key)) {\n\t\t\t\t\tthrow new Error('Invalid parameter: ' + key + ' = ' + value); // error or warn?\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn options;\n\t\t},\n\n\t\t/**\n\t\t * Removes a selection of options derived from defaults from specified options (by reference!)\n\t\t * and returns the selection augmented and validated by the playtotv.params function.\n\t\t *\n\t\t * @param {Object} options\n\t\t * @param {Object} defaults\n\t\t * @returns {Object}\n\t\t */\n\t\tspliceParams: function(options, defaults) {\n\t\t\toptions = options || {};\n\n\t\t\tvar keys = Object.keys(defaults);\n\t\t\tvar spliced = ptv.pick(options, keys);\n\n\t\t\tkeys.forEach(function(key) {\n\t\t\t\tdelete options[key];\n\t\t\t});\n\n\t\t\treturn ptv.params(spliced, defaults);\n\t\t},\n\n\t\t/**\n\t\t * Creates a script node and adds it to the head of the DOM.\n\t\t *\n\t\t * @param {string} src URL of script to load\n\t\t * @param {boolean} [async=true] Whether to load asynchronously\n\t\t * @return {Promise} Script node promise which will be resolved when script has finished loading\n\t\t */\n\t\tloadScript: function(src, async) {\n\t\t\t// TODO: Rewrite without use of Promise.defer()\n\t\t\tvar deferred = Promise.defer();\n\t\t\tvar script = document.createElement('script');\n\t\t\tscript.type = 'text/javascript';\n\t\t\tscript.async = async === false ? false : true;\n\t\t\tscript.src = src;\n\n\t\t\tvar loaded = false;\n\t\t\tscript.onload = script.onreadystatechange = function() {\n\t\t\t\tvar rs = this.readyState;\n\t\t\t\tif (!loaded && (rs === undefined || rs === 'complete' || rs === 'loaded')) {\n\t\t\t\t\tloaded = true;\n\t\t\t\t\tdeferred.resolve(script);\n\t\t\t\t}\n\t\t\t};\n\t\t\tscript.onerror = function() {\n\t\t\t\tdeferred.reject(new Error('Error loading script: ' + src));\n\t\t\t};\n\n\t\t\tdocument.head.appendChild(script);\n\t\t\treturn deferred.promise;\n\t\t},\n\n\t\t/**\n\t\t * Class instance dispose helper.\n\t\t *\n\t\t * Deletes all instance properties, overrides dispose method with a noop function and adds a disposed property.\n\t\t *\n\t\t * @param {Object} instance\n\t\t */\n\t\tdispose: function(instance) {\n\t\t\tObject.keys(instance).forEach(function(key) { delete instance[key]; });\n\t\t\tinstance.dispose = function() {};\n\t\t\tinstance.disposed = true;\n\t\t}\n\t});\n\n}());\n",
		"(function() {\n\t/*jshint maxcomplexity:100, maxstatements:100*/\n\n\t'use strict';\n\n\t// Abort if we are not running in a browser (e.g: in Node)\n\tif (typeof window === 'undefined') {\n\t\treturn;\n\t}\n\n\tvar ptv = playtotv;\n\tvar document = window.document;\n\tvar documentElement = document.documentElement;\n\tvar dataAttr = 'data-em-uid';\n\tvar dataMap = {};\n\n\t//\n\t// polyfills\n\t//\n\n\t// matches implementation for dom.matches\n\tvar matchesImplementation =\n\t\tdocumentElement.matches ||\n\t\tdocumentElement.webkitMatchesSelector ||\n\t\tdocumentElement.mozMatchesSelector ||\n\t\tdocumentElement.msMatchesSelector ||\n\t\tdocumentElement.oMatchesSelector;\n\n\t// node.contains polyfill for firefox < 9\n\tvar Node = window.Node;\n\tif (Node && Node.prototype && !Node.prototype.contains) {\n\t\tNode.prototype.contains = function(arg) {\n\t\t\t/*jshint bitwise:false*/\n\t\t\treturn !!(this.compareDocumentPosition(arg) & 16);\n\t\t};\n\t}\n\n\t// classList.toggle polyfill for IE10, ff < 24 and Android < 4.4, that don't support the force argument\n\t(function(DOMTokenList, node) {\n\t\tnode.classList.toggle('test', false);\n\t\tif (node.classList.contains('test')) {\n\t\t\tvar _toggle = DOMTokenList.prototype.toggle;\n\t\t\tDOMTokenList.prototype.toggle = function(token, force) {\n\t\t\t\treturn (1 in arguments && this.contains(token) === force) ?\n\t\t\t\t\tforce : _toggle.call(this, token);\n\t\t\t};\n\t\t}\n\t})(window.DOMTokenList, document.createElement('_'));\n\n\t/**\n\t * playtotv.dom\n\t */\n\tptv.dom = {\n\t\t/** @lends playtotv.dom */\n\n\t\t/**\n\t\t * Returns a boolean whether the given Node matches the selector string.\n\t\t *\n\t\t * @function\n\t\t * @param {string} selector\n\t\t * @param {Node} node\n\t\t * @returns {boolean} matches\n\t\t */\n\t\tmatches: function(selector, context) {\n\t\t\treturn (context && context !== document) ?\n\t\t\t\tmatchesImplementation.call(context, selector) : false;\n\t\t},\n\n\t\t/**\n\t\t * Returns the last Node matching the given selector.\n\t\t *\n\t\t * @param {string} selector\n\t\t * @param {Node} context\n\t\t * @returns {Node} node\n\t\t */\n\t\tlast: function(selector, context) {\n\t\t\tvar result = $$(selector, context);\n\t\t\tvar index = Math.max(0, result.length - 1);\n\t\t\treturn result[index];\n\t\t},\n\n\t\t/**\n\t\t * Traverses the dom from a given context until the selector is matched or no sibling is found,\n\t\t * and returns the result.\n\t\t *\n\t\t * @param {string} selector\n\t\t * @param {Node} context\n\t\t * @param {string} sibling\n\t\t * @returns {Node} node\n\t\t */\n\t\ttraverse: function(selector, context, sibling) {\n\t\t\twhile (context) {\n\t\t\t\tif (this.matches(selector, context)) {\n\t\t\t\t\treturn context;\n\t\t\t\t}\n\t\t\t\tcontext = context[sibling];\n\t\t\t}\n\t\t\treturn null;\n\t\t},\n\n\t\t/**\n\t\t * Returns the first matching sibling traversing forward from the given context.\n\t\t *\n\t\t * @param {string} selector\n\t\t * @param {Node} context\n\t\t * @returns {Node} node\n\t\t */\n\t\tnext: function(selector, context) {\n\t\t\treturn this.traverse(selector, context.nextSibling, 'nextSibling');\n\t\t},\n\n\t\t/**\n\t\t * Returns the first matching sibling traversing backward from the given context.\n\t\t *\n\t\t * @param {string} selector\n\t\t * @param {Node} context\n\t\t * @returns {Node} node\n\t\t */\n\t\tprevious: function(selector, context) {\n\t\t\treturn this.traverse(selector, context.previousSibling, 'previousSibling');\n\t\t},\n\n\t\t/**\n\t\t * Traverses upward in the DOM from the given context Node, and returns the first Node matching the given\n\t\t * selector (including the given node).\n\t\t *\n\t\t * @param {string} selector\n\t\t * @param {Node} context\n\t\t * @returns {Node} node\n\t\t */\n\t\tclosest: documentElement.closest ?\n\t\t\tfunction(selector, context) {\n\t\t\t\treturn context.closest(selector);\n\t\t\t} :\n\n\t\t\tfunction(selector, context) {\n\t\t\t\treturn this.traverse(selector, context, 'parentNode');\n\t\t\t},\n\n\t\t/**\n\t\t * Like find, but includes the context itself (as first result) if it matches the given selector\n\t\t *\n\t\t * @param {string} selector\n\t\t * @param {Node} context\n\t\t * @returns {Array} result\n\t\t */\n\t\tany: function(selector, context) {\n\t\t\tvar nodes = $$(selector, context);\n\t\t\tif (context && this.matches(selector, context)) {\n\t\t\t\tnodes.splice(0, 0, context);\n\t\t\t}\n\n\t\t\treturn nodes;\n\t\t},\n\n\t\t/**\n\t\t * Filters an Array or NodeList, and returns an array that contains only those nodes that match the selector.\n\t\t *\n\t\t * @param {string} selector\n\t\t * @param {Array|NodeList} nodes\n\t\t * @returns {Array} result\n\t\t */\n\t\tfilter: function(selector, nodes) {\n\t\t\tvar result = [];\n\t\t\tvar i, item, l = nodes.length;\n\t\t\tfor (i = 0; i < l; i++) {\n\t\t\t\titem = nodes[i];\n\t\t\t\tif (this.matches(selector, item)) {\n\t\t\t\t\tresult.push(item);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn result;\n\t\t},\n\n\t\t/**\n\t\t * Returns a boolean whether the given object is a Node\n\t\t *\n\t\t * @param {Object} object\n\t\t * @returns {boolean} isNode\n\t\t */\n\t\tisNode: function(node) {\n\t\t\treturn node && node.nodeType && (node.nodeType === 1);\n\t\t},\n\n\t\t/**\n\t\t * Returns a boolean whether the given Node is a child of the given context Node\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {Node} context\n\t\t * @returns {boolean} isChild\n\t\t */\n\t\tisChild: function(node, context) {\n\t\t\treturn this.isNode(context) ? context.contains(node) : false;\n\t\t},\n\n\t\t/**\n\t\t * Creates a Node with optional attributes and options for inserting and/or writing content.\n\t\t *\n\t\t * @param {string} name\n\t\t * @param {Object} attributes\n\t\t * @param {Object} options\n\t\t * @returns {Node} node\n\t\t */\n\t\tcreate: function(name, attributes, options) {\n\n\t\t\tvar node = document.createElement(name);\n\n\t\t\tif (attributes) {\n\t\t\t\tptv.each(attributes, function(value, attr) {\n\t\t\t\t\tnode.setAttribute(attr, value);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (options) {\n\n\t\t\t\tif (options.html !== undefined) {\n\t\t\t\t\tthis.innerHTML = options.html;\n\t\t\t\t}\n\n\t\t\t\t[ 'appendTo', 'insertBefore', 'insertAfter', 'prependTo', 'replace' ].forEach(function(type) {\n\t\t\t\t\tvar target = options[type];\n\t\t\t\t\tif (target !== undefined) {\n\t\t\t\t\t\tptv.dom[type](node, target);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (options.text !== undefined) {\n\t\t\t\t\tnode.appendChild(document.createTextNode(options.text));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn node;\n\t\t},\n\n\t\t/**\n\t\t * Removes the a Node from the DOM, and returns it.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @returns {Node} node\n\t\t */\n\t\tremove: function(node) {\n\t\t\treturn node.parentNode.removeChild(node);\n\t\t},\n\n\t\t/**\n\t\t * Appends the Node to the given reference Node, and returns it.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {Node} refnode\n\t\t * @returns {Node} node\n\t\t */\n\t\tappendTo: function(node, refnode) {\n\t\t\treturn refnode.appendChild(node);\n\t\t},\n\n\t\t/**\n\t\t * Inserts the Node before the given reference Node, and returns it.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {Node} refnode\n\t\t * @returns {Node} node\n\t\t */\n\t\tinsertBefore: function(node, refnode) {\n\t\t\treturn refnode.parentNode.insertBefore(node, refnode);\n\t\t},\n\n\t\t/**\n\t\t * Inserts the Node after the given reference Node, and returns it.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {Node} refnode\n\t\t * @returns {Node} node\n\t\t */\n\t\tinsertAfter: function(node, refnode) {\n\t\t\tif (refnode.nextSibling) {\n\t\t\t\treturn this.insertBefore(node, refnode.nextSibling);\n\t\t\t} else {\n\t\t\t\treturn this.appendTo(node, refnode);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Inserts the Node as first child of the given reference Node, and returns it.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {Node} refnode\n\t\t * @returns {Node} node\n\t\t */\n\t\tprependTo: function(node, refnode) {\n\t\t\tif (refnode.firstChild) {\n\t\t\t\treturn this.insertBefore(node, refnode.firstChild);\n\t\t\t} else {\n\t\t\t\treturn this.appendTo(node, refnode);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Replaces reference Node for the the given Node, and returns the removed Node.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {Node} refnode\n\t\t * @returns {Node} node\n\t\t */\n\t\treplace: function(node, refnode) {\n\t\t\treturn refnode.parentNode.replaceChild(node, refnode);\n\t\t},\n\n\t\t/**\n\t\t * Returns a DocumentFragment with the specified HTML.\n\t\t *\n\t\t * @param {string} html\n\t\t * @returns {DocumentFragment}\n\t\t */\n\t\tparseHTML: function(html) {\n\t\t\tvar div = document.createElement('div');\n\t\t\tdiv.innerHTML = html;\n\n\t\t\tvar fragment = document.createDocumentFragment();\n\t\t\tvar i, l = div.childNodes.length;\n\t\t\tfor (i = 0; i < l; i++) {\n\t\t\t\tfragment.appendChild(div.firstChild);\n\t\t\t}\n\t\t\treturn fragment;\n\t\t},\n\n\t\t/**\n\t\t * Returns the value of a key/value pair that was saved to this node earlier. Values may be of any type, as\n\t\t * the data is stored in an object literal that is linked to the node via a custom identifier. Note that this\n\t\t * data is not accessible via attributes or native datasets, and does not span multiple sessions or views.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {string} key\n\t\t * @returns {mixed} value\n\t\t */\n\t\tgetData: function(node, key) {\n\t\t\tvar uid = node[dataAttr];\n\t\t\tvar data = uid ? dataMap[uid] : null;\n\n\t\t\treturn data ? data[key] : null;\n\t\t},\n\n\t\t/**\n\t\t * Stores a key/value pair on a node. Values may be of any type, as the data is stored in an object literal\n\t\t * that is linked to the node via a custom identifier. Note that this data is not accessible via attributes\n\t\t * or native datasets, and does not span multiple sessions or views.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {string} key\n\t\t * @param {mixed} value\n\t\t * @returns {mixed} value\n\t\t */\n\t\tsetData: function(node, key, value) {\n\t\t\tvar uid = node[dataAttr];\n\t\t\tif (!uid) {\n\t\t\t\tuid = ptv.getUID();\n\t\t\t\tnode[dataAttr] = uid;\n\t\t\t}\n\n\t\t\tvar data = dataMap[uid];\n\n\t\t\tif (!data) {\n\t\t\t\tdataMap[uid] = data = {};\n\t\t\t}\n\n\t\t\tdata[key] = value;\n\n\t\t\treturn value;\n\t\t},\n\n\t\t/**\n\t\t * Removes data with specified key from specified node, stored by earlier call to {@link playtotv.dom.setData}.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {string} key\n\t\t */\n\t\tremoveData: function(node, key) {\n\t\t\tvar uid = node[dataAttr];\n\t\t\tvar data = dataMap[uid];\n\t\t\tif (data) {\n\t\t\t\tdelete data[key];\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Returns the attribute value of the closest node that has specified attribute.\n\t\t *\n\t\t * @param {Node} node Node from which to start looking\n\t\t * @param {string} key Attribute key to look for\n\t\t * @return {string} Attribute value of the closest node\n\t\t */\n\t\tgetClosestAttr: function(node, key) {\n\t\t\tnode = this.closest('[' + key + ']', node);\n\t\t\treturn node ? node.getAttribute(key) : undefined;\n\t\t},\n\n\t\t/**\n\t\t * Returns dataset or a read-only dataset like data attribute map Object.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @returns {Object} dataset\n\t\t */\n\t\tgetDataSet: function(node) {\n\t\t\tvar dataset = node.dataset;\n\n\t\t\tif (!dataset) {\n\t\t\t\treturn Array.from(node.attributes).reduce(function(dataset, attr) {\n\t\t\t\t\tvar name = attr.name;\n\t\t\t\t\tif (name.indexOf('data-') !== 0) {\n\t\t\t\t\t\treturn dataset;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Remove data- prefix and convert to camel case\n\t\t\t\t\tname = name.substr(5).replace(/-([a-z])/g, function(match, letter) {\n\t\t\t\t\t\treturn letter.toUpperCase();\n\t\t\t\t\t});\n\n\t\t\t\t\tdataset[name] = attr.value;\n\t\t\t\t\treturn dataset;\n\t\t\t\t}, {});\n\t\t\t}\n\n\t\t\t// Workaround for Android 4.3 that returns an \"object\" without hasOwnProperty() method etc.\n\t\t\tif (!dataset.hasOwnProperty) {\n\t\t\t\tvar key, copy = {};\n\t\t\t\tfor (key in dataset) {\n\t\t\t\t\t/*jshint forin:false*/\n\t\t\t\t\tcopy[key] = dataset[key];\n\t\t\t\t}\n\t\t\t\tdataset = copy;\n\t\t\t}\n\n\t\t\treturn dataset;\n\t\t}\n\t};\n\n}());\n",
		"(function() {\n\n\t'use strict';\n\n\t// Abort if we are not running in a browser (e.g: in Node)\n\tif (typeof window === 'undefined') {\n\t\treturn;\n\t}\n\n\tvar document = window.document;\n\n\t/**\n\t * @name Event\n\t * @memberOf playtotv.event\n\t * @class\n\t * @param {String} type\n\t * @param {object} params\n\t*/\n\tvar Event = window.Event;\n\n\t/**\n\t * @name MouseEvent\n\t * @memberOf playtotv.event\n\t * @class\n\t * @param {String} type\n\t * @param {object} params\n\t*/\n\tvar MouseEvent = window.MouseEvent;\n\n\t/**\n\t * @name CustomEvent\n\t * @memberOf playtotv.event\n\t * @class\n\t * @param {String} type\n\t * @param {object} params\n\t*/\n\tvar CustomEvent = window.CustomEvent;\n\n\t// determine whether Event(s) as constructor are supported\n\tvar supportsCustom = (function() {\n\t\ttry {\n\t\t\tvar custom = new CustomEvent('test');\n\t\t\tcustom.preventDefault();\n\t\t\treturn true;\n\t\t} catch (e) {\n\t\t\treturn false;\n\t\t}\n\t}());\n\n\t// IE9 and up support for Event(s) as constructor. Note that these Event classes are exposed via playtotv.event\n\t// for manually dispatching them on nodes if so needed. For convenience, event.triggerNative may be used.\n\tif (!supportsCustom) {\n\t\tvar eventProto = Event.prototype;\n\n\t\tEvent = function(event, params) {\n\t\t\tparams = playtotv.params(params, {\n\t\t\t\tbubbles: false,\n\t\t\t\tcancelable: false\n\t\t\t});\n\n\t\t\tvar evt = document.createEvent('HTMLEvents');\n\t\t\tevt.initEvent(event, params.bubbles, params.cancelable);\n\t\t\treturn evt;\n\t\t};\n\n\t\tEvent.prototype = eventProto;\n\n\t\tCustomEvent = function(event, params) {\n\t\t\tparams = playtotv.params(params, {\n\t\t\t\tbubbles: false,\n\t\t\t\tcancelable: false,\n\t\t\t\tdetail: null\n\t\t\t});\n\n\t\t\tvar evt = document.createEvent( 'CustomEvent' );\n\t\t\tevt.initCustomEvent( event, params.bubbles, params.cancelable, params.detail );\n\t\t\treturn evt;\n\t\t};\n\n\t\tCustomEvent.prototype = eventProto;\n\n\t\tMouseEvent = function(event, params) {\n\t\t\tparams = playtotv.params(params, {\n\t\t\t\tbubbles: false,\n\t\t\t\tcancelable: false,\n\t\t\t\tscreenX: 0,\n\t\t\t\tscreenY: 0,\n\t\t\t\tclientX: 0,\n\t\t\t\tclientY: 0,\n\t\t\t\tctrlKey: false,\n\t\t\t\taltKey: false,\n\t\t\t\tshiftKey: false,\n\t\t\t\tmetaKey: false,\n\t\t\t\tbutton: 0,\n\t\t\t\tbuttons: 0,\n\t\t\t\trelatedTarget: null\n\t\t\t});\n\n\t\t\tvar evt = document.createEvent('MouseEvent');\n\t\t\tevt.initMouseEvent(\n\t\t\t\tevent, params.bubbles, params.cancelable, window, 1,\n\t\t\t\tparams.screenX, params.screenY, params.clientX, params.clientY,\n\t\t\t\tparams.ctrlKey, params.altKey, params.shiftKey, params.metaKey,\n\t\t\t\tparams.button,\n\t\t\t\tparams.relatedTarget\n\t\t\t);\n\t\t\treturn evt;\n\t\t};\n\n\t\tMouseEvent.prototype = eventProto;\n\t}\n\n\t/**\n\t * EventListener, represents a listener function for an event on the given node. Returned by\n\t * {@link playtotv.event.addListener} for easy removal at {@link playtotv.event.removeListener}, instead of passing\n\t * the separate node, type and listener arguments.\n\t *\n\t * @name EventListener\n\t * @memberOf playtotv.event\n\t * @class\n\t * @param {Node} node\n\t * @param {String} type\n\t * @param {Function} listener\n\t */\n\tclass EventListener {\n\t\tconstructor(node, type, listener) {\n\t\t\tthis.node = node;\n\t\t\tthis.type = type;\n\t\t\tthis.listener = listener;\n\t\t}\n\n\t\tdispose() {\n\t\t\tdelete this.node;\n\t\t\tdelete this.type;\n\t\t\tdelete this.listener;\n\t\t}\n\t}\n\n\t/**\n\t * Event namespace\n\t *\n\t * @namespace Public event namespace, enables binding, unbinding and dispatching of events.\n\t */\n\tplaytotv.event = {\n\n\t\t/**\n\t\t * Adds an event listener of the given type to a Node and returns an {@link playtotv.event.EventListener}\n\t\t * listener object for easy removal at {@link playtotv.event#removeListener}.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {string} type\n\t\t * @param {Function} listener\n\t\t * @returns {playtotv.event.EventListener} listener\n\t\t */\n\t\taddListener: function(node, type, listener) {\n\t\t\tif (!node) {\n\t\t\t\tthrow new ReferenceError('Node is undefined at event.addListener for \"' + type + '\"');\n\t\t\t}\n\n\t\t\tnode.addEventListener(type, listener, false);\n\n\t\t\t// return optional listener object for removeListener\n\t\t\treturn new EventListener(node, type, listener);\n\t\t},\n\n\t\t/**\n\t\t * Removes an event listener of the given type from a Node. A single {@link playtotv.event.EventListener}\n\t\t * listener object may be passed as returned by {@link playtotv.event#addListener}, instead of calling this\n\t\t * function with separate node, type and listener parameters.\n\t\t *\n\t\t * @param {Node|playtotv.event.EventListener} subject\n\t\t * @param {string} [type]\n\t\t * @param {Function} [listener]\n\t\t */\n\t\tremoveListener: function(subject, type, listener) {\n\t\t\tvar node = subject;\n\n\t\t\t// subject may either be a node, or an EventListener object\n\t\t\tif (subject instanceof EventListener) {\n\t\t\t\tlistener = subject.listener;\n\t\t\t\ttype = subject.type;\n\t\t\t\tnode = subject.node;\n\t\t\t\tsubject.dispose();\n\t\t\t}\n\n\t\t\tif (!node) {\n\t\t\t\tthrow new ReferenceError('Node is undefined at event.removeListener for \"' + type + '\"');\n\t\t\t}\n\n\t\t\tnode.removeEventListener(type, listener, false);\n\t\t},\n\n\t\t/**\n\t\t * Dispatches a CustomEvent on the given Node, and returns a boolean whether any handler that listened to it\n\t\t * called preventDefault on the event object (if cancelable), as it traversed the DOM.\n\t\t *\n\t\t * @function\n\t\t * @param {Node} node\n\t\t * @param {string} type\n\t\t * @param {boolean} bubbles\n\t\t * @param {boolean} cancelable\n\t\t * @param {Object} detail\n\t\t * @returns {boolean} unprevented\n\t\t */\n\t\tdispatchEvent: function(node, event, bubbles, cancelable, detail) {\n\t\t\treturn node.dispatchEvent(new CustomEvent(event, {\n\t\t\t\tbubbles: bubbles,\n\t\t\t\tcancelable: cancelable,\n\t\t\t\tdetail: detail\n\t\t\t}));\n\t\t},\n\n\t\t/**\n\t\t * Triggers a native HTML event or mouse event on a node. This method is more or less just convenience for\n\t\t * dispatching a (Mouse)Event instance with node.dispatchEvent, although using this method does ensure\n\t\t * IE9 compatibility by using the deprecated event.initMouseEvent if needed.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {string} type\n\t\t * @param {object} params\n\t\t * @returns {boolean} unprevented\n\t\t */\n\t\ttriggerNative: function(node, type, params) {\n\t\t\tparams = Object.assign({\n\t\t\t\tbubbles: true,\n\t\t\t\tcancelable: true\n\t\t\t}, params);\n\n\t\t\tvar event = /mouse|click/.test(type) ?\n\t\t\t\tnew MouseEvent(type, params) : new Event(type, params);\n\n\t\t\treturn node.dispatchEvent(event);\n\t\t},\n\n\t\t/**\n\t\t * Prevents the default action of an event. May be passed to addListener for shorthand purposes.\n\t\t * @param {playtotv.event.Event} event\n\t\t * @returns {boolean} false\n\t\t */\n\t\tpreventDefault: function(e) {\n\t\t\te.preventDefault();\n\t\t\treturn false;\n\t\t},\n\n\t\t/**\n\t\t * Stops event propagation through the dom. May be passed to addListener for shorthand purposes.\n\t\t * @param {playtotv.event.Event} event\n\t\t */\n\t\tstopPropagation: function(e) {\n\t\t\te.stopPropagation();\n\t\t},\n\n\t\t/**\n\t\t * Set window.onerror to a function that calls any previously set window.onerror function\n\t\t * and then calls specified callback with the Error instance.\n\t\t *\n\t\t * If error is not provided by browser then an approximation is constructed using the other arguments.\n\t\t *\n\t\t * @param {Function} callback Function to call with uncaught error\n\t\t */\n\t\taddWindowOnError: function(callback) {\n\t\t\tvar originalOnError = window.onerror;\n\n\t\t\twindow.onerror = function(errorMsg, url, line, column, error) {\n\t\t\t\t/*jshint maxcomplexity:10*/\n\t\t\t\tvar originalReturnValue;\n\t\t\t\tif (originalOnError) {\n\t\t\t\t\toriginalReturnValue = originalOnError.apply(this, arguments);\n\t\t\t\t}\n\n\t\t\t\tif (!error) {\n\t\t\t\t\terror = new Error((errorMsg.match(/Error: (.*)/) || [])[1] || errorMsg);\n\t\t\t\t\terror.name = (errorMsg.match(/\\w+Error/) || [])[0] || 'Error';\n\t\t\t\t\terror.stack = url + ':' + line + (column === undefined ? '' : ':' + column);\n\t\t\t\t}\n\n\t\t\t\treturn callback(error) || originalReturnValue;\n\t\t\t};\n\t\t}\n\t};\n\n\t/**\n\t * add local objects to public namespace\n\t *\n\t */\n\n\tObject.assign(playtotv.event, {\n\t\tCustomEvent: CustomEvent,\n\t\tEvent: Event,\n\t\tEventListener: EventListener,\n\t\tMouseEvent: MouseEvent\n\t});\n\n}());\n",
		"(function() {\n\n\t'use strict';\n\n\t// TODO: Replace this by using ES6 import and export (nBob will need to support that)\n\n\t// Reliably get a global reference on all platforms by looking at a non-strict function's \"this\"\n\tvar global = /*jshint evil:true*/ new Function('return this')(); /*jshint evil:false*/\n\n\t// Variables\n\n\tvar pkgURL = playtotv.pkgURL = {};\n\tvar loadPromises = {};\n\tvar definePromises = playtotv.definePromises = {};\n\tvar modules = playtotv.modules = {};\n\n\t// Private functions\n\n\tfunction getModuleURL(id) {\n\t\tvar base = '';\n\t\tplaytotv.each(pkgURL, function(url, pkg) {\n\t\t\tif (!base && id.indexOf(pkg) === 0) {\n\t\t\t\tbase = url;\n\t\t\t\tid = id.replace(pkg, '');\n\t\t\t}\n\t\t});\n\t\t// Replace camel case by lower case dash separated and replace dots by slashes, then add .js extension\n\t\tvar path = id.replace(/([a-z0-9])([A-Z])/g, '$1-$2').toLowerCase().replace(/\\./g, '/') + '.js';\n\t\treturn base + path;\n\t}\n\n\tfunction registerModule(id, module) {\n\t\tvar space = global;\n\t\tvar spaces = id.split('.');\n\t\tvar i, name, current, l = spaces.length, last = l - 1;\n\t\tfor (i = 0; i < l; i++) {\n\t\t\tname = spaces[i];\n\t\t\tcurrent = space[name];\n\t\t\tif (i < last) {\n\t\t\t\tspace = current || (space[name] = {});\n\t\t\t} else {\n\t\t\t\t// a.b.c may be defined before a.b, if so, extend a.b with c\n\t\t\t\tspace[name] = current ? Object.assign(module, current) : module;\n\t\t\t}\n\t\t}\n\t}\n\n\t// Public functions\n\n\t/**\n\t * Returns a Promise of the module with specified id, loading the related script file if necessary.\n\t *\n\t * @param {string} id Module id\n\t * @return {Promise} Module promise\n\t */\n\tplaytotv.getModule = function(id) {\n\t\tvar url = getModuleURL(id) + '?nocache=' + Date.now(); // bust cache to ease development\n\t\treturn definePromises[id] || loadPromises[id] || (loadPromises[id] = playtotv.loadScript(url).then(function() {\n\t\t\tif (!definePromises[id]) {\n\t\t\t\tthrow new Error(id + ' was not defined by ' + url);\n\t\t\t}\n\t\t\treturn definePromises[id];\n\t\t}));\n\t};\n\n\t/**\n\t * Defines a module using the given id.\n\t * An array of dependencies may be passed, which will be loaded dynamically if not already defined.\n\t * The factory function will be called after all depencies are loaded to create the module.\n\t * The module will also be registered in the global namespace to facilitate usage by third party JavaScript.\n\t *\n\t * A define/require implementation inspired by CommonJS Asynchronous Definition.\n\t * <p>\n\t * Main differences:\n\t * <ul>\n\t * <li>Module id's are dot separated and map to URLs (dots replaced by slashes and camel case by dashed lower case)\n\t * <li>Module dependencies are strings like the module id and can not be relative\n\t * <li>Module dependencies will be dynamically loaded if not already defined\n\t * <li>Module dependencies that are dynamically loaded must use playtotv.define to complete their definition\n\t * </ul>\n\t * </p>\n\t *\n\t * @param {string} id Module id\n\t * @param {Array} dependencies Module dependency id's\n\t * @param {Function} factory Module factory function\n\t * @return {Promise} A Promise of the defined module\n\t */\n\tplaytotv.define = function(id, deps, factory) {\n\t\tif (arguments.length !== 3) {\n\t\t\tthrow new Error('Three arguments required');\n\t\t}\n\n\t\t// TODO: Enable module factory functions to return a promise\n\t\t// Now, when a module depends on such a module it will wait for that promise to resolve instead of just waiting\n\t\t// for the promise of the factory function execution around it to resolve.\n\t\treturn definePromises[id] ||\n\t\t\t(\n\t\t\t\tdefinePromises[id] = Promise.all(deps.map(playtotv.getModule)).then(function(dependencies) {\n\t\t\t\t\tvar thisArg = { id: id, dependencies: deps };\n\t\t\t\t\tvar module = (factory instanceof Function) ? factory.apply(thisArg, dependencies) : factory;\n\t\t\t\t\tmodules[id] = module;\n\t\t\t\t\tregisterModule(id, module);\n\t\t\t\t\treturn module;\n\t\t\t\t})\n\t\t\t);\n\t};\n\n\t/**\n\t * Returns the module with specified id if it has been defined.\n\t *\n\t * @param {string} id Module id\n\t * @returns {Object} Module\n\t */\n\tplaytotv.require = function(id) {\n\t\treturn modules[id];\n\t};\n\n\t/**\n\t * Returns the id of specified module.\n\t *\n\t * @param {Object} module Module\n\t * @return {string} Module id\n\t */\n\tplaytotv.getModuleId = function(module) {\n\t\treturn Object.keys(modules).find((id) => modules[id] === module);\n\t};\n\n\t/**\n\t * Returns an object mapping the names of the specified module ids without their 'package prefixes' to their\n\t * corresponding modules, similar to Java's import statement.\n\t *\n\t * @param {Array} ids Module id's\n\t * @returns {Object} Module map\n\t */\n\tplaytotv.importModules = function(ids) {\n\t\tvar nameReg = /[^.]+$/i;\n\t\tvar importModules = {};\n\t\tvar i, id, name, l = ids.length;\n\t\tfor (i = 0; i < l; i++) {\n\t\t\tid = ids[i];\n\t\t\tname = nameReg.exec(id)[0];\n\t\t\timportModules[name] = modules[id];\n\t\t}\n\t\treturn importModules;\n\t};\n\n}());\n",
		"(function() {\n\n\t'use strict';\n\n\t/**\n\t * Shorthands\n\t *\n\t */\n\tvar ptv = playtotv;\n\n\t// Improved decodeURIComponent with added support for things like: '?key=foo+bar'\n\tfunction decodeURIComponent(s) {\n\t\treturn window.decodeURIComponent(s.replace(/\\+/g, ' '));\n\t}\n\n\tptv.util = {\n\t\t/** @lends playtotv.util */\n\n\t\t// Ease up on regex-es\n\t\t/*jshint regexdash:true, quotmark:false, maxlen:250*/\n\n\t\t/**\n\t\t * Regular expression to validate the format of an email.\n\t\t * @type RegExp\n\t\t */\n\t\tEMAIL_REGEXP: new RegExp(\"^[A-Za-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\\\.[A-Za-z0-9!#$%&'*+/=?^_`{|}~-]+)*@\" +\n\t\t\t'(?:[A-Za-z0-9](?:[A-Za-z0-9-]*[A-Za-z0-9])?\\\\.)+[A-Za-z0-9](?:[A-Za-z0-9-]*[A-Za-z0-9])$'),\n\n\t\t/**\n\t\t * Regular expression for matching URL's in a string.\n\t\t * @type RegExp\n\t\t */\n\t\tURL_REGEXP: /\b((?:[a-z][\\w-]+:(?:\\/{1,3}|[a-z0-9%])|www\\d{0,3}[.]|[a-z0-9.\\-]+[.][a-z]{2,4}\\/)(?:[^\\s()<>]+|\\(([^\\s()<>]+|(\\([^\\s()<>]+\\)))*\\))+(?:\\(([^\\s()<>]+|(\\([^\\s()<>]+\\)))*\\)|[^\\s`!()\\[\\]{};:'\".,<>?]))/gi,\n\n\t\t/**\n\t\t * Regular expression to derive the Origin from a URL.\n\t\t * @type RegExp\n\t\t */\n\t\tORIGIN_REGEXP: /(\\w+:)?\\/{2,}[^\\/]+/,\n\n\t\t/**\n\t\t * Returns an HTML escaped version of the given String.\n\t\t *\n\t\t * @param {string} unescaped\n\t\t * @returns {string} HTML escaped version\n\t\t */\n\t\tescapeHtml: function(unescaped) {\n\t\t\treturn ptv.dom.create('div', null, { text: unescaped }).innerHTML;\n\t\t},\n\n\t\t/**\n\t\t * Returns an escaped version of the given string for use with the RegExp class.\n\t\t *\n\t\t * @param {string} text String to escape\n\t\t * @returns {string} RegExp escaped string\n\t\t */\n\t\tescapeRegEx: function(text) {\n\t\t\treturn text.replace(/[\\-\\[\\]{}()*+?.,\\\\\\^$|#\\s]/g, '\\\\$&');\n\t\t},\n\n\t\t/**\n\t\t * Basic glob to RegExp converter, just supports * wildcards for now.\n\t\t *\n\t\t * @param {string} glob\n\t\t * @returns {RegExp}\n\t\t */\n\t\tglobToRegEx: function(glob) {\n\t\t\treturn new RegExp('^' + this.escapeRegEx(glob).replace(/\\\\\\*/g, '(.*)') + '$');\n\t\t},\n\n\t\t/**\n\t\t * Glob test specified candidate string.\n\t\t *\n\t\t * @param {string} glob\n\t\t * @param {string} candidate\n\t\t * @returns {boolean} True if candidate matches glob\n\t\t */\n\t\tglob: function(glob, candidate) {\n\t\t\treturn this.globToRegEx(glob).test(candidate);\n\t\t},\n\n\t\t/**\n\t\t * Adds a key value pair to an URL. Checks for existing parameters and a possible hash for insertion.\n\t\t *\n\t\t * @param {string} URL\n\t\t * @param {string} key\n\t\t * @param {string} value\n\t\t * @returns {string} URL with key and value added to it\n\t\t */\n\t\taddURLParam: function(url, key, value) {\n\t\t\tvar sep = (url.indexOf('?') !== -1) ? '&' : '?';\n\t\t\treturn url.replace(/((#.*)?$)/, sep + encodeURIComponent(key) + '=' + encodeURIComponent(value) + '$1');\n\t\t},\n\n\t\t/**\n\t\t * Adds multiple URL params via an object literal.\n\t\t *\n\t\t * @param {string} URL\n\t\t * @param {Object} params\n\t\t * @returns {string} URL with params added to it\n\t\t */\n\t\taddURLParams: function(url, params) {\n\t\t\tptv.each(params, function(value, key) {\n\t\t\t\turl = this.addURLParam(url, key, value);\n\t\t\t}, this);\n\t\t\treturn url;\n\t\t},\n\n\t\t/**\n\t\t * Returns an object literal of the key value pairs in the specified URL.\n\t\t *\n\t\t * @param {string} [url=window.location.href] Defaults to current window URL\n\t\t * @returns {Object} URL parameters\n\t\t */\n\t\tgetURLParams: function(url) {\n\t\t\turl = url || window.location.href;\n\t\t\tvar query = url.replace(/[^\\?]*\\??([^#]*)(#.*)?/, '$1');\n\t\t\tvar params = {};\n\t\t\tvar regex = /([^&=]+)=?([^&]*)/g;\n\t\t\tvar match;\n\t\t\t/*jshint boss:true*/ // suppress warning about following line\n\t\t\twhile (match = regex.exec(query)) {\n\t\t\t\tparams[ decodeURIComponent(match[1]) ] = decodeURIComponent(match[2]);\n\t\t\t}\n\t\t\treturn params;\n\t\t},\n\n\t\t/**\n\t\t * Returns the origin of the specified URL.\n\t\t *\n\t\t * @param {string} [url=window.location.href] URL to derive origin from\n\t\t * @param {string} [baseUrl=window.location.href] Base URL to use for deriving a relative URL's origin\n\t\t * @return {string} Origin of the specified URL\n\t\t */\n\t\tgetOrigin: function(url, baseUrl) {\n\t\t\tvar loc = window.location;\n\t\t\turl = url || loc.href;\n\t\t\tbaseUrl = baseUrl || loc.href;\n\n\t\t\t// If URL matches origin regexp then it is absolute, otherwise it is relative\n\t\t\tvar matches = url.match(this.ORIGIN_REGEXP);\n\t\t\tvar origin = matches ? matches[0] : baseUrl.match(this.ORIGIN_REGEXP)[0];\n\n\t\t\t// Use location protocol by default if not specified (e.g: '//foo.com')\n\t\t\tif (origin.indexOf('//') === 0) {\n\t\t\t\torigin = loc.protocol + origin;\n\t\t\t}\n\n\t\t\t// Origin of file://foo/bar should be file:// instead of file://foo\n\t\t\tif (origin.indexOf('file://') === 0) {\n\t\t\t\torigin = 'file://';\n\t\t\t}\n\n\t\t\treturn origin;\n\t\t},\n\n\t\t/**\n\t\t * Opens a popup window, facilitating specifying window features by an object instead of a string.\n\t\t *\n\t\t * Width and height options are ensured to be smaller then or equal to screen size.\n\t\t * Note: Unfortunately this does not account for space used by bars around content.\n\t\t *\n\t\t * If width and/or height are defined then the window will be automatically centered on screen by calculating\n\t\t * the appropriate values for the left and top options (unless those are already manually defined).\n\t\t *\n\t\t * @param {string} url URL to open in popup window\n\t\t * @param {string} [target='_blank'] Name of target window, '_blank' for new window\n\t\t * @param {Object} [options={}] Object with window features to request\n\t\t * @return {Window} Popup window\n\t\t */\n\t\tpopup: function(url, target, options) {\n\t\t\ttarget = target || '_blank';\n\t\t\toptions = options || {};\n\n\t\t\tvar width = options.width;\n\t\t\tif (width) {\n\t\t\t\tvar winWidth = window.screen.width;\n\t\t\t\toptions.width = width = Math.min(width, winWidth);\n\t\t\t\toptions.left = options.left || Math.round((winWidth / 2) - (width / 2));\n\t\t\t}\n\n\t\t\tvar height = options.height;\n\t\t\tif (height) {\n\t\t\t\tvar winHeight = window.screen.height;\n\t\t\t\toptions.height = height = Math.min(height, winHeight);\n\t\t\t\toptions.top = options.top || Math.round((winHeight / 2) - (height / 2));\n\t\t\t}\n\n\t\t\tvar features = Object.keys(options).map(function(key) {\n\t\t\t\treturn key + '=' + options[key];\n\t\t\t}).join(',');\n\n\t\t\treturn window.open(url, target, features);\n\t\t},\n\n\t\t/**\n\t\t * Pads a string with a leading character (or 0 if omited) up to the given length.\n\t\t *\n\t\t * @param {string} str String to pad\n\t\t * @param {number} [len=2] Length to pad up to\n\t\t * @param {Char} [ch='0'] Character to pad with\n\t\t * @returns {string} Padded string\n\t\t */\n\t\tpad: function(str, len, ch) {\n\t\t\tstr = String(str);\n\t\t\tlen = parseInt(len, 10) || 2;\n\t\t\tch = ch || '0';\n\t\t\twhile (str.length < len) {\n\t\t\t\tstr = ch + str;\n\t\t\t}\n\t\t\treturn str;\n\t\t},\n\n\t\t/**\n\t\t * Returns a formatted version of the given date, in hh:mm:ss and optional ms.\n\t\t *\n\t\t * @param {Date} [date=new Date()] Defaults to current date\n\t\t * @param {boolean} [ms=false] Whether to show milliseconds\n\t\t * @returns {string} Formatted time string\n\t\t */\n\t\ttimeStr: function(date, ms) {\n\t\t\tdate = date || new Date();\n\t\t\treturn this.pad(date.getHours()) + ':' +\n\t\t\t\tthis.pad(date.getMinutes()) + ':' +\n\t\t\t\tthis.pad(date.getSeconds()) +\n\t\t\t\t(ms ? '.' + this.pad(date.getMilliseconds(), 3) : '');\n\t\t},\n\n\t\t/**\n\t\t * Date format function based on Java's SimpleDateFormat.\n\t\t * @see https://docs.oracle.com/javase/8/docs/api/index.html?java/text/SimpleDateFormat.html\n\t\t *\n\t\t * Pattern letters:\n\t\t *   G*  Era designator  Text  AD\n\t\t *   y   Year  Year  1996; 96\n\t\t *   Y*  Week year  Year  2009; 09\n\t\t *   M   Month in year (context sensitive)  Month  July; Jul; 07\n\t\t *   L*  Month in year (standalone form)  Month  July; Jul; 07\n\t\t *   w*  Week in year  Number  27\n\t\t *   W*  Week in month  Number  2\n\t\t *   D*  Day in year  Number  189\n\t\t *   d   Day in month  Number  10\n\t\t *   F*  Day of week in month  Number  2\n\t\t *   E*  Day name in week  Text  Tuesday; Tue\n\t\t *   u*  Day number of week (1 = Monday, ..., 7 = Sunday)  Number  1\n\t\t *   a   Am/pm marker  Text  PM\n\t\t *   H   Hour in day (0-23)  Number  0\n\t\t *   k*  Hour in day (1-24)  Number  24\n\t\t *   K*  Hour in am/pm (0-11)  Number  0\n\t\t *   h   Hour in am/pm (1-12)  Number  12\n\t\t *   m   Minute in hour  Number  30\n\t\t *   s   Second in minute  Number  55\n\t\t *   S   Millisecond  Number  978\n\t\t *   z*  Time zone  General time zone  Pacific Standard Time; PST; GMT-08:00\n\t\t *   Z*  Time zone  RFC 822 time zone  -0800\n\t\t *   X*  Time zone  ISO 8601 time zone  -08; -0800; -08:00\n\t\t *\n\t\t * TODO: Add support for unsupported letters, e.g. marked with (*)\n\t\t * TODO: Add support for number/name depending on length, e.g: MMM => Aug and: MMMM => August\n\t\t * TODO: Add support for escaping, e.g: \"hh 'o''clock' a\" => \"12 o'clock PM\"\n\t\t *\n\t\t * @param {string} pattern\n\t\t * @param {Date|number|string} [date] Defaults to current date\n\t\t * @returns {string} Formatted date string\n\t\t */\n\t\tformatDate: function(pattern, date = new Date()) {\n\t\t\t// Convert to Date if necessary (e.g: unix timestamp number or date string)\n\t\t\tif (!(date instanceof Date)) {\n\t\t\t\tdate = new Date(date);\n\t\t\t}\n\n\t\t\t// Note: An attempt was made to optimize this a bit by only calling Date methods when necessary etc.\n\t\t\tvar hours = date.getHours();\n\t\t\treturn pattern.replace(/([a-zA-Z])\\1*/g, letters => {\n\t\t\t\t/*jshint maxcomplexity:100*/\n\n\t\t\t\tvar letter = letters[0];\n\t\t\t\tvar len = letters.length;\n\t\t\t\tvar output =\n\t\t\t\t\tletter === 'y' ? (len === 2 ? String(date.getFullYear()).substr(2) : date.getFullYear()) :\n\t\t\t\t\tletter === 'M' ? date.getMonth() + 1 :\n\t\t\t\t\tletter === 'd' ? date.getDate() :\n\t\t\t\t\tletter === 'H' ? hours :\n\t\t\t\t\tletter === 'h' ? (hours <= 12 ? (hours === 0 ? 12 : hours) : hours - 12) :\n\t\t\t\t\tletter === 'm' ? date.getMinutes() :\n\t\t\t\t\tletter === 's' ? date.getSeconds() :\n\t\t\t\t\tletter === 'S' ? date.getMilliseconds() :\n\t\t\t\t\tletter === 'a' ? (hours < 12 ? 'AM' : 'PM') :\n\t\t\t\t\tnull;\n\n\t\t\t\tif (output === null) {\n\t\t\t\t\tthrow new Error(`Unsupported letter: ${letter} in pattern: ${pattern}`);\n\t\t\t\t}\n\n\t\t\t\t// Pad number with 0's if necessary, e.g: 1 with MM => 01\n\t\t\t\tif (len > 1) {\n\t\t\t\t\toutput = this.pad(output, len);\n\t\t\t\t}\n\n\t\t\t\treturn output;\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Returns a currency formatted value from the given number.\n\t\t *\n\t\t * @param {number} number Value to format\n\t\t * @param {boolean} [cents=true] Whether to round to cents or whole units\n\t\t * @returns {string} Formatted currency string\n\t\t */\n\t\ttoCurrency: function(number, cents) {\n\t\t\t// number.toLocaleString() fails in chrome and adds no decimals\n\t\t\tvar split = parseFloat(number).toFixed(2).split('.');\n\t\t\tvar nr = split[0].split(''), i, l = nr.length - 3;\n\t\t\tfor (i = l; i >= 1; i -= 3) {\n\t\t\t\tnr.splice(i, 0, '.');\n\t\t\t}\n\t\t\treturn nr.join('') + ',' + (cents === false ? '-' : split[1]);\n\t\t},\n\n\t\t/**\n\t\t * Returns lower case formatted string with words separated by dashes.\n\t\t *\n\t\t * @param {string} str\n\t\t * @returns {string}\n\t\t */\n\t\tdashCase: function(str) {\n\t\t\treturn str.\n\t\t\t\treplace(/\\W+/g, '-').\n\t\t\t\treplace(/\\w+/g, m => m.toLowerCase());\n\t\t},\n\n\t\t/**\n\t\t * Returns string formatted with only the first letters of words upper case and words separated by spaces.\n\t\t *\n\t\t * @param {string} str\n\t\t * @returns {string}\n\t\t */\n\t\ttitleCase: function(str) {\n\t\t\treturn str.\n\t\t\t\treplace(/[\\W_]+/g, ' ').\n\t\t\t\treplace(/(\\w)(\\w*)/g, (m, p1, p2) => p1.toUpperCase() + p2.toLowerCase());\n\t\t},\n\n\t\t/**\n\t\t * Returns head of path string separated by specified separator.\n\t\t *\n\t\t * @param {string} path Path (e.g: object property keys) string\n\t\t * @param {string} [sep='.'] Path string separator character\n\t\t * @returns {string} Head of path\n\t\t */\n\t\tgetPathHead: function(path, sep = '.') {\n\t\t\tvar i = path.indexOf(sep);\n\t\t\treturn i < 0 ? path : path.substr(0, i);\n\t\t},\n\n\t\t/**\n\t\t * Returns tail of path string separated by specified separator.\n\t\t *\n\t\t * @param {string} path Path (e.g: object property keys) string\n\t\t * @param {string} [sep='.'] Path string separator character\n\t\t * @returns {string} Tail of path\n\t\t */\n\t\tgetPathTail: function(path, sep = '.') {\n\t\t\tvar i = path.indexOf(sep);\n\t\t\treturn i < 0 ? '' : path.substr(i + 1);\n\t\t},\n\n\t\t/**\n\t\t * Returns a reference object with object, key and value properties.\n\t\t * Or object if path is falsy (e.g: in case you just want to return the object itself).\n\t\t * Or undefined if object is falsy (e.g: path was not found after recursion).\n\t\t *\n\t\t * @param {Object} [object] Object to seek through\n\t\t * @param {string} [path=''] Path (e.g: object property keys) to seek in object\n\t\t * @param {string} [sep='.'] Path string separator character\n\t\t * @returns {Object} Reference object with object, key and value\n\t\t */\n\t\tseekRef: function(object, path = '', sep = '.') {\n\t\t\tif (!path) {\n\t\t\t\treturn { object: object, key: '', value: object };\n\t\t\t}\n\t\t\tif (!object) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\tvar key = this.getPathHead(path, sep);\n\t\t\tvar value = object[key];\n\t\t\treturn key === path ?\n\t\t\t\t{ object: object, key: key, value: value } :\n\t\t\t\tthis.seekRef(value, this.getPathTail(path, sep));\n\t\t},\n\n\t\t/**\n\t\t * Returns value of property with specified path within specified object.\n\t\t * Or undefined if property at path could not be found.\n\t\t *\n\t\t * @param {Object} [object] Object to seek through\n\t\t * @param {string} [path=''] Path (e.g: object property keys) to seek in object\n\t\t * @param {string} [sep='.'] Path string separator character\n\t\t * @returns {mixed} Value of property with specified path within specified object\n\t\t */\n\t\tseek: function(object, path = '', sep = '.') {\n\t\t\tvar ref = this.seekRef(object, path, sep);\n\t\t\treturn ref && ref.value;\n\t\t},\n\n\t\t/**\n\t\t * Resolves a base 'from' and a relative 'to' path to a combined file path.\n\t\t *\n\t\t * Note: This currently only works for a relative from path (not starting with '/').\n\t\t *\n\t\t * TODO: Make this work for absolute paths as well, depending on whether from is absolute or not.\n\t\t *\n\t\t * @param {string} from Path to start from\n\t\t * @param {string} to Relative path to resolve to\n\t\t * @returns {string} Resolved path\n\t\t */\n\t\tresolvePath: function(from, to) {\n\t\t\tif (to.indexOf('/') === 0) {\n\t\t\t\treturn to.substr(1);\n\t\t\t}\n\n\t\t\tvar fromDir = from.substr(0, from.lastIndexOf('/') + 1);\n\n\t\t\twhile (to.indexOf('../') === 0) {\n\t\t\t\tto = to.substr(3);\n\t\t\t\tfromDir = fromDir.replace(/[^\\/]+\\/$/, '');\n\t\t\t}\n\n\t\t\treturn fromDir + to;\n\t\t},\n\n\t\t/**\n\t\t * Returns a UTC time zone string (e.g: UTC+01:00).\n\t\t *\n\t\t * @param {number} [hours] Defaults to value derived from Date getTimezoneOffset()\n\t\t * @returns {string} UTC time zone string\n\t\t */\n\t\tgetTimeZone: function(hours) {\n\t\t\thours = hours === undefined ? -1 * (new Date().getTimezoneOffset() / 60) : hours;\n\t\t\tvar sign = hours < 0 ? '-' : '+';\n\t\t\thours = Math.abs(hours);\n\t\t\treturn 'UTC' + sign + this.pad(Math.floor(hours)) + ':' + this.pad((hours * 60) % 60);\n\t\t},\n\n\t\t/**\n\t\t * Evaluates specified script within specified context.\n\t\t *\n\t\t * Besides context properties being available like variables, it is also used as the 'this' argument.\n\t\t *\n\t\t * Strict mode is used to prevent leaking onto global scope (e.g: \"x = 1\" => window.x = 1) etc.\n\t\t *\n\t\t * Script is wrapped in eval to return block value without requiring explicit return.\n\t\t * E.g: script = \"x + 1\" instead of \"return x + 1\", like in a do-expression (ECMAScript proposal)\n\t\t * See: https://gist.github.com/DmitrySoshnikov/de4727f57c5acc17e9469d1a91743125\n\t\t *\n\t\t * Notes:\n\t\t * - Be careful when using this! Only use when you are sure it is appropriate and safe!\n\t\t * - Context can not have a property with key: '_script'\n\t\t *\n\t\t * @param {string} [script=''] Script to evaluate\n\t\t * @param {Object} [context={}] Context to evaluate within\n\t\t * @returns {mixed} Script return value\n\t\t */\n\t\teval: function(script = '', context = {}) {\n\t\t\t// Make context properties available through arguments of new Function\n\t\t\tvar args = Object.keys(context);\n\t\t\tvar values = args.map(arg => context[arg]);\n\n\t\t\t// Final argument is the Function script\n\t\t\t// Use eval only if necessary (it has a performance impact)\n\t\t\tscript = script.trim();\n\t\t\tvar semiIndex = script.indexOf(';');\n\t\t\tif (semiIndex >= 0 && semiIndex < script.length) {\n\t\t\t\targs.push('_script', '\"use strict\"; return eval(_script);');\n\t\t\t\tvalues.push(script);\n\t\t\t} else {\n\t\t\t\targs.push('\"use strict\"; return ' + script);\n\t\t\t}\n\n\t\t\t// Add script to error message to facilitate debugging (try-catch should barely have a performance impact)\n\t\t\ttry {\n\t\t\t\tvar fn = Function.apply(null, args);\n\t\t\t\treturn fn.apply(context, values);\n\t\t\t} catch (error) {\n\t\t\t\terror.message += ' in script: ' + script.trim().replace(/\\s+/g, ' ');\n\t\t\t\tthrow error;\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Returns list filtered by value specified by item path matching specified value by specified mode.\n\t\t *\n\t\t * When you pass a string value it is turned into a function for you based on mode.\n\t\t *\n\t\t * If you want a more exact form of matching then provide your own RegExp or Function test value.\n\t\t *\n\t\t * @param {Array} list List to filter\n\t\t * @param {string} path Filter value path, e.g: '' (item) or: 'x.y' (item.x.y)\n\t\t * @param {string|RegExp|Function|mixed} value Value to test for or Function to test with\n\t\t * @params {string} [mode] Filter mode: fuzzy/contains/startsWith/endsWith/equals (default: exact)\n\t\t * @returns {Array} Filtered list\n\t\t */\n\t\tfilter: function(list, path, value, mode) {\n\t\t\tif (typeof value === 'string') {\n\t\t\t\tvar escapedValue = this.escapeRegEx(value);\n\t\t\t\tvar regexStr = {\n\t\t\t\t\t// Very simple fuzzy-like matching algorithm\n\t\t\t\t\tfuzzy: value.split('').map(ch => this.escapeRegEx(ch) + '.*').join(''),\n\t\t\t\t\tcontains: escapedValue,\n\t\t\t\t\tstartsWith: '^' + escapedValue,\n\t\t\t\t\tendsWith: escapedValue + '$',\n\t\t\t\t\tequals: '^' + escapedValue + '$'\n\t\t\t\t}[mode];\n\t\t\t\tif (regexStr !== undefined) {\n\t\t\t\t\tvalue = new RegExp(regexStr, 'i');\n\t\t\t\t} // else default to exact string value match\n\t\t\t}\n\n\t\t\tvar filterFn = value instanceof RegExp ? value.test.bind(value) :\n\t\t\t\tvalue instanceof Function ? value.bind(list) :\n\t\t\t\tvalue === undefined ? function(candidate) { return !!candidate; } :\n\t\t\t\tfunction(candidate) { return candidate === value; };\n\n\t\t\treturn list.filter(item => filterFn(this.seek(item, path)));\n\t\t},\n\n\t\t/**\n\t\t * Returns a copy of list ordered by value specified by item path.\n\t\t *\n\t\t * @param {Array} list List to order\n\t\t * @param {string} [path=''] Filter value path, e.g: '' (item) or: 'x.y' (item.x.y)\n\t\t * @params {boolean} [desc=false] Whether to order in descencing order (or ascending)\n\t\t * @returns {Array} Ordered list\n\t\t */\n\t\torder: function(list, path = '', desc = false) {\n\t\t\t// Do not modify original array\n\t\t\tlist = list.slice(0);\n\n\t\t\treturn list.sort((a, b) => {\n\t\t\t\ta = this.seek(a, path);\n\t\t\t\tb = this.seek(b, path);\n\t\t\t\treturn (desc ? -1 : 1) * (a < b ? -1 : a > b ? 1 : 0);\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Returns specified page of list with added properties.\n\t\t *\n\t\t * The properties that are added are:\n\t\t * - page = actual page returned (bound between 1 and last page)\n\t\t * - prev = page - 1 or false if page is already <= 1\n\t\t * - next = page + 1 or false if page is already >= last\n\t\t * - last = last page number\n\t\t *\n\t\t * @param {Array} list List to page\n\t\t * @param {number} [page=1] Number of page to return (starting at 1)\n\t\t * @param {number} [size=10] Page size to use\n\t\t * @returns {Array} Specified page of list with added properties\n\t\t */\n\t\tpage: function(list, page = 1, size = 10) {\n\t\t\tvar last = Math.ceil(list.length / size);\n\t\t\tpage = Math.max(1, page);\n\t\t\tpage = Math.min(last, page);\n\n\t\t\tvar paged = list.slice((page - 1) * size, page * size);\n\n\t\t\tObject.assign(paged, {\n\t\t\t\tpage: page,\n\t\t\t\tprev: page > 1 && page - 1,\n\t\t\t\tnext: page < last && page + 1,\n\t\t\t\tlast: last\n\t\t\t});\n\n\t\t\treturn paged;\n\t\t}\n\t};\n\n}());\n",
		"(function() {\n\t/*global console*/\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar util = ptv.util;\n\n\tvar loggers = {};\n\tvar numericLevelMap = {\n\t\tSPAM: 4,\n\t\tDEBUG: 3,\n\t\tINFO: 2,\n\t\tWARNING: 1,\n\t\tERROR: 0,\n\t\tNONE: -1\n\t};\n\tvar logFuncMap = {\n\t\tSPAM: 'log',\n\t\tDEBUG: 'debug',\n\t\tINFO: 'info',\n\t\tWARNING: 'warn',\n\t\tERROR: 'error'\n\t};\n\tvar urlParams = typeof window !== 'undefined' ? util.getURLParams(window.location.href) : {};\n\n\t// If requested, include firebug lite\n\tif (urlParams.fbl) {\n\t\tptv.loadScript('//getfirebug.com/firebug-lite.js#startOpened', false);\n\t}\n\n\t// If requested, include weinre\n\tvar weinre = urlParams.weinre;\n\tif (weinre !== undefined) {\n\t\tptv.loadScript('https://weinre.exmachina.nl/target/target-script-min.js#' + (weinre || 'anonymous'), false);\n\t}\n\n\tclass Logger {\n\t\t/** @lends playtotv.Logger.prototype */\n\n\t\t/**\n\t\t * Returns a Logger instance with the given name and level.\n\t\t *\n\t\t * If a Logger with the same name was previously created by this function then that will be returned.\n\t\t * If a level is specified then the level of that instance will be updated.\n\t\t *\n\t\t * Otherwise a new Logger instance will be created with specified name and level and stored for future re-use.\n\t\t *\n\t\t * @param {string} [name]\n\t\t * @param {string} [level]\n\t\t * @returns {playtotv.Logger}\n\t\t */\n\t\tstatic get(name, level) {\n\t\t\tvar logger = name && loggers[name];\n\t\t\tif (logger) {\n\t\t\t\tif (level) {\n\t\t\t\t\tlogger.level = level;\n\t\t\t\t}\n\t\t\t\treturn logger;\n\t\t\t}\n\n\t\t\tlogger = new Logger(name, level);\n\t\t\tloggers[name] = logger;\n\t\t\treturn logger;\n\t\t}\n\n\t\t/**\n\t\t * Logger enables named loggers throughout different classes.\n\t\t * The level parameter is optional, and defaults to the static playtotv.Logger.level.\n\t\t * Both instance logger levels and static default level can be changed at runtime.\n\t\t *\n\t\t * Note: It is recommended to use {@link playtotv.Logger.get} to create Logger instances.\n\t\t *\n\t\t * Default log level and log join flag values can be controlled by URL parameters, see:\n\t\t * {@link playtotv.Logger.level} and {@link playtotv.Logger.join}.\n\t\t *\n\t\t * Specifying a truthy \"fbl\" URL parameter (e.g: ?fbl=1) will result in injection of a Firebug Lite inspector.\n\t\t *\n\t\t * Specifying a \"weinre\" URL parameter (e.g: ?weinre=lan-pp.playtotv.com:8080) will result in injection of\n\t\t * Weinre Javascript from specified host and port.\n\t\t *\n\t\t * @constructs\n\t\t * @param {string} [name=logger-[uid]]\n\t\t * @param {string} [level]\n\t\t */\n\t\tconstructor(name, level) {\n\t\t\tthis.name = name || ptv.getUID('logger-');\n\t\t\tthis.level = level;\n\t\t}\n\n\t\t/**\n\t\t * Indicates whether the logger is enabled for the given level.\n\t\t *\n\t\t * @param {string} level Logger level\n\t\t * @return {boolean} True if logger is enabled\n\t\t */\n\t\tisEnabled(level) {\n\t\t\tvar myLevel = this.level || Logger.level; // default to global level\n\t\t\treturn numericLevelMap[myLevel] >= numericLevelMap[level];\n\t\t}\n\n\t\t/**\n\t\t * Logs arguments to console if possible and specified level is enabled.\n\t\t *\n\t\t * Each argument that is a Promise will be substituted by an array of it's status and value.\n\t\t * When the Promise resolves or rejects log will be called again with the updated Promise status and value.\n\t\t *\n\t\t * If an argument is an Array it will be flattened to result in more readable console log output in most cases.\n\t\t *\n\t\t * Note: This is a shallow flatten, e.g: if that Array contains other Arrays, those will not be flattened.\n\t\t *\n\t\t * Finally, the log statement is prefixed with call time, call level and logger name.\n\t\t *\n\t\t * TODO: Update example below with Cancellable.setTimeout instead of when.timeout.\n\t\t *\n\t\t * @example\n\t\t * logger = playtotv.Logger.get('example');\n\t\t * logger.log('INFO', [\n\t\t *   'Test', 1, [2], [[3,4]],\n\t\t *   when.timeout(Promise.delay('yup', 1000), 2000),\n\t\t *   when.timeout(Promise.delay('yup', 3000), 2000)\n\t\t * ]);\n\t\t * // Output:\n\t\t * // 16:21:55 [INFO] example | Test 1 2 [3, 4] [promise] [promise]\n\t\t * // 16:21:56 [INFO] example | Test 1 2 [3, 4] [resolved] yup [promise]\n\t\t * // 16:21:57 [INFO] example | Test 1 2 [3, 4] [resolved] yup [rejected] timeout\n\t\t *\n\t\t * @param {string} level Logger level\n\t\t * @param {arguments} args Arguments to log\n\t\t */\n\t\tlog(level, args) {\n\t\t\tif (console && this.isEnabled(level)) {\n\t\t\t\targs = Array.from(args);\n\n\t\t\t\t// Log again once a Promise resolves or rejects, deferred by Promise until after logger.apply below\n\t\t\t\targs = args.map((arg) => {\n\t\t\t\t\tif (arg instanceof Promise) {\n\t\t\t\t\t\tvar p = [ '[promise]' ];\n\t\t\t\t\t\targ.then((data) => {\n\t\t\t\t\t\t\tp.push('[resolved]', data);\n\t\t\t\t\t\t\tthis.log(level, args);\n\t\t\t\t\t\t}, (reason) => {\n\t\t\t\t\t\t\tp.push('[rejected]', reason);\n\t\t\t\t\t\t\tthis.log(level, args);\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn p;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn arg;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Prefix and flatten args\n\t\t\t\tvar prefix = util.timeStr(new Date(), true) + ' [' + level + '] ' + this.name + ' |';\n\t\t\t\tvar processed = Array.prototype.concat.apply([ prefix ], args);\n\n\t\t\t\t// Determine logger function at runtime to allow for effective Firebug Lite etc. injection\n\t\t\t\tvar logger = console[logFuncMap[level]] || console.log;\n\t\t\t\tlogger.apply(console, Logger.join ? [ processed.join(' ') ] : processed);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Outputs a stacktrace to console if possible and specified level is enabled.\n\t\t *\n\t\t * @param {string} [level] Logger level\n\t\t */\n\t\ttrace(level) {\n\t\t\tif (console && console.trace && (!level || this.isEnabled(level))) {\n\t\t\t\tconsole.trace();\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Shortcut to {@link playtotv.Logger#log}('SPAM', arguments)\n\t\t */\n\t\ts() {\n\t\t\tthis.log('SPAM', arguments);\n\t\t}\n\n\t\t/**\n\t\t * Shortcut to {@link playtotv.Logger#log}('DEBUG', arguments)\n\t\t */\n\t\td() {\n\t\t\tthis.log('DEBUG', arguments);\n\t\t}\n\n\t\t/**\n\t\t * Shortcut to {@link playtotv.Logger#log}('INFO', arguments)\n\t\t */\n\t\ti() {\n\t\t\tthis.log('INFO', arguments);\n\t\t}\n\n\t\t/**\n\t\t * Shortcut to {@link playtotv.Logger#log}('WARNING', arguments)\n\t\t */\n\t\tw() {\n\t\t\tthis.log('WARNING', arguments);\n\t\t}\n\n\t\t/**\n\t\t * Shortcut to {@link playtotv.Logger#log}('ERROR', arguments)\n\t\t */\n\t\te() {\n\t\t\tthis.log('ERROR', arguments);\n\t\t}\n\t}\n\n\t// TODO: Replace by \"static level = ..;\" in class using babel transform-class-properties\n\tObject.assign(Logger, {\n\t\t/** @lends playtotv.Logger.prototype */\n\n\t\t/**\n\t\t * Default Logger level.\n\t\t * Legal values are: SPAM, DEBUG, INFO, WARNING, ERROR, NONE.\n\t\t *\n\t\t * If you specify a logLevel URL parameter then that value will be used as default (e.g: ?logLevel=DEBUG).\n\t\t *\n\t\t * @type string\n\t\t * @default 'INFO'\n\t\t */\n\t\tlevel: urlParams.logLevel || 'INFO',\n\n\t\t/**\n\t\t * Whether to join arguments into a single string before logging to console.\n\t\t * Useful for iOS and Android log implementations that only display the first argument.\n\t\t * Downside is that it does poor string conversion (e.g. you see [object Object]).\n\t\t *\n\t\t * If you specify a truthy logJoin URL parameter then that value will be used as default (e.g: ?logJoin=1).\n\t\t *\n\t\t * @type boolean\n\t\t * @default false\n\t\t */\n\t\tjoin: urlParams.logJoin ? true : false\n\t});\n\n\tptv.Logger = Logger;\n}());\n",
		"playtotv.define('playtotv.analytics.ComScoreAnalytics', [], function() {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar util = ptv.util;\n\n\treturn class ComScoreAnalytics {\n\t\t/** @lends playtotv.analytics.ComScoreAnalytics.prototype */\n\n\t\t/**\n\t\t * ComScore Analytics class.\n\t\t *\n\t\t * This will define window.udm_() as specified by ComScore if it has not been defined already.\n\t\t *\n\t\t * @constructs\n\t\t * @param {Object} options\n\t\t * @param {string} options.url Base UDM log URL\n\t\t *\n\t\t * @property {string} url Base UDM URL\n\t\t */\n\t\tconstructor(config) {\n\t\t\tptv.params(config, {\n\t\t\t\turl: ptv.REQUIRED\n\t\t\t});\n\n\t\t\tthis.url = config.url;\n\n\t\t\tif (!window.udm_) {\n\t\t\t\t// Following is fugly code as specified by ComScore\n\t\t\t\t// Note: it is slightly modified to leak ns_p to window as intended\n\t\t\t\t/*jshint ignore:start*/\n\t\t\t\t/*jscs:disable*/\n\t\t\t\twindow.udm_ = function udm_(e) {var t=\"comScore=\",n=document,r=n.cookie,i=\"\",s=\"indexOf\",o=\"substring\",u=\"length\",a=2048,f,l=\"&ns_\",c=\"&\",h,p,d,v,m=window,g=m.encodeURIComponent||escape;if(r[s](t)+1)for(d=0,p=r.split(\";\"),v=p[u];d<v;d++)h=p[d][s](t),h+1&&(i=c+unescape(p[d][o](h+t[u])));e+=l+\"_t=\"+ +(new Date)+l+\"c=\"+(n.characterSet||n.defaultCharset||\"\")+\"&c8=\"+g(n.title)+i+\"&c7=\"+g(n.URL)+\"&c9=\"+g(n.referrer),e[u]>a&&e[s](c)>0&&(f=e[o](0,a-8).lastIndexOf(c),e=(e[o](0,f)+l+\"cut=\"+g(e[o](f+1)))[o](0,a)),n.images?(h=new Image,m.ns_p||(m.ns_p=h),h.src=e):n.write(\"<\",\"p\",\"><\",'img src=\"',e,'\" height=\"1\" width=\"1\" alt=\"*\"',\"><\",\"/p\",\">\")};\n\t\t\t\t/*jscs:enable*/\n\t\t\t\t/*jshint ignore:end*/\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Calls window.udm_() (Unified Digital Measurement) with this.url and optional tag and params.\n\t\t *\n\t\t * @param {string} [tag=''] Occurrences of '__TAG__' in URL will be replaced by this value\n\t\t * @param {Object} [params={}] Map of parameters to add to URL\n\t\t */\n\t\tudm(tag, params) {\n\t\t\tvar url = this.url.replace(/__TAG__/g, tag || '');\n\t\t\turl = util.addURLParams(url, params || {});\n\t\t\twindow.udm_(url);\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.analytics.GoogleAnalytics', [], function() {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar log = ptv.Logger.get(this.id);\n\n\treturn class GoogleAnalytics {\n\t\t/** @lends playtotv.analytics.GoogleAnalytics.prototype */\n\n\t\t/**\n\t\t * Google Analytics class.\n\t\t *\n\t\t * <ol>\n\t\t * <li>Loads window.ga() if necessary using the standard asynchronous snippet\n\t\t * <li>Creates a tracker with specified fields\n\t\t * <li>If a name is specified then the tracker will be created with and this instance scoped to that name\n\t\t * <li>If setFields are specified then they are set\n\t\t * <li>If requires are specified then they are required\n\t\t * <li>If skipView is not true then immediately calls {@link playtotv.analytics.GoogleAnalytics#sendView}\n\t\t * </ol>\n\t\t *\n\t\t * When fields are passed to setFields or send then if a dimension or metric property is specified\n\t\t * it will be mapped to dimension1, metric1 etc. by the processFields method.\n\t\t * This facilitates use of custom dimensions and metric by making them named\n\t\t * and by facilitating different mappings per GoogleAnalytics instance.\n\t\t *\n\t\t * @see <a href=\"developers.google.com/analytics/devguides/collection/analyticsjs/\">Google Dev Guide</a>\n\t\t * @see <a href=\"developers.google.com/analytics/devguides/collection/analyticsjs/field-reference\">Fields</a>\n\t\t *\n\t\t * @constructs\n\t\t * @param {Object} options\n\t\t * @param {string} options.id Tracker ID\n\t\t * @param {string} [options.name] Tracker name\n\t\t * @param {Object} [options.fields={}] Tracker create fields (cookieDomain, sampleRate, ..)\n\t\t * @param {Object} [options.setFields={}] Tracker set fields (appName, appId, appVersion, ..)\n\t\t * @param {Object} [options.dimensionMap={}] Map of dimension names to indexes\n\t\t * @param {Object} [options.metricMap={}] Map of metric names to indexes\n\t\t * @param {[string]} [options.requires=[]] Array of plugin name strings or argument arrays to require\n\t\t * @param {string} [options.skipView=false] If true then skip sending initial screen or page view\n\t\t *\n\t\t * @property {string} prefix Tracker name prefix to use before method names\n\t\t * @property {string} mode Tracker mode, if setFields.appId was defined then 'app' otherwise 'web'\n\t\t * @property {Object} dimensionMap Map of dimension names to indexes\n\t\t * @property {Object} metricMap Map of metric names to indexes\n\t\t * @property {Promise} trackerPromise Promise of GA tracker reference used by this instance\n\t\t * @property {Object} tracker GA tracker reference used by this instance\n\t\t */\n\t\tconstructor(options) {\n\t\t\tptv.params(options, {\n\t\t\t\tid: ptv.REQUIRED,\n\t\t\t\tname: null,\n\t\t\t\tfields: {},\n\t\t\t\tsetFields: null,\n\t\t\t\tdimensionMap: {},\n\t\t\t\tmetricMap: {},\n\t\t\t\trequires: [],\n\t\t\t\tskipView: false\n\t\t\t});\n\n\t\t\tif (!window.ga) {\n\t\t\t\t/*jshint -W030, -W033, -W069, -W072*/\n\t\t\t\t/*jscs:disable*/\n\t\t\t\t(function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {\n\t\t\t\t(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),\n\t\t\t\tm=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)\n\t\t\t\t})(window,document,'script','//www.google-analytics.com/analytics.js','ga');\n\t\t\t\t/*jscs:enable*/\n\t\t\t}\n\n\t\t\tvar name = options.name;\n\t\t\tvar fields = options.fields;\n\t\t\tvar setFields = options.setFields;\n\t\t\tvar prefix = '';\n\t\t\tif (name) {\n\t\t\t\tprefix = name + '.';\n\t\t\t\tfields.name = name;\n\t\t\t}\n\n\t\t\tthis.prefix = prefix;\n\n\t\t\tthis.mode = setFields && setFields.appId ? 'app' : 'web';\n\t\t\tthis.dimensionMap = options.dimensionMap;\n\t\t\tthis.metricMap = options.metricMap;\n\n\t\t\twindow.ga('create', options.id, fields);\n\n\t\t\tif (setFields) {\n\t\t\t\tthis.setFields(setFields);\n\t\t\t}\n\n\t\t\toptions.requires.forEach(function(args) {\n\t\t\t\targs = [ 'require' ].concat(args);\n\t\t\t\tthis.ga.apply(this, args);\n\t\t\t}.bind(this));\n\n\t\t\t// TODO: Rewrite without use of Promise.defer()\n\t\t\tvar deferred = Promise.defer();\n\t\t\tthis.trackerPromise = deferred.promise;\n\t\t\twindow.ga(function(tracker) {\n\t\t\t\ttracker = name ? window.ga.getByName(name) : tracker;\n\t\t\t\tthis.tracker = tracker;\n\t\t\t\tdeferred.resolve(tracker);\n\t\t\t}.bind(this));\n\n\t\t\tif (!options.skipView) {\n\t\t\t\tthis.sendView();\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Send a view using either sendScreenview (in 'app' mode) or sendPageview.\n\t\t *\n\t\t * @param {string} [name] The name of the view\n\t\t * @param {Object} [fields={}] An object containing one or more field/value pairs\n\t\t * @returns {Promise} Promise that resolves once the tracker has completed sending data\n\t\t */\n\t\tsendView(name, fields) {\n\t\t\tif (this.mode === 'app') {\n\t\t\t\treturn this.sendScreenview(name, fields);\n\t\t\t} else {\n\t\t\t\treturn this.sendPageview(name, null, fields);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Send an error using either sendException (in 'app' mode) or sendEvent.\n\t\t *\n\t\t * The error description is formatted by combining error name, message and location.\n\t\t * Error location is determined by examining error stack or falling back to document location.\n\t\t *\n\t\t * @param {Error} error The error to send\n\t\t * @param {boolean} [isFatal=false] Whether the error was fatal\n\t\t * @param {Object} [fields={}] An object containing one or more field/value pairs\n\t\t * @returns {Promise} Promise that resolves once the tracker has completed sending data\n\t\t */\n\t\tsendError(error, isFatal, fields) {\n\t\t\tfields = fields || {};\n\t\t\tvar loc = ((error.stack || '').match(/[^\\s\\(@]*(:\\d+)+/) || [])[0] || document.location;\n\t\t\tvar description = error.name + ': ' + error.message + ' [' + loc + ']';\n\t\t\tif (this.mode === 'app') {\n\t\t\t\treturn this.sendException(description, isFatal, fields);\n\t\t\t} else {\n\t\t\t\tfields.nonInteraction = true;\n\t\t\t\treturn this.sendEvent(isFatal ? 'fatal' : 'error', description, fields);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Send a pageview.\n\t\t *\n\t\t * @param {string} [page=pathname+search] The page path and query string (must start with a / character)\n\t\t * @param {string} [title=document.title] The title of the page\n\t\t * @param {Object} [fields={}] An object containing one or more field/value pairs\n\t\t * @param {string} [fields.location=protocol+'//'+hostname+pathname+search] URL of the page being tracked\n\t\t * @returns {Promise} Promise that resolves once the tracker has completed sending data\n\t\t */\n\t\tsendPageview(page, title, fields) {\n\t\t\tfields = fields || {};\n\t\t\tif (page) {\n\t\t\t\tfields.page = page;\n\t\t\t}\n\t\t\tif (title) {\n\t\t\t\tfields.title = title;\n\t\t\t}\n\t\t\treturn this.send('pageview', fields);\n\t\t}\n\n\t\t/**\n\t\t * Send an App screenview.\n\t\t *\n\t\t * @param {string} [name] The name of the screen\n\t\t * @param {Object} [fields={}] An object containing one or more field/value pairs\n\t\t * @returns {Promise} Promise that resolves once the tracker has completed sending data\n\t\t */\n\t\tsendScreenview(name, fields) {\n\t\t\tfields = fields || {};\n\t\t\tif (name) {\n\t\t\t\tfields.screenName = name;\n\t\t\t}\n\t\t\treturn this.send('screenview', fields);\n\t\t}\n\n\t\t/**\n\t\t * Send an App exception.\n\t\t *\n\t\t * @param {string} description The description of the exception\n\t\t * @param {boolean} [isFatal=false] Whether the exception was fatal\n\t\t * @param {Object} [fields={}] An object containing one or more field/value pairs\n\t\t * @returns {Promise} Promise that resolves once the tracker has completed sending data\n\t\t */\n\t\tsendException(description, isFatal, fields) {\n\t\t\tfields = fields || {};\n\t\t\tfields.exDescription = description;\n\t\t\tfields.exFatal = isFatal ? true : false;\n\t\t\treturn this.send('exception', fields);\n\t\t}\n\n\t\t/**\n\t\t * Measure amount of milliseconds it takes a promise to resolve and send it as user timing data.\n\t\t *\n\t\t * @param {Promise} promise Promise to time\n\t\t * @param {string} category A string for categorizing all user timing variables into logical groups\n\t\t * @param {string} variable A string to identify the variable being recorded. (e.g. JavaScript Load)\n\t\t * @param {number} value The number of milliseconds in elapsed time to report to Google Analytics\n\t\t * @param {Object} [fields={}] An object containing one or more field/value pairs\n\t\t * @param {string} [fields.timingLabel] Used to add flexibility in visualizing user timings in the reports\n\t\t * @returns {Promise} Original promise to facilitate chaining\n\t\t */\n\t\ttime(promise, category, variable, fields) {\n\t\t\tvar start = Date.now();\n\t\t\tpromise.then(function() {\n\t\t\t\tthis.sendTiming(category, variable, Date.now() - start, fields);\n\t\t\t}.bind(this));\n\t\t\treturn promise;\n\t\t}\n\n\t\t/**\n\t\t * Send user timing data.\n\t\t *\n\t\t * @param {string} category A string for categorizing all user timing variables into logical groups\n\t\t * @param {string} variable A string to identify the variable being recorded. (e.g. JavaScript Load)\n\t\t * @param {number} value The number of milliseconds in elapsed time to report to Google Analytics\n\t\t * @param {Object} [fields={}] An object containing one or more field/value pairs\n\t\t * @param {string} [fields.timingLabel] Used to add flexibility in visualizing user timings in the reports\n\t\t * @returns {Promise} Promise that resolves once the tracker has completed sending data\n\t\t */\n\t\tsendTiming(category, variable, value, fields) {\n\t\t\tfields = fields || {};\n\t\t\tfields.timingCategory = category;\n\t\t\tfields.timingVar = variable;\n\t\t\tfields.timingValue = value;\n\t\t\treturn this.send('timing', fields);\n\t\t}\n\n\t\t/**\n\t\t * Send an event.\n\t\t *\n\t\t * @param {string} category Typically the object that was interacted with (e.g. button)\n\t\t * @param {string} action The type of interaction (e.g. click)\n\t\t * @param {Object} [fields={}] An object containing one or more field/value pairs\n\t\t * @param {string} [fields.eventLabel] Useful for categorizing events (e.g. nav buttons)\n\t\t * @param {number} [fields.eventValue] Values must be non-negative. Useful to pass counts (e.g. 4 times)\n\t\t * @param {boolean} [fields.nonInteraction] Specifies that a hit be considered non-interactive\n\t\t * @returns {Promise} Promise that resolves once the tracker has completed sending data\n\t\t */\n\t\tsendEvent(category, action, fields) {\n\t\t\tfields = fields || {};\n\t\t\tfields.eventCategory = category;\n\t\t\tfields.eventAction = action;\n\t\t\treturn this.send('event', fields);\n\t\t}\n\n\t\t/**\n\t\t * Send a social interaction.\n\t\t *\n\t\t * @param {string} network The network on which the action occurs (e.g. Facebook, Twitter)\n\t\t * @param {string} action The type of action that happens (e.g. Like, Send, Tweet)\n\t\t * @param {string} target Specifies the target of a social interaction (e.g. URL)\n\t\t * @param {Object} [fields={}] An object containing one or more field/value pairs\n\t\t * @returns {Promise} Promise that resolves once the tracker has completed sending data\n\t\t */\n\t\tsendSocial(network, action, target, fields) {\n\t\t\tfields = fields || {};\n\t\t\tfields.socialNetwork = network;\n\t\t\tfields.socialAction = action;\n\t\t\tfields.socialTarget = target;\n\t\t\treturn this.send('social', fields);\n\t\t}\n\n\t\t/**\n\t\t * Returns a Promise of the value currently associated with the given field.\n\t\t *\n\t\t * TODO: Add reverse dimension and metric index mapping support?\n\t\t *\n\t\t * @param {string} fieldName Name of the field to retrieve\n\t\t * @returns {Promise} Promise of the value of the field\n\t\t */\n\t\tget(fieldName) {\n\t\t\treturn this.trackerPromise.then(function(tracker) {\n\t\t\t\treturn tracker.get(fieldName);\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Updates the value currently associated with the given field.\n\t\t *\n\t\t * This delegates to: {@link playtotv.analytics.GoogleAnalytics#setFields}\n\t\t *\n\t\t * @param {string} fieldName Name of the field to set\n\t\t * @param {string|number|Object} value New value to associate with the given field\n\t\t */\n\t\tset(fieldName, value) {\n\t\t\tvar fields = {};\n\t\t\tfields[fieldName] = value;\n\t\t\tthis.setFields(fields);\n\t\t}\n\n\t\t/**\n\t\t * Updates multiple field/value pairs.\n\t\t *\n\t\t * This calls: {@link playtotv.analytics.GoogleAnalytics#processFields} before setting.\n\t\t *\n\t\t * @param {Object} fields An object containing one or more field/value pairs to set\n\t\t */\n\t\tsetFields(fields) {\n\t\t\tfields = this.processFields(fields);\n\t\t\tthis.ga('set', fields);\n\t\t}\n\n\t\t/**\n\t\t * Returns a copy of fields with dimension and metric object properties replaced by\n\t\t * dimension1 and metric1 etc. properties based on dimensionMap and metricMap.\n\t\t *\n\t\t * @param {Object} fields An object containing one or more field/value pairs\n\t\t * @returns {Object} Field object with dimension and metric properties mapped to their indices\n\t\t */\n\t\tprocessFields(fields) {\n\t\t\tvar keys = [ 'dimension', 'metric' ];\n\t\t\tvar processed = ptv.omit(fields, keys);\n\t\t\tkeys.forEach(function(key) {\n\t\t\t\tvar map = this[key + 'Map'];\n\t\t\t\tptv.each(fields[key], function(value, name) {\n\t\t\t\t\tvar index = map[name];\n\t\t\t\t\tif (index) {\n\t\t\t\t\t\tprocessed[key + index] = value;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}, this);\n\t\t\treturn processed;\n\t\t}\n\n\t\t/**\n\t\t * Sends a tracking beacon to Googles collection servers.\n\t\t *\n\t\t * The optional fields object allows users to override one or more field values for this hit only.\n\t\t *\n\t\t * A hitCallback field is automatically added to the fields to resolve the returned data sending Promise.\n\t\t *\n\t\t * This calls: {@link playtotv.analytics.GoogleAnalytics#processFields} before sending.\n\t\t *\n\t\t * @param {string} hitType The type of hit to send (pageview/event/social/timing/..)\n\t\t * @param {Object} [fields={}] An object containing one or more field/value pairs\n\t\t * @returns {Promise} Promise that resolves once the tracker has completed sending data\n\t\t */\n\t\tsend(hitType, fields) {\n\t\t\tfields = this.processFields(fields || {});\n\t\t\t// TODO: Rewrite without use of Promise.defer()\n\t\t\tvar deferred = Promise.defer();\n\t\t\tfields.hitCallback = deferred.resolve;\n\t\t\tthis.ga('send', hitType, fields);\n\t\t\treturn deferred.promise;\n\t\t}\n\n\t\t/**\n\t\t * Prefixes the first argument (method) and then applies arguments to window.ga().\n\t\t */\n\t\tga() {\n\t\t\tvar prefix = this.prefix;\n\t\t\tvar args = Array.from(arguments);\n\t\t\tvar method = args.shift();\n\t\t\tlog.s(prefix + method, args);\n\t\t\targs.unshift(prefix + method);\n\t\t\twindow.ga.apply(window, args);\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.widget.Widget', [], function() {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar event = ptv.event;\n\n\treturn class Widget {\n\t\t/** @lends playtotv.widget.Widget.prototype */\n\n\t\t/**\n\t\t * Widget Prototype, used as a super class to create specific widgets from.\n\t\t *\n\t\t * @constructs\n\t\t * @param {Node} node Node this widget is being instantiated on\n\t\t *\n\t\t * @property {Node} node Widget node\n\t\t * @property {Array} eventListeners Array of event listeners to automatically remove on dispose\n\t\t * @property {Array} subscriptionRecords Array of subscription records to automatically unsubscribe on dispose\n\t\t * @property {Array} timeoutIds Array of timeout id's to automatically remove on dispose\n\t\t */\n\t\tconstructor(node) {\n\t\t\tthis.node = node;\n\t\t\tthis.eventListeners = [];\n\t\t\tthis.subscriptionRecords = [];\n\t\t\tthis.timeoutIds = [];\n\t\t}\n\n\t\t/**\n\t\t * Returns the node represented by this widget instance\n\t\t *\n\t\t * @returns {Node} node\n\t\t */\n\t\tgetNode() {\n\t\t\treturn this.node;\n\t\t}\n\n\t\t/**\n\t\t * Adds an event listener of the given type to a Node and returns an {@link playtotv.event.EventListener} for\n\t\t * removal with {@link playtotv.widget.Widget#removeEventListener}. Listeners are added to the instance's\n\t\t * {@link playtotv.widget.Widget#eventListeners} array for automatic removal when widgets are disposed by\n\t\t * {@link playtotv.widget.Widget#dispose}.\n\t\t *\n\t\t * @param {Node} node Node to listen to\n\t\t * @param {string} type Type of events to listen to\n\t\t * @param {Function} listener Listener function to call on event\n\t\t * @returns {playtotv.event.EventListener} Object with node, type and listener references\n\t\t */\n\t\taddEventListener(node, type, listener) {\n\t\t\tvar eventListener = event.addListener(node, type, listener);\n\t\t\tthis.eventListeners.push(eventListener);\n\t\t\treturn eventListener;\n\t\t}\n\n\t\t/**\n\t\t * Removes an {@link playtotv.event.EventListener} listener from this widget provided it was added and\n\t\t * returned by {@link playtotv.widget.Widget#addEventListener}\n\t\t *\n\t\t * @param {playtotv.event.EventListener} eventListener\n\t\t * @returns {boolean} True if listener was successfully removed\n\t\t */\n\t\tremoveEventListener(eventListener) {\n\t\t\tvar eventListeners = this.eventListeners;\n\t\t\tvar index = eventListeners.indexOf(eventListener);\n\t\t\tvar found = index >= 0;\n\t\t\tif (found) {\n\t\t\t\tevent.removeListener(eventListener);\n\t\t\t\teventListeners.splice(index, 1);\n\t\t\t}\n\t\t\treturn found;\n\t\t}\n\n\t\t/**\n\t\t * Subscribe and add pubsub subscription record for automatic unsubscription on dispose.\n\t\t *\n\t\t * Note: All arguments beyond the first (e.g: selector and handler) are passed to the call made to\n\t\t * {@link playtotv.pubsub.PubSub#subscribe}, so calls like {@link playtotv.model.AbstractModel#subscribe}\n\t\t * with extra arguments can also be made through this.\n\t\t *\n\t\t * @param {playtotv.pubsub.PubSub} pubsub PubSub to subscribe to\n\t\t * @param {string} selector\n\t\t * @param {Function} handler\n\t\t * @returns {Object} Subscription record object with pubsub and subscription references\n\t\t */\n\t\tsubscribe(pubsub) {\n\t\t\tvar args = Array.from(arguments).slice(1);\n\t\t\tvar record = {\n\t\t\t\tpubsub: pubsub,\n\t\t\t\tsubscription: pubsub.subscribe.apply(pubsub, args)\n\t\t\t};\n\t\t\tthis.subscriptionRecords.push(record);\n\t\t\treturn record;\n\t\t}\n\n\t\t/**\n\t\t * Unsubscribe and remove pubsub subscription.\n\t\t *\n\t\t * @param {Object} record Object with pubsub and subscription references\n\t\t * @returns {boolean} True if subscription was successfully removed\n\t\t */\n\t\tunsubscribe(record) {\n\t\t\tvar records = this.subscriptionRecords;\n\t\t\tvar index = records ? records.lastIndexOf(record) : -1;\n\t\t\tif (index === -1) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\trecords.splice(index, 1);\n\t\t\trecord.pubsub.unsubscribe(record.subscription);\n\t\t\tdelete record.pubsub;\n\t\t\tdelete record.subscription;\n\t\t\treturn true;\n\t\t}\n\n\t\t/**\n\t\t * Set a timeout for callback to called and remember the id for automatic clearing on dispose.\n\t\t *\n\t\t * @param {Function} callback Function to call\n\t\t * @param {number} ms Time in ms after which to call callback\n\t\t * @returns {number} Timeout id\n\t\t */\n\t\tsetTimeout(callback, ms) {\n\t\t\tvar id = setTimeout(callback, ms);\n\t\t\tthis.timeoutIds.push(id);\n\t\t\treturn id;\n\t\t}\n\n\t\t/**\n\t\t * Clear and remove timeout id.\n\t\t *\n\t\t * @param {number} id Object with pubsub and subscription references\n\t\t * @returns {boolean} True if subscription was successfully removed\n\t\t */\n\t\tclearTimeout(id) {\n\t\t\tvar timeoutIds = this.timeoutIds;\n\t\t\tvar index = timeoutIds.indexOf(id);\n\t\t\tvar found = index >= 0;\n\t\t\tif (found) {\n\t\t\t\tclearTimeout(id);\n\t\t\t\ttimeoutIds.splice(index, 1);\n\t\t\t}\n\t\t\treturn found;\n\t\t}\n\n\t\t/**\n\t\t * If a widget is created by a {@link playtotv.widget.WidgetManager} then the dispose method is called\n\t\t * before the widget's containing node is removed from the DOM. Dispose may be used to clean up event\n\t\t * listeners, and/or any other references that could potentially lead to memory leaks etc.\n\t\t *\n\t\t * This cleans up all event listeners, subscriptions and timeouts added by\n\t\t * {@link playtotv.widget.Widget#addEventListener}, {@link playtotv.widget.Widget#subscribe} and\n\t\t * {@link playtotv.widget.Widget#setTimeout}.\n\t\t */\n\t\tdispose() {\n\t\t\tthis.eventListeners.forEach(event.removeListener);\n\n\t\t\tthis.subscriptionRecords.forEach(function(record) {\n\t\t\t\trecord.pubsub.unsubscribe(record.subscription);\n\t\t\t\tdelete record.pubsub;\n\t\t\t\tdelete record.subscription;\n\t\t\t});\n\n\t\t\tthis.timeoutIds.forEach(clearTimeout);\n\n\t\t\tptv.dispose(this);\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.analytics.AnalyticsWidget', [\n\t'playtotv.widget.Widget'\n], function(\n\tWidget\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\n\t/**\n\t * Widget facilitating tracking of node insertion, and events through an AnalyticsController.\n\t *\n\t * Option values are split by separator (e.g: comma) in arguments (e.g: category, action, label).\n\t * Type of logging is equal to the option key or in case of key \"event\" to the first argument.\n\t * The action argument is optional and will default to type.\n\t * The label argument is optional and will default to undefined.\n\t *\n\t * Note: You will need to ensure that category, action and label values do not match the separator!\n\t *\n\t * @example\n\t * <span {{widgets (widget \"analytics-track\" view=\"question\")}}></span>\n\t * <div {{widgets (widget \"analytics-track\" load=\"banner\")}}> ..banner.. </div>\n\t * <div {{widgets (widget \"analytics-track\" click=\"answer\")}}> ..answer.. </div>\n\t * <form {{widgets (widget \"analytics-track\" submit=\"profile, update, avatar\")}}>..</form>\n\t * <input {{widgets (widget \"analytics-track\" change=\"rating\")}}>\n\t * <div {{widgets (widget \"analytics-track\" event=\"eventType, category, action, label\")}}>..</div>\n\t *\n\t * @extends playtotv.widget.Widget\n\t * @param {Node} node Widget node\n\t * @param {Object} options Widget options\n\t * @param {playtotv.analytics.AnalyticsController} options.controller AnalyticsController instance to use\n\t * @param {RegExp} [options.nonInteraction=/view|load/] Matching types are considered not to be interactions\n\t * @param {RegExp} [options.separator=/,\\s+/] Option value separator\n\t * @param {string} [options.view=''] \"[name]\" controller.view()\n\t * @param {string} [options.load=''] \"[category], [action], [label]\" controller.event() on load\n\t * @param {string} [options.click=''] \"[category], [action], [label]\" controller.event() on click events\n\t * @param {string} [options.submit=''] \"[category], [action], [label]\" controller.event() on submit events\n\t * @param {string} [options.change=''] \"[category], [action], [label]\" controller.event() on change events\n\t * @param {string} [options.event=''] \"[type], [category], [action], [label]\" controller.event() on type events\n\t */\n\treturn class AnalyticsWidget extends Widget {\n\n\t\tconstructor(node, options) {\n\t\t\toptions = ptv.params(options, {\n\t\t\t\tapp: null,\n\t\t\t\tcontroller: ptv.REQUIRED,\n\t\t\t\tnonInteraction: /view|load/,\n\t\t\t\tseparator: /,\\s+/,\n\t\t\t\tview: '',\n\t\t\t\tload: '',\n\t\t\t\tclick: '',\n\t\t\t\tsubmit: '',\n\t\t\t\tchange: '',\n\t\t\t\tevent: ''\n\t\t\t});\n\n\t\t\tvar controller = options.controller;\n\t\t\tvar nonInteractionRE = options.nonInteraction;\n\t\t\tvar separator = options.separator;\n\n\t\t\tsuper(node);\n\n\t\t\tvar eventOptions = ptv.omit(options, [ 'controller', 'nonInteraction', 'separator' ]);\n\t\t\tptv.each(eventOptions, (value, key) => {\n\t\t\t\tif (!value) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar parts = value.split(separator);\n\t\t\t\tvar type = key === 'event' ? parts.shift() : key;\n\t\t\t\tvar nonInteraction = nonInteractionRE.test(type);\n\n\t\t\t\tif (type === 'view') {\n\t\t\t\t\tcontroller.view(value, { nonInteraction: nonInteraction });\n\t\t\t\t} else {\n\t\t\t\t\tvar onEvent = function() {\n\t\t\t\t\t\tcontroller.event(parts[0], parts[1] || type, {\n\t\t\t\t\t\t\teventLabel: parts[2],\n\t\t\t\t\t\t\tnonInteraction: nonInteraction\n\t\t\t\t\t\t});\n\t\t\t\t\t};\n\t\t\t\t\tif (type === 'load') {\n\t\t\t\t\t\tonEvent();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.addEventListener(node, type, onEvent);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.animationFrame', [], function() {\n\n\t'use strict';\n\n\t// Abort if we are not running in a browser (e.g: in Node)\n\tif (typeof window === 'undefined') {\n\t\treturn;\n\t}\n\n\tvar request = window.requestAnimationFrame;\n\tvar cancel = window.cancelAnimationFrame;\n\n\tvar vendors = [ 'webkit', 'moz', 'ms', 'o' ];\n\tvar i, vendor, l = vendors.length;\n\tfor (i = 0; i < l && !request; i++) {\n\t\tvendor = vendors[i];\n\t\trequest = window[vendor + 'RequestAnimationFrame'];\n\t\tcancel = window[vendor + 'CancelAnimationFrame'] || window[vendor + 'CancelRequestAnimationFrame'];\n\t}\n\n\tvar callTime = 0;\n\n\trequest = request ? request.bind(window) : function(callback) {\n\t\tvar time = Date.now();\n\t\tvar delay = Math.max(0, 16 - (time - callTime));\n\n\t\tcallTime = time + delay;\n\t\treturn setTimeout(function() {\n\t\t\tcallback(callTime);\n\t\t}, delay);\n\t};\n\n\tcancel = cancel ? cancel.bind(window) : function(id) {\n\t\tclearTimeout(id);\n\t};\n\n\t/**\n\t * This module facilitates working with requestAnimationFrame, providing a 'shim' if necessary, but without\n\t * actually shimming window.requestAnimationFrame as that might have some averse side effects when combined with\n\t * other libraries.\n\t *\n\t * @name animationFrame\n\t * @memberOf playtotv\n\t * @namespace\n\t */\n\n\treturn /** @lends playtotv.animationFrame */ {\n\n\t\t/**\n\t\t * Either window.requestAnimationFrame, a vendor prefixed version or a shim.\n\t\t *\n\t\t * @function\n\t\t * @param {Function} callback\n\t\t * @returns {number} id\n\t\t */\n\t\trequest: request,\n\n\t\t/**\n\t\t * Either window.cancelAnimationFrame, a vendor prefixed version or a shim.\n\t\t *\n\t\t * @function\n\t\t * @param {number} id\n\t\t */\n\t\tcancel: cancel\n\t};\n});\n",
		"playtotv.define('playtotv.cookie', [], function() {\n\n\t'use strict';\n\n\t/**\n\t * Sets, gets or deletes cookies\n\t *\n\t * @name cookie\n\t * @namespace Cookie module. Sets, gets or deletes cookies\n\t * @memberOf playtotv\n\t */\n\tvar cookie = {\n\n\t\t/** @lends playtotv.cookie */\n\n\t\t/**\n\t\t * Gets a cookie value by name\n\t\t *\n\t\t * @param {string} name\n\t\t */\n\t\tget: function(name) {\n\t\t\tvar nameEQ = name + '=';\n\t\t\tvar ca = document.cookie.split(';');\n\n\t\t\tvar i, l = ca.length;\n\t\t\tfor (i = 0; i < l; i++) {\n\t\t\t\tvar c = ca[i];\n\t\t\t\twhile (c.charAt(0) === ' ') {\n\t\t\t\t\tc = c.substring(1, c.length);\n\t\t\t\t}\n\t\t\t\tif (c.indexOf(nameEQ) === 0) {\n\t\t\t\t\treturn c.substring(nameEQ.length, c.length);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn null;\n\t\t},\n\n\t\t/**\n\t\t * Sets a cookie\n\t\t *\n\t\t * @param {string} name\n\t\t * @param {string} value\n\t\t * @param {number} days to expire\n\t\t */\n\t\tset: function(name, value, days) {\n\t\t\tvar expires = '';\n\t\t\tif (days) {\n\t\t\t\tvar date = new Date();\n\t\t\t\tdate.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));\n\t\t\t\texpires = '; expires=' + date.toGMTString();\n\t\t\t}\n\t\t\tdocument.cookie = name + '=' + value + expires + '; path=/';\n\t\t},\n\n\t\t/**\n\t\t * Erases a cookie by name\n\t\t *\n\t\t * @param {string} name\n\t\t */\n\t\tremove: function(name) {\n\t\t\tthis.set(name, '', -1);\n\t\t}\n\t};\n\n\treturn cookie;\n});\n",
		"playtotv.define('playtotv.cron', [], function() {\n\n\t'use strict';\n\n\tvar log = playtotv.Logger.get(this.id);\n\n\tvar tickTimeout = null;\n\tvar tick;\n\tvar jobs = {};\n\tvar timeoutJobs = {};\n\tvar promisedJobs = {};\n\tvar id = 1;\n\n\tfunction now() {\n\t\treturn Date.now();\n\t}\n\n\tfunction labelledLog(msg, job) {\n\t\tif (!job.quiet) {\n\t\t\tlog.s('job #' + job.id + ' \"' + job.label + '\": ' + msg);\n\t\t}\n\t}\n\n\tfunction repeat(job) {\n\t\tlabelledLog('Scheduling repeat @ ' + job.time, job);\n\t\tjob.timeout = undefined;\n\t\tjob.time = now() + job.repeat;\n\t\tjobs[job.id] = job;\n\t\tif (!tickTimeout) {\n\t\t\ttick();\n\t\t}\n\t}\n\n\tfunction exec(id) {\n\t\tvar job;\n\t\tif ((job = timeoutJobs[id]) !== undefined) {\n\t\t\tdelete timeoutJobs[id];\n\t\t} else if ((job = jobs[id]) !== undefined) {\n\t\t\tdelete jobs[id];\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\n\t\tvar _now = now();\n\t\tvar delta = job.time - _now;\n\t\tdelta = delta < 0 ? delta : '+' + delta;\n\t\tlabelledLog('Executing @ ' + _now + ' (' + delta + 'ms)', job);\n\n\t\tpromisedJobs[id] = job;\n\t\tvar returnValueOrPromise = job.func.apply(job.context, job.args);\n\t\tPromise.resolve(returnValueOrPromise).then(function(returnValue) {\n\t\t\tif (promisedJobs[id]) { // ensure job still exists (e.g. has not been cancelled)\n\t\t\t\tdelete promisedJobs[id];\n\t\t\t\tif (job.repeat > 0 && returnValue !== false) {\n\t\t\t\t\trepeat(job);\n\t\t\t\t}\n\t\t\t}\n\t\t}, function() {\n\t\t\tdelete promisedJobs[id];\n\t\t});\n\t}\n\n\tfunction process(id) {\n\t\tvar job = jobs[id];\n\t\tif (!job) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar timeLeft = job.time - now();\n\n\t\tif (timeLeft <= 0) {\n\t\t\texec(id);\n\t\t} else if (timeLeft < cron.tickInterval) {\n\t\t\tdelete jobs[id];\n\t\t\ttimeoutJobs[id] = job;\n\t\t\tjob.timeout = setTimeout(function() {\n\t\t\t\texec(id);\n\t\t\t}, timeLeft);\n\t\t} // else execute in a future tick\n\t}\n\n\ttick = function() {\n\t\tif (tickTimeout) {\n\t\t\tclearTimeout(tickTimeout);\n\t\t\ttickTimeout = null;\n\t\t}\n\n\t\t// TODO: process jobs in order of job.time and then id\n\t\tObject.keys(jobs).forEach(process);\n\n\t\t// must check again, process deletes keys\n\t\tif (Object.keys(jobs).length > 0) {\n\t\t\ttickTimeout = setTimeout(tick, cron.tickInterval);\n\t\t}\n\t};\n\n\tfunction at(time, func, options) {\n\t\toptions = Object.assign({\n\t\t\tcontext: func,\n\t\t\targs: [],\n\t\t\trepeat: 0, // repeat job after specified amount of ms (cancel job to stop repeating)\n\t\t\tlabel: 'unlabeled', // to facilitate debugging\n\t\t\tquiet: false\n\t\t}, options);\n\n\t\tvar job = Object.assign({\n\t\t\tid: id,\n\t\t\ttime: time,\n\t\t\tfunc: func\n\t\t}, options);\n\n\t\tjobs[id++] = job;\n\t\tlog.s('at(): #' + job.id + ' \"' + job.label + '\"', job);\n\n\t\tif (options.repeat > 0 && options.repeat < cron.tickInterval) {\n\t\t\tcron.tickInterval = options.repeat;\n\t\t\tlog.d('Setting tick interval to ' + cron.tickInterval + ' to keep up with job #' + job.id + ' (' +\n\t\t\t\tjob.label + ')');\n\t\t}\n\n\t\t// Process as soon as possible, but still asynchronously (do not wait for next scheduled timeout)\n\t\tnextTick(tick);\n\n\t\treturn job.id;\n\t}\n\n\tfunction get(id) {\n\t\treturn jobs[id] || timeoutJobs[id] || promisedJobs[id];\n\t}\n\n\tfunction cancel(id) {\n\t\tvar job;\n\t\tif ((job = timeoutJobs[id]) !== undefined) {\n\t\t\tclearTimeout(job.timeout);\n\t\t\tdelete timeoutJobs[id];\n\t\t} else if ((job = promisedJobs[id]) !== undefined) {\n\t\t\tdelete promisedJobs[id];\n\t\t} else if ((job = jobs[id]) !== undefined) {\n\t\t\tdelete jobs[id];\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t\tlabelledLog('Cancelled', job);\n\t\treturn true;\n\t}\n\n\tfunction halt() {\n\t\tif (tickTimeout) {\n\t\t\tlog.s('Halting..');\n\n\t\t\tObject.keys(jobs).forEach(cancel);\n\t\t\tObject.keys(timeoutJobs).forEach(cancel);\n\t\t\tObject.keys(promisedJobs).forEach(cancel);\n\n\t\t\tclearTimeout(tickTimeout);\n\t\t\ttickTimeout = null;\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tvar cron = {\n\t\ttickInterval: 1000, // subject to change\n\t\tat: at,\n\t\tget: get,\n\t\tcancel: cancel,\n\t\thalt: halt,\n\t\tdebug: { // exposed for debugging purposes, do not abuse\n\t\t\tjobs: jobs,\n\t\t\ttimeoutJobs: timeoutJobs,\n\t\t\tpromisedJobs: promisedJobs\n\t\t}\n\t};\n\n\treturn cron;\n});\n",
		"playtotv.define('playtotv.css.Vector', [], function() {\n\n\t'use strict';\n\n\t/**\n\t * Shorthands\n\t *\n\t */\n\n\tvar _min = Math.min;\n\tvar _max = Math.max;\n\tvar _sqrt = Math.sqrt;\n\n\t/**\n\t * 2D Vector\n\t *\n\t * @name playtotv.css.Vector\n\t * @class\n\t * @constructor\n\t * @param {number} x\n\t * @param {number} y\n\t */\n\tclass Vector {\n\t\tconstructor(x, y) {\n\t\t\tthis.x = x;\n\t\t\tthis.y = y;\n\t\t}\n\n\t\t/** @lends playtotv.css.Vector.prototype */\n\n\t\t/**\n\t\t * Adds a vector and returns the result.\n\t\t *\n\t\t * @param {playtotv.css.Vector} vector\n\t\t * @returns {playtotv.css.Vector} result\n\t\t */\n\t\tadd(v) {\n\t\t\treturn new Vector(this.x + v.x, this.y + v.y);\n\t\t}\n\n\t\t/**\n\t\t * Subtracts a vector and returns the result.\n\t\t *\n\t\t * @param {playtotv.css.Vector} vector\n\t\t * @returns {playtotv.css.Vector} result\n\t\t */\n\t\tsubtract(v) {\n\t\t\treturn new Vector(this.x - v.x, this.y - v.y);\n\t\t}\n\n\t\t/**\n\t\t * Multiplies with a vector and returns the result.\n\t\t *\n\t\t * @param {playtotv.css.Vector} vector\n\t\t * @returns {playtotv.css.Vector} result\n\t\t */\n\t\tmultiply(v) {\n\t\t\treturn new Vector(this.x * v.x, this.y * v.y);\n\t\t}\n\n\t\t/**\n\t\t * Returns a vector multiplied by a single number\n\t\t *\n\t\t * @param {number} value\n\t\t */\n\t\tmultiplyBy(n) {\n\t\t\treturn new Vector(this.x * n, this.y * n);\n\t\t}\n\n\t\t/**\n\t\t * Divides by a vector and returns the result.\n\t\t *\n\t\t * @param {playtotv.css.Vector} vector\n\t\t * @returns {playtotv.css.Vector} result\n\t\t */\n\t\tdivide(v) {\n\t\t\treturn new Vector(this.x / v.x, this.y / v.y);\n\t\t}\n\n\t\t/**\n\t\t * Returns a vector divided by a single number\n\t\t *\n\t\t * @param {playtotv.css.Vector} vector\n\t\t * @returns {playtotv.css.Vector} result\n\t\t */\n\t\tdivideBy(n) {\n\t\t\treturn new Vector(this.x / n, this.y / n);\n\t\t}\n\n\t\t/**\n\t\t * Returns the dot product with another vector\n\t\t *\n\t\t * @param {playtotv.css.Vector} vector\n\t\t * @returns {Float} dot\n\t\t */\n\t\tdot(b) {\n\t\t\tvar d = this.multiply(b);\n\t\t\treturn (d.x + d.y);\n\t\t}\n\n\t\t/**\n\t\t * Returns the vector's magnitude\n\t\t *\n\t\t * @param {playtotv.css.Vector} vector\n\t\t * @returns {Float} magnitude\n\t\t */\n\t\tmagnitude() {\n\t\t\tvar x = this.x;\n\t\t\tvar y = this.y;\n\t\t\treturn _sqrt(x * x + y * y);\n\t\t}\n\n\t\t/**\n\t\t * Returns a normalized version of this vector\n\t\t *\n\t\t * @param {playtotv.css.Vector} vector\n\t\t * @returns {playtotv.css.Vector} result\n\t\t */\n\t\tnormalize() {\n\t\t\tvar m = this.magnitude();\n\t\t\treturn new Vector(this.x / m, this.y / m);\n\t\t}\n\n\t\t/**\n\t\t * Returns the inversed version of this vector\n\t\t *\n\t\t */\n\t\tinverse() {\n\t\t\treturn new Vector(-this.x, -this.y);\n\t\t}\n\n\t\t/**\n\t\t * Returns modulo result with another vector\n\t\t *\n\t\t * @param {playtotv.css.Vector} vector\n\t\t * @returns {playtotv.css.Vector} result\n\t\t */\n\t\tmodulo(v) {\n\t\t\treturn new Vector(\n\t\t\t\tv.x ? this.x % v.x : this.x,\n\t\t\t\tv.y ? this.y % v.y : this.y\n\t\t\t);\n\t\t}\n\n\t\t/**\n\t\t * Indicates whether a vector exceeds another one (in any 1 direction)\n\t\t *\n\t\t * @param {playtotv.css.Vector} vector\n\t\t * @returns {boolean} result\n\t\t */\n\t\texceeds(v) {\n\t\t\treturn this.x > v.x || this.y > v.y || false;\n\t\t}\n\n\t\t/**\n\t\t * Returns a vector with the smallest x and y values\n\t\t *\n\t\t * @param {playtotv.css.Vector} vector\n\t\t * @returns {playtotv.css.Vector} result\n\t\t */\n\t\tmin(v) {\n\t\t\treturn new Vector(\n\t\t\t\t_min(this.x, v.x),\n\t\t\t\t_min(this.y, v.y)\n\t\t\t);\n\t\t}\n\n\t\t/**\n\t\t * Returns a vector with the largest x and y values\n\t\t *\n\t\t * @param {playtotv.css.Vector} vector\n\t\t * @returns {playtotv.css.Vector} result\n\t\t */\n\t\tmax(v) {\n\t\t\treturn new Vector(\n\t\t\t\t_max(this.x, v.x),\n\t\t\t\t_max(this.y, v.y)\n\t\t\t);\n\t\t}\n\n\t\t/**\n\t\t * Limits a vector to x and y values that are within the given minimal and maximal boundary vectors.\n\t\t *\n\t\t * @param {playtotv.css.Vector} min\n\t\t * @param {playtotv.css.Vector} max\n\t\t * @returns {playtotv.css.Vector} limited\n\t\t */\n\t\tlimit(min, max) {\n\t\t\t// return this.max(min).min(max); // creates 2 Vector instances\n\t\t\treturn new Vector(\n\t\t\t\t_min(_max(this.x, min.x), max.x),\n\t\t\t\t_min(_max(this.y, min.y), max.y)\n\t\t\t);\n\t\t}\n\n\t\t/**\n\t\t * Returns a comma separated string of the vector's x and y properties. An optional unit\n\t\t * type may be given (px, %, etc), which defaults to px for CSS purposes.\n\t\t *\n\t\t * @param {string} [unit='px']\n\t\t * @returns {string} position\n\t\t */\n\t\ttoString(unit) {\n\t\t\tunit = unit || 'px';\n\t\t\treturn this.x + unit + ',' + this.y + unit;\n\t\t}\n\t}\n\n\t// static Vector members\n\tObject.assign(Vector, {\n\n\t\t/** @lends playtotv.css.Vector */\n\n\t\t/**\n\t\t * @property\n\t\t * @type number\n\t\t */\n\t\tFREE: 0,\n\n\t\t/**\n\t\t * @property\n\t\t * @type number\n\t\t */\n\t\tVERTICAL: 1,\n\n\t\t/**\n\t\t * @property\n\t\t * @type number\n\t\t */\n\t\tHORIZONTAL: 2,\n\n\t\t/**\n\t\t * @property\n\t\t * @type number\n\t\t */\n\t\tUP: 3,\n\n\t\t/**\n\t\t * @property\n\t\t * @type number\n\t\t */\n\t\tRIGHT: 4,\n\n\t\t/**\n\t\t * @property\n\t\t * @type number\n\t\t */\n\t\tDOWN: 5,\n\n\t\t/**\n\t\t * @property\n\t\t * @type number\n\t\t */\n\t\tLEFT: 6,\n\n\t\t/**\n\t\t * Zero vector\n\t\t * @property\n\t\t * @type Vector\n\t\t */\n\t\tZERO: new Vector(0, 0),\n\n\t\t/**\n\t\t * Parses values into a Vector. Uses x for y when not specified.\n\t\t *\n\t\t * @static\n\t\t * @param {string|number} x\n\t\t * @param {string|number} [y]\n\t\t * @returns {playtotv.css.Vector} vector\n\t\t */\n\t\tparseFloat: function(x, y) {\n\t\t\tx = parseFloat(x);\n\t\t\ty = arguments.length < 2 ? x : parseFloat(y);\n\t\t\treturn new Vector(x, y);\n\t\t}\n\t});\n\n\treturn Vector;\n});\n",
		"playtotv.define('playtotv.css.Point', [\n\t'playtotv.css.Vector'\n], function(\n\tVector\n) {\n\n\t'use strict';\n\n\t/**\n\t * 3D point, as returned by {@link playtotv.css.Matrix#transformPoint}.\n\t *\n\t * @name playtotv.css.Point\n\t * @class\n\t * @constructor\n\t * @param {number} x\n\t * @param {number} y\n\t * @param {number} z\n\t */\n\tclass Point {\n\t\tconstructor(x, y, z) {\n\t\t\tthis.x = x;\n\t\t\tthis.y = y;\n\t\t\tthis.z = z;\n\t\t}\n\n\t\t/** @lends playtotv.css.Point.prototype */\n\n\t\t/**\n\t\t * Returns a 2D vector representation of this point, discarding the z.\n\t\t *\n\t\t * @returns {playtotv.css.Vector} vector\n\t\t */\n\t\ttoVector() {\n\t\t\treturn new Vector(this.x, this.y);\n\t\t}\n\t}\n\n\t/**\n\t * Parses values into a point. Uses x for y and/or z when not specified.\n\t *\n\t * @static\n\t * @function\n\t * @name parseFloat\n\t * @memberOf playtotv.css.Point\n\t * @param {string|number} x\n\t * @param {string|number} [y]\n\t * @param {string|number} [z]\n\t * @returns {playtotv.css.Point} point\n\t */\n\tPoint.parseFloat = function(x, y, z) {\n\t\tx = parseFloat(x);\n\t\ty = arguments.length < 2 ? x : parseFloat(y);\n\t\tz = arguments.length < 3 ? x : parseFloat(z);\n\t\treturn new Point(x, y, z);\n\t};\n\n\treturn Point;\n});\n",
		"playtotv.define('playtotv.css.Matrix', [\n\t'playtotv.css.Point'\n], function(\n\tPoint\n) {\n\n\t'use strict';\n\n\tvar IDENTITY = [\n\t\t1, 0, 0, 0,\n\t\t0, 1, 0, 0,\n\t\t0, 0, 1, 0,\n\t\t0, 0, 0, 1\n\t];\n\n\tvar entityMap = 'm11,m12,m13,m14,m21,m22,m23,m24,m31,m32,m33,m34,m41,m42,m43,m44'.split(',');\n\n\tvar regMatrix = /matrix3?d?\\(([^\\)]+)\\)/;\n\tfunction parseCSSMatrix(matrix) {\n\t\treturn regMatrix.test(matrix) ?\n\t\t\tregMatrix.exec(matrix)[1].split(',').map(parseFloat) : IDENTITY;\n\t}\n\n\t/**\n\t * CSS compatible 4x4 matrix, similar to the native WebKitCSSMatrix. Accepts a CSS transform string or entity\n\t * Array of a 6 or 16 entity matrix. If no value is given, an identity matrix is returned. The 2D matrix entities\n\t * are exposed as instance properties .a through .f, and the 3D entities as .m11 through .m44.\n\t *\n\t * @name playtotv.css.Matrix\n\t * @class\n\t * @constructor\n\t * @param {string|Array} [transform]\n\t */\n\treturn class Matrix {\n\t\tconstructor(matrix) {\n\t\t\tthis.setMatrixValue(matrix);\n\t\t}\n\n\t\t/** @lends playtotv.css.Matrix.prototype */\n\n\t\t/**\n\t\t * Sets the matrix value. Accepts a CSS transform string or entity Array of a 6 or 16 entity matrix.\n\t\t *\n\t\t * @param {string|Array} [transform]\n\t\t */\n\t\tsetMatrixValue(matrix) {\n\t\t\tvar m = (typeof matrix === 'string') ? parseCSSMatrix(matrix) : (matrix || IDENTITY);\n\t\t\tif (!(m instanceof Array)) {\n\t\t\t\tthrow new Error('Failed to parse ' + matrix);\n\t\t\t}\n\n\t\t\tthis.entities = m = (m.length === 6) ?\n\t\t\t\t[ m[0], m[1], 0, 0, m[2], m[3], 0, 0, 0, 0, 1, 0, m[4], m[5], 0, 1 ] : m;\n\n\t\t\t// 4x4 references\n\t\t\tentityMap.forEach(function(key, index) {\n\t\t\t\tthis[key] = m[index];\n\t\t\t}, this);\n\n\t\t\t// 2x2+2 references\n\t\t\tthis.a = this.m11;\n\t\t\tthis.b = this.m12;\n\t\t\tthis.c = this.m21;\n\t\t\tthis.d = this.m22;\n\t\t\tthis.e = this.m41;\n\t\t\tthis.f = this.m42;\n\t\t}\n\n\t\t/**\n\t\t * Returns the result of multiplying this matrix with the given one.\n\t\t *\n\t\t * @param {playtotv.css.Matrix} matrix\n\t\t * @returns {playtotv.css.Matrix} result\n\t\t */\n\t\tmultiply(matrix) {\n\t\t\tvar a = this.entities;\n\t\t\tvar b = (matrix instanceof Array) ? matrix : matrix.entities;\n\t\t\tvar i, j, k, m, entities = [];\n\t\t\tfor (i = 0; i < 4; i++) {\n\t\t\t\tfor (j = 0; j < 4; j++) {\n\t\t\t\t\tm = 0;\n\t\t\t\t\tfor (k = 0; k < 4; k++) {\n\t\t\t\t\t\tm += a[i * 4 + k] * b[k * 4 + j];\n\t\t\t\t\t}\n\t\t\t\t\tentities[i * 4 + j] = m;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn new Matrix(entities);\n\t\t}\n\n\t\t/**\n\t\t * Returns the result of translating this matrix over the given vector.\n\t\t *\n\t\t * @param {playtotv.css.Point|playtotv.css.Vector} translate\n\t\t * @returns {playtotv.css.Matrix} translated\n\t\t */\n\t\ttranslate(translate) {\n\t\t\tvar x = translate.x;\n\t\t\tvar y = translate.y;\n\t\t\tvar z = translate.z || 0;\n\t\t\treturn this.multiply([\n\t\t\t\t1, 0, 0, 0,\n\t\t\t\t0, 1, 0, 0,\n\t\t\t\t0, 0, 1, 0,\n\t\t\t\tx, y, z, 1\n\t\t\t]);\n\t\t}\n\n\t\t/**\n\t\t * Returns the result of scaling this matrix by the given number or vector.\n\t\t *\n\t\t * @param {number|playtotv.css.Point|playtotv.css.Vector} scale\n\t\t * @returns {playtotv.css.Matrix} result\n\t\t */\n\t\tscale(scale) {\n\t\t\tif (typeof scale === 'number') {\n\t\t\t\tscale = Point.parseFloat(scale);\n\t\t\t}\n\n\t\t\tvar x = scale.x;\n\t\t\tvar y = scale.y;\n\t\t\tvar z = scale.z || 1;\n\t\t\treturn this.multiply([\n\t\t\t\tx, 0, 0, 0,\n\t\t\t\t0, y, 0, 0,\n\t\t\t\t0, 0, z, 0,\n\t\t\t\t0, 0, 0, 1\n\t\t\t]);\n\t\t}\n\n\t\t/**\n\t\t * Returns the result of rotating this matrix over the given x, y and z angles.\n\t\t *\n\t\t * @param {number} x\n\t\t * @param {number} y\n\t\t * @param {number} z\n\t\t * @returns {playtotv.css.Matrix} rotated\n\t\t */\n\t\trotate(x, y, z) {\n\t\t\tx = x || 0;\n\t\t\ty = arguments.length < 2 ? x : y;\n\t\t\tz = arguments.length < 3 ? x : z;\n\t\t\treturn this.rotateX(x).rotateY(y).rotateZ(z);\n\t\t}\n\n\t\t/**\n\t\t * Returns the result of rotating this matrix over the X-axis by the given angle.\n\t\t *\n\t\t * @param {number} angle\n\t\t * @returns {playtotv.css.Matrix} rotated\n\t\t */\n\t\trotateX(angle) {\n\t\t\tvar c = Math.cos(angle);\n\t\t\tvar s = Math.sin(angle);\n\t\t\treturn this.multiply([\n\t\t\t\t1, 0,  0, 0,\n\t\t\t\t0, c, -s, 0,\n\t\t\t\t0, s,  c, 0,\n\t\t\t\t0, 0,  0, 1\n\t\t\t]);\n\t\t}\n\n\t\t/**\n\t\t * Returns the result of rotating this matrix over the Y-axis by the given angle.\n\t\t *\n\t\t * @param {number} angle\n\t\t * @returns {playtotv.css.Matrix} rotated\n\t\t */\n\t\trotateY(angle) {\n\t\t\tvar c = Math.cos(angle);\n\t\t\tvar s = Math.sin(angle);\n\t\t\treturn this.multiply([\n\t\t\t\t c, 0, s, 0,\n\t\t\t\t 0, 1, 0, 0,\n\t\t\t\t-s, 0, c, 0,\n\t\t\t\t 0, 0, 0, 1\n\t\t\t]);\n\t\t}\n\n\t\t/**\n\t\t * Returns the result of rotating this matrix over the Z-axis by the given angle. This is the axis over which\n\t\t * to rotate in 2D space.\n\t\t *\n\t\t * @param {number} angle\n\t\t * @returns {playtotv.css.Matrix} rotated\n\t\t */\n\t\trotateZ(angle) {\n\t\t\tvar c = Math.cos(angle);\n\t\t\tvar s = Math.sin(angle);\n\t\t\treturn this.multiply([\n\t\t\t\tc, -s, 0, 0,\n\t\t\t\ts,  c, 0, 0,\n\t\t\t\t0,  0, 1, 0,\n\t\t\t\t0,  0, 0, 1\n\t\t\t]);\n\t\t}\n\n\t\t/**\n\t\t * Returns the result of inversing this matrix. The inverse matrix returns the identity matrix when multiplied\n\t\t * with the original matrix.\n\t\t *\n\t\t * @returns {playtotv.css.Matrix} inversed\n\t\t */\n\t\tinverse() {\n\t\t\tvar m = this.entities;\n\t\t\tvar a = m[0];\n\t\t\tvar b = m[1];\n\t\t\tvar c = m[2];\n\t\t\tvar d = m[4];\n\t\t\tvar e = m[5];\n\t\t\tvar f = m[6];\n\t\t\tvar g = m[8];\n\t\t\tvar h = m[9];\n\t\t\tvar k = m[10];\n\n\t\t\tvar A = e * k - f * h;\n\t\t\tvar B = f * g - d * k;\n\t\t\tvar C = d * h - e * g;\n\t\t\tvar D = c * h - b * k;\n\t\t\tvar E = a * k - c * g;\n\t\t\tvar F = b * g - a * h;\n\t\t\tvar G = b * f - c * e;\n\t\t\tvar H = c * d - a * f;\n\t\t\tvar K = a * e - b * d;\n\n\t\t\tvar det = a * A + b * B + c * C;\n\n\t\t\tvar inverse = new Matrix([\n\t\t\t\tA / det, D / det, G / det, 0,\n\t\t\t\tB / det, E / det, H / det, 0,\n\t\t\t\tC / det, F / det, K / det, 0,\n\t\t\t\t0, 0, 0, 1\n\t\t\t]);\n\n\t\t\tvar translate = new Matrix([\n\t\t\t\t1, 0, 0, 0,\n\t\t\t\t0, 1, 0, 0,\n\t\t\t\t0, 0, 1, 0,\n\t\t\t\t-m[12], -m[13], -m[14], 1\n\t\t\t]);\n\n\t\t\treturn translate.multiply(inverse);\n\t\t}\n\n\t\t/**\n\t\t * Returns the result of transforming a vector using this matrix.\n\t\t *\n\t\t * @param {playtotv.css.Point|playtotv.css.Vector} point\n\t\t * @returns {playtotv.css.Point} transformed\n\t\t */\n\t\ttransformPoint(p) {\n\t\t\tvar m = this.entities;\n\t\t\tvar x = p.x;\n\t\t\tvar y = p.y;\n\t\t\tvar z = p.z || 0;\n\t\t\treturn new Point(\n\t\t\t\tm[0] * x + m[4] * y + m[8]  * z + m[12],\n\t\t\t\tm[1] * x + m[5] * y + m[9]  * z + m[13],\n\t\t\t\tm[2] * x + m[6] * y + m[10] * z + m[14]\n\t\t\t);\n\t\t}\n\n\t\t/**\n\t\t * Returns a css compatible transform value of this matrix.\n\t\t *\n\t\t * @returns {string} transform\n\t\t */\n\t\ttoString() {\n\t\t\t// TODO: should this return a 2D transform if the input was?\n\t\t\treturn 'matrix3d(' + this.entities.toString() + ')';\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.css.style', [\n\t'playtotv.css.Matrix',\n\t'playtotv.css.Vector'\n], function(\n\tMatrix,\n\tVector\n) {\n\t/*jshint maxcomplexity:100*/\n\n\t'use strict';\n\n\t// Abort if we are not running in a browser (e.g: in Node)\n\tif (typeof window === 'undefined') {\n\t\treturn;\n\t}\n\n\tvar ua = navigator.userAgent;\n\tvar browser = {\n\t\tgecko: /gecko\\//i.test(ua),\n\t\ttrident: /trident\\//i.test(ua),\n\t\twebkit: /webkit\\//i.test(ua),\n\t\tpresto: /presto\\//i.test(ua)\n\t};\n\n\tvar PRIORITY = '';\n\n\tvar prefix =\n\t\tbrowser.webkit ? '-webkit-' :\n\t\tbrowser.gecko ? '-moz-' :\n\t\tbrowser.presto ? '-o-' :\n\t\tbrowser.trident ? '-ms-' : '';\n\n\tvar cssTransform = prefix + 'transform';\n\tvar cssOrigin = prefix + 'transform-origin';\n\n\tvar webkitConvert = window.WebKitPoint && window.webkitConvertPointFromPageToNode;\n\n\t/**\n\t * Style modifications for nodes, including transforms and transitions\n\t *\n\t * @name style\n\t * @namespace\n\t * @memberOf playtotv.css\n\t */\n\tvar style = {\n\n\t\t/** @lends playtotv.css.style */\n\n\t\t/**\n\t\t * Sets a css property of a node's style to the given value.\n\t\t *\n\t\t * @function\n\t\t * @param {Node} node\n\t\t * @param {string} property\n\t\t * @param {string} value\n\t\t */\n\t\tset:\n\t\t\twindow.getComputedStyle ?\n\n\t\t\tfunction(node, property, value) {\n\t\t\t\tnode.style.setProperty(property, value, PRIORITY);\n\t\t\t} :\n\n\t\t\tfunction(node, property, value) {\n\t\t\t\tnode.style[property] = value;\n\t\t\t},\n\n\t\t/**\n\t\t * Attempts a variety of methods to retreive the calculated style property value of\n\t\t * a given node.\n\t\t *\n\t\t * @function\n\t\t * @param {Node} node\n\t\t * @param {string} property\n\t\t * @returns {string} value\n\t\t */\n\t\tget:\n\n\t\t\twindow.getComputedStyle ?\n\n\t\t\tfunction(node, property) {\n\t\t\t\tvar computed = window.getComputedStyle(node, null);\n\t\t\t\treturn computed.getPropertyValue(property);\n\t\t\t} :\n\n\t\t\tfunction(node, property) {\n\t\t\t\tvar computed = node.currentStyle || node.style;\n\t\t\t\treturn computed[property];\n\t\t\t},\n\n\t\t/**\n\t\t * Removes a style property from a node\n\t\t *\n\t\t * @function\n\t\t * @param {Node} node\n\t\t * @param {string} property\n\t\t */\n\t\tremove:\n\n\t\t\twindow.getComputedStyle ?\n\n\t\t\tfunction(node, property) {\n\t\t\t\tnode.style.removeProperty(property);\n\t\t\t} :\n\n\t\t\tfunction(node, property) {\n\t\t\t\tnode.style[property] = '';\n\t\t\t},\n\n\t\t/**\n\t\t * Returns the css vendor prefixed versions of a property. Note that it does not check if the property\n\t\t * requires one, it merely prefixes.\n\t\t *\n\t\t * @param {string} property\n\t\t * @returns {string} prefixed\n\t\t */\n\t\tprefix: function(property) {\n\t\t\treturn prefix + property || '';\n\t\t},\n\n\t\t// metrics\n\n\t\t/**\n\t\t * Calculates the size of a Node, and returns an Object with x and y properties. Though not a Vector itself,\n\t\t * the returned object is compatible with existing Vectors.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @returns {playtotv.css.Vector} size\n\t\t */\n\t\tgetSize: function(node) {\n\t\t\treturn new Vector(\n\t\t\t\tnode.offsetWidth,\n\t\t\t\tnode.offsetHeight\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Calculates the inner size of a Node, excluding borders, and returns a Vector compatible object with x and y\n\t\t * properties.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @returns {playtotv.css.Vector} size\n\t\t */\n\t\tgetInnerSize: function(node) {\n\t\t\treturn new Vector(\n\t\t\t\tnode.clientWidth,\n\t\t\t\tnode.clientHeight\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Calculates the offset of a Node, optionally in respect to a parent Node, and returns an object with x and y\n\t\t * properties. Though not a Vector itself, the returned object is compatible with existing Vectors.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {Node} parent\n\t\t * @returns {playtotv.css.Vector} offset\n\t\t */\n\t\tgetOffset: function(node, parent) {\n\t\t\tvar x = 0, y = 0;\n\t\t\twhile (node && (node !== parent)) {\n\t\t\t\tx += node.offsetLeft;\n\t\t\t\ty += node.offsetTop;\n\t\t\t\tnode = node.offsetParent;\n\t\t\t}\n\n\t\t\treturn new Vector(x, y);\n\t\t},\n\n\t\t/**\n\t\t * Converts a point from (local) node coordinate space to the same point in page coordinate space. This is\n\t\t * especially helpful when nodes have css transformations applied to them like scaling and rotation.\n\t\t * See also http://www.w3.org/TR/2009/WD-css3-2d-transforms-20090320/#dom-interfaces\n\t\t *\n\t\t * @function\n\t\t * @param {Node} node\n\t\t * @param {playtotv.css.Vector} vector\n\t\t */\n\t\tfromNodeToPage:\n\t\t\twebkitConvert ?\n\n\t\t\tfunction(node, vector) {\n\t\t\t\tvar point = new window.WebKitPoint(vector.x, vector.y);\n\t\t\t\tvar converted = window.webkitConvertPointFromNodeToPage(node, point);\n\t\t\t\treturn new Vector(converted.x, converted.y);\n\t\t\t} :\n\n\t\t\tfunction(node, vector) {\n\t\t\t\tvar transform = this.getFullTransform(node);\n\t\t\t\treturn transform.transformPoint(vector).toVector();\n\t\t\t},\n\n\t\t/**\n\t\t * Converts a point from page coordinate space to the same point in (local) node coordinate space. This is\n\t\t * especially helpful when nodes have css transformations applied to them like scaling and rotation.\n\t\t * See also http://www.w3.org/TR/2009/WD-css3-2d-transforms-20090320/#dom-interfaces\n\t\t *\n\t\t * @function\n\t\t * @param {Node} node\n\t\t * @param {playtotv.css.Vector} vector\n\t\t */\n\t\tfromPageToNode:\n\t\t\twebkitConvert ?\n\n\t\t\tfunction(node, vector) {\n\t\t\t\tvar point = new window.WebKitPoint(vector.x, vector.y);\n\t\t\t\tvar converted = window.webkitConvertPointFromPageToNode(node, point);\n\t\t\t\treturn new Vector(converted.x, converted.y);\n\t\t\t} :\n\n\t\t\tfunction(node, vector) {\n\t\t\t\tvar transform = this.getFullTransform(node);\n\t\t\t\treturn transform.inverse().transformPoint(vector).toVector();\n\t\t\t},\n\n\t\t// Matrices\n\n\t\t/**\n\t\t * Sets the node style's transform property (vendor specific if needed) to the given value.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {string|playtotv.css.Matrix} transform\n\t\t */\n\t\tsetTransform: function(node, transform) {\n\t\t\tif (transform instanceof Matrix) {\n\t\t\t\ttransform = transform.toString();\n\t\t\t}\n\t\t\tthis.set(node, cssTransform, transform);\n\t\t},\n\n\t\t/**\n\t\t * Returns a matrix representing the current node style's transform property value.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @returns {playtotv.css.Matrix} transform\n\t\t */\n\t\tgetTransform: function(node) {\n\t\t\tvar transform = this.get(node, cssTransform);\n\t\t\treturn new Matrix(transform);\n\t\t},\n\n\t\t/**\n\t\t * Removes any transforms on the given node's style.\n\t\t *\n\t\t * @param {Node} node\n\t\t */\n\t\tremoveTransform: function(node) {\n\t\t\tthis.remove(node, cssTransform);\n\t\t},\n\n\t\t/**\n\t\t * Returns a matrix representing the node's complete transformation (translation, scale and rotation) in\n\t\t * respect to the document's origin. This includes any transformations inherited from ascendant nodes.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @returns {playtotv.css.Matrix} transformation\n\t\t */\n\t\tgetFullTransform: function(node) {\n\t\t\tvar nodeTransform, transform = new Matrix();\n\t\t\twhile (node) {\n\t\t\t\tnodeTransform = this.getTransform(node);\n\t\t\t\tif (nodeTransform) {\n\t\t\t\t\tvar origin = this.getTransformOrigin(node);\n\t\t\t\t\tif (origin) {\n\t\t\t\t\t\tnodeTransform = new Matrix().\n\t\t\t\t\t\t\ttranslate(origin.inverse()).\n\t\t\t\t\t\t\tmultiply(nodeTransform).\n\t\t\t\t\t\t\ttranslate(origin);\n\t\t\t\t\t}\n\n\t\t\t\t\ttransform = transform.multiply(nodeTransform);\n\t\t\t\t}\n\n\t\t\t\ttransform = transform.translate(\n\t\t\t\t\tnew Vector(node.offsetLeft, node.offsetTop)\n\t\t\t\t);\n\n\t\t\t\tnode = node.offsetParent;\n\t\t\t}\n\n\t\t\treturn transform;\n\t\t},\n\n\t\t/**\n\t\t * Returns a vector representing the transformation origin of the given node.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @returns {playtotv.css.Vector} origin\n\t\t */\n\t\tgetTransformOrigin: function(node) {\n\t\t\tvar origin = (this.get(node, cssOrigin) || '0 0').split(' ');\n\t\t\treturn Vector.parseFloat(origin[0], origin[1]);\n\t\t},\n\n\t\t// Vectors\n\n\t\t/**\n\t\t * Sets the given node style's left and top position to the given vector.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {playtotv.css.Vector} position\n\t\t */\n\t\tsetPosition: function(node, vector) {\n\t\t\tvar css = node.style;\n\t\t\tcss.left = vector.x + 'px';\n\t\t\tcss.top = vector.y + 'px';\n\t\t},\n\n\t\t/**\n\t\t * Returns a vector representing the node style's left and top position.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @returns {playtotv.css.Vector} position\n\t\t */\n\t\tgetPosition: function(node) {\n\t\t\treturn Vector.parseFloat(\n\t\t\t\tthis.get(node, 'left'),\n\t\t\t\tthis.get(node, 'top')\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Moves a node by the given vector using translate3d.\n\t\t *\n\t\t * @function\n\t\t * @param {Node} node\n\t\t * @param {playtotv.css.Vector} translate\n\t\t */\n\t\tsetTranslate: function(node, vector) {\n\t\t\tthis.set(node, cssTransform, 'translate3d(' + vector + ',0)');\n\t\t},\n\n\t\t/**\n\t\t * Returns a vector representing the current translation of the given node.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @returns {playtotv.css.Vector} translate\n\t\t */\n\t\tgetTranslate: function(node) {\n\t\t\tvar transform = this.getTransform(node);\n\t\t\treturn transform.transformPoint(Vector.ZERO).toVector();\n\t\t}\n\t};\n\n\treturn style;\n});\n",
		"/**\n * Auto generated API: <tt>src/episode/episode-session-api.js</tt>\n *\n * <b>DO NOT MODIFY! CHANGES WILL BE OVERWRITTEN THE NEXT TIME YOU UPDATE!</b>\n *\n * <b>Note:</b> These are not real functions but method definitions for\n * {@link playtotv.server.Server#call}.\n *\n * @name episodeSessionAPI\n * @memberOf playtotv.episode\n * @namespace\n */\nplaytotv.define('playtotv.episode.episodeSessionAPI', [], function() {\n\n\t'use strict';\n\n\treturn {\n\t\t/*jshint maxlen:300*/ // On occassion generated lines can be too long\n\n\t\t/** @lends playtotv.episode.episodeSessionAPI */\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>id</b></li>\n\t\t * <li><i>{string}</i> <b>showId</b></li>\n\t\t * <li><i>{string}</i> <b>showName</b></li>\n\t\t * <li><i>{string}</i> <b>episodeCode</b></li>\n\t\t * <li><i>{number}</i> <b>createDate</b></li>\n\t\t * <li><i>{Long}</i> <b>phaseDates</b></li>\n\t\t * <li><i>{number}</i> <b>maxScore</b></li>\n\t\t * <li><i>{EpisodeSessionPhase}</i> <b>currentPhase</b> Valid values: 'UPCOMING', 'PROLOGUE', 'COUNTDOWN', 'BROADCAST', 'BROADCAST_ENDED', 'EPILOGUE', 'CLOSED'</li>\n\t\t * <li><i>{number}</i> <b>slaveOffset</b></li>\n\t\t * <li><i>{[string]}</i> <b>timeZones</b></li>\n\t\t * <li><i>{string}</i> <b>clientMetaData</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.episodeSessionId\n\t\t * @returns {Promise} Promise of response data (ClientEpisodeSessionNoStatesDTO)\n\t\t */\n\t\tget: {\n\t\t\tlabel: 'episodeSession.get',\n\t\t\turl: '1/episodesessions/{episodeSessionId}'\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>type</b></li>\n\t\t * <li><i>{string}</i> <b>interactionId</b></li>\n\t\t * <li><i>{EpisodeSessionPhase}</i> <b>phase</b> Valid values: 'UPCOMING', 'PROLOGUE', 'COUNTDOWN', 'BROADCAST', 'BROADCAST_ENDED', 'EPILOGUE', 'CLOSED'</li>\n\t\t * <li><i>{Object}</i> <b>data</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.episodeSessionId\n\t\t * @param {EpisodeSessionPhase} [params.phase] Valid values: 'UPCOMING', 'PROLOGUE', 'COUNTDOWN', 'BROADCAST', 'BROADCAST_ENDED', 'EPILOGUE', 'CLOSED'\n\t\t * @returns {Promise} Promise of response data (ClientEpisodeSessionAsyncDataItemDTO)\n\t\t */\n\t\tgetAsyncDataForEpisodeSession: {\n\t\t\tlabel: 'episodeSession.getAsyncDataForEpisodeSession',\n\t\t\turl: '1/episodesessions/{episodeSessionId}/async',\n\t\t\tqueryKeys: [\n\t\t\t\t'phase'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{[ClientEpisodeSessionStateChangeDTO]}</i> <b>stateChanges</b>\n\t\t * <ul>\n\t\t * <li><i>{StateChangeSubject}</i> <b>subject</b> Valid values: 'INTERACTION', 'PHASE', 'LEADERBOARD_UPDATED', 'LEADERBOARD_FINAL', 'PLACEHOLDER'</li>\n\t\t * <li><i>{string}</i> <b>type</b></li>\n\t\t * <li><i>{EpisodeSessionPhase}</i> <b>sessionPhase</b> Valid values: 'UPCOMING', 'PROLOGUE', 'COUNTDOWN', 'BROADCAST', 'BROADCAST_ENDED', 'EPILOGUE', 'CLOSED'</li>\n\t\t * <li><i>{string}</i> <b>interactionState</b></li>\n\t\t * <li><i>{number}</i> <b>time</b></li>\n\t\t * <li><i>{string}</i> <b>interactionId</b></li>\n\t\t * <li><i>{Long}</i> <b>duration</b></li>\n\t\t * <li><i>{Object}</i> <b>data</b></li>\n\t\t * <li><i>{number}</i> <b>version</b></li>\n\t\t * </ul></li>\n\t\t * <li><i>{number}</i> <b>version</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.episodeSessionId\n\t\t * @returns {Promise} Promise of response data (ClientEpisodeSessionStateAsChangesDTO)\n\t\t */\n\t\tgetEpisodeSessionStateAsChanges: {\n\t\t\tlabel: 'episodeSession.getEpisodeSessionStateAsChanges',\n\t\t\turl: '1/episodesessions/{episodeSessionId}/statechanges/active'\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{[ClientEpisodeSessionStateChangeDTO]}</i> <b>stateChanges</b>\n\t\t * <ul>\n\t\t * <li><i>{StateChangeSubject}</i> <b>subject</b> Valid values: 'INTERACTION', 'PHASE', 'LEADERBOARD_UPDATED', 'LEADERBOARD_FINAL', 'PLACEHOLDER'</li>\n\t\t * <li><i>{string}</i> <b>type</b></li>\n\t\t * <li><i>{EpisodeSessionPhase}</i> <b>sessionPhase</b> Valid values: 'UPCOMING', 'PROLOGUE', 'COUNTDOWN', 'BROADCAST', 'BROADCAST_ENDED', 'EPILOGUE', 'CLOSED'</li>\n\t\t * <li><i>{string}</i> <b>interactionState</b></li>\n\t\t * <li><i>{number}</i> <b>time</b></li>\n\t\t * <li><i>{string}</i> <b>interactionId</b></li>\n\t\t * <li><i>{Long}</i> <b>duration</b></li>\n\t\t * <li><i>{Object}</i> <b>data</b></li>\n\t\t * <li><i>{number}</i> <b>version</b></li>\n\t\t * </ul></li>\n\t\t * <li><i>{number}</i> <b>version</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.episodeSessionId\n\t\t * @param {number} params.sinceVersion\n\t\t * @returns {Promise} Promise of response data (ClientEpisodeSessionStateAsChangesDTO)\n\t\t */\n\t\tgetEpisodeSessionStateAsChangesSince: {\n\t\t\tlabel: 'episodeSession.getEpisodeSessionStateAsChangesSince',\n\t\t\turl: '1/episodesessions/{episodeSessionId}/statechanges/active/{sinceVersion}'\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{number}</i> <b>maxScore</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.episodeSessionId\n\t\t * @returns {Promise} Promise of response data (EpisodeSessionMaxScoreDTO)\n\t\t */\n\t\tgetMaxScore: {\n\t\t\tlabel: 'episodeSession.getMaxScore',\n\t\t\turl: '1/episodesessions/{episodeSessionId}/maxscore'\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>id</b></li>\n\t\t * <li><i>{string}</i> <b>showId</b></li>\n\t\t * <li><i>{string}</i> <b>showName</b></li>\n\t\t * <li><i>{string}</i> <b>episodeCode</b></li>\n\t\t * <li><i>{number}</i> <b>createDate</b></li>\n\t\t * <li><i>{Long}</i> <b>phaseDates</b></li>\n\t\t * <li><i>{number}</i> <b>maxScore</b></li>\n\t\t * <li><i>{EpisodeSessionPhase}</i> <b>currentPhase</b> Valid values: 'UPCOMING', 'PROLOGUE', 'COUNTDOWN', 'BROADCAST', 'BROADCAST_ENDED', 'EPILOGUE', 'CLOSED'</li>\n\t\t * <li><i>{number}</i> <b>slaveOffset</b></li>\n\t\t * <li><i>{[string]}</i> <b>timeZones</b></li>\n\t\t * <li><i>{string}</i> <b>clientMetaData</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} [params.timeZone]\n\t\t * @returns {Promise} Promise of response data (ClientEpisodeSessionNoStatesDTO)\n\t\t */\n\t\tgetNonClosedSessions: {\n\t\t\tlabel: 'episodeSession.getNonClosedSessions',\n\t\t\turl: '1/episodesessions/nonclosed',\n\t\t\tqueryKeys: [\n\t\t\t\t'timeZone'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>id</b></li>\n\t\t * <li><i>{string}</i> <b>showId</b></li>\n\t\t * <li><i>{string}</i> <b>showName</b></li>\n\t\t * <li><i>{string}</i> <b>episodeCode</b></li>\n\t\t * <li><i>{number}</i> <b>createDate</b></li>\n\t\t * <li><i>{Long}</i> <b>phaseDates</b></li>\n\t\t * <li><i>{number}</i> <b>maxScore</b></li>\n\t\t * <li><i>{EpisodeSessionPhase}</i> <b>currentPhase</b> Valid values: 'UPCOMING', 'PROLOGUE', 'COUNTDOWN', 'BROADCAST', 'BROADCAST_ENDED', 'EPILOGUE', 'CLOSED'</li>\n\t\t * <li><i>{number}</i> <b>slaveOffset</b></li>\n\t\t * <li><i>{[string]}</i> <b>timeZones</b></li>\n\t\t * <li><i>{string}</i> <b>clientMetaData</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.showId\n\t\t * @param {string} [params.timeZone]\n\t\t * @returns {Promise} Promise of response data (ClientEpisodeSessionNoStatesDTO)\n\t\t */\n\t\tgetNonClosedSessionsForShow: {\n\t\t\tlabel: 'episodeSession.getNonClosedSessionsForShow',\n\t\t\turl: '1/episodesessions/show/{showId}/nonclosed',\n\t\t\tqueryKeys: [\n\t\t\t\t'timeZone'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>id</b></li>\n\t\t * <li><i>{string}</i> <b>showId</b></li>\n\t\t * <li><i>{string}</i> <b>showName</b></li>\n\t\t * <li><i>{string}</i> <b>episodeCode</b></li>\n\t\t * <li><i>{number}</i> <b>createDate</b></li>\n\t\t * <li><i>{Long}</i> <b>phaseDates</b></li>\n\t\t * <li><i>{number}</i> <b>maxScore</b></li>\n\t\t * <li><i>{EpisodeSessionPhase}</i> <b>currentPhase</b> Valid values: 'UPCOMING', 'PROLOGUE', 'COUNTDOWN', 'BROADCAST', 'BROADCAST_ENDED', 'EPILOGUE', 'CLOSED'</li>\n\t\t * <li><i>{number}</i> <b>slaveOffset</b></li>\n\t\t * <li><i>{[string]}</i> <b>timeZones</b></li>\n\t\t * <li><i>{string}</i> <b>clientMetaData</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.showName\n\t\t * @param {string} [params.timeZone]\n\t\t * @returns {Promise} Promise of response data (ClientEpisodeSessionNoStatesDTO)\n\t\t */\n\t\tgetNonClosedSessionsForShowByName: {\n\t\t\tlabel: 'episodeSession.getNonClosedSessionsForShowByName',\n\t\t\turl: '1/episodesessions/show/byname/{showName}/nonclosed',\n\t\t\tqueryKeys: [\n\t\t\t\t'timeZone'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>id</b></li>\n\t\t * <li><i>{string}</i> <b>showId</b></li>\n\t\t * <li><i>{string}</i> <b>showName</b></li>\n\t\t * <li><i>{string}</i> <b>episodeCode</b></li>\n\t\t * <li><i>{number}</i> <b>createDate</b></li>\n\t\t * <li><i>{Long}</i> <b>phaseDates</b></li>\n\t\t * <li><i>{number}</i> <b>maxScore</b></li>\n\t\t * <li><i>{EpisodeSessionPhase}</i> <b>currentPhase</b> Valid values: 'UPCOMING', 'PROLOGUE', 'COUNTDOWN', 'BROADCAST', 'BROADCAST_ENDED', 'EPILOGUE', 'CLOSED'</li>\n\t\t * <li><i>{number}</i> <b>slaveOffset</b></li>\n\t\t * <li><i>{[string]}</i> <b>timeZones</b></li>\n\t\t * <li><i>{string}</i> <b>clientMetaData</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {EpisodeSessionPhase} params.state Valid values: 'UPCOMING', 'PROLOGUE', 'COUNTDOWN', 'BROADCAST', 'BROADCAST_ENDED', 'EPILOGUE', 'CLOSED'\n\t\t * @param {string} [params.timeZone]\n\t\t * @returns {Promise} Promise of response data (ClientEpisodeSessionNoStatesDTO)\n\t\t */\n\t\tgetSessionsInPhase: {\n\t\t\tlabel: 'episodeSession.getSessionsInPhase',\n\t\t\turl: '1/episodesessions/state/{state}',\n\t\t\tqueryKeys: [\n\t\t\t\t'timeZone'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>id</b></li>\n\t\t * <li><i>{string}</i> <b>showId</b></li>\n\t\t * <li><i>{string}</i> <b>showName</b></li>\n\t\t * <li><i>{string}</i> <b>episodeCode</b></li>\n\t\t * <li><i>{number}</i> <b>createDate</b></li>\n\t\t * <li><i>{Long}</i> <b>phaseDates</b></li>\n\t\t * <li><i>{number}</i> <b>maxScore</b></li>\n\t\t * <li><i>{EpisodeSessionPhase}</i> <b>currentPhase</b> Valid values: 'UPCOMING', 'PROLOGUE', 'COUNTDOWN', 'BROADCAST', 'BROADCAST_ENDED', 'EPILOGUE', 'CLOSED'</li>\n\t\t * <li><i>{number}</i> <b>slaveOffset</b></li>\n\t\t * <li><i>{[string]}</i> <b>timeZones</b></li>\n\t\t * <li><i>{string}</i> <b>clientMetaData</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.showId\n\t\t * @param {EpisodeSessionPhase} params.state Valid values: 'UPCOMING', 'PROLOGUE', 'COUNTDOWN', 'BROADCAST', 'BROADCAST_ENDED', 'EPILOGUE', 'CLOSED'\n\t\t * @param {string} [params.timeZone]\n\t\t * @returns {Promise} Promise of response data (ClientEpisodeSessionNoStatesDTO)\n\t\t */\n\t\tgetSessionsInPhaseForShow: {\n\t\t\tlabel: 'episodeSession.getSessionsInPhaseForShow',\n\t\t\turl: '1/episodesessions/show/{showId}/state/{state}',\n\t\t\tqueryKeys: [\n\t\t\t\t'timeZone'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>id</b></li>\n\t\t * <li><i>{string}</i> <b>showId</b></li>\n\t\t * <li><i>{string}</i> <b>showName</b></li>\n\t\t * <li><i>{string}</i> <b>episodeCode</b></li>\n\t\t * <li><i>{number}</i> <b>createDate</b></li>\n\t\t * <li><i>{Long}</i> <b>phaseDates</b></li>\n\t\t * <li><i>{number}</i> <b>maxScore</b></li>\n\t\t * <li><i>{EpisodeSessionPhase}</i> <b>currentPhase</b> Valid values: 'UPCOMING', 'PROLOGUE', 'COUNTDOWN', 'BROADCAST', 'BROADCAST_ENDED', 'EPILOGUE', 'CLOSED'</li>\n\t\t * <li><i>{number}</i> <b>slaveOffset</b></li>\n\t\t * <li><i>{[string]}</i> <b>timeZones</b></li>\n\t\t * <li><i>{string}</i> <b>clientMetaData</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.showName\n\t\t * @param {EpisodeSessionPhase} params.state Valid values: 'UPCOMING', 'PROLOGUE', 'COUNTDOWN', 'BROADCAST', 'BROADCAST_ENDED', 'EPILOGUE', 'CLOSED'\n\t\t * @param {string} [params.timeZone]\n\t\t * @returns {Promise} Promise of response data (ClientEpisodeSessionNoStatesDTO)\n\t\t */\n\t\tgetSessionsInPhaseForShowByName: {\n\t\t\tlabel: 'episodeSession.getSessionsInPhaseForShowByName',\n\t\t\turl: '1/episodesessions/show/byname/{showName}/state/{state}',\n\t\t\tqueryKeys: [\n\t\t\t\t'timeZone'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>episodeSessionId</b></li>\n\t\t * <li><i>{number}</i> <b>newUsers</b></li>\n\t\t * <li><i>{number}</i> <b>returningUsers</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.episodeSessionId\n\t\t * @returns {Promise} Promise of response data (EpisodeSessionUserStatisticsDTO)\n\t\t */\n\t\tgetUserStatistics: {\n\t\t\tlabel: 'episodeSession.getUserStatistics',\n\t\t\turl: '1/episodesessions/{episodeSessionId}/users'\n\t\t},\n\n\t\t/**\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.episodeSessionId\n\t\t * @returns {Promise} Promise of response data (Object)\n\t\t */\n\t\tjoin: {\n\t\t\tlabel: 'episodeSession.join',\n\t\t\turl: '1/episodesessions/{episodeSessionId}',\n\t\t\ttype: 'PUT'\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{ClientEpisodeSessionNoStatesDTO}</i> <b>episodeSession</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>id</b></li>\n\t\t * <li><i>{string}</i> <b>showId</b></li>\n\t\t * <li><i>{string}</i> <b>showName</b></li>\n\t\t * <li><i>{string}</i> <b>episodeCode</b></li>\n\t\t * <li><i>{number}</i> <b>createDate</b></li>\n\t\t * <li><i>{Long}</i> <b>phaseDates</b></li>\n\t\t * <li><i>{number}</i> <b>maxScore</b></li>\n\t\t * <li><i>{EpisodeSessionPhase}</i> <b>currentPhase</b> Valid values: 'UPCOMING', 'PROLOGUE', 'COUNTDOWN', 'BROADCAST', 'BROADCAST_ENDED', 'EPILOGUE', 'CLOSED'</li>\n\t\t * <li><i>{number}</i> <b>slaveOffset</b></li>\n\t\t * <li><i>{[string]}</i> <b>timeZones</b></li>\n\t\t * <li><i>{string}</i> <b>clientMetaData</b></li>\n\t\t * </ul></li>\n\t\t * <li><i>{ClientEpisodeSessionStateAsChangesDTO}</i> <b>state</b>\n\t\t * <ul>\n\t\t * <li><i>{[ClientEpisodeSessionStateChangeDTO]}</i> <b>stateChanges</b>\n\t\t * <ul>\n\t\t * <li><i>{StateChangeSubject}</i> <b>subject</b> Valid values: 'INTERACTION', 'PHASE', 'LEADERBOARD_UPDATED', 'LEADERBOARD_FINAL', 'PLACEHOLDER'</li>\n\t\t * <li><i>{string}</i> <b>type</b></li>\n\t\t * <li><i>{EpisodeSessionPhase}</i> <b>sessionPhase</b> Valid values: 'UPCOMING', 'PROLOGUE', 'COUNTDOWN', 'BROADCAST', 'BROADCAST_ENDED', 'EPILOGUE', 'CLOSED'</li>\n\t\t * <li><i>{string}</i> <b>interactionState</b></li>\n\t\t * <li><i>{number}</i> <b>time</b></li>\n\t\t * <li><i>{string}</i> <b>interactionId</b></li>\n\t\t * <li><i>{Long}</i> <b>duration</b></li>\n\t\t * <li><i>{Object}</i> <b>data</b></li>\n\t\t * <li><i>{number}</i> <b>version</b></li>\n\t\t * </ul></li>\n\t\t * <li><i>{number}</i> <b>version</b></li>\n\t\t * </ul></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} [params.showName]\n\t\t * @param {string} [params.showId]\n\t\t * @param {string} [params.episodeSessionId]\n\t\t * @param {string} [params.timeZone]\n\t\t * @returns {Promise} Promise of response data (CurrentEpisodeSessionDTO)\n\t\t */\n\t\tjoinAndGetState: {\n\t\t\tlabel: 'episodeSession.joinAndGetState',\n\t\t\turl: '1/episodesessions/joinandgetstate',\n\t\t\ttype: 'PUT',\n\t\t\tqueryKeys: [\n\t\t\t\t'showName',\n\t\t\t\t'showId',\n\t\t\t\t'episodeSessionId',\n\t\t\t\t'timeZone'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>id</b></li>\n\t\t * <li><i>{string}</i> <b>showId</b></li>\n\t\t * <li><i>{string}</i> <b>showName</b></li>\n\t\t * <li><i>{string}</i> <b>episodeCode</b></li>\n\t\t * <li><i>{number}</i> <b>createDate</b></li>\n\t\t * <li><i>{Long}</i> <b>phaseDates</b></li>\n\t\t * <li><i>{number}</i> <b>maxScore</b></li>\n\t\t * <li><i>{EpisodeSessionPhase}</i> <b>currentPhase</b> Valid values: 'UPCOMING', 'PROLOGUE', 'COUNTDOWN', 'BROADCAST', 'BROADCAST_ENDED', 'EPILOGUE', 'CLOSED'</li>\n\t\t * <li><i>{number}</i> <b>slaveOffset</b></li>\n\t\t * <li><i>{[string]}</i> <b>timeZones</b></li>\n\t\t * <li><i>{string}</i> <b>clientMetaData</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.showId\n\t\t * @param {string} params.episodeCode\n\t\t * @param {number} params.msSinceSessionStart\n\t\t * @param {number} params.timeWindow\n\t\t * @param {boolean} params.createIfNoneAvailable\n\t\t * @returns {Promise} Promise of response data (ClientEpisodeSessionNoStatesDTO)\n\t\t */\n\t\tjoinInSync: {\n\t\t\tlabel: 'episodeSession.joinInSync',\n\t\t\turl: '1/episodesessions/show/{showId}/episode/{episodeCode}/joinInSync',\n\t\t\ttype: 'PUT',\n\t\t\tdataKeys: [\n\t\t\t\t'msSinceSessionStart',\n\t\t\t\t'timeWindow',\n\t\t\t\t'createIfNoneAvailable'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.episodeSessionId\n\t\t * @returns {Promise} Promise of response data (Object)\n\t\t */\n\t\tleave: {\n\t\t\tlabel: 'episodeSession.leave',\n\t\t\turl: '1/episodesessions/{episodeSessionId}',\n\t\t\ttype: 'DELETE'\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.facebook.FacebookAdapter', [], function() {\n\n\t'use strict';\n\n\treturn class FacebookAdapter {\n\t\t/** @lends playtotv.facebook.FacebookAdapter.prototype */\n\n\t\t/**\n\t\t * Adapter between {@link playtotv.facebook.Facebook} and PlayToTV API call parameters.\n\t\t *\n\t\t * @constructs\n\t\t * @param {playtotv.facebook.Facebook} facebook Facebook instance to use\n\t\t */\n\t\tconstructor(facebook) {\n\t\t\tthis.facebook = facebook;\n\t\t}\n\n\t\t/**\n\t\t * Returns a params object to pass to {@link playtotv.user.UserManager#loginByFacebook}.\n\t\t *\n\t\t * In addition to the basic PlayToTV user properties, all of the Facebook user data is returned as private\n\t\t * properties for advanced usage purposes. This enables you to use Facebook's extended \"scope\" properties like\n\t\t * email. Please note that PlayToTV property values are strings, so any object values are JSON stringified.\n\t\t *\n\t\t * Note: Picture size URL parameters can optionally be appended to resulting avatarUrl:\n\t\t * <a href=\"http://developers.facebook.com/docs/reference/api/using-pictures/#sizes\">Pictures API</a>\n\t\t *\n\t\t * @param {boolean} [interactive] {@link playtotv.facebook.Facebook#login} interactive\n\t\t * @param {number} [timeout] {@link playtotv.facebook.Facebook#call} timeout for fetching Facebook name\n\t\t * @return {Promise} Promise of params object\n\t\t */\n\t\tgetLoginParams(interactive, timeout) {\n\t\t\tvar facebook = this.facebook;\n\t\t\treturn facebook.login(interactive).then(function(id) {\n\t\t\t\treturn facebook.call('api', timeout, '/me').then(function(data) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tfacebookId: id,\n\t\t\t\t\t\tfbsr: facebook.signedRequest,\n\t\t\t\t\t\tdisplayName: data.name,\n\t\t\t\t\t\tavatarUrl: '//graph.facebook.com/' + id + '/picture',\n\t\t\t\t\t\tprivateProperties: Object.keys(data).reduce(function(props, key) {\n\t\t\t\t\t\t\tvar value = data[key];\n\t\t\t\t\t\t\tprops[key] = typeof value === 'object' ? JSON.stringify(value) : value;\n\t\t\t\t\t\t\treturn props;\n\t\t\t\t\t\t}, {})\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Returns a params object to pass to {@link playtotv.user.UserManager#addFacebookCredentials}.\n\t\t *\n\t\t * @param {boolean} [interactive] {@link playtotv.facebook.Facebook#login} interactive\n\t\t * @return {Promise} Promise of params object\n\t\t */\n\t\tgetCredentialParams(interactive) {\n\t\t\tvar facebook = this.facebook;\n\t\t\treturn facebook.login(interactive).then(function(id) {\n\t\t\t\treturn {\n\t\t\t\t\tfacebookId: id,\n\t\t\t\t\tfbsr: facebook.signedRequest\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.facebook.FacebookPostWidget', [ 'playtotv.widget.Widget' ], function(Widget) {\n\n\t'use strict';\n\n\tvar ATTR_PREFIX = 'data-facebook-';\n\n\tvar log = playtotv.Logger.get(this.id);\n\n\treturn class FacebookPostWidget extends Widget {\n\t\t/** @lends playtotv.facebook.FacebookPostWidget.prototype */\n\n\t\t/**\n\t\t * Widget that facilitates making a Facebook post when a user clicks on a node.\n\t\t *\n\t\t * Content parameters:\n\t\t * <ul>\n\t\t * <li><a href=\"http://developers.facebook.com/docs/reference/dialogs/feed/\">Facebook documentation</a>\n\t\t * <li>Can be defined using options.content and overridden using data-facebook-* attributes\n\t\t * <li>Values will be processed at post time by options.process, allowing for substitutions etc.\n\t\t * </ul>\n\t\t *\n\t\t * Note: If you do not post interactively you should use onPost to show a confirmation to the user!\n\t\t *\n\t\t * @constructs\n\t\t * @extends playtotv.widget.Widget\n\t\t * @param {Node} node\n\t\t * @param {Options} options\n\t\t * @param {playtotv.facebook.Facebook} options.facebook Facebook instance to use\n\t\t * @param {boolean} [options.interactive=true] {@link playtotv.facebook.Facebook#post} interactive\n\t\t * @param {number} [options.timeout] {@link playtotv.facebook.Facebook#post} timeout\n\t\t * @param {string} [options.content={}] Default post content params (e.g. name, link, etc.)\n\t\t * @param {Function} [options.process] Content processing function which is passed (value, key)\n\t\t * @param {Function} [options.onResolve] Function to be called each time a post successfully resolves\n\t\t * @param {Function} [options.onReject] Function to be called each time a post is rejected (e.g. cancelled)\n\t\t */\n\t\tconstructor(node, options) {\n\t\t\tsuper(node);\n\n\t\t\tthis.options = playtotv.params(options, {\n\t\t\t\tfacebook: playtotv.REQUIRED,\n\t\t\t\tinteractive: true,\n\t\t\t\ttimeout: undefined,\n\t\t\t\tcontent: {},\n\t\t\t\tprocess: function(value /*, key*/) { return value; }, // leave as-is by default\n\t\t\t\tonResolve: function(postId) { log.d('onResolve, post id:', postId); },\n\t\t\t\tonReject: function(reason) { log.d('onReject', reason); }\n\t\t\t});\n\n\t\t\tthis.onClick = this.onClick.bind(this);\n\t\t\tthis.addEventListener(node, 'click', this.onClick);\n\t\t}\n\n\t\tonClick(e) {\n\t\t\te.preventDefault();\n\t\t\tthis.post();\n\t\t\treturn false;\n\t\t}\n\n\t\tpost() {\n\t\t\tvar node = this.node;\n\t\t\tvar options = this.options;\n\t\t\tvar facebook = options.facebook;\n\n\t\t\tvar content = Object.assign({}, options.content);\n\n\t\t\tArray.from(node.attributes).forEach(function(attr) {\n\t\t\t\tif (attr.name.indexOf(ATTR_PREFIX) === 0) {\n\t\t\t\t\tcontent[attr.name.substr(ATTR_PREFIX.length)] = attr.value;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tplaytotv.each(content, function(value, key) {\n\t\t\t\tcontent[key] = options.process(content[key], key);\n\t\t\t});\n\n\t\t\tfacebook.post(content, options.interactive, options.timeout).then(options.onResolve, options.onReject);\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.fx.Animation', [\n\t'playtotv.animationFrame'\n], function(\n\tanimationFrame\n) {\n\t'use strict';\n\n\t/**\n\t * Animation super class. Increments an animation fraction from 0 to 1 over a given duration, and passes the\n\t * current value to the onFrame function using a requestAnimationFrame callback. The onFrame function MUST be\n\t * implemented by subclasses. Super class for {@link playtotv.fx.Transition} and {@link playtotv.fx.Timeline}.\n\t *\n\t * @name Animation\n\t * @class\n\t * @memberOf playtotv.fx\n\t * @param {Object} options\n\t * @param {boolean} [options.alternate=false] Whether an animation with multiple cycles alternates direction\n\t * @param {number} [options.cycles=1] Amount of repeating animation cycles\n\t * @param {number} [options.duration=1000] Duration of one animation cycle in ms\n\t * @param {number} [options.fps=0] Fps limit on requestAnimationFrame callbacks\n\t * @param {number} [options.rate=1] Time rate multiplier\n\t * @param {number} [options.start] Alternate start timestamp in ms; past starts mid-animation, future delays start\n\t */\n\treturn class Animation {\n\t\tconstructor(options) {\n\t\t\tthis.settings = playtotv.params(options, {\n\t\t\t\talternate: false,\n\t\t\t\tcycles: 1,\n\t\t\t\tduration: playtotv.REQUIRED,\n\t\t\t\tfps: 0,\n\t\t\t\trate: 1,\n\t\t\t\tstart: 0\n\t\t\t});\n\t\t}\n\n\t\t/** @lends playtotv.fx.Animation.prototype */\n\n\t\t/**\n\t\t * Internal requestAnimationFrame\n\t\t * @private\n\t\t */\n\t\trequestFrame() {\n\t\t\tthis.playing = animationFrame.request(() => this.onTick());\n\t\t}\n\n\t\t/**\n\t\t * Internal cancelAnimationFrame\n\t\t * @private\n\t\t */\n\t\tcancelFrame() {\n\t\t\tif (this.playing) {\n\t\t\t\tanimationFrame.cancel(this.playing);\n\t\t\t\tdelete this.playing;\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Public play function. Options that are passed will overrule the instance's, but only for this animation. If\n\t\t * an animation was currently playing, it will be stopped. This will NOT trigger onFinish(). Calls onStart().\n\t\t * @param {Object} options See instance options.\n\t\t */\n\t\tplay(options) {\n\t\t\tif (this.playing) {\n\t\t\t\tthis.stop();\n\t\t\t}\n\n\t\t\tthis.animation = options = playtotv.params(options, this.settings);\n\t\t\tthis.frame = options.fps ? 1000 / options.fps : 0;\n\t\t\tthis.startTime = options.start || Date.now();\n\t\t\tthis.frameTime = 0;\n\t\t\tthis.reversed = false;\n\n\t\t\tthis.onStart();\n\n\t\t\tthis.requestFrame();\n\t\t}\n\n\t\t/**\n\t\t * Pauses the current animation.\n\t\t */\n\t\tpause() {\n\t\t\tif (this.playing) {\n\t\t\t\tthis.paused = true;\n\t\t\t\tthis.pauseTime = Date.now();\n\t\t\t\tthis.cancelFrame();\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Resumes a currently paused animation.\n\t\t */\n\t\tresume() {\n\t\t\tif (this.paused) {\n\t\t\t\tdelete this.paused;\n\t\t\t\tthis.startTime = this.startTime + (Date.now() - this.pauseTime);\n\t\t\t\tthis.requestFrame();\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Stops a currently playing animation. A reset boolean may be passed to indicate whether the onFrame function\n\t\t * should be called with the initial animation fraction value of 0.\n\t\t * @param {boolean} reset\n\t\t */\n\t\tstop(reset) {\n\t\t\tthis.cancelFrame();\n\t\t\tif (reset) {\n\t\t\t\tthis.onFrame(0);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Internal tick. Calculates the current fraction value, and passes it to onFrame.\n\t\t * @private\n\t\t */\n\t\tonTick() {\n\t\t\t/*jshint maxcomplexity:10*/\n\n\t\t\tvar time = Date.now();\n\t\t\tvar anim = this.animation;\n\t\t\tvar cycles = anim.cycles;\n\t\t\tvar totalTime = (time - this.startTime) * anim.rate;\n\t\t\tvar cycle = Math.max(0, totalTime / anim.duration);\n\t\t\tvar finished = cycle >= cycles;\n\n\t\t\tvar at = (cycles > 1) ? cycle % 1 : Math.min(1, cycle);\n\t\t\tif (anim.alternate) {\n\t\t\t\tvar reversed = cycle % 2 > 1;\n\t\t\t\tif (reversed !== this.reversed) {\n\t\t\t\t\tthis.reversed = reversed;\n\t\t\t\t\tthis.onCycle(reversed);\n\t\t\t\t}\n\n\t\t\t\tat = reversed ? 1 - at : at;\n\t\t\t}\n\n\t\t\tif (!this.frame || finished || (time - this.frameTime) > this.frame) {\n\t\t\t\tthis.frameTime = time;\n\t\t\t\tthis.onFrame(at);\n\t\t\t}\n\n\t\t\tif (!finished) {\n\t\t\t\tthis.requestFrame();\n\t\t\t} else {\n\t\t\t\tthis.onFinish();\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Frame callback that MUST be implemented by subclasses. Receives the animation fraction as a number between\n\t\t * 0 and 1, which indicates how much of the animation has passed.\n\t\t * @param {number} fraction\n\t\t */\n\t\tonFrame() {\n\t\t\tthrow new ReferenceError('Abstract function not implemented');\n\t\t}\n\n\t\t/**\n\t\t * Start callback that may be implemented by subclasses. Called immediately before an animation is started\n\t\t * using play().\n\t\t */\n\t\tonStart() {}\n\n\t\t/**\n\t\t * Cycle callback that may be implemented by subclasses. Called immediately before subsequent animation cycles\n\t\t * start. Receives a boolean indicating whether this cycle is a reversed one. This function is called only when\n\t\t * an animation has more than one animation cycle.\n\t\t * @param {boolean} reversed\n\t\t */\n\t\tonCycle() {}\n\n\t\t/**\n\t\t * End callback that may be implemented by subclasses. Called immediately after an animation ended.\n\t\t */\n\t\tonFinish() {}\n\t};\n});\n",
		"playtotv.define('playtotv.fx.easing', [], function() {\n\n\t'use strict';\n\n\t/**\n\t * Easing, provides callbacks that transform a 0 - 1 range to their eased equivalents.\n\t *\n\t * @name easing\n\t * @memberOf playtotv.fx\n\t * @namespace Easing equations, returns eased value from a 0 - 1 range.\n\t */\n\tvar easing = {\n\n\t\t/** @lends playtotv.fx.easing */\n\n\t\t/**\n\t\t * Returns the requested easing equation, or linear if not found.\n\t\t *\n\t\t * @param {string} name\n\t\t * @returns {Function} easing\n\t\t */\n\t\tget: function(name) {\n\t\t\treturn this[name] || this.linear;\n\t\t},\n\n\t\t/**\n\t\t * Adds an easing equation under the given name.\n\t\t *\n\t\t * @param {string} name\n\t\t * @param {Function} easing\n\t\t * @returns {Function} easing\n\t\t */\n\t\tset: function(name, easing) {\n\t\t\tif (this.hasOwnProperty(name)) {\n\t\t\t\tthrow new Error('\"' + name + '\" easing is already defined.');\n\t\t\t}\n\n\t\t\tthis[name] = easing;\n\t\t\treturn easing;\n\t\t},\n\n\t\t/**\n\t\t * Linear easing, input equals output.\n\t\t *\n\t\t * @param {number} value\n\t\t * @returns {number} eased\n\t\t */\n\t\tlinear: function(i) {\n\t\t\treturn i;\n\t\t},\n\n\t\t/**\n\t\t * Quadratic ease-in\n\t\t *\n\t\t * @param {number} value\n\t\t * @returns {number} eased\n\t\t */\n\t\tquadin: function(i) {\n\t\t\treturn i * i;\n\t\t},\n\n\t\t/**\n\t\t * Quadratic ease-out\n\t\t *\n\t\t * @param {number} value\n\t\t * @returns {number} eased\n\t\t */\n\t\tquadout: function(i) {\n\t\t\treturn i * (2 - i);\n\t\t},\n\n\t\t/**\n\t\t * Quadratic ease-in-out\n\t\t *\n\t\t * @param {number} value\n\t\t * @returns {number} eased\n\t\t */\n\t\tquadinout: function(i) {\n\t\t\treturn (i < 0.5) ?\n\t\t\t\t2 * i * i :\n\t\t\t\t1 - (2 * (--i) * i);\n\t\t},\n\n\t\t/**\n\t\t * Cubic ease-in\n\t\t *\n\t\t * @param {number} value\n\t\t * @returns {number} eased\n\t\t */\n\t\tcubicin: function(i) {\n\t\t\treturn i * i * i;\n\t\t},\n\n\t\t/**\n\t\t * Cubic ease-out\n\t\t *\n\t\t * @param {number} value\n\t\t * @returns {number} eased\n\t\t */\n\t\tcubicout: function(i) {\n\t\t\treturn ((--i) * i * i + 1);\n\t\t},\n\n\t\t/**\n\t\t * Cubic ease-in-out\n\t\t *\n\t\t * @param {number} value\n\t\t * @returns {number} eased\n\t\t */\n\t\tcubicinout: function(i) {\n\t\t\treturn (i < 0.5) ?\n\t\t\t\t4 * i * i * i :\n\t\t\t\t1 + (4 * (--i) * i * i);\n\t\t},\n\n\t\t/**\n\t\t * Quartic ease-in\n\t\t *\n\t\t * @param {number} value\n\t\t * @returns {number} eased\n\t\t */\n\t\tquartin: function(i) {\n\t\t\treturn i * i * i * i;\n\t\t},\n\n\t\t/**\n\t\t * Quartic ease-out\n\t\t *\n\t\t * @param {number} value\n\t\t * @returns {number} eased\n\t\t */\n\t\tquartout: function(i) {\n\t\t\treturn -((--i) * i * i * i - 1);\n\t\t},\n\n\t\t/**\n\t\t * Quartic ease-in-out\n\t\t *\n\t\t * @param {number} value\n\t\t * @returns {number} eased\n\t\t */\n\t\tquartinout: function(i) {\n\t\t\treturn (i < 0.5) ?\n\t\t\t\t8 * i * i * i * i :\n\t\t\t\t1 - (8 * (--i) * i * i * i);\n\t\t}\n\t};\n\n\treturn easing;\n});\n",
		"playtotv.define('playtotv.fx.Timeline', [\n\t'playtotv.fx.Animation'\n], function(\n\tAnimation\n) {\n\n\t'use strict';\n\n\t/**\n\t * Creates a timeline on which actions may be added. Like its super class Animation, timelines may be run at\n\t * different rates, and can cycle with or without alternating direction.\n\t *\n\t * @name Timeline\n\t * @class\n\t * @memberOf playtotv.fx\n\t * @extends playtotv.fx.Animation\n\t * @param {Object} options\n\t * @param {boolean} [options.alternate=false] Whether a timeline with multiple cycles alternates direction\n\t * @param {number} [options.cycles=1] Amount of repeating timeline cycles\n\t * @param {number} [options.duration=1000] Duration of one timeline cycle in ms\n\t * @param {number} [options.fps=0] Fps limit on requestAnimationFrame callbacks\n\t * @param {number} [options.rate=1] Time rate multiplier\n\t * @param {number} [options.start] Alternate start timestamp in ms; past starts mid-timeline, future delays start\n\t * @param {number} [options.to=1] End value\n\t */\n\treturn class Timeline extends Animation {\n\n\t\tconstructor(options) {\n\t\t\tsuper(options);\n\t\t\tthis.actions = [];\n\t\t}\n\n\t\t/**\n\t\t * Adds an action to the timeline at the given time, in the form of a callback. Actions are executed from the\n\t\t * timeline's onFrame() function, which is subject to the fps option value. Because of this, the given time is\n\t\t * an approximation of the actual time at which the action will be performed (with lower fps increasing the\n\t\t * possible deviation). Considerably lowering the fps or queuing actions closer to another than the time\n\t\t * between two consecutive frames may result in multiple actions being called in the same onFrame() callstack.\n\t\t *\n\t\t * @param {number} time Time relative to the start of the timeline at which the action is executed\n\t\t * @param {Object} action\n\t\t * @param {Function} action.callback Function to execute\n\t\t * @param {Object} [action.context] Optional context the callback will be applied to\n\t\t * @param {Array} [action.args] Optional array of callback arguments\n\t\t * @returns {Object} action\n\t\t */\n\t\tadd(time, action) {\n\t\t\taction = playtotv.params(action, {\n\t\t\t\tcallback: playtotv.REQUIRED,\n\t\t\t\tcontext: undefined,\n\t\t\t\targs: []\n\t\t\t});\n\n\t\t\tthis.actions.push(Object.assign(action, {\n\t\t\t\ttime: time,\n\t\t\t\trun: true\n\t\t\t}));\n\n\t\t\treturn action;\n\t\t}\n\n\t\t/**\n\t\t * Removes an action from the timeline. Accepts actions as given to or returned by add()\n\t\t *\n\t\t * @param {Object} action\n\t\t */\n\t\tremove(action) {\n\t\t\tvar index = this.actions.indexOf(action);\n\t\t\tif (index >= 0) {\n\t\t\t\tthis.actions.splice(index, 1);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Resets all actions when the timeline starts or cycles, allowing them to be run at their respective time.\n\t\t *\n\t\t */\n\t\treset() {\n\t\t\tthis.actions.forEach(function(frame) {\n\t\t\t\tframe.run = false;\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Called when the timeline starts, triggers a reset()\n\t\t *\n\t\t */\n\t\tonStart() {\n\t\t\tthis.reset();\n\t\t}\n\n\t\t/**\n\t\t * Called when a timeline with multiple cycles cycles, triggers a reset()\n\t\t *\n\t\t */\n\t\tonCycle() {\n\t\t\tthis.reset();\n\t\t}\n\n\t\t/**\n\t\t * Checks the elapsed time, and executes any actions of which the indicated time matches or has passed.\n\t\t *\n\t\t * @param {number} fraction\n\t\t */\n\t\tonFrame(n) {\n\t\t\tvar anim = this.animation;\n\t\t\tvar current = n * anim.duration;\n\t\t\tvar reverse = this.reversed;\n\n\t\t\tthis.actions.forEach(function(frame) {\n\t\t\t\tvar passed = current >= frame.time;\n\t\t\t\tif (!frame.run && ((reverse && !passed) || (!reverse && passed))) {\n\t\t\t\t\tframe.run = true;\n\t\t\t\t\tframe.callback.apply(frame.context, frame.args);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.fx.Transition', [\n\t'playtotv.fx.Animation',\n\t'playtotv.fx.easing'\n], function(\n\tAnimation,\n\teasing\n) {\n\n\t'use strict';\n\n\tvar transitionOptions = [ 'callback', 'easing', 'from', 'to' ];\n\n\t/**\n\t * Creates a transition that runs a requestAnimationFrame based callback over a given duration when played, passing\n\t * the current value between the from and to option values, based on the elapsed time since the transition started.\n\t *\n\t * @name Transition\n\t * @class\n\t * @memberOf playtotv.fx\n\t * @extends playtotv.fx.Animation\n\t * @param {Object} options\n\t * @param {boolean} [options.alternate=false] Whether a transition with multiple cycles alternates its direction\n\t * @param {Function} options.callback Callback that is called each frame with the current transtion value\n\t * @param {number} [options.cycles=1] Amount of animation cycles\n\t * @param {number} [options.duration=1000] Transition duration in ms\n\t * @param {string} [options.easing='linear'] callback value easing, see {@link playtotv.fx.easing}\n\t * @param {number} [options.fps=0] Frames per second cap, 0 for no cap\n\t * @param {number} [options.from=0] Starting value\n\t * @param {number} [options.rate=1] Time rate multiplier\n\t * @param {number} [options.start] Alternate start timestamp in ms; past starts mid-animation, future delays start\n\t * @param {number} [options.to=1] End value\n\t */\n\treturn class Transition extends Animation {\n\n\t\tconstructor(options) {\n\t\t\toptions = playtotv.params(options, {\n\t\t\t\talternate: false,\n\t\t\t\tcallback: playtotv.REQUIRED,\n\t\t\t\tcycles: 1,\n\t\t\t\tduration: playtotv.REQUIRED,\n\t\t\t\teasing: 'linear',\n\t\t\t\tfps: 0,\n\t\t\t\tfrom: 0,\n\t\t\t\trate: 1,\n\t\t\t\tstart: 0,\n\t\t\t\tto: 1\n\t\t\t});\n\n\t\t\tsuper(playtotv.omit(options, transitionOptions));\n\t\t\tthis.settings = options;\n\t\t}\n\n\t\t/** @lends playtotv.fx.Transition.prototype */\n\n\t\t/**\n\t\t * Calculates the current transition value based on the given animation fraction and any easing, and passes\n\t\t * this value to the transition's callback. This function is called via requestAnimationFrame (and may be\n\t\t * throttled further with the fps option) for optimized rendering performance.\n\t\t *\n\t\t * @param {number} fraction\n\t\t */\n\t\tonFrame(n) {\n\t\t\tvar animation = this.animation || this.settings;\n\t\t\tvar ease = this.ease || (this.ease = easing.get(animation.easing));\n\n\t\t\tanimation.callback(\n\t\t\t\tanimation.from + ((animation.to - animation.from) * ease(n))\n\t\t\t);\n\t\t}\n\t};\n});\n",
		"/**\n * Auto generated API: <tt>src/global/generic-content-api.js</tt>\n *\n * <b>DO NOT MODIFY! CHANGES WILL BE OVERWRITTEN THE NEXT TIME YOU UPDATE!</b>\n *\n * <b>Note:</b> These are not real functions but method definitions for\n * {@link playtotv.server.Server#call}.\n *\n * @name genericContentAPI\n * @memberOf playtotv.global\n * @namespace\n */\nplaytotv.define('playtotv.global.genericContentAPI', [], function() {\n\n\t'use strict';\n\n\treturn {\n\t\t/*jshint maxlen:300*/ // On occassion generated lines can be too long\n\n\t\t/** @lends playtotv.global.genericContentAPI */\n\n\t\t/**\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.category\n\t\t * @returns {Promise} Promise of response data (Object)\n\t\t */\n\t\tgetCategory: {\n\t\t\tlabel: 'genericContent.getCategory',\n\t\t\turl: '1/genericcontent/{category}'\n\t\t}\n\t};\n});\n",
		"/**\n * Auto generated API: <tt>src/global/global-data-api.js</tt>\n *\n * <b>DO NOT MODIFY! CHANGES WILL BE OVERWRITTEN THE NEXT TIME YOU UPDATE!</b>\n *\n * <b>Note:</b> These are not real functions but method definitions for\n * {@link playtotv.server.Server#call}.\n *\n * @name globalDataAPI\n * @memberOf playtotv.global\n * @namespace\n */\nplaytotv.define('playtotv.global.globalDataAPI', [], function() {\n\n\t'use strict';\n\n\treturn {\n\t\t/*jshint maxlen:300*/ // On occassion generated lines can be too long\n\n\t\t/** @lends playtotv.global.globalDataAPI */\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} [params.timeZone]\n\t\t * @returns {Promise} Promise of response data (GlobalDataDTO)\n\t\t */\n\t\tget: {\n\t\t\tlabel: 'globalData.get',\n\t\t\turl: '1/globaldata/',\n\t\t\tqueryKeys: [\n\t\t\t\t'timeZone'\n\t\t\t]\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.handlebars.hbsUtil', [], function() {\n\t/*global Handlebars:false*/\n\n\t'use strict';\n\n\tvar hbsUtil = {\n\t\t// Throw Exception, but in separate tick so as not to break down subsequent code execution\n\t\tsoftException: function(message) {\n\t\t\tvar exception = new Handlebars.Exception(message);\n\t\t\twindow.nextTick(function() {\n\t\t\t\tthrow exception;\n\t\t\t});\n\t\t\treturn '';\n\t\t},\n\n\t\t// Call if value is a getter function otherwise just return value as-is\n\t\tgetValue: function(context, value) {\n\t\t\treturn value instanceof Function ? value.call(context) : value;\n\t\t},\n\n\t\tgetHash: function(context, hash) {\n\t\t\treturn Object.keys(hash).reduce(function(newHash, key) {\n\t\t\t\tnewHash[key] = this.getValue(context, hash[key]);\n\t\t\t\treturn newHash;\n\t\t\t}.bind(this), {});\n\t\t},\n\n\t\tgetArgs: function(context, args, names, nrRequired, nrOptional) {\n\t\t\targs = Array.from(args);\n\t\t\tvar options = args.pop();\n\t\t\targs = args.map(arg => this.getValue(context, arg));\n\n\t\t\tvar map = {\n\t\t\t\targs: args,\n\t\t\t\toptions: options,\n\t\t\t\thash: this.getHash(context, options.hash)\n\t\t\t};\n\n\t\t\t// If defined then validate and map required and optional arguments to their names\n\t\t\tif (names) {\n\t\t\t\tnames = names.split(', ');\n\n\t\t\t\tvar nrNames = names.length;\n\t\t\t\tnrRequired = nrRequired !== undefined ? nrRequired : nrNames;\n\t\t\t\tnrOptional = nrOptional !== undefined ? nrOptional : nrNames - nrRequired;\n\t\t\t\tvar nrArgs = args.length;\n\t\t\t\tif (nrArgs < nrRequired || nrArgs > nrRequired + nrOptional) {\n\t\t\t\t\tvar requiredNames = names.slice(0, nrRequired);\n\t\t\t\t\tvar optionalNames = names.slice(nrRequired, nrOptional);\n\t\t\t\t\tthis.softException(\n\t\t\t\t\t\toptions.name + ' got invalid number of arguments, ' +\n\t\t\t\t\t\t' expected: ' + nrRequired + (nrOptional ? ' to ' + (nrRequired + nrOptional) : '') + ' (' +\n\t\t\t\t\t\trequiredNames.concat(optionalNames.map(function(n) { return '[' + n + ']'; })).join(', ') +\n\t\t\t\t\t\t'), but got: ' + nrArgs + ' (' + args.join(', ') + ')'\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tnames.forEach(function(name, i) {\n\t\t\t\t\tmap[name] = args[i];\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn map;\n\t\t},\n\n\t\textendContext: function(context, hash) {\n\t\t\t// Note: Using hash context extending will break any context prototype chaining\n\t\t\treturn hash instanceof Object && Object.keys(hash).length > 0 ?\n\t\t\t\tObject.assign({}, context, hash) :\n\t\t\t\tcontext;\n\t\t},\n\n\t\tcallHelper: function(name, context, ...args) {\n\t\t\treturn Handlebars.helpers[name].apply(context, args);\n\t\t},\n\n\t\tdelegateIfBlock: function(helperName, context, value, options, clearHash) {\n\t\t\tif (options.fn) {\n\t\t\t\tif (clearHash) {\n\t\t\t\t\toptions = Object.assign({}, options, { hash: {} });\n\t\t\t\t}\n\t\t\t\treturn this.callHelper(helperName, context, value, options);\n\t\t\t}\n\n\t\t\treturn value;\n\t\t}\n\t};\n\n\treturn hbsUtil;\n});\n",
		"playtotv.define('playtotv.handlebars.helpers', [\n\t'playtotv.handlebars.hbsUtil'\n], function(\n\thbsUtil\n) {\n\t/*global Handlebars:false*/\n\n\t// TODO: JSDOC\n\n\t'use strict';\n\n\t// For more helper inspiration see:\n\t// http://assemble.io/helpers\n\t// http://elving.github.io/swag\n\t// https://github.com/shannonmoeller/handlebars-layouts (OO Templating)\n\t// https://github.com/wycats/handlebars.js/issues/208 (Inline partial overriding/inheritance)\n\n\tvar ptv = playtotv;\n\tvar util = ptv.util;\n\n\tvar helpers = {\n\t\t/** @lends playtotv.handlebars.helpers */\n\n\t\t/**\n\t\t * Change Handlebars variable values by hash, making them available through @key data references.\n\t\t * Calling this as a block helper is usually the best thing to do as it will not leak outside of it's block.\n\t\t * As a non-block helper this will change the variable value within the current render frame context.\n\t\t *\n\t\t * Note: Variables will be available in child blocks with different contexts like {{#with}} as well.\n\t\t *\n\t\t * @example\n\t\t * Template: {{#var x=\"foo\"}} {{@x}}bar {{/var}}\n\t\t * Template: {{var x=\"foo\"}} {{@x}}bar\n\t\t * Output: foobar\n\t\t */\n\t\tvar: function() {\n\t\t\tvar { options, hash } = hbsUtil.getArgs(this, arguments, '');\n\t\t\tvar { fn, data } = options;\n\n\t\t\t// If called as block helper then frame our data so that we do not override variables in our parent block\n\t\t\t// If not called as block helper then let the variable changes operate through side effects\n\t\t\tif (fn) {\n\t\t\t\tdata = Handlebars.createFrame(data);\n\t\t\t}\n\n\t\t\tObject.assign(data, hash);\n\n\t\t\treturn fn ? fn(this, { data: data }) : '';\n\t\t},\n\n\t\t/**\n\t\t * @example\n\t\t * Template: {{#is state \"ok\"}} Cool {{else}} Oh no! {{/is}}\n\t\t */\n\t\tis: function() {\n\t\t\tvar { value1, value2, options } = hbsUtil.getArgs(this, arguments, 'value1, value2');\n\t\t\treturn hbsUtil.delegateIfBlock('if', this, value1 === value2, options);\n\t\t},\n\n\t\t/**\n\t\t * @example\n\t\t * Template: {{#isnt state \"bad\"}} Cool {{else}} Oh no! {{/isnt}}\n\t\t */\n\t\tisnt: function() {\n\t\t\tvar { value1, value2, options } = hbsUtil.getArgs(this, arguments, 'value1, value2');\n\t\t\treturn hbsUtil.delegateIfBlock('if', this, value1 !== value2, options);\n\t\t},\n\n\t\tdefault: function() {\n\t\t\tvar { value, def } = hbsUtil.getArgs(this, arguments, 'value, def');\n\t\t\treturn value === undefined ? def : value;\n\t\t},\n\n\t\t/**\n\t\t * Note: The def argument is optional.\n\t\t *\n\t\t * @example\n\t\t * Data: { state: 'y' }\n\t\t * Template: {{switch state \"Default\" x=\"Foo\" y=\"Bar\"}}\n\t\t * Output: Bar\n\t\t */\n\t\tswitch: function() {\n\t\t\tvar { value, def, hash } = hbsUtil.getArgs(this, arguments, 'value, def', 1);\n\t\t\tif (Object.keys(hash).indexOf(value) >= 0) {\n\t\t\t\treturn hash[value];\n\t\t\t} else if (def === undefined) {\n\t\t\t\treturn hbsUtil.softException('No matching case or default for value: ' + value);\n\t\t\t} else {\n\t\t\t\treturn def;\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * @example\n\t\t * Data: { isFoo: true, isBar: false }\n\t\t * Template: &lt;li class=\"{{classes foo=isFoo bar=isBar}}\">\n\t\t * Output: &lt;li class=\"foo\">\n\t\t */\n\t\tclasses: function() {\n\t\t\tvar { hash } = hbsUtil.getArgs(this, arguments);\n\t\t\tvar str = '';\n\t\t\tptv.each(hash, function(value, key) {\n\t\t\t\tif (value) {\n\t\t\t\t\tstr = str ? str + ' ' + key : key;\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t\treturn str;\n\t\t},\n\n\t\t/**\n\t\t * Data: { x: 3 }\n\t\t *\n\t\t * Example: {{inc x}}\n\t\t * Output: 4\n\t\t *\n\t\t * Example: {{inc x 2}}\n\t\t * Output: 5\n\t\t */\n\t\tinc: function() {\n\t\t\tvar { x, y } = hbsUtil.getArgs(this, arguments, 'x, y', 1);\n\t\t\ty = y === undefined ? 1 : y;\n\t\t\treturn x + y;\n\t\t},\n\n\t\t/**\n\t\t * Data: { x: 3 }\n\t\t *\n\t\t * Example: {{dec x}}\n\t\t * Output: 2\n\t\t *\n\t\t * Example: {{dec x 2}}\n\t\t * Output: 1\n\t\t */\n\t\tdec: function() {\n\t\t\tvar { x, y } = hbsUtil.getArgs(this, arguments, 'x, y', 1);\n\t\t\ty = y === undefined ? 1 : y;\n\t\t\treturn x - y;\n\t\t},\n\n\t\t/**\n\t\t * Example: {{#gt x 10}} Wow! {{else}} Meh.. {{/gt}}\n\t\t * Can also be used to compose sub-expressions.\n\t\t */\n\t\tgt: function() {\n\t\t\tvar { x, y, options } = hbsUtil.getArgs(this, arguments, 'x, y');\n\t\t\treturn hbsUtil.delegateIfBlock('if', this, x > y, options);\n\t\t},\n\n\t\t/**\n\t\t * Example: {{#lt x 10}} Meh.. {{else}} Wow! {{/lt}}\n\t\t * Can also be used to compose sub-expressions.\n\t\t */\n\t\tlt: function() {\n\t\t\tvar { x, y, options } = hbsUtil.getArgs(this, arguments, 'x, y');\n\t\t\treturn hbsUtil.delegateIfBlock('if', this, x < y, options);\n\t\t},\n\n\t\t/**\n\t\t * Example: {{#not x}} is equal to {{#unless x}}\n\t\t * Can also be used to compose sub-expressions.\n\t\t */\n\t\tnot: function() {\n\t\t\tvar { value, options } = hbsUtil.getArgs(this, arguments, 'value');\n\t\t\treturn hbsUtil.delegateIfBlock('if', this, !value, options);\n\t\t},\n\n\t\t/**\n\t\t * Example: {{#or x y z}} is equal to {{#if (eval 'x || y || z')}}\n\t\t * Can also be used to compose sub-expressions.\n\t\t */\n\t\tor: function() {\n\t\t\tvar { args, options } = hbsUtil.getArgs(this, arguments);\n\t\t\tvar result = args.find(arg => arg);\n\t\t\treturn hbsUtil.delegateIfBlock('if', this, result, options);\n\t\t},\n\n\t\t/**\n\t\t * Example: {{#and x y z}} is equal to {{#if (eval 'x && y && z')}}\n\t\t * Can also be used to compose sub-expressions.\n\t\t */\n\t\tand: function() {\n\t\t\tvar { args, options } = hbsUtil.getArgs(this, arguments);\n\t\t\tvar result = args.reduce((result, arg) => result && arg, true);\n\t\t\treturn hbsUtil.delegateIfBlock('if', this, result, options);\n\t\t},\n\n\t\t/**\n\t\t * Example: {{#inArray (Array 2 3 5 7) x}}small prime{{/inArray}}\n\t\t * Can also be used to compose sub-expressions.\n\t\t */\n\t\tinArray: function() {\n\t\t\tvar { list, value, options } = hbsUtil.getArgs(this, arguments, 'list, value');\n\t\t\treturn hbsUtil.delegateIfBlock('if', this, list.indexOf(value) >= 0, options);\n\t\t},\n\n\t\tArray: function() {\n\t\t\tvar { args, options } = hbsUtil.getArgs(this, arguments);\n\t\t\treturn hbsUtil.delegateIfBlock('each', this, args, options);\n\t\t},\n\n\t\tObject: function() {\n\t\t\tvar { options, hash } = hbsUtil.getArgs(this, arguments);\n\t\t\treturn hbsUtil.delegateIfBlock('with', this, hash, options);\n\t\t},\n\n\t\ttoNumber: function() {\n\t\t\tvar { str } = hbsUtil.getArgs(this, arguments, 'str');\n\t\t\treturn parseFloat(str);\n\t\t},\n\n\t\ttoBool: function() {\n\t\t\tvar { str } = hbsUtil.getArgs(this, arguments, 'str');\n\t\t\treturn str === 'true' ? true : false;\n\t\t},\n\n\t\t// To: 'foo bar'\n\t\tlowerCase: function() {\n\t\t\tvar { text } = hbsUtil.getArgs(this, arguments, 'text');\n\t\t\treturn ('' + text).toLowerCase();\n\t\t},\n\n\t\t// To: 'FOO BAR'\n\t\tupperCase: function() {\n\t\t\tvar { text } = hbsUtil.getArgs(this, arguments, 'text');\n\t\t\treturn ('' + text).toUpperCase();\n\t\t},\n\n\t\t// To: 'foo-bar'\n\t\tdashCase: function() {\n\t\t\tvar { text } = hbsUtil.getArgs(this, arguments, 'text');\n\t\t\treturn util.dashCase('' + text);\n\t\t},\n\n\t\t// To: 'Foo bar'\n\t\tsentenceCase: function() {\n\t\t\tvar { text } = hbsUtil.getArgs(this, arguments, 'text');\n\t\t\ttext = '' + text;\n\t\t\treturn text[0].toUpperCase() + text.substr(1).toLowerCase();\n\t\t},\n\n\t\t// To: 'Foo Bar'\n\t\ttitleCase: function() {\n\t\t\tvar { text } = hbsUtil.getArgs(this, arguments, 'text');\n\t\t\treturn util.titleCase('' + text);\n\t\t},\n\n\t\tconcat: function() {\n\t\t\tvar { args } = hbsUtil.getArgs(this, arguments);\n\t\t\treturn args.join('');\n\t\t},\n\n\t\t/**\n\t\t * @example\n\t\t * Data: { names: [ 'John', 'Mary', 'Elizabeth' ] }\n\t\t * Template 1: {{join names last=\" and \"}}\n\t\t * Template 2: {{#join names last=\" and \"}}{{.}}{{/join}}\n\t\t * Output: John, Mary and Elizabeth\n\t\t */\n\t\tjoin: function() {\n\t\t\tvar { array, hash, options } = hbsUtil.getArgs(this, arguments, 'array');\n\t\t\tvar { fn, inverse } = options;\n\t\t\tvar separator = hash.separator || ', ';\n\t\t\tvar last = hash.last || separator;\n\t\t\tarray = fn ? array.map(fn) : array.slice(0);\n\t\t\tvar len = array.length;\n\t\t\treturn len === 0 ? (inverse ? inverse(this) : '') :\n\t\t\t\tlen === 1 ? array[0] :\n\t\t\t\tarray.slice(0, -1).join(separator) + last + array[len - 1];\n\t\t},\n\n\t\t/**\n\t\t * @example\n\t\t * Data: { str: 'John, Mary,Elizabeth' }\n\t\t * Template: -{{#split str}}{{.}}-{{/split}}\n\t\t * Output: -John-Mary-Elizabeth-\n\t\t */\n\t\tsplit: function() {\n\t\t\tvar { str, hash, options } = hbsUtil.getArgs(this, arguments, 'str');\n\t\t\tvar separator = hash.separator || /,\\s?/;\n\t\t\tvar array = str.length > 0 ? str.split(separator) : [];\n\t\t\treturn hbsUtil.delegateIfBlock('each', this, array, options, true);\n\t\t},\n\n\t\t/**\n\t\t * @example\n\t\t * Template: {{inflect nrEnemies \"one enemy\" \"%d enemies\"}}\n\t\t * Output: 3 enemies\n\t\t */\n\t\tinflect: function() {\n\t\t\tvar { count, singular, plural } = hbsUtil.getArgs(this, arguments, 'count, singular, plural');\n\t\t\tvar result = count === 1 ? singular : plural;\n\t\t\treturn result.replace(/%d/g, count);\n\t\t},\n\n\t\t/**\n\t\t * @example\n\t\t * Template: {{truncate \"Bender should not be allowed on tv.\" 10}}\n\t\t * Template: {{truncate \"Bender should not be allowed on tv.\" 10 dots=\"..\"}}\n\t\t * Output: Bender s..\n\t\t */\n\t\ttruncate: function() {\n\t\t\tvar { str, len, hash } = hbsUtil.getArgs(this, arguments, 'str, len');\n\t\t\tvar dots = hash.dots || '..';\n\t\t\tif (str.length > len) {\n\t\t\t\tstr = str.substr(0, len - dots.length) + dots;\n\t\t\t}\n\t\t\treturn str;\n\t\t},\n\n\t\t/**\n\t\t * Returns URL with hash added as query parameters.\n\t\t * The url argument defaults to location.href.\n\t\t */\n\t\taddURLParams: function() {\n\t\t\tvar { url, hash } = hbsUtil.getArgs(this, arguments, 'url', 0);\n\t\t\turl = url || window.location.href;\n\t\t\treturn util.addURLParams(url, hash);\n\t\t},\n\n\t\t/**\n\t\t * Returns hash of url's query parameters.\n\t\t * The url argument defaults to location.href.\n\t\t */\n\t\tgetURLParams: function() {\n\t\t\tvar { url } = hbsUtil.getArgs(this, arguments, 'url', 0);\n\t\t\turl = url || window.location.href;\n\t\t\treturn util.getURLParams(url);\n\t\t},\n\n\t\t/**\n\t\t * Returns value of url's query parameter with specified key.\n\t\t * You can call this with two arguments (url, key) or with one (key).\n\t\t * In the latter case the url argument defaults to location.href.\n\t\t */\n\t\tgetURLParam: function() {\n\t\t\tvar { urlOrKey, key } = hbsUtil.getArgs(this, arguments, 'urlOrKey, key', 1);\n\t\t\tvar url = key ? urlOrKey : '';\n\t\t\tkey = key || urlOrKey;\n\t\t\treturn util.getURLParams(url)[key];\n\t\t},\n\n\t\t/**\n\t\t * Returns specified or current date formatted with specified pattern using {@link playtotv.util.formatDate}.\n\t\t */\n\t\tformatDate: function() {\n\t\t\tvar { pattern, date } = hbsUtil.getArgs(this, arguments, 'pattern, date', 1);\n\t\t\treturn util.formatDate(pattern, date);\n\t\t},\n\n\t\t/**\n\t\t * @example\n\t\t * Template: {{addCommas 1000}}\n\t\t * Output: 1,000\n\t\t *\n\t\t * Template: {{addCommas 1000 \".\"}}\n\t\t * Output: 1.000\n\t\t *\n\t\t * Template: {{addCommas 1000.123}}\n\t\t * Output: 1,000.123\n\t\t */\n\t\taddCommas: function() {\n\t\t\tvar { number, separator } = hbsUtil.getArgs(this, arguments, 'number, separator', 1, 1);\n\n\t\t\tif (separator === undefined) {\n\t\t\t\tseparator = ',';\n\t\t\t}\n\n\t\t\tvar decimal = (separator === ',') ? '.' : ',';\n\t\t\tvar parts = number.toString().split('.');\n\n\t\t\treturn parts[0].replace(/\\B(?=(\\d{3})+(?!\\d))/g, separator) + (parts[1] ? decimal + parts[1] : '');\n\t\t},\n\n\t\t/**\n\t\t * @example\n\t\t * Template: {{toFixed 1.23456}}\n\t\t * Output: 1.23\n\t\t *\n\t\t * Template: {{toFixed 1.23456 4}}\n\t\t * Output: 1.2345\n\t\t *\n\t\t * Template: {{toFixed 1.23456 0}}\n\t\t * Output: 1\n\t\t */\n\t\ttoFixed: function() {\n\t\t\tvar { value, digits } = hbsUtil.getArgs(this, arguments, 'value, digits', 1, 1);\n\n\t\t\tif (digits === undefined) {\n\t\t\t\tdigits = 2;\n\t\t\t}\n\n\t\t\treturn value.toFixed(digits);\n\t\t},\n\n\t\t/**\n\t\t * Transform value to string\n\t\t *\n\t\t * @example\n\t\t * Template: {{toString 1.23}}\n\t\t * Output: 1.23\n\t\t */\n\t\ttoString: function() {\n\t\t\tvar { value } = hbsUtil.getArgs(this, arguments, 'value', 1, 0);\n\t\t\treturn String(value);\n\t\t},\n\n\t\t/**\n\t\t * @example\n\t\t * Template: {{pad 1}}\n\t\t * Output: 01\n\t\t *\n\t\t * Template: {{pad 1 10}}\n\t\t * Output: 0000000001\n\t\t *\n\t\t * Template: {{pad 1 10 \"-\"}}\n\t\t * Output: ---------1\n\t\t */\n\t\tpad: function() {\n\t\t\tvar { value, len, ch } = hbsUtil.getArgs(this, arguments, 'value, len, ch', 1, 2);\n\t\t\treturn util.pad(value, len, ch);\n\t\t},\n\n\t\t// TODO: More helpers like:\n\t\t//   L10n: (see also: mozilla l20n, cordova globalization, etc.)\n\t\t//     {{l10n \"Translate this\"}}\n\t\t//     {{ordinalize 3}} => 3rd\n\t\t//     {{toPrecision 555.322 4}} => 555.3\n\t\t//     {{formatNumber number type=\"decimal|percent|currency\"}}\n\t\t//     {{formatPhoneNumber 4444444444}} => (444) 444-4444\n\n\t\tseek: function() {\n\t\t\tvar { path, context } = hbsUtil.getArgs(this, arguments, 'path, context', 1);\n\t\t\tcontext = context || this;\n\t\t\treturn util.seek(context, path);\n\t\t},\n\n\t\teval: function() {\n\t\t\tvar { script, context, hash, options } = hbsUtil.getArgs(this, arguments, 'script, context', 0);\n\n\t\t\t// Default to this render context, but if hash properties are passed, use those as context instead\n\t\t\tcontext = context || this;\n\t\t\tif (Object.keys(hash).length > 0) {\n\t\t\t\tcontext = hash;\n\t\t\t}\n\n\t\t\t// If called with a block then the block is the script\n\t\t\tif (options.fn) {\n\t\t\t\tscript = options.fn(this);\n\t\t\t}\n\n\t\t\treturn util.eval(script, context);\n\t\t},\n\n\t\ttake: function() {\n\t\t\tvar { array, nr, options } = hbsUtil.getArgs(this, arguments, 'array, nr', 1);\n\t\t\tnr = nr === undefined ? 1 : nr;\n\t\t\tvar taken = array.slice(0, nr);\n\t\t\treturn hbsUtil.delegateIfBlock('each', this, taken, options);\n\t\t},\n\n\t\t/**\n\t\t * Returns list filtered by value specified by item path matching value by specified mode.\n\t\t * If used as block helper this delegates to \"each\" helper.\n\t\t */\n\t\tfilter: function() {\n\t\t\tvar { list, path, value, hash, options } = hbsUtil.getArgs(this, arguments, 'list, path, value', 1);\n\t\t\tvar { mode } = hash;\n\t\t\tvar filtered = util.filter(list, path, value, mode);\n\t\t\treturn hbsUtil.delegateIfBlock('each', this, filtered, options, true);\n\t\t},\n\n\t\t/**\n\t\t * Returns list ordered by value specified by item path, optionally descending.\n\t\t * If used as block helper this delegates to \"each\" helper.\n\t\t */\n\t\torder: function() {\n\t\t\tvar { list, path, hash, options } = hbsUtil.getArgs(this, arguments, 'list, path', 1);\n\t\t\tvar { desc } = hash;\n\t\t\tvar ordered = util.order(list, path, desc);\n\t\t\treturn hbsUtil.delegateIfBlock('each', this, ordered, options, true);\n\t\t},\n\n\t\t/**\n\t\t * Returns specified page of list with added properties: page, prev, next and last.\n\t\t * If used as a block helper this delegates to \"each\" helper.\n\t\t */\n\t\tpaginate: function() {\n\t\t\tvar { list, page, size, options } = hbsUtil.getArgs(this, arguments, 'list, page, size', 1);\n\t\t\tpage = parseInt(page, 10);\n\t\t\tsize = parseInt(size, 10);\n\t\t\tvar paged = util.page(list, page, size);\n\t\t\treturn hbsUtil.delegateIfBlock('each', this, paged, options, true);\n\t\t},\n\n\t\tjson: function() {\n\t\t\tvar { obj, hash } = hbsUtil.getArgs(this, arguments, 'obj');\n\t\t\treturn hash.pretty ? JSON.stringify(obj, null, '\t') :  JSON.stringify(obj);\n\t\t},\n\n\t\t/**\n\t\t * Returns hash path relative to current hash or current hash if no path is specified\n\t\t *\n\t\t * @example\n\t\t * From: #/episodes/ep1/schedule\n\t\t * Data: { interactionId: 'abc123' }\n\t\t *\n\t\t * Template: {{hash}}\n\t\t * Output: #/episodes/ep1/schedule\n\t\t *\n\t\t * Template: {{hash \"interaction/create\"}}\n\t\t * Output: #/episodes/ep1/interaction/create\n\t\t *\n\t\t * Template: {{hash \"../ep2/\"}}\n\t\t * Output: #/episodes/ep2/\n\t\t *\n\t\t * Template: {{hash \"interaction/\" interactionId \"/edit\"}}\n\t\t * Output: #/episodes/ep1/interaction/abc123/edit\n\t\t */\n\t\thash: function() {\n\t\t\tvar hash = window.location.hash;\n\t\t\tvar { args } = hbsUtil.getArgs(this, arguments);\n\t\t\tvar path = args.join('');\n\t\t\tif (!path) {\n\t\t\t\treturn hash;\n\t\t\t}\n\t\t\tvar from = hash.slice(1); // strip leading #\n\t\t\tif (from) {\n\t\t\t\tpath = util.resolvePath(from, path);\n\t\t\t}\n\t\t\treturn '#' + path;\n\t\t},\n\n\t\thelperMissing: function() {\n\t\t\tvar options = arguments[arguments.length - 1];\n\t\t\thbsUtil.softException('Unknown field or helper: ' + options.name);\n\t\t}\n\t};\n\n\treturn helpers;\n});\n",
		"playtotv.define('playtotv.pubsub.Subscription', [], function() {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar util = ptv.util;\n\n\treturn class Subscription {\n\t\t/** @lends playtotv.pubsub.Subscription.prototype */\n\n\t\t/**\n\t\t * Class used to represent a {@link playtotv.pubsub.PubSub} Subscription.\n\t\t *\n\t\t * When a selector string contains star (*) characters it is converted to a basic glob RegExp.\n\t\t *\n\t\t * @constructs\n\t\t * @param {string|RegExp} selector Channel selector\n\t\t * @param {Function} handler Subscription callback\n\t\t * @throws {TypeError} If selector or handler is invalid\n\t\t *\n\t\t * @property {string|RegExp} selector\n\t\t * @property {Function} handler\n\t\t */\n\t\tconstructor(selector, handler) {\n\t\t\tif (!(typeof selector === 'string' || selector instanceof RegExp)) {\n\t\t\t\tthrow new TypeError('Invalid selector (not a string or RegExp)');\n\t\t\t}\n\t\t\tif (!(handler instanceof Function)) {\n\t\t\t\tthrow new TypeError('Invalid handler (not a function)');\n\t\t\t}\n\n\t\t\tif (typeof selector === 'string' && selector.indexOf('*') >= 0) {\n\t\t\t\tselector = util.globToRegEx(selector);\n\t\t\t}\n\n\t\t\tthis.selector = selector;\n\t\t\tthis.handler = handler;\n\t\t}\n\n\t\t/**\n\t\t * Returns true if this subscription's selector matches specified channel.\n\t\t *\n\t\t * @param {string} channel Channel to match\n\t\t * @returns {boolean} True if this subscription's selector matches specified channel\n\t\t */\n\t\tmatch(channel) {\n\t\t\tvar selector = this.selector;\n\t\t\treturn typeof selector === 'string' ? selector === channel : selector.test(channel);\n\t\t}\n\n\t\t/**\n\t\t * Deliver data to handler on specified channel.\n\t\t *\n\t\t * If subscription has been disposed then handler will no longer be called.\n\t\t *\n\t\t * Handler will be called with this subscription as thisArg.\n\t\t *\n\t\t * @param {mixed} [data] Data to deliver\n\t\t * @param {string} channel Channel we are delivering to\n\t\t */\n\t\tdeliver(data, channel) {\n\t\t\tif (this.handler) {\n\t\t\t\tthis.handler(data, channel);\n\t\t\t}\n\t\t}\n\n\t\tdispose() {\n\t\t\tptv.dispose(this);\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.model.ModelSubscription', [\n\t'playtotv.pubsub.Subscription'\n], function(\n\tSubscription\n) {\n\n\t'use strict';\n\n\tvar util = playtotv.util;\n\n\treturn class ModelSubscription extends Subscription {\n\t\t/** @lends playtotv.model.ModelSubscription.prototype */\n\n\t\t/**\n\t\t * Class used to represent an {@link playtotv.model.AbstractModel} Subscription.\n\t\t *\n\t\t * @extends playtotv.pubsub.Subscription\n\t\t * @constructs\n\t\t * @param {string} selector Model selector string\n\t\t * @param {Function} handler Subscription callback\n\t\t * @throws {Error} If selector string is invalid\n\t\t *\n\t\t * @property {string|RegExp} selector Model selector string converted to channel string or RegExp\n\t\t * @property {Function} handler Subscription callback\n\t\t */\n\t\tconstructor(selector, handler) {\n\t\t\tif (!/^([\\w\\*]+:[\\w\\*\\.]+(=.*)?)|\\*$/.test(selector)) {\n\t\t\t\tthrow new Error('Invalid selector string: ' + selector);\n\t\t\t}\n\n\t\t\t// Convert model selector into RegExp\n\t\t\tif (selector === '*') {\n\t\t\t\tselector = /.*/;\n\t\t\t} else {\n\t\t\t\tvar noValue = selector.indexOf('=') === -1;\n\t\t\t\tif (noValue) {\n\t\t\t\t\tselector += '=';\n\t\t\t\t}\n\t\t\t\tif (noValue || selector.indexOf('*') !== -1) {\n\t\t\t\t\tselector = util.escapeRegEx(selector);\n\t\t\t\t\tselector = selector.replace(/\\\\\\*/g, '[^:\\\\.=]+');\n\t\t\t\t\tselector = new RegExp('^' + selector);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tsuper(selector, handler);\n\t\t}\n\n\t\t/**\n\t\t * Deliver data to handler.\n\t\t *\n\t\t * If subscription has been disposed then handler will no longer be called.\n\t\t *\n\t\t * Handler will be called with this subscription as thisArg and data.value, data.action, data.key as arguments.\n\t\t *\n\t\t * @param {mixed} [data] Data to deliver\n\t\t * @param {string} channel Channel we are delivering to\n\t\t */\n\t\tdeliver(data/*, channel*/) {\n\t\t\tif (this.handler) {\n\t\t\t\tthis.handler(data.value, data.action, data.key);\n\t\t\t}\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.pubsub.PubSub', [\n\t'playtotv.pubsub.Subscription'\n], function(\n\tSubscription\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\n\tfunction remove(list, item) {\n\t\tvar index = list.indexOf(item);\n\t\tif (index !== -1) {\n\t\t\tlist.splice(index, 1);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\treturn class PubSub {\n\t\t/** @lends playtotv.pubsub.PubSub.prototype */\n\n\t\t/**\n\t\t * Class for managing publishing of data to handlers subscribed to channels.\n\t\t *\n\t\t * @constructs\n\t\t *\n\t\t * @property {[playtotv.pubsub.Subscription]} subscriptions Subscriptions container array\n\t\t * @property {[Promise.Cancellable]} cancellables List of active cancellables\n\t\t */\n\t\tconstructor() {\n\t\t\tthis.subscriptions = [];\n\t\t\tthis.cancellables = [];\n\t\t}\n\n\t\t/**\n\t\t * Creates and adds a subscription.\n\t\t *\n\t\t * @param {string|RegExp} selector Channel selector\n\t\t * @param {Function} handler Subscription callback\n\t\t * @throws {TypeError} If selector or handler is invalid\n\t\t * @returns {playtotv.pubsub.Subscription} Added subscription\n\t\t */\n\t\tsubscribe(selector, handler) {\n\t\t\tvar subscription = new Subscription(selector, handler);\n\t\t\tthis.subscriptions.push(subscription);\n\t\t\treturn subscription;\n\t\t}\n\n\t\t/**\n\t\t * Removes and disposes a subscription.\n\t\t *\n\t\t * @param {playtotv.pubsub.Subscription} subscription Subscription to remove\n\t\t * @returns {boolean} True if subscription was successfully removed\n\t\t */\n\t\tunsubscribe(subscription) {\n\t\t\tvar subscriptions = this.subscriptions;\n\t\t\tsubscription.dispose();\n\t\t\treturn subscriptions ? remove(subscriptions, subscription) : false;\n\t\t}\n\n\t\t/**\n\t\t * Convenience method to make a number of subscriptions at once.\n\t\t *\n\t\t * @param {Array} args Array of argument arrays to apply to {@link playtotv.pubsub.PubSub#subscribe}\n\t\t * @returns {[playtotv.pubsub.Subscription]} Array of subscriptions\n\t\t */\n\t\tsubscribeAll(args) {\n\t\t\tvar i, len = args.length;\n\t\t\tvar subscriptions = [];\n\t\t\tfor (i = 0; i < len; i++) {\n\t\t\t\tsubscriptions.push(this.subscribe.apply(this, args[i]));\n\t\t\t}\n\t\t\treturn subscriptions;\n\t\t}\n\n\t\t/**\n\t\t * Convenience method to remove a number of subscriptions at once.\n\t\t *\n\t\t * @param {[playtotv.pubsub.Subscription]} [subscriptions=this.subscriptions] Subscriptions to unsubscribe\n\t\t */\n\t\tunsubscribeAll(subscriptions) {\n\t\t\tsubscriptions = subscriptions || this.subscriptions;\n\t\t\tvar i, len = subscriptions.length;\n\t\t\tfor (i = 0; i < len; i++) {\n\t\t\t\tthis.unsubscribe(subscriptions[i]);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Creates a one-time subscription and returns a cancellable promise that resolves on it's first match.\n\t\t *\n\t\t * A reference is also added to cancellables so that it can be cancelled on dispose.\n\t\t *\n\t\t * @param {string} selector Selector to match\n\t\t * @returns {Promise.Cancellable} Cancellable promise which will resolve when selector first matches\n\t\t */\n\t\twhen(selector) {\n\t\t\tvar cancellables = this.cancellables;\n\t\t\tvar pubsub = this;\n\t\t\treturn new Promise.Cancellable(function(resolve) {\n\t\t\t\tvar cancellable = this;\n\t\t\t\tcancellables.push(cancellable);\n\n\t\t\t\tvar subscription = pubsub.subscribe(selector, function(data) {\n\t\t\t\t\tresolve(data);\n\t\t\t\t});\n\n\t\t\t\tcancellable.finally(function() {\n\t\t\t\t\tpubsub.unsubscribe(subscription);\n\t\t\t\t\tremove(cancellables, cancellable);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Publish data to specified channel and notify all subscribers with matching selectors.\n\t\t *\n\t\t * The handler is called asynchronously to provide consistent code execution order.\n\t\t * As an added benefit this also prevents an exception in one callback from interrupting any other callbacks.\n\t\t *\n\t\t * @param {string} channel Channel to publish to\n\t\t * @param {mixed} [data] Data to publish\n\t\t * @param {boolean} [sync=false] Publish synchronously (beware of exceptions!)\n\t\t */\n\t\tpublish(channel, data, sync) {\n\t\t\t// Code below has been optimized for performance, hence no pretty use of forEach etc.\n\t\t\tvar subscriptions = this.subscriptions;\n\t\t\tvar len = subscriptions.length;\n\t\t\tvar i, subscription, match;\n\t\t\tfor (i = 0; i < len; i++) {\n\t\t\t\tsubscription = subscriptions[i];\n\t\t\t\tmatch = subscription.match(channel);\n\t\t\t\tif (match) {\n\t\t\t\t\tif (sync) {\n\t\t\t\t\t\tsubscription.deliver(data, channel);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// TODO: Add matches as third argument in case you specified a RegExp as selector\n\t\t\t\t\t\t// And with wildcard selector strings\n\t\t\t\t\t\t// Or as second argument (instead of full channel)\n\t\t\t\t\t\t// That way you can easily subscribe to 'foo-*' and then deal with the value of '*'\n\t\t\t\t\t\tnextTick(subscription.deliver, subscription, [ data, channel ]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Dispose.\n\t\t */\n\t\tdispose() {\n\t\t\t// TODO: Extract this (and eventListeners etc. from Widget) into generic Disposable class\n\t\t\t// And/or automatically detect any properties that are (arrays of) instances of Disposable?\n\t\t\t// And/or just keep track of disposables and make Cancellable etc. Disposable\n\t\t\tthis.subscriptions.forEach(function(subscription) {\n\t\t\t\tsubscription.dispose();\n\t\t\t});\n\n\t\t\tthis.cancellables.forEach(function(cancellable) {\n\t\t\t\tcancellable.cancel(new Promise.CancellationError('Disposed'));\n\t\t\t});\n\n\t\t\tptv.dispose(this);\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.mvc.Controller', [\n\t'playtotv.pubsub.PubSub'\n], function(\n\tPubSub\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar util = ptv.util;\n\tvar REQUIRED = ptv.REQUIRED;\n\n\treturn class Controller extends PubSub {\n\t\t/** @lends playtotv.mvc.Controller.prototype */\n\n\t\t/**\n\t\t * PlayToTV MVC Controller.\n\t\t *\n\t\t * A base context object will be provided by App.addController().\n\t\t * A specific Controller can add or customize the context.store property as desired.\n\t\t *\n\t\t * @constructs\n\t\t * @param {Object} context Controller context\n\t\t * @param {string} context.name Name of Controller within App\n\t\t * @param {playtotv.mvc.App} context.app App instance this controller belongs to\n\t\t * @param {[string]} [context.store={}] Properties with default values to be serialized and persisted\n\t\t * @param {Object} [context.stored] Any stored data to deserialize\n\t\t *\n\t\t * @property {string} name Name of Controller within App\n\t\t * @property {playtotv.mvc.App} app App instance this controller belongs to\n\t\t * @property {[string]} [storeKeys=Object.keys(store)] Keys of properties to be serialized and persisted\n\t\t */\n\t\tconstructor(context) {\n\t\t\tvar { name, app, store, stored } = ptv.params(context, {\n\t\t\t\tname: REQUIRED,\n\t\t\t\tapp: REQUIRED,\n\t\t\t\tstore: {},\n\t\t\t\tstored: undefined\n\t\t\t});\n\n\t\t\tsuper();\n\n\t\t\tObject.assign(this, store, {\n\t\t\t\tname,\n\t\t\t\tapp,\n\t\t\t\tstoreKeys: Object.keys(store)\n\t\t\t});\n\n\t\t\tthis.deserialize(stored);\n\t\t}\n\n\t\t/**\n\t\t * Returns any JSON stringify-able data to be persisted in storage.\n\t\t * Called by App when it wants to persist this Controller's data.\n\t\t * This basic implementation just returns this instance's properties with keys matching this.storekeys.\n\t\t *\n\t\t * @returns {Object} Data to be persisted in storage\n\t\t */\n\t\tserialize() {\n\t\t\treturn ptv.pick(this, this.storeKeys);\n\t\t}\n\n\t\t/**\n\t\t * Called by constructor with any previously stored data.\n\t\t *\n\t\t * This basic implementation just extends this instance with data properties.\n\t\t *\n\t\t * @param {Object} data Previously stored data\n\t\t */\n\t\tdeserialize(data) {\n\t\t\tObject.assign(this, data);\n\t\t}\n\n\t\t////\n\t\t// DELEGATE TO APP\n\t\t//\n\n\t\t/**\n\t\t * Log code and details to App.\n\t\t *\n\t\t * @param {string} code\n\t\t * @param {string|Object} [details=null]\n\t\t */\n\t\tlog(code, details = null) {\n\t\t\tthis.app.log(this.name + '.' + code, details);\n\t\t}\n\n\t\t/**\n\t\t * Persists this controller's data to App storage.\n\t\t *\n\t\t * @returns {Promise} Promise of data being persisted\n\t\t */\n\t\tflush() {\n\t\t\treturn this.app.flush(this.name);\n\t\t}\n\n\t\t////\n\t\t// WIDGETS\n\t\t//\n\n\t\t/**\n\t\t * Registers widget by name with specified Widget class and base options.\n\t\t *\n\t\t * @param {string} name Widget name (within this Controller)\n\t\t * @param {[type]} WidgetClass Class to use for Widget instantiation\n\t\t * @param {Object} [options={}] Base options\n\t\t */\n\t\tsetWidget(name, WidgetClass, options = {}) {\n\t\t\toptions.controller = this;\n\t\t\tthis.app.setWidget(this.name + '.' + name, WidgetClass, options);\n\t\t}\n\n\t\t/**\n\t\t * Registers an array of Widgets.\n\t\t *\n\t\t * @param {[args]} widgets Array of array of setWidget arguments\n\t\t */\n\t\tsetWidgets(widgets) {\n\t\t\twidgets.forEach(args => this.setWidget.apply(this, args));\n\t\t}\n\n\t\t/**\n\t\t * Returns value of property with specified path.\n\t\t *\n\t\t * @param {string} path Property path\n\t\t * @returns {mixed} Property value or undefined\n\t\t */\n\t\tseek(path) {\n\t\t\treturn util.seek(this, path);\n\t\t}\n\n\t\t/**\n\t\t * Call handler with current value at path and call it again when it changes (is published).\n\t\t *\n\t\t * Unobserve by calling this.unsubscribe(subscription).\n\t\t *\n\t\t * @param {string} path Property path\n\t\t * @returns {playtotv.pubsub.Subscription} Path subscription\n\t\t */\n\t\tobserve(path, handler) {\n\t\t\thandler(this.seek(path), path);\n\t\t\treturn this.subscribe(path, value => handler(value, path));\n\t\t}\n\n\t\t/**\n\t\t * Set controller property with specified path to specified value and publish it.\n\t\t *\n\t\t * If value already equals current value then this does nothing.\n\t\t *\n\t\t * @param {string} path Path of property to set\n\t\t * @param {mixed} value Value to change property to\n\t\t * @param {options={}} [options={}]\n\t\t * @param {boolean} [options.json] Compare values using JSON stringify (default true if typeof value 'object')\n\t\t * @param {boolean} [options.force=false] Assume value to be changed\n\t\t */\n\t\tset(path, value, options) {\n\t\t\toptions = ptv.params(options, {\n\t\t\t\tjson: typeof value === 'object',\n\t\t\t\tforce: false\n\t\t\t});\n\n\t\t\tvar ref = util.seekRef(this, path);\n\t\t\tif (!ref) {\n\t\t\t\tthrow new Error('Can not set property on undefined object: ' + path);\n\t\t\t}\n\n\t\t\tvar current = ref.value;\n\t\t\tif (\n\t\t\t\toptions.force ||\n\t\t\t\t(!options.json && value !== current) ||\n\t\t\t\t(options.json && JSON.stringify(value) !== JSON.stringify(current))\n\t\t\t) {\n\t\t\t\tref.object[ref.key] = value;\n\t\t\t\tthis.publish(path, value);\n\t\t\t}\n\t\t}\n\n\t\t// TODO: Also add unset() and Array add() and remove() and number inc() and dec() convenience methods?\n\t\t/**\n\t\t * Toggle boolean value of property with specified path.\n\t\t *\n\t\t * If the value argument is undefined then this will change the property to !x where x is the current value.\n\t\t * If typeof value is 'string' then this will change to false unless value equals 'true'.\n\t\t * Otherwise this will change to true if value is truthy or false otherwise.\n\t\t *\n\t\t * @param {string} path Path of property to toggle\n\t\t * @param {boolean} [value] Value to change to\n\t\t */\n\t\ttoggle(path, value) {\n\t\t\tvalue = value === undefined ? !this.seek(path) :\n\t\t\t\ttypeof value === 'string' ? value === 'true' :\n\t\t\t\tvalue ? true : false;\n\n\t\t\tthis.set(path, value);\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.episode.EpisodeController', [\n\t'playtotv.mvc.Controller',\n\t'playtotv.episode.episodeSessionAPI'\n], function(\n\tController,\n\tepisodeSessionAPI\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar util = ptv.util;\n\tvar log = ptv.Logger.get(this.id);\n\n\treturn class EpisodeController extends Controller {\n\t\tconstructor(context, options) {\n\t\t\toptions = ptv.params(options, {\n\t\t\t\ttimeZone: util.getTimeZone(),\n\t\t\t\tshowName: undefined,\n\t\t\t\tshowId: undefined,\n\t\t\t\tepisodeSessionId: undefined\n\t\t\t});\n\n\t\t\tvar stored = context.stored || {};\n\t\t\tsuper(context, {\n\t\t\t\tmodel: {\n\t\t\t\t\tcurrent: null,\n\t\t\t\t\twaiting: false,\n\t\t\t\t\t// Note: Used as a backup for server side storage of user data\n\t\t\t\t\tepisodeInteractionUserDataMap: stored.episodeInteractionUserDataMap || {}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.options = options;\n\n\t\t\tthis.addMethods([\n\t\t\t\t'getEpisode',\n\t\t\t\t'getInteraction',\n\t\t\t\t'getCurrentInteraction',\n\t\t\t\t'getNextAsyncInteraction',\n\t\t\t\t'submitInteraction'\n\t\t\t]);\n\n\t\t\tthis.predictionTypes = [ 'PREDICTION' ];\n\n\t\t\tthis.scope.observe('user.online', this.start.bind(this));\n\n\t\t\tthis.scope.subscribe('change:push.stream', this.onStreamChange.bind(this));\n\t\t\tthis.scope.subscribe('push.EPISODESESSION-STATECHANGE', this.onChangeEvent.bind(this));\n\t\t\tthis.scope.subscribe('push.EPISODESESSION-INTERACTIONSTATEUPDATE', this.onUpdateEvent.bind(this));\n\t\t}\n\n\t\t// Note: Currently no support for going offline and online again, but that does not seem necessary\n\t\tstart(online) {\n\t\t\tif (this.hasStarted || !online) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.join();\n\t\t\tthis.hasStarted = true;\n\t\t}\n\n\t\tadaptEpisode(data) {\n\t\t\treturn Object.assign(data, {\n\t\t\t\tinteractionMap: {},\n\t\t\t\tinteractionQueue: [],\n\t\t\t\tasyncInteractions: {},\n\t\t\t\tposition: 'BEFORE'\n\t\t\t});\n\t\t}\n\n\t\tjoin() {\n\t\t\treturn this.scope.call('server.call', episodeSessionAPI.joinAndGetState, this.options).then(data => {\n\t\t\t\tvar episodeData = data.episodeSession;\n\t\t\t\tif (!episodeData) {\n\t\t\t\t\tthis.set('waiting', true);\n\n\t\t\t\t\treturn Promise.race([\n\t\t\t\t\t\tthis.scope.when('push.EPISODESESSION-OPENED'),\n\t\t\t\t\t\tthis.scope.when('change:push.stream')\n\t\t\t\t\t]).then(() => this.join());\n\t\t\t\t}\n\n\t\t\t\tvar episode = this.adaptEpisode(episodeData);\n\n\t\t\t\tthis.set('waiting', false);\n\t\t\t\tthis.set('current', episode);\n\n\t\t\t\tdata.state.stateChanges.forEach(change => {\n\t\t\t\t\t// Quietly work up to current state (already publishing current episode etc)\n\t\t\t\t\tthis.onStateChange(change, true);\n\t\t\t\t});\n\n\t\t\t\treturn episode;\n\t\t\t}).catch(error => {\n\t\t\t\tlog.e('join()', error);\n\t\t\t\tthis.set('current', null);\n\t\t\t\treturn Promise.delay(5000).then(() => this.join());\n\t\t\t});\n\t\t}\n\n\t\tcheckState() {\n\t\t\tvar episode = this.getEpisode();\n\n\t\t\tif (this.checkingState) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.checkingState = true;\n\n\t\t\t// Note: For some reason this returns changes including specified version, hence the +1\n\t\t\tthis.scope.call('server.call', episodeSessionAPI.getEpisodeSessionStateAsChangesSince, {\n\t\t\t\tepisodeSessionId: episode.id,\n\t\t\t\tsinceVersion: episode.version ? episode.version + 1 : 1\n\t\t\t}).then(data => {\n\t\t\t\tdata.stateChanges.forEach(change => this.onStateChange(change));\n\t\t\t}).finally(() => {\n\t\t\t\tthis.checkingState = false;\n\t\t\t});\n\t\t}\n\n\t\tgetEpisode() {\n\t\t\treturn this.model.current;\n\t\t}\n\n\t\tgetInteraction(id) {\n\t\t\tvar episode = this.getEpisode();\n\t\t\treturn episode && episode.interactionMap[id];\n\t\t}\n\n\t\tgetCurrentInteraction() {\n\t\t\tvar episode = this.getEpisode();\n\t\t\treturn episode && episode.interactionQueue[0];\n\t\t}\n\n\t\t/**\n\t\t * Returns a Promise of an array of interactions from specified async phase.\n\t\t *\n\t\t * Interactions are stored in {@link playtotv.episode.Episode#asyncInteractions}.\n\t\t * If interactions for specified phase were already previously stored there, they are returned.\n\t\t * Otherwise {@link playtotv.episode.episodeSessionAPI.getAsyncDataForEpisodeSession} is called.\n\t\t *\n\t\t * @param {string} [phase=Current episode phase]\n\t\t * @returns {Promise} Promise of an array of interactions from specified async phase\n\t\t */\n\t\tgetAsyncInteractions(phase) {\n\t\t\tvar episode = this.getEpisode();\n\n\t\t\t// TODO: Also add support for getting async data for all phases (phase param has become optional)?\n\t\t\tphase = phase || episode.currentPhase;\n\n\t\t\tvar interactions = episode.asyncInteractions[phase];\n\t\t\tif (interactions) {\n\t\t\t\treturn Promise.resolve(interactions);\n\t\t\t}\n\n\t\t\treturn this.scope.call('server.call', episodeSessionAPI.getAsyncDataForEpisodeSession, {\n\t\t\t\tepisodeSessionId: episode.id,\n\t\t\t\tphase: phase\n\t\t\t}).then(data => {\n\t\t\t\tinteractions = data.map(item => {\n\t\t\t\t\tvar interaction = this.upsertInteraction(item);\n\t\t\t\t\t// Change state to ANSWER to enable answering\n\t\t\t\t\tinteraction.state = 'ANSWER';\n\t\t\t\t\treturn interaction;\n\t\t\t\t});\n\n\t\t\t\tepisode.asyncInteractions[phase] = interactions;\n\n\t\t\t\treturn interactions;\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Returns a Promise of the first interaction from specified async phase that has no user data.\n\t\t * E.g: For which no answer has been submitted yet.\n\t\t *\n\t\t * Uses: {@link playtotv.episode.EpisodeController#getAsyncInteractions}\n\t\t *\n\t\t * @param {string} [phase=Current episode phase]\n\t\t * @returns {Promise} Promise of the first interaction from specified async phase that has no user data\n\t\t */\n\t\tgetNextAsyncInteraction(phase) {\n\t\t\tphase = phase || this.getEpisode().currentPhase;\n\t\t\treturn this.getAsyncInteractions(phase).then(interactions => {\n\t\t\t\treturn interactions.find(interaction => !interaction.data);\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * TODO: JSDoc\n\t\t */\n\t\tsubmitInteraction(method, interactionId, params, adaptor) {\n\t\t\treturn this.scope.call('server.toServerTime').then(serverTime => {\n\t\t\t\tvar episode = this.getEpisode();\n\t\t\t\tvar interaction = episode.interactionMap[interactionId];\n\t\t\t\tvar stateTime = interaction.stateTimeMap.ANSWER;\n\n\t\t\t\tparams.episodeSessionId = episode.id;\n\t\t\t\tif (params.clientAnswerTime) {\n\t\t\t\t\tparams.clientAnswerTime = serverTime - stateTime;\n\t\t\t\t}\n\n\t\t\t\treturn this.scope.call('server.call', method, params).then(data => {\n\t\t\t\t\tif (adaptor) {\n\t\t\t\t\t\tdata = adaptor(interaction.data, data);\n\t\t\t\t\t}\n\t\t\t\t\tthis.setInteractionUserData(episode.id, interaction, data);\n\t\t\t\t\tthis.publish('interaction-submitted-' + interactionId, data);\n\t\t\t\t\treturn data;\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tgetInteractionUserData(episodeId, interactionId) {\n\t\t\tvar interactionUserDataMap = this.model.episodeInteractionUserDataMap[episodeId];\n\t\t\treturn interactionUserDataMap && interactionUserDataMap[interactionId];\n\t\t}\n\n\t\tsetInteractionUserData(episodeId, interaction, data) {\n\t\t\t// Note: No need for more then one episode\n\t\t\tvar episodeInteractionUserDataMap = ptv.pick(this.model.episodeInteractionUserDataMap, [ episodeId ]);\n\t\t\tvar interactionUserDataMap = episodeInteractionUserDataMap[episodeId] ||\n\t\t\t\t(episodeInteractionUserDataMap[episodeId] = {});\n\t\t\tinteraction.data = interactionUserDataMap[interaction.id] = data;\n\t\t\tthis.set('episodeInteractionUserDataMap', episodeInteractionUserDataMap, { force: true });\n\t\t}\n\n\t\tupsertInteraction(payload) {\n\t\t\tvar id = payload.interactionId;\n\t\t\tvar data = payload.data || {};\n\t\t\tvar episode = this.getEpisode();\n\t\t\tvar interactionMap = episode.interactionMap;\n\t\t\tvar interaction = interactionMap[id];\n\n\t\t\tif (!interaction) {\n\t\t\t\tinteraction = interactionMap[id] = {\n\t\t\t\t\tid: id,\n\t\t\t\t\ttype: payload.type,\n\t\t\t\t\tstateTimeMap: {},\n\t\t\t\t\tstateDurationMap: {},\n\t\t\t\t\tdata: this.getInteractionUserData(episode.id, id)\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (data.interactionContent) {\n\t\t\t\tinteraction.content = data.interactionContent;\n\t\t\t}\n\t\t\tif (data.interactionStats) {\n\t\t\t\tinteraction.stats = data.interactionStats;\n\t\t\t}\n\t\t\tif (data.interactionUserData) {\n\t\t\t\tthis.setInteractionUserData(episode.id, interaction, data.interactionUserData);\n\t\t\t}\n\n\t\t\treturn interaction;\n\t\t}\n\n\t\tqueueInteraction(interaction) {\n\t\t\tvar episode = this.getEpisode();\n\t\t\tvar queue = episode.interactionQueue;\n\t\t\tvar index = queue.indexOf(interaction);\n\n\t\t\t// Remove interaction from wherever it was in the queue\n\t\t\tif (index !== -1) {\n\t\t\t\tqueue.splice(index, 1);\n\t\t\t}\n\n\t\t\t// Add interaction back to beginning of queue unless it is finished\n\t\t\t// Note: Prediction interactions behave differently, popping off while AWAITING_RESULTS\n\t\t\tvar state = interaction.state;\n\t\t\tvar type = interaction.type;\n\t\t\tif (\n\t\t\t\tstate === 'FINISHED' ||\n\t\t\t\tstate === 'AWAITING_RESULTS' && this.predictionTypes.indexOf(type) >= 0\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tqueue.unshift(interaction);\n\t\t}\n\n\t\tupdateInteractionPosition(interaction) {\n\t\t\tvar content = interaction.content || {};\n\t\t\tvar episode = this.getEpisode();\n\t\t\t// TODO: Check with Mark whether we can replace lastquestion by lastInteraction\n\t\t\tepisode.position =\n\t\t\t\tinteraction.state === 'FINISHED' && content.lastquestion === 'true' ? 'AFTER' : 'BETWEEN';\n\t\t}\n\n\t\tonStreamChange() {\n\t\t\tif (this.getEpisode()) {\n\t\t\t\tthis.checkState();\n\t\t\t}\n\t\t}\n\n\t\tonChangeEvent(event) {\n\t\t\tvar payload = event.payload;\n\t\t\tvar episode = this.getEpisode();\n\t\t\tif (!episode || payload.episodeSessionId !== episode.id) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.onStateChange(payload);\n\t\t}\n\n\t\tonStateChange(change, quiet) {\n\t\t\tvar episode = this.getEpisode();\n\t\t\tvar version = episode.version;\n\t\t\tvar subject = change.subject;\n\t\t\tvar newVersion = change.version;\n\n\t\t\t// Catch any unusual changes\n\t\t\tif (newVersion <= version) {\n\t\t\t\tlog.d('onStateChange: Skipping: ' + newVersion + ' (already at: ' + version + ')');\n\t\t\t\treturn;\n\t\t\t} else if (newVersion > version + 1) {\n\t\t\t\tlog.d('onStateChange: Missed changes between: ' + version + ' and ' + newVersion);\n\t\t\t\tthis.checkState();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar publishIfNotQuiet = function(channel) {\n\t\t\t\tif (!quiet) {\n\t\t\t\t\tthis.publish(channel, change);\n\t\t\t\t}\n\t\t\t}.bind(this);\n\n\t\t\tswitch (subject) {\n\t\t\t\tcase 'PHASE': this.onPhaseChange(change, quiet); break;\n\t\t\t\tcase 'INTERACTION': this.onInteractionChange(change, quiet); break;\n\t\t\t\tcase 'LEADERBOARD_UPDATED': publishIfNotQuiet('leaderboard-update'); break;\n\t\t\t\tcase 'LEADERBOARD_FINAL': publishIfNotQuiet('leaderboard-final'); break;\n\t\t\t\tdefault: log.d('onStateChange: No handler defined for subject: ' + subject);\n\t\t\t}\n\n\t\t\tepisode.version = newVersion;\n\t\t}\n\n\t\tonPhaseChange(change, quiet) {\n\t\t\tvar episode = this.getEpisode();\n\t\t\tvar phase = change.sessionPhase;\n\n\t\t\tepisode.currentPhase = phase;\n\t\t\tif (!quiet) {\n\t\t\t\tthis.publish('phase-change-' + phase, change);\n\t\t\t}\n\n\t\t\tif (phase === 'CLOSED') {\n\t\t\t\tthis.set('current', null);\n\t\t\t\tthis.join();\n\t\t\t}\n\t\t}\n\n\t\tonInteractionChange(change, quiet) {\n\t\t\tvar interaction = this.upsertInteraction(change);\n\n\t\t\tvar state = change.interactionState;\n\t\t\tinteraction.state = state;\n\t\t\tinteraction.stateTimeMap[state] = change.time;\n\t\t\tinteraction.stateDurationMap[state] = change.duration;\n\n\t\t\tchange.interaction = interaction;\n\n\t\t\tthis.queueInteraction(interaction);\n\n\t\t\tthis.updateInteractionPosition(interaction);\n\n\t\t\tif (!quiet) {\n\t\t\t\tthis.publish('interaction-change-' + change.interactionId, change);\n\t\t\t}\n\t\t}\n\n\t\tonUpdateEvent(event) {\n\t\t\tvar payload = event.payload;\n\t\t\tvar episode = this.getEpisode();\n\n\t\t\tif (!episode || payload.episodeSessionId !== episode.id) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar interaction = this.getInteraction(payload.interactionId);\n\n\t\t\t// TODO: Remove this once we get separate interactionFinalStats from server etc. (NV-1040)\n\t\t\tvar state = interaction.state;\n\t\t\tif (state === 'RESULTS' || state === 'FINISHED') {\n\t\t\t\treturn; // do not overwrite finalized data\n\t\t\t}\n\n\t\t\tvar oldJSON = JSON.stringify(interaction);\n\t\t\tvar newJSON = JSON.stringify(this.upsertInteraction(payload));\n\t\t\tif (newJSON === oldJSON) {\n\t\t\t\treturn; // nothing changed\n\t\t\t}\n\n\t\t\tpayload.interaction = interaction;\n\n\t\t\tthis.publish('interaction-update-' + payload.interactionId, payload);\n\t\t}\n\n\t\tserialize(data) {\n\t\t\treturn ptv.pick(data, [ 'episodeInteractionUserDataMap' ]);\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.fx.EffectsController', [\n\t'playtotv.mvc.Controller'\n], function(\n\tController\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar dom = ptv.dom;\n\n\t/**\n\t * Monitors DOM mutations and triggers transitions on nodes matching selectors from transitionMap.\n\t * Transitions are objects with enter and leave properties that are class names that start animations.\n\t */\n\treturn class EffectsController extends Controller {\n\t\tconstructor(context, options) {\n\t\t\toptions = ptv.params(options, {\n\t\t\t\ttransitions: {}, // name to transition object with enter and leave properties (animation class names)\n\t\t\t\tdefaults: {},\n\t\t\t\tfxDelay: 250\n\t\t\t});\n\n\t\t\tsuper(context);\n\n\t\t\tthis.addMethods([\n\t\t\t\t'once'\n\t\t\t]);\n\n\t\t\tthis.transitionMap = options.transitions;\n\t\t\tthis.defaultMap = options.defaults;\n\t\t\tthis.onceMap = {};\n\t\t\tthis.delay = options.fxDelay;\n\n\t\t\tvar view = this.scope.view;\n\t\t\tview.nodeAddedListeners.push(this.onNodeAdded.bind(this));\n\t\t\tview.nodeRemoveListeners.push(this.onNodeRemove.bind(this));\n\t\t}\n\n\t\t/**\n\t\t * Queues a transition to be played on the next DOM mutation that matches the given selector.\n\t\t * May be used to override default transitions.\n\t\t * Once played, the once entry is removed.\n\t\t */\n\t\tonce(selector, transitionName) {\n\t\t\tif (!this.transitionMap[transitionName]) {\n\t\t\t\tthrow new Error('Unknown transition: ' + transitionName);\n\t\t\t}\n\t\t\tthis.onceMap[selector] = transitionName;\n\t\t}\n\n\t\tgetSelectors() {\n\t\t\treturn ptv.union(Object.keys(this.defaultMap), Object.keys(this.onceMap));\n\t\t}\n\n\t\t/**\n\t\t * Returns any transition that should be applied to nodes matching specified selector.\n\t\t */\n\t\tgetTransition(selector) {\n\t\t\tvar transitionName = this.onceMap[selector] || this.defaultMap[selector];\n\t\t\treturn this.transitionMap[transitionName];\n\t\t}\n\n\t\t/**\n\t\t * Called by the view before nodes are removed from DOM.\n\t\t * Returns a delay to allow for any leave animations to finish before the node is removed.\n\t\t *\n\t\t * TODO: Enable overriding default delay, e.g: with a data attribute\n\t\t */\n\t\tonNodeRemove(node) {\n\t\t\tvar affected = false;\n\n\t\t\tthis.getSelectors().\n\t\t\t\tfilter(selector => dom.matches(selector, node)).\n\t\t\t\tforEach(selector => {\n\t\t\t\t\tvar transition = this.getTransition(selector);\n\t\t\t\t\tthis.playAnimation(node, transition.leave);\n\t\t\t\t\taffected = true;\n\t\t\t\t});\n\n\t\t\treturn affected ? this.delay : 0;\n\t\t}\n\n\t\t/**\n\t\t * Checks the added node and triggers animations for matching selectors of registered transitions.\n\t\t */\n\t\tonNodeAdded(node) {\n\t\t\tthis.getSelectors().\n\t\t\t\tfilter(selector => dom.matches(selector, node)).\n\t\t\t\tforEach(selector => {\n\t\t\t\t\tvar transition = this.getTransition(selector);\n\t\t\t\t\tthis.playAnimation(node, transition.enter);\n\n\t\t\t\t\t// Clear any onced entry here to ensure that both leave and enter animations are played\n\t\t\t\t\t// since in transitions the node remove (leave) precedes the node add (enter)\n\t\t\t\t\tdelete this.onceMap[selector];\n\t\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Starts animation by adding it as a class and storing it for later removal.\n\t\t */\n\t\tplayAnimation(node, animation) {\n\t\t\tif (!animation) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Clean up any previous animation class\n\t\t\tvar prevAnimation = dom.getData(node, 'fx-animation');\n\t\t\tif (prevAnimation) {\n\t\t\t\tdom.removeData(node, 'fx-animation');\n\t\t\t\tnode.classList.remove(prevAnimation);\n\t\t\t}\n\n\t\t\tdom.setData(node, 'fx-animation', animation);\n\t\t\tnode.classList.add(animation);\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.global.GlobalController', [\n\t'playtotv.global.genericContentAPI',\n\t'playtotv.global.globalDataAPI',\n\t'playtotv.mvc.Controller',\n\t'playtotv.cron'\n], function(\n\tgenericContentAPI,\n\tglobalDataAPI,\n\tController,\n\tcron\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar util = ptv.util;\n\n\treturn class GlobalController extends Controller {\n\t\tconstructor(context, options) {\n\t\t\toptions = ptv.params(options, {\n\t\t\t\ttimeZone: util.getTimeZone()\n\t\t\t});\n\n\t\t\t// Note: model with global data is implicitly persisted\n\t\t\tsuper(context);\n\n\t\t\tthis.getContent = Promise.limit(this.getContentNow, 10 * 60 * 1000);\n\n\t\t\tthis.addMethods([\n\t\t\t\t'update',\n\t\t\t\t'getContent'\n\t\t\t]);\n\n\t\t\tthis.options = options;\n\n\t\t\t// Note: Using slow polling as a reliable method for staying up-to-date\n\t\t\tvar update = this.update.bind(this);\n\t\t\tcron.at(Date.now(), update, { repeat: 5 * 60 * 1000 });\n\n\t\t\t// Fast, but slightly unreliable, ways of staying up-to-date\n\t\t\tthis.scope.subscribe('push.GLOBALDATA-REPLACED', event => this.onData(event.payload));\n\t\t\tthis.scope.subscribe('push.GLOBALDATA-UPDATED', event => this.onUpdate(event.payload));\n\t\t}\n\n\t\tupdate() {\n\t\t\tthis.scope.call('server.call', globalDataAPI.get, this.options).then(this.onData.bind(this));\n\t\t}\n\n\t\tgetContentNow(category) {\n\t\t\treturn this.scope.call('server.call', genericContentAPI.getCategory, {\n\t\t\t\tcategory: category\n\t\t\t});\n\t\t}\n\n\t\tonData(data) {\n\t\t\tptv.each(data, (value, key) => {\n\t\t\t\t// Note: set() will only trigger model changes when value has actually changed\n\t\t\t\tthis.set(key, value);\n\t\t\t});\n\t\t}\n\n\t\tonUpdate(payload) {\n\t\t\tvar { category, object, uniqueIdField } = payload;\n\t\t\tvar items = this.model[category] || [];\n\t\t\tvar item = items.find(candidate => candidate[uniqueIdField] === object[uniqueIdField]);\n\n\t\t\tif (item) {\n\t\t\t\tObject.assign(item, object);\n\t\t\t} else {\n\t\t\t\titems.push(object);\n\t\t\t}\n\n\t\t\t// Force change publish in case we just changed an existing item in the existing array\n\t\t\tthis.set(category, items, { force: true });\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.model.AbstractModel', [\n\t'playtotv.model.ModelSubscription',\n\t'playtotv.pubsub.PubSub'\n], function(\n\tModelSubscription,\n\tPubSub\n) {\n\n\t'use strict';\n\n\treturn class AbstractModel extends PubSub {\n\t\t/** @lends playtotv.model.AbstractModel.prototype */\n\n\t\t/**\n\t\t * Abstract model class that facilitates subscribing to mutations of data with handlers.\n\t\t *\n\t\t * Subscriptions are defined by selector strings which look like this: \"[action]:[key]=[value]\".\n\t\t * <ul>\n\t\t * <li>Both \"[action]\" and \"[key]\" can be replaced by \"*\" wildcards, matching all actions/key mutations.\n\t\t * <li>The special global wildcard selector \"*\" will match all mutations, also those of nested data.\n\t\t * <li>The optional \"=[value]\" will perform a simple value comparison casting value to string if necessary.\n\t\t * </ul>\n\t\t *\n\t\t * Possible actions are: \"add\", \"remove\", \"change\" and \"init\".\n\t\t *\n\t\t * Example selectors:\n\t\t * <ul>\n\t\t * <li>\"change:status=full\"\n\t\t * <li>\"change:status\"\n\t\t * <li>\"add:*\"\n\t\t * <li>\"*:status\"\n\t\t * <li>\"*\"\n\t\t * </ul>\n\t\t *\n\t\t * Handler callbacks take place asynchronously on the next 'tick', see {@link playtotv.pubsub.PubSub#publish}.\n\t\t * This should in general result with your model being in a more consistent state during callbacks.\n\t\t * Do note however that the handler value might not be in sync with the model state anymore during that time.\n\t\t * Depending on your use you will want to work with the published value or lookup the current model value.\n\t\t *\n\t\t * While a property is set to an AbstractModel value that child model's publishes will bubble up to this model.\n\t\t * It's key will be prefixed with that property's key and a dot.\n\t\t *\n\t\t * Note: This talks about object, property and key. For ArrayModels imagine array, item and index instead.\n\t\t *\n\t\t * @extends playtotv.pubsub.PubSub\n\t\t * @constructs\n\t\t */\n\t\tconstructor() {\n\t\t\tsuper();\n\t\t}\n\n\t\t/**\n\t\t * Returns a shallowly de-modeled plain JavaScript Object copy of the model data.\n\t\t *\n\t\t * If any child properties are models, they will still be models in the copy.\n\t\t * To recursively de-model a model use {@link playtotv.model.modelUtil.toObject}.\n\t\t *\n\t\t * Note: This is an abstract function that has to be overridden.\n\t\t *\n\t\t * @function\n\t\t * @returns {Object} Plain JavaScript Object copy of the model data\n\t\t */\n\t\ttoObject() {\n\t\t\tthrow new ReferenceError('Abstract function not implemented');\n\t\t}\n\n\t\t/**\n\t\t * Updates model data to match that of specified plain JavaScript source Object.\n\t\t *\n\t\t * If any child properties are models, this model will be updated to refer to those models.\n\t\t * To recursively update a model use {@link playtotv.model.modelUtil.update}.\n\t\t *\n\t\t * Note: This is an abstract function that has to be overridden.\n\t\t *\n\t\t * @function\n\t\t * @param {Object} source Source data to update model to\n\t\t * @returns {[mixed]} Array with any removed values for garbage collection etc.\n\t\t */\n\t\tupdateModel() {\n\t\t\tthrow new ReferenceError('Abstract function not implemented');\n\t\t}\n\n\t\t/**\n\t\t * Returns true if this model or any of our child models equals specified root model.\n\t\t *\n\t\t * This can be used to test for and prevent creation of cyclic models leading to infinite publishes.\n\t\t *\n\t\t * Note: This is an abstract function that has to be overridden.\n\t\t *\n\t\t * @param {playtotv.model.AbstractModel} root Root model to compare to\n\t\t * @returns {boolean} True if this model has a cyclic relation to root\n\t\t */\n\t\tisRelatedModel() {\n\t\t\tthrow new ReferenceError('Abstract function not implemented');\n\t\t}\n\n\t\t/**\n\t\t * Returns the action from specified selector.\n\t\t *\n\t\t * @param {string} selector Model subscription selector\n\t\t * @return {string} The action from specified selector\n\t\t */\n\t\tgetSelectorAction(selector) {\n\t\t\tvar colonIndex = selector.indexOf(':');\n\t\t\treturn colonIndex === -1 ? undefined : selector.substr(0, colonIndex);\n\t\t}\n\n\t\t/**\n\t\t * Returns the key from specified selector.\n\t\t *\n\t\t * @param {string} selector Model subscription selector\n\t\t * @return {string} The key from specified selector\n\t\t */\n\t\tgetSelectorKey(selector) {\n\t\t\tvar colonIndex = selector.indexOf(':');\n\t\t\tif (colonIndex === -1) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\tvar key = selector.substring(colonIndex + 1);\n\t\t\tvar eqIndex = key.indexOf('=');\n\t\t\treturn eqIndex === -1 ? key : key.substring(0, eqIndex);\n\t\t}\n\n\t\t/**\n\t\t * Returns the value from specified selector.\n\t\t *\n\t\t * @param {string} selector Model subscription selector\n\t\t * @return {string} The value from specified selector\n\t\t */\n\t\tgetSelectorValue(selector) {\n\t\t\tvar eqIndex = selector.indexOf('=');\n\t\t\treturn eqIndex === -1 ? undefined : selector.substring(eqIndex + 1);\n\t\t}\n\n\t\t/**\n\t\t * Returns an Array of {key, value} property tuples that match specified selector.\n\t\t *\n\t\t * <ul>\n\t\t * <li>\"[add/change/*]:[key]=[value]\": property with matching [key] and [value]\n\t\t * <li>\"[add/change/*]:[*]=[value]\": property with matching [value]\n\t\t * <li>\"[add/change/*]:[key]\": property with matching [key]\n\t\t * <li>\"[add/change/*]:*\": all of this object's properties\n\t\t * <li>\"*\": is equal to \"*:*\" for the sake of this type of matching\n\t\t * </ul>\n\t\t *\n\t\t * @param {string} selector Model subscription selector\n\t\t * @throws {Error} If selector matching is not supported\n\t\t * @returns {[Object]} Array of matching {key, value} tuples\n\t\t */\n\t\tgetSelectorMatches(selector) {\n\t\t\tvar action = this.getSelectorAction(selector) || '*';\n\t\t\tvar key = this.getSelectorKey(selector) || '*';\n\t\t\tvar val = this.getSelectorValue(selector);\n\n\t\t\tif (action === 'remove') {\n\t\t\t\tthrow new Error('Matching with remove action selector is not supported: ' + selector);\n\t\t\t}\n\t\t\tif (!key || key.indexOf('.') !== -1) {\n\t\t\t\tthrow new Error('Only basic key matching is supported: ' + selector);\n\t\t\t}\n\n\t\t\tvar matches = [];\n\t\t\tplaytotv.each(this.toObject(), function(v, k) {\n\t\t\t\tif (key !== '*' && k !== key) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (val !== undefined && String(v) !== val) { // includes 'undefined'\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tmatches.push({ key: k, value: v });\n\t\t\t});\n\t\t\treturn matches;\n\t\t}\n\n\t\t/**\n\t\t * Subscribe handler to specified selector.\n\t\t *\n\t\t * This overrides {@link playtotv.pubsub.PubSub#subscribe}.\n\t\t *\n\t\t * If init is true then handler will be called with action \"init\" on nextTick for each match returned by\n\t\t * {@link playtotv.model.AbstractModel#getSelectorMatches}.\n\t\t *\n\t\t * @param {string} selector Selector to match\n\t\t * @param {Function} handler Handler to call on mutation with value, action and key arguments\n\t\t * @param {boolean} [init=false] If true then initialize by publishing current value(s)\n\t\t * @throws {Error} If init is true but selector matching is not supported\n\t\t * @returns {playtotv.model.ModelSubscription} Subscription\n\t\t */\n\t\tsubscribe(selector, handler, init) {\n\t\t\tvar subscription = new ModelSubscription(selector, handler);\n\n\t\t\tif (init) {\n\t\t\t\tthis.getSelectorMatches(selector).forEach(function(match) {\n\t\t\t\t\tvar key = match.key;\n\t\t\t\t\tvar value = match.value;\n\t\t\t\t\tvar channel = 'init:' + key + '=' + value;\n\t\t\t\t\tvar data = { key: key, action: 'init', value: value };\n\t\t\t\t\tnextTick(subscription.deliver, subscription, [ data, channel ]);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.subscriptions.push(subscription);\n\t\t\treturn subscription;\n\t\t}\n\n\t\t/**\n\t\t * Creates a one-time subscription and returns a promise that resolves on it's first match.\n\t\t *\n\t\t * This extends {@link playtotv.pubsub.PubSub#when} with initialization support.\n\t\t * If selector value is defined and specified selector matches the model's current value\n\t\t * then this will immediately return a Cancellable that is resolved with the first matching value.\n\t\t *\n\t\t * @param {string} selector Selector to match\n\t\t * @returns {Promise.Cancellable} Cancellable promise which will resolve when selector first matches\n\t\t */\n\t\twhen(selector) {\n\t\t\tif (this.getSelectorValue(selector) !== undefined) {\n\t\t\t\tvar matches = this.getSelectorMatches(selector);\n\t\t\t\tif (matches.length > 0) {\n\t\t\t\t\treturn Promise.Cancellable.resolve(matches[0].value);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn PubSub.prototype.when.call(this, selector);\n\t\t}\n\n\t\t/**\n\t\t * Publish an action with value on property specified by key.\n\t\t *\n\t\t * This overrides and delegates to {@link playtotv.pubsub.PubSub#publish}.\n\t\t *\n\t\t * @param {string} key\n\t\t * @param {string} action\n\t\t * @param {mixed} value\n\t\t */\n\t\tpublish(key, action, value) {\n\t\t\tvar channel = action + ':' + key + '=' + value;\n\t\t\tvar data = { key: key, action: action, value: value };\n\t\t\tPubSub.prototype.publish.call(this, channel, data);\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.model.ObjectModel', [\n\t'playtotv.model.AbstractModel'\n], function(\n\tAbstractModel\n) {\n\n\t'use strict';\n\n\treturn class ObjectModel extends AbstractModel {\n\t\t/** @lends playtotv.model.ObjectModel.prototype */\n\n\t\t/**\n\t\t * Concrete implementation of {@link playtotv.model.AbstractModel} for storing Object properties.\n\t\t *\n\t\t * If a source object is specified then it's properties will be copied using\n\t\t * {@link playtotv.model.ObjectModel#copyProperties}.\n\t\t *\n\t\t * Reading and iterating:\n\t\t * <ul>\n\t\t * <li>For basic read access you can simply access the properties of this model\n\t\t * <li>This model does however have some extra Class properties and methods\n\t\t * </ul>\n\t\t *\n\t\t * Modify and publish methods:\n\t\t * <ul>\n\t\t * <li>{@link playtotv.model.ObjectModel#addProperty}\n\t\t * <li>{@link playtotv.model.ObjectModel#removeProperty}\n\t\t * <li>{@link playtotv.model.ObjectModel#changeProperty}\n\t\t * <li>{@link playtotv.model.ObjectModel#setProperty}\n\t\t * <li>{@link playtotv.model.ObjectModel#copyProperties}\n\t\t * </ul>\n\t\t *\n\t\t * Note: Only modify this model's properties through the above methods!\n\t\t *\n\t\t * @extends playtotv.model.AbstractModel\n\t\t * @constructs\n\t\t * @param {Object} [source] Source object to copy into this model\n\t\t *\n\t\t * @property {[string]} propertyKeys This model's property keys\n\t\t * @property {Object} childSubscriptionMap Map of property keys to child model subscriptions\n\t\t */\n\t\tconstructor(source) {\n\t\t\tsuper();\n\n\t\t\tthis.propertyKeys = [];\n\t\t\tthis.childSubscriptionMap = {};\n\n\t\t\tif (source) {\n\t\t\t\tthis.copyProperties(source);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Implementation of {@link playtotv.model.AbstractModel#toObject}.\n\t\t *\n\t\t * @returns {Object} Plain JavaScript Object copy of the model data\n\t\t */\n\t\ttoObject() {\n\t\t\tvar obj = {};\n\t\t\tvar keys = this.propertyKeys;\n\t\t\tvar keysLength = keys.length;\n\t\t\tvar i, key;\n\t\t\tfor (i = 0; i < keysLength; i++) {\n\t\t\t\tkey = keys[i];\n\t\t\t\tobj[key] = this[key];\n\t\t\t}\n\t\t\treturn obj;\n\t\t}\n\n\t\t/**\n\t\t * Implementation of {@link playtotv.model.AbstractModel#updateModel}.\n\t\t *\n\t\t * Properties are {@link playtotv.model.ObjectModel#removeProperty}d, then\n\t\t * {@link playtotv.model.ObjectModel#addProperty}ed and then {@link playtotv.model.ObjectModel#changeProperty}d.\n\t\t *\n\t\t * @param {Object} source Source data to update model to\n\t\t * @returns {[mixed]} Array with any removed values for garbage collection etc.\n\t\t */\n\t\tupdateModel(source) {\n\t\t\tvar keys = this.propertyKeys;\n\t\t\tvar sourceKeys = Object.keys(source);\n\t\t\tvar removedValues = [];\n\n\t\t\tkeys.filter(function(key) {\n\t\t\t\treturn sourceKeys.indexOf(key) === -1;\n\t\t\t}).forEach(function(key) {\n\t\t\t\tremovedValues.push(this.removeProperty(key));\n\t\t\t}.bind(this));\n\n\t\t\tsourceKeys.filter(function(sourceKey) {\n\t\t\t\treturn keys.indexOf(sourceKey) === -1;\n\t\t\t}).forEach(function(sourceKey) {\n\t\t\t\tthis.addProperty(sourceKey, source[sourceKey]);\n\t\t\t}.bind(this));\n\n\t\t\tsourceKeys.filter(function(sourceKey) {\n\t\t\t\treturn keys.indexOf(sourceKey) !== -1;\n\t\t\t}).forEach(function(sourceKey) {\n\t\t\t\tremovedValues.push(this.changeProperty(sourceKey, source[sourceKey]));\n\t\t\t}.bind(this));\n\n\t\t\treturn removedValues;\n\t\t}\n\n\t\t/**\n\t\t * Implementation of {@link playtotv.model.AbstractModel#isRelatedModel}.\n\t\t *\n\t\t * @param {playtotv.model.AbstractModel} root Root model to compare to\n\t\t * @returns {boolean} True if this model has a cyclic relation to root\n\t\t */\n\t\tisRelatedModel(root) {\n\t\t\tif (this === root) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tvar childSubscriptionMap = this.childSubscriptionMap;\n\t\t\tvar keys = Object.keys(childSubscriptionMap);\n\t\t\tvar keysLength = keys.length;\n\t\t\tvar i, childModel;\n\n\t\t\tfor (i = 0; i < keysLength; i++) {\n\t\t\t\tchildModel = childSubscriptionMap[keys[i]].model;\n\t\t\t\tif (childModel instanceof AbstractModel) {\n\t\t\t\t\tif (childModel.isRelatedModel(root)) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\t/**\n\t\t * Subscribe to child model to have it's publishes bubble up to this one.\n\t\t *\n\t\t * Note: It is required that child model is not in a cyclic relationship with this model.\n\t\t *\n\t\t * @param {string} key Child model key\n\t\t * @param {playtotv.model.AbstractModel} child Child model to subscribe to\n\t\t */\n\t\tsubscribeChild(key, child) {\n\t\t\tvar subscription = child.subscribe('*', function(childValue, childAction, childKey) {\n\t\t\t\tthis.publish(key + '.' + childKey, childAction, childValue);\n\t\t\t}.bind(this));\n\n\t\t\tthis.childSubscriptionMap[key] = {\n\t\t\t\tmodel: child,\n\t\t\t\tsubscription: subscription\n\t\t\t};\n\t\t}\n\n\t\t/**\n\t\t * Unsubscribe child model so it's publishes no longer bubble up to this one.\n\t\t *\n\t\t * @param {string} key Child model key\n\t\t */\n\t\tunsubscribeChild(key) {\n\t\t\tvar childSubscriptionMap = this.childSubscriptionMap;\n\t\t\tvar childSubscription = childSubscriptionMap[key];\n\t\t\tchildSubscription.model.unsubscribe(childSubscription.subscription);\n\t\t\tdelete childSubscriptionMap[key];\n\t\t}\n\n\t\t/**\n\t\t * Add property with specified key and value to this model.\n\t\t *\n\t\t * @param {string} key\n\t\t * @param {mixed} value\n\t\t * @throws {Error} If property with specified key already exists\n\t\t * @throws {Error} If specified key is reserved\n\t\t * @throws {Error} If value is a model in a cyclic relationship with this model\n\t\t */\n\t\taddProperty(key, value) {\n\t\t\tvar keys = this.propertyKeys;\n\t\t\tvar valueIsModel = value instanceof AbstractModel;\n\n\t\t\tif (keys.indexOf(key) !== -1) {\n\t\t\t\tthrow new Error('Property with specified key already exists: ' + key);\n\t\t\t}\n\t\t\tif (key in this) {\n\t\t\t\tthrow new Error('Specified key is reserved: ' + key);\n\t\t\t}\n\t\t\tif (valueIsModel && value.isRelatedModel(this)) {\n\t\t\t\tthrow new Error('Value is a model in a cyclic relationship with this model');\n\t\t\t}\n\n\t\t\tkeys.push(key);\n\t\t\tthis[key] = value;\n\n\t\t\tif (valueIsModel) {\n\t\t\t\tthis.subscribeChild(key, value);\n\t\t\t}\n\n\t\t\tthis.publish(key, 'add', value);\n\t\t}\n\n\t\t/**\n\t\t * Change property specified by key to specified value.\n\t\t *\n\t\t * @param {string} key\n\t\t * @param {mixed} value\n\t\t * @param {Object} [options]\n\t\t * @param {boolean} [options.force] If true then force change even if value is equal to old value\n\t\t * @param {boolean} [options.json] If true then use JSON.stringify to compare value with old value\n\t\t * @throws {Error} If property with specified key does not exist\n\t\t * @throws {Error} If value is a model in a cyclic relationship with this model\n\t\t * @returns {mixed} Removed value (if any) for garbage collection etc.\n\t\t */\n\t\tchangeProperty(key, value, options) {\n\t\t\t/*jshint maxcomplexity:10*/\n\t\t\toptions = options || {};\n\t\t\tvar oldValue = this[key];\n\t\t\tvar valueIsModel = value instanceof AbstractModel;\n\n\t\t\tif (this.propertyKeys.indexOf(key) === -1) {\n\t\t\t\tthrow new Error('Property with specified key does not exist: ' + key);\n\t\t\t}\n\n\t\t\tif (!options.force) {\n\t\t\t\tif (value === oldValue || options.json && JSON.stringify(value) === JSON.stringify(oldValue)) {\n\t\t\t\t\treturn; // no change\n\t\t\t\t}\n\t\t\t\tif (valueIsModel && value.isRelatedModel(this)) {\n\t\t\t\t\tthrow new Error('Value is a model in a cyclic relationship with this model');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (oldValue instanceof AbstractModel) {\n\t\t\t\tthis.unsubscribeChild(key);\n\t\t\t}\n\n\t\t\tthis[key] = value;\n\n\t\t\tif (valueIsModel) {\n\t\t\t\tthis.subscribeChild(key, value);\n\t\t\t}\n\n\t\t\tthis.publish(key, 'change', value);\n\n\t\t\treturn oldValue;\n\t\t}\n\n\t\t/**\n\t\t * Remove property with specified key from this model.\n\t\t *\n\t\t * @param {string} key\n\t\t * @throws {Error} If property with specified key does not exist\n\t\t * @returns {mixed} Removed value for garbage collection etc.\n\t\t */\n\t\tremoveProperty(key) {\n\t\t\tvar keys = this.propertyKeys;\n\t\t\tvar index = keys.indexOf(key);\n\t\t\tvar oldValue = this[key];\n\n\t\t\tif (index === -1) {\n\t\t\t\tthrow new Error('Property with specified key does not exist: ' + key);\n\t\t\t}\n\n\t\t\tif (oldValue instanceof AbstractModel) {\n\t\t\t\tthis.unsubscribeChild(key);\n\t\t\t}\n\n\t\t\tkeys.splice(index, 1);\n\t\t\tdelete this[key];\n\n\t\t\tthis.publish(key, 'remove', oldValue);\n\n\t\t\treturn oldValue;\n\t\t}\n\n\t\t/**\n\t\t * Either calls {@link playtotv.model.ObjectModel#addProperty} or\n\t\t * {@link playtotv.model.ObjectModel#changeProperty} depending on property existence.\n\t\t *\n\t\t * @param {string} key Argument to addProperty or changeProperty\n\t\t * @param {mixed} value Argument to addProperty or changeProperty\n\t\t * @param {Object} [options] Options to pass to changeProperty\n\t\t * @returns {mixed} Removed value (if any) for garbage collection etc.\n\t\t */\n\t\tsetProperty(key, value, options) {\n\t\t\tif (this.propertyKeys.indexOf(key) === -1) {\n\t\t\t\tthis.addProperty(key, value);\n\t\t\t} else {\n\t\t\t\treturn this.changeProperty(key, value, options);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Copy all properties from specified source object to this model using\n\t\t * {@link playtotv.model.ObjectModel#setProperty}.\n\t\t *\n\t\t * This will change existing properties and add them if they were missing, but it will not remove them.\n\t\t * To have this model data match source use {@link playtotv.model.ObjectModel#updateModel}.\n\t\t *\n\t\t * @param {Object} source Source to copy from\n\t\t * @returns {[mixed]} Array with any removed values for garbage collection etc.\n\t\t */\n\t\tcopyProperties(source) {\n\t\t\tvar removedValues = [];\n\t\t\tfor (var key in source) {\n\t\t\t\tif (source.hasOwnProperty(key)) {\n\t\t\t\t\tremovedValues.push(this.setProperty(key, source[key]));\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn removedValues;\n\t\t}\n\n\t\t/**\n\t\t * Dispose keys and child subscriptions.\n\t\t *\n\t\t * Note: Do not forget to also dispose any child models that are no longer used.\n\t\t */\n\t\tdispose() {\n\t\t\tplaytotv.each(this.childSubscriptionMap, function(childSubscription) {\n\t\t\t\tchildSubscription.model.unsubscribe(childSubscription.subscription);\n\t\t\t});\n\n\t\t\tAbstractModel.prototype.dispose.call(this);\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.facebook.Facebook', [\n\t'playtotv.model.ObjectModel'\n], function(\n\tObjectModel\n) {\n\n\t'use strict';\n\n\t////////// Private variables\n\n\tvar ptv = playtotv;\n\tvar util = ptv.util;\n\tvar log = ptv.Logger.get(this.id);\n\tvar REQUIRED = ptv.REQUIRED;\n\n\t////////// Class declaration\n\n\treturn class Facebook extends ObjectModel {\n\t\t/** @lends playtotv.facebook.Facebook.prototype */\n\n\t\t/**\n\t\t * Class facilitating use of Facebook's JavaScript API.\n\t\t *\n\t\t * Note: Use redirect when popups are unusual or even unusable, e.g: on touch devices or within other apps.\n\t\t *\n\t\t * TODO: Rewrite to use and support Promise.Cancellable and have apps set and deal with timeouts themselves.\n\t\t * Also try to improve the ability of this code to recover from issues automatically (e.g. reload script).\n\t\t *\n\t\t * @extends playtotv.model.ObjectModel\n\t\t * @constructs\n\t\t * @param {Options} options\n\t\t * @param {string} options.appId Facebook App Id to use\n\t\t * @param {string} [options.version='v2.3'] API version to use\n\t\t * @param {string} [options.cookie=false] Create session cookie or not\n\t\t * @param {string} [options.status=true] Refresh user login status on init\n\t\t * @param {string} [options.xfbml=false] Parse social plugin XFBML tags\n\t\t * @param {string} [options.frictionlessRequests=false] Enable Frictionless Requests for games\n\t\t * @param {string} [options.hideFlashCallback=null] Callback to hide any Adobe Flash objects\n\t\t * @param {string} [options.locale='en_US'] Facebook API locale\n\t\t * @param {string} [options.redirect] If defined, redirect using this URL instead of showing popup/.. dialogs\n\t\t * @param {string} [options.scope] Comma separated list of extended permissions to require when you login\n\t\t * @param {number} [options.timeout=20000] Initialization timeout in ms\n\t\t *\n\t\t * @property {string} status Subscribable: Current Facebook API status\n\t\t * @property {string} id Subscribable: If connected then your Facebook user id, otherwise null\n\t\t * @property {string} accessToken Subscribable: If connected then your accessToken, otherwise null\n\t\t * @property {string} signedRequest Subscribable: If connected then your signedRequest, otherwise null\n\t\t */\n\t\tconstructor(options) {\n\t\t\tsuper({\n\t\t\t\tstatus: null,\n\t\t\t\tid: null,\n\t\t\t\taccessToken: null,\n\t\t\t\tsignedRequest: null\n\t\t\t});\n\n\t\t\toptions = ptv.params(options, {\n\t\t\t\tappId: REQUIRED,\n\t\t\t\tversion: 'v2.3',\n\t\t\t\tcookie: false,\n\t\t\t\tstatus: true,\n\t\t\t\txfbml: false, // seems pointless with dynamic html\n\t\t\t\tfrictionlessRequests: false,\n\t\t\t\thideFlashCallback: null,\n\n\t\t\t\tlocale: 'en_US',\n\t\t\t\tredirect: undefined,\n\t\t\t\tscope: undefined,\n\t\t\t\ttimeout: 20000\n\t\t\t});\n\n\t\t\t// TODO: Rewrite without use of Promise.defer()\n\t\t\tvar deferred = Promise.defer();\n\n\t\t\tthis.appId = options.appId;\n\t\t\tthis.version = options.version;\n\t\t\tthis.locale = options.locale;\n\t\t\tthis.redirect = options.redirect;\n\t\t\tthis.scope = options.scope;\n\n\t\t\t////////// Documented properties\n\n\t\t\t/**\n\t\t\t * Promise of initialization, rejected in case of timeout.\n\t\t\t * @type Promise\n\t\t\t */\n\t\t\tthis.initialized = new Promise.Cancellable(function(resolve, reject) {\n\t\t\t\tdeferred.promise.then(resolve, reject);\n\t\t\t\tif (options.timeout) {\n\t\t\t\t\tthis.setTimeout(options.timeout);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t////////// Initialize\n\t\t\twindow.fbAsyncInit = function() {\n\t\t\t\tvar FB = window.FB;\n\n\t\t\t\tFB.init(ptv.pick(options, [\n\t\t\t\t\t'appId', 'version', 'cookie', 'status', 'xfbml', 'frictionlessRequests', 'hideFlashCallback'\n\t\t\t\t]));\n\n\t\t\t\tFB.Event.subscribe('auth.authResponseChange', this.onStatusResponse.bind(this));\n\n\t\t\t\t// Get login status now to get started with the current session\n\t\t\t\tFB.getLoginStatus(function(response) {\n\t\t\t\t\tthis.onStatusResponse(response);\n\t\t\t\t\tdeferred.resolve(FB);\n\t\t\t\t}.bind(this));\n\t\t\t}.bind(this);\n\n\t\t\tptv.loadScript('//connect.facebook.net/' + this.locale + '/sdk.js', true);\n\t\t}\n\n\t\t////////// Undocumented methods\n\n\t\tonStatusResponse(response) {\n\t\t\tvar authResponse = response.authResponse || {};\n\t\t\tthis.copyProperties({\n\t\t\t\tstatus: response.status,\n\t\t\t\tid: authResponse.userID || null,\n\t\t\t\taccessToken: authResponse.accessToken || null,\n\t\t\t\tsignedRequest: authResponse.signedRequest || null\n\t\t\t});\n\t\t}\n\n\t\t////////// Documented methods\n\n\t\t/**\n\t\t * Generic FB function wrapper adding support for timeout, error reporting and promise.\n\t\t *\n\t\t * Any further arguments past the timeout argument are passed to the FB function being called.\n\t\t *\n\t\t * Note: This assumes that the last argument of the FB.[what] function is a response callback function.\n\t\t *\n\t\t * @param {string} what Name of function to call on FB (e.g: 'api' for FB.api())\n\t\t * @param {number} [timeout=20000] Timeout in ms (beware of user interaction!) (falsy to disable)\n\t\t * @return {Promise} Promise of FB call response, rejected if response.error is set or call times out\n\t\t */\n\t\tcall(what, timeout) {\n\t\t\ttimeout = timeout !== undefined ? timeout : 20000;\n\n\t\t\tvar args = Array.from(arguments).slice(2);\n\t\t\tvar details = { what: what, timeout: timeout, args: args };\n\n\t\t\tlog.s('FB.' + what + '(', args, '), timeout: ' + timeout);\n\n\t\t\tvar cancellable = this.initialized.then(function(FB) {\n\t\t\t\t// TODO: Rewrite without use of Promise.defer()\n\t\t\t\tvar deferred = Promise.defer();\n\n\t\t\t\targs.push(function(response) {\n\t\t\t\t\tif (response && response.error) {\n\t\t\t\t\t\t// Note: usual properties: message, code, error_subcode, error_user_msg, error_user_title\n\t\t\t\t\t\t// See: https://developers.facebook.com/docs/graph-api/using-graph-api/v2.3#errors\n\t\t\t\t\t\tdeferred.reject(Object.assign(new Error('Call failed'), details, response.error, {\n\t\t\t\t\t\t\tmessage: 'Request error: ' + response.error.message\n\t\t\t\t\t\t}));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdeferred.resolve(response);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tFB[what].apply(FB, args);\n\n\t\t\t\treturn deferred.promise;\n\t\t\t});\n\n\t\t\t// TODO: Remove timeout arg here and leave it to calling code to add timeout on returned Cancellable\n\t\t\tif (timeout) {\n\t\t\t\tvar timeoutDetails = Object.assign({ message: 'Request timeout' }, details);\n\t\t\t\tcancellable.setTimeout(timeout, timeoutDetails);\n\t\t\t}\n\n\t\t\treturn cancellable;\n\t\t}\n\n\t\t/**\n\t\t * Shortcut to {@link playtotv.facebook.Facebook#call}('api', ..).\n\t\t *\n\t\t * TODO: Add support for paging.\n\t\t *\n\t\t * @return {Promise} As returned by {@link playtotv.facebook.Facebook#call}\n\t\t */\n\t\tapi() {\n\t\t\tvar args = Array.from(arguments);\n\t\t\targs.unshift('api');\n\t\t\treturn this.call.apply(this, args);\n\t\t}\n\n\t\t/**\n\t\t * Shortcut to {@link playtotv.facebook.Facebook#call}('ui', false, ..).\n\t\t *\n\t\t * @return {Promise} As returned by {@link playtotv.facebook.Facebook#call}\n\t\t */\n\t\tui() {\n\t\t\tvar args = Array.from(arguments);\n\t\t\targs.unshift('ui', false);\n\t\t\treturn this.call.apply(this, args);\n\t\t}\n\n\t\t/**\n\t\t * Returns friends who have used (via Facebook Login) the app making the request.\n\t\t *\n\t\t * Requires permission: user_friends\n\t\t *\n\t\t * @see <a href=\"https://developers.facebook.com/docs/graph-api/reference/v2.3/user/friends\">Graph API</a>\n\t\t *\n\t\t * @param {number} [timeout] {@link playtotv.facebook.Facebook#call} timeout\n\t\t * @return {Promise} Promise of array of friends\n\t\t */\n\t\tgetFriends(timeout) {\n\t\t\treturn this.api(timeout, '/me/friends').then(function(data) {\n\t\t\t\treturn data.data;\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Facility function for logging into Facebook.\n\t\t *\n\t\t * <ul>\n\t\t * <li>If you are already logged in this will resolve immediately.\n\t\t * <li>Otherwise if not interactive (e.g. asking for user input is disabled) this will reject.\n\t\t * <li>Otherwise if options.redirect is set this will use {@link playtotv.facebook.Facebook#loginByRedirect}.\n\t\t * <li>Otherwise this will use {@link playtotv.facebook.Facebook#loginByDialog}.\n\t\t * </ul>\n\t\t *\n\t\t * @param {boolean} [interactive=false] Whether to allow user interaction through a popup or redirect\n\t\t * @return {Promise} Promise of Facebook user id, rejected if cancelled by user\n\t\t */\n\t\tlogin(interactive) {\n\t\t\treturn this.initialized.then(function() {\n\t\t\t\tif (this.id) {\n\t\t\t\t\treturn Promise.resolve(this.id); // already logged in\n\t\t\t\t} else if (!interactive) {\n\t\t\t\t\treturn Promise.reject(new Error('Login requires user interaction'));\n\t\t\t\t} else if (this.redirect) {\n\t\t\t\t\tthis.loginByRedirect();\n\t\t\t\t\t// TODO: Rewrite without use of Promise.defer()\n\t\t\t\t\treturn Promise.defer().promise; // redirect does not resolve\n\t\t\t\t} else {\n\t\t\t\t\treturn this.loginByDialog();\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t}\n\n\t\t/**\n\t\t * Login to Facebook using FB popup dialog.\n\t\t *\n\t\t * TODO: Add support for options besides scope and move that out of Facebook options to login and loginByX\n\t\t *\n\t\t * @see <a href=\"https://developers.facebook.com/docs/reference/javascript/FB.login/v2.3\">SDK</a>\n\t\t *\n\t\t * @return {Promise} Promise of Facebook user id, rejected if cancelled by user\n\t\t */\n\t\tloginByDialog() {\n\t\t\treturn this.initialized.then(function(FB) {\n\t\t\t\t// Note: we can not use this.call() since the last argument is not the callback function with FB.login\n\t\t\t\t// TODO: Rewrite without use of Promise.defer()\n\t\t\t\tvar deferred = Promise.defer();\n\t\t\t\tFB.login(function(response) {\n\t\t\t\t\tif (response.authResponse && response.authResponse.userID) {\n\t\t\t\t\t\tdeferred.resolve(response.authResponse.userID);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdeferred.reject(Object.assign(new Error('Login failed'), response)); // e.g. cancelled by user\n\t\t\t\t\t}\n\t\t\t\t}, { scope: this.scope });\n\t\t\t\treturn deferred.promise;\n\t\t\t}.bind(this));\n\t\t}\n\n\t\t/**\n\t\t * Login to Facebook by redirecting to Facebook and then having Facebook redirect back to us with a token.\n\t\t *\n\t\t * @see <a href=\"https://developers.facebook.com/docs/facebook-login/manually-build-a-login-flow/v2.3\">Docs</a>\n\t\t *\n\t\t * @param {string} [redirect=options.redirect] URL that Facebook should redirect back to once done\n\t\t */\n\t\tloginByRedirect(redirect) {\n\t\t\t/*jshint camelcase:false*/\n\t\t\t/*jscs:disable requireCamelCaseOrUpperCaseIdentifiers*/\n\t\t\twindow.top.location = util.addURLParams('https://www.facebook.com/' + this.version + '/dialog/oauth', {\n\t\t\t\tclient_id: this.appId,\n\t\t\t\tresponse_type: 'token',\n\t\t\t\tscope: this.scope || '',\n\t\t\t\tredirect_uri: redirect || this.redirect\n\t\t\t});\n\t\t\t/*jscs:enable requireCamelCaseOrUpperCaseIdentifiers*/\n\t\t}\n\n\t\t/**\n\t\t * Logout of Facebook using FB API.\n\t\t *\n\t\t * @param {number} [timeout] {@link playtotv.facebook.Facebook#call} timeout for logout\n\t\t * @return {Promise} Promise of an object with a status property\n\t\t */\n\t\tlogout(timeout) {\n\t\t\treturn this.initialized.then(function() {\n\t\t\t\treturn this.id ? this.call('logout', timeout) : Promise.resolve({ status: this.status });\n\t\t\t}.bind(this));\n\t\t}\n\n\t\t/**\n\t\t * Facility function for posting to Facebook.\n\t\t *\n\t\t * <ul>\n\t\t * <li>If interactive and options.redirect is set then use {@link playtotv.facebook.Facebook#postByRedirect}.\n\t\t * <li>Otherwise login using {@link playtotv.facebook.Facebook#login}.<br>\n\t\t * Note: The login will reject if not interactive and not already logged in.\n\t\t * <li>Then if interactive use {@link playtotv.facebook.Facebook#postByDialog}.\n\t\t * <li>Otherwise use {@link playtotv.facebook.Facebook#postByAPI}.\n\t\t * </ul>\n\t\t *\n\t\t *\n\t\t * @param {Object} params <a href=\"http://developers.facebook.com/docs/reference/dialogs/feed/\">FB Doc</a>\n\t\t * @param {boolean} [interactive=false] Whether to let user review and confirm message before posting\n\t\t * @param {number} [timeout] {@link playtotv.facebook.Facebook#postByAPI} timeout (not used while interactive)\n\t\t * @return {Promise} Promise of post_id\n\t\t */\n\t\tpost(params, interactive, timeout) {\n\t\t\tif (interactive && this.redirect) {\n\t\t\t\tthis.postByRedirect(params, this.redirect);\n\t\t\t\t// TODO: Rewrite without use of Promise.defer()\n\t\t\t\treturn Promise.defer().promise; // redirect does not resolve\n\t\t\t} else {\n\t\t\t\treturn this.login(interactive).then(function() {\n\t\t\t\t\treturn interactive ? this.postByDialog(params) : this.postByAPI(params, timeout);\n\t\t\t\t}.bind(this));\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Post to Facebook wall using FB API, e.g: in the background, without asking for user input.\n\t\t *\n\t\t * TODO: Updated this to v2.3 (this is still legacy v1.0 code which probably does not work anymore)\n\t\t *\n\t\t * Note: This requires the publish_stream extended permission; get it using options.scope.\n\t\t *\n\t\t * @param {Object} params <a href=\"http://developers.facebook.com/docs/reference/dialogs/feed/\">FB Doc</a>\n\t\t * @param {[type]} [timeout] {@link playtotv.facebook.Facebook#call} timeout for api feed post\n\t\t * @return {Promise} Promise of post_id\n\t\t */\n\t\tpostByAPI(params, timeout) {\n\t\t\treturn this.call('api', timeout, '/me/feed', 'post', params).then(function(response) {\n\t\t\t\t/*jshint camelcase:false*/\n\t\t\t\treturn response.id;\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Post to Facebook wall using FB UI dialog.\n\t\t *\n\t\t * @param {Object} params <a href=\"http://developers.facebook.com/docs/reference/dialogs/feed/\">FB Doc</a>\n\t\t * @return {Promise} Promise of post_id\n\t\t */\n\t\tpostByDialog(params) {\n\t\t\treturn this.ui(Object.assign({\n\t\t\t\tmethod: 'feed'\n\t\t\t}, params)).then(function(response) {\n\t\t\t\t/*jshint camelcase:false*/\n\t\t\t\t/*jscs:disable requireCamelCaseOrUpperCaseIdentifiers*/\n\t\t\t\treturn response && response.post_id ||\n\t\t\t\t\tPromise.reject(Object.assign(new Error('Post failed'), response));\n\t\t\t\t/*jscs:enable requireCamelCaseOrUpperCaseIdentifiers*/\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Post to Facebook wall by redirecting to Facebook and then having Facebook redirect back to us.\n\t\t *\n\t\t * @param {Object} params <a href=\"http://developers.facebook.com/docs/reference/dialogs/feed/\">FB Doc</a>\n\t\t * @param {string} [redirect=options.redirect] URL that Facebook should redirect back to once done\n\t\t * @return {Promise} Promise of post_id\n\t\t */\n\t\tpostByRedirect(params, redirect) {\n\t\t\t/*jshint camelcase:false*/\n\t\t\t/*jscs:disable requireCamelCaseOrUpperCaseIdentifiers*/\n\t\t\twindow.top.location = util.addURLParams('https://www.facebook.com/dialog/feed', Object.assign({\n\t\t\t\tapp_id: this.appId,\n\t\t\t\tredirect_uri: redirect || this.redirect\n\t\t\t}, params));\n\t\t\t/*jscs:enable requireCamelCaseOrUpperCaseIdentifiers*/\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.model.ArrayModel', [\n\t'playtotv.model.AbstractModel'\n], function(\n\tAbstractModel\n) {\n\n\t'use strict';\n\n\tfunction countEqualItems(array, item) {\n\t\tvar count = 0;\n\t\tvar len = array.length;\n\t\tvar i;\n\t\tfor (i = 0; i < len; i++) {\n\t\t\tif (array[i] === item) {\n\t\t\t\tcount++;\n\t\t\t}\n\t\t}\n\t\treturn count;\n\t}\n\n\treturn class ArrayModel extends AbstractModel {\n\t\t/** @lends playtotv.model.ArrayModel.prototype */\n\n\t\t/**\n\t\t * Concrete implementation of {@link playtotv.model.AbstractModel} for storing an Array of items.\n\t\t *\n\t\t * If a source array is specified then it's items will be copied using {@link playtotv.model.ArrayModel#add}.\n\t\t *\n\t\t * Model items can be read and iterated etc. by using this instance's {@link playtotv.model.ArrayModel#array}\n\t\t * property.\n\t\t *\n\t\t * @extends playtotv.model.AbstractModel\n\t\t * @constructs\n\t\t * @param {Array} [source] Source array to copy into this model\n\t\t *\n\t\t * @property {Array} array Container of this model's items\n\t\t * @property {Array} childSubscriptions Array mapping item indexes to child model subscriptions\n\t\t */\n\t\tconstructor(source) {\n\t\t\tsuper();\n\n\t\t\tthis.array = [];\n\t\t\tthis.childSubscriptions = [];\n\n\t\t\tif (source) {\n\t\t\t\tsource.forEach(function(item) {\n\t\t\t\t\tthis.add(item);\n\t\t\t\t}.bind(this));\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Implementation of {@link playtotv.model.AbstractModel#toObject}.\n\t\t *\n\t\t * @returns {Array} Plain JavaScript Array Object copy of the model data\n\t\t */\n\t\ttoObject() {\n\t\t\treturn this.array.slice(0);\n\t\t}\n\n\t\t/**\n\t\t * Implementation of {@link playtotv.model.AbstractModel#updateModel}.\n\t\t *\n\t\t * First tries to check whether JSON stringified versions of source and array are equal and aborts if so.\n\t\t *\n\t\t * Items are {@link playtotv.model.ArrayModel#remove}d from right to left then\n\t\t * {@link playtotv.model.ArrayModel#add}ed and then {@link playtotv.model.ArrayModel#change}d from left to\n\t\t * right.\n\t\t *\n\t\t * @param {Array} source Source data array to update model to\n\t\t * @returns {[mixed]} Array with any removed items for garbage collection etc.\n\t\t */\n\t\tupdateModel(source) {\n\t\t\tvar array = this.array;\n\t\t\tvar sourceLength = source.length;\n\t\t\tvar removedItems = [];\n\t\t\tvar i, item;\n\n\t\t\t// TODO: JSON stringify compare items individually to try to minimize number of removes, adds and changes\n\t\t\ttry {\n\t\t\t\tif (JSON.stringify(source) === JSON.stringify(array)) {\n\t\t\t\t\treturn [];\n\t\t\t\t}\n\t\t\t} catch (e) {}\n\n\t\t\tfor (i = array.length - 1; i >= 0; i--) {\n\t\t\t\titem = array[i];\n\t\t\t\tif (countEqualItems(source, item) < countEqualItems(array, item)) {\n\t\t\t\t\tremovedItems.push(this.remove(i));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (i = 0; i < sourceLength; i++) {\n\t\t\t\titem = source[i];\n\t\t\t\tif (countEqualItems(source, item) > countEqualItems(array, item)) {\n\t\t\t\t\tthis.add(item, i);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (i = 0; i < sourceLength; i++) {\n\t\t\t\tremovedItems.push(this.change(i, source[i]));\n\t\t\t}\n\n\t\t\treturn removedItems;\n\t\t}\n\n\t\t/**\n\t\t * Implementation of {@link playtotv.model.AbstractModel#isRelatedModel}.\n\t\t *\n\t\t * @param {playtotv.model.AbstractModel} root Root model to compare to\n\t\t * @returns {boolean} True if this model has a cyclic relation to root\n\t\t */\n\t\tisRelatedModel(root) {\n\t\t\t/*jshint maxdepth:4*/\n\n\t\t\tif (this === root) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tvar childSubscriptions = this.childSubscriptions;\n\t\t\tvar length = childSubscriptions.length;\n\t\t\tvar i, childSubscription, childModel;\n\n\t\t\tfor (i = 0; i < length; i++) {\n\t\t\t\tchildSubscription = childSubscriptions[i];\n\t\t\t\tif (childSubscription) {\n\t\t\t\t\tchildModel = childSubscription.model;\n\t\t\t\t\tif (childModel instanceof AbstractModel) {\n\t\t\t\t\t\tif (childModel.isRelatedModel(root)) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\t/**\n\t\t * Subscribe to child model to have it's publishes bubble up to this one.\n\t\t *\n\t\t * Note: It is required that child model is not in a cyclic relationship with this model.\n\t\t *\n\t\t * @param {number} index Child model index\n\t\t * @param {playtotv.model.AbstractModel} child Child model to subscribe to\n\t\t */\n\t\tsubscribeChild(index, child) {\n\t\t\tvar childSubscriptions = this.childSubscriptions;\n\n\t\t\tvar subscription = child.subscribe('*', function(childValue, childAction, childKey) {\n\t\t\t\t// Index could have changed\n\t\t\t\tindex = childSubscriptions.indexOf(childSubscription);\n\t\t\t\tthis.publish(index + '.' + childKey, childAction, childValue);\n\t\t\t}.bind(this));\n\n\t\t\tvar childSubscription = {\n\t\t\t\tmodel: child,\n\t\t\t\tsubscription: subscription\n\t\t\t};\n\n\t\t\tchildSubscriptions[index] = childSubscription;\n\t\t}\n\n\t\t/**\n\t\t * Unsubscribe child model so it's publishes no longer bubble up to this one.\n\t\t *\n\t\t * @param {number} index Child model index\n\t\t */\n\t\tunsubscribeChild(index) {\n\t\t\tvar childSubscriptions = this.childSubscriptions;\n\t\t\tvar childSubscription = childSubscriptions[index];\n\t\t\tchildSubscription.model.unsubscribe(childSubscription.subscription);\n\t\t\tchildSubscriptions[index] = null;\n\t\t}\n\n\t\t/**\n\t\t * Add item to this model.\n\t\t *\n\t\t * @param {mixed} item Item to add\n\t\t * @param {number} [index=array.length] Index at which to add item\n\t\t * @throws {RangeError} If index is out of bounds\n\t\t * @throws {Error} If item is a model in a cyclic relationship with this model\n\t\t */\n\t\tadd(item, index) {\n\t\t\tvar array = this.array;\n\t\t\tvar arrayLength = array.length;\n\t\t\tvar childSubscriptions = this.childSubscriptions;\n\t\t\tvar itemIsModel = item instanceof AbstractModel;\n\n\t\t\tif (arguments.length < 2) {\n\t\t\t\tindex = arrayLength;\n\t\t\t}\n\n\t\t\tif (index < 0) {\n\t\t\t\tthrow new RangeError('Index out of bounds: ' + index);\n\t\t\t}\n\t\t\tif (itemIsModel && item.isRelatedModel(this)) {\n\t\t\t\tthrow new Error('Item is a model in a cyclic relationship with this model');\n\t\t\t}\n\n\t\t\tif (index < arrayLength) {\n\t\t\t\tarray.splice(index, 0, item);\n\t\t\t\tchildSubscriptions.splice(index, 0, null);\n\t\t\t} else {\n\t\t\t\tarray[index] = item;\n\t\t\t\tchildSubscriptions[index] = null;\n\t\t\t}\n\n\t\t\tif (itemIsModel) {\n\t\t\t\tthis.subscribeChild(index, item);\n\t\t\t}\n\n\t\t\tthis.publish(index, 'add', item);\n\t\t}\n\n\t\t/**\n\t\t * Change item at specified index in this model.\n\t\t *\n\t\t * @param {number} index Index at which to change item\n\t\t * @param {mixed} item Item to change to\n\t\t * @throws {RangeError} If index is out of bounds\n\t\t * @throws {Error} If item is a model in a cyclic relationship with this model\n\t\t * @returns {mixed} Removed item (if any) for garbage collection etc.\n\t\t */\n\t\tchange(index, item) {\n\t\t\tvar array = this.array;\n\t\t\tvar itemIsModel = item instanceof AbstractModel;\n\n\t\t\tif (index < 0 || index >= array.length) {\n\t\t\t\tthrow new RangeError('Index out of bounds: ' + index);\n\t\t\t}\n\n\t\t\tvar oldItem = array[index];\n\n\t\t\tif (item === oldItem) {\n\t\t\t\treturn; // no change\n\t\t\t}\n\n\t\t\tif (itemIsModel && item.isRelatedModel(this)) {\n\t\t\t\tthrow new Error('Item is a model in a cyclic relationship with this model');\n\t\t\t}\n\n\t\t\tif (oldItem instanceof AbstractModel) {\n\t\t\t\tthis.unsubscribeChild(index);\n\t\t\t}\n\n\t\t\tarray[index] = item;\n\n\t\t\tif (itemIsModel) {\n\t\t\t\tthis.subscribeChild(index, item);\n\t\t\t}\n\n\t\t\tthis.publish(index, 'change', item);\n\n\t\t\treturn oldItem;\n\t\t}\n\n\t\t/**\n\t\t * Remove item with specified index from this model.\n\t\t *\n\t\t * @param {number} [index=0] Index from which to remove item\n\t\t * @throws {RangeError} If index is out of bounds\n\t\t * @returns {mixed} Removed item for garbage collection etc.\n\t\t */\n\t\tremove(index) {\n\t\t\tvar array = this.array;\n\n\t\t\tif (arguments.length < 1) {\n\t\t\t\tindex = 0;\n\t\t\t} else if (index < 0 || index >= array.length) {\n\t\t\t\tthrow new RangeError('Index out of bounds: ' + index);\n\t\t\t}\n\n\t\t\tvar oldItem = array[index];\n\n\t\t\tif (oldItem instanceof AbstractModel) {\n\t\t\t\tthis.unsubscribeChild(index);\n\t\t\t}\n\n\t\t\tarray.splice(index, 1);\n\t\t\tthis.childSubscriptions.splice(index, 1);\n\n\t\t\tthis.publish(index, 'remove', oldItem);\n\n\t\t\treturn oldItem;\n\t\t}\n\n\t\t/**\n\t\t * Remove all items that match the specified condition from this model.\n\t\t *\n\t\t * @param {Function|mixed} condition Evaluation function or value to match items with\n\t\t * @returns {Array} Removed items for garbage collection etc.\n\t\t */\n\t\tremoveWhere(condition) {\n\t\t\tif (!(condition instanceof Function)) {\n\t\t\t\tvar value = condition;\n\t\t\t\tcondition = function(candidate) {\n\t\t\t\t\treturn candidate === value;\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tvar removed = [];\n\t\t\tvar array = this.array;\n\t\t\tfor (var i = array.length - 1; i >= 0; i--) {\n\t\t\t\tif (condition(array[i])) {\n\t\t\t\t\tremoved.push(this.remove(i));\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn removed;\n\t\t}\n\n\t\t/**\n\t\t * Remove all items from this model.\n\t\t *\n\t\t * @returns {Array} Removed items for garbage collection etc.\n\t\t */\n\t\tclear() {\n\t\t\tvar removed = [];\n\t\t\tfor (var i = this.array.length - 1; i >= 0; i--) {\n\t\t\t\tremoved.push(this.remove(i));\n\t\t\t}\n\t\t\treturn removed;\n\t\t}\n\n\t\t/**\n\t\t * Either calls {@link playtotv.model.ArrayModel#change} or {@link playtotv.model.ArrayModel#add} depending on\n\t\t * whether index is smaller then array length or not.\n\t\t *\n\t\t * @param {number} index Argument to #add or #change\n\t\t * @param {mixed} item Argument to #add or #change\n\t\t * @returns {mixed} Removed item (if any) for garbage collection etc.\n\t\t */\n\t\tset(index, item) {\n\t\t\tif (index < this.array.length) {\n\t\t\t\treturn this.change(index, item);\n\t\t\t} else {\n\t\t\t\tthis.add(item, index);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Dispose array and child subscriptions.\n\t\t *\n\t\t * Note: Do not forget to also dispose any child models that are no longer used.\n\t\t */\n\t\tdispose() {\n\t\t\tthis.array.length = 0;\n\n\t\t\tthis.childSubscriptions.forEach(function(childSubscription) {\n\t\t\t\tif (childSubscription) {\n\t\t\t\t\tchildSubscription.model.unsubscribe(childSubscription.subscription);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tAbstractModel.prototype.dispose.call(this);\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.model.modelUtil', [\n\t'playtotv.model.AbstractModel',\n\t'playtotv.model.ArrayModel',\n\t'playtotv.model.ObjectModel'\n], function(\n\tAbstractModel,\n\tArrayModel,\n\tObjectModel\n) {\n\n\t'use strict';\n\n\t/**\n\t * @name playtotv.model.modelUtil\n\t * @namespace Namespace for model utility functions\n\t */\n\treturn {\n\t\t/** @lends playtotv.model.modelUtil */\n\n\t\t/**\n\t\t * Returns a recursively modelified copy of specified value.\n\t\t *\n\t\t * Note: This may create many models, so take care, especially with regards to memory leaks.\n\t\t *\n\t\t * @param {mixed} value Value to modelify\n\t\t * @param {boolean} [doNotThrow=false] If true then just return original value instead of throwing an exception\n\t\t * @throws {TypeError} If value is already a Model\n\t\t * @throws {TypeError} If value can not be modelified (it is neither Array nor Object)\n\t\t * @returns {playtotv.model.ArrayModel|playtotv.model.ObjectModel} Modelified copy\n\t\t */\n\t\tcreate: function(value, doNotThrow) {\n\t\t\tif (value instanceof AbstractModel) {\n\t\t\t\tif (doNotThrow) {\n\t\t\t\t\treturn value;\n\t\t\t\t}\n\t\t\t\tthrow new TypeError('Value is already a Model');\n\t\t\t} else if (value instanceof Array) {\n\t\t\t\treturn new ArrayModel(value.map(function(item) {\n\t\t\t\t\treturn this.create(item, true);\n\t\t\t\t}.bind(this)));\n\t\t\t} else if (typeof value === 'object' && value !== null) {\n\t\t\t\treturn new ObjectModel(Object.keys(value).reduce(function(model, key) {\n\t\t\t\t\tmodel[key] = this.create(value[key], true);\n\t\t\t\t\treturn model;\n\t\t\t\t}.bind(this), {}));\n\t\t\t} else {\n\t\t\t\tif (doNotThrow) {\n\t\t\t\t\treturn value;\n\t\t\t\t}\n\t\t\t\tthrow new TypeError('Value can not be modelified');\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Returns a recursively de-modelified copy of specified model.\n\t\t *\n\t\t * @param {playtotv.model.AbstractModel} model Model to de-modelify\n\t\t * @return {Object} De-modelified copy\n\t\t */\n\t\ttoObject: function(model) {\n\t\t\t// This code works on both normal and Array objects\n\t\t\tvar obj = model.toObject();\n\t\t\tplaytotv.each(obj, function(value, key) {\n\t\t\t\tif (value instanceof AbstractModel) {\n\t\t\t\t\tobj[key] = this.toObject(value);\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t\treturn obj;\n\t\t},\n\n\t\t/**\n\t\t * Recursively updates a model using {@link playtotv.model.AbstractModel#updateModel}.\n\t\t *\n\t\t * Note: Any child models removed in this process will be assumed to no longer be used and disposed.\n\t\t *\n\t\t * @example\n\t\t * var m = modelUtil.create({\n\t\t *   a: 1,\n\t\t *   b: { p: 'p' },\n\t\t *   c: [ { q: 'q' } ],\n\t\t *   d: { x: 2 }\n\t\t * });\n\t\t *\n\t\t * modelUtil.update(m, {\n\t\t *   a: 2,\n\t\t *   b: { p: 'P' },\n\t\t *   c: [ { q: 'Q' }, { r: 'R' } ]\n\t\t * });\n\t\t *\n\t\t * // Is equivalent to:\n\t\t * // m.b.changeProperty('p', 'P');\n\t\t * // m.c.array[0].changeProperty('q', 'Q');\n\t\t * // m.c.add(new ObjectModel({ r: 'R' }));\n\t\t * // d = m.d;\n\t\t * // m.removeProperty('d');\n\t\t * // d.dispose();\n\t\t * // m.changeProperty('a', 2);\n\t\t *\n\t\t * @param {playtotv.model.AbstractModel} model Model to update\n\t\t * @param {Object} source Source data to update model to\n\t\t * @throws {TypeError} If model is not an {@link playtotv.model.AbstractModel}\n\t\t * @throws {TypeError} If source is already an {@link playtotv.model.AbstractModel}\n\t\t */\n\t\tupdate: function(model, source) {\n\t\t\tif (!(model instanceof AbstractModel)) {\n\t\t\t\tthrow new TypeError('Model argument is not a model');\n\t\t\t}\n\t\t\tif (source instanceof AbstractModel) {\n\t\t\t\tthrow new TypeError('Source is already a Model');\n\t\t\t}\n\n\t\t\tvar isArray = model instanceof ArrayModel;\n\t\t\tvar updatedSource = isArray ? [] : {};\n\n\t\t\t// Recurse into children updates or modelifications\n\t\t\tplaytotv.each(source, function(sValue, key) {\n\t\t\t\tif (sValue instanceof AbstractModel) {\n\t\t\t\t\tthrow new Error('Source value is already a Model');\n\t\t\t\t}\n\n\t\t\t\tvar mValue = isArray ? model.array[key] : model[key];\n\t\t\t\tvar svIsArray = sValue instanceof Array;\n\t\t\t\tvar svIsObject = !svIsArray && typeof sValue === 'object' && sValue !== null;\n\n\t\t\t\tif ((svIsObject && mValue instanceof ObjectModel) || (svIsArray && mValue instanceof ArrayModel)) {\n\t\t\t\t\tthis.update(mValue, sValue);\n\t\t\t\t\tupdatedSource[key] = mValue;\n\t\t\t\t} else if (svIsObject || svIsArray) {\n\t\t\t\t\tupdatedSource[key] = this.create(sValue);\n\t\t\t\t} else {\n\t\t\t\t\tupdatedSource[key] = sValue;\n\t\t\t\t}\n\t\t\t}.bind(this));\n\n\t\t\tvar removedValues = model.updateModel(updatedSource);\n\t\t\tremovedValues.filter(function(rValue) {\n\t\t\t\treturn rValue instanceof AbstractModel;\n\t\t\t}).forEach(function(rModel) {\n\t\t\t\tthis.dispose(rModel);\n\t\t\t}.bind(this));\n\t\t},\n\n\t\t/**\n\t\t * Recursively dispose a model and all of it's child models.\n\t\t *\n\t\t * @param {playtotv.model.AbstractModel} model Model to dispose\n\t\t */\n\t\tdispose: function(model) {\n\t\t\tplaytotv.each(model.toObject(), function(value) {\n\t\t\t\tif (value instanceof AbstractModel) {\n\t\t\t\t\tthis.dispose(value);\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t\tmodel.dispose();\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.logUtil', [\n\t'playtotv.model.modelUtil'\n], function(\n\tmodelUtil\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar util = ptv.util;\n\n\t/**\n\t * @name playtotv.logUtil\n\t * @namespace Log utility functions\n\t */\n\treturn {\n\t\t/** @lends playtotv.logUtil */\n\n\t\t/**\n\t\t * Log publishes made to specified PubSub with specified log function.\n\t\t *\n\t\t * @param {playtotv.pubsub.PubSub} pubsub PubSub to subscribe to\n\t\t * @param {playtotv.Logger} log Logger to use for logging\n\t\t * @param {Object} [levelMap={ '*': 'INFO' }] Channel glob to log level map\n\t\t * @returns {playtotv.pubsub.Subscription} PubSub subscription\n\t\t */\n\t\tlogPubSub: function(pubsub, log, levelMap = { '*': 'INFO' }) {\n\t\t\tvar rules = Object.keys(levelMap).map((key) => ({\n\t\t\t\tregex: util.globToRegEx(key),\n\t\t\t\tlevel: levelMap[key]\n\t\t\t}));\n\n\t\t\treturn pubsub.subscribe('*', (data, channel) => {\n\t\t\t\tvar level = rules.find(rule => rule.regex.test(channel)).level;\n\n\t\t\t\tif (level === 'IGNORE') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (data && data.toObject) {\n\t\t\t\t\tdata = modelUtil.toObject(data);\n\t\t\t\t}\n\n\t\t\t\tvar args = typeof data === 'object' ? [ channel, data ] : [ channel + ': ' + data ];\n\t\t\t\tlog.log(level, args);\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Log mutations made to specified Model with specified log function.\n\t\t *\n\t\t * @param {playtotv.model.AbstractModel} model Model to subscribe to\n\t\t * @param {Function} fn Log function to call on mutation\n\t\t * @param {Object} [options={}] Options\n\t\t * @param {[string]} [options.blacklist=[]] Array of key globs to ignore\n\t\t * @param {string} [options.name] Name of Model to prefix log string with\n\t\t * @returns {playtotv.model.ModelSubscription} Model subscription\n\t\t */\n\t\tlogModel: function(model, fn, options) {\n\t\t\toptions = ptv.params(options, { blacklist: [], name: '' });\n\t\t\tvar blacklist = options.blacklist.map(glob => util.globToRegEx(glob));\n\t\t\tvar prefix = options.name;\n\t\t\tprefix = prefix ? prefix + ' ' : '';\n\t\t\treturn model.subscribe('*', function(v, a, k) {\n\t\t\t\tif (blacklist.find(regex => regex.test(k))) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (v && v.toObject) {\n\t\t\t\t\tv = modelUtil.toObject(v);\n\t\t\t\t}\n\n\t\t\t\tvar pak = prefix + a + ' ' + k;\n\t\t\t\tif (typeof v === 'object') {\n\t\t\t\t\tfn(pak, v);\n\t\t\t\t} else {\n\t\t\t\t\tfn(pak + ' => ' + v);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Log calls made to specified instance method with specified log function.\n\t\t *\n\t\t * Note: This replaces specfified instance method by another function that calls the original function.\n\t\t *\n\t\t * @param {Object} instance Instance to which the method belongs\n\t\t * @param {string} methodName Name of instance method\n\t\t * @param {Function} fn Log function to call with logName and call arguments\n\t\t * @param {string} [logName=methodName] Method name to use for logging\n\t\t */\n\t\tlogMethod: function(instance, methodName, fn, logName) {\n\t\t\tlogName = logName || methodName;\n\t\t\tvar method = instance[methodName];\n\t\t\tinstance[methodName] = function() {\n\t\t\t\tvar args = Array.from(arguments);\n\t\t\t\tfn(logName, args);\n\t\t\t\treturn method.apply(instance, args);\n\t\t\t};\n\t\t},\n\n\t\t/**\n\t\t * Log calls made to methods of specified instance with specified log function.\n\t\t *\n\t\t * Note: This replaces specfified instance methods by other functions that call the original functions.\n\t\t *\n\t\t * @param {Object} instance Instance to which the method belongs\n\t\t * @param {Function} fn Log function to call with name and call arguments\n\t\t * @param {Object} [options={}] Options\n\t\t * @param {[string]} [options.blacklist=[]] Array of method name globs to ignore\n\t\t * @param {string} [options.name] Name of instance to prefix method names with\n\t\t */\n\t\tlogMethods: function(instance, fn, options) {\n\t\t\toptions = ptv.params(options, { blacklist: [], name: '' });\n\t\t\tvar blacklist = options.blacklist.map(glob => util.globToRegEx(glob));\n\t\t\tvar prefix = options.name;\n\t\t\tprefix = prefix ? prefix + '.' : '';\n\t\t\t/*jshint forin:false*/\n\t\t\tfor (var key in instance) {\n\t\t\t\tif (instance[key] instanceof Function && !blacklist.find(regex => regex.test(key))) {\n\t\t\t\t\tthis.logMethod(instance, key, fn, prefix + key);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.MutationObserver', [], function() {\n\n\t'use strict';\n\n\t// Abort if we are not running in a browser (e.g: in Node)\n\tif (typeof window === 'undefined') {\n\t\treturn;\n\t}\n\n\tvar event = playtotv.event;\n\n\t/**\n\t * MutationRecord\n\t * https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver#MutationRecord\n\t *\n\t * @name MutationRecord\n\t * @namespace\n\t * @memberOf playtotv\n\t * @property {String} type The event's type: childList, attributes or characterData\n\t * @property {Node} target The affected node, for childList the inserted/removed node's parent, otherwise self.\n\t * @property {Array} addedNodes Array of insterted nodes for childList mutations.\n\t * @property {Array} removedNodes Array of removed nodes for childList mutations.\n\t * @property {Node} previousSibling Previous sibling of inserted/removed nodes or null\n\t * @property {Node} nextSibling Next sibling of inserted/removed nodes or null\n\t * @property {String} attributeName The name of the attribute that changed or null\n\t * @property {String} attributeNamespace The namespace of the changed attribute or null\n\t * @property {String} oldValue The previous value of changed attributes or characterData, or null\n\t */\n\tvar mutationRecord = {\n\t\ttype: null,\n\t\ttarget: null,\n\t\taddedNodes: [], // Spec says null, but actually returns an empty nodelist.\n\t\tremovedNodes: [], // Spec says null, but actually returns an empty nodelist.\n\t\tpreviousSibling: null,\n\t\tnextSibling: null,\n\t\tattributeName: null,\n\t\tattributeNamespace: null,\n\t\toldValue: null\n\t};\n\n\t// https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver#MutationObserverInit\n\tvar mutationOptions = {\n\t\tchildList: false,\n\t\tattributes: false,\n\t\tcharacterData: false,\n\t\tsubtree: false,\n\t\tattributeOldValue: false,\n\t\tcharacterDataOldValue: false,\n\t\tattributeFilter: false\n\t};\n\n\t/**\n\t * DOM3 event to DOM4 mutationRecord processors\n\t *\n\t */\n\tvar processors = {\n\t\tDOMNodeInserted: function(e, options, node) {\n\t\t\tvar inserted = e.target;\n\t\t\treturn (options.subtree || (inserted.parentNode === node)) ? playtotv.params({\n\t\t\t\ttype: 'childList',\n\t\t\t\ttarget: inserted.parentNode,\n\t\t\t\taddedNodes: [ inserted ],\n\t\t\t\tpreviousSibling: inserted.previousSibling,\n\t\t\t\tnextSibling: inserted.nextSibling\n\t\t\t}, mutationRecord) : null;\n\t\t},\n\n\t\tDOMNodeRemoved: function(e, options, node) {\n\t\t\tvar removed = e.target;\n\t\t\treturn (options.subtree || (removed.parentNode === node)) ? playtotv.params({\n\t\t\t\ttype: 'childList',\n\t\t\t\ttarget: removed.parentNode,\n\t\t\t\tremovedNodes: [ removed ],\n\t\t\t\tpreviousSibling: removed.previousSibling,\n\t\t\t\tnextSibling: removed.nextSibling\n\t\t\t}, mutationRecord) : null;\n\t\t},\n\n\t\tDOMAttrModified: function(e, options, node) {\n\t\t\tvar attr = e.attrName;\n\t\t\tvar filter = options.attributeFilter;\n\t\t\treturn (options.subtree || (e.target === node)) && (!filter || filter.indexOf(attr) >= 0) ?\n\t\t\t\tplaytotv.params({\n\t\t\t\t\ttype: 'attributes',\n\t\t\t\t\ttarget: e.target,\n\t\t\t\t\tattributeName: attr,\n\t\t\t\t\toldValue: options.attributeOldValue ? e.prevValue : null\n\t\t\t\t}, mutationRecord) :\n\t\t\t\tnull;\n\t\t},\n\n\t\tDOMCharacterDataModified: function(e, options, node) {\n\t\t\treturn (options.subtree || (e.target === node)) ? playtotv.params({\n\t\t\t\ttype: 'characterData',\n\t\t\t\ttarget: e.target,\n\t\t\t\toldValue: options.characterDataOldValue ? e.prevValue : null\n\t\t\t}, mutationRecord) : null;\n\t\t}\n\t};\n\n\t/**\n\t * MutationProxy,\n\t *\n\t */\n\tclass MutationProxy {\n\t\tconstructor(node, proxyEvent, observer) {\n\t\t\tthis.node = node;\n\t\t\tthis.proxyEvent = proxyEvent;\n\t\t\tthis.observer = observer;\n\t\t\tthis.processor = processors[proxyEvent];\n\t\t\tthis.onModified = this.onModified.bind(this);\n\t\t\tevent.addListener(node, proxyEvent, this.onModified);\n\t\t}\n\n\t\tonModified(e) {\n\t\t\tvar observer = this.observer;\n\t\t\tvar record = this.processor(e, observer.options, this.node);\n\t\t\tif (record) {\n\t\t\t\tobserver.addRecord(record);\n\t\t\t}\n\t\t}\n\n\t\tdisconnect() {\n\t\t\tevent.removeListener(this.node, this.proxyEvent, this.onModified);\n\t\t\tdelete this.node;\n\t\t\tdelete this.proxyEvent;\n\t\t\tdelete this.observer;\n\t\t\tdelete this.processor;\n\t\t}\n\t}\n\n\t/**\n\t * Mutation Observer pollyfill. The pollyfill is only applied if a native implementation is not supported.\n\t * https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver\n\t *\n\t * @name MutationObserver\n\t * @memberOf playtotv\n\t * @class\n\t * @param {Function} callback\n\t */\n\tclass MutationObserver {\n\n\t\tconstructor(callback) {\n\t\t\tthis.callback = callback;\n\t\t\tthis.listeners = [];\n\t\t\tthis.records = [];\n\t\t}\n\n\t\t/** @lends playtotv.MutationObserver.prototype */\n\n\t\t/**\n\t\t * Observes changes within a target Node and notifies them to the instance's callback as an array of\n\t\t * mutation records, https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver#MutationRecord.\n\t\t * At least one type of mutations (childList, attributes and/or characterData) must be observed,\n\t\t * or an error is thrown.\n\t\t *\n\t\t * @param {Node} target\n\t\t * @param {MutationOptions} options\n\t\t * @param {boolean} options.childList=false Observe changes to the target's child nodes when true\n\t\t * @param {boolean} options.attributes=false Observe changes to the target's attributes when true\n\t\t * @param {boolean} options.characterData=false Observe changes to the target's data when true\n\t\t * @param {boolean} [options.subtree=false] Observe all descendent nodes' changes when true\n\t\t * @param {boolean} [options.attributeOldValue=false] Record the previous attribute value when true\n\t\t * @param {boolean} [options.characterDataOldValue=false] Record the previous data value when true\n\t\t * @param {Array} [options.attributeFilter] Attribute names that should be observed rather than all of them\n\t\t */\n\t\tobserve(target, options) {\n\t\t\t// fill in the blanks\n\t\t\toptions = this.options = playtotv.params(options, mutationOptions);\n\n\t\t\t// as per spec; options MUST define at least one type of DOM changes to monitor\n\t\t\tif (!options.childList && !options.attributes && !options.characterData) {\n\t\t\t\tthrow new Error('An invalid or illegal string was specified');\n\t\t\t}\n\n\t\t\tvar listeners = this.listeners;\n\t\t\tif (options.childList) {\n\t\t\t\tlisteners.push(\n\t\t\t\t\tnew MutationProxy(target, 'DOMNodeInserted', this),\n\t\t\t\t\tnew MutationProxy(target, 'DOMNodeRemoved', this)\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (options.attributes) {\n\t\t\t\tlisteners.push(\n\t\t\t\t\tnew MutationProxy(target, 'DOMAttrModified', this)\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (options.characterData) {\n\t\t\t\tlisteners.push(\n\t\t\t\t\tnew MutationProxy(target, 'DOMCharacterDataModified', this)\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Adds a record via a proxy, and notifies\n\t\t * @private\n\t\t */\n\t\taddRecord(record) {\n\t\t\tthis.records.push(record);\n\t\t\tthis.notify();\n\t\t}\n\n\t\t/**\n\t\t * Empties the mutation record queue and returns any mutations it contained.\n\t\t * The instance's callback will not be called for these mutations.\n\t\t *\n\t\t * @returns {Array} mutationRecords\n\t\t */\n\t\ttakeRecords() {\n\t\t\tvar records = this.records;\n\t\t\tthis.records = [];\n\t\t\treturn records;\n\t\t}\n\n\t\t/**\n\t\t * Takes the current record queue, and sends them to the instance's callback.\n\t\t * @private\n\t\t */\n\t\tnotify() {\n\t\t\tvar records = this.takeRecords();\n\t\t\tif (records.length) {\n\t\t\t\tthis.callback(records);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Disconnects all observers from this instance.\n\t\t *\n\t\t */\n\t\tdisconnect() {\n\t\t\tthis.listeners.forEach(function(listener) {\n\t\t\t\tlistener.disconnect();\n\t\t\t});\n\n\t\t\tthis.listeners = [];\n\t\t}\n\t}\n\n\treturn window.MutationObserver || window.WebkitMutationObserver || window.MozMutationObserver || MutationObserver;\n});\n",
		"playtotv.define('playtotv.mvc.BindWidget', [\n\t'playtotv.widget.Widget'\n], function(\n\tWidget\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar event = ptv.event;\n\n\treturn class BindWidget extends Widget {\n\n\t\tconstructor(node, options) {\n\t\t\tsuper(node);\n\n\t\t\tvar { app, path } = ptv.params(options, {\n\t\t\t\tapp: ptv.REQUIRED,\n\t\t\t\tpath: ptv.REQUIRED\n\t\t\t});\n\n\t\t\tthis.app = app;\n\t\t\tthis.path = path;\n\n\t\t\t// If app value is defined then initialize input to match\n\t\t\t// else initialize app to match input\n\t\t\tvar value = app.seek(path);\n\t\t\tif (value !== undefined) {\n\t\t\t\tthis.updateInput(value);\n\t\t\t} else {\n\t\t\t\tthis.updateApp();\n\t\t\t}\n\n\t\t\t// Bind input to app\n\t\t\t// TODO: Only updateApp after input and/or form are validated?\n\t\t\t// See if/how this can tie in with our FormWidget widget\n\t\t\tvar onInputChange = () => this.updateApp();\n\t\t\tthis.addEventListener(node, 'change', onInputChange);\n\t\t\tthis.addEventListener(node, 'keyup', onInputChange);\n\n\t\t\t// Bind app to input\n\t\t\tthis.subscribe(app, path, value => this.updateInput(value));\n\t\t}\n\n\t\tupdateApp() {\n\t\t\tvar node = this.node;\n\t\t\tvar value = node.type === 'checkbox' ? node.checked : node.value;\n\t\t\tthis.app.set(this.path, value);\n\t\t}\n\n\t\tupdateInput(value) {\n\t\t\tvar node = this.node;\n\t\t\tif (node.type === 'checkbox') {\n\t\t\t\tif (value !== node.checked) {\n\t\t\t\t\tnode.checked = value;\n\t\t\t\t\tevent.triggerNative(node, 'change');\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (value !== node.value) {\n\t\t\t\t\tnode.value = value;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.mvc.helpers', [\n\t'playtotv.handlebars.hbsUtil',\n\t'playtotv.handlebars.helpers'\n], function(\n\thbsUtil,\n\thelpers\n) {\n\t/*global Handlebars:false*/\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar util = ptv.util;\n\tvar templateStack = [];\n\n\treturn Object.assign(helpers, {\n\t\t/** @lends playtotv.mvc.helpers */\n\n\t\t// TODO: JSDOC\n\t\t// E.g: {{call \"controller.method\" arg1 .. key1=value1 ..}}\n\t\t// => controller.method(arg, { key1: value1 })\n\t\tcall: function() {\n\t\t\tvar { args, hash, options } = hbsUtil.getArgs(this, arguments);\n\t\t\tvar methodPath = args.shift();\n\t\t\tvar context = options.data.root;\n\n\t\t\t// First argument is optional context argument\n\t\t\tif (typeof methodPath === 'object') {\n\t\t\t\tcontext = methodPath;\n\t\t\t\tmethodPath = args.shift();\n\t\t\t}\n\n\t\t\tif (!methodPath) {\n\t\t\t\treturn hbsUtil.softException('Call methodPath argument missing');\n\t\t\t}\n\n\t\t\t// If called with a block then add that as an argument\n\t\t\tif (options.fn) {\n\t\t\t\targs.push(options.fn(this));\n\t\t\t}\n\n\t\t\t// If called with hash key-value pairs then add the hash as an argument\n\t\t\tif (Object.keys(hash).length > 0) {\n\t\t\t\targs.push(hash);\n\t\t\t}\n\n\t\t\tvar methodRef = util.seekRef(context, methodPath);\n\t\t\tvar method = methodRef && methodRef.value;\n\t\t\tif (!method) {\n\t\t\t\treturn hbsUtil.softException('Call method not found: ' + methodPath);\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\treturn method.apply(methodRef.object, args);\n\t\t\t} catch (error) {\n\t\t\t\treturn hbsUtil.softException('Call ' + error.name + ':' + error.message);\n\t\t\t}\n\n\t\t\t// TODO: de-promisify return value if necessary\n\t\t\t// BUT: Be careful with caching/sharding:\n\t\t\t// - Warn when it is leaking too much memory\n\t\t\t// - And/or automatically clean up cached data\n\t\t\t// - And/or only support this when explicitly requested or even controlled etc.\n\t\t\t// - Or block rendering (with loading indicator) somehow untill all promises are resolved\n\t\t\t// - Or use another rendering engine which properly support async rendering?\n\t\t\t/*\n\t\t\t// Wrap method to deal with Promise return values\n\t\t\tvar shardMap = {};\n\t\t\t// Note: If promise value does not depends on arguments or arguments are not JSON stringifyable\n\t\t\t// then method has to define a getShard() property\n\t\t\tvar getShard = method.getShard || function() {\n\t\t\t\treturn JSON.stringify(Array.from(arguments));\n\t\t\t};\n\t\t\tvar scope = this;\n\t\t\thbsUtil.addMethod(name, function() { // note: fat arrow (=>) would mess with \"arguments\"\n\t\t\t\tvar returnValue;\n\t\t\t\ttry {\n\t\t\t\t\treturnValue = method.apply(null, arguments);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tscope.onError(error);\n\t\t\t\t}\n\t\t\t\tif (!(returnValue instanceof Promise)) {\n\t\t\t\t\treturn returnValue;\n\t\t\t\t}\n\n\t\t\t\t// Note: In case of rejection the returned lastValue is left unchanged (e.g: undefined)\n\t\t\t\tvar shardKey = getShard.apply(null, arguments);\n\t\t\t\tvar shard = shardMap[shardKey] || (shardMap[shardKey] = {});\n\t\t\t\treturnValue.then(value => {\n\t\t\t\t\tif (JSON.stringify(value) !== JSON.stringify(shard.lastValue)) {\n\t\t\t\t\t\tshard.lastValue = value;\n\t\t\t\t\t\tthis.view.update();\n\t\t\t\t\t}\n\t\t\t\t}, error => scope.onError(error));\n\t\t\t\treturn shard.lastValue;\n\t\t\t}.bind(this));\n\t\t\t */\n\t\t},\n\n\t\t// TODO: JSDOC\n\t\tscript: function() {\n\t\t\tvar { script, hash, options } = hbsUtil.getArgs(this, arguments, 'script', 0);\n\n\t\t\t// If called with a block then the block is the script\n\t\t\tif (options.fn) {\n\t\t\t\tscript = options.fn(this);\n\t\t\t}\n\n\t\t\t// Compact script for the sake of compact render output\n\t\t\t// Note: You can circumvent tab chars etc. getting changed by passing them in a hash (context) value\n\t\t\tscript = script.trim().replace(/\\s+/g, ' ');\n\n\t\t\tvar serialized = Object.keys(hash).length > 0 ? JSON.stringify([ script, hash ]) : script;\n\t\t\tserialized = Handlebars.Utils.escapeExpression(serialized);\n\t\t\treturn new Handlebars.SafeString(serialized);\n\t\t},\n\n\t\t// TODO: JSDOC\n\t\ton: function() {\n\t\t\tvar args = Array.from(arguments);\n\t\t\tvar type = args.shift();\n\t\t\tvar script = helpers.script.apply(this, args);\n\t\t\treturn new Handlebars.SafeString('on-' + type + '=\"' + script + '\"');\n\t\t},\n\n\t\t// TODO: JSDOC\n\t\t/**\n\t\t * {{widgets (widget ..) (widget ..)}}\n\t\t */\n\t\twidgets: function() {\n\t\t\tvar { args } = hbsUtil.getArgs(this, arguments);\n\t\t\tvar serialized = JSON.stringify(args);\n\t\t\tserialized = Handlebars.Utils.escapeExpression(serialized);\n\t\t\treturn new Handlebars.SafeString('widgets=\"' + serialized + '\"');\n\t\t},\n\n\t\t// TODO: JSDOC\n\t\t/**\n\t\t * (widget \"rating.Input\" bar=bar)\n\t\t */\n\t\twidget: function() {\n\t\t\tvar { name, hash } = hbsUtil.getArgs(this, arguments, 'name');\n\t\t\treturn [ name, hash ];\n\t\t},\n\n\t\t/**\n\t\t * Returns path relative to current path or just current path if path argument is undefined.\n\t\t *\n\t\t * The base path is determined using the render context provided by App.\n\t\t */\n\t\ttemplatePath: function() {\n\t\t\tvar { path, options } = hbsUtil.getArgs(this, arguments, 'path', 0);\n\t\t\tvar current = templateStack[templateStack.length - 1] || options.data.root.router.pattern;\n\t\t\treturn path === undefined ? current : util.resolvePath(current, path);\n\t\t},\n\n\t\t/**\n\t\t * Renders and returns the partial specified by name relative to the current template path.\n\t\t *\n\t\t * Partial is rendered with specified or current render context.\n\t\t *\n\t\t * TODO: Update JSDOC\n\t\t * Any hash properties are added as @ variables within this block similar to using {{#var}}.\n\t\t *\n\t\t * If this is called as a block helper then the block will be available as the @partial-block partial.\n\t\t * E.g: {{#partial \"_x\"}}..{{/partial}} is equal to {{#> _x}}..{{/x}} in Handlebars v4 and up.\n\t\t *\n\t\t * Note: If a partial with the specified name is not found but a template is then that will be used instead.\n\t\t * This facilitates \"aliasing\" from one template to another.\n\t\t *\n\t\t * @example\n\t\t * Data: { template: 'episodes/__episodeCode__/index', episodePartial: '_episode', state: 'y' }\n\t\t *\n\t\t * Template: {{partial \"_interaction\"}}\n\t\t * Output: {{> episodes/__episodeCode__/_interaction}}\n\t\t *\n\t\t * Template: {{partial (eval '\"../\" + episodePartial')}}\n\t\t * Output: {{> episodes/_episode}}\n\t\t *\n\t\t * Template: {{partial (switch state \"_default\" x=\"_foo\" y=\"_bar\")}}\n\t\t * Output: {{> episodes/__episodeCode__/_bar}}\n\t\t */\n\t\tpartial: function() {\n\t\t\tvar { path, context, hash, options } = hbsUtil.getArgs(this, arguments, 'path, context', 1);\n\n\t\t\t// Default to this render context, but if hash properties are passed, use those as context instead\n\t\t\tcontext = context || this;\n\t\t\tif (Object.keys(hash).length > 0) {\n\t\t\t\tcontext = hash;\n\t\t\t\toptions.hash = {};\n\t\t\t}\n\n\t\t\tvar partialBlock = options.fn;\n\t\t\tif (partialBlock) {\n\t\t\t\tHandlebars.registerPartial('@partial-block', partialBlock);\n\t\t\t\tdelete options.fn;\n\t\t\t}\n\n\t\t\tvar name = hbsUtil.callHelper('templatePath', this, path, options);\n\t\t\tvar partial = Handlebars.partials[name] || Handlebars.templates[name];\n\t\t\tif (!partial) {\n\t\t\t\treturn hbsUtil.softException('Partial not found: ' + name);\n\t\t\t}\n\n\t\t\ttemplateStack.push(name);\n\t\t\tvar output = new Handlebars.SafeString(partial(context, options));\n\t\t\ttemplateStack.pop();\n\n\t\t\tif (partialBlock) {\n\t\t\t\tHandlebars.unregisterPartial('@partial-block');\n\t\t\t}\n\n\t\t\treturn output;\n\t\t},\n\n\t\t/**\n\t\t * Register block as partial with name based on path relative to current template.\n\t\t *\n\t\t * TODO: Use new Handlebars v4 features instead.\n\t\t *\n\t\t * @example\n\t\t * Data: { dude: { name: 'Peter' } }\n\t\t * Template:\n\t\t *   {{#registerPartial \"greet\"}}{{greeting}} {{name}}!{{/registerPartial}}\n\t\t *   {{partial \"greet\" dude greeting=\"Yo\"}}\n\t\t * Output: Yo Peter!\n\t\t */\n\t\tregisterPartial: function() {\n\t\t\tvar { path, options } = hbsUtil.getArgs(this, arguments, 'path');\n\t\t\tvar name = hbsUtil.callHelper('templatePath', this, path, options);\n\t\t\tHandlebars.registerPartial(name, options.fn);\n\t\t}\n\t});\n});\n",
		"playtotv.define('playtotv.mvc.Router', [\n\t'playtotv.pubsub.PubSub'\n], function(\n\tPubSub\n) {\n\n\t// TODO: JSDOC\n\n\t// TODO: Look at supporting hooks for authorization and async data loading\n\t// Maybe work with page controllers like Ember (e.g: 1 per route/template) or something?\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\n\treturn class Router extends PubSub {\n\t\tconstructor(options) {\n\t\t\toptions = ptv.params(options, {\n\t\t\t\troot: 'index',\n\t\t\t\trescue: 'route-not-found',\n\t\t\t\tpatterns: ptv.REQUIRED\n\t\t\t});\n\n\t\t\tsuper();\n\n\t\t\tthis.root = options.root;\n\t\t\tthis.rescue = options.rescue;\n\t\t\tthis.routes = options.patterns.map(function(pattern) {\n\t\t\t\treturn {\n\t\t\t\t\tpattern: pattern,\n\t\t\t\t\tregex: new RegExp('^' + pattern.replace(/__\\w+__/g, '([^/]*)') + '$'),\n\t\t\t\t\tkeys: (pattern.match(/__\\w+__/g) || []).map(function(key) {\n\t\t\t\t\t\treturn key.substr(2, key.length - 4); // strip surrounding __ and __\n\t\t\t\t\t})\n\t\t\t\t};\n\t\t\t});\n\n\t\t\twindow.onhashchange = this.update.bind(this);\n\t\t\tthis.update();\n\t\t}\n\n\t\tfind(path) {\n\t\t\treturn this.routes.find((candidate) => candidate.pattern === path) ||\n\t\t\t\tthis.routes.find((candidate) => candidate.regex.test(path));\n\t\t}\n\n\t\tgetParams(route, path) {\n\t\t\tvar values = (path.match(route.regex) || []).slice(1);\n\t\t\treturn values.reduce(function(params, value, i) {\n\t\t\t\tparams[route.keys[i]] = value;\n\t\t\t\treturn params;\n\t\t\t}, {});\n\t\t}\n\n\t\tupdate() {\n\t\t\tvar loc = window.location;\n\t\t\tvar path = loc.hash.substr(1); // strip leading #\n\t\t\tif (!path) {\n\t\t\t\tpath = this.root;\n\t\t\t\tloc.hash = '#' + path;\n\t\t\t}\n\n\t\t\t// Add 'index' to paths that end with '/' (like on a web server)\n\t\t\tif (/\\/$/.test(path)) {\n\t\t\t\tpath += 'index';\n\t\t\t}\n\n\t\t\tif (path === this.path) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.path = path;\n\n\t\t\tvar route = this.find(path);\n\t\t\tvar params;\n\t\t\tif (route) {\n\t\t\t\tparams = this.getParams(route, path);\n\t\t\t} else {\n\t\t\t\tvar rescue = this.rescue;\n\t\t\t\troute = this.find(rescue);\n\t\t\t\tif (!route) {\n\t\t\t\t\tthrow new Error('Could not find rescue route: ' + rescue);\n\t\t\t\t}\n\t\t\t\tparams = Object.assign(this.getParams(route, rescue), { path: path });\n\t\t\t}\n\n\t\t\tvar pattern = route.pattern;\n\t\t\tthis.pattern = pattern;\n\t\t\tthis.params = params;\n\t\t\tthis.publish(pattern, params);\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.mvc.UpdateWidget', [\n\t'playtotv.widget.Widget',\n\t'playtotv.cron'\n], function(\n\tWidget,\n\tcron\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\n\t/**\n\t * Run script starting at specified time and repeat with specified interval.\n\t *\n\t * Note: Script can also include a context by using JSON encoding (e.g: with {{script}} helper)\n\t *\n\t * @params {Object} options\n\t * @params {playtotv.mvc.App} options.app\n\t * @params {string} options.script\n\t * @params {number} [options.start=Date.now()]\n\t * @params {number} [options.repeat=10*60*1000]\n\t */\n\treturn class UpdateWidget extends Widget {\n\n\t\tconstructor(node, options) {\n\t\t\tvar { app, script, start, repeat } = ptv.params(options, {\n\t\t\t\tapp: ptv.REQUIRED,\n\t\t\t\tscript: ptv.REQUIRED,\n\t\t\t\tstart: Date.now(),\n\t\t\t\trepeat: 10 * 60 * 1000\n\t\t\t});\n\n\t\t\tsuper(node);\n\n\t\t\tthis.job = cron.at(start, () => {\n\t\t\t\tapp.runScript(script);\n\t\t\t}, { repeat: repeat });\n\t\t}\n\n\t\tdispose() {\n\t\t\tcron.cancel(this.job);\n\t\t\tsuper.dispose();\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.PauseDog', [], function() {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar log = new ptv.Logger(this.id);\n\n\t/**\n\t * PauseDog is a watchdog for monitoring JS pauses.\n\t * E.g: When you have switched to another tab/app on a mobile device.\n\t *\n\t * Note: Safari and Firefox also pause/slow down JS after they are left in the background for a minute or two.\n\t */\n\treturn class PauseDog {\n\t\tconstructor() {\n\t\t\tthis.pauseCallbacks = [];\n\t\t\tthis.interval = 1000;\n\t\t\tthis.scheduleTick();\n\t\t}\n\n\t\tscheduleTick() {\n\t\t\tthis.lastTick = Date.now();\n\t\t\tthis.timeout = setTimeout(this.onTick.bind(this), this.interval);\n\t\t}\n\n\t\tadd(threshold, callback) {\n\t\t\tvar pauseCallback = {\n\t\t\t\tthreshold: threshold,\n\t\t\t\tcallback: callback\n\t\t\t};\n\t\t\tthis.pauseCallbacks.push(pauseCallback);\n\t\t\treturn pauseCallback;\n\t\t}\n\n\t\tremove(pauseCallback) {\n\t\t\tvar pauseCallbacks = this.pauseCallbacks;\n\t\t\tvar index = pauseCallbacks.indexOf(pauseCallback);\n\t\t\tif (index !== -1) {\n\t\t\t\tpauseCallbacks.splice(index, 1);\n\t\t\t}\n\t\t}\n\n\t\tonTick() {\n\t\t\tvar now = Date.now();\n\t\t\tvar pause = now - this.interval - this.lastTick;\n\n\t\t\tvar desc = 'Paused: ' + Math.round(pause / 1000) + ' seconds';\n\t\t\tif (pause > 10000) {\n\t\t\t\tlog.d(desc);\n\t\t\t} else if (pause > 1000) {\n\t\t\t\tlog.s(desc);\n\t\t\t}\n\n\t\t\tthis.pauseCallbacks.\n\t\t\t\tfilter(pcb => pause > pcb.threshold).\n\t\t\t\tforEach(pcb => pcb.callback(pause));\n\n\t\t\tthis.scheduleTick();\n\t\t}\n\n\t\tdispose() {\n\t\t\tthis.pauseCallbacks.length = 0;\n\t\t\tclearTimeout(this.timeout);\n\t\t\tptv.dispose(this);\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.Timer', [], function() {\n\n\t'use strict';\n\n\t/**\n\t * A simple class for tracking timings and producing a summarizing string for those.\n\t *\n\t * Parts of the total timing interval can be marked using the start() and end() methods.\n\t * Note: Those parts should not overlap, otherwise the unaccounted time will be incorrect.\n\t */\n\treturn class Timer {\n\t\tconstructor() {\n\t\t\tthis.t0 = Date.now();\n\t\t\tthis.accounted = 0;\n\t\t\tthis.timings = [];\n\t\t}\n\n\t\tstart() {\n\t\t\tthis.tx = Date.now();\n\t\t}\n\n\t\tend(label) {\n\t\t\tvar time = Date.now() - this.tx;\n\t\t\tdelete this.tx;\n\t\t\tthis.accounted += time;\n\t\t\tthis.timings.push(label + ': ' + time);\n\t\t}\n\n\t\tfinish() {\n\t\t\tthis.total = Date.now() - this.t0;\n\t\t\tthis.unaccounted = this.total - this.accounted;\n\n\t\t\tvar { timings, total, unaccounted } = this;\n\t\t\tvar string = total + 'ms';\n\t\t\tif (timings.length > 0) {\n\t\t\t\tstring += ' (' + timings.join(', ') + ')';\n\t\t\t}\n\t\t\tif (unaccounted) {\n\t\t\t\tstring += ' +' + unaccounted;\n\t\t\t}\n\n\t\t\tthis.string = string;\n\n\t\t\treturn string;\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.mvc.View', [\n\t'playtotv.pubsub.PubSub',\n\t'playtotv.Timer'\n], function(\n\tPubSub,\n\tTimer\n) {\n\t// TODO: Get rid of getDiffsDelay(); leave exit animations up to custom JS solutions\n\t// E.g: Trigger exit animation and only then change route/state to render new node instead of old one\n\t// Could be separately facilitated by say an AnimationController (instead of old EffectsController)\n\n\t// TODO: Simplify (and optimize?) by replacing nodeAdded and attrSet and Remove Listeners\n\t// Either by single listeners passed as options (fast?) or by sync publish() calls (simple?)\n\n\t// TODO: JSDOC\n\t// TODO: Convert all functions to class methods to allow extending and overriding\n\n\t'use strict';\n\n\t// Copied from: https://developer.mozilla.org/en-US/docs/Web/API/Node.nodeType\n\tvar ELEMENT_NODE = 1;\n\tvar TEXT_NODE = 3;\n\tvar COMMENT_NODE = 8;\n\n\tvar ptv = playtotv;\n\tvar REQUIRED = ptv.REQUIRED;\n\n\t// Polymer.dom() is used where necessary (and if available) to mix nicely with WebComponents\n\tfunction pdom(node) {\n\t\tvar Polymer = window.Polymer;\n\t\treturn Polymer ? Polymer.dom(node) : node;\n\t}\n\n\tfunction linkNode(node, domNode) {\n\t\tnode.domNode = domNode;\n\n\t\t// A simple way of linking nodes to nodes that assumes the node trees match\n\t\tvar childNodes = node.childNodes;\n\t\tvar domChildNodes = pdom(domNode).childNodes;\n\t\tvar i, len = childNodes.length;\n\t\tfor (i = 0; i < len; i++) {\n\t\t\tlinkNode(childNodes[i], domChildNodes[i]);\n\t\t}\n\t}\n\n\t// Note: This does not recurse to test equality of children\n\t// If id or view-id are specified then other attributes are ignored\n\t// Text/Comment node data and Element class attribute are also ignored here\n\tfunction nodesEqual(node1, node2) {\n\t\t/*jshint maxcomplexity:100, maxstatements:100*/\n\n\t\tvar nodeType = node1.nodeType;\n\n\t\tif (nodeType !== node2.nodeType) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (nodeType === TEXT_NODE || nodeType === COMMENT_NODE) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (node1.nodeName !== node2.nodeName) {\n\t\t\treturn false;\n\t\t}\n\n\t\tvar id1 = node1.id;\n\t\tvar id2 = node2.id;\n\t\tif (id1 || id2) {\n\t\t\treturn id1 === id2;\n\t\t}\n\n\t\tid1 = node1.getAttribute('view-id');\n\t\tid2 = node2.getAttribute('view-id');\n\t\tif (id1 || id2) {\n\t\t\treturn id1 === id2;\n\t\t}\n\n\t\tvar attributes = node1.attributes;\n\t\tvar i, len, attr, name;\n\t\tfor (i = 0, len = attributes.length; i < len; i++) {\n\t\t\tattr = attributes[i];\n\t\t\tname = attr.name;\n\t\t\tif (name !== 'class' && node2.getAttribute(name) !== attr.value) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\tattributes = node2.attributes;\n\t\tfor (i = 0, len = attributes.length; i < len; i++) {\n\t\t\tattr = attributes[i];\n\t\t\tname = attr.name;\n\t\t\tif (name !== 'class' && node1.getAttribute(name) !== attr.value) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tfunction popEqualNode(node, candidates) {\n\t\tvar i, candidate, len = candidates.length;\n\t\tfor (i = 0; i < len; i++) {\n\t\t\tcandidate = candidates[i];\n\t\t\tif (nodesEqual(node, candidate)) {\n\t\t\t\treturn candidates.splice(i, 1)[0];\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction addAttributeDiffs(oldNode, newNode, domNode, diffs) {\n\t\tvar attributes, i, len, attr, name, value, oldValue;\n\n\t\tattributes = newNode.attributes;\n\t\tfor (i = 0, len = attributes.length; i < len; i++) {\n\t\t\tattr = attributes[i];\n\t\t\tname = attr.name;\n\t\t\tvalue = attr.value;\n\t\t\toldValue = oldNode.getAttribute(name);\n\t\t\tif (name !== 'class' && oldValue !== value) {\n\t\t\t\tdiffs.push({ action: 'set-attr', node: domNode, name: name, value: value, oldValue: oldValue });\n\t\t\t}\n\t\t}\n\n\t\tattributes = oldNode.attributes;\n\t\tfor (i = 0, len = attributes.length; i < len; i++) {\n\t\t\tattr = attributes[i];\n\t\t\tname = attr.name;\n\t\t\tvalue = attr.value;\n\t\t\tif (name !== 'class' && !newNode.hasAttribute(name)) {\n\t\t\t\tdiffs.push({ action: 'remove-attr', node: domNode, name: name, value: value });\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction addClassDiffs(oldNode, newNode, domNode, diffs) {\n\t\tvar oldClassList = oldNode.classList;\n\t\tvar newClassList = newNode.classList;\n\t\tvar i, name, len;\n\n\t\tfor (i = 0, len = newClassList.length; i < len; i++) {\n\t\t\tname = newClassList[i];\n\t\t\tif (!oldClassList.contains(name)) {\n\t\t\t\tdiffs.push({ action: 'add-class', node: domNode, name: name });\n\t\t\t}\n\t\t}\n\n\t\tfor (i = 0, len = oldClassList.length; i < len; i++) {\n\t\t\tname = oldClassList[i];\n\t\t\tif (!newClassList.contains(name)) {\n\t\t\t\tdiffs.push({ action: 'remove-class', node: domNode, name: name });\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction diffNodes(oldNode, newNode, diffs) {\n\t\tvar oldChildren = oldNode.childNodes;\n\t\tvar newChildren = Array.from(newNode.childNodes);\n\t\tvar i, len, oldChild, newChild;\n\t\tvar nrDiffed = 1;\n\n\t\t// Pass on domNode reference\n\t\tvar domNode = oldNode.domNode;\n\t\tnewNode.domNode = domNode;\n\n\t\t// Consider text nodes to be equal and just change their text through their data property via a 'text' diff\n\t\tvar nodeType = oldNode.nodeType;\n\t\tif (nodeType === TEXT_NODE || nodeType === COMMENT_NODE) {\n\t\t\tvar text = newNode.data;\n\t\t\tif (text !== oldNode.data) {\n\t\t\t\tdiffs.push({ action: 'text', node: domNode, data: text });\n\t\t\t}\n\t\t\treturn nrDiffed; // done; text nodes do not have attributes or children\n\t\t}\n\n\t\tif (nodeType === ELEMENT_NODE) {\n\t\t\t// Handle any changes to attribute values via 'set-attr' and 'remove-attr' diffs\n\t\t\taddAttributeDiffs(oldNode, newNode, domNode, diffs);\n\n\t\t\t// Handle class changes by individual 'add-class' and 'remove-class' diffs for more mergeable diffs\n\t\t\taddClassDiffs(oldNode, newNode, domNode, diffs);\n\t\t}\n\n\t\tfor (i = 0, len = oldChildren.length; i < len; i++) {\n\t\t\toldChild = oldChildren[i];\n\t\t\tnewChild = popEqualNode(oldChild, newChildren);\n\t\t\tif (newChild) {\n\t\t\t\t// Recurse into equal children's children\n\t\t\t\tnrDiffed += diffNodes(oldChild, newChild, diffs);\n\t\t\t} else {\n\t\t\t\tdiffs.push({ action: 'remove', node: oldChild });\n\t\t\t}\n\t\t}\n\n\t\tfor (i = 0, len = newChildren.length; i < len; i++) {\n\t\t\tnewChild = newChildren[i];\n\t\t\tdiffs.push({ action: 'add', node: newChild });\n\t\t}\n\n\t\treturn nrDiffed;\n\t}\n\n\t// Remove text nodes that consist only of tabs and/or new lines\n\t// (e.g: html or template code indentation that is generally pointless)\n\t// We do this because it usually provides a big (e.g: 4x) performance improvement*\n\t// If undesired, you can work around this by using other space characters\n\t// or disable this for all of a node's children by adding a view-indented attribute\n\t// *) It's not just about the number of nodes, but also about DOM slowing down especially because of these nodes\n\tfunction pruneIndentation(node) {\n\t\tif (node.hasAttribute && node.hasAttribute('view-indented')) {\n\t\t\treturn;\n\t\t}\n\t\tvar children = node.childNodes;\n\t\tvar i, child, len = children.length;\n\t\tfor (i = len - 1; i >= 0; i--) {\n\t\t\tchild = children[i];\n\t\t\tif (child.nodeType === TEXT_NODE) {\n\t\t\t\tif (/^[\t\n]+$/.test(child.data)) {\n\t\t\t\t\tnode.removeChild(child);\n\t\t\t\t}\n\t\t\t} else if (child.childNodes) {\n\t\t\t\tpruneIndentation(child);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * View projects model onto DOM by rendering the main template and analyzing and applying DOM diffs.\n\t */\n\treturn class View extends PubSub {\n\n\t\tconstructor(options) {\n\t\t\tptv.params(options, {\n\t\t\t\trender: REQUIRED,\n\t\t\t\tthrottle: 100,\n\t\t\t\tinterval: 10000, // continuous update interval\n\t\t\t\tonNodeAdded: function() {},\n\t\t\t\tonNodeRemove: function() {},\n\t\t\t\tonAttrSet: function() {},\n\t\t\t\tonAttrRemove: function() {}\n\t\t\t});\n\n\t\t\tsuper();\n\n\t\t\tObject.assign(this, options);\n\n\t\t\tvar parser = this.parser = new window.DOMParser();\n\n\t\t\t// Initialize with empty old render document, next render will append the initial view nodes\n\t\t\t// other nodes already in the document are left as-is\n\t\t\tvar oldHTML = this.oldHTML = '';\n\t\t\tvar oldDoc = this.oldDoc = parser.parseFromString(oldHTML, 'text/html');\n\t\t\toldDoc.domNode = document;\n\t\t\t[ 'documentElement', 'head', 'body' ].forEach(prop => {\n\t\t\t\toldDoc[prop].domNode = document[prop];\n\t\t\t});\n\n\t\t\tthis.update = ptv.throttle(this.updateNow.bind(this), this.throttle);\n\t\t}\n\n\t\tupdateNow() {\n\t\t\t/*jshint maxstatements:100*/\n\n\t\t\tvar timer = new Timer();\n\t\t\tvar oldHTML = this.oldHTML;\n\n\t\t\tclearTimeout(this.intervalTimeout);\n\t\t\tthis.intervalTimeout = setTimeout(this.update, this.interval);\n\n\t\t\ttimer.start();\n\t\t\tvar newHTML = this.render();\n\t\t\ttimer.end('render');\n\n\t\t\tvar diffs = [];\n\t\t\tvar nrDiffed = 0;\n\t\t\tif (newHTML !== oldHTML) {\n\t\t\t\tvar oldDoc = this.oldDoc;\n\t\t\t\ttimer.start();\n\t\t\t\tvar newDoc = this.parser.parseFromString(newHTML, 'text/html');\n\t\t\t\ttimer.end('parse');\n\n\t\t\t\ttimer.start();\n\t\t\t\tpruneIndentation(newDoc);\n\t\t\t\ttimer.end('prune');\n\n\t\t\t\ttimer.start();\n\t\t\t\tnrDiffed = diffNodes(oldDoc, newDoc, diffs);\n\t\t\t\ttimer.end('diff');\n\n\t\t\t\tif (diffs.length > 0) {\n\t\t\t\t\ttimer.start();\n\t\t\t\t\tthis.applyDiffs(diffs);\n\t\t\t\t\ttimer.end('apply');\n\t\t\t\t}\n\n\t\t\t\ttimer.start();\n\t\t\t\tthis.fixNodeOrder(newDoc);\n\t\t\t\ttimer.end('order');\n\n\t\t\t\tthis.oldDoc = newDoc;\n\t\t\t\tthis.oldHTML = newHTML;\n\t\t\t}\n\n\t\t\ttimer.finish();\n\n\t\t\tthis.publish('update', {\n\t\t\t\tnrDiffed: nrDiffed,\n\t\t\t\tdiffs: diffs,\n\t\t\t\ttimer: timer\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Diff and Apply try to re-use nodes as much as possible, but can result in nodes ending up out of order.\n\t\t */\n\t\tfixNodeOrder(newNode) {\n\t\t\t/*global Node:false*/\n\t\t\t/*jshint bitwise:false*/\n\n\t\t\tvar parentDomNode = newNode.domNode;\n\t\t\tvar newChildren = newNode.childNodes;\n\t\t\tvar i, newDomChild, prevDomChild, len = newChildren.length;\n\n\t\t\tfor (i = len - 1; i > 0; i--) {\n\t\t\t\tnewDomChild = newChildren[i].domNode;\n\t\t\t\tprevDomChild = newChildren[i - 1].domNode;\n\n\t\t\t\t// Note: WebComponents can split up siblings, hence we ensure the nodes still share their parent\n\t\t\t\tif (\n\t\t\t\t\tnewDomChild.parentNode === prevDomChild.parentNode &&\n\t\t\t\t\tnewDomChild.compareDocumentPosition(prevDomChild) & Node.DOCUMENT_POSITION_FOLLOWING\n\t\t\t\t) {\n\t\t\t\t\tpdom(parentDomNode).insertBefore(prevDomChild, newDomChild);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (i = 0; i < len; i++) {\n\t\t\t\tthis.fixNodeOrder(newChildren[i]);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Applies diffs to DOM.\n\t\t */\n\t\tapplyDiffs(diffs) {\n\t\t\t/*jshint maxcomplexity:100*/\n\t\t\tvar i, diff, len = diffs.length;\n\n\t\t\tfor (i = 0; i < len; i++) {\n\t\t\t\tdiff = diffs[i];\n\t\t\t\tvar { action, node, name, value } = diff;\n\n\t\t\t\tif (action === 'add') {\n\t\t\t\t\t// Import node from render and diff document to main document\n\t\t\t\t\tvar importedNode = document.importNode(node, true);\n\t\t\t\t\tlinkNode(node, importedNode);\n\n\t\t\t\t\t// Try to immediately insert a node in the right place\n\t\t\t\t\tvar sibling = node.nextSibling;\n\t\t\t\t\tvar domSibling = sibling && sibling.domNode;\n\t\t\t\t\tif (domSibling) {\n\t\t\t\t\t\tpdom(node.parentNode.domNode).insertBefore(importedNode, domSibling);\n\t\t\t\t\t} else { // no siblings, just append\n\t\t\t\t\t\tpdom(node.parentNode.domNode).appendChild(importedNode);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.notifyNodeAdded(node);\n\n\t\t\t\t} else if (action === 'remove') {\n\t\t\t\t\tthis.notifyNodeRemove(node);\n\t\t\t\t\tpdom(node.parentNode.domNode).removeChild(node.domNode);\n\n\t\t\t\t} else if (action === 'text') {\n\t\t\t\t\tnode.data = diff.data;\n\n\t\t\t\t} else if (action === 'set-attr') {\n\t\t\t\t\tnode = pdom(node);\n\t\t\t\t\tthis.onAttrSet(node, name, value, diff.oldValue);\n\t\t\t\t\tnode.setAttribute(name, value);\n\n\t\t\t\t} else if (action === 'remove-attr') {\n\t\t\t\t\tnode = pdom(node);\n\t\t\t\t\tthis.onAttrRemove(node, name, value);\n\t\t\t\t\tnode.removeAttribute(name);\n\n\t\t\t\t} else if (action === 'add-class') {\n\t\t\t\t\tpdom(node).classList.add(name);\n\n\t\t\t\t} else if (action === 'remove-class') {\n\t\t\t\t\tpdom(node).classList.remove(name);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * If node is an element this calls onNodeAdded with node and onAttrSet for each of the node's attributes\n\t\t * and then recurses into the node's child nodes.\n\t\t *\n\t\t * @param {Node} node Node that has just been added to DOM\n\t\t */\n\t\tnotifyNodeAdded(node) {\n\t\t\tif (node.nodeType !== ELEMENT_NODE) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar domNode = node.domNode;\n\t\t\tthis.onNodeAdded(domNode);\n\n\t\t\tvar i, len;\n\n\t\t\tvar attr, attributes = node.attributes || [];\n\t\t\tfor (i = 0, len = attributes.length; i < len; i++) {\n\t\t\t\tattr = attributes[i];\n\t\t\t\tthis.onAttrSet(domNode, attr.name, attr.value);\n\t\t\t}\n\n\t\t\tvar childNodes = node.childNodes;\n\t\t\tfor (i = 0, len = childNodes.length; i < len; i++) {\n\t\t\t\tthis.notifyNodeAdded(childNodes[i]);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * If node is an element this calls onAttrRemove for each of node's attributes and onNodeRemove with node\n\t\t * and then recurses into the node's child nodes.\n\t\t *\n\t\t * @param {Node} node Node that is about to be removed\n\t\t */\n\t\tnotifyNodeRemove(node) {\n\t\t\tif (node.nodeType !== ELEMENT_NODE) {\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\tvar i, len;\n\t\t\tvar domNode = node.domNode;\n\n\t\t\tvar attr, attributes = node.attributes || [];\n\t\t\tfor (i = 0, len = attributes.length; i < len; i++) {\n\t\t\t\tattr = attributes[i];\n\t\t\t\tthis.onAttrRemove(domNode, attr.name, attr.value);\n\t\t\t}\n\n\t\t\tthis.onNodeRemove(domNode);\n\n\t\t\tvar childNodes = node.childNodes;\n\t\t\tfor (i = 0, len = childNodes.length; i < len; i++) {\n\t\t\t\tthis.notifyNodeRemove(childNodes[i]);\n\t\t\t}\n\t\t}\n\n\t\tdispose() {\n\t\t\tclearTimeout(this.intervalTimeout);\n\t\t\tsuper.dispose();\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.native.NativeController', [\n\t'playtotv.mvc.Controller'\n], function(\n\tController\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar REQUIRED = ptv.REQUIRED;\n\tvar util = ptv.util;\n\tvar log = ptv.Logger.get(this.id);\n\tvar commandIdCounter = 1;\n\n\treturn class NativeController extends Controller {\n\t\tconstructor(context) {\n\t\t\tsuper(context);\n\n\t\t\tthis.addMethods([\n\t\t\t\t'getGatekeeper',\n\t\t\t\t'getWrapper',\n\t\t\t\t'sendMessage',\n\t\t\t\t'sendCommand',\n\t\t\t\t'popup',\n\t\t\t\t'browser',\n\t\t\t\t'overlay',\n\t\t\t\t'dialog',\n\t\t\t\t'isTwitterAvailable',\n\t\t\t\t'tweet',\n\t\t\t\t'fbLogin',\n\t\t\t\t'fbLogout',\n\t\t\t\t'fbGraph',\n\t\t\t\t'fbShare',\n\t\t\t\t'loadAudio',\n\t\t\t\t'playAudio',\n\t\t\t\t'stopAudio'\n\t\t\t]);\n\n\t\t\tthis.wrapperPromise = this.when('Event.BridgeReady').then(this.onWrapper.bind(this));\n\t\t\tthis.gatekeeperPromise = this.when('Event.GatekeeperReady').then(this.onGatekeeper.bind(this));\n\n\t\t\tthis.subscribe('Event.BackButton', this.onBackButton.bind(this));\n\n\t\t\tthis.subscribe('Event.PushEnabled', this.onPushEnabled.bind(this));\n\t\t\tthis.model.subscribe('change:pushEnabled', this.onPushEnabledChange.bind(this));\n\n\t\t\tvar wrapper = window.nativeWrapper;\n\t\t\tif (wrapper) {\n\t\t\t\tthis.publish('Event.BridgeReady');\n\t\t\t\tthis.sendMessage({ type: 'Event', subject: 'AppReady' });\n\t\t\t} else {\n\t\t\t\twrapper = window.nativeWrapper = {};\n\t\t\t}\n\n\t\t\tif (wrapper.onMessage) {\n\t\t\t\tthrow new Error('onMessage handler already defined');\n\t\t\t}\n\t\t\twrapper.onMessage = this.onMessage.bind(this);\n\n\t\t\t// Fake AppResume, Wrappers do not (yet) send these\n\t\t\tthis.scope.pauseDog.add(10 * 1000, () => this.publish('Event.AppResume', {}));\n\t\t}\n\n\t\tonMessage(message) {\n\t\t\tvar type = message.type || 'Event';\n\t\t\tvar subject = message.subject;\n\t\t\tvar channel = type + '.' + subject;\n\n\t\t\tif (type === 'CommandResult') {\n\t\t\t\tchannel += '.' + message.commandId;\n\t\t\t}\n\n\t\t\tthis.publish(channel, message);\n\t\t}\n\n\t\tsendMessage(message) {\n\t\t\tptv.params(message, {\n\t\t\t\ttype: REQUIRED,\n\t\t\t\tsubject: REQUIRED,\n\t\t\t\tcommandId: -1,\n\t\t\t\tpayload: {}\n\t\t\t});\n\t\t\treturn this.wrapperPromise.then(wrapper => wrapper.sendMessage(message));\n\t\t}\n\n\t\tsendCommand(subject, payload = {}, fallback = false) {\n\t\t\tvar commandId = commandIdCounter++;\n\n\t\t\t// Note: iOS wrapper sometimes synchronously calls onMessage so we need to start listening before we send\n\t\t\tvar resultPromise = this.when(`CommandResult.${subject}.${commandId}`).then(message => {\n\t\t\t\tvar { error } = message;\n\t\t\t\tif (error) {\n\t\t\t\t\tif (fallback && error.code === 'UnsupportedCommand') {\n\t\t\t\t\t\tlog.i('Using UnsupportedCommand fallback for: ' + subject);\n\t\t\t\t\t\treturn typeof fallback === 'function' ? fallback() : fallback;\n\t\t\t\t\t}\n\n\t\t\t\t\tthrow Object.assign(new Error(error.message || `${subject} rejected: ${error.code}`), error);\n\t\t\t\t}\n\n\t\t\t\treturn message.payload || {};\n\t\t\t});\n\n\t\t\tthis.sendMessage({\n\t\t\t\ttype: 'Command',\n\t\t\t\tsubject: subject,\n\t\t\t\tcommandId: commandId,\n\t\t\t\tpayload: payload\n\t\t\t});\n\n\t\t\treturn resultPromise;\n\t\t}\n\n\t\tonWrapper() {\n\t\t\tvar wrapper = window.nativeWrapper;\n\n\t\t\tthis.model.copyProperties(ptv.omit(wrapper, [\n\t\t\t\t'sendMessage', 'onMessage', 'gatekeeperResponse', 'gatekeeperTimestamp'\n\t\t\t]));\n\n\t\t\tif (wrapper.gatekeeperResponse) {\n\t\t\t\tthis.publish('Event.GatekeeperReady', {\n\t\t\t\t\tpayload: ptv.pick(wrapper, [ 'gatekeeperResponse', 'gatekeeperTimestamp' ])\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn wrapper;\n\t\t}\n\n\t\tonGatekeeper(message) {\n\t\t\tvar payload = message.payload;\n\t\t\treturn {\n\t\t\t\turl: window.nativeWrapper.serverUrl,\n\t\t\t\tgatekeeperData: payload.gatekeeperResponse,\n\t\t\t\tgatekeeperDataTime: payload.gatekeeperTimestamp\n\t\t\t};\n\t\t}\n\n\t\tonBackButton() {\n\t\t\tif (window.location.hash === '#' + this.scope.router.root) {\n\t\t\t\treturn this.dialog({\n\t\t\t\t\tmessage: 'Are you sure you want to close ' + this.model.name + '?',\n\t\t\t\t\tbuttons: [ 'YES', 'NO' ]\n\t\t\t\t}).then(result => {\n\t\t\t\t\tif (result.pressed === 'YES') {\n\t\t\t\t\t\tthis.sendCommand('Close');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.scope.back();\n\t\t}\n\n\t\tonPushEnabled(message) {\n\t\t\tthis.set('pushEnabled', message.payload.value);\n\t\t}\n\n\t\tonPushEnabledChange(enabled) {\n\t\t\t// Effectuate in wrapper or rollback local tentative state\n\t\t\tthis.sendCommand('SetPushEnabled', { value: enabled }).catch(() => {\n\t\t\t\t// E.g: reason.error === 'CannotEnablePush'\n\t\t\t\tthis.set('pushEnabled', false);\n\t\t\t});\n\t\t}\n\n\t\tgetWrapper() {\n\t\t\treturn this.wrapperPromise;\n\t\t}\n\n\t\tgetGatekeeper() {\n\t\t\treturn this.gatekeeperPromise;\n\t\t}\n\n\t\tdialog(options) {\n\t\t\toptions = ptv.params(options, {\n\t\t\t\ttitle: this.model.name,\n\t\t\t\tmessage: '',\n\t\t\t\tbuttons: [ 'OK' ]\n\t\t\t});\n\t\t\treturn this.sendCommand('OpenDialog', options);\n\t\t}\n\n\t\tpopup(url, target) {\n\t\t\treturn target === 'overlay' ? this.overlay(url) : this.browser(url);\n\t\t}\n\n\t\tbrowser(url) {\n\t\t\treturn this.sendCommand('BrowserOpen', { url: url });\n\t\t}\n\n\t\toverlay(url) {\n\t\t\treturn this.sendCommand('OverlayOpen', { url: url });\n\t\t}\n\n\t\t// TODO: Replace by iTunesOpen Command or something once that becomes available\n\t\titunes(id, options) {\n\t\t\tvar { affiliate } = ptv.params(options, {\n\t\t\t\taffiliate: undefined\n\t\t\t});\n\t\t\twindow.location = 'https://itunes.apple.com/dummy/id' + id +\n\t\t\t\taffiliate ? '?at=' + affiliate : '';\n\t\t}\n\n\t\t/* TWITTER */\n\n\t\tisTwitterAvailable() {\n\t\t\treturn this.sendCommand('IsTwitterAccountAvailable', {}).then(result => result.available);\n\t\t}\n\n\t\t// TODO: Replace by TwitterTweet Command or something once that becomes available\n\t\t// Legal option keys right now are: text, url, hashtags, via, related and in-reply-to\n\t\ttweet(options) {\n\t\t\tvar url = util.addURLParams('https://twitter.com/intent/tweet', options);\n\t\t\tutil.popup(url, 'tweet', { width: 550, height: 420 });\n\t\t}\n\n\t\t/* FACEBOOK */\n\n\t\tfbLogin(options) {\n\t\t\toptions = ptv.params(options, {\n\t\t\t\tinteractive: false,\n\t\t\t\tpermissions: []\n\t\t\t});\n\n\t\t\t// Facilitate calling by also allowing permissions to be specified as a comma separated string\n\t\t\tif (typeof options.permissions === 'string') {\n\t\t\t\toptions.permissions = options.permissions.split(/\\s*,\\s*/);\n\t\t\t}\n\n\t\t\treturn this.sendCommand('FacebookLogin', options);\n\t\t}\n\n\t\tfbLogout() {\n\t\t\treturn this.sendCommand('FacebookLogout');\n\t\t}\n\n\t\tfbGraph(path, method = 'get', params = {}) {\n\t\t\treturn this.sendCommand('FacebookGraphRequest', {\n\t\t\t\tpath: path,\n\t\t\t\tparameters: params,\n\t\t\t\thttpMethod: method\n\t\t\t});\n\t\t}\n\n\t\tfbShare(options) {\n\t\t\toptions = ptv.params(options, {\n\t\t\t\ttitle: '',\n\t\t\t\tdescription: '',\n\t\t\t\turl: REQUIRED,\n\t\t\t\timage: null\n\t\t\t});\n\t\t\tvar params = {\n\t\t\t\tcontentTitle: options.title,\n\t\t\t\tcontentDescription: options.description,\n\t\t\t\tcontentURL: options.url\n\t\t\t};\n\t\t\tif (options.image) {\n\t\t\t\tparams.imageURL = options.image;\n\t\t\t}\n\t\t\treturn this.sendCommand('FacebookShare', params);\n\t\t}\n\n\t\t/* AUDIO */\n\n\t\tloadAudio(url) {\n\t\t\treturn this.sendCommand('LoadAudio', { url: url });\n\t\t}\n\n\t\tplayAudio(url) {\n\t\t\treturn this.sendCommand('PlayAudio', { url: url });\n\t\t}\n\n\t\tstopAudio(url) {\n\t\t\treturn this.sendCommand('StopAudio', { url: url });\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.net.jsonp', [], function() {\n\n\t'use strict';\n\n\tvar nr = 0;\n\tvar id = this.id;\n\n\t/**\n\t * Loads a json response via jsonp, and returns a Promise that - when resolved - receives the json data.\n\t *\n\t * @name jsonp\n\t * @memberOf playtotv.net\n\t * @function\n\t * @param {string} url\n\t * @param {object} [params] Parameters to add to url\n\t * @param {number} [timeout=20000] Timeout in ms after which to reject this promise\n\t * @returns {Promise} Promise of JSON callback data\n\t */\n\tvar jsonp = function(url, params, timeout) {\n\t\tparams = params || {};\n\t\ttimeout = timeout || 20000;\n\n\t\t// TODO: Rewrite without use of Promise.defer() and as Cancellable for optional timeout\n\t\tvar deferred = Promise.defer();\n\t\tvar callback = 'cb' + (nr += 1);\n\t\tparams.callback = id + '.' + callback;\n\t\tvar request = playtotv.util.addURLParams(url, params);\n\t\tvar timeoutId;\n\n\t\tjsonp[callback] = function(json) {\n\t\t\tdeferred.resolve(json);\n\t\t\tdelete jsonp[callback];\n\t\t\tclearTimeout(timeoutId);\n\t\t};\n\n\t\tplaytotv.loadScript(request).then(function(script) {\n\t\t\tplaytotv.dom.remove(script);\n\t\t});\n\n\t\ttimeoutId = setTimeout(function() {\n\t\t\tdeferred.reject(new Error('Timeout'));\n\t\t\tdelete jsonp[callback];\n\t\t}, timeout);\n\n\t\treturn deferred.promise;\n\t};\n\n\treturn jsonp;\n});\n",
		"/**\n * Facilitates making cross origin requests by creating a mock XMLHttpRequest that proxies function calls on to a real\n * XMLHttpRequest created in an iframe of the target origin. These iframes require the 'xhr-proxy.html' file to be\n * available from the target server's root to complete the proxy functionality.\n *\n * @function\n * @name xhrProxy\n * @memberOf playtotv\n * @namespace\n */\nplaytotv.define('playtotv.net.xhrProxy', [], function() {\n\n\t'use strict';\n\n\t// Abort if we are not running in a browser (e.g: in Node)\n\tif (typeof window === 'undefined') {\n\t\treturn;\n\t}\n\n\tvar log = playtotv.Logger.get(this.id);\n\tvar dom = playtotv.dom;\n\tvar event = playtotv.event;\n\n\tvar xhrMethods = [ 'open', 'setRequestHeader', 'send', 'abort' ]; // to be proxied\n\tvar deferredWindows = {};\n\tvar xhrs = {};\n\tvar xhrCounter = 0;\n\tvar supportsObject = false; // start without object support for messaging\n\tvar rpcAbort = { method: 'abort', args: [] }; // special instance for easy detection with indexOf\n\n\t// Test to see if we can skip data stringification\n\tfunction supportsObjectTestHandler(msg) {\n\t\tsupportsObject = typeof msg.data === 'object';\n\t\tevent.removeListener(window, 'message', supportsObjectTestHandler);\n\t}\n\tevent.addListener(window, 'message', supportsObjectTestHandler);\n\twindow.postMessage({}, '*');\n\n\tevent.addListener(window, 'message', function(msg) {\n\t\t/*jshint maxcomplexity:100*/\n\t\tvar deferredWindow = deferredWindows[msg.origin];\n\t\tif (deferredWindow) { // ignore messages from other origins (Facebook, Hyves, ..)\n\t\t\tvar data = typeof msg.data === 'string' ? JSON.parse(msg.data) : msg.data;\n\t\t\tvar type = data.type;\n\t\t\tvar xhr = xhrs[data.id];\n\t\t\tvar label = 'onMessage: ' + msg.origin + ': ' + type;\n\n\t\t\t// Note: We use immediate to prevent Facebook's window message handler from whining\n\t\t\t(msg.stopImmediatePropagation || msg.stopPropagation).call(msg);\n\n\t\t\tif (type === 'initialized') {\n\t\t\t\tlog.s(label);\n\t\t\t\t// Resolving with a direct iframe window reference would result in 'when' examining the value to see\n\t\t\t\t// if it is a Promise later and in doing so throwing a cross origin DOM Exception 18.\n\t\t\t\t// We circumvent this by wrapping the window reference in another object.\n\t\t\t\tdeferredWindow.resolve({ win: msg.source });\n\t\t\t} else if (!xhr) {\n\t\t\t\tlog.d(label + ': xhr: ' + data.id + ' is undefined');\n\t\t\t} else if (type === 'event') {\n\t\t\t\tvar uploadEvent = data.upload;\n\t\t\t\tvar e = data.event;\n\t\t\t\tvar eventType = e.type;\n\t\t\t\tlog.s(label + ': ' + (uploadEvent ? 'upload: ' : '') + eventType + ': ' + e.loaded);\n\t\t\t\tvar obj = uploadEvent ? xhr.upload : xhr;\n\t\t\t\tvar listeners = obj._eventListenersMap[eventType];\n\t\t\t\tlisteners.forEach(function(listener) {\n\t\t\t\t\tlistener(e);\n\t\t\t\t});\n\t\t\t} else if (type === 'readyStateChange') {\n\t\t\t\txhr.status = data.status;\n\t\t\t\txhr.responseText = data.responseText;\n\t\t\t\txhr._readyStateChange(data.readyState);\n\t\t\t} else {\n\t\t\t\tlog.w(label + ': unsupported type');\n\t\t\t}\n\t\t}\n\t});\n\n\tfunction createIFrame(url) {\n\t\tvar iframe = dom.create('iframe', {\n\t\t\tsrc: url\n\t\t});\n\t\tObject.assign(iframe.style, {\n\t\t\twidth: 0,\n\t\t\theight: 0,\n\t\t\tvisibility: 'hidden',\n\t\t\toverflow: 'hidden',\n\t\t\tposition: 'absolute',\n\t\t\tdisplay: 'none'\n\t\t});\n\t\treturn iframe;\n\t}\n\n\tfunction getWindow(origin) {\n\t\tvar deferredWindow = deferredWindows[origin];\n\t\tif (deferredWindow) {\n\t\t\treturn deferredWindow.promise;\n\t\t}\n\n\t\t// Create an iframe, then check to see if that has successfully initialized.\n\t\tlog.d('getWindow(): ' + origin);\n\n\t\t// TODO: Rewrite without use of Promise.defer()\n\t\tvar deferred = deferredWindows[origin] = Promise.defer();\n\n\t\tvar initialized = false;\n\t\tdeferred.promise.then(function() {\n\t\t\tinitialized = true;\n\t\t});\n\n\t\tvar url = origin + '/xhr-proxy.html';\n\t\tvar iframe = createIFrame(url);\n\n\t\t// Note: Listening to 'error' event does not seem to be necessary\n\t\t// A 'load' event will always fire, any errors will be returned as iframe contents\n\n\t\tevent.addListener(iframe, 'load', function() {\n\t\t\t// The initialization confirmation is sent back as a window message by xhr-proxy.html so the check also\n\t\t\t// has to be deferred through a window message to ensure that it is processed after the initialization.\n\t\t\t// Note: I could not find a good way to defer this compatible with IE browsers, hence the setTimeout\n\t\t\tsetTimeout(function() {\n\t\t\t\tif (!initialized) {\n\t\t\t\t\t// Clean up to allow for future retries\n\t\t\t\t\tdeferredWindows[origin] = null;\n\t\t\t\t\tdom.remove(iframe);\n\t\t\t\t\tdeferred.reject(new Error('Failed to initialize: ' + url));\n\t\t\t\t}\n\t\t\t}, 1000);\n\t\t});\n\n\t\tdom.appendTo(iframe, document.body);\n\n\t\treturn deferred.promise; // will be resolved by window initialized callback eventlistener\n\t}\n\n\tfunction execBatch(origin, originWindow, id) {\n\t\tvar xhr = xhrs[id];\n\t\tif (!xhr) {\n\t\t\treturn; // batch with abort has been processed already\n\t\t}\n\n\t\tvar batch = xhr._batch;\n\t\tif (batch.length === 0) {\n\t\t\treturn; // batch has been processed already\n\t\t}\n\n\t\tif (batch.indexOf(rpcAbort) >= 0) {\n\t\t\tdelete xhrs[id]; // clean up (prevent leak)\n\t\t\tif (batch.length > 1) {\n\t\t\t\tbatch = [ rpcAbort ]; // no use to send anything but abort\n\t\t\t}\n\t\t}\n\n\t\tvar data = { id: id, rpcs: batch };\n\t\toriginWindow.postMessage(supportsObject ? data : JSON.stringify(data), origin);\n\n\t\txhr._batch = []; // batch has been processed\n\t}\n\n\tfunction exec(id, method, args) {\n\t\tvar xhr = xhrs[id];\n\n\t\tif (!xhr) {\n\t\t\tthrow new Error('xhr undefined: ' + id); // note: xhr can no longer be used after abort() or readyState 4\n\t\t}\n\n\t\txhr._batch.push(method === 'abort' ? rpcAbort : { // special abort instance for easy detection with indexOf\n\t\t\tmethod: method,\n\t\t\targs: [].slice.call(args, 0) // turn arguments into array so Safari's JSON.stringify works properly\n\t\t});\n\n\t\txhr._execBatch();\n\t}\n\n\tfunction addEventSupport(id, upload) {\n\t\tvar xhr = xhrs[id];\n\t\tvar obj = upload ? xhr.upload : xhr;\n\t\tobj._eventListenersMap = {};\n\t\tobj.addEventListener = function(type, listener) {\n\t\t\tvar eventListeners = obj._eventListenersMap[type];\n\t\t\tif (!eventListeners) {\n\t\t\t\teventListeners = obj._eventListenersMap[type] = [];\n\t\t\t\texec(id, 'addEventListener', [ upload, type ]);\n\t\t\t}\n\t\t\teventListeners.push(listener);\n\t\t};\n\t}\n\n\treturn {\n\t\t/** @lends playtotv.net.xhrProxy */\n\n\t\t/**\n\t\t * Creates a mock XMLHttpRequest instance.\n\t\t *\n\t\t * @param {string} origin The request origin to proxy to.\n\t\t * @return {Object} Mock XMLHttpRequest instance.\n\t\t */\n\t\tcreate: function(origin) {\n\t\t\tvar id = xhrCounter++;\n\t\t\tvar xhr = xhrs[id] = {\n\t\t\t\t_batch: [], // private field\n\t\t\t\t_readyStateChange: function(readyState) {\n\t\t\t\t\txhr.readyState = readyState;\n\t\t\t\t\tif (xhr.onreadystatechange) {\n\t\t\t\t\t\txhr.onreadystatechange();\n\t\t\t\t\t}\n\t\t\t\t\tif (readyState === 4) {\n\t\t\t\t\t\tdelete xhrs[id]; // clean up (prevent leak)\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t_execBatch: playtotv.unstack(function() { // private function, unstack to optimize batching\n\t\t\t\t\tgetWindow(origin).then(function(originWindow) {\n\t\t\t\t\t\texecBatch(origin, originWindow.win, id);\n\t\t\t\t\t}, function(reason) {\n\t\t\t\t\t\txhr.status = 'no-xhr-proxy';\n\t\t\t\t\t\txhr.reason = reason;\n\t\t\t\t\t\txhr._readyStateChange(4);\n\t\t\t\t\t});\n\t\t\t\t}),\n\t\t\t\tupload: {},\n\t\t\t\tonreadystatechange: null,\n\t\t\t\treadyState: 0,\n\t\t\t\tstatus: 0,\n\t\t\t\tresponseText: ''\n\t\t\t};\n\n\t\t\txhrMethods.forEach(function(method) {\n\t\t\t\txhr[method] = function() {\n\t\t\t\t\texec(id, method, arguments);\n\t\t\t\t};\n\t\t\t});\n\n\t\t\taddEventSupport(id, false); // main xhr events\n\t\t\taddEventSupport(id, true); // upload events\n\n\t\t\treturn xhr;\n\t\t},\n\n\t\t/** For debugging purposes */\n\t\tdebug: {\n\t\t\tdeferredWindows: deferredWindows,\n\t\t\txhrs: xhrs\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.net.request', [\n\t'playtotv.net.xhrProxy'\n], function(\n\txhrProxy\n) {\n\n\t// TODO: Use Promise.Cancellable instead of Promise and have it xhr.abort() on cancellation\n\t// TODO: Replace by use of fetch shim (https://github.com/github/fetch) or improve this based on that\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar log = ptv.Logger.get(this.id);\n\tvar util = ptv.util;\n\n\t/**\n\t * Performs an HTTP request, optionally using {@link playtotv.net.xhrProxy} for improved cross-origin support.\n\t *\n\t * @function\n\t * @name request\n\t * @memberOf playtotv\n\t *\n\t * @param {string} url URL to request\n\t * @param {Object} [settings] Request settings\n\t * @param {string} [settings.label=type + ' ' + url] Optional label for debugging\n\t * @param {string} [settings.type='GET'] HTTP request type (GET/POST/PUT/DELETE)\n\t * @param {Object} [settings.urlParams={}] Parameters to add to url\n\t * @param {Object} [settings.headers={}] HTTP request headers\n\t * @param {Object} [settings.username] HTTP Basic Authentication username\n\t * @param {Object} [settings.password] HTTP Basic Authentication password\n\t * @param {Object} [settings.data={}] HTTP request data\n\t * @param {Function} [settings.onProgressDown] Download progress callback\n\t * @param {Function} [settings.onProgressUp] Upload progress callback\n\t * @param {string} [settings.dataType='text'] If 'json' then response text will be processed through JSON.parse()\n\t * @param {boolean} [settings.xhrProxy] Whether to use {@link playtotv.net.xhrProxy}, default true if cross-origin\n\t * @param {boolean} [settings.cache=true] If false, will prevent caching by adding a cache buster query to url\n\t * @param {number} [settings.timeout=0] If set, will timeout request after specified time in ms\n\t * @property {[Function]} taps Array of tap functions to call on each request with url, label and promise arguments\n\t * @returns {Promise} Response data promise, resolves if status code is in: 2xx, 304, 1223, rejects otherwise\n\t */\n\tvar request = function(url, settings) {\n\t\t/*jshint maxstatements:100, maxcomplexity:100*/\n\n\t\tvar windowOrigin = util.getOrigin();\n\t\tvar urlOrigin = util.getOrigin(url);\n\n\t\tsettings = ptv.params(settings, {\n\t\t\tlabel: ((settings && settings.type) || 'GET') + ' ' + url,\n\t\t\ttype: 'GET',\n\t\t\turlParams: {},\n\t\t\theaders: {},\n\t\t\tusername: undefined,\n\t\t\tpassword: undefined,\n\t\t\tdata: {},\n\t\t\tonProgressDown: undefined,\n\t\t\tonProgressUp: undefined,\n\t\t\tdataType: 'text',\n\t\t\txhrProxy: urlOrigin !== windowOrigin,\n\t\t\tcache: true,\n\t\t\ttimeout: 0\n\t\t});\n\n\t\tvar xhr;\n\t\t// TODO: Rewrite without use of Promise.defer()\n\t\tvar deferred = Promise.defer();\n\t\tvar finished = false;\n\t\tvar timeoutRef = null;\n\n\t\tlog.s(settings.label);\n\n\t\tfunction finish(status) {\n\t\t\tif (finished) {\n\t\t\t\treturn; // already finished\n\t\t\t}\n\n\t\t\tif (timeoutRef) {\n\t\t\t\tclearTimeout(timeoutRef);\n\t\t\t}\n\n\t\t\tvar responseData = xhr.responseText;\n\t\t\tif (settings.dataType === 'json') {\n\t\t\t\ttry {\n\t\t\t\t\tresponseData = responseData ? JSON.parse(responseData) : {};\n\t\t\t\t} catch (e) {}\n\t\t\t}\n\n\t\t\t// IE8 and IE9 mangle status 204 to 1223 sometimes, so we have to accept that as well\n\t\t\tif ((status >= 200 && status < 300) || [ 304, 1223 ].indexOf(status) !== -1) {\n\t\t\t\tdeferred.resolve(responseData);\n\t\t\t} else {\n\t\t\t\tvar error = new Error(\n\t\t\t\t\t// Use error message from server response if available\n\t\t\t\t\tresponseData && responseData.error && responseData.error.message ||\n\t\t\t\t\t'Request ' + settings.label + ' failed with status ' + status\n\t\t\t\t);\n\t\t\t\tdeferred.reject(Object.assign(error, {\n\t\t\t\t\tlabel: settings.label,\n\t\t\t\t\tstatus: status,\n\t\t\t\t\txhr: xhr,\n\t\t\t\t\tdata: responseData\n\t\t\t\t}));\n\t\t\t}\n\n\t\t\tfinished = true;\n\t\t}\n\n\t\t// Use xhrProxy for cross origin requests\n\t\txhr = settings.xhrProxy ? xhrProxy.create(urlOrigin) : new XMLHttpRequest();\n\n\t\tvar loadEventSupported = 'onload' in xhr;\n\t\tvar errorEventSupported = 'onerror' in xhr;\n\t\tvar abortEventSupported = 'onabort' in xhr;\n\t\tvar timeoutEventSupported = 'ontimeout' in xhr;\n\n\t\turl = util.addURLParams(url, settings.urlParams);\n\t\tif (!settings.cache) {\n\t\t\turl = util.addURLParam(url, 'nocache', Date.now());\n\t\t}\n\n\t\txhr.open(settings.type, url, true, settings.username, settings.password);\n\n\t\tif (loadEventSupported) {\n\t\t\txhr.addEventListener('load', function() {\n\t\t\t\t// Note (pp): Chrome fires 'load' event with 404 on my localhost Apache so have to double check status\n\t\t\t\tfinish(xhr.status);\n\t\t\t}, false);\n\t\t} else {\n\t\t\txhr.onreadystatechange = function() {\n\t\t\t\tif (xhr.readyState !== 4) {\n\t\t\t\t\treturn; // not yet DONE\n\t\t\t\t}\n\t\t\t\tfinish(xhr.status);\n\t\t\t};\n\t\t}\n\n\t\tif (errorEventSupported) {\n\t\t\txhr.addEventListener('error', function() {\n\t\t\t\tfinish(xhr.status);\n\t\t\t}, false);\n\t\t}\n\n\t\tif (abortEventSupported) {\n\t\t\txhr.addEventListener('abort', function() {\n\t\t\t\tfinish('abort');\n\t\t\t}, false);\n\t\t}\n\n\t\tif (settings.timeout) {\n\t\t\tif (timeoutEventSupported) {\n\t\t\t\txhr.addEventListener('timeout', function() {\n\t\t\t\t\tfinish('timeout');\n\t\t\t\t}, false);\n\t\t\t\txhr.timeout = settings.timeout;\n\t\t\t} else {\n\t\t\t\ttimeoutRef = setTimeout(function() {\n\t\t\t\t\tfinish('timeout');\n\t\t\t\t\txhr.abort();\n\t\t\t\t}, settings.timeout);\n\t\t\t}\n\t\t}\n\n\t\tvar onProgressDown = settings.onProgressDown;\n\t\tif (onProgressDown) {\n\t\t\txhr.addEventListener('progress', function(e) {\n\t\t\t\tif (e.lengthComputable) {\n\t\t\t\t\tonProgressDown(e);\n\t\t\t\t}\n\t\t\t}, false);\n\t\t}\n\n\t\tvar onProgressUp = settings.onProgressUp;\n\t\tif (onProgressUp) {\n\t\t\txhr.upload.addEventListener('progress', function(e) {\n\t\t\t\tif (e.lengthComputable) {\n\t\t\t\t\tonProgressUp(e);\n\t\t\t\t}\n\t\t\t}, false);\n\t\t}\n\n\t\tptv.each(settings.headers, function(value, key) {\n\t\t\txhr.setRequestHeader(key, value);\n\t\t});\n\n\t\tif (settings.type === 'PUT' || settings.type === 'POST') {\n\t\t\txhr.setRequestHeader('Content-type', 'application/json');\n\t\t\txhr.send(JSON.stringify(settings.data));\n\t\t} else {\n\t\t\txhr.send();\n\t\t}\n\n\t\trequest.taps.forEach(function(tap) {\n\t\t\ttap(url, settings.label, deferred.promise);\n\t\t});\n\n\t\treturn deferred.promise;\n\t};\n\n\trequest.taps = [];\n\n\treturn request;\n});\n",
		"playtotv.define('playtotv.analytics.AnalyticsController', [\n\t'playtotv.analytics.AnalyticsWidget',\n\t'playtotv.analytics.ComScoreAnalytics',\n\t'playtotv.analytics.GoogleAnalytics',\n\t'playtotv.mvc.Controller',\n\t'playtotv.net.request'\n], function(\n\tAnalyticsWidget,\n\tComScoreAnalytics,\n\tGoogleAnalytics,\n\tController,\n\trequest\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar util = ptv.util;\n\tvar event = ptv.event;\n\tvar log = new ptv.Logger(this.id);\n\n\treturn class AnalyticsController extends Controller {\n\t\t/** @lends playtotv.analytics.AnalyticsController.prototype */\n\n\t\t/**\n\t\t * TODO: JSDOC\n\t\t *\n\t\t * @extends playtotv.mvc.Controller\n\t\t * @constructs\n\t\t */\n\t\tconstructor(context, options) {\n\t\t\toptions = ptv.params(options, {\n\t\t\t\t// privateGoogle is required but a default config is provided to facilitate it's use\n\t\t\t\tprivateGoogle: { name: 'private', id: 'UA-20746434-1', fields: { sampleRate: 1 } },\n\t\t\t\tgoogles: [],\n\t\t\t\tcomScore: null\n\t\t\t});\n\n\t\t\tsuper(context);\n\n\t\t\tthis.addMethods([\n\t\t\t\t'privateTime',\n\t\t\t\t'privateError',\n\t\t\t\t'privateEvent',\n\t\t\t\t'view',\n\t\t\t\t'event',\n\t\t\t\t'setFields'\n\t\t\t]);\n\n\t\t\tthis.addWidget('track', AnalyticsWidget);\n\n\t\t\tvar privateGoogle = this.privateGoogle = new GoogleAnalytics(options.privateGoogle);\n\n\t\t\tvar googles = this.googles = [ privateGoogle ];\n\n\t\t\toptions.googles.forEach(googleOptions => {\n\t\t\t\t// Googles can be easily disabled by providing a falsy id option\n\t\t\t\tif (googleOptions.id) {\n\t\t\t\t\tgoogles.push(new GoogleAnalytics(googleOptions));\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// ComScore can be easily disabled by providing a falsy url option\n\t\t\tvar comScoreOptions = options.comScore;\n\t\t\tif (comScoreOptions && comScoreOptions.url) {\n\t\t\t\tthis.comScore = new ComScoreAnalytics(comScoreOptions);\n\t\t\t}\n\n\t\t\tevent.addWindowOnError(this.privateError.bind(this));\n\n\t\t\tthis.hookRequestTap();\n\t\t}\n\n\t\t/**\n\t\t * Called by constructor to hook playtotv.net.request.tap to log request timings and rejections to\n\t\t * our private Google tracker.\n\t\t */\n\t\thookRequestTap() {\n\t\t\trequest.taps.push((url, label, promise) => {\n\t\t\t\tvar cleanUrl = url.replace(/.nocache=\\d+/, '');\n\n\t\t\t\t// Time all but long poll requests, recognizable by timeout URL param\n\t\t\t\tif (!util.getURLParams(url).timeout) {\n\t\t\t\t\tthis.privateTime(promise, 'request', label, {\n\t\t\t\t\t\ttimingLabel: cleanUrl\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t// Rejections are not always errors, so log them as events\n\t\t\t\tpromise.catch(reason => {\n\t\t\t\t\tthis.privateEvent('request', 'reject ' + label + ' ' + reason.status, {\n\t\t\t\t\t\teventLabel: cleanUrl,\n\t\t\t\t\t\tnonInteraction: true\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Calls and returns this.privateGoogle.time(promise, category, variable, fields).\n\t\t */\n\t\tprivateTime(promise, category, variable, fields) {\n\t\t\treturn this.privateGoogle.time(promise, category, variable, fields);\n\t\t}\n\n\t\t/**\n\t\t * Calls and returns this.privateGoogle.sendError(error, isFatal, fields).\n\t\t */\n\t\tprivateError(error, isFatal, fields) {\n\t\t\treturn this.privateGoogle.sendError(error, isFatal, fields);\n\t\t}\n\n\t\t/**\n\t\t * Calls and returns this.privateGoogle.sendEvent(category, action, fields).\n\t\t */\n\t\tprivateEvent(category, action, fields) {\n\t\t\treturn this.privateGoogle.sendEvent(category, action, fields);\n\t\t}\n\n\t\t/**\n\t\t * Calls this.googles sendView(name) and this.udm(name).\n\t\t */\n\t\tview(name, fields) {\n\t\t\tlog.d('view: ' + name, fields);\n\n\t\t\tthis.lastView = name;\n\n\t\t\tthis.googles.forEach(google => google.sendView(name, fields));\n\n\t\t\tthis.udm(name);\n\t\t}\n\n\t\t/**\n\t\t * Calls this.googles sendEvent(category, action, fields) and\n\t\t * this.udm('[category].[action].[label]', { type: 'hidden' }).\n\t\t */\n\t\tevent(category, action, fields) {\n\t\t\tlog.d('event: ' + category + ', ' + action, fields);\n\n\t\t\tthis.googles.forEach(google => google.sendEvent(category, action, fields));\n\n\t\t\tvar label = fields && fields.eventLabel;\n\t\t\tthis.udm(category + '.' + action + (label ? '.' + label : ''), { type: 'hidden' });\n\t\t}\n\n\t\t/**\n\t\t * Calls this.googles setFields(fields).\n\t\t */\n\t\tsetFields(fields) {\n\t\t\tthis.googles.forEach(google => google.setFields(fields));\n\t\t}\n\n\t\t/**\n\t\t * Calls this.comScore.udm(tag, params), if available.\n\t\t * Note: Override this to add project specific and runtime params.\n\t\t */\n\t\tudm(tag, params) {\n\t\t\tvar comScore = this.comScore;\n\t\t\tif (comScore) {\n\t\t\t\tcomScore.udm(tag, params);\n\t\t\t}\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.native.MockNativeController', [\n\t'playtotv.facebook.Facebook',\n\t'playtotv.native.NativeController',\n\t'playtotv.net.request'\n], function(\n\tFacebook,\n\tNativeController,\n\trequest\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar dom = ptv.dom;\n\tvar util = ptv.util;\n\tvar log = ptv.Logger.get(this.id);\n\n\tfunction getMatch(str, regex, idx) {\n\t\tvar matches = str.match(regex);\n\t\treturn matches && matches[idx || 0];\n\t}\n\n\treturn class MockNativeController extends NativeController {\n\t\tconstructor(context, options) {\n\t\t\tptv.params(options, {\n\t\t\t\tserverUrl: ptv.REQUIRED,\n\t\t\t\tfacebook: null\n\t\t\t\t// TODO: Add optional web based support for MixPanel?\n\t\t\t});\n\t\t\tvar serverUrl = options.serverUrl;\n\n\t\t\tsuper(context);\n\n\t\t\tthis.audioNodeMap = {};\n\n\t\t\tif (options.facebook) {\n\t\t\t\tthis.facebook = new Facebook(options.facebook);\n\t\t\t}\n\n\t\t\tvar wrapper = window.nativeWrapper;\n\t\t\tObject.assign(wrapper, this.getDevice(), {\n\t\t\t\tname: document.title,\n\t\t\t\tversion: '1.0-mock',\n\t\t\t\tcapabilities: [],\n\t\t\t\tpushEnabled: false,\n\t\t\t\tserverUrl: serverUrl,\n\t\t\t\tsendMessage: this.sendMessage.bind(this)\n\t\t\t});\n\n\t\t\tthis.publish('Event.BridgeReady');\n\n\t\t\tvar requestUrl = (/\\/\\//.test(serverUrl) ? '' : '//') + serverUrl;\n\t\t\tvar gatekeeperDataPromise = serverUrl === 'mock' ?\n\t\t\t\tPromise.resolve({ serverTime: Date.now(), status: 'AVAILABLE', services: [] }) :\n\t\t\t\trequest(requestUrl + '/api/1/gatekeeper/init', { dataType: 'json', cache: false });\n\n\t\t\tgatekeeperDataPromise.then(data => {\n\t\t\t\tdata = { gatekeeperResponse: data, gatekeeperTimestamp: Date.now() };\n\t\t\t\tObject.assign(wrapper, data);\n\t\t\t\tthis.mockMessage({ type: 'Event', subject: 'GatekeeperReady', payload: data });\n\t\t\t});\n\n\t\t\tthis.initLoading();\n\t\t}\n\n\t\tinitLoading() {\n\t\t\tvar loadingNode = dom.create('div', {\n\t\t\t\tclassName: 'native-loading'\n\t\t\t}, {\n\t\t\t\ttext: 'Loading..',\n\t\t\t\tappendTo: document.body\n\t\t\t});\n\n\t\t\tObject.assign(loadingNode.style, {\n\t\t\t\tposition: 'absolute',\n\t\t\t\ttop: 0, left: 0, bottom: 0, right: 0,\n\t\t\t\tbackground: 'rgba(255, 255, 255, 0.9)', color: '#000',\n\t\t\t\t'text-align': 'center', 'padding-top': '150px',\n\t\t\t\t'z-index': 99999\n\t\t\t});\n\n\t\t\tthis.loadingNode = loadingNode;\n\t\t}\n\n\t\tgetDevice() {\n\t\t\tvar ua = navigator.userAgent;\n\t\t\treturn Object.assign({\n\t\t\t\tdeviceName: 'Mock Device',\n\t\t\t\tdeviceModel: ua\n\t\t\t}, /android/i.test(ua) ? {\n\t\t\t\tos: 'Android',\n\t\t\t\tosVersion: getMatch(ua, /android ([\\d\\.]+)/i, 1) || '4.4'\n\t\t\t} : /ip(ad|hone)/i.test(ua) ? {\n\t\t\t\tos: 'iOS',\n\t\t\t\tosVersion: getMatch(ua, /OS (\\d)_\\d/, 1) || '8'\n\t\t\t} : {\n\t\t\t\tos: 'Browser',\n\t\t\t\tosVersion: '1.0'\n\t\t\t});\n\t\t}\n\n\t\tmockMessage(message) {\n\t\t\tPromise.resolve().then(() => window.nativeWrapper.onMessage(message));\n\t\t}\n\n\t\tsendMessage(message) {\n\t\t\tif (message.type === 'Command') {\n\t\t\t\tvar subject = message.subject;\n\t\t\t\tvar handler = this['onCommand' + subject];\n\t\t\t\tvar result = {\n\t\t\t\t\ttype: 'CommandResult',\n\t\t\t\t\tsubject: subject,\n\t\t\t\t\tcommandId: message.commandId\n\t\t\t\t};\n\n\t\t\t\tif (handler) {\n\t\t\t\t\tPromise.resolve(handler.call(this, message.payload)).then(payload => {\n\t\t\t\t\t\tthis.mockMessage(Object.assign(result, { payload: payload }));\n\t\t\t\t\t}, error => {\n\t\t\t\t\t\tthis.mockMessage(Object.assign(result, { error: error }));\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\t// Let's just be lenient and log instead of rejecting\n\t\t\t\t\t/*\n\t\t\t\t\tthis.mockMessage(Object.assign(result, {\n\t\t\t\t\t\terror: {\n\t\t\t\t\t\t\tcode: 'UnsupportedCommand',\n\t\t\t\t\t\t\tmessage: `Command ${subject} is not supported`\n\t\t\t\t\t\t}\n\t\t\t\t\t}));\n\t\t\t\t\t*/\n\t\t\t\t\tlog.w('No mock for: ' + subject, message.payload);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tpopup(url, target, options) {\n\t\t\tvar { width, height } = ptv.params(options, { width: 0, height: 0 });\n\t\t\treturn util.popup(url, target, { width: width, height: height });\n\t\t}\n\n\t\tonCommandHideLoading() {\n\t\t\tdom.remove(this.loadingNode);\n\t\t}\n\n\t\tonCommandOpenDialog(payload) {\n\t\t\t// Not a great mock; this blocks JS and does not really support payload.buttons (assumes first is OK)\n\t\t\tvar buttons = payload.buttons;\n\t\t\tvar text = payload.title + '\n' + payload.message + '\n' + '[' + buttons.join('], [') + ']';\n\t\t\tvar ok = buttons.length > 1 ? window.confirm(text) : window.alert(text) || true;\n\t\t\treturn { pressed: buttons[ok ? 0 : 1] };\n\t\t}\n\n\t\tonCommandSetPushEnabled(payload) {\n\t\t\treturn payload.value && Math.random() > 0.8 ? Promise.reject({}) : {};\n\t\t}\n\n\t\t/* TWITTER */\n\n\t\tonCommandIsTwitterAccountAvailable() {\n\t\t\t// This can only be available on iOS, so let's simply mock that it is always available there\n\t\t\treturn this.wrapperPromise.then(wrapper => {\n\t\t\t\treturn { available: wrapper.os === 'iOS' };\n\t\t\t});\n\t\t}\n\n\t\t/* FACEBOOK */\n\n\t\tonCommandFacebookLogin(options) {\n\t\t\tif (this.facebook) {\n\t\t\t\t// TODO: Add permissions support\n\t\t\t\treturn this.facebook.login(options.interactive).then(() => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\ttoken: this.facebook.accessToken\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Rudimentary mock for when we have no Facebook (JS SDK based) instance\n\t\t\treturn {\n\t\t\t\ttoken: 'mock-facebook-token'\n\t\t\t};\n\t\t}\n\n\t\tonCommandFacebookLogout() {\n\t\t\tif (this.facebook) {\n\t\t\t\treturn this.facebook.logout();\n\t\t\t}\n\t\t}\n\n\t\tonCommandFacebookGraphRequest(options) {\n\t\t\t/*jshint camelcase:false*/\n\t\t\t/*jscs:disable requireCamelCaseOrUpperCaseIdentifiers*/\n\n\t\t\tif (this.facebook) {\n\t\t\t\treturn this.facebook.api(5000, options.path, options.httpMethod, options.parameters);\n\t\t\t}\n\n\t\t\t// Rudimentary mock for when we have no Facebook (JS SDK based) instance\n\t\t\tvar { path } = options;\n\t\t\tvar friends = {\n\t\t\t\tdata: [\n\t\t\t\t\t{ name: 'Peter Ex Machina', id: '100002151356216' }\n\t\t\t\t],\n\t\t\t\tpaging: { next: '' },\n\t\t\t\tsummary: { total_count: 1 }\n\t\t\t};\n\t\t\treturn {\n\t\t\t\tme: {\n\t\t\t\t\tid: 'mock-facebook-id',\n\t\t\t\t\tpermissions: { data: [\n\t\t\t\t\t\t{ permission: 'public_profile', status: 'granted' },\n\t\t\t\t\t\t{ permission: 'user_friends', status: 'granted' }\n\t\t\t\t\t] },\n\t\t\t\t\tfirst_name: 'Peter Paul',\n\t\t\t\t\tlast_name: 'Ex Machina',\n\t\t\t\t\tname: 'Peter Paul Ex Machina',\n\t\t\t\t\tpicture: { data: { url: '//graph.facebook.com/100001721575332/picture' } },\n\t\t\t\t\tfriends: friends\n\t\t\t\t},\n\t\t\t\t'me/friends': friends\n\t\t\t}[path] || Promise.reject(new Error('No mock response for FacebookGraphRequest path: ' + path));\n\t\t}\n\n\t\tonCommandFacebookShare(options) {\n\t\t\t/*jshint camelcase:false*/\n\t\t\t/*jscs:disable requireCamelCaseOrUpperCaseIdentifiers*/\n\n\t\t\tvar params = {\n\t\t\t\tlink: options.contentURL,\n\t\t\t\tname: options.contentTitle,\n\t\t\t\tdescription: options.contentDescription,\n\t\t\t\tpicture: options.imageURL\n\t\t\t};\n\n\t\t\t// Prune empty params\n\t\t\tObject.keys(params).forEach(key => {\n\t\t\t\tif (!params[key]) {\n\t\t\t\t\tdelete params[key];\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (this.facebook) {\n\t\t\t\treturn this.facebook.postByDialog(params);\n\t\t\t}\n\n\t\t\twindow.location = util.addURLParams('https://www.facebook.com/dialog/feed', Object.assign({\n\t\t\t\tapp_id: '160288680666821', // PlayToTV (works from *.playtotv.com)\n\t\t\t\tredirect_uri: window.location.href\n\t\t\t}, params));\n\t\t}\n\n\t\t/* AUDIO */\n\n\t\tonCommandLoadAudio(payload) {\n\t\t\tvar url = payload.url;\n\t\t\tvar node = document.createElement('audio');\n\t\t\tnode.src = url;\n\t\t\tnode.load();\n\t\t\tthis.audioNodeMap[url] = node;\n\t\t}\n\n\t\tonCommandPlayAudio(payload) {\n\t\t\tvar url = payload.url;\n\t\t\tvar node = this.audioNodeMap[url];\n\t\t\tnode.play();\n\t\t}\n\n\t\tonCommandStopAudio(payload) {\n\t\t\tvar url = payload.url;\n\t\t\tvar node = this.audioNodeMap[url];\n\t\t\tnode.stop();\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.push.PushController', [\n\t'playtotv.mvc.Controller'\n], function(\n\tController\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar log = ptv.Logger.get(this.id);\n\n\t// Not published as a normal resource api definition, so hard coded here\n\tvar pushPollAPI = {\n\t\tgetEvents: {\n\t\t\tlabel: 'pushPoll.getEvents',\n\t\t\ttype: 'GET',\n\t\t\turl: '1/events',\n\t\t\tqueryKeys: [\n\t\t\t\t'stream',\n\t\t\t\t'timeout'\n\t\t\t]\n\t\t}\n\t};\n\n\treturn class PushController extends Controller {\n\t\tconstructor(context, options) {\n\t\t\toptions = ptv.params(options, {\n\t\t\t\tpollTimeout: 10000\n\t\t\t});\n\n\t\t\tsuper(context);\n\n\t\t\tthis.pollTimeout = options.pollTimeout;\n\n\t\t\tthis.scope.observe('user.online', this.start.bind(this));\n\t\t}\n\n\t\t// Note: Currently no support for going offline and online again, but that does not seem necessary\n\t\tstart(online) {\n\t\t\tif (this.hasStarted || !online) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.poll();\n\t\t\tthis.hasStarted = true;\n\t\t}\n\n\t\t/**\n\t\t * Performs a single getEvents call and then recurses.\n\t\t * Received events are published to their corresponding channels: '[event.subject]-[event.action]'.\n\t\t * To stop polling dispose this controller.\n\t\t */\n\t\tpoll() {\n\t\t\tif (this.disposed) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.getEvents().then(events => {\n\t\t\t\tevents.forEach(event => this.publish(event.subject + '-' + event.action, event));\n\t\t\t}).catch(error => {\n\t\t\t\t// Brute force sturdiness; catch rejection and continue polling after a delay\n\t\t\t\tlog.i('poll: getEvents rejected, delaying next poll', error);\n\t\t\t\treturn Promise.delay(5000);\n\t\t\t}).then(() => this.poll());\n\t\t}\n\n\t\t/**\n\t\t * Gets events from server and updates stream id in model for following requests.\n\t\t *\n\t\t * @returns {Promise} Promise of an array of event data objects\n\t\t */\n\t\tgetEvents() {\n\t\t\tvar model = this.model;\n\t\t\tvar stream = model.stream;\n\t\t\tvar pollTimeout = this.pollTimeout;\n\n\t\t\treturn this.scope.call('server.call', pushPollAPI.getEvents, {\n\t\t\t\tstream: stream,\n\t\t\t\ttimeout: pollTimeout\n\t\t\t}, {\n\t\t\t\t// Extend server call timeout with long poll timeout\n\t\t\t\ttimeout: 20000 + pollTimeout\n\t\t\t}).then(data => {\n\t\t\t\tthis.set('stream', data.stream);\n\t\t\t\treturn data.events;\n\t\t\t});\n\t\t}\n\n\t\tserialize() {\n\t\t\treturn false;\n\t\t}\n\t};\n});\n",
		"/**\n * Auto generated API: <tt>src/question/question-api.js</tt>\n *\n * <b>DO NOT MODIFY! CHANGES WILL BE OVERWRITTEN THE NEXT TIME YOU UPDATE!</b>\n *\n * <b>Note:</b> These are not real functions but method definitions for\n * {@link playtotv.server.Server#call}.\n *\n * @name questionAPI\n * @memberOf playtotv.question\n * @namespace\n */\nplaytotv.define('playtotv.question.questionAPI', [], function() {\n\n\t'use strict';\n\n\treturn {\n\t\t/*jshint maxlen:300*/ // On occassion generated lines can be too long\n\n\t\t/** @lends playtotv.question.questionAPI */\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>questionId</b></li>\n\t\t * <li><i>{number}</i> <b>answerTime</b></li>\n\t\t * <li><i>{[string]}</i> <b>submittedAnswers</b></li>\n\t\t * <li><i>{number}</i> <b>maxPossibleScore</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.episodeSessionId\n\t\t * @returns {Promise} Promise of response data (QuestionParticipantAnswerDTO)\n\t\t */\n\t\tgetParticipantAnswers: {\n\t\t\tlabel: 'question.getParticipantAnswers',\n\t\t\turl: '1/question/episodesession/{episodeSessionId}/stats'\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>questionId</b></li>\n\t\t * <li><i>{string}</i> <b>type</b></li>\n\t\t * <li><i>{[ClientAnswerDTO]}</i> <b>answers</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>code</b></li>\n\t\t * <li><i>{string}</i> <b>answer</b></li>\n\t\t * <li><i>{string}</i> <b>mediaUrl</b></li>\n\t\t * </ul></li>\n\t\t * <li><i>{string}</i> <b>subject</b></li>\n\t\t * <li><i>{string}</i> <b>text</b></li>\n\t\t * <li><i>{string}</i> <b>mediaUrl</b></li>\n\t\t * <li><i>{number}</i> <b>correctScore</b></li>\n\t\t * <li><i>{number}</i> <b>participationScore</b></li>\n\t\t * <li><i>{number}</i> <b>answerCount</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.questionId\n\t\t * @param {string} params.episodeSessionId\n\t\t * @returns {Promise} Promise of response data (ClientQuestionDTO)\n\t\t */\n\t\tgetQuestion: {\n\t\t\tlabel: 'question.getQuestion',\n\t\t\turl: '1/question/questions/{questionId}/episodesession/{episodeSessionId}'\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>questionId</b></li>\n\t\t * <li><i>{string}</i> <b>categoryKey</b></li>\n\t\t * <li><i>{string}</i> <b>categoryValue</b></li>\n\t\t * <li><i>{Long}</i> <b>totalAnswers</b></li>\n\t\t * <li><i>{[Double]}</i> <b>answersNormalizedOverTime</b></li>\n\t\t * <li><i>{Long}</i> <b>correctAnswers</b></li>\n\t\t * <li><i>{Long}</i> <b>averageCorrectAnswers</b></li>\n\t\t * <li><i>{[QuestionAnswerEpisodeStatsDTO]}</i> <b>answers</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>code</b></li>\n\t\t * <li><i>{Long}</i> <b>count</b></li>\n\t\t * <li><i>{number}</i> <b>percentage</b></li>\n\t\t * <li><i>{[Double]}</i> <b>normalizedOverTime</b></li>\n\t\t * <li><i>{Boolean}</i> <b>correct</b></li>\n\t\t * </ul></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.questionId\n\t\t * @param {string} params.episodeSessionId\n\t\t * @returns {Promise} Promise of response data (QuestionEpisodeStatsDTO)\n\t\t */\n\t\tgetQuestionStats: {\n\t\t\tlabel: 'question.getQuestionStats',\n\t\t\turl: '1/question/questions/{questionId}/episodesession/{episodeSessionId}/stats'\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>questionId</b></li>\n\t\t * <li><i>{number}</i> <b>answerTime</b></li>\n\t\t * <li><i>{[string]}</i> <b>submittedAnswers</b></li>\n\t\t * <li><i>{number}</i> <b>maxPossibleScore</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.questionId\n\t\t * @param {string} params.episodeSessionId\n\t\t * @param {[string]} params.answerCodes\n\t\t * @param {number} params.clientAnswerTime\n\t\t * @returns {Promise} Promise of response data (QuestionParticipantAnswerDTO)\n\t\t */\n\t\tsubmitAnswer: {\n\t\t\tlabel: 'question.submitAnswer',\n\t\t\turl: '1/question/questions/{questionId}/episodesession/{episodeSessionId}/answer',\n\t\t\ttype: 'PUT',\n\t\t\tdataKeys: [\n\t\t\t\t'answerCodes',\n\t\t\t\t'clientAnswerTime'\n\t\t\t]\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.question.QuestionController', [\n\t'playtotv.mvc.Controller',\n\t'playtotv.question.questionAPI'\n], function(\n\tController,\n\tquestionAPI\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\n\treturn class QuestionController extends Controller {\n\t\tconstructor(context) {\n\t\t\tsuper(context);\n\n\t\t\tthis.addMethods([\n\t\t\t\t'submitAnswer',\n\t\t\t\t'decorateAnswers'\n\t\t\t]);\n\t\t}\n\n\t\tsubmitAnswer(id, code, options) {\n\t\t\toptions = ptv.params(options, {\n\t\t\t\tdelay: 0\n\t\t\t});\n\n\t\t\tvar idCode = id + '-' + code;\n\t\t\tthis.submitting = idCode;\n\t\t\tthis.publish('submitting', this.submitting);\n\n\t\t\treturn Promise.delay(options.delay).then(() => {\n\t\t\t\treturn this.scope.call('episode.submitInteraction', questionAPI.submitAnswer, id, {\n\t\t\t\t\tquestionId: id,\n\t\t\t\t\tanswerCodes: [ code ],\n\t\t\t\t\tclientAnswerTime: true\n\t\t\t\t}).finally(() => {\n\t\t\t\t\tif (this.submitting === idCode) {\n\t\t\t\t\t\tdelete this.submitting;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tdecorateAnswers(question) {\n\t\t\tvar stats = question.stats;\n\t\t\tvar data = question.data;\n\t\t\tvar statsAnswers = (stats && stats.answers) || [];\n\t\t\tvar submittedAnswerCodes = (data && data.submittedAnswers) || [];\n\n\t\t\treturn question.content.answers.map(answer => {\n\t\t\t\tvar answerCode = answer.code;\n\t\t\t\tvar answerStats = statsAnswers.find(answerStats => answerStats.code === answerCode);\n\t\t\t\treturn Object.assign({\n\t\t\t\t\tquestion: question,\n\t\t\t\t\tsubmitting: this.submitting === question.id + '-' + answerCode,\n\t\t\t\t\tsubmitted: submittedAnswerCodes.indexOf(answerCode) >= 0\n\t\t\t\t}, answer, answerStats);\n\t\t\t});\n\t\t}\n\t};\n});\n",
		"/**\n * Auto generated API: <tt>src/rating/rating-api.js</tt>\n *\n * <b>DO NOT MODIFY! CHANGES WILL BE OVERWRITTEN THE NEXT TIME YOU UPDATE!</b>\n *\n * <b>Note:</b> These are not real functions but method definitions for\n * {@link playtotv.server.Server#call}.\n *\n * @name ratingAPI\n * @memberOf playtotv.rating\n * @namespace\n */\nplaytotv.define('playtotv.rating.ratingAPI', [], function() {\n\n\t'use strict';\n\n\treturn {\n\t\t/*jshint maxlen:300*/ // On occassion generated lines can be too long\n\n\t\t/** @lends playtotv.rating.ratingAPI */\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>ratingId</b></li>\n\t\t * <li><i>{string}</i> <b>subject</b></li>\n\t\t * <li><i>{string}</i> <b>text</b></li>\n\t\t * <li><i>{string}</i> <b>mediaUrl</b></li>\n\t\t * <li><i>{number}</i> <b>participationScore</b></li>\n\t\t * <li><i>{[ClientRatingSubjectDTO]}</i> <b>subjects</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>name</b></li>\n\t\t * <li><i>{string}</i> <b>code</b></li>\n\t\t * <li><i>{string}</i> <b>mediaUrl</b></li>\n\t\t * </ul></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.ratingId\n\t\t * @param {string} params.episodeSessionId\n\t\t * @returns {Promise} Promise of response data (ClientRatingDTO)\n\t\t */\n\t\tgetRating: {\n\t\t\tlabel: 'rating.getRating',\n\t\t\turl: '1/rating/ratings/{ratingId}/episodesession/{episodeSessionId}'\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>ratingId</b></li>\n\t\t * <li><i>{boolean}</i> <b>finalized</b></li>\n\t\t * <li><i>{[SingleRatingValueDTO]}</i> <b>values</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>code</b></li>\n\t\t * <li><i>{number}</i> <b>value</b></li>\n\t\t * </ul></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.ratingId\n\t\t * @param {string} params.episodeSessionId\n\t\t * @returns {Promise} Promise of response data (RatingStatsDTO)\n\t\t */\n\t\tgetRatingStats: {\n\t\t\tlabel: 'rating.getRatingStats',\n\t\t\turl: '1/rating/ratings/{ratingId}/episodesession/{episodeSessionId}/stats'\n\t\t},\n\n\t\t/**\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.ratingId\n\t\t * @param {string} params.episodeSessionId\n\t\t * @param {Long} params.values\n\t\t * @returns {Promise} Promise of response data (Object)\n\t\t */\n\t\tsubmitRating: {\n\t\t\tlabel: 'rating.submitRating',\n\t\t\turl: '1/rating/ratings/{ratingId}/episodesession/{episodeSessionId}/answer',\n\t\t\ttype: 'PUT',\n\t\t\tdataKeys: [\n\t\t\t\t'values'\n\t\t\t]\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.rating.RatingInputWidget', [\n\t'playtotv.widget.Widget'\n], function(\n\tWidget\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar REQUIRED = ptv.REQUIRED;\n\n\treturn class RatingInputWidget extends Widget {\n\n\t\tconstructor(node, options) {\n\t\t\tptv.params(options, {\n\t\t\t\tapp: null,\n\t\t\t\tcontroller: REQUIRED,\n\t\t\t\tid: REQUIRED,\n\t\t\t\tcode: REQUIRED\n\t\t\t});\n\n\t\t\tsuper(node);\n\n\t\t\tObject.assign(this, options);\n\n\t\t\tthis.addEventListener(node, 'change', this.onChange.bind(this));\n\t\t}\n\n\t\tonChange() {\n\t\t\tthis.controller.submit(this.id, this.code, this.node.value);\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.rating.RatingController', [\n\t'playtotv.mvc.Controller',\n\t'playtotv.rating.ratingAPI',\n\t'playtotv.rating.RatingInputWidget'\n], function(\n\tController,\n\tratingAPI,\n\tRatingInputWidget\n) {\n\n\t'use strict';\n\n\tvar FACTOR = 10;\n\n\treturn class RatingController extends Controller {\n\t\tconstructor(context) {\n\t\t\tsuper(context);\n\n\t\t\tthis.addMethods([\n\t\t\t\t'submit',\n\t\t\t\t'decorateSubjects'\n\t\t\t]);\n\n\t\t\tthis.addWidgets([\n\t\t\t\t[ 'input', RatingInputWidget ]\n\t\t\t]);\n\t\t}\n\n\t\tsubmit(id, code, value) {\n\t\t\tvar valueMap = {};\n\t\t\tvalueMap[code] = Math.round(value * FACTOR);\n\n\t\t\treturn this.scope.call('episode.submitInteraction', ratingAPI.submitRating, id, {\n\t\t\t\tratingId: id,\n\t\t\t\tvalues: valueMap\n\t\t\t}, submittedValueMap => {\n\t\t\t\tsubmittedValueMap = submittedValueMap || {};\n\t\t\t\tsubmittedValueMap[code] = value;\n\t\t\t\treturn submittedValueMap;\n\t\t\t});\n\t\t}\n\n\t\tdecorateSubjects(rating) {\n\t\t\tvar stats = rating.stats;\n\t\t\tvar subjectAverages = (stats && stats.values) || [];\n\t\t\tvar submittedValueMap = rating.data || {};\n\n\t\t\treturn rating.content.subjects.map(subject => {\n\t\t\t\tvar subjectCode = subject.code;\n\t\t\t\tvar subjectAverage = subjectAverages.find(subjectAverage => subjectAverage.code === subjectCode);\n\t\t\t\treturn Object.assign({\n\t\t\t\t\trating: rating,\n\t\t\t\t\tsubmitted: submittedValueMap[subjectCode],\n\t\t\t\t\taverage: subjectAverage && subjectAverage.value / FACTOR\n\t\t\t\t}, subject);\n\t\t\t});\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.relation.RelationSubscription', [\n\t'playtotv.pubsub.Subscription'\n], function(\n\tSubscription\n) {\n\n\t'use strict';\n\n\tvar util = playtotv.util;\n\n\treturn class RelationSubscription extends Subscription {\n\t\t/** @lends playtotv.relation.RelationSubscription.prototype */\n\n\t\t/**\n\t\t * Class used to represent a {@link playtotv.relation.RelationManager} Subscription.\n\t\t *\n\t\t * If selector is a string it is converted to a RegExp that enables matching multiple space separated rels.\n\t\t * And this.regexIndex is set so that publishes are delivered to only the matching part of the channel string.\n\t\t *\n\t\t * @extends playtotv.pubsub.Subscription\n\t\t * @constructs\n\t\t * @param {string|RegExp} selector Relation selector string or RegExp\n\t\t * @param {Function} handler Subscription callback\n\t\t * @throws {TypeError} If selector or handler is invalid\n\t\t *\n\t\t * @property {RegExp} selector Relation selector RegExp\n\t\t * @property {Function} handler Subscription callback\n\t\t * @property {number} regexIndex Index of selector RegExp match result to deliver to\n\t\t */\n\t\tconstructor(selector, handler) {\n\t\t\tvar isStr = typeof selector === 'string';\n\t\t\tif (isStr) {\n\t\t\t\tselector = new RegExp('(\\\\s|^)(' + util.escapeRegEx(selector).replace(/\\\\\\*/g, '\\\\S*?') + ')(\\\\s|$)');\n\t\t\t}\n\n\t\t\tsuper(selector, handler);\n\n\t\t\tif (isStr) {\n\t\t\t\tthis.regexIndex = 2;\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Deliver data to handler on specified channel.\n\t\t *\n\t\t * If regexIndex is defined then channel is replaced by specified index of the selector matches.\n\t\t *\n\t\t * @param {mixed} [data] Data to deliver\n\t\t * @param {string} channel Channel we are delivering to\n\t\t */\n\t\tdeliver(data, channel) {\n\t\t\tif (this.handler) {\n\t\t\t\tvar regexIndex = this.regexIndex;\n\t\t\t\tif (regexIndex !== undefined) {\n\t\t\t\t\tchannel = this.selector.exec(channel)[regexIndex];\n\t\t\t\t}\n\n\t\t\t\tthis.handler(data, channel);\n\t\t\t}\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.relation.RelationManager', [\n\t'playtotv.pubsub.PubSub',\n\t'playtotv.relation.RelationSubscription'\n], function(\n\tPubSub,\n\tRelationSubscription\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar dom = ptv.dom;\n\tvar event = ptv.event;\n\n\treturn class RelationManager extends PubSub {\n\t\t/** @lends playtotv.relation.RelationManager.prototype */\n\n\t\t/**\n\t\t * Enables subscribing to clicks on nodes with \"rel\" attribute values matching strings or regular expressions.\n\t\t *\n\t\t * @extends playtotv.pubsub.PubSub\n\t\t * @constructs\n\t\t * @param {Node} [node=document] Root node on which to listen to click events\n\t\t */\n\t\tconstructor(node) {\n\t\t\tnode = node || document;\n\t\t\tsuper();\n\t\t\tthis.node = node;\n\t\t\tthis.onClick = this.onClick.bind(this);\n\t\t\tevent.addListener(node, 'click', this.onClick);\n\t\t}\n\n\t\t/**\n\t\t * Subscribe handler to specified selector.\n\t\t *\n\t\t * This overrides {@link playtotv.pubsub.PubSub#subscribe} to return a\n\t\t * {@link playtotv.relation.RelationSubscription} to facilitate matching multiple rels.\n\t\t *\n\t\t * P.e: If you subscribe to \"foo\" then a click on a link with rel=\"foo bar\" will result in handler being called\n\t\t * with rel channel \"foo\".\n\t\t *\n\t\t * @param {string|RegExp} selector Channel selector\n\t\t * @param {Function} handler Subscription callback\n\t\t * @throws {TypeError} If selector or handler is invalid\n\t\t * @returns {playtotv.relation.RelationSubscription} Added subscription\n\t\t */\n\t\tsubscribe(selector, handler) {\n\t\t\tvar subscription = new RelationSubscription(selector, handler);\n\t\t\tthis.subscriptions.push(subscription);\n\t\t\treturn subscription;\n\t\t}\n\n\t\t/**\n\t\t * Click handler that publishes link node to rel attribute value channel.\n\t\t *\n\t\t * @param {Event} e DOM Event\n\t\t */\n\t\tonClick(e) {\n\t\t\tvar link = dom.closest('a[rel]', e.target);\n\t\t\tvar rel = link ? link.rel : null;\n\t\t\tif (rel) {\n\t\t\t\te.preventDefault();\n\t\t\t\t// Publish synchronously to allow for privileged callbacks (e.g. play audio on iOS and Android)\n\t\t\t\t// Besides, we are already in an async event listener callback\n\t\t\t\tthis.publish(rel, link, true);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Dispose.\n\t\t */\n\t\tdispose() {\n\t\t\tevent.removeListener(this.node, 'click', this.onClick);\n\n\t\t\tPubSub.prototype.dispose.call(this);\n\t\t}\n\t};\n});\n",
		"/**\n * Auto generated API: <tt>src/score/score-api.js</tt>\n *\n * <b>DO NOT MODIFY! CHANGES WILL BE OVERWRITTEN THE NEXT TIME YOU UPDATE!</b>\n *\n * <b>Note:</b> These are not real functions but method definitions for\n * {@link playtotv.server.Server#call}.\n *\n * @name scoreAPI\n * @memberOf playtotv.score\n * @namespace\n */\nplaytotv.define('playtotv.score.scoreAPI', [], function() {\n\n\t'use strict';\n\n\treturn {\n\t\t/*jshint maxlen:300*/ // On occassion generated lines can be too long\n\n\t\t/** @lends playtotv.score.scoreAPI */\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>showId</b></li>\n\t\t * <li><i>{ScoreTimeInterval}</i> <b>interval</b> Valid values: 'DAY', 'WEEK', 'MONTH', 'ALLTIME'</li>\n\t\t * <li><i>{number}</i> <b>intervalIndex</b></li>\n\t\t * <li><i>{[LeaderboardEntryDTO]}</i> <b>entries</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * <li><i>{number}</i> <b>score</b></li>\n\t\t * <li><i>{string}</i> <b>displayName</b></li>\n\t\t * <li><i>{string}</i> <b>avatarUrl</b></li>\n\t\t * <li><i>{number}</i> <b>ranking</b></li>\n\t\t * </ul></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.showId\n\t\t * @param {string} [params.pageIndex=1]\n\t\t * @param {string} [params.pageSize=10]\n\t\t * @returns {Promise} Promise of response data (TimeSpanLeaderboardDTO)\n\t\t */\n\t\tgetCurrentLeaderboardPage: {\n\t\t\tlabel: 'score.getCurrentLeaderboardPage',\n\t\t\turl: '1/score/show/{showId}/leaderboard',\n\t\t\tqueryKeys: [\n\t\t\t\t'pageIndex',\n\t\t\t\t'pageSize'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>showId</b></li>\n\t\t * <li><i>{ScoreTimeInterval}</i> <b>interval</b> Valid values: 'DAY', 'WEEK', 'MONTH', 'ALLTIME'</li>\n\t\t * <li><i>{number}</i> <b>intervalIndex</b></li>\n\t\t * <li><i>{[LeaderboardEntryDTO]}</i> <b>entries</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * <li><i>{number}</i> <b>score</b></li>\n\t\t * <li><i>{string}</i> <b>displayName</b></li>\n\t\t * <li><i>{string}</i> <b>avatarUrl</b></li>\n\t\t * <li><i>{number}</i> <b>ranking</b></li>\n\t\t * </ul></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.showId\n\t\t * @param {string} params.interval\n\t\t * @param {string} [params.pageIndex=1]\n\t\t * @param {string} [params.pageSize=10]\n\t\t * @returns {Promise} Promise of response data (TimeSpanLeaderboardDTO)\n\t\t */\n\t\tgetCurrentLeaderboardPageForInterval: {\n\t\t\tlabel: 'score.getCurrentLeaderboardPageForInterval',\n\t\t\turl: '1/score/show/{showId}/{interval}/leaderboard',\n\t\t\tqueryKeys: [\n\t\t\t\t'pageIndex',\n\t\t\t\t'pageSize'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>episodeSessionId</b></li>\n\t\t * <li><i>{[LeaderboardEntryDTO]}</i> <b>entries</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * <li><i>{number}</i> <b>score</b></li>\n\t\t * <li><i>{string}</i> <b>displayName</b></li>\n\t\t * <li><i>{string}</i> <b>avatarUrl</b></li>\n\t\t * <li><i>{number}</i> <b>ranking</b></li>\n\t\t * </ul></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.episodeSessionId\n\t\t * @param {string} [params.pageIndex=1]\n\t\t * @param {string} [params.pageSize=10]\n\t\t * @returns {Promise} Promise of response data (EpisodeLeaderboardDTO)\n\t\t */\n\t\tgetEpisodeLeaderboardPage: {\n\t\t\tlabel: 'score.getEpisodeLeaderboardPage',\n\t\t\turl: '1/score/episodesession/{episodeSessionId}/leaderboard',\n\t\t\tqueryKeys: [\n\t\t\t\t'pageIndex',\n\t\t\t\t'pageSize'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * <li><i>{string}</i> <b>episodeSessionId</b></li>\n\t\t * <li><i>{number}</i> <b>score</b></li>\n\t\t * <li><i>{number}</i> <b>ranking</b></li>\n\t\t * <li><i>{Long}</i> <b>phaseScores</b></li>\n\t\t * <li><i>{string}</i> <b>displayName</b></li>\n\t\t * <li><i>{string}</i> <b>avatarUrl</b></li>\n\t\t * <li><i>{boolean}</i> <b>notPlayed</b></li>\n\t\t * <li><i>{string}</i> <b>facebookId</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.episodeSessionId\n\t\t * @param {string} [params.userIds]\n\t\t * @param {string} [params.facebookIds]\n\t\t * @param {string} [params.callId]\n\t\t * @returns {Promise} Promise of response data (ParticipantEpisodeScoreDTO)\n\t\t */\n\t\tgetEpisodeScores: {\n\t\t\tlabel: 'score.getEpisodeScores',\n\t\t\turl: '1/score/episodesession/{episodeSessionId}',\n\t\t\tqueryKeys: [\n\t\t\t\t'userIds',\n\t\t\t\t'facebookIds',\n\t\t\t\t'callId'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>showId</b></li>\n\t\t * <li><i>{ScoreTimeInterval}</i> <b>interval</b> Valid values: 'DAY', 'WEEK', 'MONTH', 'ALLTIME'</li>\n\t\t * <li><i>{number}</i> <b>intervalIndex</b></li>\n\t\t * <li><i>{[LeaderboardEntryDTO]}</i> <b>entries</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * <li><i>{number}</i> <b>score</b></li>\n\t\t * <li><i>{string}</i> <b>displayName</b></li>\n\t\t * <li><i>{string}</i> <b>avatarUrl</b></li>\n\t\t * <li><i>{number}</i> <b>ranking</b></li>\n\t\t * </ul></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.showId\n\t\t * @param {string} params.interval\n\t\t * @param {string} params.year\n\t\t * @param {string} params.subIntervalIndex\n\t\t * @param {string} [params.pageIndex=1]\n\t\t * @param {string} [params.pageSize=10]\n\t\t * @returns {Promise} Promise of response data (TimeSpanLeaderboardDTO)\n\t\t */\n\t\tgetLeaderboardPageForInterval: {\n\t\t\tlabel: 'score.getLeaderboardPageForInterval',\n\t\t\turl: '1/score/show/{showId}/time/{interval}/{year}/{subIntervalIndex}/leaderboard',\n\t\t\tqueryKeys: [\n\t\t\t\t'pageIndex',\n\t\t\t\t'pageSize'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * <li><i>{string}</i> <b>showId</b></li>\n\t\t * <li><i>{number}</i> <b>score</b></li>\n\t\t * <li><i>{string}</i> <b>displayName</b></li>\n\t\t * <li><i>{string}</i> <b>avatarUrl</b></li>\n\t\t * <li><i>{number}</i> <b>ranking</b></li>\n\t\t * <li><i>{string}</i> <b>facebookId</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.showId\n\t\t * @param {ScoreTimeInterval} params.interval Valid values: 'DAY', 'WEEK', 'MONTH', 'ALLTIME'\n\t\t * @param {string} params.year\n\t\t * @param {string} params.subIntervalIndex\n\t\t * @param {string} [params.userIds]\n\t\t * @param {string} [params.facebookIds]\n\t\t * @param {string} [params.callId]\n\t\t * @returns {Promise} Promise of response data (ParticipantTimeSpanScoreDTO)\n\t\t */\n\t\tgetTimeSpanScores: {\n\t\t\tlabel: 'score.getTimeSpanScores',\n\t\t\turl: '1/score/show/{showId}/time/{interval}/{year}/{subIntervalIndex}',\n\t\t\tqueryKeys: [\n\t\t\t\t'userIds',\n\t\t\t\t'facebookIds',\n\t\t\t\t'callId'\n\t\t\t]\n\t\t}\n\t};\n});\n",
		"/**\n * Auto generated API: <tt>src/server/gatekeeper-api.js</tt>\n *\n * <b>DO NOT MODIFY! CHANGES WILL BE OVERWRITTEN THE NEXT TIME YOU UPDATE!</b>\n *\n * <b>Note:</b> These are not real functions but method definitions for\n * {@link playtotv.server.Server#call}.\n *\n * @name gatekeeperAPI\n * @memberOf playtotv.server\n * @namespace\n */\nplaytotv.define('playtotv.server.gatekeeperAPI', [], function() {\n\n\t'use strict';\n\n\treturn {\n\t\t/*jshint maxlen:300*/ // On occassion generated lines can be too long\n\n\t\t/** @lends playtotv.server.gatekeeperAPI */\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{Long}</i> <b>serverTime</b></li>\n\t\t * <li><i>{SystemStatus}</i> <b>status</b> Valid values: 'STARTING', 'AVAILABLE', 'FULL'</li>\n\t\t * <li><i>{[ClientStartupInfoServiceDTO]}</i> <b>services</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>serviceType</b></li>\n\t\t * <li><i>{[string]}</i> <b>serviceUrls</b></li>\n\t\t * </ul></li>\n\t\t * <li><i>{ClientVersionInfoDTO}</i> <b>clientMinimalVersion</b>\n\t\t * <ul>\n\t\t * <li><i>{Long}</i> <b>android</b></li>\n\t\t * <li><i>{Long}</i> <b>ios</b></li>\n\t\t * <li><i>{Long}</i> <b>web</b></li>\n\t\t * <li><i>{Long}</i> <b>windowsPhone</b></li>\n\t\t * <li><i>{Long}</i> <b>windows</b></li>\n\t\t * </ul></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @returns {Promise} Promise of response data (ClientStartupInfoDTO)\n\t\t */\n\t\tgetInit: {\n\t\t\tlabel: 'gatekeeper.getInit',\n\t\t\turl: '1/gatekeeper/init'\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.storage.MockStorage', [], function() {\n\n\t'use strict';\n\n\treturn class MockStorage {\n\t\t/** @lends playtotv.storage.MockStorage.prototype */\n\n\t\t/**\n\t\t * DOM Storage (e.g. localStorage) compatible class for mocking.\n\t\t *\n\t\t * Note: Data is stored in a plain object, so it will not be persisted beyond reloads etc.\n\t\t *\n\t\t * Note: This does not support Storage events (yet).\n\t\t *\n\t\t * @constructs\n\t\t */\n\t\tconstructor() {\n\t\t\t/**\n\t\t\t * The number of key/value pairs currently present in the list associated with the object.\n\t\t\t * @type number\n\t\t\t */\n\t\t\tthis.length = 0;\n\n\t\t\tthis._container = {};\n\t\t}\n\n\t\t/** @lends playtotv.storage.MockStorage.prototype */\n\n\t\t/**\n\t\t * Returns the name of the key with the given index.\n\t\t *\n\t\t * @param {number} index\n\t\t * @return {string} key\n\t\t */\n\t\tkey(index) {\n\t\t\treturn Object.keys(this._container)[index];\n\t\t}\n\n\t\t/**\n\t\t * Returns the current value associated with the given key.\n\t\t *\n\t\t * @param {string} key\n\t\t * @returns {string} value\n\t\t */\n\t\tgetItem(key) {\n\t\t\treturn Object.keys(this._container).indexOf(key) === -1 ? null : this._container[key];\n\t\t}\n\n\t\t/**\n\t\t * Adds or updates value of key/value pair to given value.\n\t\t *\n\t\t * @param {string} key\n\t\t * @param {string} value\n\t\t */\n\t\tsetItem(key, value) {\n\t\t\tthis._container[key] = value;\n\t\t\tthis._updateLength();\n\t\t}\n\n\t\t/**\n\t\t * Causes the key/value pair with the given key to be removed.\n\t\t *\n\t\t * @param {string} key\n\t\t */\n\t\tremoveItem(key) {\n\t\t\tdelete this._container[key];\n\t\t\tthis._updateLength();\n\t\t}\n\n\t\t/**\n\t\t * Causes the list associated with the object to be emptied of all key/value pairs.\n\t\t */\n\t\tclear() {\n\t\t\tthis.length = 0;\n\t\t\tthis._container = {};\n\t\t}\n\n\t\t_updateLength() {\n\t\t\tthis.length = Object.keys(this._container).length;\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.storage.Storage', [\n\t'playtotv.storage.MockStorage'\n], function(\n\tMockStorage\n) {\n\n\t'use strict';\n\n\tvar log = playtotv.Logger.get(this.id);\n\n\treturn class Storage {\n\t\t/** @lends playtotv.storage.Storage.prototype */\n\n\t\t/**\n\t\t * Wraps localStorage or sessionStorage, providing support for storage scoping through prefixing and getting\n\t\t * and setting non-string values through JSON encoding.\n\t\t *\n\t\t * This depends on the storage object's setItem, getItem, removeItem and key methods and length property.\n\t\t *\n\t\t * If window.localStorage is falsy then a new {@link playtotv.storage.MockStorage} instance is used by default.\n\t\t *\n\t\t * In any case, storage should be considered unreliable. For reliable persistence of data, use our servers.\n\t\t *\n\t\t * @constructs\n\t\t * @param {Object} [storage=window.localStorage] Storage object to use\n\t\t * @param {string} [prefix=''] Key prefix for this instance\n\t\t */\n\t\tconstructor(storage, prefix) {\n\t\t\tthis.storage = storage || window.localStorage || new MockStorage();\n\t\t\tthis.prefix = prefix || '';\n\t\t}\n\n\t\t/** @lends playtotv.storage.Storage.prototype */\n\n\t\t/**\n\t\t * Returns the stored value for a given key. Returns defaultValue if no value is found.\n\t\t *\n\t\t * @param {string} key\n\t\t * @param {mixed} defaultValue\n\t\t * @returns {mixed} value\n\t\t */\n\t\tget(key, defaultValue) {\n\t\t\tvar value = this.storage.getItem(this.prefix + key);\n\n\t\t\tif (value === null || value === undefined) {\n\t\t\t\treturn defaultValue; // always return defaultValue/undefined if not found (Firefox returns null)\n\t\t\t} else {\n\t\t\t\ttry { value = JSON.parse(value); } catch (e) {} // catch for backwards compatibility (e.g. strings)\n\t\t\t\treturn value;\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Stores a value with the given key. If value equals null or undefined then stored value is removed instead.\n\t\t *\n\t\t * Note: This should not be considered to be reliable let alone secure, always provide fallbacks.\n\t\t *\n\t\t * @param {string} key\n\t\t * @param {mixed} value\n\t\t * @param {Function} [quotaHandler=this.quotaHandler]\n\t\t */\n\t\tset(key, value, quotaHandler) {\n\t\t\tquotaHandler = quotaHandler || this.quotaHandler;\n\n\t\t\tif (value === null || value === undefined) {\n\t\t\t\tthis.remove(key); // setting undefined is not supported, remove it instead with likewise result\n\t\t\t} else {\n\t\t\t\t// Catch quota exceptions in case we run out or have none like in Safari Private Browsing\n\t\t\t\ttry {\n\t\t\t\t\tthis.storage.setItem(this.prefix + key, JSON.stringify(value));\n\t\t\t\t} catch (e) {\n\t\t\t\t\tif (e instanceof window.DOMException && e.code === e.QUOTA_EXCEEDED_ERR) {\n\t\t\t\t\t\tquotaHandler.call(this, e, key, value);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow e; // pass on any other exceptions\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Default quota exceeded exception handler that simply logs the exception.\n\t\t *\n\t\t * @param {Exception} e\n\t\t * @param {string} key\n\t\t * @param {mixed} value\n\t\t */\n\t\tquotaHandler(e, key, value) {\n\t\t\tlog.e('Caught quota exception: ' + e.name + ', while setting: ' + key, value, e);\n\t\t}\n\n\t\t/**\n\t\t * Removes a key\n\t\t *\n\t\t * @param {string} key\n\t\t * @returns {mixed} value\n\t\t */\n\t\tremove(key) {\n\t\t\tthis.storage.removeItem(this.prefix + key);\n\t\t}\n\n\t\t/**\n\t\t * Removes all items with this instance's prefix.\n\t\t */\n\t\tclear() {\n\t\t\tvar storage = this.storage;\n\t\t\tvar i = 0;\n\t\t\twhile (i < storage.length) {\n\t\t\t\tvar key = storage.key(i);\n\t\t\t\tif (key.indexOf(this.prefix) === 0) {\n\t\t\t\t\tstorage.removeItem(key);\n\t\t\t\t} else {\n\t\t\t\t\ti++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Returns a sub storage instance with combined prefixes.\n\t\t *\n\t\t * @param {string} subprefix\n\t\t * @returns {playtotv.storage.Storage} storage\n\t\t */\n\t\tsubStorage(subPrefix) {\n\t\t\treturn new Storage(this.storage, this.prefix + subPrefix);\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.storage.AsyncStorage', [\n\t'playtotv.storage.Storage'\n], function(\n\tStorage\n) {\n\t/* global openDatabase:false*/\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar moduleId = this.id;\n\tvar log = ptv.Logger.get(moduleId);\n\tvar TABLE = 'keyvaluepairs';\n\n\tfunction sql(db, query, args) {\n\t\targs = args || [];\n\n\t\tlog.s(query, args);\n\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tdb.transaction(function(transaction) {\n\t\t\t\ttransaction.executeSql(query, args, function(transaction, results) {\n\t\t\t\t\tresolve(results);\n\t\t\t\t}, function(transaction, error) {\n\t\t\t\t\treject(error);\n\t\t\t\t});\n\t\t\t}, reject);\n\t\t});\n\t}\n\n\treturn class AsyncStorage {\n\t\t/** @lends playtotv.storage.AsyncStorage.prototype */\n\n\t\t/**\n\t\t * Async key value storage using Web SQL as backend or falling back to localStorage if necessary.\n\t\t *\n\t\t * The interface is similar to {@link playtotv.storage.Storage} (which is also used for localStorage fallback)\n\t\t * but async using Promises.\n\t\t *\n\t\t * Code is inspired by localForage which is excellent but slightly on the heavy side\n\t\t * (localforage.nopromises.min.js is 17.5KB minified vs 2.7KB for Storage and AsyncStorage).\n\t\t * Note: IndexedDB still has limited support and issues so it has been left out for now.\n\t\t *\n\t\t * @constructs\n\t\t * @param {string} [prefix=''] Key prefix for this instance\n\t\t */\n\t\tconstructor(prefix) {\n\t\t\tthis.prefix = prefix || '';\n\n\t\t\tthis.ready = Promise.resolve().then(function() {\n\t\t\t\t// Default DB size is _JUST UNDER_ 5MB, as it's the highest size we can use without a prompt\n\t\t\t\tvar db = openDatabase(moduleId, '1.0', '', 4980736);\n\t\t\t\tvar query = 'CREATE TABLE IF NOT EXISTS ' + TABLE + ' (id INTEGER PRIMARY KEY, key unique, value)';\n\t\t\t\treturn sql(db, query).then(function() {\n\t\t\t\t\treturn { db: db };\n\t\t\t\t});\n\t\t\t}).catch(function(error) {\n\t\t\t\tlog.d('Falling back to localStorage', error);\n\t\t\t\treturn { storage: new Storage(window.localStorage, prefix) };\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Returns Promise of stored value for a given key. Returns defaultValue if no value is found.\n\t\t *\n\t\t * @param {string} key\n\t\t * @param {mixed} defaultValue\n\t\t * @returns {Promise} Promise of value\n\t\t */\n\t\tget(key, defaultValue) {\n\t\t\tvar prefix = this.prefix;\n\n\t\t\treturn this.ready.then(function(ref) {\n\t\t\t\tvar db = ref.db;\n\t\t\t\tif (!db) {\n\t\t\t\t\treturn ref.storage.get(key, defaultValue);\n\t\t\t\t}\n\n\t\t\t\tvar query = 'SELECT * FROM ' + TABLE + ' WHERE key = ? LIMIT 1';\n\t\t\t\treturn sql(db, query, [ prefix + key ]).then(function(results) {\n\t\t\t\t\tvar rows = results.rows;\n\t\t\t\t\treturn rows.length ? JSON.parse(rows.item(0).value) : defaultValue;\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Stores a value with the given key. If value equals null or undefined then stored value is removed instead.\n\t\t *\n\t\t * Note: This should not be considered to be reliable let alone secure, always provide fallbacks.\n\t\t *\n\t\t * @param {string} key\n\t\t * @param {mixed} value\n\t\t * @returns {Promise} Promise\n\t\t */\n\t\tset(key, value) {\n\t\t\t// Remove instead of setting null/undefined so as to match behavior of Storage class\n\t\t\tif (value === null || value === undefined) {\n\t\t\t\treturn this.remove(key);\n\t\t\t}\n\n\t\t\tvar prefix = this.prefix;\n\n\t\t\treturn this.ready.then(function(ref) {\n\t\t\t\tvar db = ref.db;\n\t\t\t\tif (!db) {\n\t\t\t\t\treturn ref.storage.set(key, value, function(error) {\n\t\t\t\t\t\tthrow new Error('Quota error: ' + error.name);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tvar query = 'INSERT OR REPLACE INTO ' + TABLE + ' (key, value) VALUES (?, ?)';\n\t\t\t\treturn sql(db, query, [ prefix + key, JSON.stringify(value) ]);\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Removes a key\n\t\t *\n\t\t * @param {string} key\n\t\t * @returns {Promise} Promise\n\t\t */\n\t\tremove(key) {\n\t\t\tvar prefix = this.prefix;\n\n\t\t\treturn this.ready.then(function(ref) {\n\t\t\t\tvar db = ref.db;\n\t\t\t\tif (!db) {\n\t\t\t\t\treturn ref.storage.remove(key);\n\t\t\t\t}\n\n\t\t\t\treturn sql(db, 'DELETE FROM ' + TABLE + ' WHERE key = ?', [ prefix + key ]);\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Removes all items with this instance's prefix.\n\t\t *\n\t\t * @returns {Promise} Promise\n\t\t */\n\t\tclear() {\n\t\t\tvar prefix = this.prefix;\n\n\t\t\treturn this.ready.then(function(ref) {\n\t\t\t\tvar db = ref.db;\n\t\t\t\tif (!db) {\n\t\t\t\t\treturn ref.storage.clear();\n\t\t\t\t}\n\n\t\t\t\t// Would be prettier to use ? instead of directly injecting prefix here, but don't know how\n\t\t\t\treturn sql(db, 'DELETE FROM ' + TABLE + ' WHERE key LIKE \"' + prefix + '%\"');\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Returns a sub storage instance with combined prefixes.\n\t\t *\n\t\t * @param {string} subPrefix\n\t\t * @returns {playtotv.storage.AsyncStorage} storage\n\t\t */\n\t\tsubStorage(subPrefix) {\n\t\t\treturn new this.constructor(this.prefix + subPrefix);\n\t\t}\n\n\t\t/**\n\t\t * Debug method for directly executing a query on Web SQL database.\n\n\t\t * @param {string} query\n\t\t * @param {Array} args\n\t\t * @returns {Promise} Promise\n\t\t */\n\t\tsql(query, args) {\n\t\t\treturn this.ready.then(function(ref) {\n\t\t\t\treturn sql(ref.db, query, args);\n\t\t\t});\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.storage.MockAsyncStorage', [\n\t'playtotv.storage.AsyncStorage',\n\t'playtotv.storage.MockStorage',\n\t'playtotv.storage.Storage'\n], function(\n\tAsyncStorage,\n\tMockStorage,\n\tStorage\n) {\n\n\t'use strict';\n\n\treturn class MockAsyncStorage extends AsyncStorage {\n\t\tconstructor(prefix) {\n\t\t\tsuper(prefix);\n\n\t\t\tthis.ready = Promise.resolve({ storage: new Storage(new MockStorage(), prefix) });\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.server.Server', [\n\t'playtotv.server.gatekeeperAPI',\n\t'playtotv.model.ObjectModel',\n\t'playtotv.net.request',\n\t'playtotv.storage.Storage'\n], function(\n\tgatekeeperAPI,\n\tObjectModel,\n\trequest,\n\tStorage\n) {\n\n\t'use strict';\n\n\t// TODO: Once playtotv.net.request() returns Promise.Cancellable have this also deal properly with cancellation\n\t// TODO: Cache service URL(s) (for a limited amount of time) to enable fast resume\n\t// TODO: replace onRetry callback option, resolveTaps and rejectTaps by publish-ing (and publish responseTime?)\n\t// TODO: Cleanup gatekeeper code (e.g: getServiceUrls, request, ..)\n\n\t////////// Private variables\n\n\tvar ptv = playtotv;\n\tvar REQUIRED = ptv.REQUIRED;\n\tvar util = ptv.util;\n\tvar log = ptv.Logger.get(this.id);\n\tvar event = ptv.event;\n\tvar gatekeeperInit = gatekeeperAPI.getInit;\n\n\t////////// Class declaration\n\n\t// Patch gatekeeperAPI.getInit method while this is not taken care of by server API generation\n\tgatekeeperInit.gatekeeper = true;\n\n\treturn class Server extends ObjectModel {\n\t\t/** @lends playtotv.server.Server.prototype */\n\n\t\t/**\n\t\t * PlayToTV Server Class, used to manage a client-server connection.\n\t\t *\n\t\t * This requests service urls from the gatekeeper server and then sends server requests to the first url.\n\t\t * When a server request times out, that service url is scratched and the request is retried using the next.\n\t\t * When no more service urls are available, the client will request new service urls from the gatekeeper.\n\t\t *\n\t\t * @extends playtotv.model.ObjectModel\n\t\t * @constructs\n\t\t * @param {Object} options\n\t\t * @param {string} [options.url=''] URL of gatekeeper server, will be prefixed with '//' protocol if necessary\n\t\t * @param {number} [options.badDelay=5000] Number of ms to delay status BAD by to prevent unnecessary warnings\n\t\t * @param {Function} [options.onRetry] Callback(url, reason) for monitoring when this class retries a request\n\t\t * @param {Object} [options.gatekeeperData] Gatekeeper data to use (rather then request it ourselves)\n\t\t * @param {number} [options.gatekeeperDataTime] Unix time at which gatekeeperData was received\n\t\t *\n\t\t * @property {playtotv.model.ObjectModel} urls Subscribable: Map of service types to their current urls\n\t\t * @property {string} status Subscribable: Current server connection status: GOOD, BAD or BUSY\n\t\t * @property {number} timeOffset Subscribable: Client to server time offset in ms (add to server time)\n\t\t * @property {Object} clientMinimalVersion Subscribable: Client minimal version values returned by gatekeeper\n\t\t */\n\t\tconstructor(options) {\n\t\t\tsuper({\n\t\t\t\turls: new ObjectModel({}),\n\t\t\t\tstatus: undefined,\n\t\t\t\ttimeOffset: undefined,\n\t\t\t\tclientMinimalVersion: {}\n\t\t\t});\n\n\t\t\t// TODO: extend options or add extra arguments for initializing with other settings, retryDelay etc.\n\t\t\toptions = ptv.params(options, {\n\t\t\t\turl: '',\n\t\t\t\tbadDelay: 5000,\n\t\t\t\tonRetry: function(url, reason) {\n\t\t\t\t\tlog.d('Retry: ' + url + ' (' + reason + ')');\n\t\t\t\t},\n\t\t\t\tgatekeeperData: undefined,\n\t\t\t\tgatekeeperDataTime: undefined\n\t\t\t});\n\n\t\t\t// If it looks like a hostname without a protocol prefix then prefix with //.\n\t\t\t// If it does not look like a hostname it is probably a relative path.\n\t\t\tvar url = options.url;\n\t\t\tif (url.length > 0 && /^localhost|.+\\..+/.test(url) && url.indexOf('//') === -1) {\n\t\t\t\turl = '//' + url;\n\t\t\t}\n\n\t\t\t////////// Undocumented properties\n\n\t\t\tthis.badDelay = options.badDelay;\n\t\t\tthis.onRetry = options.onRetry;\n\t\t\tthis.serverUrl = url;\n\t\t\tthis.serviceUrls = {};\n\t\t\tthis.urlPromises = {};\n\t\t\tthis.gatekeeperUrl = this.getGatekeeperServiceUrl(gatekeeperInit.service || 'API') + gatekeeperInit.url;\n\t\t\tthis.gatekeeperData = options.gatekeeperData;\n\t\t\tthis.gatekeeperDataTime = options.gatekeeperDataTime;\n\n\t\t\t////////// Documented properties\n\n\t\t\t/**\n\t\t\t * Default {@link playtotv.net.request} settings:\n\t\t\t * { cache: false, dataType: 'json' timeout: 20000, headers: {}, urlParams: {} }\n\t\t\t *\n\t\t\t * @type Object\n\t\t\t */\n\t\t\tthis.settings = {\n\t\t\t\tcache: false,\n\t\t\t\tdataType: 'json',\n\t\t\t\ttimeout: 20000,\n\t\t\t\theaders: {},\n\t\t\t\turlParams: {}\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * Time in ms to delay before retrying a request that fails due to a lack of connection or unavailability\n\t\t\t * of servers.\n\t\t\t *\n\t\t\t * @type number\n\t\t\t * @default 5000\n\t\t\t */\n\t\t\tthis.retryDelay = 5000;\n\n\t\t\t/**\n\t\t\t * Array of callbacks to call upon each request resolve.\n\t\t\t * Callbacks will be called with the API method object as 'this' and resolve data object as argument.\n\t\t\t *\n\t\t\t * @type [Function]\n\t\t\t */\n\t\t\tthis.resolveTaps = [];\n\n\t\t\t/**\n\t\t\t * Array of callbacks to call upon each request reject.\n\t\t\t * Callbacks will be called with the API method object as 'this' and reject reason object as argument.\n\t\t\t *\n\t\t\t * @type [Function]\n\t\t\t */\n\t\t\tthis.rejectTaps = [];\n\n\t\t\t/**\n\t\t\t * Storage instance prefixed with server URL.\n\t\t\t *\n\t\t\t * @type {playtotv.storage.Storage}\n\t\t\t */\n\t\t\tthis.storage = new Storage(window.localStorage, url + '/');\n\n\t\t\tevent.addListener(window, 'offline', function() {\n\t\t\t\tlog.d('Event: offline');\n\t\t\t\t// Improve speed of feedback by immediately changing to BAD without waiting for timeout.\n\t\t\t\tthis.setStatus('BAD');\n\t\t\t}.bind(this));\n\n\t\t\tevent.addListener(window, 'online', function() {\n\t\t\t\tlog.d('Event: online');\n\t\t\t\t// Experiments with immediate request retries here resulted in status 0 and thus worse recovery speed.\n\t\t\t\t// So instead of adding complexity here, I simply fake immediate recovery by changing status to GOOD.\n\t\t\t\t// In case things are not GOOD after all, this will change back to BAD upon the next request issue.\n\t\t\t\tthis.setStatus('GOOD');\n\t\t\t}.bind(this));\n\n\t\t\tthis.setStatus = (function() {\n\t\t\t\t// Try not to bother users with BAD connection warnings unnecessarily by delaying that status.\n\t\t\t\t// But do not delay other statuses (GOOD and BUSY) since we want to confirm those as quick as possible.\n\t\t\t\tvar badPending = false;\n\n\t\t\t\tfunction checkBad() {\n\t\t\t\t\tif (badPending) {\n\t\t\t\t\t\tbadPending.changeProperty('status', 'BAD');\n\t\t\t\t\t\tbadPending = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn function(status) {\n\t\t\t\t\tif (status === 'BAD') {\n\t\t\t\t\t\tif (!badPending) {\n\t\t\t\t\t\t\tbadPending = this;\n\t\t\t\t\t\t\tsetTimeout(checkBad, this.badDelay);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbadPending = false;\n\t\t\t\t\t\tthis.changeProperty('status', status);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}());\n\n\t\t\tthis._getServiceUrls = this._getServiceUrls.bind(this);\n\n\t\t\t/**\n\t\t\t * Get service URLs from server.\n\t\t\t *\n\t\t\t * Has the side effect that status, timeOffset and clientMinimalVersion properties are updated.\n\t\t\t *\n\t\t\t * This is throttled (2s) to prevent too many or parallel requests.\n\t\t\t *\n\t\t\t * @function\n\t\t\t * @returns {Promise} Promise of service URL map object\n\t\t\t */\n\t\t\tthis.getServiceUrls = Promise.throttle(this._getServiceUrls, 2000);\n\n\t\t\t// Immediately start by fetching service urls\n\t\t\t// Go straight for API for now since that will immediately define this.urlPromises.API and prevent another\n\t\t\t// call to getServiceUrls from any subsequent requests. And since API is the only service we really use :P\n\t\t\tthis.getServiceUrl('API');\n\t\t}\n\n\t\t////////// Undocumented methods\n\n\t\turlKeys(url) {\n\t\t\tvar placeholders = url.match(/\\{(\\w+)\\}/g) || [];\n\t\t\treturn placeholders.map(function(placeholder) {\n\t\t\t\treturn placeholder.substr(1, placeholder.length - 2);\n\t\t\t});\n\t\t}\n\n\t\tvalidateCall(method, params, urlKeys) {\n\t\t\turlKeys = urlKeys || this.urlKeys(method.url);\n\n\t\t\tvar label = method.label;\n\t\t\tvar dataKeys = method.dataKeys;\n\t\t\tvar keys = Object.keys(params || {});\n\n\t\t\tvar validKeys = urlKeys.concat(method.queryKeys).concat(dataKeys);\n\t\t\tvar invalidKeys = [];\n\t\t\tkeys.forEach(function(key) {\n\t\t\t\tif (validKeys.indexOf(key) === -1) {\n\t\t\t\t\tinvalidKeys.push(key);\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (invalidKeys.length > 0) {\n\t\t\t\tthrow new Error(label + ': invalid parameters: ' + invalidKeys.join(', '));\n\t\t\t}\n\n\t\t\t// URL (a.k.a: path) and data keys are required, query keys are optional\n\t\t\tvar requiredKeys = urlKeys.concat(dataKeys);\n\t\t\tvar undefinedKeys = [];\n\t\t\trequiredKeys.forEach(function(key) {\n\t\t\t\tif (params[key] === undefined) {\n\t\t\t\t\tundefinedKeys.push(key);\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (undefinedKeys.length > 0) {\n\t\t\t\tthrow new Error(label + ': required parameters are undefined: ' + undefinedKeys.join(', '));\n\t\t\t}\n\t\t}\n\n\t\t_getServiceUrls() {\n\t\t\t// Use externally provided gatekeeper response data if available, otherwise call/request it ourselves\n\t\t\tvar gatekeeperData = this.gatekeeperData;\n\t\t\tvar gatekeeperDataTime = this.gatekeeperDataTime;\n\t\t\tvar dataPromise;\n\t\t\tif (gatekeeperData && gatekeeperDataTime) {\n\t\t\t\t// Compensate for time that has passed since receiving gatekeeperData\n\t\t\t\tgatekeeperData.serverTime += Date.now() - gatekeeperDataTime;\n\t\t\t\tdataPromise = Promise.resolve(gatekeeperData);\n\t\t\t\tdelete this.gatekeeperData;\n\t\t\t\tdelete this.gatekeeperDataTime;\n\t\t\t} else {\n\t\t\t\tdataPromise = this.call(gatekeeperInit);\n\t\t\t}\n\n\t\t\treturn dataPromise.then(function(data) {\n\t\t\t\t// If status is undefined assume it's AVAILABLE (for same origin CF cached init)\n\t\t\t\tif (!data.status || data.status === 'AVAILABLE') {\n\t\t\t\t\tthis.setStatus('GOOD');\n\t\t\t\t} else {\n\t\t\t\t\tthis.setStatus('BUSY');\n\t\t\t\t\tthis.onRetry(this.gatekeeperUrl, 'busy-' + data.status.toLowerCase());\n\t\t\t\t\treturn Promise.delay(this.retryDelay).then(this._getServiceUrls);\n\t\t\t\t}\n\n\t\t\t\tthis.changeProperty('timeOffset', Date.now() - data.serverTime);\n\t\t\t\tthis.changeProperty('clientMinimalVersion', data.clientMinimalVersion);\n\n\t\t\t\treturn data.services.reduce(function(map, service) {\n\t\t\t\t\t// Randomly shuffle service urls to evenly distribute client load\n\t\t\t\t\tmap[service.serviceType] = ptv.shuffle(\n\t\t\t\t\t\tservice.serviceUrls.map(function(url) {\n\t\t\t\t\t\t\t// Strip API version (belongs to method descriptors, not service urls)\n\t\t\t\t\t\t\treturn url.replace(/\\d+\\/$/, '');\n\t\t\t\t\t\t})\n\t\t\t\t\t);\n\t\t\t\t\treturn map;\n\t\t\t\t}.bind(this), {});\n\t\t\t}.bind(this), function(reason) {\n\t\t\t\t// We should only end up here if error is considered unrecoverable by this.call/request() (e.g. 404)\n\t\t\t\t// However, we still want to keep retry-ing gatekeeper in such cases to allow for auto recovery\n\t\t\t\t// Because sometimes servers being restarted etc. (e.g. during up/down-scale) will return such errors\n\t\t\t\tlog.i('getServiceUrls: retry: ' + reason.status);\n\t\t\t\tthis.setStatus('BAD');\n\t\t\t\tthis.onRetry(this.gatekeeperUrl, 'status-' + reason.status);\n\t\t\t\treturn Promise.delay(this.retryDelay).then(this._getServiceUrls);\n\t\t\t}.bind(this));\n\t\t}\n\n\t\tgetGatekeeperServiceUrl(service) {\n\t\t\treturn this.serverUrl + '/' + service.toLowerCase() + '/';\n\t\t}\n\n\t\tgetServiceUrl(service) {\n\t\t\tvar urlPromises = this.urlPromises;\n\t\t\tif (!urlPromises[service]) {\n\t\t\t\tvar serviceUrls = this.serviceUrls;\n\t\t\t\tvar myServiceUrls = serviceUrls[service] || [];\n\t\t\t\tif (myServiceUrls.length > 0) {\n\t\t\t\t\t// Just pop next url of the stack\n\t\t\t\t\turlPromises[service] = Promise.resolve(myServiceUrls.shift());\n\t\t\t\t} else {\n\t\t\t\t\t// Get new service urls\n\t\t\t\t\turlPromises[service] = this.getServiceUrls().then(function(newServiceUrls) {\n\t\t\t\t\t\t// Store service urls for all services; could save on making another request later\n\t\t\t\t\t\t// Override any previously fetched urls since some of those might be deprecated\n\t\t\t\t\t\tptv.each(newServiceUrls, function(urls, urlsService) {\n\t\t\t\t\t\t\tserviceUrls[urlsService] = urls;\n\t\t\t\t\t\t});\n\t\t\t\t\t\tvar myNewServiceUrls = newServiceUrls[service] || [];\n\t\t\t\t\t\tif (myNewServiceUrls.length === 0) {\n\t\t\t\t\t\t\t// Default to gatekeeper service url (e.g. single node cluster)\n\t\t\t\t\t\t\treturn this.getGatekeeperServiceUrl(service);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Return first service url (and remember the rest)\n\t\t\t\t\t\t\treturn serviceUrls[service].shift();\n\t\t\t\t\t\t}\n\t\t\t\t\t}.bind(this));\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn urlPromises[service];\n\t\t}\n\n\t\tinvalidateServiceUrl(service, promise) {\n\t\t\tvar urlPromises = this.urlPromises;\n\t\t\tif (urlPromises[service] === promise) { // only invalidate if the promise has not changed already\n\t\t\t\turlPromises[service] = null;\n\t\t\t}\n\t\t}\n\n\t\trequest(url, settings, retry) {\n\t\t\t// Default to simply retry-ing with same url and settings\n\t\t\tretry = retry || function() {\n\t\t\t\treturn this.request(url, settings, retry);\n\t\t\t}.bind(this);\n\n\t\t\tvar currentSettings = Object.assign({}, this.settings, settings);\n\n\t\t\treturn request(url, currentSettings).then(function(data) {\n\t\t\t\t// Prevent unnecessary status change on successful gatekeeperInit\n\t\t\t\tif (settings.label === gatekeeperInit.label && data.status && data.status !== 'AVAILABLE') {\n\t\t\t\t\treturn data;\n\t\t\t\t}\n\t\t\t\tthis.setStatus('GOOD');\n\t\t\t\treturn data;\n\t\t\t}.bind(this), function(reason) {\n\t\t\t\tvar status = reason.status;\n\t\t\t\t// TODO: Add setting option to retry after a delay (true=>always, callback=>if true)?\n\t\t\t\t// Retry requests that were most likely rejected without delay after a minimum delay\n\t\t\t\tif (status === 0 || status === 'no-xhr-proxy' || (status > 12000 && status < 13000)) { // IE uses 12xxx\n\t\t\t\t\tthis.onRetry(url, 'status-' + status);\n\t\t\t\t\t// TODO: Double check that status 0 does not lead to false positive BAD statusses\n\t\t\t\t\t// TODO: Only look at gatekeeper requests and offline events for BAD?\n\t\t\t\t\tthis.setStatus('BAD');\n\t\t\t\t\treturn Promise.delay(this.retryDelay).then(retry);\n\t\t\t\t// Retry temporary server error after a delay\n\t\t\t\t} else if (status === 503) {\n\t\t\t\t\tthis.onRetry(url, 'status-' + status);\n\t\t\t\t\treturn Promise.delay(this.retryDelay).then(retry);\n\t\t\t\t// Retry requests that rejected after waiting for timeout straight away\n\t\t\t\t} else if (status === 'timeout') {\n\t\t\t\t\tthis.onRetry(url, 'timeout');\n\t\t\t\t\tthis.setStatus('BAD');\n\t\t\t\t\treturn retry();\n\t\t\t\t// Unrecoverable\n\t\t\t\t} else {\n\t\t\t\t\t// TODO: Facilitate retry-ing from rejection handlers (reason.retry = retry)?\n\t\t\t\t\treturn Promise.reject(reason);\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t}\n\n\t\tgetUrlAndRequest(serviceType, methodUrl, settings) {\n\t\t\tvar urlPromise = this.getServiceUrl(serviceType);\n\t\t\treturn urlPromise.then(function(serviceUrl) {\n\t\t\t\tthis.urls.setProperty(serviceType, serviceUrl);\n\t\t\t\treturn this.request(serviceUrl + methodUrl, settings, function retry() {\n\t\t\t\t\tthis.invalidateServiceUrl(serviceType, urlPromise);\n\t\t\t\t\treturn this.getUrlAndRequest(serviceType, methodUrl, settings);\n\t\t\t\t}.bind(this));\n\t\t\t}.bind(this));\n\t\t}\n\n\t\ttap(method, requestPromise) {\n\t\t\trequestPromise.then(function(data) {\n\t\t\t\tthis.resolveTaps.forEach(function(tap) {\n\t\t\t\t\ttap.call(method, data);\n\t\t\t\t});\n\t\t\t}.bind(this), function(reason) {\n\t\t\t\tthis.rejectTaps.forEach(function(tap) {\n\t\t\t\t\ttap.call(method, reason);\n\t\t\t\t});\n\t\t\t}.bind(this));\n\n\t\t\treturn requestPromise;\n\t\t}\n\n\t\t////////// Documented methods\n\n\t\t/**\n\t\t * Call specified method on this server with optional method parameters and request settings.\n\t\t *\n\t\t * TODO: Add abort() function to returned promise for aborting this call.\n\t\t *\n\t\t * @example\n\t\t *\n\t\t *var server = new Server({ host: demo-backend.playtotv.com });\n\t\t *\n\t\t *var testAPI = {\n\t\t *\tcreateA: {\n\t\t *\t\tlabel: 'test.createA',\n\t\t *\t\ttype: 'POST',\n\t\t *\t\turl: 'test/a',\n\t\t *\t\tdataKeys: [ 'x', 'y' ]\n\t\t *\t},\n\t\t *\treadA: {\n\t\t *\t\tlabel: 'test.readA',\n\t\t *\t\turl: 'test/a/{id}'\n\t\t *\t},\n\t\t *\tupdateA: {\n\t\t *\t\tlabel: 'test.updateA',\n\t\t *\t\ttype: 'PUT',\n\t\t *\t\turl: 'test/a/{id}',\n\t\t *\t\tdataKeys: [ 'x', 'y' ]\n\t\t *\t},\n\t\t *\tdeleteA: {\n\t\t *\t\tlabel: 'test.deleteA',\n\t\t *\t\ttype: 'DELETE',\n\t\t *\t\turl: 'test/a/{id}'\n\t\t *\t},\n\t\t *};\n\t\t *\n\t\t *server.call(testAPI.createA, { x: 'foo', y: 'bar' }).then(function(a) {\n\t\t *\t// created a\n\t\t *\treturn server.call(testAPI.deleteA, { id: a.id }, { timeout: -1 });\n\t\t *}).catch(function(reason) {\n\t\t *\t// reason.label can be either 'test.createA' or 'test.deleteA'\n\t\t *\t// response status and data are returned as reason.status and reason.data\n\t\t *});\n\t\t *\n\t\t * @param {Object} method Definition of server method to call\n\t\t * @param {string} [method.label] Request label to be used to identify this request\n\t\t * @param {string} [method.service='API'] Service type\n\t\t * @param {boolean} [method.gatekeeper=false] Request directly from gatekeeper server\n\t\t * @param {string} [method.type='GET'] Request type (GET/POST/PUT/DELETE)\n\t\t * @param {string} method.url Request URL including path variables\n\t\t * @param {Array} [method.queryKeys=[]] Array of request query parameter keys\n\t\t * @param {Array} [method.dataKeys=[]] Array of request data parameter keys\n\t\t * @param {Object} [params] Parameters to pass to method\n\t\t * @param {Object} [settings] Extra settings/overrides to apply to {@link playtotv.net.request}\n\t\t * @return {Promise} Promise of server response to method call\n\t\t */\n\t\tcall(method, params, settings) {\n\t\t\tptv.params(method, {\n\t\t\t\tlabel: undefined,\n\t\t\t\tservice: 'API',\n\t\t\t\tgatekeeper: false,\n\t\t\t\ttype: 'GET',\n\t\t\t\turl: REQUIRED,\n\t\t\t\tqueryKeys: [],\n\t\t\t\tdataKeys: []\n\t\t\t});\n\t\t\tparams = params || {};\n\t\t\tsettings = Object.assign({\n\t\t\t\tlabel: method.label,\n\t\t\t\ttype: method.type\n\t\t\t}, settings);\n\n\t\t\tvar methodUrl = method.url;\n\t\t\tvar urlKeys = this.urlKeys(methodUrl);\n\n\t\t\tthis.validateCall(method, params, urlKeys);\n\n\t\t\turlKeys.forEach(function(key) {\n\t\t\t\tmethodUrl = methodUrl.replace('{' + key + '}', encodeURIComponent(params[key]));\n\t\t\t});\n\n\t\t\tmethod.queryKeys.forEach(function(key) {\n\t\t\t\tif (params[key] !== undefined) {\n\t\t\t\t\tmethodUrl = util.addURLParam(methodUrl, key, params[key]);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tvar dataKeys = method.dataKeys;\n\t\t\tif (dataKeys.length > 0) {\n\t\t\t\tsettings.data = {};\n\t\t\t\tdataKeys.forEach(function(key) {\n\t\t\t\t\tsettings.data[key] = params[key];\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tvar methodService = method.service;\n\t\t\tif (method.gatekeeper) {\n\t\t\t\tvar gatekeeperMethodUrl = this.getGatekeeperServiceUrl(methodService) + methodUrl;\n\t\t\t\treturn this.tap(method, this.request(gatekeeperMethodUrl, settings));\n\t\t\t} else {\n\t\t\t\treturn this.tap(method, this.getUrlAndRequest(methodService, methodUrl, settings));\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Converts a server time into a local client time by adding the server time offset.\n\t\t *\n\t\t * @param {number} serverTime Server time in ms since Unix time epoch\n\t\t * @return {number} Client time in ms since Unix time epoch\n\t\t */\n\t\ttoClientTime(serverTime) {\n\t\t\treturn serverTime + this.timeOffset;\n\t\t}\n\n\t\t/**\n\t\t * Converts a local client time into a server time by subtracting the server time offset.\n\t\t *\n\t\t * @param {number} [clientTime=Date.now()] Client time in ms since Unix time epoch\n\t\t * @return {number} Server time in ms since Unix time epoch\n\t\t */\n\t\ttoServerTime(clientTime) {\n\t\t\tclientTime = clientTime || Date.now();\n\t\t\treturn clientTime - this.timeOffset;\n\t\t}\n\n\t\t/**\n\t\t * Shortcut to make a server call and log the resolve/reject value.\n\t\t *\n\t\t * @param {Object} method {@link playtotv.server.Server#call} method\n\t\t * @param {Object} [params] {@link playtotv.server.Server#call} params\n\t\t * @param {Object} [settings] {@link playtotv.server.Server#call} settings\n\t\t * @param {string} [level='DEBUG'] {@link playtotv.Logger} level\n\t\t * @return {Promise} {@link playtotv.server.Server#call} promise\n\t\t */\n\t\tlog(method, params, settings, level) {\n\t\t\tvar promise = this.call(method, params, settings);\n\t\t\tlog.log(level || 'DEBUG', [ method.label, params, promise ]);\n\t\t\treturn promise;\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.server.ServerController', [\n\t'playtotv.mvc.Controller',\n\t'playtotv.server.Server'\n], function(\n\tController,\n\tServer\n) {\n\n\t// TODO: Merge Server into this\n\t// TODO: JSDoc\n\n\t'use strict';\n\n\tvar callAsyncCounter = 0;\n\n\treturn class ServerController extends Controller {\n\t\tconstructor(context, options) {\n\t\t\tsuper(context);\n\n\t\t\tvar server = this.getServer(options);\n\n\t\t\t// Proxy to Server\n\t\t\tvar properties = [ 'status', 'timeOffset', 'clientMinimalVersion' ];\n\t\t\tproperties.forEach(key => {\n\t\t\t\tserver.subscribe('change:' + key, value => this.set(key, value));\n\t\t\t});\n\t\t\tserver.urls.subscribe('*:API', url => this.set('url', url));\n\n\t\t\tvar methods = [ 'call', 'toClientTime', 'toServerTime', 'log' ];\n\t\t\tmethods.forEach(name => {\n\t\t\t\tthis[name] = server[name].bind(server);\n\t\t\t\tthis.addMethod(name);\n\t\t\t});\n\n\t\t\tthis.rejectTaps = server.rejectTaps;\n\n\t\t\tthis.addMethods([\n\t\t\t\t'addRejectTap',\n\t\t\t\t'callAsync'\n\t\t\t]);\n\n\t\t\t// Work with push controller to support slow async calls\n\t\t\tthis.asyncCalls = [];\n\t\t\tcontext.scope.subscribe('push.ASYNC-RESPONSE', this.onAsyncResponse.bind(this));\n\t\t}\n\n\t\tgetServer(options) {\n\t\t\treturn new Server(options);\n\t\t}\n\n\t\taddRejectTap(tapFn, filterFn) {\n\t\t\tfilterFn = filterFn || function() { return true; };\n\t\t\tthis.rejectTaps.push(function(error) {\n\t\t\t\tvar method = this;\n\t\t\t\tif (filterFn(error, method)) {\n\t\t\t\t\ttapFn(error, method);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// Use this instead of call() to get server to send response back later through a push event\n\t\t// This is useful in case server might take longer then timeout (20s) to respond\n\t\t// Also alleviates server load when responses are likely to be slow in general\n\t\tcallAsync(method, params, settings) {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t// Note: callId is passed as a query param so it has to be a string\n\t\t\t\tvar callId = '' + (++callAsyncCounter);\n\n\t\t\t\tthis.call(method, params, Object.assign({}, settings, {\n\t\t\t\t\turlParams: { callId: callId }\n\t\t\t\t})).catch(reject);\n\n\t\t\t\t// TODO: Retry after async response event timeout in case we miss the event somehow?\n\t\t\t\t// Since this will be particularly used for potentially slow calls, I will leave this for now\n\n\t\t\t\tthis.asyncCalls.push({\n\t\t\t\t\tcallId: callId,\n\t\t\t\t\tlabel: method.label,\n\t\t\t\t\tresolve: resolve,\n\t\t\t\t\treject: reject\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tonAsyncResponse(event) {\n\t\t\tvar payload = event.payload;\n\t\t\tvar callId = payload.callId;\n\n\t\t\tvar asyncCalls = this.asyncCalls;\n\t\t\tvar call = asyncCalls.find(call => call.callId === callId);\n\t\t\tif (!call) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tasyncCalls.splice(asyncCalls.indexOf(call), 1);\n\n\t\t\tvar status = payload.responseStatus;\n\t\t\tvar data = payload.responseBody;\n\t\t\tif ((status >= 200 && status < 300) || status === 304) {\n\t\t\t\tcall.resolve(data);\n\t\t\t} else {\n\t\t\t\tvar error = new Error('Async call ' + call.label + ' failed with status ' + status);\n\t\t\t\tcall.reject(Object.assign(error, {\n\t\t\t\t\tlabel: call.label,\n\t\t\t\t\tstatus: status,\n\t\t\t\t\txhr: null,\n\t\t\t\t\tdata: data\n\t\t\t\t}));\n\t\t\t}\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.server.MockServer', [\n\t'playtotv.server.gatekeeperAPI',\n\t'playtotv.server.Server',\n\t'playtotv.net.request'\n], function(\n\tgatekeeperAPI,\n\tServer,\n\trequest\n) {\n\n\t'use strict';\n\n\treturn class MockServer extends Server {\n\t\t/** @lends playtotv.server.MockServer.prototype */\n\n\t\t/**\n\t\t * PlayToTV MockServer Class, for mocking server calls.\n\t\t *\n\t\t * Calls will be handled by specified mocks if defined.\n\t\t * If a mock is a function then this will be called with the call arguments and returned as a Promise.\n\t\t * Else a Promise resolved with the mock value will be returned.\n\t\t *\n\t\t * If a string Promise would be returned, the call will recurse using that string as method label instead.\n\t\t *\n\t\t * If no mock is defined a request will be made for JSON file: \"<base>/<label>.json\".\n\t\t * Then if a render function is specified (e.g. {@link playtotv.mustache.render}) the JSON file content is\n\t\t * rendered as a template using the method params as view data before it is parsed as JSON, e.g:\n\t\t * <code>\"pollId\" : \"{{pollId}}\"</code>\n\t\t *\n\t\t * If the JSON request is rejected then the specified default resolve/reject value Promise will be returned.\n\t\t *\n\t\t * A default function is provided for the mock gatekeeper call (gatekeeperAPI.getInit).\n\t\t *\n\t\t * @extends playtotv.server.Server\n\t\t * @constructs\n\t\t * @param {Object} [options]\n\t\t * @param {Object} [options.mocks={}] Map of method labels to mock functions or value promises\n\t\t * @param {string} [options.base='mock'] Base URL to fetch JSON files with mock responses from\n\t\t * @param {Promise|mixed} [options.value={isDefaultValue: true}] Default Promise or resolve value\n\t\t * @param {Function} [render=null] Function for rendering response template file to JSON\n\t\t */\n\t\tconstructor(options) {\n\t\t\toptions = playtotv.params(options, {\n\t\t\t\tmocks: {},\n\t\t\t\tbase: 'mock',\n\t\t\t\tvalue: { // this default resolve value can facilitate some simple requests\n\t\t\t\t\tisDefaultValue: true\n\t\t\t\t},\n\t\t\t\trender: null\n\t\t\t});\n\n\t\t\tsuper();\n\n\t\t\tvar mockMap = this.mockMap = options.mocks;\n\t\t\tthis.baseUrl = options.base;\n\t\t\tthis.defaultValue = options.value;\n\t\t\tthis.render = options.render;\n\n\t\t\t// Some default mock functions\n\t\t\tvar gatekeeperLabel = gatekeeperAPI.getInit.label;\n\t\t\tvar pushPollLabel = 'pushPoll.getEvents'; // See: playtotv.push.EventsPoller\n\t\t\tmockMap[gatekeeperLabel] = mockMap[gatekeeperLabel] || this.mockGatekeeper;\n\t\t\tmockMap[pushPollLabel] = mockMap[pushPollLabel] || this.mockPushPoll;\n\t\t}\n\n\t\t/**\n\t\t * Mocking override of {@link playtotv.server.Server#call}\n\t\t */\n\t\tcall(method, params, settings) {\n\t\t\tplaytotv.params(method, {\n\t\t\t\tlabel: undefined,\n\t\t\t\tservice: 'API',\n\t\t\t\tgatekeeper: false,\n\t\t\t\ttype: 'GET',\n\t\t\t\turl: playtotv.REQUIRED,\n\t\t\t\tqueryKeys: [],\n\t\t\t\tdataKeys: []\n\t\t\t});\n\t\t\tparams = params || {};\n\t\t\tsettings = Object.assign({\n\t\t\t\tlabel: method.label,\n\t\t\t\ttype: method.type\n\t\t\t}, settings);\n\n\t\t\tthis.validateCall(method, params);\n\n\t\t\tvar label = method.label || method.url.replace(/[\\{\\}]/g, '_') + (method.type ? '/' + method.type : '');\n\t\t\tvar mock = this.mockMap[label];\n\t\t\tif (mock) {\n\t\t\t\tif (mock instanceof Function) {\n\t\t\t\t\tmock = mock(method, params, settings);\n\t\t\t\t}\n\t\t\t\treturn this.tap(method, Promise.resolve(mock).then(function(value) {\n\t\t\t\t\treturn typeof value === 'string' ? this.call({ label: value }, params, settings) : value;\n\t\t\t\t}.bind(this)));\n\t\t\t}\n\n\t\t\tvar url = this.baseUrl + '/' + label + '.json';\n\t\t\tvar render = this.render;\n\t\t\treturn this.tap(method, request(url).then(function(template) {\n\t\t\t\tvar view = Object.assign({ method: method }, params);\n\t\t\t\tvar json = render ? render(template, view) : template;\n\t\t\t\treturn JSON.parse(json);\n\t\t\t}, function(/* reason */) {\n\t\t\t\treturn this.defaultValue;\n\t\t\t}.bind(this)));\n\t\t}\n\n\t\tmockGatekeeper() {\n\t\t\treturn {\n\t\t\t\tserverTime: Date.now(),\n\t\t\t\tstatus: 'AVAILABLE',\n\t\t\t\tservices: []\n\t\t\t};\n\t\t}\n\n\t\tmockPushPoll() {\n\t\t\t// Delay to prevent EventsPoller from going nuts\n\t\t\treturn Promise.delay(10000).then(function() {\n\t\t\t\treturn {\n\t\t\t\t\tstream: 'mock-stream',\n\t\t\t\t\tevents: []\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.server.MockServerController', [\n\t'playtotv.server.ServerController',\n\t'playtotv.server.MockServer'\n], function(\n\tServerController,\n\tMockServer\n) {\n\n\t// TODO: Merge MockServer into this\n\t// TODO: JSDoc\n\n\t'use strict';\n\n\treturn class MockServerController extends ServerController {\n\t\tgetServer(/*options*/) {\n\t\t\treturn this.server || (this.server = new MockServer());\n\t\t}\n\n\t\tcallAsync() {\n\t\t\treturn this.call.apply(this, arguments);\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.touch.Sequence', [\n\t'playtotv.css.Vector'\n], function(\n\tVector\n) {\n\n\t'use strict';\n\n\tvar _max = Math.max;\n\n\tvar SWIPE_DELAY = 300;\n\tvar SENSITIVITY = 20;\n\n\t/**\n\t * Follows a mouse or touch pointer from start to end, and is continuously updated with properties like the\n\t * current point, offset and velocity vector. Updated automatically by the {@link playtotv.touch.TouchProxy} that\n\t * created it, and passed along with 'em:touch[type]' events as 'sequence' property on the event's details.\n\t *\n\t * @name Sequence\n\t * @class\n\t * @memberOf playtotv.touch\n\t * @constructor\n\t * @param {Node} target\n\t * @param {Event|Touch} e\n\t */\n\treturn class Sequence {\n\t\tconstructor(target, e) {\n\t\t\tthis.target = target;\n\t\t\tthis.id = e.pointerId || e.identifier;\n\t\t\tthis.start = new Vector(e.clientX, e.clientY);\n\t\t\tthis.screen = new Vector(e.screenX, e.screenY);\n\t\t\tthis.point = this.start;\n\t\t\tthis.offset = Vector.ZERO;\n\t\t\tthis.velocity = Vector.ZERO;\n\t\t\tthis.time = Date.now();\n\n\t\t\tthis.isTap = true;\n\t\t}\n\n\t\t/** @lends playtotv.touch.Sequence.prototype */\n\n\t\t/**\n\t\t * Updates this sequence's point, offset and velocity vectors with the given native event or touch, and sets\n\t\t * the isTap boolean to false when the offset's magnitude exceeds tap sensitivity.\n\t\t *\n\t\t * @param {Event|Touch} e\n\t\t */\n\t\tupdate(e) {\n\t\t\tvar t = Date.now();\n\t\t\tvar c = new Vector(e.clientX, e.clientY);\n\t\t\tvar w = new Vector(e.screenX, e.screenY);\n\t\t\tvar s = this.start;\n\t\t\tvar p = this.point;\n\t\t\tvar ms = t - this.time;\n\t\t\tvar v = 1000 / _max(ms, 40); // TODO: average over multiple updates more accurate?\n\n\t\t\tthis.velocity = new Vector(\n\t\t\t\t(c.x - p.x) * v,\n\t\t\t\t(c.y - p.y) * v\n\t\t\t);\n\n\t\t\tthis.offset = new Vector(\n\t\t\t\tc.x - s.x,\n\t\t\t\tc.y - s.y\n\t\t\t);\n\n\t\t\tif (this.isTap && (this.offset.magnitude() > SENSITIVITY)) {\n\t\t\t\tdelete this.isTap;\n\t\t\t\tthis.isSwipe = setTimeout(() => this.clearSwipe(), SWIPE_DELAY);\n\t\t\t}\n\n\t\t\tthis.time = t;\n\t\t\tthis.point = c;\n\t\t\tthis.screen = w;\n\t\t}\n\n\t\t/**\n\t\t * Deletes the isSwipe property when swipe time has been exceeded. Used by the TouchProxy (in combination with\n\t\t * isTap) to determine whether a swipe event will be fired.\n\t\t */\n\t\tclearSwipe() {\n\t\t\tclearTimeout(this.isSwipe);\n\t\t\tdelete this.isSwipe;\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.touch.Tracker', [\n\t'playtotv.touch.Sequence'\n], function(Sequence) {\n\n\t'use strict';\n\n\tvar nativeMap = [].map;\n\n\t/**\n\t * Tracker\n\t *\n\t */\n\treturn class Tracker {\n\t\tconstructor() {\n\t\t\tthis.map = {};\n\t\t}\n\n\t\tadd(touches, target) {\n\t\t\treturn nativeMap.call(touches, function(touch) {\n\t\t\t\tvar id = touch.pointerId || touch.identifier;\n\t\t\t\tvar sequence = this.map[id] = new Sequence(target, touch);\n\t\t\t\treturn sequence;\n\t\t\t}, this);\n\t\t}\n\n\t\tupdate(touches) {\n\t\t\treturn nativeMap.call(touches, function(touch) {\n\t\t\t\tvar id = touch.pointerId || touch.identifier;\n\t\t\t\tvar item = this.map[id];\n\t\t\t\titem.update(touch);\n\t\t\t\treturn item;\n\t\t\t}, this);\n\t\t}\n\n\t\tremove(touches) {\n\t\t\treturn nativeMap.call(touches, function(touch) {\n\t\t\t\tvar id = touch.pointerId || touch.identifier;\n\t\t\t\tvar item = this.map[id];\n\t\t\t\tdelete this.map[id];\n\t\t\t\treturn item;\n\t\t\t}, this);\n\t\t}\n\n\t\ttoArray() {\n\t\t\tvar result = [];\n\t\t\tvar map = this.map;\n\t\t\tfor (var id in map) {\n\t\t\t\tif (map.hasOwnProperty(id)) {\n\t\t\t\t\tresult.push(map[id]);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\n\t\tempty() {\n\t\t\tvar map = this.map;\n\t\t\tfor (var id in map) {\n\t\t\t\tif (map.hasOwnProperty(id)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.touch.TouchProxy', [\n\t'playtotv.touch.Tracker'\n], function(\n\tTracker\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar event = ptv.event;\n\n\tvar inputReg = /input|textarea|select|option/i;\n\tvar CLICK_DELAY = 500;\n\n\tvar nativeTouch = 'ontouchstart' in window;\n\tvar nativePointers = 'onpointerdown' in window;\n\tvar maxPointers = navigator.maxTouchPoints || navigator.msMaxTouchPoints || 0;\n\n\t// determines whether triggering a click on touchend is needed at all\n\tfunction needsFastClick(node) {\n\t\t/*jshint maxcomplexity:20*/\n\n\t\t// only touch enabled devices may have a click delay\n\t\tif (!nativeTouch && (!nativePointers || (maxPointers === 0))) {\n\t\t\treturn false;\n\t\t}\n\n\t\tvar ua = navigator.userAgent;\n\t\tvar winMobile = /Windows Phone/.test(ua);\n\t\tvar iOs = /iP(hone|ad|od)/.test(ua) && !winMobile;\n\n\t\t// iOs never disables the 300ms delay due to double-tap scrolling\n\t\tif (iOs) {\n\t\t\treturn true;\n\t\t}\n\n\t\tvar android = /Android/.test(ua) && !winMobile;\n\t\tvar chrome = /Chrome\\/([0-9]+)/.test(ua);\n\t\tvar firefox = /Firefox\\/([0-9]+)/.test(ua);\n\n\t\t// chrome and firefox disable the 300ms delay when user scaling is disabled\n\t\tif ((chrome && android) || firefox) {\n\t\t\tvar viewMeta = $('meta[name=viewport]');\n\t\t\tif (viewMeta && /user-scalable=no/.test(viewMeta.content)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\t// IE disables the delay if touchAction is set to none or manipulation\n\t\tvar style = node.currentStyle || node.style;\n\t\tvar touchAction = style ? (style.touchAction || style.msTouchAction) : null;\n\t\tif (touchAction && /none|manipulation/.test(touchAction)) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// default fastclick to true on otherwise unknown touch-enabled devices\n\t\treturn true;\n\t}\n\n\t/**\n\t * Touch event proxy, fires custom em:touch[type] events by listening to native touch or mouse events, depending\n\t * on the device it is running on. Check {@link playtotv.touch.touchManager#captureEvents} on how to manage\n\t * TouchProxy instances and how to use the events fired by them.\n\t *\n\t * @name TouchProxy\n\t * @class\n\t * @memberOf playtotv.touch\n\t * @constructor\n\t */\n\treturn class TouchProxy {\n\n\t\tconstructor(node, options) {\n\t\t\toptions = ptv.params(options, {\n\t\t\t\tfastClick: true,\n\t\t\t\tpreventNative: true,\n\t\t\t\tpropagateNative: false\n\t\t\t});\n\n\t\t\tptv.bindMethods(this, [\n\t\t\t\t'touchStart',\n\t\t\t\t'touchMove',\n\t\t\t\t'touchEnd'\n\t\t\t]);\n\n\t\t\tthis.node = node;\n\t\t\tthis.fastClick = options.fastClick && needsFastClick(node);\n\t\t\tthis.preventNative = options.preventNative;\n\t\t\tthis.propagateNative = options.propagateNative;\n\n\t\t\tthis.startEvent = nativePointers ? 'pointerdown' : nativeTouch ? 'touchstart' : 'mousedown';\n\t\t\tthis.moveEvent = nativePointers ? 'pointermove' : nativeTouch ? 'touchmove' : 'mousemove';\n\t\t\tthis.endEvent = nativePointers ? 'pointerup' : nativeTouch ? 'touchend' : 'mouseup';\n\n\t\t\tthis.tracker = new Tracker();\n\n\t\t\tevent.addListener(node, this.startEvent, this.touchStart);\n\t\t}\n\n\t\t/** @lends playtotv.touch.TouchProxy.prototype */\n\n\t\t/**\n\t\t * Touchstart handler, fires a 'em:touchstart' event, and binds move and release event handlers for the rest of\n\t\t * the touch (or mouse) sequence.\n\t\t *\n\t\t * @param {Event} e\n\t\t */\n\t\ttouchStart(e) {\n\t\t\tvar target = e.target;\n\n\t\t\t// ignore touchstart on form elements; would make entering values impossible\n\t\t\t// TODO: enable as class options to include elements like video, object, etc\n\t\t\tif (inputReg.test(target.nodeName)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar changed = this.getChangedTouches(e);\n\t\t\tvar added = this.tracker.add(changed, target);\n\t\t\tvar prevent = false;\n\n\t\t\t// added.length is > 1 only if two pointers entered the same node in the same callstack, which is unlikely,\n\t\t\t// but possible. Separate native events are fired if the target differs. For unified behavior, custom\n\t\t\t// events are always fired separately.\n\t\t\tvar i, l = added.length;\n\t\t\tfor (i = 0; i < l; i++) {\n\t\t\t\tif (this.dispatchEvent('em:touchstart', added[i], e) === false) {\n\t\t\t\t\tprevent = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// stop native event behaviour for custom touch enabled elements if allowed and requested\n\t\t\tif (this.preventNative && prevent) {\n\t\t\t\te.preventDefault();\n\t\t\t}\n\n\t\t\t// stop propagation of native event unless explicitly allowed\n\t\t\tif (!this.propagateNative) {\n\t\t\t\te.stopPropagation();\n\t\t\t}\n\n\t\t\t// don't add more listeners when a second finger touches an already tracked node\n\t\t\tif (!this.tracking) {\n\t\t\t\tthis.bindEvents();\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Internal touchmove handler. Fires an 'em:touchmove' event for each individual moving pointer. Handlers that\n\t\t * wish to update the DOM with coordinates derived from this event should do so using interval based callbacks\n\t\t * like {@link playtotv.animationFrame} to minimize redraws.\n\t\t *\n\t\t * @param {Event} e\n\t\t */\n\t\ttouchMove(e) {\n\t\t\tvar changed = this.getChangedTouches(e);\n\t\t\tvar touches = this.tracker.update(changed);\n\t\t\tvar prevent = false;\n\n\t\t\t// The native touches.length is only > 1 if two or more pointers move within the same target. Separate\n\t\t\t// native events are fired otherwise. The custom events are always fired separately, because multi pointer\n\t\t\t// event handling is just as likely to be needed on complex dom fragments, in which case separate events\n\t\t\t// would natively be fired as well.\n\t\t\tvar i, l = touches.length;\n\t\t\tfor (i = 0; i < l; i++) {\n\t\t\t\tif (this.dispatchEvent('em:touchmove', touches[i], e) === false) {\n\t\t\t\t\tprevent = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.preventNative && prevent) {\n\t\t\t\te.preventDefault();\n\t\t\t}\n\n\t\t\tif (!this.propagateNative) {\n\t\t\t\te.stopPropagation();\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Checks the event sequence and fires a generic em:touchend event, followed by either an em:swipe, or a native\n\t\t * click event.\n\t\t *\n\t\t * @param {Event} e\n\t\t */\n\t\ttouchEnd(e) {\n\t\t\t/*jshint maxcomplexity:20*/\n\n\t\t\tvar changed = this.getChangedTouches(e);\n\t\t\tvar removed = this.tracker.remove(changed);\n\n\t\t\tvar preventNative = this.preventNative;\n\t\t\tvar prevent = false;\n\n\t\t\tvar touch, i, l = removed.length;\n\t\t\tfor (i = 0; i < l; i++) {\n\t\t\t\ttouch = removed[i];\n\n\t\t\t\t// default, always: fire em:touchend\n\t\t\t\tif (this.dispatchEvent('em:touchend', touch, e) === false) {\n\t\t\t\t\tprevent = true;\n\t\t\t\t}\n\n\t\t\t\t// trigger a faster click than a native one, which may be delayed for double-tap functionality on\n\t\t\t\t// various touch enabled devices. This delay can otherwise take up to 350ms, which is undesirable.\n\t\t\t\tif (touch.isTap && this.fastClick) {\n\n\t\t\t\t\tvar click = new event.MouseEvent('click', {\n\t\t\t\t\t\tbubbles: true,\n\t\t\t\t\t\tcancelable: true,\n\t\t\t\t\t\tclientX: touch.point.x,\n\t\t\t\t\t\tclientY: touch.point.y,\n\t\t\t\t\t\tscreenX: touch.screen.x,\n\t\t\t\t\t\tscreenY: touch.screen.y\n\t\t\t\t\t});\n\n\t\t\t\t\t// mark as custom for telling clicks apart\n\t\t\t\t\tclick.isFastClick = true;\n\n\t\t\t\t\ttouch.target.dispatchEvent(click);\n\n\t\t\t\t\t// Prevent any following native clicks if fired.\n\t\t\t\t\tthis.preventNextClick(touch.point);\n\t\t\t\t}\n\n\t\t\t\t// within swipe timeframe, trigger a swipe\n\t\t\t\tif (touch.isSwipe) {\n\t\t\t\t\tthis.dispatchEvent('em:swipe', touch, e);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (preventNative && prevent) {\n\t\t\t\te.preventDefault();\n\t\t\t}\n\n\t\t\tif (!this.propagateNative) {\n\t\t\t\te.stopPropagation();\n\t\t\t}\n\n\t\t\t// unbind only after all pointers/fingers left the node\n\t\t\tif (this.tracker.empty()) {\n\t\t\t\tthis.unbindEvents();\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Dispatches a touch event of the given type via event.dispatchEvent, automatically called by the proxy.\n\t\t * The event's detail property contains a reference to the proxy that dispatched it, the touch or mouse\n\t\t * sequence, and the native event from which it originated.\n\t\t *\n\t\t * @param {string} type\n\t\t * @param {playtotv.touch.Sequence} sequence\n\t\t * @param {Event} e\n\t\t */\n\t\tdispatchEvent(type, sequence, e) {\n\t\t\treturn event.dispatchEvent(sequence.target, type, true, true, {\n\t\t\t\tproxy: this,\n\t\t\t\tsequence: sequence,\n\t\t\t\tnativeEvent: e\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Binds move and end events\n\t\t * @private\n\t\t */\n\t\tbindEvents() {\n\t\t\tif (this.tracking) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tevent.addListener(document, this.moveEvent, this.touchMove);\n\t\t\tevent.addListener(document, this.endEvent, this.touchEnd);\n\t\t\tthis.tracking = true;\n\t\t}\n\n\t\t/**\n\t\t * Unbinds move and end events\n\t\t * @private\n\t\t */\n\t\tunbindEvents() {\n\t\t\tif (!this.tracking) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tevent.removeListener(document, this.moveEvent, this.touchMove);\n\t\t\tevent.removeListener(document, this.endEvent, this.touchEnd);\n\t\t\tthis.tracking = false;\n\t\t}\n\n\t\t/**\n\t\t * Returns the native touches list of the given event, or the event itself as only array value on non-touch\n\t\t * devices, effectively mimicking e.touches.\n\t\t * See https://developer.mozilla.org/en-US/docs/Web/API/TouchEvent.touches\n\t\t *\n\t\t * @param {Event} e\n\t\t * @returns {TouchList|Array} touches\n\t\t */\n\t\tgetTouches(e) {\n\t\t\treturn e.touches || [ e ];\n\t\t}\n\n\t\t/**\n\t\t * Returns the native changedTouches list of the given event, or the event itself as only array value on\n\t\t * non-touch devices, effectively mimicking the e.changedTouches array.\n\t\t * See https://developer.mozilla.org/en-US/docs/Web/API/TouchEvent.changedTouches\n\t\t *\n\t\t * @param {Event} e\n\t\t * @returns {TouchList|Array} changedTouches\n\t\t */\n\t\tgetChangedTouches(e) {\n\t\t\treturn e.changedTouches || [ e ];\n\t\t}\n\n\t\t/**\n\t\t * Returns the {@link playtotv.touch.Sequence} that tracks the currently active mouse or touch pointer that is\n\t\t * associated with te given identifier (see https://developer.mozilla.org/en-US/docs/Web/API/Touch.identifier).\n\t\t *\n\t\t * @param {String} identifier\n\t\t * @returns {playtotv.touch.Sequence} sequence\n\t\t */\n\t\tgetSequence(id) {\n\t\t\treturn this.tracker.map[id];\n\t\t}\n\n\t\t/**\n\t\t * Returns an array of all sequences of currently active mouse or touch pointers.\n\t\t *\n\t\t * @returns {Array} sequences\n\t\t */\n\t\tgetSequences() {\n\t\t\treturn this.tracker.toArray();\n\t\t}\n\n\t\t/**\n\t\t * Calls preventDefault in the capture phase of any click events that are fired both during ghost time and in\n\t\t * close proximity to the given point. This method is called by the proxy's touchEnd method after a faster\n\t\t * click is triggered on mobile devices, and prevents double click events from firing when a native click does\n\t\t * follow the triggered one.\n\t\t *\n\t\t * @param {playtotv.css.Vector} point\n\t\t */\n\t\tpreventNextClick(point) {\n\t\t\tvar nextClick = function(e) {\n\t\t\t\tvar dx = e.clientX - point.x;\n\t\t\t\tvar dy = e.clientY - point.y;\n\t\t\t\tif (!e.isFastClick && Math.sqrt((dx * dx) + (dy * dy)) < 20) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tvar node = this.node;\n\t\t\tnode.addEventListener('click', nextClick, true);\n\t\t\tsetTimeout(function() {\n\t\t\t\tnode.removeEventListener('click', nextClick, true);\n\t\t\t}, CLICK_DELAY);\n\t\t}\n\n\t\t/**\n\t\t * Unbinds all events and deletes the node reference. Call this method before the page unloads to prevent\n\t\t * any possible memory leaks.\n\t\t */\n\t\tdispose() {\n\t\t\tthis.unbindEvents();\n\t\t\tevent.removeListener(this.node, this.startEvent, this.touchStart);\n\t\t\tdelete this.node;\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.touch.touchManager', [\n\t'playtotv.css.Vector',\n\t'playtotv.touch.TouchProxy'\n], function(\n\tVector,\n\tTouchProxy\n) {\n\n\t'use strict';\n\n\tvar dom = playtotv.dom;\n\tvar TOUCH_ENABLED = 'TouchEnabled';\n\n\t/**\n\t * Touch controller for managing em:touch[type] events for use with both mouse and touch. Typically, only the root\n\t * node of an app is enabled via the captureEvents method, but an approach where individual nodes are captured and\n\t * released during their lifecycle is a possible one.\n\t * Various widgets like {@link playtotv.widget.ScrollableWidget} rely on a captured node (or ascendant) to\n\t * function properly, and will throw an error if none is found.\n\t *\n\t * Available events are em:touchstart, em:touchmove, em:touchend (which are fired from their native down, move and\n\t * up counterparts) and em:swipe, which (if at all) is fired immediately after em:touchend. The event object that\n\t * is passed to handlers contains a detail object with the following properties:\n\t *\n\t * - proxy, the {@link playtotv.touch.TouchProxy} that fired the event\n\t * - sequence, the {@link playtotv.touch.Sequence} of this event, exposing offset and velocity vectors etc.\n\t * - nativeEvent, the underlying native event\n\t *\n\t * Calling preventDefault on em:touchstart, -move and -end will prevent native mouse and touch behavior to trigger\n\t * (e.g. native scrolling, dragging, zooming) depending on preventNative option passed to the captureEvents\n\t * method. In general, handlers SHOULD call preventDefault, as custom event handling often implies\n\t * that native behavior is not desired at that time.\n\t *\n\t * Calling stopPropagation will prevent events to reach handlers higher up in the DOM, and MAY be called by\n\t * handlers that wish to claim the event. A horizontal slider could stop propagation of horizontally orientented\n\t * em:touchmove events to prevent them from reaching a vertically scrollable ascendant, which might otherwise\n\t * result in sliding and scrolling simultaneously.\n\t *\n\t * @name touchManager\n\t * @namespace Touch controller for managing em:touch[type] events.\n\t * @memberOf playtotv.touch\n\t */\n\tvar touchManager = {\n\n\t\t/** @lends playtotv.touch */\n\n\t\tproxies: [],\n\n\t\t/**\n\t\t * Enables custom em:touch[type] events for a node and its decendants via {@link playtotv.touch.TouchProxy}.\n\t\t * These events are required by {@link playtotv.widget.DraggableWidget} and any widgets that use it.\n\t\t *\n\t\t * Set the fastClick option to true (default) to allow a faster click event to be fired on touch enabled\n\t\t * devices, which may have an aproximately 300ms delay before a native click is fired. Some devices remove this\n\t\t * delay themselves if the viewport meta tag content contains 'user-scalable=no', and/or when the target node's\n\t\t * style has a touch-action css property with a value of 'none' or 'manipulation'. In this case, the fastClick\n\t\t * option will not fire clicks.\n\t\t *\n\t\t * When preventDefault is called on a custom event, the underlying native (pointer, touch or mouse) event is\n\t\t * also prevented. Set the em>preventNative</em> option to false (default true) to disallow this. This may be\n\t\t * required in special cases, for instance when combining custom horizontal scrolling with native vertical\n\t\t * scrolling etc.\n\t\t *\n\t\t * Set the propagateNative option to true to allow underlying native events to bubble unhindered.\n\t\t * This has no effect on native browser behavior, but might be needed when using other third party scripts that\n\t\t * need to handle these events on nodes higher up in the DOM. This may also apply to the preventNative option.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {Object} [options]\n\t\t * @param {boolean} [options.fastClick=true]\n\t\t * @param {boolean} [options.preventNative=true]\n\t\t * @param {boolean} [options.propagateNative=false]\n\t\t * @returns {playtotv.touch.TouchProxy} proxy\n\t\t */\n\t\tcaptureEvents: function(node, options) {\n\t\t\toptions = playtotv.params(options, {\n\t\t\t\tfastClick: true,\n\t\t\t\tpreventNative: true,\n\t\t\t\tpropagateNative: false\n\t\t\t});\n\n\t\t\tif (this.isCaptured(node)) {\n\t\t\t\tthrow new Error('Node or ascendant is already captured by playtotv.touch');\n\t\t\t}\n\n\t\t\tif (options.fastClick && !options.preventNative) {\n\t\t\t\tthrow new Error('Ambiguous options: preventNative (false) is overruled by fastClick (true)');\n\t\t\t}\n\n\t\t\t// flag as enabled\n\t\t\tdom.setData(node, TOUCH_ENABLED, true);\n\n\t\t\t// create the proxy\n\t\t\tvar proxy = new TouchProxy(node, options);\n\t\t\tthis.proxies.push(proxy);\n\n\t\t\t// and return it\n\t\t\treturn proxy;\n\t\t},\n\n\t\t/**\n\t\t * Removes custom em:touch[type] events of a previously enabled node. Returns a boolean whether the node\n\t\t * had its events removed successfully.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @returns {boolean} success\n\t\t */\n\t\treleaseEvents: function(node) {\n\t\t\tvar i, proxy, l = this.proxies.length;\n\t\t\tfor (i = 0; i < l; i++) {\n\t\t\t\tproxy = this.proxies[i];\n\t\t\t\tif (proxy.node === node) {\n\t\t\t\t\tdom.removeData(node, TOUCH_ENABLED);\n\t\t\t\t\tthis.proxies.splice(i, 1);\n\t\t\t\t\tproxy.dispose();\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\n\t\t/**\n\t\t * Returns a boolean whether em:touch[type] events are enabled for this node (or via an ascendant).\n\t\t *\n\t\t * @param {Node} node\n\t\t * @returns {boolean} captured\n\t\t */\n\t\tisCaptured: function(node) {\n\t\t\twhile (node) {\n\t\t\t\tif (dom.getData(node, TOUCH_ENABLED)) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\tnode = node.parentNode;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\n\t\t/**\n\t\t * Returns the angle (in radians) of a sequence's current velocity vector\n\t\t *\n\t\t * @param {playtotv.touch.Sequence} sequence\n\t\t * @return {number} angle\n\t\t */\n\t\tgetAngle: function(sequence) {\n\t\t\tvar v = sequence.velocity;\n\t\t\treturn Math.atan2(v.y, v.x);\n\t\t},\n\n\t\t/**\n\t\t * Returns the orientation of a sequence's current velocity, either Vector.HORIZONTAL or Vector.VERTICAL\n\t\t *\n\t\t * @param {playtotv.touch.Sequence} sequence\n\t\t * @return {number} orientation\n\t\t */\n\t\tgetOrientation: function(sequence) {\n\t\t\tvar v = sequence.velocity;\n\t\t\treturn Math.abs(v.x) > Math.abs(v.y) ?\n\t\t\t\tVector.HORIZONTAL : Vector.VERTICAL;\n\t\t},\n\n\t\t/**\n\t\t * Returns a given event's direction, as Vector property UP, DOWN, LEFT or RIGHT\n\t\t *\n\t\t * @param {playtotv.touch.Sequence} sequence\n\t\t * @return {number} direction\n\t\t */\n\t\tgetDirection: function(sequence) {\n\t\t\tvar v = sequence.velocity;\n\t\t\treturn this.getOrientation(sequence) === Vector.HORIZONTAL ?\n\t\t\t\t(v.x > 0 ? Vector.RIGHT : Vector.LEFT) : (v.y > 0 ? Vector.DOWN : Vector.UP);\n\t\t}\n\t};\n\n\t/**\n\t * return the module\n\t *\n\t */\n\n\treturn touchManager;\n});\n",
		"/*jshint maxparams:100*/\nplaytotv.define('playtotv.mvc.App', [\n\t'playtotv.model.modelUtil',\n\t'playtotv.mvc.BindWidget',\n\t'playtotv.mvc.Controller',\n\t'playtotv.mvc.helpers',\n\t'playtotv.mvc.Router',\n\t'playtotv.mvc.UpdateWidget',\n\t'playtotv.mvc.View',\n\t'playtotv.storage.AsyncStorage',\n\t'playtotv.storage.MockAsyncStorage',\n\t'playtotv.touch.touchManager',\n\t'playtotv.PauseDog'\n], function(\n\tmodelUtil,\n\tBindWidget,\n\tController,\n\thelpers,\n\tRouter,\n\tUpdateWidget,\n\tView,\n\tAsyncStorage,\n\tMockAsyncStorage,\n\ttouchManager,\n\tPauseDog\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar util = ptv.util;\n\tvar event = ptv.event;\n\tvar Cancellable = Promise.Cancellable;\n\n\treturn class App extends Controller {\n\t\t/** @lends playtotv.mvc.App.prototype */\n\n\t\t/**\n\t\t * PlayToTV MVC App containing global resources like templates, storage, router and view\n\t\t * and coordinating controllers, widgets and event listeners.\n\t\t *\n\t\t * @example\n\t\t * var app = new App({ id: 'foo' });\n\t\t * app.addControllers([\n\t\t *   [ 'bar', BarController ]\n\t\t * ]).then(() => app.startView());\n\t\t *\n\t\t * @constructs\n\t\t * @param {Object} options\n\t\t * @param {string} options.id App id to use for logging and persistence\n\t\t * @param {[Function]} [options.templates=Handlebars.templates] Page template functions to use\n\t\t * @param {Object} [options.store={}] Properties with default values to be serialized and persisted\n\t\t * @param {Object} [options.log={}] Log level map (false to disable)\n\t\t * @param {boolean} [options.storage={}] Options for Storage (mock: true to use mock storage)\n\t\t * @param {Object} [options.router={}] Options for Router\n\t\t * @param {Object} [options.touch={}] Options for capturing touch (false to disable)\n\t\t * @param {Object} [options.view={}] Options for View\n\t\t * @param {number} [options.reloadTime=4*60*60*1000] JavaScript pause time in ms after which to reload\n\t\t */\n\t\tconstructor(options) {\n\t\t\tvar Handlebars = window.Handlebars;\n\t\t\tif (Handlebars) {\n\t\t\t\toptions.templates = options.templates || Handlebars.templates;\n\t\t\t\tHandlebars.registerHelper(helpers);\n\t\t\t}\n\n\t\t\tptv.params(options, {\n\t\t\t\tid: ptv.REQUIRED,\n\t\t\t\ttemplates: ptv.REQUIRED,\n\t\t\t\tstore: {},\n\t\t\t\tlog: {},\n\t\t\t\tstorage: {},\n\t\t\t\trouter: {},\n\t\t\t\ttouch: {},\n\t\t\t\tview: {},\n\t\t\t\treloadTime: 4 * 60 * 60 * 1000\n\t\t\t});\n\n\t\t\t// Start without app ref or stored data (first call super and constructStorage)\n\t\t\tsuper({\n\t\t\t\tname: 'app',\n\t\t\t\tapp: null,\n\t\t\t\tstore: options.store\n\t\t\t});\n\n\t\t\t// TODO: JSDOC or privatize (_ prefix) properties\n\t\t\tthis.app = this;\n\t\t\tthis.id = options.id;\n\t\t\tthis.templates = options.templates;\n\t\t\tthis.logEnabled = this.constructLog(options.log);\n\t\t\tthis.storage = this.constructStorage(options.storage);\n\t\t\tthis.router = this.constructRouter(options.router);\n\t\t\tthis.touchCaptured = this.constructTouch(options.touch);\n\t\t\tthis.view = this.constructView(options.view);\n\t\t\tthis.pauseDog = this.constructPauseDog(options.reloadTime);\n\n\t\t\tthis.widgetMap = {};\n\t\t\tthis.widgets = [];\n\t\t\tthis.scriptListeners = [];\n\n\t\t\tevent.addWindowOnError(this.onError.bind(this));\n\t\t\tevent.addListener(window, 'beforeUnload', () => this.dispose());\n\n\t\t\tthis.setWidgets([\n\t\t\t\t[ 'bind', BindWidget ],\n\t\t\t\t[ 'update', UpdateWidget ]\n\t\t\t]);\n\n\t\t\t// Deserialize app from storage and persist it\n\t\t\tthis.ready = this.storage.get('app').catch(() => undefined).then(stored => {\n\t\t\t\tthis.deserialize(stored);\n\t\t\t\tthis.subscribe('*', ptv.debounce(() => this.flush('app'), 500));\n\t\t\t});\n\t\t}\n\n\t\t// TODO: JSDOC or privatize (_ prefix) methods\n\n\t\t////\n\t\t// CONSTRUCTORS\n\t\t//\n\n\t\tconstructLog(options = {}) {\n\t\t\tif (!options) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.logger = ptv.Logger.get(this.id);\n\n\t\t\t// Extend options with defaults, but keep passed option properties on top (e.g: higher priority)\n\t\t\tptv.each({\n\t\t\t\t'error': 'ERROR',\n\t\t\t\t'view.slow': 'WARNING',\n\t\t\t\t'view.update': 'DEBUG',\n\t\t\t\t'view.diffs.*': 'SPAM',\n\t\t\t\t'*': 'DEBUG' // e.g: default level\n\t\t\t}, (value, key) => {\n\t\t\t\tif (!options.hasOwnProperty(key)) {\n\t\t\t\t\toptions[key] = value;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Convert map to array with regex-es to facilitate use by this.log()\n\t\t\tthis.logRules = Object.keys(options).map((key) => ({\n\t\t\t\tselector: key.indexOf('*') >= 0 ? util.globToRegEx(key) : key,\n\t\t\t\tlevel: options[key]\n\t\t\t}));\n\n\t\t\tthis.subscribe('*', (data, channel) => this.log(channel, data));\n\n\t\t\treturn true;\n\t\t}\n\n\t\tconstructStorage(options) {\n\t\t\tvar { mock } = options;\n\t\t\tvar StorageClass = mock ? MockAsyncStorage : AsyncStorage;\n\t\t\treturn new StorageClass(this.id + '.');\n\t\t}\n\n\t\tconstructRouter(options) {\n\t\t\tvar router = new Router(Object.assign({\n\t\t\t\tpatterns: Object.keys(this.templates)\n\t\t\t}, options));\n\n\t\t\trouter.subscribe('*', (params, pattern) => {\n\t\t\t\t// Note: this will also trigger view.update subscription below\n\t\t\t\tthis.publish('route:' + pattern, params);\n\t\t\t});\n\n\t\t\treturn router;\n\t\t}\n\n\t\tconstructTouch(options) {\n\t\t\tif (!options) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\ttouchManager.captureEvents(document, options);\n\t\t\treturn true;\n\t\t}\n\n\t\tconstructView(options) {\n\t\t\tvar { throttle, interval, isSlow } = ptv.params(options, {\n\t\t\t\tthrottle: 100,\n\t\t\t\tinterval: 10000, // continuous update interval\n\t\t\t\tisSlow: 100\n\t\t\t});\n\n\t\t\t// View render template is determined by current route, the render context is this app\n\t\t\t// Note: In case a Handlebars SafeString is returned it is converted to plain string\n\t\t\tvar view = new View({\n\t\t\t\trender: () => '' + this.templates[this.router.pattern](this),\n\t\t\t\tthrottle: throttle,\n\t\t\t\tinterval: interval,\n\t\t\t\tonNodeAdded: this.onNodeAdded.bind(this),\n\t\t\t\tonNodeRemove: this.onNodeRemove.bind(this),\n\t\t\t\tonAttrSet: this.onAttrSet.bind(this),\n\t\t\t\tonAttrRemove: this.onAttrRemove.bind(this)\n\t\t\t});\n\n\t\t\tview.subscribe('update', (update) => {\n\t\t\t\tvar { timer: { total, string }, diffs } = update;\n\t\t\t\tthis.log('view.' + (total > isSlow ? 'slow' : 'update'), string);\n\t\t\t\tif (diffs.length > 0) {\n\t\t\t\t\tthis.log('view.diffs.' + diffs.length, diffs);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn view;\n\t\t}\n\n\t\tconstructPauseDog(reloadTime) {\n\t\t\t// Reload if JS was paused for more then x (e.g: 4 hours) to prevent stale clients (e.g: in native wrapper)\n\t\t\t// Also can help to prevent or work around other issues in these types of situations\n\t\t\tvar pauseDog = new PauseDog();\n\t\t\tpauseDog.add(reloadTime, () => this.reload());\n\t\t\treturn pauseDog;\n\t\t}\n\n\t\t////\n\t\t// STARTERS\n\t\t//\n\n\t\t/**\n\t\t * Call this when you are ready to have things rendered to the view.\n\t\t *\n\t\t * E.g: After you have added your controllers.\n\t\t */\n\t\tstartView() {\n\t\t\tthis.view.update();\n\n\t\t\t// Update view again whenever something is published\n\t\t\tthis.subscribe('*', this.view.update);\n\t\t}\n\n\t\t////\n\t\t// CONTROLLERS\n\t\t//\n\n\t\taddController(name, ControllerClass, options) {\n\t\t\treturn this.ready.then(() => {\n\t\t\t\treturn this.storage.get(name).catch(() => undefined).then((stored) => {\n\t\t\t\t\tif (this[name]) {\n\t\t\t\t\t\tthrow new Error('Controller name not available: ' + name);\n\t\t\t\t\t}\n\n\t\t\t\t\tvar controller = new ControllerClass({\n\t\t\t\t\t\tname: name,\n\t\t\t\t\t\tapp: this,\n\t\t\t\t\t\tstored: stored\n\t\t\t\t\t}, options);\n\n\t\t\t\t\tthis[name] = controller;\n\n\t\t\t\t\tvar debouncedFlush = ptv.debounce(() => this.flush(name), 500);\n\n\t\t\t\t\t// Pass on controller publishes to App and persist it's state\n\t\t\t\t\tcontroller.subscribe('*', (data, channel) => {\n\t\t\t\t\t\tthis.publish(name + '.' + channel, data);\n\t\t\t\t\t\tdebouncedFlush();\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.publish(name, controller);\n\n\t\t\t\t\treturn controller;\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\taddControllers(controllers) {\n\t\t\treturn Promise.all(controllers.map(args => this.addController.apply(this, args)));\n\t\t}\n\n\t\tgetController(name, timeout = 10000) {\n\t\t\tvar controller = this[name];\n\t\t\tif (controller) {\n\t\t\t\treturn Cancellable.resolve(controller);\n\t\t\t}\n\n\t\t\tvar cancellable = this.when(name);\n\n\t\t\tif (timeout) {\n\t\t\t\tcancellable.setTimeout(timeout);\n\t\t\t}\n\n\t\t\treturn cancellable;\n\t\t}\n\n\t\t////\n\t\t// CONTROLLER OVERRIDES\n\t\t//\n\n\t\t/**\n\t\t * Log code and details using this.logger with level based on matching code with app.logRules.\n\t\t *\n\t\t * Overrides Controller.log() that delegates to this.\n\t\t *\n\t\t * @param {string} code\n\t\t * @param {string|Object} [details=null]\n\t\t */\n\t\tlog(code, details = null) {\n\t\t\tif (!this.logEnabled) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar rule = this.logRules.find((rule) => {\n\t\t\t\tvar { selector } = rule;\n\t\t\t\treturn typeof selector === 'string' ? selector === code : selector.test(code);\n\t\t\t});\n\t\t\tvar level = rule && rule.level;\n\t\t\tif (!level) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (details && details.toObject) {\n\t\t\t\tdetails = modelUtil.toObject(details);\n\t\t\t}\n\n\t\t\tvar args = typeof details === 'object' ? [ code, details ] : [ code + ': ' + details ];\n\t\t\tthis.logger.log(level, args);\n\n\t\t\t// Return log level to facilitate extending functionality in classes extending this one\n\t\t\treturn level;\n\t\t}\n\n\t\t/**\n \t\t * Persists specified controller's data to storage.\n \t\t *\n\t\t * Overrides Controller.flush() that delegates to this.\n \t\t *\n \t\t * @returns {Promise} Promise of data being persisted\n \t\t */\n\t\tflush(name) {\n\t\t\treturn this.storage.set(name, this[name].serialize());\n\t\t}\n\n\t\t// Override so set is called on Controller instance, thus also properly publishing on that\n\t\tset(path, value, options) {\n\t\t\tvar head = util.getPathHead(path);\n\t\t\tvar tail = util.getPathTail(path);\n\t\t\tif (tail) {\n\t\t\t\tthis[head].set(tail, value, options);\n\t\t\t} else {\n\t\t\t\tsuper.set(path, value, options);\n\t\t\t}\n\t\t}\n\n\t\t////\n\t\t// WIDGETS\n\t\t//\n\n\t\t/**\n\t\t * Registers widget by name with specified Widget class and base options.\n\t\t *\n\t\t * Overrides Controller.setWidget() that delegates to this.\n\t\t *\n\t\t * @param {string} name Widget name\n\t\t * @param {[type]} WidgetClass Class to use for Widget instantiation\n\t\t * @param {Object} [options={}] Base options\n\t\t */\n\t\tsetWidget(name, WidgetClass, options = {}) {\n\t\t\toptions.app = this;\n\n\t\t\tthis.widgetMap[name] = {\n\t\t\t\tWidgetClass: WidgetClass,\n\t\t\t\toptions: options\n\t\t\t};\n\t\t}\n\n\t\tinstantiateWidget(node, name, options) {\n\t\t\tvar widget = this.widgetMap[name];\n\t\t\tif (!widget) {\n\t\t\t\tthrow new Error('Widget not found: ' + name);\n\t\t\t}\n\n\t\t\tvar instanceOptions = Object.assign({}, widget.options, options);\n\t\t\tvar instance = new widget.WidgetClass(node, instanceOptions);\n\n\t\t\tthis.widgets.push({ node: node, name: name, instance: instance });\n\n\t\t\treturn instance;\n\t\t}\n\n\t\tdisposeWidgets(by, value) {\n\t\t\tthis.widgets = this.widgets.filter(widget => {\n\t\t\t\tif (!by || widget[by] === value) {\n\t\t\t\t\twidget.instance.dispose();\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t});\n\t\t}\n\n\t\tsetNodeWidgets(node, widgets, oldWidgets) {\n\t\t\t// Cleanup any previously instantiated widgets (e.g: on attribute change)\n\t\t\t// TODO: Leave identical widgets in place instead of disposing and re-instantiating all of them\n\t\t\tif (oldWidgets) {\n\t\t\t\tthis.disposeWidgets('node', node);\n\t\t\t}\n\n\t\t\t// If widgets looks like JSON then decode them (e.g: encoded by {{widgets}})\n\t\t\t// Otherwise this is parsed as a space separated array of widget name strings\n\t\t\twidgets = widgets.indexOf('[[\"') === 0 ? JSON.parse(widgets) :\n\t\t\t\twidgets.split(/\\s+/).map(name => [ name, {} ]);\n\n\t\t\twidgets.forEach(widget => {\n\t\t\t\tvar [ name, options ] = widget;\n\t\t\t\tthis.instantiateWidget(node, name, options);\n\t\t\t});\n\t\t}\n\n\t\t////\n\t\t// SCRIPTS\n\t\t//\n\n\t\trunScript(script, context, ret) {\n\t\t\tvar promise = new Promise(resolve => {\n\t\t\t\t// If script looks like JSON then decode, e.g: when encoded by {{on}} or {{script}}\n\t\t\t\tvar scriptContext;\n\t\t\t\tif (script.indexOf('[\"') === 0) {\n\t\t\t\t\t[ script, scriptContext ] = JSON.parse(script);\n\t\t\t\t}\n\n\t\t\t\t// Combine a ref this app's properties, the script and the run context\n\t\t\t\tcontext = Object.assign({}, this, scriptContext, context);\n\n\t\t\t\tresolve(util.eval(script, context));\n\t\t\t});\n\n\t\t\tif (ret) {\n\t\t\t\treturn promise;\n\t\t\t} else {\n\t\t\t\tpromise.catch(error => this.onError(error));\n\t\t\t}\n\t\t}\n\n\t\tsetNodeScript(node, type, script) {\n\t\t\tvar { scriptListeners } = this;\n\t\t\tvar listener = scriptListeners.find(listener => listener.node === node && listener.type === type);\n\n\t\t\t// Cleanup previous listener\n\t\t\tif (listener) {\n\t\t\t\tevent.removeListener(listener);\n\t\t\t\tscriptListeners.splice(scriptListeners.indexOf(listener), 1);\n\t\t\t}\n\n\t\t\t// Note: node-added is handled in onNodeAdded and node-remove in onNodeRemove\n\t\t\tif (!script || type === 'node-added' || type === 'node-remove') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlistener = event.addListener(node, type, (event) => {\n\t\t\t\tthis.runScript(script, { node: node, event: event });\n\t\t\t});\n\t\t\tscriptListeners.push(listener);\n\t\t}\n\n\t\t////\n\t\t// VIEW MUTATION OBSERVERS\n\t\t//\n\n\t\tonNodeAdded(node) {\n\t\t\tvar script = node.getAttribute('on-node-added');\n\t\t\tif (script) {\n\t\t\t\tthis.runScript(script, { node: node });\n\t\t\t}\n\t\t}\n\n\t\tonNodeRemove(node) {\n\t\t\tvar script = node.getAttribute('on-node-remove');\n\t\t\tif (script) {\n\t\t\t\tthis.runScript(script, { node: node });\n\t\t\t}\n\t\t}\n\n\t\tonAttrSet(node, name, value, oldValue) {\n\t\t\tif (name === 'widgets') {\n\t\t\t\tthis.setNodeWidgets(node, value, oldValue);\n\t\t\t} else if (name.indexOf('on-') === 0) {\n\t\t\t\tthis.setNodeScript(node, name.substr(3), value);\n\t\t\t}\n\t\t}\n\n\t\tonAttrRemove(node, name/*, value*/) {\n\t\t\tif (name === 'widgets') {\n\t\t\t\tthis.disposeWidgets('node', node);\n\t\t\t} else if (name.indexOf('on-') === 0) {\n\t\t\t\tthis.setNodeScript(node, name.substr(3), '');\n\t\t\t}\n\t\t}\n\n\t\t////\n\t\t// APP HELPERS\n\t\t//\n\n\t\t/**\n\t\t * If target is truthy then this delegates to popup().\n\t\t * Otherwise the window location is changed to specified URL.\n\t\t *\n\t\t * @param {string} url\n\t\t * @param {string} [target]\n\t\t * @param {Object} [options]\n\t\t */\n\t\topen(url, target, options) {\n\t\t\tif (target) {\n\t\t\t\treturn this.popup(url, target, options);\n\t\t\t}\n\n\t\t\twindow.location = url;\n\t\t}\n\n\t\t/**\n\t\t * Adds on-click=\"event.preventDefault(); app.open(node.href, '${target}')\" to anchors of (3rd party) HTML.\n\t\t * That in turn can go through popup() which can be overridden to use certain Native Wrapper commands etc.\n\t\t *\n\t\t * @param {string} html HTML to openify\n\t\t * @param {Object} [options]\n\t\t * @param {string} [options.target=''] Target to open openified anchor links in\n\t\t * @returns {string} Openified version of html\n\t\t */\n\t\topenify(html, options) {\n\t\t\tvar { target } = ptv.params(options, { target: '' });\n\t\t\treturn html && html.replace(/<a /g,\n\t\t\t\t`<a on-click=\"event.preventDefault(); app.open(node.href, '${target}')\" `\n\t\t\t);\n\t\t}\n\n\t\t/**\n\t\t * Opens url with window.open (through playtotv.util.popup) and returns Window reference.\n\t\t *\n\t\t * If you are using NativeController you will want to override this method and delegate to it's popup method.\n\t\t *\n\t\t * @param {string} url\n\t\t * @param {string} [target]\n\t\t * @param {Object} [options]\n\t\t * @param {Object} [options.width=0]\n\t\t * @param {Object} [options.height=0]\n\t\t * @returns {Window}\n\t\t */\n\t\tpopup(url, target, options) {\n\t\t\tvar { width, height } = ptv.params(options, { width: 0, height: 0 });\n\t\t\treturn util.popup(url, target, { width: width, height: height });\n\t\t}\n\n\t\t/**\n\t\t * Go back to previous url using window history.\n\t\t */\n\t\tback() {\n\t\t\t// Note: Android does not seem to support window.history.back(), hence the history.go(-1)\n\t\t\twindow.history.go(-1);\n\t\t}\n\n\t\t/**\n\t\t * Reloads this app at it's current location.\n\t\t */\n\t\treload() {\n\t\t\twindow.location.reload(true);\n\t\t}\n\n\t\t/**\n\t\t * Clears storage and then reloads to make a clean app start.\n\t\t */\n\t\treset() {\n\t\t\tthis.storage.clear().finally(() => this.reload());\n\t\t}\n\n\t\t/**\n\t\t * Logs error and changes app error property if it's name and/or message differ from any current error.\n\t\t *\n\t\t * Your app should display this to the user via it's templates or by subscribing to the error publish.\n\t\t *\n\t\t * @params {Error} error\n\t\t */\n\t\tonError(error) {\n\t\t\t// Ignore repeating errors; setting (and publishing and rendering) again could lead to infinite error loops\n\t\t\tvar lastError = this.error;\n\t\t\tif (lastError && error.name === lastError.name && error.message === lastError.message) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.set('error', error, { json: false });\n\t\t}\n\n\t\tclearError() {\n\t\t\tif (this.error) {\n\t\t\t\tdelete this.error;\n\t\t\t\tthis.publish('error-cleared');\n\t\t\t}\n\t\t}\n\n\t\t////\n\t\t// DISPOSE\n\t\t//\n\n\t\tdispose() {\n\t\t\tthis.disposeWidgets();\n\n\t\t\tthis.pauseDog.dispose();\n\n\t\t\tthis.view.dispose();\n\n\t\t\tif (this.touchCaptured) {\n\t\t\t\ttouchManager.releaseEvents(document);\n\t\t\t}\n\n\t\t\tthis.router.dispose();\n\n\t\t\tsuper.dispose();\n\t\t}\n\t};\n});\n",
		"/**\n * Auto generated API: <tt>src/twitter/twitter-api.js</tt>\n *\n * <b>DO NOT MODIFY! CHANGES WILL BE OVERWRITTEN THE NEXT TIME YOU UPDATE!</b>\n *\n * <b>Note:</b> These are not real functions but method definitions for\n * {@link playtotv.server.Server#call}.\n *\n * @name twitterAPI\n * @memberOf playtotv.twitter\n * @namespace\n */\nplaytotv.define('playtotv.twitter.twitterAPI', [], function() {\n\n\t'use strict';\n\n\treturn {\n\t\t/*jshint maxlen:300*/ // On occassion generated lines can be too long\n\n\t\t/** @lends playtotv.twitter.twitterAPI */\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>tweetId</b></li>\n\t\t * <li><i>{number}</i> <b>createdAt</b></li>\n\t\t * <li><i>{string}</i> <b>text</b></li>\n\t\t * <li><i>{TwitterUser}</i> <b>user</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @returns {Promise} Promise of response data (TweetDTO)\n\t\t */\n\t\tgetRecentTweets: {\n\t\t\tlabel: 'twitter.getRecentTweets',\n\t\t\turl: '1/twitter/recent'\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.twitter.TwitterController', [\n\t'playtotv.mvc.Controller',\n\t'playtotv.twitter.twitterAPI'\n], function(\n\tController,\n\ttwitterAPI\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar util = ptv.util;\n\n\treturn class TwitterController extends Controller {\n\t\t/** @lends playtotv.twitter.TwitterController.prototype */\n\n\t\t/**\n\t\t * Generic controller that facilitates displaying a stream of tweets and tweeting etc.\n\t\t *\n\t\t * Uses Controller storage and then {@link playtotv.twitter.twitterAPI.getRecentTweets} to get tweets.\n\t\t * Also see that method for a specification of tweet object properties.\n\t\t *\n\t\t * Uses Twitter Streaming API tweets being distributed as PlayToTV events by our servers to update tweets.\n\t\t * This subscribes to push.TWITTER-POST events on scope that can be provided by\n\t\t * {@link playtotv.push.PushController}.\n\t\t *\n\t\t * @extends playtotv.mvc.Controller\n\t\t * @constructs\n\t\t * @param {Object} context\n\t\t * @param {number} [options.maxItems=25] Maximum number of items to keep in tweets list\n\t\t */\n\t\tconstructor(context, options) {\n\t\t\toptions = ptv.params(options, {\n\t\t\t\tmaxItems: 25\n\t\t\t});\n\n\t\t\tvar stored = context.stored || {};\n\t\t\tsuper(context, {\n\t\t\t\tmodel: {\n\t\t\t\t\ttweets: stored.tweets || []\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.addMethods([\n\t\t\t\t'getTweetParts',\n\t\t\t\t'intent'\n\t\t\t]);\n\n\t\t\tthis.maxItems = options.maxItems;\n\n\t\t\t// Fetch current list of Tweets\n\t\t\tthis.scope.call('server.call', twitterAPI.getRecentTweets, {\n\t\t\t\t// max: maxItems // TODO: not yet supported by server\n\t\t\t}).then(tweets => {\n\t\t\t\tthis.cap(tweets);\n\t\t\t\tthis.set('tweets', tweets);\n\n\t\t\t\t// And from this point on keep up-to-date by push events\n\t\t\t\tthis.scope.subscribe('push.TWITTER-POST', event => this.addTweet(event.payload));\n\t\t\t});\n\t\t}\n\n\t\tcap(tweets) {\n\t\t\ttweets.length = Math.min(tweets.length, this.maxItems);\n\t\t}\n\n\t\taddTweet(tweet) {\n\t\t\tvar tweets = this.model.tweets;\n\t\t\ttweets.unshift(tweet);\n\t\t\tthis.cap(tweets);\n\t\t\t// Note: We forego publishing here since we got here from a push.TWITTER-POST publish\n\t\t\t// this.publish('tweets-add', tweet);\n\t\t}\n\n\t\t/**\n\t\t * Returns array of parts of text with different types.\n\t\t *\n\t\t * Each part is an object with properties:\n\t\t * <ul>\n\t\t * <li>type - text/url/mention/hash\n\t\t * <li>text - text of part\n\t\t * <li>[match] - specific match of part text (e.g: without hash # or mention @ prefix)\n\t\t * </ul>\n\t\t *\n\t\t * @param {string} text Tweet text to split up\n\t\t * @returns {[Object]} Tweet text parts\n\t\t */\n\t\tgetTweetParts(text) {\n\t\t\tvar part = [\n\t\t\t\t{ type: 'url', regex: new RegExp(util.URL_REGEXP.source) }, // non-global copy of URL_REGEXP\n\t\t\t\t{ type: 'mention', regex: /@(\\w+)/ },\n\t\t\t\t{ type: 'hash', regex: /#(\\w+)/ }\n\t\t\t].reduce(function(part, test) {\n\t\t\t\tvar matches = test.regex.exec(text);\n\t\t\t\treturn matches && (part.type === 'text' || matches.index < part.index) ? {\n\t\t\t\t\tindex: matches.index,\n\t\t\t\t\ttype: test.type,\n\t\t\t\t\ttext: matches[0],\n\t\t\t\t\tmatch: matches[1]\n\t\t\t\t} : part;\n\t\t\t}, { index: 0, type: 'text', text: text });\n\n\t\t\tvar parts = [ part ];\n\n\t\t\tvar index = part.index;\n\t\t\tif (index > 0) {\n\t\t\t\tparts.unshift({ type: 'text', text: text.substr(0, index) });\n\t\t\t}\n\n\t\t\tvar tail = text.substr(index + part.text.length);\n\t\t\treturn tail ? parts.concat(this.getTweetParts(tail)) : parts;\n\t\t}\n\n\t\t/**\n\t\t * Opens intent with specified type and options in a fitting popup through scope.\n\t\t *\n\t\t * @example\n\t\t * <a href=\"#\" {{rels (rel \"twitter-intent\" \"tweet\" text=\"Tweet tweet!\")}}>\n\t\t * Will open: https://twitter.com/intent/tweet?text=Tweet%20tweet!\n\t\t *\n\t\t * @param {string} type\n\t\t * @param {Object} [options]\n\t\t */\n\t\tintent(type, options) {\n\t\t\tvar url = util.addURLParams('https://twitter.com/intent/' + type, options);\n\t\t\tthis.scope.open(url, 'twitter-intent', { width: 550, height: 420 });\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.user.User', [\n\t'playtotv.model.ObjectModel'\n], function(\n\tObjectModel\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\n\treturn class User extends ObjectModel {\n\t\t/** @lends playtotv.user.User.prototype */\n\n\t\t/**\n\t\t * User data model class.\n\t\t *\n\t\t * @extends playtotv.model.ObjectModel\n\t\t * @constructs\n\t\t * @param {playtotv.server.Server} server Server\n\t\t * @param {Object} data User data to initialize with\n\t\t * @param {string} data.id User id\n\t\t * @param {string} [data.displayName] User name\n\t\t * @param {string} [data.avatarUrl] User avatar URL\n\t\t * @param {Object} [data.profileProperties={}] User profile property map\n\t\t *\n\t\t * @property {playtotv.server.Server} server Server\n\t\t * @property {string} id User id\n\t\t * @property {string} displayName User name\n\t\t * @property {string} avatarUrl User avatar URL\n\t\t * @property {playtotv.model.ObjectModel} profileProperties User profile property map\n\t\t */\n\t\tconstructor(server, data) {\n\t\t\tptv.params(data, {\n\t\t\t\tid: ptv.REQUIRED,\n\t\t\t\tdisplayName: undefined,\n\t\t\t\tavatarUrl: undefined,\n\t\t\t\tprofileProperties: {}\n\t\t\t});\n\n\t\t\tsuper({\n\t\t\t\tid: data.id,\n\t\t\t\tdisplayName: data.displayName,\n\t\t\t\tavatarUrl: data.avatarUrl,\n\t\t\t\tprofileProperties: new ObjectModel(data.profileProperties)\n\t\t\t});\n\n\t\t\tthis.server = server;\n\t\t}\n\n\t\t/** Dispose */\n\t\tdispose() {\n\t\t\tthis.profileProperties.dispose();\n\t\t\tObjectModel.prototype.dispose.call(this);\n\t\t}\n\t};\n});\n",
		"/**\n * Auto generated API: <tt>src/user/users-api.js</tt>\n *\n * <b>DO NOT MODIFY! CHANGES WILL BE OVERWRITTEN THE NEXT TIME YOU UPDATE!</b>\n *\n * <b>Note:</b> These are not real functions but method definitions for\n * {@link playtotv.server.Server#call}.\n *\n * @name usersAPI\n * @memberOf playtotv.user\n * @namespace\n */\nplaytotv.define('playtotv.user.usersAPI', [], function() {\n\n\t'use strict';\n\n\treturn {\n\t\t/*jshint maxlen:300*/ // On occassion generated lines can be too long\n\n\t\t/** @lends playtotv.user.usersAPI */\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>authenticationToken</b></li>\n\t\t * <li><i>{string}</i> <b>avatarUrl</b></li>\n\t\t * <li><i>{string}</i> <b>displayName</b></li>\n\t\t * <li><i>{string}</i> <b>pttvSession</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * <li><i>{LoginCredentialStatusDTO}</i> <b>loginCredentialStatus</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>email</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * <li><i>{string}</i> <b>username</b></li>\n\t\t * <li><i>{string}</i> <b>facebookId</b></li>\n\t\t * <li><i>{IdDataDoc}</i> <b>externalIds</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>id</b></li>\n\t\t * <li><i>{Date}</i> <b>added</b></li>\n\t\t * </ul></li>\n\t\t * <li><i>{string}</i> <b>authenticationToken</b></li>\n\t\t * </ul></li>\n\t\t * <li><i>{ClientUserProfileDTO}</i> <b>profile</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>profileProperties</b></li>\n\t\t * <li><i>{string}</i> <b>privateProperties</b></li>\n\t\t * <li><i>{string}</i> <b>displayName</b></li>\n\t\t * <li><i>{string}</i> <b>avatarUrl</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * </ul></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.email\n\t\t * @param {string} params.password\n\t\t * @returns {Promise} Promise of response data (RegisterResponseDTO)\n\t\t */\n\t\taddEmailCredentials: {\n\t\t\tlabel: 'users.addEmailCredentials',\n\t\t\turl: '1/users/credentials/email',\n\t\t\ttype: 'POST',\n\t\t\tdataKeys: [\n\t\t\t\t'email',\n\t\t\t\t'password'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {ExternalIdType} params.type Valid values: 'FACEBOOK', 'VK'\n\t\t * @param {string} params.externalId\n\t\t * @param {string} params.signature\n\t\t * @returns {Promise} Promise of response data (Object)\n\t\t */\n\t\taddExternalIdCredentials: {\n\t\t\tlabel: 'users.addExternalIdCredentials',\n\t\t\turl: '1/users/credentials/type/{type}',\n\t\t\ttype: 'POST',\n\t\t\tdataKeys: [\n\t\t\t\t'externalId',\n\t\t\t\t'signature'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.facebookId\n\t\t * @param {string} params.fbsr\n\t\t * @returns {Promise} Promise of response data (Object)\n\t\t */\n\t\taddFacebookCredentials: {\n\t\t\tlabel: 'users.addFacebookCredentials',\n\t\t\turl: '1/users/credentials/facebook',\n\t\t\ttype: 'POST',\n\t\t\tdataKeys: [\n\t\t\t\t'facebookId',\n\t\t\t\t'fbsr'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.oldPassword\n\t\t * @param {string} params.newPassword\n\t\t * @returns {Promise} Promise of response data (Object)\n\t\t */\n\t\tchangePassword: {\n\t\t\tlabel: 'users.changePassword',\n\t\t\turl: '1/users/credentials/changepassword',\n\t\t\ttype: 'POST',\n\t\t\tdataKeys: [\n\t\t\t\t'oldPassword',\n\t\t\t\t'newPassword'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.email\n\t\t * @returns {Promise} Promise of response data (Object)\n\t\t */\n\t\tgeneratePassword: {\n\t\t\tlabel: 'users.generatePassword',\n\t\t\turl: '1/users/credentials/generatepassword/email/{email}',\n\t\t\ttype: 'PUT'\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>email</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * <li><i>{string}</i> <b>username</b></li>\n\t\t * <li><i>{string}</i> <b>facebookId</b></li>\n\t\t * <li><i>{IdDataDoc}</i> <b>externalIds</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>id</b></li>\n\t\t * <li><i>{Date}</i> <b>added</b></li>\n\t\t * </ul></li>\n\t\t * <li><i>{string}</i> <b>authenticationToken</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @returns {Promise} Promise of response data (LoginCredentialStatusDTO)\n\t\t */\n\t\tgetLoginCredentialStatus: {\n\t\t\tlabel: 'users.getLoginCredentialStatus',\n\t\t\turl: '1/users/loginCredentialStatus'\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>value</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.propertyName\n\t\t * @returns {Promise} Promise of response data (ProfilePropertyValueDTO)\n\t\t */\n\t\tgetPrivateProperty: {\n\t\t\tlabel: 'users.getPrivateProperty',\n\t\t\turl: '1/users/profile/{propertyName}/private'\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>profileProperties</b></li>\n\t\t * <li><i>{string}</i> <b>privateProperties</b></li>\n\t\t * <li><i>{string}</i> <b>displayName</b></li>\n\t\t * <li><i>{string}</i> <b>avatarUrl</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} [params.userId]\n\t\t * @returns {Promise} Promise of response data (ClientUserProfileDTO)\n\t\t */\n\t\tgetProfile: {\n\t\t\tlabel: 'users.getProfile',\n\t\t\turl: '1/users/profile',\n\t\t\tqueryKeys: [\n\t\t\t\t'userId'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>value</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.propertyName\n\t\t * @param {string} [params.userId]\n\t\t * @returns {Promise} Promise of response data (ProfilePropertyValueDTO)\n\t\t */\n\t\tgetProfileProperty: {\n\t\t\tlabel: 'users.getProfileProperty',\n\t\t\turl: '1/users/profile/{propertyName}',\n\t\t\tqueryKeys: [\n\t\t\t\t'userId'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>displayName</b></li>\n\t\t * <li><i>{string}</i> <b>avatarUrl</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} [params.userIds]\n\t\t * @returns {Promise} Promise of response data (ClientUserDTO)\n\t\t */\n\t\tgetUsers: {\n\t\t\tlabel: 'users.getUsers',\n\t\t\turl: '1/users/',\n\t\t\tqueryKeys: [\n\t\t\t\t'userIds'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>authenticationToken</b></li>\n\t\t * <li><i>{string}</i> <b>avatarUrl</b></li>\n\t\t * <li><i>{string}</i> <b>displayName</b></li>\n\t\t * <li><i>{string}</i> <b>pttvSession</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * <li><i>{LoginCredentialStatusDTO}</i> <b>loginCredentialStatus</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>email</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * <li><i>{string}</i> <b>username</b></li>\n\t\t * <li><i>{string}</i> <b>facebookId</b></li>\n\t\t * <li><i>{IdDataDoc}</i> <b>externalIds</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>id</b></li>\n\t\t * <li><i>{Date}</i> <b>added</b></li>\n\t\t * </ul></li>\n\t\t * <li><i>{string}</i> <b>authenticationToken</b></li>\n\t\t * </ul></li>\n\t\t * <li><i>{ClientUserProfileDTO}</i> <b>profile</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>profileProperties</b></li>\n\t\t * <li><i>{string}</i> <b>privateProperties</b></li>\n\t\t * <li><i>{string}</i> <b>displayName</b></li>\n\t\t * <li><i>{string}</i> <b>avatarUrl</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * </ul></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.authenticationToken\n\t\t * @param {string} [params.runtimeId]\n\t\t * @returns {Promise} Promise of response data (RegisterResponseDTO)\n\t\t */\n\t\tloginByAuthenticationToken: {\n\t\t\tlabel: 'users.loginByAuthenticationToken',\n\t\t\turl: '1/users/usersessions/authenticationToken',\n\t\t\ttype: 'POST',\n\t\t\tqueryKeys: [\n\t\t\t\t'runtimeId'\n\t\t\t],\n\t\t\tdataKeys: [\n\t\t\t\t'authenticationToken'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>authenticationToken</b></li>\n\t\t * <li><i>{string}</i> <b>avatarUrl</b></li>\n\t\t * <li><i>{string}</i> <b>displayName</b></li>\n\t\t * <li><i>{string}</i> <b>pttvSession</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * <li><i>{LoginCredentialStatusDTO}</i> <b>loginCredentialStatus</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>email</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * <li><i>{string}</i> <b>username</b></li>\n\t\t * <li><i>{string}</i> <b>facebookId</b></li>\n\t\t * <li><i>{IdDataDoc}</i> <b>externalIds</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>id</b></li>\n\t\t * <li><i>{Date}</i> <b>added</b></li>\n\t\t * </ul></li>\n\t\t * <li><i>{string}</i> <b>authenticationToken</b></li>\n\t\t * </ul></li>\n\t\t * <li><i>{ClientUserProfileDTO}</i> <b>profile</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>profileProperties</b></li>\n\t\t * <li><i>{string}</i> <b>privateProperties</b></li>\n\t\t * <li><i>{string}</i> <b>displayName</b></li>\n\t\t * <li><i>{string}</i> <b>avatarUrl</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * </ul></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.email\n\t\t * @param {string} params.password\n\t\t * @param {Boolean} params.rememberMe\n\t\t * @param {string} [params.runtimeId]\n\t\t * @returns {Promise} Promise of response data (RegisterResponseDTO)\n\t\t */\n\t\tloginByEmail: {\n\t\t\tlabel: 'users.loginByEmail',\n\t\t\turl: '1/users/usersessions/email',\n\t\t\ttype: 'POST',\n\t\t\tqueryKeys: [\n\t\t\t\t'runtimeId'\n\t\t\t],\n\t\t\tdataKeys: [\n\t\t\t\t'email',\n\t\t\t\t'password',\n\t\t\t\t'rememberMe'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * <b>Request DTO's:</b>\n\t\t * <ul>\n\t\t * <li><i>{OptionalRegistrationValuesDTO}</i> <b>optionalValues</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>properties</b></li>\n\t\t * <li><i>{string}</i> <b>privateProperties</b></li>\n\t\t * </ul></li>\n\t\t * </ul>\n\t\t *\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>authenticationToken</b></li>\n\t\t * <li><i>{string}</i> <b>avatarUrl</b></li>\n\t\t * <li><i>{string}</i> <b>displayName</b></li>\n\t\t * <li><i>{string}</i> <b>pttvSession</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * <li><i>{LoginCredentialStatusDTO}</i> <b>loginCredentialStatus</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>email</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * <li><i>{string}</i> <b>username</b></li>\n\t\t * <li><i>{string}</i> <b>facebookId</b></li>\n\t\t * <li><i>{IdDataDoc}</i> <b>externalIds</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>id</b></li>\n\t\t * <li><i>{Date}</i> <b>added</b></li>\n\t\t * </ul></li>\n\t\t * <li><i>{string}</i> <b>authenticationToken</b></li>\n\t\t * </ul></li>\n\t\t * <li><i>{ClientUserProfileDTO}</i> <b>profile</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>profileProperties</b></li>\n\t\t * <li><i>{string}</i> <b>privateProperties</b></li>\n\t\t * <li><i>{string}</i> <b>displayName</b></li>\n\t\t * <li><i>{string}</i> <b>avatarUrl</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * </ul></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {ExternalIdType} params.type Valid values: 'FACEBOOK', 'VK'\n\t\t * @param {string} params.externalId\n\t\t * @param {string} params.signature\n\t\t * @param {string} params.displayName\n\t\t * @param {string} params.avatarUrl\n\t\t * @param {OptionalRegistrationValuesDTO} params.optionalValues\n\t\t * @param {string} [params.runtimeId]\n\t\t * @returns {Promise} Promise of response data (RegisterResponseDTO)\n\t\t */\n\t\tloginByExternalId: {\n\t\t\tlabel: 'users.loginByExternalId',\n\t\t\turl: '1/users/usersessions/externalId',\n\t\t\ttype: 'POST',\n\t\t\tqueryKeys: [\n\t\t\t\t'runtimeId'\n\t\t\t],\n\t\t\tdataKeys: [\n\t\t\t\t'type',\n\t\t\t\t'externalId',\n\t\t\t\t'signature',\n\t\t\t\t'displayName',\n\t\t\t\t'avatarUrl',\n\t\t\t\t'optionalValues'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * <b>Request DTO's:</b>\n\t\t * <ul>\n\t\t * <li><i>{OptionalRegistrationValuesDTO}</i> <b>optionalValues</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>properties</b></li>\n\t\t * <li><i>{string}</i> <b>privateProperties</b></li>\n\t\t * </ul></li>\n\t\t * </ul>\n\t\t *\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>authenticationToken</b></li>\n\t\t * <li><i>{string}</i> <b>avatarUrl</b></li>\n\t\t * <li><i>{string}</i> <b>displayName</b></li>\n\t\t * <li><i>{string}</i> <b>pttvSession</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * <li><i>{LoginCredentialStatusDTO}</i> <b>loginCredentialStatus</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>email</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * <li><i>{string}</i> <b>username</b></li>\n\t\t * <li><i>{string}</i> <b>facebookId</b></li>\n\t\t * <li><i>{IdDataDoc}</i> <b>externalIds</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>id</b></li>\n\t\t * <li><i>{Date}</i> <b>added</b></li>\n\t\t * </ul></li>\n\t\t * <li><i>{string}</i> <b>authenticationToken</b></li>\n\t\t * </ul></li>\n\t\t * <li><i>{ClientUserProfileDTO}</i> <b>profile</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>profileProperties</b></li>\n\t\t * <li><i>{string}</i> <b>privateProperties</b></li>\n\t\t * <li><i>{string}</i> <b>displayName</b></li>\n\t\t * <li><i>{string}</i> <b>avatarUrl</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * </ul></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.facebookId\n\t\t * @param {string} params.fbsr\n\t\t * @param {string} params.displayName\n\t\t * @param {string} params.avatarUrl\n\t\t * @param {OptionalRegistrationValuesDTO} params.optionalValues\n\t\t * @param {string} [params.runtimeId]\n\t\t * @returns {Promise} Promise of response data (RegisterResponseDTO)\n\t\t */\n\t\tloginByFacebook: {\n\t\t\tlabel: 'users.loginByFacebook',\n\t\t\turl: '1/users/usersessions/facebook',\n\t\t\ttype: 'POST',\n\t\t\tqueryKeys: [\n\t\t\t\t'runtimeId'\n\t\t\t],\n\t\t\tdataKeys: [\n\t\t\t\t'facebookId',\n\t\t\t\t'fbsr',\n\t\t\t\t'displayName',\n\t\t\t\t'avatarUrl',\n\t\t\t\t'optionalValues'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} [params.runtimeId]\n\t\t * @returns {Promise} Promise of response data (Object)\n\t\t */\n\t\tlogout: {\n\t\t\tlabel: 'users.logout',\n\t\t\turl: '1/users/usersessions/current',\n\t\t\ttype: 'DELETE',\n\t\t\tqueryKeys: [\n\t\t\t\t'runtimeId'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} [params.runtimeId]\n\t\t * @returns {Promise} Promise of response data (Object)\n\t\t */\n\t\tlogoutByPut: {\n\t\t\tlabel: 'users.logoutByPut',\n\t\t\turl: '1/users/usersessions/current/logout',\n\t\t\ttype: 'PUT',\n\t\t\tqueryKeys: [\n\t\t\t\t'runtimeId'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * <b>Request DTO's:</b>\n\t\t * <ul>\n\t\t * <li><i>{OptionalRegistrationValuesDTO}</i> <b>optionalValues</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>properties</b></li>\n\t\t * <li><i>{string}</i> <b>privateProperties</b></li>\n\t\t * </ul></li>\n\t\t * </ul>\n\t\t *\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>authenticationToken</b></li>\n\t\t * <li><i>{string}</i> <b>avatarUrl</b></li>\n\t\t * <li><i>{string}</i> <b>displayName</b></li>\n\t\t * <li><i>{string}</i> <b>pttvSession</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * <li><i>{LoginCredentialStatusDTO}</i> <b>loginCredentialStatus</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>email</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * <li><i>{string}</i> <b>username</b></li>\n\t\t * <li><i>{string}</i> <b>facebookId</b></li>\n\t\t * <li><i>{IdDataDoc}</i> <b>externalIds</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>id</b></li>\n\t\t * <li><i>{Date}</i> <b>added</b></li>\n\t\t * </ul></li>\n\t\t * <li><i>{string}</i> <b>authenticationToken</b></li>\n\t\t * </ul></li>\n\t\t * <li><i>{ClientUserProfileDTO}</i> <b>profile</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>profileProperties</b></li>\n\t\t * <li><i>{string}</i> <b>privateProperties</b></li>\n\t\t * <li><i>{string}</i> <b>displayName</b></li>\n\t\t * <li><i>{string}</i> <b>avatarUrl</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * </ul></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {OptionalRegistrationValuesDTO} params.optionalValues\n\t\t * @param {string} [params.runtimeId]\n\t\t * @returns {Promise} Promise of response data (RegisterResponseDTO)\n\t\t */\n\t\tregisterAsGuest: {\n\t\t\tlabel: 'users.registerAsGuest',\n\t\t\turl: '1/users/register/guest',\n\t\t\ttype: 'POST',\n\t\t\tqueryKeys: [\n\t\t\t\t'runtimeId'\n\t\t\t],\n\t\t\tdataKeys: [\n\t\t\t\t'optionalValues'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * <b>Request DTO's:</b>\n\t\t * <ul>\n\t\t * <li><i>{OptionalRegistrationValuesDTO}</i> <b>optionalValues</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>properties</b></li>\n\t\t * <li><i>{string}</i> <b>privateProperties</b></li>\n\t\t * </ul></li>\n\t\t * </ul>\n\t\t *\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>authenticationToken</b></li>\n\t\t * <li><i>{string}</i> <b>avatarUrl</b></li>\n\t\t * <li><i>{string}</i> <b>displayName</b></li>\n\t\t * <li><i>{string}</i> <b>pttvSession</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * <li><i>{LoginCredentialStatusDTO}</i> <b>loginCredentialStatus</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>email</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * <li><i>{string}</i> <b>username</b></li>\n\t\t * <li><i>{string}</i> <b>facebookId</b></li>\n\t\t * <li><i>{IdDataDoc}</i> <b>externalIds</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>id</b></li>\n\t\t * <li><i>{Date}</i> <b>added</b></li>\n\t\t * </ul></li>\n\t\t * <li><i>{string}</i> <b>authenticationToken</b></li>\n\t\t * </ul></li>\n\t\t * <li><i>{ClientUserProfileDTO}</i> <b>profile</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>profileProperties</b></li>\n\t\t * <li><i>{string}</i> <b>privateProperties</b></li>\n\t\t * <li><i>{string}</i> <b>displayName</b></li>\n\t\t * <li><i>{string}</i> <b>avatarUrl</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * </ul></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.displayName\n\t\t * @param {string} params.avatarUrl\n\t\t * @param {string} params.email\n\t\t * @param {string} params.username\n\t\t * @param {string} params.password\n\t\t * @param {OptionalRegistrationValuesDTO} params.optionalValues\n\t\t * @param {string} [params.runtimeId]\n\t\t * @returns {Promise} Promise of response data (RegisterResponseDTO)\n\t\t */\n\t\tregisterByEmail: {\n\t\t\tlabel: 'users.registerByEmail',\n\t\t\turl: '1/users/register/email',\n\t\t\ttype: 'POST',\n\t\t\tqueryKeys: [\n\t\t\t\t'runtimeId'\n\t\t\t],\n\t\t\tdataKeys: [\n\t\t\t\t'displayName',\n\t\t\t\t'avatarUrl',\n\t\t\t\t'email',\n\t\t\t\t'username',\n\t\t\t\t'password',\n\t\t\t\t'optionalValues'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {ExternalIdType} params.type Valid values: 'FACEBOOK', 'VK'\n\t\t * @returns {Promise} Promise of response data (Object)\n\t\t */\n\t\tremoveExternalId: {\n\t\t\tlabel: 'users.removeExternalId',\n\t\t\turl: '1/users/credentials/type/{type}',\n\t\t\ttype: 'DELETE'\n\t\t},\n\n\t\t/**\n\t\t * @function\n\t\t * @returns {Promise} Promise of response data (Object)\n\t\t */\n\t\tremoveFacebookCredentials: {\n\t\t\tlabel: 'users.removeFacebookCredentials',\n\t\t\turl: '1/users/credentials/facebook',\n\t\t\ttype: 'DELETE'\n\t\t},\n\n\t\t/**\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} [params.runtimeId]\n\t\t * @returns {Promise} Promise of response data (Object)\n\t\t */\n\t\trequestDeletion: {\n\t\t\tlabel: 'users.requestDeletion',\n\t\t\turl: '1/users/',\n\t\t\ttype: 'POST',\n\t\t\tqueryKeys: [\n\t\t\t\t'runtimeId'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.email\n\t\t * @returns {Promise} Promise of response data (Object)\n\t\t */\n\t\trequestEmailChange: {\n\t\t\tlabel: 'users.requestEmailChange',\n\t\t\turl: '1/users/email/{email}',\n\t\t\ttype: 'PUT'\n\t\t},\n\n\t\t/**\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.email\n\t\t * @returns {Promise} Promise of response data (Object)\n\t\t */\n\t\trequestPasswordChange: {\n\t\t\tlabel: 'users.requestPasswordChange',\n\t\t\turl: '1/users/credentials/changepassword/email/{email}',\n\t\t\ttype: 'PUT'\n\t\t},\n\n\t\t/**\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.reason\n\t\t * @param {string} [params.runtimeId]\n\t\t * @returns {Promise} Promise of response data (Object)\n\t\t */\n\t\tscheduleUserForDeletion: {\n\t\t\tlabel: 'users.scheduleUserForDeletion',\n\t\t\turl: '1/users/scheduled',\n\t\t\ttype: 'POST',\n\t\t\tqueryKeys: [\n\t\t\t\t'runtimeId'\n\t\t\t],\n\t\t\tdataKeys: [\n\t\t\t\t'reason'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.propertyName\n\t\t * @param {string} params.value\n\t\t * @returns {Promise} Promise of response data (Object)\n\t\t */\n\t\tsetPrivateProperty: {\n\t\t\tlabel: 'users.setPrivateProperty',\n\t\t\turl: '1/users/profile/{propertyName}/private',\n\t\t\ttype: 'PUT',\n\t\t\tdataKeys: [\n\t\t\t\t'value'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.propertyName\n\t\t * @param {string} params.value\n\t\t * @returns {Promise} Promise of response data (Object)\n\t\t */\n\t\tsetProfileProperty: {\n\t\t\tlabel: 'users.setProfileProperty',\n\t\t\turl: '1/users/profile/{propertyName}',\n\t\t\ttype: 'PUT',\n\t\t\tdataKeys: [\n\t\t\t\t'value'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.displayName\n\t\t * @param {string} params.avatarUrl\n\t\t * @param {string} params.properties\n\t\t * @param {string} params.privateProperties\n\t\t * @returns {Promise} Promise of response data (Object)\n\t\t */\n\t\tupdateProfile: {\n\t\t\tlabel: 'users.updateProfile',\n\t\t\turl: '1/users/profile',\n\t\t\ttype: 'PUT',\n\t\t\tdataKeys: [\n\t\t\t\t'displayName',\n\t\t\t\t'avatarUrl',\n\t\t\t\t'properties',\n\t\t\t\t'privateProperties'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.authenticationCode\n\t\t * @returns {Promise} Promise of response data (Object)\n\t\t */\n\t\tverifyEmail: {\n\t\t\tlabel: 'users.verifyEmail',\n\t\t\turl: '1/users/verifyemail',\n\t\t\ttype: 'POST',\n\t\t\tdataKeys: [\n\t\t\t\t'authenticationCode'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.authenticationCode\n\t\t * @param {string} params.password\n\t\t * @returns {Promise} Promise of response data (Object)\n\t\t */\n\t\tverifyPasswordChange: {\n\t\t\tlabel: 'users.verifyPasswordChange',\n\t\t\turl: '1/users/password',\n\t\t\ttype: 'PUT',\n\t\t\tdataKeys: [\n\t\t\t\t'authenticationCode',\n\t\t\t\t'password'\n\t\t\t]\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.user.LocalUser', [\n\t'playtotv.model.ObjectModel',\n\t'playtotv.user.User',\n\t'playtotv.user.usersAPI'\n], function(\n\tObjectModel,\n\tUser,\n\tusersAPI\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\n\treturn class LocalUser extends User {\n\t\t/** @lends playtotv.user.LocalUser.prototype */\n\n\t\t/**\n\t\t * Local user data model class.\n\t\t *\n\t\t * @extends playtotv.user.User\n\t\t * @constructs\n\t\t * @param {playtotv.server.Server} server Server\n\t\t * @param {Object} user {@link playtotv.user.User} constructor data\n\t\t * @param {Object} [data] LocalUser data to initialize with\n\t\t * @param {Object} [data.privateProperties={}] LocalUser private property map\n\t\t * @param {string} [data.authenticationToken] LocalUser authentication token\n\t\t * @param {string} [data.pttvSession] LocalUser PlayToTV session token\n\t\t * @param {string} [data.email] LocalUser email\n\t\t * @param {string} [data.username] LocalUser username\n\t\t * @param {string} [data.facebookId] LocalUser Facebook ID\n\t\t *\n\t\t * @property {playtotv.storage.Storage} storage LocalUser storage\n\t\t * @property {playtotv.model.ObjectModel} privateProperties LocalUser private property map\n\t\t * @property {string} authenticationToken LocalUser authentication token\n\t\t * @property {string} pttvSession LocalUser PlayToTV session token\n\t\t * @property {string} email LocalUser email\n\t\t * @property {string} username LocalUser username\n\t\t * @property {string} facebookId LocalUser Facebook ID\n\t\t */\n\t\tconstructor(server, user, data) {\n\t\t\tdata = ptv.params(data, {\n\t\t\t\tprivateProperties: {},\n\t\t\t\tauthenticationToken: undefined,\n\t\t\t\tpttvSession: undefined,\n\t\t\t\temail: undefined,\n\t\t\t\tusername: undefined,\n\t\t\t\tfacebookId: undefined\n\t\t\t});\n\n\t\t\tsuper(server, user);\n\n\t\t\tthis.storage = server.storage.subStorage('user/' + user.id + '/');\n\n\t\t\tthis.copyProperties({\n\t\t\t\tprivateProperties: new ObjectModel(data.privateProperties),\n\t\t\t\tauthenticationToken: data.authenticationToken,\n\t\t\t\tpttvSession: data.pttvSession,\n\t\t\t\temail: data.email,\n\t\t\t\tusername: data.username,\n\t\t\t\tfacebookId: data.facebookId\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Calls {@link playtotv.user.usersAPI.updateProfile} with this LocalUser's displayName,\n\t\t * avatarUrl, profileProperties and privateProperties.\n\t\t *\n\t\t * @returns {Promise} Promise of server response\n\t\t */\n\t\tupdateProfile() {\n\t\t\treturn this.server.call(usersAPI.updateProfile, {\n\t\t\t\tdisplayName: this.displayName || null,\n\t\t\t\tavatarUrl: this.avatarUrl || null,\n\t\t\t\tproperties: this.profileProperties.toObject(),\n\t\t\t\tprivateProperties: this.privateProperties.toObject()\n\t\t\t});\n\t\t}\n\n\t\t/** Dispose */\n\t\tdispose() {\n\t\t\tthis.privateProperties.dispose();\n\t\t\tUser.prototype.dispose.call(this);\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.user.UserController', [\n\t'playtotv.mvc.Controller',\n\t'playtotv.user.usersAPI'\n], function(\n\tController,\n\tusersAPI\n) {\n\n\t// Note: This just does automatic registerAsGuest and loginByAuthenticationToken for now\n\t// TODO: Complete this with manual (email, ..) login support and then remove UserManager, User and LocalUser\n\t// TODO: Add support for 463\n\t// TODO: Add support for 401 if necessary\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar log = ptv.Logger.get(this.id);\n\n\treturn class UserController extends Controller {\n\t\tconstructor(context) {\n\t\t\tvar stored = context.stored || {};\n\t\t\tsuper(context, {\n\t\t\t\tmodel: {\n\t\t\t\t\tcurrent: stored.current || null,\n\t\t\t\t\tonline: false\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.addMethods([\n\t\t\t\t'logout',\n\t\t\t\t'getPrivateProperty',\n\t\t\t\t'setPrivateProperty',\n\t\t\t\t'updateProfile',\n\t\t\t\t'extendPrivateProfile'\n\t\t\t]);\n\n\t\t\tthis.login();\n\t\t}\n\n\t\tloginBy(method, params) {\n\t\t\treturn this.scope.call('server.call', method, params).then(user => {\n\t\t\t\tthis.set('current', user);\n\n\t\t\t\t// Note: current user model property is persisted in storage for fast resume and offline support\n\t\t\t\t// Things depending on user being logged in for sure should wait for this\n\t\t\t\tthis.set('online', true);\n\n\t\t\t\treturn user;\n\t\t\t});\n\t\t}\n\n\t\tloginByToken() {\n\t\t\tvar user = this.model.current;\n\t\t\tvar authenticationToken = user && user.authenticationToken;\n\t\t\treturn !authenticationToken ? Promise.reject() :\n\t\t\t\tthis.loginBy(usersAPI.loginByAuthenticationToken, {\n\t\t\t\t\tauthenticationToken: authenticationToken\n\t\t\t\t});\n\t\t}\n\n\t\tregisterAsGuest() {\n\t\t\treturn this.loginBy(usersAPI.registerAsGuest, {\n\t\t\t\toptionalValues: null\n\t\t\t});\n\t\t}\n\n\t\tlogin() {\n\t\t\treturn this.loginByToken().catch(() => {\n\t\t\t\t// TODO: if mode is guest then registerAsGuest else set waiting true and wait for manual login\n\t\t\t\treturn this.registerAsGuest().catch(error => {\n\t\t\t\t\tlog.e('login(): registerAsGuest failed, retrying in 5s', error);\n\t\t\t\t\treturn Promise.delay(5000).then(() => this.login());\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tlogout() {\n\t\t\treturn this.scope.call('server.call', usersAPI.logout).finally(() => {\n\t\t\t\t// Reset (and reload) is a rough but simple solution to a rarely used feature\n\t\t\t\t// Makes the dealing with this easier for all controllers\n\t\t\t\tthis.scope.reset();\n\t\t\t});\n\t\t}\n\n\t\tgetPrivateProperty(name) {\n\t\t\tvar user = this.model.current;\n\t\t\treturn user && user.profile.privateProperties[name];\n\t\t}\n\n\t\tsetPrivateProperty(name, value) {\n\t\t\tvar user = this.model.current;\n\t\t\treturn this.scope.call('server.call', usersAPI.setPrivateProperty, {\n\t\t\t\tpropertyName: name,\n\t\t\t\tvalue: value\n\t\t\t}).then(() => {\n\t\t\t\tuser.profile.privateProperties[name] = value;\n\t\t\t\tthis.publish('set-private-property-' + name, value);\n\t\t\t});\n\t\t}\n\n\t\tupdateProfile(data) {\n\t\t\tvar user = this.model.current;\n\t\t\tdata = ptv.params(data, {\n\t\t\t\tdisplayName: user.displayName || null,\n\t\t\t\tavatarUrl: user.avatarUrl || null,\n\t\t\t\tproperties: user.profile.profileProperties,\n\t\t\t\tprivateProperties: user.profile.privateProperties\n\t\t\t});\n\t\t\treturn this.scope.call('server.call', usersAPI.updateProfile, data).then(() => {\n\t\t\t\tuser.displayName = data.displayName;\n\t\t\t\tuser.avatarUrl = data.avatarUrl;\n\t\t\t\tuser.profile.profileProperties = data.properties;\n\t\t\t\tuser.profile.privateProperties = data.privateProperties;\n\t\t\t\tthis.publish('update-profile', data);\n\t\t\t});\n\t\t}\n\n\t\textendPrivateProfile(properties) {\n\t\t\tvar user = this.model.current;\n\t\t\treturn this.updateProfile({\n\t\t\t\tprivateProperties: Object.assign({}, user.profile.privateProperties, properties)\n\t\t\t});\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.user.UserManager', [\n\t'playtotv.pubsub.PubSub',\n\t'playtotv.user.LocalUser',\n\t'playtotv.user.usersAPI'\n], function(\n\tPubSub,\n\tLocalUser,\n\tusersAPI\n) {\n\n\t'use strict';\n\n\t// TODO: Check that is alright that we no longer bother about X-PlayToTV-Session header\n\t// TODO: Add: get(id) // get user from cache or server\n\n\tvar ptv = playtotv;\n\tvar REQUIRED = ptv.REQUIRED;\n\n\treturn class UserManager extends PubSub {\n\t\t/** @lends playtotv.user.UserManager.prototype */\n\n\t\t/**\n\t\t * User manager class.\n\t\t *\n\t\t * <ul>\n\t\t * <li>Facilitates making registration, login and logout server calls.\n\t\t * <li>Will instantiate and keep track of a {@link playtotv.user.LocalUser} instance reference.\n\t\t * <li>Can also keep track of authentication token and method using {@link playtotv.server.Server#storage}.\n\t\t * <li>Will deal with user session expiry (e.g: status 463)\n\t\t * </ul>\n\t\t *\n\t\t * @extends playtotv.pubsub.PubSub\n\t\t * @constructs\n\t\t * @param {playtotv.server.Server} server Server\n\t\t *\n\t\t * @property {playtotv.server.Server} server Server\n\t\t * @property {playtotv.storage.Storage} storage Storage\n\t\t * @property {string} authenticationMethod Persisted last used authentication method\n\t\t * @property {string} authenticationToken Persisted authentication token\n\t\t * @property {playtotv.user.LocalUser} localUser Local user\n\t\t */\n\t\tconstructor(server) {\n\t\t\tsuper();\n\n\t\t\t/**\n\t\t\t* Base server login and register call params.\n\t\t\t* @type {Object}\n\t\t\t*/\n\t\t\tthis.baseParams = {\n\t\t\t\tdisplayName: null, // data key, so required, but not really required by server, so null\n\t\t\t\tavatarUrl: null, // data key, so required, but not really required by server, so null\n\t\t\t\truntimeId: undefined\n\t\t\t};\n\n\t\t\t/**\n\t\t\t* Optional server register call params.\n\t\t\t* @type {Object}\n\t\t\t*/\n\t\t\tthis.optionalParams = {\n\t\t\t\tteamTag: undefined,\n\t\t\t\temailOptinMode: undefined,\n\t\t\t\tproperties: undefined,\n\t\t\t\tprivateProperties: undefined\n\t\t\t};\n\n\t\t\tthis.server = server;\n\t\t\tvar storage = this.storage = server.storage;\n\t\t\tthis.authenticationMethod = storage.get('authenticationMethod');\n\t\t\tthis.authenticationToken = storage.get('authenticationToken');\n\t\t\tthis.localUser = null;\n\n\t\t\tthis.onServerReject = this.onServerReject.bind(this);\n\t\t\tserver.rejectTaps.push(this.onServerReject);\n\t\t}\n\n\t\t/**\n\t\t * Save authentication method and token and persist them in storage.\n\t\t *\n\t\t * @param {string} method Authentication method\n\t\t * @param {string} token Authentication token\n\t\t */\n\t\tsaveAuthentication(method, token) {\n\t\t\tthis.authenticationMethod = method;\n\t\t\tthis.storage.set('authenticationMethod', method);\n\t\t\tthis.authenticationToken = token;\n\t\t\tthis.storage.set('authenticationToken', token);\n\t\t}\n\n\t\t/**\n\t\t * Login with specified server method and params and then:\n\t\t * <ul>\n\t\t * <li>If we already have a local user reference then call {@link playtotv.user.UserManager#onLogout}\n\t\t * <li>Create a new LocalUser instance using the returned data and change local user reference to it\n\t\t * <li>Save and persist local user authentication token if remember is true\n\t\t * <li>Publish local user reference to 'login' channel\n\t\t * </ul>\n\t\t *\n\t\t * @param {Object} method Server call method\n\t\t * @param {Object} [params] Server call params\n\t\t * @param {boolean} [remember=false] Whether to save and persist authentication token for future logins\n\t\t * @returns {Promise} Promise of logged in {@link playtotv.user.LocalUser}\n\t\t */\n\t\tlogin(method, params, remember) {\n\t\t\treturn this.server.call(method, params).then(function(data) {\n\t\t\t\tvar token = data.authenticationToken;\n\t\t\t\tvar profile = data.profile || {};\n\t\t\t\tvar credentials = data.loginCredentialStatus || {};\n\n\t\t\t\tif (this.localUser) {\n\t\t\t\t\tthis.onLogout();\n\t\t\t\t}\n\n\t\t\t\tvar localUser = new LocalUser(this.server, {\n\t\t\t\t\tid: data.userId,\n\t\t\t\t\tdisplayName: data.displayName,\n\t\t\t\t\tavatarUrl: data.avatarUrl,\n\t\t\t\t\tprofileProperties: profile.profileProperties\n\t\t\t\t}, {\n\t\t\t\t\tprivateProperties: profile.privateProperties,\n\t\t\t\t\tauthenticationToken: token,\n\t\t\t\t\tpttvSession: data.pttvSession,\n\t\t\t\t\temail: credentials.email,\n\t\t\t\t\tusername: credentials.username,\n\t\t\t\t\tfacebookId: credentials.facebookId\n\t\t\t\t});\n\t\t\t\tthis.localUser = localUser;\n\n\t\t\t\tif (remember) {\n\t\t\t\t\tthis.saveAuthentication(method.label, token);\n\t\t\t\t}\n\n\t\t\t\tthis.publish('login', localUser);\n\n\t\t\t\treturn localUser;\n\t\t\t}.bind(this));\n\t\t}\n\n\t\t/**\n\t\t * Moves teamTag, emailOptinMode, properties and privateProperties into optionalValues sub params to match\n\t\t * request params structure expected by server.\n\t\t *\n\t\t * @param {Object} params Server register call params\n\t\t * @returns {Object} Server register call params with nested optionalValues\n\t\t */\n\t\tprocessParams(params) {\n\t\t\tvar optionalKeys = Object.keys(this.optionalParams);\n\t\t\tparams.optionalValues = ptv.pick(params, optionalKeys);\n\t\t\treturn ptv.omit(params, optionalKeys);\n\t\t}\n\n\t\t/**\n\t\t * Shortcut to {@link playtotv.user.UserManager#login} with\n\t\t * {@link playtotv.user.usersAPI.registerAsGuest}.\n\t\t *\n\t\t * @param {Object} [params] Parameters\n\t\t * @param {string} [params.displayName] Display name\n\t\t * @param {string} [params.avatarUrl] Avatar URL\n\t\t * @param {string} [params.runtimeId] Runtime ID\n\t\t * @param {string} [params.teamTag] Team tag\n\t\t * @param {string} [params.emailOptinMode] Email opt-in mode (UNDECIDED/OPTED_IN/OPTED_OUT)\n\t\t * @param {Object} [params.properties] Profile properties\n\t\t * @param {Object} [params.privateProperties] Private properties\n\t\t * @param {boolean} [remember=false] Whether to save and persist authentication token for future logins\n\t\t * @returns {Promise} Promise of logged in {@link playtotv.user.LocalUser}\n\t\t */\n\t\tregisterAsGuest(params, remember) {\n\t\t\tparams = ptv.params(params, Object.assign({}, this.baseParams, this.optionalParams));\n\t\t\tparams = this.processParams(params);\n\t\t\treturn this.login(usersAPI.registerAsGuest, params, remember);\n\t\t}\n\n\t\t/**\n\t\t * Shortcut to {@link playtotv.user.UserManager#login} with\n\t\t * {@link playtotv.user.usersAPI.registerByEmail}.\n\t\t *\n\t\t * @param {Object} params Parameters\n\t\t * @param {string} params.email Email\n\t\t * @param {string} params.password Password\n\t\t * @param {string} [params.username] Username\n\t\t * @param {string} [params.displayName] Display name\n\t\t * @param {string} [params.avatarUrl] Avatar URL\n\t\t * @param {string} [params.runtimeId] Runtime ID\n\t\t * @param {string} [params.teamTag] Team tag\n\t\t * @param {string} [params.emailOptinMode] Email opt-in mode (UNDECIDED/OPTED_IN/OPTED_OUT)\n\t\t * @param {Object} [params.properties] Profile properties\n\t\t * @param {Object} [params.privateProperties] Private properties\n\t\t * @param {boolean} [remember=false] Whether to save and persist authentication token for future logins\n\t\t * @returns {Promise} Promise of logged in {@link playtotv.user.LocalUser}\n\t\t */\n\t\tregisterByEmail(params, remember) {\n\t\t\tparams = ptv.params(params, Object.assign({\n\t\t\t\temail: REQUIRED,\n\t\t\t\tpassword: REQUIRED,\n\t\t\t\tusername: null // data key, so required, but not really required by server, so null\n\t\t\t}, this.baseParams, this.optionalParams));\n\t\t\tparams = this.processParams(params);\n\t\t\treturn this.login(usersAPI.registerByEmail, params, remember);\n\t\t}\n\n\t\t/**\n\t\t * Shortcut to {@link playtotv.user.UserManager#login} with\n\t\t * {@link playtotv.user.usersAPI.loginByEmail}.\n\t\t *\n\t\t * @param {Object} params Parameters\n\t\t * @param {string} params.email Email\n\t\t * @param {string} params.password Password\n\t\t * @param {boolean} [params.rememberMe=false] Cookie based remember-me (token is recommended instead)\n\t\t * @param {string} [params.displayName] Display name\n\t\t * @param {string} [params.avatarUrl] Avatar URL\n\t\t * @param {string} [params.runtimeId] Runtime ID\n\t\t * @param {boolean} [remember=false] Whether to save and persist authentication token for future logins\n\t\t * @returns {Promise} Promise of logged in {@link playtotv.user.LocalUser}\n\t\t */\n\t\tloginByEmail(params, remember) {\n\t\t\tparams = ptv.params(params, Object.assign({\n\t\t\t\temail: REQUIRED,\n\t\t\t\tpassword: REQUIRED,\n\t\t\t\trememberMe: false\n\t\t\t}, this.baseParams));\n\t\t\treturn this.login(usersAPI.loginByEmail, params, remember);\n\t\t}\n\n\t\t/**\n\t\t * Shortcut to {@link playtotv.user.UserManager#login} with\n\t\t * {@link playtotv.user.usersAPI.loginByFacebook}.\n\t\t *\n\t\t * @param {Object} params Parameters\n\t\t * @param {string} params.facebookId Facebook ID\n\t\t * @param {string} params.fbsr Facebook signed request token\n\t\t * @param {string} [params.displayName] Display name\n\t\t * @param {string} [params.avatarUrl] Avatar URL\n\t\t * @param {string} [params.runtimeId] Runtime ID\n\t\t * @param {string} [params.teamTag] Team tag\n\t\t * @param {string} [params.emailOptinMode] Email opt-in mode (UNDECIDED/OPTED_IN/OPTED_OUT)\n\t\t * @param {Object} [params.properties] Profile properties\n\t\t * @param {Object} [params.privateProperties] Private properties\n\t\t * @param {boolean} [remember=false] Whether to save and persist authentication token for future logins\n\t\t * @returns {Promise} Promise of logged in {@link playtotv.user.LocalUser}\n\t\t */\n\t\tloginByFacebook(params, remember) {\n\t\t\tparams = ptv.params(params, Object.assign({\n\t\t\t\tfacebookId: REQUIRED,\n\t\t\t\tfbsr: REQUIRED\n\t\t\t}, this.baseParams, this.optionalParams));\n\t\t\tparams = this.processParams(params);\n\t\t\treturn this.login(usersAPI.loginByFacebook, params, remember);\n\t\t}\n\n\t\t/**\n\t\t * Call {@link playtotv.user.usersAPI.addFacebookCredentials} on server.\n\t\t *\n\t\t * This will reject directly without making a server call in case this.localUser is undefined or in case\n\t\t * this.localUser.facebookId is already defined.\n\t\t *\n\t\t * If the call succeeds this.localUser's facebookId property is changed to specified facebookId.\n\t\t *\n\t\t * @param {Object} params Parameters\n\t\t * @param {string} params.facebookId Facebook ID\n\t\t * @param {string} params.fbsr Facebook signed request token\n\t\t * @returns {Promise} Promise of {@link playtotv.user.LocalUser}\n\t\t */\n\t\taddFacebookCredentials(params) {\n\t\t\tparams = ptv.params(params, {\n\t\t\t\tfacebookId: REQUIRED,\n\t\t\t\tfbsr: REQUIRED\n\t\t\t});\n\t\t\tvar localUser = this.localUser;\n\t\t\tif (!localUser) {\n\t\t\t\treturn Promise.reject(new Error('Not logged in'));\n\t\t\t}\n\t\t\tif (localUser.facebookId) {\n\t\t\t\treturn Promise.reject(new Error('Local user already has Facebook Id'));\n\t\t\t}\n\t\t\treturn this.server.call(usersAPI.addFacebookCredentials, params).then(function() {\n\t\t\t\tlocalUser.changeProperty('facebookId', params.facebookId);\n\t\t\t\treturn localUser;\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Call {@link playtotv.user.usersAPI.removeFacebookCredentials} on server.\n\t\t *\n\t\t * This will reject directly without making a server call in case this.localUser or this.localUser.facebookId\n\t\t * is undefined.\n\t\t *\n\t\t * If the call succeeds this.localUser's facebookId property is changed to undefined.\n\t\t *\n\t\t * @returns {Promise} Promise of {@link playtotv.user.LocalUser}\n\t\t */\n\t\tremoveFacebookCredentials() {\n\t\t\tvar localUser = this.localUser;\n\t\t\tif (!localUser) {\n\t\t\t\treturn Promise.reject(new Error('Not logged in'));\n\t\t\t}\n\t\t\tif (!localUser.facebookId) {\n\t\t\t\treturn Promise.reject(new Error('Local user does not have Facebook Id'));\n\t\t\t}\n\t\t\treturn this.server.call(usersAPI.removeFacebookCredentials).then(function() {\n\t\t\t\tlocalUser.changeProperty('facebookId', undefined);\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Shortcut to {@link playtotv.user.UserManager#login} with\n\t\t * {@link playtotv.user.usersAPI.loginByAuthenticationToken}.\n\t\t *\n\t\t * If params.authenticationToken and this.authenticationToken are both undefined this will reject directly\n\t\t * without making a server call.\n\t\t *\n\t\t * @param {Object} [params] Parameters\n\t\t * @param {string} [params.authenticationToken=this.authenticationToken] Authentication token\n\t\t * @param {boolean} [params.rememberMe=false] Cookie based remember-me (token is recommended instead)\n\t\t * @param {string} [params.displayName] Display name\n\t\t * @param {string} [params.avatarUrl] Avatar URL\n\t\t * @param {string} [params.runtimeId] Runtime ID\n\t\t * @returns {Promise} Promise of logged in {@link playtotv.user.LocalUser}\n\t\t */\n\t\tloginByToken(params) {\n\t\t\tparams = ptv.params(params, Object.assign({\n\t\t\t\tauthenticationToken: this.authenticationToken\n\t\t\t}, this.baseParams));\n\t\t\treturn params.authenticationToken ?\n\t\t\t\tthis.login(usersAPI.loginByAuthenticationToken, params) :\n\t\t\t\tPromise.reject(new Error('Missing required parameter: authenticationToken'));\n\t\t}\n\n\t\t/**\n\t\t * Logout from server and optionally remove local user authentication token from instance and storage.\n\t\t *\n\t\t * @param {boolean} [forget=false] Whether to remove authentication token that was stored for future logins\n\t\t * @returns {Promise} Promise of logged out {@link playtotv.user.LocalUser}\n\t\t */\n\t\tlogout(forget) {\n\t\t\tif (forget) {\n\t\t\t\tthis.saveAuthentication(null, null);\n\t\t\t}\n\t\t\treturn this.server.call(usersAPI.logout).then(function() {\n\t\t\t\treturn this.onLogout();\n\t\t\t}.bind(this));\n\t\t}\n\n\t\t/**\n\t\t * Calls this.localUser.dispose and publishes localUser to 'logout' channel.\n\t\t *\n\t\t * If this.localUser is null then this simply returns null.\n\t\t *\n\t\t * @returns {playtotv.user.LocalUser} Logged out local user\n\t\t */\n\t\tonLogout() {\n\t\t\tvar localUser = this.localUser;\n\t\t\tif (localUser) {\n\t\t\t\tlocalUser.dispose();\n\t\t\t\tthis.localUser = null;\n\t\t\t\tthis.publish('logout', localUser);\n\t\t\t}\n\t\t\treturn localUser;\n\t\t}\n\n\t\t/**\n\t\t * User session expiry handler.\n\t\t *\n\t\t * <ul>\n\t\t * <li>Changes this.authenticationMethod and authenticationToken to null\n\t\t * <li>If this.localUser is defined it is published to 'expire'\n\t\t * <li>Calls {@link playtotv.user.UserManager#onLogout}\n\t\t * </ul>\n\t\t */\n\t\tonExpire() {\n\t\t\tvar localUser = this.localUser;\n\t\t\tthis.authenticationMethod = null;\n\t\t\tthis.authenticationToken = null;\n\t\t\tif (localUser) {\n\t\t\t\tthis.publish('expire', localUser);\n\t\t\t\tthis.onLogout();\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Server rejection tap handler.\n\t\t *\n\t\t * Calls {@link playtotv.user.UserManager#onExpire} if reason.status equals 463.\n\t\t *\n\t\t * TODO: Also facilitate handling of 401 and 403\n\t\t */\n\t\tonServerReject(reason) {\n\t\t\tif (reason.status === 463) {\n\t\t\t\tthis.onExpire();\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Dispose.\n\t\t */\n\t\tdispose() {\n\t\t\tvar rejectTaps = this.server.rejectTaps;\n\t\t\trejectTaps.splice(rejectTaps.indexOf(this.onServerReject), 1);\n\n\t\t\tvar localUser = this.localUser;\n\t\t\tif (localUser) {\n\t\t\t\tlocalUser.dispose();\n\t\t\t}\n\n\t\t\tPubSub.prototype.dispose.call(this);\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.widget.CountdownWidget', [\n\t'playtotv.widget.Widget'\n], function(\n\tWidget\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar util = ptv.util;\n\n\treturn class CountdownWidget extends Widget {\n\n\t\tconstructor(node, options) {\n\t\t\tptv.params(options, {\n\t\t\t\tapp: null,\n\t\t\t\ttime: ptv.REQUIRED\n\t\t\t});\n\n\t\t\tsuper(node);\n\n\t\t\tthis.time = options.time;\n\n\t\t\tthis.dd = $('.dd', node);\n\t\t\tthis.hh = $('.hh', node);\n\t\t\tthis.mm = $('.mm', node);\n\t\t\tthis.ss = $('.ss', node);\n\n\t\t\tthis.update();\n\t\t}\n\n\t\tupdate() {\n\t\t\tif (!this.node) {\n\t\t\t\treturn; // disposed\n\t\t\t}\n\n\t\t\tvar time = Math.max(0, this.time - Date.now()) / 1000;\n\n\t\t\tthis.updateDigit(this.dd, time / 86400);\n\t\t\tthis.updateDigit(this.hh, (time % 86400 ) / 3600);\n\t\t\tthis.updateDigit(this.mm, (time % 3600) / 60);\n\t\t\tthis.updateDigit(this.ss, time % 60);\n\n\t\t\tsetTimeout(() => this.update(), 1000);\n\t\t}\n\n\t\tupdateDigit(node, time) {\n\t\t\tif (node) {\n\t\t\t\tnode.innerHTML = util.pad(Math.floor(time));\n\t\t\t}\n\t\t}\n\t};\n});\n",
		"/*jshint maxparams:100*/\nplaytotv.define('playtotv.widget.DraggableWidget', [\n\t'playtotv.widget.Widget',\n\t'playtotv.css.Vector',\n\t'playtotv.fx.Transition',\n\t'playtotv.animationFrame',\n\t'playtotv.css.style',\n\t'playtotv.touch.touchManager'\n], function(\n\tWidget,\n\tVector,\n\tTransition,\n\tanimationFrame,\n\tstyle,\n\ttouchManager\n) {\n\n\t'use strict';\n\n\t/**\n\t * Shorthands\n\t *\n\t */\n\n\tvar ptv = playtotv;\n\tvar event = ptv.event;\n\n\tvar STATE_PASSIVE = 1;\n\tvar STATE_ACTIVE = 2;\n\n\tvar nativeTouch = 'ontouchstart' in window;\n\n\t/**\n\t * DraggableWidget element, used or extended by various UI components.\n\t * This widget requires em:touch[type] events to be enabled either on its own node, or an ascendant, using\n\t * {@link playtotv.touch.touchManager}.\n\t *\n\t * @name DraggableWidget\n\t * @class\n\t * @memberOf playtotv.widget\n\t * @extends playtotv.widget.Widget\n\t * @param {Node} node\n\t * @param {Object} [options]\n\t * @param {number} [options.orientation=Vector.VERTICAL] dragging orientation\n\t * @param {string} [options.restrict='inside'] Movement restriction, based on element size in respect to container\n\t * @param {boolean} [options.elastic=false] Let element be dragged beyond its limits (although heavily reduced)\n\t * @param {boolean} [options.inertia=false] Let element have inertia and be flung on release.\n\t * @param {boolean} [options.friction=30] Inertia friction, a lower value flings farther and longer.\n\t * @param {boolean} [options.priority=false] Let element claim events regardless of orientation, stops propagation.\n\t * @param {string} [options.handle] Selector for a child node by which the draggable node is actually dragged\n\t */\n\treturn class DraggableWidget extends Widget {\n\n\t\tconstructor(node, options) {\n\t\t\tsuper(node);\n\n\t\t\tif (!touchManager.isCaptured(node)) {\n\t\t\t\t// TODO: capture locally with release on dispose? nesting IS possible ...\n\t\t\t\tthrow new Error('Required events not captured via playtotv.touch');\n\t\t\t}\n\n\t\t\toptions = ptv.params(options, {\n\t\t\t\torientation: Vector.VERTICAL,\n\t\t\t\trestrict: 'inside',\n\t\t\t\telastic: false,\n\t\t\t\tinertia: false,\n\t\t\t\tfriction: 50,\n\t\t\t\tpriority: false,\n\t\t\t\thandle: null\n\t\t\t});\n\n\t\t\tthis.start = Vector.ZERO;\n\t\t\tthis.position = Vector.ZERO;\n\t\t\tthis.transition = new Transition({\n\t\t\t\tcallback: this.handleAnim,\n\t\t\t\tduration: 1000,\n\t\t\t\teasing: 'cubicout'\n\t\t\t});\n\n\t\t\tthis.orientation = options.orientation;\n\t\t\tthis.elastic = options.elastic;\n\t\t\tthis.priority = options.priority;\n\t\t\tthis.inertia = options.inertia;\n\t\t\tthis.friction = options.friction;\n\n\t\t\tthis.outside = /outside/i.test(options.restrict) ? true : false;\n\t\t\tthis.limiter = new Vector(\n\t\t\t\tthis.orientation === Vector.VERTICAL ? 0 : 1,\n\t\t\t\tthis.orientation === Vector.HORIZONTAL ? 0 : 1\n\t\t\t);\n\n\t\t\tthis.restricter = this.limiter.multiplyBy(0.75);\n\n\t\t\tvar handle = options.handle;\n\t\t\tif (handle) {\n\t\t\t\tnode = $(handle, node) || node;\n\t\t\t}\n\n\t\t\tptv.bindMethods(this, [\n\t\t\t\t'handleSwipe',\n\t\t\t\t'handleFrame',\n\t\t\t\t'handleAnim',\n\t\t\t\t'dragStart',\n\t\t\t\t'dragMove',\n\t\t\t\t'dragEnd'\n\t\t\t]);\n\n\t\t\tthis.addEventListener(node, 'em:touchstart', this.dragStart);\n\t\t\tthis.addEventListener(node, 'em:touchmove', this.dragMove);\n\t\t\tthis.addEventListener(node, 'em:touchend', this.dragEnd);\n\t\t\tthis.addEventListener(node, 'em:swipe', this.handleSwipe);\n\n\t\t\tthis.setup();\n\t\t\tthis.moveTo(this.start);\n\t\t}\n\n\t\t/** @lends playtotv.widget.DraggableWidget.prototype */\n\n\t\t/**\n\t\t * Checks various element properties on drag start for limiting, swiping, etc. Must set this.space, this.min\n\t\t * and this.max members when redefined in subclasses.\n\t\t */\n\t\tsetup() {\n\t\t\tvar node = this.node;\n\n\t\t\tthis.content = style.getSize(node);\n\t\t\tthis.view = style.getInnerSize(node.parentNode);\n\t\t\tthis.space = this.view.subtract(this.content).multiply(this.limiter);\n\t\t\tthis.min = this.space.min(Vector.ZERO);\n\t\t\tthis.max = this.outside ? Vector.ZERO : this.space.max(Vector.ZERO);\n\t\t}\n\n\t\tsetState(state) {\n\t\t\tthis.state = state;\n\t\t}\n\n\t\tgetState() {\n\t\t\treturn this.state;\n\t\t}\n\n\t\trequestFrame() {\n\t\t\tthis.request = animationFrame.request(this.handleFrame);\n\t\t}\n\n\t\tcancelFrame() {\n\t\t\tif (this.request) {\n\t\t\t\tanimationFrame.cancel(this.request);\n\t\t\t\tdelete this.request;\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Internal dragstart handler, initialized a draggable sequence, and fires a 'em:dragstart' event.\n\t\t * @param {Event|playtotv.event.Event} event\n\t\t *\n\t\t */\n\t\tdragStart(e) {\n\t\t\t// prevent start event for native mouse and pointer implementations to prevent native drag behavior.\n\t\t\t// don't prevent for native touch implementations, as this prevents a native click on touchend, which may\n\t\t\t// not be fired by the fastClick option depending on device and app properties.\n\t\t\tif (!nativeTouch) {\n\t\t\t\te.preventDefault();\n\t\t\t}\n\n\t\t\t// follow only this touch, in case more than one finger enters the fray\n\t\t\tthis.touchId = e.detail.sequence.id;\n\n\t\t\t// disallow propagation only if instance has priority\n\t\t\tif (this.priority) {\n\t\t\t\te.stopPropagation();\n\t\t\t}\n\n\t\t\tif (this.transition.playing) {\n\t\t\t\tthis.transition.stop();\n\t\t\t\tthis.setState(STATE_PASSIVE);\n\t\t\t}\n\n\t\t\tthis.start = this.position;\n\t\t\tthis.lastOrientation = null;\n\t\t\tthis.setup();\n\n\t\t\tevent.dispatchEvent(this.node, 'em:dragstart', false, false, { offset: this.position });\n\t\t}\n\n\t\t/**\n\t\t * internal dragmove handler, checks movement, and sends a restricted position to this.moveTo. Prevents event\n\t\t * propagation if the event's orientation matches this instance's orientation, for nested components.\n\t\t * @param {Event|playtotv.event.Event} event\n\t\t */\n\t\tdragMove(e) {\n\t\t\tif (this.hasPriority(e)) {\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\n\t\t\t\tvar sequence = e.detail.sequence;\n\t\t\t\tvar target = this.start.add(sequence.offset);\n\t\t\t\tvar restricted = this.restrict(target, this.elastic);\n\t\t\t\tthis.position = restricted;\n\n\t\t\t\t// start animating when actual dragging starts\n\t\t\t\tif (this.getState() !== STATE_ACTIVE) {\n\t\t\t\t\tthis.setState(STATE_ACTIVE);\n\t\t\t\t\tthis.requestFrame();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Internal dragend handler. Checks event orientation and inertia to fire an optional swipe.\n\t\t *\n\t\t * @param {Event|playtotv.event.Event} event\n\t\t */\n\t\tdragEnd(e) {\n\t\t\tif (this.hasPriority(e)) {\n\t\t\t\tif (!nativeTouch) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t}\n\n\t\t\t\te.stopPropagation();\n\n\t\t\t\tdelete this.touchId;\n\n\t\t\t\tif (this.inertia) {\n\t\t\t\t\tvar sequence = e.detail.sequence;\n\t\t\t\t\tvar velocity = sequence.velocity;\n\t\t\t\t\tvar factor = Math.sqrt(velocity.magnitude()) / this.friction;\n\t\t\t\t\tvar time = this.pulling ? 300 : (factor * 1000);\n\t\t\t\t\tthis.swipe(velocity.multiplyBy(factor), time);\n\t\t\t\t} else {\n\t\t\t\t\tthis.handleStopped();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Internal swipe event handler. Prevents event propagation if the event's orientation matches this instance's\n\t\t * orientation, for nested components.\n\t\t *\n\t\t * @param {Event|playtotv.event.Event} event\n\t\t */\n\t\thandleSwipe(e) {\n\t\t\tif (this.hasPriority(e)) {\n\t\t\t\te.stopPropagation();\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Checks the event and returns a boolean whether the event may be claimed, and its propagation stopped.\n\t\t *\n\t\t * @param {Event|playtotv.event.Event} event\n\t\t * @returns {boolean} priority\n\t\t */\n\t\thasPriority(e) {\n\t\t\tvar requested = this.orientation;\n\t\t\tvar sequence = e.detail.sequence;\n\t\t\treturn (sequence.id === this.touchId) &&\n\t\t\t\t(this.priority || !requested || (this.getOrientation(sequence) === requested));\n\t\t}\n\n\t\t/**\n\t\t * Updates the on screen position of the node while dragging,\n\t\t *\n\t\t */\n\t\thandleFrame() {\n\t\t\tthis.moveTo(this.position);\n\t\t\tthis.requestFrame();\n\t\t}\n\n\t\t/**\n\t\t * Internal end handler when the draggable node has come to a full stop.\n\t\t *\n\t\t */\n\t\thandleStopped() {\n\t\t\tthis.cancelFrame();\n\t\t\tthis.setState(STATE_PASSIVE);\n\t\t\tevent.dispatchEvent(this.node, 'em:dragend', false, false, { offset: this.position });\n\t\t}\n\n\t\t/**\n\t\t * Moves this.node to the given position (unrestricted) and fires a 'em:dragmove' event.\n\t\t * @param {playtotv.css.Vector} position\n\t\t */\n\t\tmoveTo(position) {\n\t\t\tthis.position = position;\n\t\t\tstyle.setTranslate(this.node, position);\n\t\t\tevent.dispatchEvent(this.node, 'em:dragmove', false, false, { offset: position });\n\t\t}\n\n\t\t/**\n\t\t * Moves this.node by the given vector (unrestricted) via this.moveTo\n\t\t * @param {playtotv.css.Vector} vector\n\t\t */\n\t\tmoveBy(vector) {\n\t\t\tvar position = this.position.add(vector);\n\t\t\tthis.moveTo(position);\n\t\t}\n\n\t\t/**\n\t\t * Animates a target node into view, aligning it with the top-left edge of the view. The target node\n\t\t * must be a childnode of this instance's one, and content should exceed viewsize for best effect.\n\t\t *\n\t\t * @param {Node} target\n\t\t * @param {number} [time=1000]\n\t\t */\n\t\tmoveIntoView(target, time) {\n\t\t\tif (!this.node.contains(target)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.setup();\n\t\t\tthis.swipeTo(Vector.ZERO.subtract(\n\t\t\t\tstyle.getOffset(target)\n\t\t\t).add(\n\t\t\t\tstyle.getOffset(this.node)\n\t\t\t), time);\n\t\t}\n\n\t\t/**\n\t\t * Moves this.node to the given relative position, e.g. (0.5, 0.5) for half way.\n\t\t * @param {playtotv.css.Vector} position\n\t\t */\n\t\tsetRelative(position) {\n\t\t\tthis.moveTo(this.space.multiply(position));\n\t\t}\n\n\t\t/**\n\t\t * Returns this.node's relative position in regards to its available space. Essentially this is a normalized\n\t\t * vector with x and y properties between 0 and 1, though elasticity may lead to values exceeding this.\n\t\t *\n\t\t * @returns {playtotv.css.Vector} relative position\n\t\t */\n\t\tgetRelative() {\n\t\t\tvar position = this.position;\n\t\t\tvar space = this.space;\n\n\t\t\t// prevent NaNs if x or y space is 0\n\t\t\treturn new Vector(\n\t\t\t\tspace.x ? position.x / space.x : 0,\n\t\t\t\tspace.y ? position.y / space.y : 0\n\t\t\t);\n\t\t}\n\n\t\t/**\n\t\t * Returns the orientation of the current dragging sequence. Once set, the orientation is locked until the\n\t\t * next drag sequence starts. This allows nested components to properly handle orientation preferences /\n\t\t * propagation; e.g. vertical scrolling within horizontal pages.\n\t\t *\n\t\t * @param {playtotv.touch.Sequence} sequence\n\t\t * @returns {number} orientation Vector.HORIZONTAL or Vector.VERTICAL\n\t\t */\n\t\tgetOrientation(sequence) {\n\t\t\tif (!this.lastOrientation) {\n\t\t\t\tthis.lastOrientation = touchManager.getOrientation(sequence);\n\t\t\t}\n\n\t\t\treturn this.lastOrientation;\n\t\t}\n\n\t\t/**\n\t\t * Returns the current position.\n\t\t *\n\t\t * @returns {playtotv.css.Vector} position\n\t\t */\n\t\tgetPosition() {\n\t\t\treturn this.position;\n\t\t}\n\n\t\t/**\n\t\t * Swipes the node across the given vector over the given time.\n\t\t *\n\t\t * @param {playtotv.css.Vector} vector\n\t\t * @param {number} [time=1000]\n\t\t */\n\t\tswipe(vector, time) {\n\t\t\tvar position = this.position;\n\t\t\tvar target = this.restrict(position.add(vector), false);\n\t\t\tthis.vector = target.subtract(position);\n\t\t\tthis.start = position;\n\n\t\t\tthis.cancelFrame(); // if any\n\n\t\t\tthis.transition.play({\n\t\t\t\tduration: time || 1000\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Swipes the node to the given position over the given time.\n\t\t *\n\t\t * @param {playtotv.css.Vector} position\n\t\t * @param {number} [time=1000]\n\t\t */\n\t\tswipeTo(position, time) {\n\t\t\tposition = position.subtract(this.position);\n\t\t\tthis.swipe(position, time);\n\t\t}\n\n\t\t/**\n\t\t * swipe transition frame callback\n\t\t * @private\n\t\t */\n\t\thandleAnim(n) {\n\t\t\tvar moved = this.vector.multiplyBy(n);\n\t\t\tthis.moveTo(this.start.add(moved));\n\n\t\t\tif (n === 1) {\n\t\t\t\tthis.handleStopped();\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Restricts the given position to the instance's orientation, and may optionally apply elasticity to\n\t\t * positions outside of min and max values.\n\t\t *\n\t\t * @param {playtotv.css.Vector} position\n\t\t * @param {boolean} elastic\n\t\t * @returns {playtotv.css.Vector} restricted\n\t\t */\n\t\trestrict(position, elastic) {\n\t\t\tvar pos = this.limiter.multiply(position);\n\t\t\tvar min = this.min;\n\t\t\tvar max = this.max;\n\n\t\t\tif (elastic && this.content.exceeds(this.view)) {\n\t\t\t\tvar ex = (pos.x < min.x) ? pos.x - min.x : (pos.x > max.x) ? pos.x - max.x : 0;\n\t\t\t\tvar ey = (pos.y < min.y) ? pos.y - min.y : (pos.y > max.y) ? pos.y - max.y : 0;\n\n\t\t\t\tthis.pulling = (ex || ey) ? true : false;\n\n\t\t\t\tvar res = this.restricter;\n\t\t\t\treturn new Vector(\n\t\t\t\t\tpos.x - (ex * res.x),\n\t\t\t\t\tpos.y - (ey * res.y)\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\treturn pos.limit(min, max);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Dispose handler, can automatically be called when this.node is removed from the DOM,\n\t\t * but ONLY if this instance is managed by the {@link playtotv.widget.widgetManager}.\n\t\t */\n\t\tdispose() {\n\t\t\tif (this.transition.playing) {\n\t\t\t\tthis.transition.stop();\n\t\t\t}\n\n\t\t\tthis.cancelFrame();\n\n\t\t\tWidget.prototype.dispose.call(this);\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.widget.FormWidget', [\n\t'playtotv.widget.Widget'\n], function(\n\tWidget\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar dom = ptv.dom;\n\tvar event = ptv.event;\n\n\t/**\n\t * ValidityTest class, validates an input using either the native checkValidity method, or a specified fallback\n\t * when native support is not detected by the given test method. For example; with a \"pattern\" attribute, the test\n\t * method should test native support, and the fallback should implement a regex check on the input's value.\n\t *\n\t * Since native checkValidity errors on any illegal value, it may invalidate an input outside of the scope of a\n\t * test's instance, but this merely makes validation fail early, and prevents subsequent tests on the same input.\n\t */\n\tclass ValidityTest {\n\n\t\tconstructor(options) {\n\t\t\toptions = ptv.params(options, {\n\t\t\t\tselector: ptv.REQUIRED,\n\t\t\t\ttest: ptv.REQURIED,\n\t\t\t\tfallback: ptv.REQUIRED\n\t\t\t});\n\n\t\t\tthis.selector = options.selector;\n\t\t\tthis.supported = options.test();\n\t\t\tthis.fallback = options.fallback;\n\t\t}\n\n\t\tvalidate(input) {\n\t\t\t// this test doesn't apply, consider valid\n\t\t\tif (!dom.matches(this.selector, input)) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// validate native if supported\n\t\t\tif (this.supported) {\n\t\t\t\treturn input.checkValidity();\n\t\t\t}\n\n\t\t\t// otherwise, return the fallback implementation value\n\t\t\treturn this.fallback(input);\n\t\t}\n\t}\n\n\t/**\n\t * Implemented tests. Instances are created when FormWidget intances are, as to not execute any tests by loading\n\t * this module.\n\t */\n\tvar validityTests = [ {\n\t\tselector: '[required]',\n\t\ttest: function() {\n\t\t\tvar input = document.createElement('input');\n\t\t\tinput.setAttribute('required', true);\n\t\t\treturn input.checkValidity && input.checkValidity() === false;\n\t\t},\n\t\tfallback: function(input) {\n\t\t\tif (/radio|check/i.test(input.type)) {\n\t\t\t\t// one or more radios or checks: check at least one of [name]\n\t\t\t\tvar list = input.form.elements[input.name];\n\t\t\t\treturn list.length ?\n\t\t\t\t\t// multiple inputs sharing a name\n\t\t\t\t\tArray.from(list).some(item => item.checked) :\n\t\t\t\t\t// one input\n\t\t\t\t\tinput.checked;\n\t\t\t} else {\n\t\t\t\t// otherwise, check the current value\n\t\t\t\treturn !!input.value;\n\t\t\t}\n\t\t}\n\t}, {\n\t\tselector: '[pattern]',\n\t\ttest: function() {\n\t\t\tvar input = document.createElement('input');\n\t\t\tinput.setAttribute('pattern', '\\\\d+');\n\t\t\tinput.value = 'test';\n\t\t\treturn input.checkValidity && input.checkValidity() === false;\n\t\t},\n\t\tfallback: function(input) {\n\t\t\treturn input.value ?\n\t\t\t\t// with value: test on the pattern\n\t\t\t\t(new RegExp('^' + input.getAttribute('pattern') + '$')).test(input.value) :\n\t\t\t\t// without value: valid, required is another test.\n\t\t\t\ttrue;\n\t\t}\n\t}, {\n\t\tselector: '[min],[max]',\n\t\ttest: function() {\n\t\t\tvar input = document.createElement('input');\n\t\t\tinput.setAttribute('type', 'number');\n\t\t\tinput.setAttribute('min', 0);\n\t\t\tinput.value = -1;\n\t\t\t// when supported, value will be overruled, or validity will be false\n\t\t\t// min and max for unsupported types (date in firefox) is ignored, and will validate\n\t\t\t// min and max for types that don't support it is ignored, and will validate\n\t\t\treturn input.value === '0' || (input.checkValidity && input.checkValidity() === false);\n\t\t},\n\t\tfallback: function(input) {\n\t\t\tif (input.value) {\n\t\t\t\tvar value = parseFloat(input.value);\n\t\t\t\tvar min = input.getAttribute('min');\n\t\t\t\tvar max = input.getAttribute('max');\n\n\t\t\t\treturn !isNaN(value) &&\n\t\t\t\t\t(!min || value >= parseFloat(min)) &&\n\t\t\t\t\t(!max || value <= parseFloat(max));\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\t}, {\n\t\tselector: '[type=date]',\n\t\ttest: function() {\n\t\t\tvar input = document.createElement('input');\n\t\t\tinput.setAttribute('type', 'date');\n\t\t\tinput.value = 'invalid';\n\t\t\t// test for browsers that may support min and max for numbers, but not the date input\n\t\t\t// when supported, value will be overruled or validity will be false\n\t\t\treturn !input.value || (input.checkValidity && input.checkValidity() === false);\n\t\t},\n\t\tfallback: function(input) {\n\t\t\tif (input.value) {\n\t\t\t\tvar value = Date.parse(input.value);\n\t\t\t\tvar min = input.getAttribute('min');\n\t\t\t\tvar max = input.getAttribute('max');\n\n\t\t\t\treturn !isNaN(value) &&\n\t\t\t\t\t(!min || value >= Date.parse(min)) &&\n\t\t\t\t\t(!max || value <= Date.parse(max));\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\t} ];\n\n\t/**\n\t * The FormWidget provides convenient hooks to validation and custum submit actions for form nodes.\n\t * The widget node does not need to be a form itself, but if not MUST contain it.\n\t * By default this widget does not implement a custom submit action and only serves as a super class for specific\n\t * form widgets, which in turn MUST implement custom submit handling.\n\t *\n\t * @name FormWidget\n\t * @memberOf playtotv.widget\n\t * @class\n\t * @param {Node} node\n\t * @param {Object} [options] FormWidget options\n\t * @param {boolean} [options.preventNative=true] Indicates whether or not to preventDefault the native submit\n\t * @param {boolean} [options.validateChange=true] Indicates whether or not to validate inputs onchange\n\t */\n\treturn class FormWidget extends Widget {\n\n\t\tconstructor(node, options) {\n\t\t\tif (!dom.matches('form', node)) {\n\t\t\t\tthrow new Error('Form expected');\n\t\t\t}\n\n\t\t\toptions = ptv.params(options, {\n\t\t\t\tapp: null,\n\t\t\t\tcontroller: null,\n\t\t\t\thighlight: 'error',\n\t\t\t\tfield: '.field',\n\t\t\t\tpreventNative: true,\n\t\t\t\tvalidateChange: true\n\t\t\t});\n\n\t\t\tsuper(node);\n\n\t\t\tthis.field = options.field;\n\t\t\tthis.highlightClass = options.highlight;\n\t\t\tthis.preventNative = options.preventNative;\n\n\t\t\tptv.bindMethods(this, [\n\t\t\t\t'onChange',\n\t\t\t\t'onSubmit'\n\t\t\t]);\n\n\t\t\tthis.addEventListener(node, 'submit', this.onSubmit);\n\n\t\t\tif (options.validateChange) {\n\t\t\t\tthis.addEventListener(node, 'change', this.onChange);\n\t\t\t}\n\n\t\t\t// Disable native onSubmit validation to allow the onSubmit event to fire. This generates a validity object\n\t\t\t// which is forwarded to the {@link playtotv.widget.FormWidget#submit} method for custom error handling.\n\t\t\tnode.setAttribute('novalidate', true);\n\n\t\t\t// get test instances for validateInput\n\t\t\tthis.tests = validityTests.map(\n\t\t\t\ttest => new ValidityTest(test)\n\t\t\t);\n\t\t}\n\n\t\t/** @lends playtotv.widget.FormWidget.prototype */\n\n\t\t/**\n\t\t * Native submit handler. Calls validateForm and passes the returned validity object to the\n\t\t * {@link playtotv.widget.FormWidget#submit} function for custom validation feedback. The native submit event is\n\t\t * prevented if the instance's preventNative option is set to true (default), or if submit returns false.\n\t\t *\n\t\t * @param {Event} submit\n\t\t */\n\t\tonSubmit(e) {\n\t\t\tif (this.preventNative) {\n\t\t\t\te.preventDefault();\n\t\t\t}\n\n\t\t\tvar result = this.validateForm();\n\t\t\tresult.elements.forEach(input => {\n\t\t\t\tthis.highlight(input, false);\n\t\t\t}, this);\n\n\t\t\tresult.errors.forEach(input => {\n\t\t\t\tthis.highlight(input, true);\n\t\t\t}, this);\n\n\t\t\tif (result.valid) {\n\t\t\t\tevent.dispatchEvent(this.node, 'submit-valid', true, true, {\n\t\t\t\t\tdata: this.serialize(),\n\t\t\t\t\tvalidity: result,\n\t\t\t\t\toriginalEvent: e\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Handles native onchange events to live-update input validity feedback as the user enters values.\n\t\t *\n\t\t * @param {Event} change\n\t\t */\n\t\tonChange(e) {\n\t\t\tvar input = e.target;\n\t\t\tvar valid = this.validateInput(input);\n\t\t\tthis.highlight(input, !valid);\n\t\t}\n\n\t\t/**\n\t\t * Toggle error on input\n\t\t */\n\t\thighlight(input, toggle) {\n\t\t\tvar field = dom.closest(this.field, input);\n\t\t\tif (field) {\n\t\t\t\tfield.classList.toggle(this.highlightClass, toggle);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Validates the input of this form using HTML5 validation properties including input types, required, pattern\n\t\t * and min max attributes, etc. Returns a validity object with an \"elements\" array of all the form's elements,\n\t\t * an \"errors\" array of invalid elemements, and a \"valid\" boolean indicating whether the form's current input\n\t\t * is valid.\n\t\t *\n\t\t * @returns {Object} validity Validity object with elements array, errors array and valid boolean.\n\t\t */\n\t\tvalidateForm() {\n\t\t\tvar elements = this.getElements();\n\t\t\tvar errors = [];\n\n\t\t\telements.forEach(function(input) {\n\t\t\t\tif (!this.validateInput(input)) {\n\t\t\t\t\terrors.push(input);\n\t\t\t\t}\n\t\t\t}, this);\n\n\t\t\treturn {\n\t\t\t\telements: elements,\n\t\t\t\terrors: errors,\n\t\t\t\tvalid: !errors.length\n\t\t\t};\n\t\t}\n\n\t\t/**\n\t\t * Validates a single input, and returns a boolean indicating whether the value is valid.\n\t\t *\n\t\t * @param {Node} input\n\t\t * @returns {boolean} valid\n\t\t */\n\t\tvalidateInput(input) {\n\t\t\t// start with an initial checkValidity if supported, otherwise assume valid before testing\n\t\t\tvar valid = input.checkValidity ? input.checkValidity() : true;\n\n\t\t\t// test until false (if not already) or all tests passed\n\t\t\tthis.tests.forEach(test => {\n\t\t\t\tvalid = valid && test.validate(input);\n\t\t\t});\n\n\t\t\treturn valid;\n\t\t}\n\n\t\t/**\n\t\t * Returns an array of the form's elements at the time of calling this method. As an array representation of\n\t\t * the native form.elements HTMLFormControlsCollection, this WILL include possible fieldset nodes.\n\t\t *\n\t\t * @returns {Array} elements\n\t\t */\n\t\tgetElements() {\n\t\t\treturn Array.from(this.node.elements);\n\t\t}\n\n\t\t/**\n\t\t * Returns an object with name-value pairs of the form's current input. The values of range and number inputs\n\t\t * are parsed to a number. Inputs without a name attribute are ignored.\n\t\t *\n\t\t * @returns {Object} data Current input as name-value pairs.\n\t\t */\n\t\tserialize() {\n\t\t\tvar elements = this.getElements();\n\t\t\tvar data = {};\n\t\t\telements.forEach(function(element) {\n\t\t\t\tvar name = element.name;\n\t\t\t\tvar type = element.type;\n\t\t\t\tvar value = element.value;\n\n\t\t\t\t// TODO: aggregate multiple inputs sharing a name\n\n\t\t\t\t// can't store value without a name\n\t\t\t\tif (!name) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// only store the value of checked elements\n\t\t\t\tif (/check|radio/i.test(type) && !element.checked) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// parseFloat number elements\n\t\t\t\tif (value && /number|range/i.test(type)) {\n\t\t\t\t\tvalue = parseFloat(value);\n\t\t\t\t}\n\n\t\t\t\t// Retrieve selected option values as array\n\t\t\t\tif (type === 'select-multiple') {\n\t\t\t\t\tvalue = Array.from(element.options)\n\t\t\t\t\t\t.filter(option => option.selected)\n\t\t\t\t\t\t.map(option => option.value);\n\t\t\t\t}\n\n\t\t\t\t// store\n\t\t\t\tdata[name] = value;\n\t\t\t});\n\n\t\t\treturn data;\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.widget.ScalableWidget', [\n\t'playtotv.css.style',\n\t'playtotv.widget.Widget'\n], function(\n\tstyle,\n\tWidget\n) {\n\n\t'use strict';\n\n\t/**\n\t * Scales a node to fit its parent's dimensions, scaling in either width or height, and resizing in (respectively)\n\t * height or width to completely fill the parent's space. Use min- and/or max- css dimensions on the parent to set\n\t * hard limits on scaling. Note that {@link playtotv.css.style.fromPageToNode} may be needed to convert coordinate\n\t * spaces when working with user input, as transformed nodes will return their original position and dimensions.\n\t *\n\t * @name ScalableWidget\n\t * @memberOf playtotv.widget\n\t * @class\n\t * @param {Node} node\n\t * @param {Object} [options] ScalableWidget options\n\t * @param {Object} [options.mode='portrait'] The scaling mode, either \"portrait\" or \"landscape\"\n\t * @param {Object} [options.resize=true] Resizing may be set to false to have nodes scale only, not resize\n\t */\n\treturn class ScalableWidget extends Widget {\n\n\t\tconstructor(node, options) {\n\t\t\toptions = playtotv.params(options, {\n\t\t\t\tmode: 'portrait',\n\t\t\t\tresize: true\n\t\t\t});\n\n\t\t\tsuper(node);\n\n\t\t\tthis.mode = options.mode;\n\t\t\tthis.resize = options.resize;\n\n\t\t\tthis.addEventListener(window, 'resize', playtotv.debounce(() => this.onResize(), 100));\n\t\t\tthis.onResize();\n\t\t}\n\n\t\t/** @lends playtotv.widget.ScalableWidget.prototype */\n\n\t\t/**\n\t\t * Resize handler, determines and applies scale and resizing.\n\t\t *\n\t\t * @param {Event} resize\n\t\t */\n\t\tonResize() {\n\t\t\tvar node = this.node;\n\t\t\tif (!node) {\n\t\t\t\treturn; // disposed during debounce\n\t\t\t}\n\n\t\t\tvar parent = node.parentNode;\n\t\t\tvar scale = (this.mode === 'landscape') ?\n\t\t\t\tparent.offsetWidth / node.offsetWidth :\n\t\t\t\tparent.offsetHeight / node.offsetHeight;\n\n\t\t\tthis.setScale(scale);\n\n\t\t\tif (this.resize) {\n\t\t\t\tthis.sizeToScale();\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Resizes the widget's node to fill its parent, based on this instance's mode, the current scale, and the\n\t\t * parent's dimensions. When resizing is enabled, this method is called via onResize immediately following\n\t\t * setScale.\n\t\t *\n\t\t */\n\t\tsizeToScale() {\n\t\t\tvar node = this.node;\n\t\t\tvar parent = node.parentNode;\n\t\t\tvar landscape = (this.mode === 'landscape');\n\n\t\t\tvar offside = landscape ? 'height' : 'width';\n\t\t\tvar space = landscape ?\n\t\t\t\tparent.offsetHeight / this.scale :\n\t\t\t\tparent.offsetWidth / this.scale;\n\n\t\t\tstyle.set(node, offside, space + 'px');\n\t\t}\n\n\t\t/**\n\t\t * Applies the scale to the widget's node as a CSS scale() transformation.\n\t\t *\n\t\t * @param {number} scale\n\t\t */\n\t\tsetScale(scale) {\n\t\t\tthis.scale = scale;\n\t\t\tstyle.setTransform(this.node, 'scale(' + scale + ')');\n\t\t}\n\n\t\t/**\n\t\t * Returns the current scale\n\t\t *\n\t\t * @returns {number} scale\n\t\t */\n\t\tgetScale() {\n\t\t\treturn this.scale;\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.widget.ScrollableWidget', [\n\t'playtotv.widget.Widget',\n\t'playtotv.widget.DraggableWidget',\n\t'playtotv.css.Vector',\n\t'playtotv.css.style'\n], function(\n\tWidget,\n\tDraggableWidget,\n\tVector,\n\tstyle\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar dom = ptv.dom;\n\n\t/**\n\t * Creates a scrollable area from a given node and its content childnode (as defined by options.content), that may\n\t * be scrolled by dragging anywhere in the content by either mouse or touch. The root node acts as the viewport and\n\t * must define a hidden overflow in the direction for which scrolling is enabled, in order to hide any content in\n\t * excess of the viewport's dimensions. This requires a block level display value on the viewport. The content\n\t * node's position is updated using CSS translations. This may conflict with transformations that are applied to\n\t * the content node from CSS.\n\t *\n\t * Non-interactive track thumbs indicating the relative size and position of the content in respect to the viewport\n\t * are inserted (by default, see options) as span elements and are updated dynamically while scrolling. Thumbs must\n\t * be styled using CSS. The vertical thumb should be positioned in the top right corner of the viewport and\n\t * minimally define a fixed width to be visible; the height is calculated and applied dynamically. The horizontal\n\t * thumb should be positioned in the bottom left corner and define a fixed height. This may require a position\n\t * value on the viewport other than static (e.g. relative).\n\t *\n\t * Vertical scrolling minimally requires a limited height value for the viewport, and an auto height value for the\n\t * content node. As normal CSS flow is vertically oriented, this doesn't require any styling other than possible\n\t * block display on the content node.\n\t *\n\t * Horizontal scrolling minimally requires a limited width value for the viewport, and either a fixed width value\n\t * or non-wrapping white space for the content node. This may require a block level display value on the content\n\t * node.\n\t *\n\t * Orientation free scrolling requires limited width and height for the viewport, as well as and fixed width and\n\t * height for the content node.\n\t *\n\t * @name ScrollableWidget\n\t * @memberOf playtotv.widget\n\t * @class\n\t * @extends playtotv.widget.Widget\n\t * @param {Node} node\n\t * @param {Object} [options]\n\t * @param {number} [options.orientation=Vector.VERTICAL] Content orientation.\n\t * @param {string} [options.restrict='outside'] DraggableWidget content restriction.\n\t * @param {string} [options.content='.content'] Selector indicating the draggable content node.\n\t * @param {string} [options.thumbH='thumb-horizontal'] Horizontal thumb class, false for no thumb.\n\t * @param {string} [options.thumbV='thumb-vertical'] Vertical thumb class, false for no thumb.\n\t * @param {string} [options.active='scrolling'] Active class when scrolling.\n\t * @param {string} [options.disabled='disabled'] Disabled class for thumbs when view exceeds content.\n\t * @param {boolean} [options.elastic=true] ScrollableWidget is elastic by default.\n\t * @param {boolean} [options.inertia=true] ScrollableWidget has inertia by default.\n\t */\n\treturn class ScrollableWidget extends Widget {\n\n\t\tconstructor(node, options) {\n\t\t\tsuper(node);\n\n\t\t\tptv.bindMethods(this, [\n\t\t\t\t'handleStart',\n\t\t\t\t'handleDrag',\n\t\t\t\t'handleEnd'\n\t\t\t]);\n\n\t\t\toptions = ptv.params(options, {\n\t\t\t\torientation: Vector.VERTICAL,\n\t\t\t\trestrict: 'outside',\n\t\t\t\tcontent: '.content',\n\t\t\t\tthumbH: 'thumb-horizontal',\n\t\t\t\tthumbV: 'thumb-vertical',\n\t\t\t\tactive: 'scrolling',\n\t\t\t\tdisabled: 'disabled',\n\t\t\t\telastic: true,\n\t\t\t\tinertia: true,\n\t\t\t\tfriction: 50,\n\t\t\t\tpriority: false,\n\t\t\t\thandle: null\n\t\t\t});\n\n\t\t\t// draggable content node MUST be present (its actual content may be added dynamically)\n\t\t\tvar content = $(options.content, node);\n\t\t\tif (!content) {\n\t\t\t\tthrow new ReferenceError('Content node \"' + options.content + '\" expected');\n\t\t\t}\n\n\t\t\t// node display SHOULD be set to \"block\" or \"inline-block\"\n\t\t\t// TODO: test more display values including flex types and run-in.\n\t\t\tvar display = style.get(node, 'display');\n\t\t\tif (!/block/i.test(display)) {\n\t\t\t\tthrow new Error('Display \"block\" or \"inline-block\" is required for scrollable nodes');\n\t\t\t}\n\n\t\t\t// node overflow MUST be set to \"hidden\"\n\t\t\tvar overflow = style.get(node, 'overflow');\n\t\t\tif (overflow !== 'hidden') {\n\t\t\t\tthrow new Error('Overflow \"hidden\" is required for scrollable nodes');\n\t\t\t}\n\n\t\t\tthis.content = content;\n\t\t\tthis.activeClass = options.active;\n\t\t\tthis.disabledClass = options.disabled;\n\n\t\t\tvar dir = options.orientation;\n\n\t\t\tthis.pane = new DraggableWidget(content, {\n\t\t\t\torientation: dir,\n\t\t\t\trestrict: options.restrict,\n\t\t\t\telastic: options.elastic,\n\t\t\t\tinertia: options.inertia,\n\t\t\t\tfriction: options.friction,\n\t\t\t\tpriority: options.priority,\n\t\t\t\thandle: options.handle\n\t\t\t});\n\n\t\t\tif (options.thumbH && (dir === Vector.HORIZONTAL || dir === Vector.FREE)) {\n\t\t\t\tthis.thumbH = dom.create('span', { 'class': options.thumbH }, { appendTo: node });\n\t\t\t}\n\n\t\t\tif (options.thumbV && (dir === Vector.VERTICAL || dir === Vector.FREE)) {\n\t\t\t\tthis.thumbV = dom.create('span', { 'class': options.thumbV }, { appendTo: node });\n\t\t\t}\n\n\t\t\tthis.addEventListener(content, 'em:dragstart', this.handleStart);\n\t\t\tthis.addEventListener(content, 'em:dragmove', this.handleDrag);\n\t\t\tthis.addEventListener(content, 'em:dragend', this.handleEnd);\n\n\t\t\tthis.updateThumbs();\n\t\t}\n\n\t\t/** @lends playtotv.widget.ScrollableWidget.prototype */\n\n\t\t/**\n\t\t * Moves and resizes the thumb to reflect the content's position\n\t\t *\n\t\t */\n\t\tupdateThumbs() {\n\t\t\tvar pane = this.pane;\n\n\t\t\tvar relative = pane.getRelative();\n\t\t\tvar pos = pane.position;\n\t\t\tvar min = pane.min;\n\t\t\tvar view = pane.view;\n\t\t\tvar content = pane.content;\n\t\t\tvar scale = view.divide(content.max(view));\n\t\t\tvar disabled = this.disabledClass;\n\n\t\t\tvar elasticity = pos.max(min.subtract(pos)).max(Vector.ZERO);\n\t\t\tvar thumbSize = view.multiply(scale).subtract(elasticity);\n\t\t\tvar thumbSpace = view.subtract(thumbSize);\n\t\t\tvar thumbPos = relative.multiply(thumbSpace).limit(Vector.ZERO, thumbSpace);\n\n\t\t\t// If present, update the horizontal thumb's size, positition and state class.\n\t\t\tvar horizontal = this.thumbH;\n\t\t\tif (horizontal) {\n\t\t\t\tstyle.set(horizontal, 'width', thumbSize.x + 'px');\n\t\t\t\tstyle.setTranslate(horizontal, thumbPos.x + 'px, 0');\n\t\t\t\thorizontal.classList.toggle(disabled, scale.x >= 1);\n\t\t\t}\n\n\t\t\t// Same for vertical.\n\t\t\tvar vertical = this.thumbV;\n\t\t\tif (vertical) {\n\t\t\t\tstyle.set(vertical, 'height', thumbSize.y + 'px');\n\t\t\t\tstyle.setTranslate(vertical, '0, ' + thumbPos.y + 'px');\n\t\t\t\tvertical.classList.toggle(disabled, scale.y >= 1);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Toggles the active class when scrolling for styling purposes.\n\t\t * @param {boolean} toggle\n\t\t */\n\t\ttoggleActive(toggle) {\n\t\t\tif (toggle !== this.scrolling) {\n\t\t\t\tthis.scrolling = toggle;\n\t\t\t\tthis.node.classList.toggle(this.activeClass, toggle);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Animates the given node into view using {@link playtotv.widget.DraggableWidget#moveIntoView}\n\t\t * @param {Node} target\n\t\t * @param {number} [time=1000]\n\t\t */\n\t\tscrollIntoView(target, time) {\n\t\t\tthis.pane.moveIntoView(target, time);\n\t\t}\n\n\t\t/**\n\t\t * Animates the content to align the given point (relative to content) to the top-left edge of the view.\n\t\t *\n\t\t * @param {playtotv.css.Vector} point\n\t\t * @param {number} [time=1000]\n\t\t */\n\t\tscrollTo(point, time) {\n\t\t\tthis.pane.swipeTo(Vector.ZERO.subtract(point), time);\n\t\t}\n\n\t\t/**\n\t\t * Internal dragstart handler, checks if thumbs are needed, corrects for native scrolling offsets, and stops\n\t\t * propagation to higher nodes.\n\t\t * @param {Event|playtotv.event.Event} event\n\t\t */\n\t\thandleStart(e) {\n\t\t\te.stopPropagation();\n\n\t\t\tvar pane = this.pane;\n\n\t\t\t// check if thumbs are needed\n\t\t\tthis.indicate = pane.content.exceeds(pane.view);\n\n\t\t\t// compensate for anchor jumps\n\t\t\tvar node = this.node;\n\t\t\tvar sx = node.scrollLeft;\n\t\t\tvar sy = node.scrollTop;\n\t\t\tif (sx || sy) {\n\t\t\t\tnode.scrollTop = node.scrollLeft = 0;\n\t\t\t\tpane.moveBy(new Vector(-sx, -sy));\n\t\t\t\tpane.start = pane.position;\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Internal dragmove handler, updates thumb positions, and adds the active class after scrolling at least 20px.\n\t\t * @param {Event|playtotv.event.Event} event\n\t\t */\n\t\thandleDrag(e) {\n\t\t\te.stopPropagation();\n\n\t\t\tif (this.indicate) {\n\n\t\t\t\tvar pane = this.pane;\n\t\t\t\tvar start = pane.start;\n\t\t\t\tvar pos = pane.position;\n\t\t\t\tvar magnitude = pos.subtract(start).magnitude();\n\n\t\t\t\tif (!this.scrolling && magnitude > 20) {\n\t\t\t\t\tthis.toggleActive(true);\n\t\t\t\t}\n\n\t\t\t\tthis.updateThumbs();\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Internal dragend handler. Removes the active class.\n\t\t * @param {Event|playtotv.event.Event} event\n\t\t */\n\t\thandleEnd(e) {\n\t\t\te.stopPropagation();\n\t\t\tthis.toggleActive(false);\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.widget.ThemeWidget', [\n\t'playtotv.widget.Widget'\n], function(\n\tWidget\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\n\treturn class ThemeWidget extends Widget {\n\t\tconstructor(node, options) {\n\t\t\tptv.params(options, {\n\t\t\t\tapp: null,\n\t\t\t\ttheme: ptv.REQUIRED,\n\t\t\t\ttarget: 'body'\n\t\t\t});\n\n\t\t\tsuper(node);\n\n\t\t\tvar theme = this.theme = options.theme;\n\t\t\tvar target = this.target = $(options.target);\n\t\t\tif (target) {\n\t\t\t\ttarget.classList.add(theme);\n\t\t\t}\n\t\t}\n\n\t\tdispose() {\n\t\t\tif (this.target) {\n\t\t\t\tthis.target.classList.remove(this.theme);\n\t\t\t}\n\n\t\t\tsuper.dispose();\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.widget.TimerWidget', [\n\t'playtotv.css.style',\n\t'playtotv.fx.Transition',\n\t'playtotv.widget.Widget'\n], function(\n\tstyle,\n\tTransition,\n\tWidget\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\n\t/**\n\t * TimerWidget bar that resizes an indicator from 0 to 100% width over the given time.\n\t * Time may be stated using meaningful combinations of start, time and/or end options.\n\t * If no start time is given, the current time is used.\n\t * Also note that the end option takes precedence over the time option when determining duration.\n\t * It IS possible to only specify an end timestamp on a TimerWidget node.\n\t *\n\t * TODO: enable a switch for CSS transitions vs physical width modification.\n\t *\n\t * @class\n\t * @name TimerWidget\n\t * @memberOf playtotv.widget\n\t * @param {Node} node\n\t * @param {Object} [options]\n\t * @param {string} [options.indicator='.indicator'] TimerWidget indicator selector\n\t * @param {string} [options.property='width'] The CSS property to modify, must support a percentage value.\n\t * @param {boolean} [options.inverted=false] Set to true to size down instead of up\n\t * @param {boolean} [options.autoplay=true] Defines whether or not the timer starts automatically\n\t * @param {number} [options.fps=1] Animation fps, should not be too high for mobiles due to reflows\n\t */\n\treturn class TimerWidget extends Widget {\n\n\t\tconstructor(node, options) {\n\t\t\toptions = ptv.params(options, {\n\t\t\t\tapp: null,\n\t\t\t\tindicator: '.indicator',\n\t\t\t\tproperty: 'width',\n\t\t\t\tinverted: false,\n\t\t\t\tautoplay: true,\n\t\t\t\tfps: 1,\n\t\t\t\tstart: 0,\n\t\t\t\ttime: 0,\n\t\t\t\tend: 0\n\t\t\t});\n\n\t\t\tsuper(node);\n\n\t\t\tthis.node = node;\n\t\t\tthis.bar = $(options.indicator, node);\n\t\t\tthis.property = options.property;\n\n\t\t\tvar inv = options.inverted;\n\t\t\tthis.transition = new Transition({\n\t\t\t\tcallback: this.handleFrame.bind(this),\n\t\t\t\tduration: 1000,\n\t\t\t\tfrom: inv ? 1 : 0,\n\t\t\t\tto: inv ? 0 : 1,\n\t\t\t\tfps: options.fps\n\t\t\t});\n\n\t\t\tif (options.autoplay) {\n\t\t\t\tvar { start, time, end } = options;\n\t\t\t\tvar now = Date.now();\n\t\t\t\tstart = start || now;\n\t\t\t\ttime = time;\n\t\t\t\tend = end || (start + time);\n\t\t\t\tthis.start(end - start, start);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Start the timer, running it for the given duration. An optional start time may be given.\n\t\t *\n\t\t * @param {number} duration in ms\n\t\t * @param {number} [start] timestamp\n\t\t */\n\t\tstart(duration, start) {\n\t\t\tif (isNaN(duration)) {\n\t\t\t\tthrow new TypeError('Duration is not a number');\n\t\t\t}\n\n\t\t\tthis.stop();\n\n\t\t\tthis.starttime = start || Date.now();\n\t\t\tthis.duration = duration;\n\n\t\t\tthis.transition.play({\n\t\t\t\tstart: this.starttime,\n\t\t\t\tduration: this.duration\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Stops the timer\n\t\t *\n\t\t */\n\t\tstop() {\n\t\t\tthis.transition.stop();\n\t\t}\n\n\t\treset() {\n\t\t\tthis.stop();\n\t\t\tvar from = this.transition.settings.from * 100;\n\t\t\tstyle.set(this.bar, this.property, from + '%');\n\t\t}\n\n\t\thandleFrame(n) {\n\t\t\tstyle.set(this.bar, this.property, (n * 100) + '%');\n\t\t}\n\n\t\tdispose() {\n\t\t\tthis.stop();\n\n\t\t\tsuper.dispose();\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.widget.TimestampWidget', [\n\t'playtotv.widget.Widget'\n], function(\n\tWidget\n) {\n\n\t'use strict';\n\n\tvar DAY_HOURS = 24;\n\tvar HOUR_MINUTES = 60;\n\tvar MINUTE_SECONDS = 60;\n\tvar HOUR_SECONDS = HOUR_MINUTES * MINUTE_SECONDS;\n\tvar DAY_SECONDS = DAY_HOURS * HOUR_SECONDS;\n\n\tvar ptv = playtotv;\n\n\t/**\n\t * Widget that dynamically updates a node's innerHTML with a string representing the amount of time passed since\n\t * the timestamp passed as time option.\n\t *\n\t * TODO: add a dateformat option\n\t *\n\t * @name TimestampWidget\n\t * @memberOf playtotv.widget\n\t * @class\n\t * @extends playtotv.widget.Widget\n\t * @param {Node} node\n\t */\n\treturn class TimestampWidget extends Widget {\n\n\t\tconstructor(node, options) {\n\t\t\tptv.params(options, {\n\t\t\t\tapp: null,\n\t\t\t\ttime: ptv.REQUIRED\n\t\t\t});\n\n\t\t\tsuper(node);\n\n\t\t\tthis.time = options.time;\n\n\t\t\tthis.update();\n\t\t}\n\n\t\tupdate() {\n\t\t\tvar seconds = Math.floor((Date.now() - this.time) / 1000);\n\t\t\tvar text;\n\n\t\t\tif (seconds >= DAY_SECONDS) {\n\t\t\t\ttext = Math.floor(seconds / DAY_SECONDS) + 'd';\n\t\t\t} else if (seconds >= HOUR_SECONDS) {\n\t\t\t\ttext = Math.floor(seconds / HOUR_SECONDS) % DAY_HOURS + 'h';\n\t\t\t} else if (seconds >= MINUTE_SECONDS) {\n\t\t\t\ttext = Math.floor(seconds / MINUTE_SECONDS) % HOUR_MINUTES + 'm';\n\t\t\t} else {\n\t\t\t\ttext = seconds % MINUTE_SECONDS + 's';\n\t\t\t}\n\n\t\t\tif (this.node.innerHTML !== text) {\n\t\t\t\tthis.node.innerHTML = text;\n\t\t\t}\n\n\t\t\tthis.timeout = setTimeout(() => {\n\t\t\t\tthis.update();\n\t\t\t}, seconds > MINUTE_SECONDS ? 60000 : 1000);\n\t\t}\n\n\t\tdispose() {\n\t\t\tclearTimeout(this.timeout);\n\n\t\t\tsuper.dispose();\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.widget.TransformableWidget', [\n\t'playtotv.animationFrame',\n\t'playtotv.css.Matrix',\n\t'playtotv.css.style',\n\t'playtotv.css.Vector',\n\t'playtotv.widget.Widget'\n], function(\n\tanimationFrame,\n\tMatrix,\n\tstyle,\n\tVector,\n\tWidget\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar log = new ptv.Logger(this.id);\n\n\tvar STATE_PASSIVE = 1;\n\tvar STATE_ACTIVE = 2;\n\n\treturn class TransformableWidget extends Widget {\n\n\t\tconstructor(node, options) {\n\t\t\tsuper(node);\n\n\t\t\toptions = ptv.params(options, {\n\t\t\t\ttranslate: true,\n\t\t\t\tscale: true,\n\t\t\t\trotate: true\n\t\t\t});\n\n\t\t\tthis.touches = [];\n\t\t\tthis.transform = new Matrix();\n\n\t\t\tthis.translation = new Vector(0, 0);\n\t\t\tthis.scaling = 1;\n\t\t\tthis.rotation = 0;\n\n\t\t\tthis.deltaMove = new Vector(0, 0);\n\t\t\tthis.deltaAngle = 0;\n\t\t\tthis.deltaScale = 1;\n\n\t\t\tptv.bindMethods(this, [\n\t\t\t\t'handleFrame',\n\t\t\t\t'touchStart',\n\t\t\t\t'touchMove',\n\t\t\t\t'touchEnd'\n\t\t\t]);\n\n\t\t\tthis.addEventListener(node, 'em:touchstart', this.touchStart);\n\t\t\tthis.addEventListener(node, 'em:touchmove', this.touchMove);\n\t\t\tthis.addEventListener(node, 'em:touchend', this.touchEnd);\n\t\t}\n\n\t\tsetState(state) {\n\t\t\tthis.state = state;\n\t\t}\n\n\t\tgetState() {\n\t\t\treturn this.state;\n\t\t}\n\n\t\trequestFrame() {\n\t\t\tthis.request = animationFrame.request(this.handleFrame);\n\t\t}\n\n\t\tcancelFrame() {\n\t\t\tif (this.request) {\n\t\t\t\tanimationFrame.cancel(this.request);\n\t\t\t\tdelete this.request;\n\t\t\t}\n\t\t}\n\n\t\ttouchStart(e) {\n\t\t\te.preventDefault();\n\t\t\tthis.touches.push(e.detail.sequence.id);\n\t\t}\n\n\t\ttouchMove(e) {\n\t\t\te.preventDefault();\n\n\t\t\tvar proxy = e.detail.proxy;\n\t\t\tvar touches = this.touches;\n\t\t\tif (touches.length > 0) {\n\n\t\t\t\tvar begin = proxy.getSequence(touches[0]);\n\t\t\t\tvar translate = Vector.ZERO; // begin.offset; // TODO: unbug single-finger dragging\n\t\t\t\tvar angle = 0;\n\t\t\t\tvar scale = 1;\n\n\t\t\t\tif (touches.length > 1) {\n\t\t\t\t\tvar end = proxy.getSequence(touches[1]);\n\t\t\t\t\tvar origin = end.start.subtract(begin.start);\n\t\t\t\t\tvar current = end.point.subtract(begin.point);\n\n\t\t\t\t\tangle = Math.atan2(-current.y, current.x) - Math.atan2(-origin.y, origin.x);\n\t\t\t\t\tscale = current.magnitude() / origin.magnitude();\n\t\t\t\t\ttranslate = begin.offset.add(end.offset).divideBy(2);\n\t\t\t\t}\n\n\t\t\t\tthis.deltaAngle = angle;\n\t\t\t\tthis.deltaScale = scale;\n\t\t\t\tthis.deltaMove = translate;\n\n\t\t\t\t// start animating when actual dragging starts\n\t\t\t\tif (this.getState() !== STATE_ACTIVE) {\n\t\t\t\t\tthis.setState(STATE_ACTIVE);\n\t\t\t\t\tthis.requestFrame();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\ttouchEnd(e) {\n\t\t\tlog.d(e);\n\t\t\te.preventDefault();\n\n\t\t\tvar touches = this.touches;\n\t\t\tvar removed = e.detail.sequence.id;\n\t\t\tvar index = touches.indexOf(removed);\n\t\t\tif (index > -1) {\n\t\t\t\ttouches.splice(index, 1);\n\t\t\t}\n\n\t\t\tthis.translation = this.getTranslation();\n\t\t\tthis.rotation = this.getRotation();\n\t\t\tthis.scaling = this.getScaling();\n\n\t\t\tthis.cancelFrame();\n\t\t\tthis.setState(STATE_PASSIVE);\n\t\t}\n\n\t\tgetTranslation() {\n\t\t\treturn this.translation.add(this.deltaMove);\n\t\t}\n\n\t\tgetRotation() {\n\t\t\treturn this.rotation + this.deltaAngle;\n\t\t}\n\n\t\tgetScaling() {\n\t\t\treturn this.scaling * this.deltaScale;\n\t\t}\n\n\t\thandleFrame() {\n\t\t\tvar translate = this.getTranslation();\n\t\t\tvar rotation = this.getRotation();\n\t\t\tvar scale = this.getScaling();\n\n\t\t\tvar transform = this.transform.\n\t\t\t\trotateZ(rotation).\n\t\t\t\tscale(scale).\n\t\t\t\ttranslate(translate);\n\n\t\t\tstyle.setTransform(this.node, transform);\n\n\t\t\tthis.requestFrame();\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.widget.VisualWidget', [\n\t'playtotv.widget.Widget'\n], function(Widget) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\n\t/**\n\t * Scales a contained image like background-size: cover or contain; The container must have (fixed or scaling)\n\t * dimensions in both width and height for the image to resize itself correctly. The container should have its\n\t * overflow set to hidden for optimal effect, but this is not required per se. Positioning is done using top\n\t * and/or left margins on the image.\n\t *\n\t * @class\n\t * @name VisualWidget\n\t * @memberOf playtotv.widget\n\t * @extends playtotv.widget.Widget\n\t * @param {Node} node\n\t * @param {object} [options]\n\t * @param {string} [options.mode='cover'] Sizing mode, either cover or contain\n\t * @param {string} [options.image='img'] Image selector\n\t */\n\treturn class VisualWidget extends Widget {\n\n\t\tconstructor(node, options) {\n\t\t\tsuper(node);\n\n\t\t\toptions = ptv.params(options, {\n\t\t\t\tmode: 'cover',\n\t\t\t\timage: 'img'\n\t\t\t});\n\n\t\t\tthis.image = $(options.image, node);\n\t\t\tthis.mode = options.mode;\n\t\t\tthis.handleResize = this.handleResize.bind(this);\n\n\t\t\tif (this.image) {\n\t\t\t\tthis.addEventListener(window, 'resize', this.handleResize);\n\t\t\t\tthis.addEventListener(this.image, 'load', this.handleResize);\n\t\t\t\tthis.handleResize();\n\t\t\t}\n\t\t}\n\n\t\t/** @lends playtotv.widget.VisualWidget.prototype */\n\n\t\t/**\n\t\t * Resize handler, automatically called onload of the image, and onresize of the window.\n\t\t * @param {Event} event\n\t\t */\n\t\thandleResize() {\n\t\t\tif (!this.node) {\n\t\t\t\treturn; // widget already exited in the mean while\n\t\t\t}\n\n\t\t\tvar node = this.node;\n\t\t\tvar img = this.image;\n\t\t\tvar mode = this.mode;\n\t\t\tvar css = img.style;\n\n\t\t\timg.removeAttribute('width');\n\t\t\timg.removeAttribute('height');\n\t\t\tcss.margin = 0;\n\n\t\t\tvar width = node.offsetWidth;\n\t\t\tvar height = node.offsetHeight;\n\n\t\t\tvar imageRatio = img.offsetWidth / img.offsetHeight;\n\t\t\tvar viewRatio = width / height;\n\n\t\t\tif ((viewRatio < imageRatio && mode === 'contain') ||\n\t\t\t\t(viewRatio > imageRatio && mode === 'cover')) {\n\n\t\t\t\tcss.marginTop = -((width / imageRatio) - height) / 2 + 'px';\n\t\t\t\timg.setAttribute('width', '100%');\n\n\t\t\t} else {\n\t\t\t\tcss.marginLeft = -((height * imageRatio) - width) / 2 + 'px';\n\t\t\t\timg.setAttribute('height', '100%');\n\t\t\t}\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.widget.WidgetManager', [\n\t// 'playtotv.MutationObserver'\n], function(\n\t// MutationObserver\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar dom = ptv.dom;\n\n\t/**\n\t * Monitors childList mutations to the DOM within a given node, and creates and removes widget instances for\n\t * encountered nodes matching registered widget types. Widgets are registered either using CSS selectors, or if\n\t * specified to the constructor, by attribute word value of the given attribute.\n\t *\n\t * @name WidgetManager\n\t * @class\n\t * @memberOf playtotv.widget\n\t * @param {Node} node Node to monitor and manage instances for\n\t * @param {string} [attr] Optional attribute to register widgets under rather than CSS selectors\n\t */\n\treturn class WidgetManager {\n\n\t\tconstructor(node, attr) {\n\t\t\tthis.node = node || document;\n\t\t\tthis.attr = attr;\n\t\t\tthis.definitions = [];\n\t\t\tthis.instances = [];\n\n\t\t\tptv.bindMethods(this, [\n\t\t\t\t'onMutations',\n\t\t\t\t'onNodeAdded',\n\t\t\t\t'onNodeRemoved'\n\t\t\t]);\n\n\t\t\t// TODO: Replace this by something simpler and better integrated with App\n\t\t\t// TODO: Replace data-widget=\"..\" data-...=\"[json]\" by widget=\"[json]\" like with on-event=\"[json]\"\n\t\t\t//\n\t\t\t// this.observer = new MutationObserver(this.onMutations);\n\t\t\t// this.observer.observe(this.node, {\n\t\t\t// \tchildList: true,\n\t\t\t// \tsubtree: true\n\t\t\t// });\n\t\t}\n\n\t\t/** @lends playtotv.widget.WidgetManager.prototype */\n\n\t\t/**\n\t\t * Registers a class under a given selector or attribute value with options for future class instances.\n\t\t *\n\t\t * @param {string} selector\n\t\t * @param {Function} Class\n\t\t * @param {Object|Function} [options]\n\t\t * @returns {Object} definition\n\t\t */\n\t\tregister(selector, Class, options) {\n\t\t\tvar proto = Class.prototype;\n\t\t\tif (!proto.getNode || !proto.dispose) {\n\t\t\t\tthrow new ReferenceError('Class must define getNode() and dispose() methods');\n\t\t\t}\n\n\t\t\tvar definition = {\n\t\t\t\tselector: this.attr ? '[' + this.attr + '~=\"' + selector + '\"]' : selector,\n\t\t\t\tClass: Class,\n\t\t\t\toptions: options\n\t\t\t};\n\n\t\t\tthis.definitions.push(definition);\n\t\t\tthis.createInstances(this.node, definition);\n\n\t\t\treturn definition;\n\t\t}\n\n\t\t/**\n\t\t * Unregisters a previously registered definition and disposes any existing instances\n\t\t *\n\t\t * @param {Object} definition\n\t\t */\n\t\tunregister(definition) {\n\t\t\tif (typeof definition !== 'object') {\n\t\t\t\tthrow new TypeError('Object expected');\n\t\t\t}\n\n\t\t\tvar definitions = this.definitions;\n\t\t\tvar index = definitions.indexOf(definition);\n\t\t\tif (index > -1) {\n\t\t\t\tthis.disposeInstances(this.node, definition);\n\t\t\t\tdefinitions.splice(index, 1);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Mutation observer callback, splits added and removed nodes to onNodeAdded and -removed.\n\t\t * @param {Array} mutations Array of mutation records, see {@link playtotv.MutationRecord}.\n\t\t */\n\t\tonMutations(mutations) {\n\t\t\tptv.each(mutations, function(mutation) {\n\t\t\t\tvar removed = mutation.removedNodes;\n\t\t\t\tif (removed.length) {\n\t\t\t\t\t// onMutations > onNodeRemoved > disposeInstances\n\t\t\t\t\tptv.each(removed, this.onNodeRemoved, this);\n\t\t\t\t}\n\n\t\t\t\tvar added = mutation.addedNodes;\n\t\t\t\tif (added.length) {\n\t\t\t\t\t// onMutations > onNodeAdded > createInstances\n\t\t\t\t\tptv.each(added, this.onNodeAdded, this);\n\t\t\t\t}\n\t\t\t}, this);\n\t\t}\n\n\t\t/**\n\t\t * Mutation handler for added nodes\n\t\t */\n\t\tonNodeAdded(node) {\n\t\t\tif (dom.isNode(node)) {\n\t\t\t\tthis.definitions.forEach(function(definition) {\n\t\t\t\t\tthis.createInstances(node, definition);\n\t\t\t\t}, this);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Mutation handler for removed nodes.\n\t\t */\n\t\tonNodeRemoved(node) {\n\t\t\tif (dom.isNode(node)) {\n\t\t\t\t// disposal checks current instances rather than known definitions, no need to forEach them.\n\t\t\t\tthis.disposeInstances(node);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Creates instances for and within the given node using the given definition's selector, Class and options.\n\t\t */\n\t\tcreateInstances(node, definition) {\n\t\t\tvar nodes = dom.any(definition.selector, node);\n\t\t\tnodes.forEach(function(item) {\n\t\t\t\tvar Class = definition.Class;\n\t\t\t\tif (!this.getWidget(item, Class)) {\n\t\t\t\t\tvar options = definition.options;\n\t\t\t\t\toptions = options instanceof Function ? options(item) : options;\n\t\t\t\t\tthis.instances.push(\n\t\t\t\t\t\tnew Class(item, options)\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}, this);\n\t\t}\n\n\t\t/**\n\t\t * Disposes any instances on and within the given node that were created by this WidgetManager.\n\t\t * A definition may be given to dispose only a subset of instances.\n\t\t */\n\t\tdisposeInstances(node, definition) {\n\t\t\tif (definition && !definition.Class) {\n\t\t\t\tthrow new TypeError('Illegal definition');\n\t\t\t}\n\n\t\t\tvar instances = this.instances;\n\t\t\tvar last = instances.length - 1;\n\t\t\tvar global = arguments.length < 2;\n\n\t\t\tfor (var instance, target, i = last; i >= 0; i--) {\n\t\t\t\tinstance = instances[i];\n\t\t\t\ttarget = instance.getNode();\n\t\t\t\tif (\n\t\t\t\t\ttarget &&\n\t\t\t\t\t(node.contains(target) || node === target) &&\n\t\t\t\t\t(global || instance.constructor === definition.Class)\n\t\t\t\t) {\n\t\t\t\t\tinstance.dispose();\n\t\t\t\t\tinstances.splice(i, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Returns the instance of the given class on the given node.\n\t\t */\n\t\tgetWidget(node, Class) {\n\t\t\tif (!Class) {\n\t\t\t\tthrow new ReferenceError('Class expected');\n\t\t\t}\n\n\t\t\treturn this.instances.find((instance) => instance.getNode() === node && instance.constructor === Class);\n\t\t}\n\n\t\t/**\n\t\t * Disposes this widgetManager and exits all instances for memory and -leaking purposes, and should be called\n\t\t * beforeUnload of the document, or at the time the widgetManager's own node is removed.\n\t\t */\n\t\tdispose() {\n\t\t\t// this.observer.disconnect();\n\t\t\tthis.disposeInstances(this.node);\n\n\t\t\tptv.dispose(this);\n\t\t}\n\t};\n});\n"
	]
}