{
	"version": 3,
	"sources": [
		"lib/es5.js",
		"lib/es6.js",
		"lib/next-tick.js",
		"lib/promise.js",
		"lib/promise-em.js",
		"lib/promise-cancellable.js",
		"lib/dollar.js",
		"lib/playtotv.js",
		"lib/playtotv/class.js",
		"lib/playtotv/dom.js",
		"lib/playtotv/event.js",
		"lib/playtotv/define.js",
		"lib/playtotv/util.js",
		"lib/playtotv/logger.js",
		"src/analytics/com-score-analytics.js",
		"src/analytics/google-analytics.js",
		"src/widget/widget.js",
		"src/analytics/analytics-widget.js",
		"src/animation-frame.js",
		"src/cookie.js",
		"src/cron.js",
		"src/css/vector.js",
		"src/css/point.js",
		"src/css/matrix.js",
		"src/css/style.js",
		"src/episode/episode-session-api.js",
		"src/facebook/facebook-adapter.js",
		"src/facebook/facebook-post-widget.js",
		"src/fx/animation.js",
		"src/fx/easing.js",
		"src/fx/timeline.js",
		"src/fx/transition.js",
		"src/global/generic-content-api.js",
		"src/global/global-data-api.js",
		"src/handlebars/hbs-util.js",
		"src/handlebars/helpers.js",
		"src/pubsub/subscription.js",
		"src/model/model-subscription.js",
		"src/pubsub/pub-sub.js",
		"src/model/abstract-model.js",
		"src/model/object-model.js",
		"src/facebook/facebook.js",
		"src/model/array-model.js",
		"src/model/model-util.js",
		"src/log-util.js",
		"src/mutation-observer.js",
		"src/mvc/helpers.js",
		"src/mvc/router.js",
		"src/pause-dog.js",
		"src/mvc/bind-widget.js",
		"src/mvc/update-widget.js",
		"src/mvc/controller.js",
		"src/episode/episode-controller.js",
		"src/fx/effects-controller.js",
		"src/global/global-controller.js",
		"src/timer.js",
		"src/mvc/view.js",
		"src/native/native-controller.js",
		"src/net/jsonp.js",
		"src/net/xhr-proxy.js",
		"src/net/request.js",
		"src/analytics/analytics-controller.js",
		"src/native/mock-native-controller.js",
		"src/push/push-controller.js",
		"src/question/question-api.js",
		"src/question/question-controller.js",
		"src/rating/rating-api.js",
		"src/rating/rating-input-widget.js",
		"src/rating/rating-controller.js",
		"src/relation/relation-subscription.js",
		"src/relation/relation-manager.js",
		"src/score/score-api.js",
		"src/server/gatekeeper-api.js",
		"src/storage/mock-storage.js",
		"src/storage/storage.js",
		"src/storage/async-storage.js",
		"src/storage/mock-async-storage.js",
		"src/server/server.js",
		"src/server/server-controller.js",
		"src/server/mock-server.js",
		"src/server/mock-server-controller.js",
		"src/touch/sequence.js",
		"src/touch/tracker.js",
		"src/touch/touch-proxy.js",
		"src/touch/touch-manager.js",
		"src/mvc/app.js",
		"src/twitter/twitter-api.js",
		"src/twitter/twitter-controller.js",
		"src/user/user.js",
		"src/user/users-api.js",
		"src/user/local-user.js",
		"src/user/user-controller.js",
		"src/user/user-manager.js",
		"src/widget/countdown-widget.js",
		"src/widget/draggable-widget.js",
		"src/widget/form-widget.js",
		"src/widget/scalable-widget.js",
		"src/widget/scrollable-widget.js",
		"src/widget/theme-widget.js",
		"src/widget/timer-widget.js",
		"src/widget/timestamp-widget.js",
		"src/widget/transformable-widget.js",
		"src/widget/visual-widget.js",
		"src/widget/widget-manager.js"
	],
	"names": [
		"nativeSlice",
		"slice",
		"nativeConcat",
		"concat",
		"funcProto",
		"Function",
		"prototype",
		"bind",
		"scope",
		"method",
		"this",
		"arguments",
		"length",
		"prepend",
		"call",
		"params",
		"apply",
		"stringProto",
		"String",
		"trim",
		"trimmer",
		"replace",
		"Date",
		"now",
		"getTime",
		"d1",
		"parse",
		"d2",
		"_parse",
		"s",
		"day",
		"tz",
		"rx",
		"p",
		"exec",
		"split",
		"i",
		"L",
		"parseInt",
		"UTC",
		"getDate",
		"setUTCMinutes",
		"getUTCMinutes",
		"NaN",
		"arrayProto",
		"Array",
		"indexOf",
		"value",
		"start",
		"obj",
		"Object",
		"l",
		"lastIndexOf",
		"forEach",
		"callback",
		"map",
		"result",
		"filter",
		"push",
		"some",
		"every",
		"reduce",
		"current",
		"reduceRight",
		"keys",
		"key",
		"has",
		"hasOwnProperty",
		"from",
		"toStr",
		"toString",
		"isCallable",
		"fn",
		"toInteger",
		"number",
		"Number",
		"isNaN",
		"isFinite",
		"Math",
		"floor",
		"abs",
		"maxSafeInteger",
		"pow",
		"toLength",
		"len",
		"min",
		"max",
		"arrayLike",
		"C",
		"items",
		"undefined",
		"TypeError",
		"T",
		"mapFn",
		"kValue",
		"A",
		"k",
		"find",
		"predicate",
		"list",
		"thisArg",
		"tick",
		"task",
		"tasks",
		"cb",
		"on",
		"args",
		"requestTick",
		"splice",
		"nextTick",
		"global",
		"window",
		"MutationObserver",
		"WebKitMutationObserver",
		"el",
		"document",
		"createElement",
		"observe",
		"attributes",
		"setAttribute",
		"setImmediate",
		"pending",
		"addEventListener",
		"onMessage",
		"e",
		"source",
		"data",
		"msg",
		"stopPropagation",
		"postMessage",
		"setTimeout",
		"isArray",
		"extend",
		"dst",
		"src",
		"Promise",
		"Resolver",
		"promise",
		"_callbacks",
		"_errbacks",
		"_status",
		"_result",
		"makeCallback",
		"resolve",
		"reject",
		"valueOrReason",
		"resolver",
		"_resolver",
		"reason",
		"fulfill",
		"status",
		"_notify",
		"_value",
		"_unwrap",
		"then",
		"self",
		"unwrapped",
		"_addCallbacks",
		"errback",
		"callbackList",
		"errbackList",
		"subs",
		"onResolve",
		"onReject",
		"constructor",
		"all",
		"values",
		"oneDone",
		"index",
		"results",
		"remaining",
		"race",
		"count",
		"catchIf",
		"catchClass",
		"Class",
		"finally",
		"Constructor",
		"defer",
		"deferred",
		"delay",
		"ms",
		"throttle",
		"interval",
		"timeout",
		"limit",
		"getShard",
		"limited",
		"shard",
		"shardMap",
		"last",
		"busy",
		"JSON",
		"stringify",
		"debounce",
		"debounced",
		"clearTimeout",
		"createClass",
		"Extend",
		"stat",
		"proto",
		"objectCreate",
		"create",
		"F",
		"CancellationError",
		"Error",
		"message",
		"captureStackTrace",
		"stack",
		"name",
		"TimeoutError",
		"Cancellable",
		"_promise",
		"_resolve",
		"_reject",
		"_parentPromises",
		"cancellable",
		"parents",
		"onThenResolve",
		"thenCancellable",
		"onThenReject",
		"cancel",
		"parentsLen",
		"toPromise",
		"$",
		"selector",
		"context",
		"querySelector",
		"$$",
		"querySelectorAll",
		"ptv",
		"playtotv",
		"nativeEach",
		"uid",
		"target",
		"literal",
		"toArray",
		"array",
		"getUID",
		"prefix",
		"each",
		"pluck",
		"item",
		"union",
		"pick",
		"copy",
		"omit",
		"randomNr",
		"delta",
		"random",
		"randomItem",
		"shuffle",
		"temp",
		"rand",
		"cursor",
		"shuffled",
		"unstack",
		"once",
		"memo",
		"ran",
		"AbstractFunction",
		"ReferenceError",
		"REQUIRED",
		"options",
		"defaults",
		"hasKey",
		"spliceParams",
		"spliced",
		"loadScript",
		"async",
		"script",
		"type",
		"loaded",
		"onload",
		"onreadystatechange",
		"rs",
		"readyState",
		"onerror",
		"head",
		"appendChild",
		"dispose",
		"instance",
		"disposed",
		"Proto",
		"definition",
		"Construct",
		"Base",
		"entity",
		"callbacks",
		"_super",
		"wrap",
		"Wrapped",
		"getInstance",
		"Type",
		"documentElement",
		"dataAttr",
		"dataMap",
		"matchesImplementation",
		"matches",
		"webkitMatchesSelector",
		"mozMatchesSelector",
		"msMatchesSelector",
		"oMatchesSelector",
		"Node",
		"contains",
		"arg",
		"compareDocumentPosition",
		"DOMTokenList",
		"node",
		"classList",
		"toggle",
		"_toggle",
		"token",
		"force",
		"dom",
		"first",
		"traverse",
		"sibling",
		"next",
		"nextSibling",
		"previous",
		"previousSibling",
		"closest",
		"any",
		"nodes",
		"isNode",
		"nodeType",
		"isChild",
		"attr",
		"html",
		"innerHTML",
		"text",
		"createTextNode",
		"remove",
		"parentNode",
		"removeChild",
		"appendTo",
		"refnode",
		"insertBefore",
		"insertAfter",
		"prependTo",
		"firstChild",
		"replaceChild",
		"parseHTML",
		"div",
		"fragment",
		"createDocumentFragment",
		"childNodes",
		"getData",
		"setData",
		"removeData",
		"getClosestAttr",
		"getAttribute",
		"getDataSet",
		"dataset",
		"substr",
		"match",
		"letter",
		"toUpperCase",
		"Event",
		"MouseEvent",
		"CustomEvent",
		"supportsCustom",
		"custom",
		"preventDefault",
		"eventProto",
		"event",
		"bubbles",
		"cancelable",
		"evt",
		"createEvent",
		"initEvent",
		"detail",
		"initCustomEvent",
		"screenX",
		"screenY",
		"clientX",
		"clientY",
		"ctrlKey",
		"altKey",
		"shiftKey",
		"metaKey",
		"button",
		"buttons",
		"relatedTarget",
		"initMouseEvent",
		"EventListener",
		"initialize",
		"listener",
		"addListener",
		"removeListener",
		"subject",
		"removeEventListener",
		"dispatchEvent",
		"triggerNative",
		"test",
		"addWindowOnError",
		"originalOnError",
		"errorMsg",
		"url",
		"line",
		"column",
		"error",
		"originalReturnValue",
		"getModuleURL",
		"id",
		"base",
		"pkgURL",
		"pkg",
		"path",
		"toLowerCase",
		"registerModule",
		"module",
		"space",
		"spaces",
		"loadPromises",
		"definePromises",
		"modules",
		"getModule",
		"define",
		"deps",
		"factory",
		"dependencies",
		"require",
		"getModuleId",
		"importModules",
		"ids",
		"nameReg",
		"decodeURIComponent",
		"util",
		"EMAIL_REGEXP",
		"RegExp",
		"URL_REGEXP",
		"ORIGIN_REGEXP",
		"escapeHtml",
		"unescaped",
		"escapeRegEx",
		"globToRegEx",
		"glob",
		"candidate",
		"addURLParam",
		"sep",
		"encodeURIComponent",
		"addURLParams",
		"getURLParams",
		"location",
		"href",
		"query",
		"regex",
		"getOrigin",
		"baseUrl",
		"loc",
		"origin",
		"protocol",
		"popup",
		"width",
		"winWidth",
		"screen",
		"left",
		"round",
		"height",
		"winHeight",
		"top",
		"features",
		"join",
		"open",
		"pad",
		"str",
		"ch",
		"timeStr",
		"date",
		"getHours",
		"getMinutes",
		"getSeconds",
		"getMilliseconds",
		"formatDate",
		"pattern",
		"_this",
		"hours",
		"letters",
		"output",
		"getFullYear",
		"getMonth",
		"toCurrency",
		"cents",
		"parseFloat",
		"toFixed",
		"nr",
		"dashCase",
		"m",
		"titleCase",
		"p1",
		"p2",
		"getPathHead",
		"getPathTail",
		"seekRef",
		"object",
		"seek",
		"ref",
		"resolvePath",
		"to",
		"fromDir",
		"getTimeZone",
		"getTimezoneOffset",
		"sign",
		"eval",
		"semiIndex",
		"mode",
		"_this2",
		"escapedValue",
		"regexStr",
		"fuzzy",
		"startsWith",
		"endsWith",
		"equals",
		"filterFn",
		"order",
		"_this3",
		"desc",
		"sort",
		"a",
		"b",
		"page",
		"size",
		"ceil",
		"paged",
		"prev",
		"loggers",
		"numericLevelMap",
		"SPAM",
		"DEBUG",
		"INFO",
		"WARNING",
		"ERROR",
		"NONE",
		"logFuncMap",
		"urlParams",
		"fbl",
		"weinre",
		"Logger",
		"level",
		"isEnabled",
		"myLevel",
		"log",
		"console",
		"processed",
		"logger",
		"trace",
		"d",
		"w",
		"logLevel",
		"logJoin",
		"get",
		"config",
		"udm_",
		"f",
		"h",
		"v",
		"t",
		"n",
		"r",
		"cookie",
		"o",
		"u",
		"c",
		"g",
		"escape",
		"unescape",
		"characterSet",
		"defaultCharset",
		"title",
		"URL",
		"referrer",
		"images",
		"Image",
		"ns_p",
		"write",
		"udm",
		"tag",
		"fields",
		"setFields",
		"dimensionMap",
		"metricMap",
		"requires",
		"skipView",
		"ga",
		"q",
		"getElementsByTagName",
		"appId",
		"trackerPromise",
		"tracker",
		"getByName",
		"sendView",
		"sendScreenview",
		"sendPageview",
		"sendError",
		"isFatal",
		"description",
		"sendException",
		"nonInteraction",
		"sendEvent",
		"send",
		"screenName",
		"exDescription",
		"exFatal",
		"time",
		"category",
		"variable",
		"sendTiming",
		"timingCategory",
		"timingVar",
		"timingValue",
		"action",
		"eventCategory",
		"eventAction",
		"sendSocial",
		"network",
		"socialNetwork",
		"socialAction",
		"socialTarget",
		"fieldName",
		"set",
		"processFields",
		"hitType",
		"hitCallback",
		"shift",
		"unshift",
		"eventListeners",
		"subscriptionRecords",
		"timeoutIds",
		"getNode",
		"eventListener",
		"found",
		"subscribe",
		"pubsub",
		"record",
		"subscription",
		"unsubscribe",
		"records",
		"_classCallCheck",
		"_inherits",
		"subClass",
		"superClass",
		"enumerable",
		"writable",
		"configurable",
		"setPrototypeOf",
		"__proto__",
		"Widget",
		"_Widget",
		"AnalyticsWidget",
		"app",
		"controller",
		"separator",
		"view",
		"load",
		"click",
		"submit",
		"change",
		"nonInteractionRE",
		"eventOptions",
		"parts",
		"onEvent",
		"eventLabel",
		"vendor",
		"request",
		"requestAnimationFrame",
		"cancelAnimationFrame",
		"vendors",
		"callTime",
		"nameEQ",
		"ca",
		"charAt",
		"substring",
		"days",
		"expires",
		"setTime",
		"toGMTString",
		"labelledLog",
		"job",
		"quiet",
		"label",
		"repeat",
		"jobs",
		"tickTimeout",
		"timeoutJobs",
		"_now",
		"promisedJobs",
		"returnValueOrPromise",
		"func",
		"returnValue",
		"process",
		"timeLeft",
		"cron",
		"tickInterval",
		"at",
		"halt",
		"debug",
		"_min",
		"_max",
		"_sqrt",
		"sqrt",
		"Vector",
		"x",
		"y",
		"add",
		"subtract",
		"multiply",
		"multiplyBy",
		"divide",
		"divideBy",
		"dot",
		"magnitude",
		"normalize",
		"inverse",
		"modulo",
		"exceeds",
		"unit",
		"FREE",
		"VERTICAL",
		"HORIZONTAL",
		"UP",
		"RIGHT",
		"DOWN",
		"LEFT",
		"ZERO",
		"Point",
		"z",
		"toVector",
		"parseCSSMatrix",
		"matrix",
		"regMatrix",
		"IDENTITY",
		"entityMap",
		"Matrix",
		"setMatrixValue",
		"entities",
		"m11",
		"m12",
		"m21",
		"m22",
		"m41",
		"m42",
		"j",
		"translate",
		"scale",
		"rotate",
		"rotateX",
		"rotateY",
		"rotateZ",
		"angle",
		"cos",
		"sin",
		"B",
		"D",
		"E",
		"G",
		"H",
		"K",
		"det",
		"transformPoint",
		"ua",
		"navigator",
		"userAgent",
		"browser",
		"gecko",
		"trident",
		"webkit",
		"presto",
		"PRIORITY",
		"cssTransform",
		"cssOrigin",
		"webkitConvert",
		"WebKitPoint",
		"webkitConvertPointFromPageToNode",
		"style",
		"getComputedStyle",
		"property",
		"setProperty",
		"computed",
		"getPropertyValue",
		"currentStyle",
		"removeProperty",
		"getSize",
		"offsetWidth",
		"offsetHeight",
		"getInnerSize",
		"clientWidth",
		"clientHeight",
		"getOffset",
		"parent",
		"offsetLeft",
		"offsetTop",
		"offsetParent",
		"fromNodeToPage",
		"vector",
		"point",
		"converted",
		"webkitConvertPointFromNodeToPage",
		"transform",
		"getFullTransform",
		"fromPageToNode",
		"setTransform",
		"getTransform",
		"removeTransform",
		"nodeTransform",
		"getTransformOrigin",
		"setPosition",
		"css",
		"getPosition",
		"setTranslate",
		"getTranslate",
		"getAsyncDataForEpisodeSession",
		"queryKeys",
		"getEpisodeSessionStateAsChanges",
		"getEpisodeSessionStateAsChangesSince",
		"getMaxScore",
		"getNonClosedSessions",
		"getNonClosedSessionsForShow",
		"getNonClosedSessionsForShowByName",
		"getSessionsInPhase",
		"getSessionsInPhaseForShow",
		"getSessionsInPhaseForShowByName",
		"getUserStatistics",
		"joinAndGetState",
		"joinInSync",
		"dataKeys",
		"leave",
		"facebook",
		"getLoginParams",
		"interactive",
		"login",
		"facebookId",
		"fbsr",
		"signedRequest",
		"displayName",
		"avatarUrl",
		"privateProperties",
		"props",
		"getCredentialParams",
		"ATTR_PREFIX",
		"content",
		"postId",
		"onClick",
		"post",
		"animationFrame",
		"Animation",
		"settings",
		"alternate",
		"cycles",
		"duration",
		"fps",
		"rate",
		"requestFrame",
		"playing",
		"onTick",
		"cancelFrame",
		"play",
		"stop",
		"animation",
		"frame",
		"startTime",
		"frameTime",
		"reversed",
		"onStart",
		"pause",
		"paused",
		"pauseTime",
		"resume",
		"reset",
		"onFrame",
		"anim",
		"totalTime",
		"cycle",
		"finished",
		"onCycle",
		"onFinish",
		"easing",
		"linear",
		"quadin",
		"quadout",
		"quadinout",
		"cubicin",
		"cubicout",
		"cubicinout",
		"quartin",
		"quartout",
		"quartinout",
		"Timeline",
		"actions",
		"run",
		"reverse",
		"passed",
		"transitionOptions",
		"Transition",
		"ease",
		"getCategory",
		"hbsUtil",
		"softException",
		"exception",
		"Handlebars",
		"Exception",
		"getValue",
		"getHash",
		"hash",
		"newHash",
		"getArgs",
		"names",
		"nrRequired",
		"nrOptional",
		"pop",
		"nrNames",
		"nrArgs",
		"requiredNames",
		"optionalNames",
		"extendContext",
		"callHelper",
		"_len",
		"_key",
		"helpers",
		"delegateIfBlock",
		"helperName",
		"clearHash",
		"var",
		"_hbsUtil$getArgs",
		"createFrame",
		"is",
		"_hbsUtil$getArgs2",
		"value1",
		"value2",
		"isnt",
		"_hbsUtil$getArgs3",
		"default",
		"_hbsUtil$getArgs4",
		"def",
		"switch",
		"_hbsUtil$getArgs5",
		"classes",
		"_hbsUtil$getArgs6",
		"inc",
		"_hbsUtil$getArgs7",
		"dec",
		"_hbsUtil$getArgs8",
		"gt",
		"_hbsUtil$getArgs9",
		"lt",
		"_hbsUtil$getArgs10",
		"not",
		"_hbsUtil$getArgs11",
		"or",
		"_hbsUtil$getArgs12",
		"and",
		"_hbsUtil$getArgs13",
		"inArray",
		"_hbsUtil$getArgs14",
		"_hbsUtil$getArgs15",
		"_hbsUtil$getArgs16",
		"toNumber",
		"_hbsUtil$getArgs17",
		"toBool",
		"_hbsUtil$getArgs18",
		"lowerCase",
		"_hbsUtil$getArgs19",
		"upperCase",
		"_hbsUtil$getArgs20",
		"_hbsUtil$getArgs21",
		"sentenceCase",
		"_hbsUtil$getArgs22",
		"_hbsUtil$getArgs23",
		"_hbsUtil$getArgs24",
		"_hbsUtil$getArgs25",
		"_hbsUtil$getArgs26",
		"inflect",
		"_hbsUtil$getArgs27",
		"singular",
		"plural",
		"truncate",
		"_hbsUtil$getArgs28",
		"dots",
		"_hbsUtil$getArgs29",
		"_hbsUtil$getArgs30",
		"getURLParam",
		"_hbsUtil$getArgs31",
		"urlOrKey",
		"_hbsUtil$getArgs32",
		"addCommas",
		"_hbsUtil$getArgs33",
		"decimal",
		"_hbsUtil$getArgs34",
		"digits",
		"_hbsUtil$getArgs35",
		"_hbsUtil$getArgs36",
		"_hbsUtil$getArgs37",
		"_hbsUtil$getArgs38",
		"_hbsUtil$getArgs39",
		"filtered",
		"_hbsUtil$getArgs40",
		"ordered",
		"paginate",
		"_hbsUtil$getArgs41",
		"json",
		"_hbsUtil$getArgs42",
		"pretty",
		"_hbsUtil$getArgs43",
		"pathResolve",
		"helperMissing",
		"handler",
		"channel",
		"deliver",
		"Subscription",
		"selectorRegex",
		"noValue",
		"subscriptions",
		"cancellables",
		"subscribeAll",
		"unsubscribeAll",
		"when",
		"publish",
		"sync",
		"ModelSubscription",
		"PubSub",
		"toObject",
		"updateModel",
		"isRelatedModel",
		"getSelectorAction",
		"colonIndex",
		"getSelectorKey",
		"eqIndex",
		"getSelectorValue",
		"getSelectorMatches",
		"val",
		"init",
		"AbstractModel",
		"propertyKeys",
		"childSubscriptionMap",
		"copyProperties",
		"keysLength",
		"sourceKeys",
		"removedValues",
		"sourceKey",
		"addProperty",
		"changeProperty",
		"root",
		"childModel",
		"model",
		"subscribeChild",
		"child",
		"childValue",
		"childAction",
		"childKey",
		"unsubscribeChild",
		"childSubscription",
		"valueIsModel",
		"oldValue",
		"ObjectModel",
		"accessToken",
		"version",
		"xfbml",
		"frictionlessRequests",
		"hideFlashCallback",
		"locale",
		"redirect",
		"initialized",
		"fbAsyncInit",
		"FB",
		"onStatusResponse",
		"getLoginStatus",
		"response",
		"authResponse",
		"userID",
		"what",
		"details",
		"timeoutDetails",
		"api",
		"ui",
		"getFriends",
		"loginByRedirect",
		"loginByDialog",
		"client_id",
		"response_type",
		"redirect_uri",
		"logout",
		"postByRedirect",
		"postByDialog",
		"postByAPI",
		"post_id",
		"app_id",
		"countEqualItems",
		"childSubscriptions",
		"sourceLength",
		"removedItems",
		"arrayLength",
		"itemIsModel",
		"RangeError",
		"oldItem",
		"removeWhere",
		"condition",
		"removed",
		"clear",
		"ArrayModel",
		"doNotThrow",
		"update",
		"updatedSource",
		"sValue",
		"mValue",
		"svIsArray",
		"svIsObject",
		"rValue",
		"rModel",
		"modelUtil",
		"logPubSub",
		"blacklist",
		"pc",
		"logModel",
		"pak",
		"logMethod",
		"methodName",
		"logName",
		"logMethods",
		"mutationRecord",
		"addedNodes",
		"removedNodes",
		"attributeName",
		"attributeNamespace",
		"mutationOptions",
		"childList",
		"characterData",
		"subtree",
		"attributeOldValue",
		"characterDataOldValue",
		"attributeFilter",
		"processors",
		"DOMNodeInserted",
		"inserted",
		"DOMNodeRemoved",
		"DOMAttrModified",
		"attrName",
		"prevValue",
		"DOMCharacterDataModified",
		"MutationProxy",
		"proxyEvent",
		"observer",
		"processor",
		"onModified",
		"addRecord",
		"disconnect",
		"WebkitMutationObserver",
		"MozMutationObserver",
		"listeners",
		"notify",
		"takeRecords",
		"templateStack",
		"methodPath",
		"methodRef",
		"serialized",
		"Utils",
		"escapeExpression",
		"SafeString",
		"widgets",
		"widget",
		"templatePath",
		"router",
		"partial",
		"partialBlock",
		"registerPartial",
		"partials",
		"templates",
		"unregisterPartial",
		"rescue",
		"patterns",
		"routes",
		"onhashchange",
		"getParams",
		"route",
		"PauseDog",
		"pauseCallbacks",
		"scheduleTick",
		"lastTick",
		"threshold",
		"pauseCallback",
		"pcb",
		"BindWidget",
		"_ptv$params",
		"updateInput",
		"updateController",
		"onInputChange",
		"checked",
		"UpdateWidget",
		"_PubSub",
		"Controller",
		"stored",
		"store",
		"storeKeys",
		"deserialize",
		"setWidgets",
		"serialize",
		"setWidget",
		"WidgetClass",
		"flush",
		"episodeSessionAPI",
		"_Controller",
		"EpisodeController",
		"timeZone",
		"showName",
		"showId",
		"episodeSessionId",
		"waiting",
		"episodeInteractionUserDataMap",
		"addMethods",
		"predictionTypes",
		"onStreamChange",
		"onChangeEvent",
		"onUpdateEvent",
		"online",
		"hasStarted",
		"adaptEpisode",
		"interactionMap",
		"interactionQueue",
		"asyncInteractions",
		"position",
		"episodeData",
		"episodeSession",
		"episode",
		"state",
		"stateChanges",
		"onStateChange",
		"checkState",
		"getEpisode",
		"checkingState",
		"sinceVersion",
		"getInteraction",
		"getCurrentInteraction",
		"getAsyncInteractions",
		"phase",
		"currentPhase",
		"interactions",
		"interaction",
		"upsertInteraction",
		"getNextAsyncInteraction",
		"submitInteraction",
		"interactionId",
		"adaptor",
		"_this4",
		"serverTime",
		"stateTime",
		"stateTimeMap",
		"ANSWER",
		"clientAnswerTime",
		"setInteractionUserData",
		"getInteractionUserData",
		"episodeId",
		"interactionUserDataMap",
		"payload",
		"stateDurationMap",
		"interactionContent",
		"interactionStats",
		"stats",
		"interactionUserData",
		"queueInteraction",
		"queue",
		"updateInteractionPosition",
		"lastquestion",
		"newVersion",
		"publishIfNotQuiet",
		"onPhaseChange",
		"onInteractionChange",
		"sessionPhase",
		"interactionState",
		"oldJSON",
		"EffectsController",
		"transitions",
		"fxDelay",
		"transitionMap",
		"defaultMap",
		"onceMap",
		"nodeAddedListeners",
		"onNodeAdded",
		"nodeRemoveListeners",
		"onNodeRemove",
		"transitionName",
		"getSelectors",
		"getTransition",
		"affected",
		"transition",
		"playAnimation",
		"enter",
		"prevAnimation",
		"genericContentAPI",
		"globalDataAPI",
		"GlobalController",
		"getContent",
		"getContentNow",
		"onData",
		"onUpdate",
		"uniqueIdField",
		"Timer",
		"t0",
		"accounted",
		"timings",
		"tx",
		"end",
		"total",
		"unaccounted",
		"pdom",
		"Polymer",
		"linkNode",
		"domNode",
		"domChildNodes",
		"nodesEqual",
		"node1",
		"node2",
		"TEXT_NODE",
		"COMMENT_NODE",
		"nodeName",
		"id1",
		"id2",
		"popEqualNode",
		"candidates",
		"addAttributeDiffs",
		"oldNode",
		"newNode",
		"diffs",
		"hasAttribute",
		"addClassDiffs",
		"oldClassList",
		"newClassList",
		"diffNodes",
		"oldChild",
		"newChild",
		"oldChildren",
		"newChildren",
		"ELEMENT_NODE",
		"pruneIndentation",
		"children",
		"View",
		"render",
		"parser",
		"DOMParser",
		"oldHTML",
		"oldDoc",
		"parseFromString",
		"prop",
		"updateNow",
		"timer",
		"intervalTimeout",
		"newHTML",
		"newDoc",
		"finish",
		"fixNodeOrder",
		"getDiffsDelay",
		"applyDiffs",
		"newDomChild",
		"prevDomChild",
		"parentDomNode",
		"DOCUMENT_POSITION_FOLLOWING",
		"diff",
		"diffNode",
		"importedNode",
		"domSibling",
		"importNode",
		"removeAttribute",
		"commandIdCounter",
		"NativeController",
		"wrapperPromise",
		"onWrapper",
		"gatekeeperPromise",
		"onGatekeeper",
		"onBackButton",
		"onPushEnabled",
		"onPushEnabledChange",
		"wrapper",
		"nativeWrapper",
		"sendMessage",
		"pauseDog",
		"commandId",
		"sendCommand",
		"resultPromise",
		"code",
		"gatekeeperResponse",
		"serverUrl",
		"gatekeeperData",
		"gatekeeperDataTime",
		"gatekeeperTimestamp",
		"dialog",
		"pressed",
		"back",
		"enabled",
		"getWrapper",
		"getGatekeeper",
		"overlay",
		"itunes",
		"affiliate",
		"isTwitterAvailable",
		"available",
		"tweet",
		"fbLogin",
		"permissions",
		"fbLogout",
		"fbGraph",
		"parameters",
		"httpMethod",
		"fbShare",
		"image",
		"contentTitle",
		"contentDescription",
		"contentURL",
		"imageURL",
		"loadAudio",
		"playAudio",
		"stopAudio",
		"jsonp",
		"timeoutId",
		"supportsObjectTestHandler",
		"supportsObject",
		"createIFrame",
		"iframe",
		"visibility",
		"overflow",
		"display",
		"getWindow",
		"deferredWindow",
		"deferredWindows",
		"body",
		"execBatch",
		"originWindow",
		"xhr",
		"xhrs",
		"batch",
		"_batch",
		"rpcAbort",
		"rpcs",
		"_execBatch",
		"addEventSupport",
		"upload",
		"_eventListenersMap",
		"xhrMethods",
		"xhrCounter",
		"stopImmediatePropagation",
		"win",
		"uploadEvent",
		"eventType",
		"responseText",
		"_readyStateChange",
		"xhrProxy",
		"timeoutRef",
		"responseData",
		"dataType",
		"windowOrigin",
		"urlOrigin",
		"headers",
		"username",
		"password",
		"onProgressDown",
		"onProgressUp",
		"cache",
		"XMLHttpRequest",
		"loadEventSupported",
		"errorEventSupported",
		"abortEventSupported",
		"timeoutEventSupported",
		"abort",
		"lengthComputable",
		"setRequestHeader",
		"taps",
		"tap",
		"ComScoreAnalytics",
		"GoogleAnalytics",
		"AnalyticsController",
		"privateGoogle",
		"sampleRate",
		"googles",
		"comScore",
		"addWidget",
		"googleOptions",
		"comScoreOptions",
		"privateError",
		"hookRequestTap",
		"cleanUrl",
		"privateTime",
		"timingLabel",
		"privateEvent",
		"lastView",
		"google",
		"Facebook",
		"getMatch",
		"idx",
		"_NativeController",
		"MockNativeController",
		"audioNodeMap",
		"getDevice",
		"capabilities",
		"pushEnabled",
		"requestUrl",
		"gatekeeperDataPromise",
		"services",
		"mockMessage",
		"initLoading",
		"loadingNode",
		"className",
		"bottom",
		"right",
		"background",
		"color",
		"text-align",
		"padding-top",
		"z-index",
		"deviceName",
		"deviceModel",
		"os",
		"osVersion",
		"onCommandHideLoading",
		"onCommandOpenDialog",
		"ok",
		"confirm",
		"alert",
		"onCommandSetPushEnabled",
		"onCommandIsTwitterAccountAvailable",
		"onCommandFacebookLogin",
		"onCommandFacebookLogout",
		"onCommandFacebookGraphRequest",
		"friends",
		"paging",
		"summary",
		"total_count",
		"me",
		"permission",
		"first_name",
		"last_name",
		"picture",
		"me/friends",
		"onCommandFacebookShare",
		"link",
		"onCommandLoadAudio",
		"onCommandPlayAudio",
		"onCommandStopAudio",
		"pushPollAPI",
		"getEvents",
		"PushController",
		"pollTimeout",
		"poll",
		"events",
		"stream",
		"getParticipantAnswers",
		"getQuestion",
		"getQuestionStats",
		"submitAnswer",
		"questionAPI",
		"QuestionController",
		"idCode",
		"submitting",
		"questionId",
		"answerCodes",
		"decorateAnswers",
		"question",
		"statsAnswers",
		"answers",
		"submittedAnswerCodes",
		"submittedAnswers",
		"answer",
		"answerCode",
		"answerStats",
		"submitted",
		"getRating",
		"getRatingStats",
		"submitRating",
		"RatingInputWidget",
		"onChange",
		"ratingAPI",
		"FACTOR",
		"RatingController",
		"addWidgets",
		"valueMap",
		"ratingId",
		"submittedValueMap",
		"decorateSubjects",
		"rating",
		"subjectAverages",
		"subjects",
		"subjectCode",
		"subjectAverage",
		"average",
		"regexIndex",
		"RelationSubscription",
		"rel",
		"getCurrentLeaderboardPage",
		"getCurrentLeaderboardPageForInterval",
		"getEpisodeLeaderboardPage",
		"getEpisodeScores",
		"getLeaderboardPageForInterval",
		"getTimeSpanScores",
		"getInit",
		"_container",
		"getItem",
		"setItem",
		"_updateLength",
		"removeItem",
		"MockStorage",
		"Storage",
		"storage",
		"localStorage",
		"defaultValue",
		"quotaHandler",
		"DOMException",
		"QUOTA_EXCEEDED_ERR",
		"subStorage",
		"subPrefix",
		"sql",
		"db",
		"transaction",
		"executeSql",
		"moduleId",
		"TABLE",
		"ready",
		"openDatabase",
		"rows",
		"AsyncStorage",
		"_AsyncStorage",
		"MockAsyncStorage",
		"gatekeeperAPI",
		"gatekeeperInit",
		"gatekeeper",
		"urls",
		"timeOffset",
		"clientMinimalVersion",
		"badDelay",
		"onRetry",
		"serviceUrls",
		"urlPromises",
		"gatekeeperUrl",
		"getGatekeeperServiceUrl",
		"service",
		"retryDelay",
		"resolveTaps",
		"rejectTaps",
		"setStatus",
		"getServiceUrl",
		"checkBad",
		"badPending",
		"urlKeys",
		"placeholders",
		"placeholder",
		"validateCall",
		"validKeys",
		"invalidKeys",
		"requiredKeys",
		"undefinedKeys",
		"_getServiceUrls",
		"dataPromise",
		"serviceType",
		"getServiceUrls",
		"myServiceUrls",
		"newServiceUrls",
		"urlsService",
		"myNewServiceUrls",
		"invalidateServiceUrl",
		"retry",
		"currentSettings",
		"getUrlAndRequest",
		"methodUrl",
		"urlPromise",
		"serviceUrl",
		"requestPromise",
		"methodService",
		"gatekeeperMethodUrl",
		"toClientTime",
		"toServerTime",
		"clientTime",
		"Server",
		"callAsyncCounter",
		"ServerController",
		"server",
		"getServer",
		"properties",
		"methods",
		"addMethod",
		"asyncCalls",
		"onAsyncResponse",
		"addRejectTap",
		"tapFn",
		"callAsync",
		"callId",
		"responseStatus",
		"responseBody",
		"mocks",
		"isDefaultValue",
		"mockMap",
		"gatekeeperLabel",
		"pushPollLabel",
		"mockGatekeeper",
		"mockPushPoll",
		"mock",
		"template",
		"MockServer",
		"_ServerController",
		"MockServerController",
		"SWIPE_DELAY",
		"SENSITIVITY",
		"Sequence",
		"pointerId",
		"identifier",
		"offset",
		"velocity",
		"isTap",
		"isSwipe",
		"clearSwipe",
		"nativeMap",
		"Tracker",
		"touches",
		"touch",
		"sequence",
		"empty",
		"needsFastClick",
		"nativeTouch",
		"nativePointers",
		"maxPointers",
		"winMobile",
		"iOs",
		"android",
		"chrome",
		"firefox",
		"viewMeta",
		"touchAction",
		"msTouchAction",
		"inputReg",
		"CLICK_DELAY",
		"maxTouchPoints",
		"msMaxTouchPoints",
		"TouchProxy",
		"fastClick",
		"preventNative",
		"propagateNative",
		"startEvent",
		"moveEvent",
		"endEvent",
		"touchStart",
		"changed",
		"getChangedTouches",
		"added",
		"prevent",
		"tracking",
		"bindEvents",
		"touchMove",
		"touchEnd",
		"isFastClick",
		"preventNextClick",
		"unbindEvents",
		"proxy",
		"nativeEvent",
		"getTouches",
		"changedTouches",
		"getSequence",
		"getSequences",
		"nextClick",
		"dx",
		"dy",
		"TOUCH_ENABLED",
		"touchManager",
		"proxies",
		"captureEvents",
		"isCaptured",
		"releaseEvents",
		"getAngle",
		"atan2",
		"getOrientation",
		"getDirection",
		"Router",
		"logUtil",
		"App",
		"registerHelper",
		"mockStorage",
		"reloadTime",
		"constructStorage",
		"constructRouter",
		"touchCaptured",
		"constructTouch",
		"constructView",
		"constructPauseDog",
		"widgetMap",
		"onError",
		"startLog",
		"StorageClass",
		"reload",
		"startView",
		"addController",
		"ControllerClass",
		"_this5",
		"debouncedFlush",
		"addControllers",
		"controllers",
		"_this6",
		"_this7",
		"instantiateWidget",
		"instanceOptions",
		"removeWidgets",
		"by",
		"runScript",
		"_this8",
		"scriptContext",
		"_JSON$parse",
		"_this9",
		"attribute",
		"_this10",
		"tail",
		"unobserve",
		"openify",
		"_ptv$params2",
		"history",
		"go",
		"_this11",
		"getRecentTweets",
		"twitterAPI",
		"TwitterController",
		"maxItems",
		"tweets",
		"cap",
		"addTweet",
		"getTweetParts",
		"part",
		"intent",
		"profileProperties",
		"addEmailCredentials",
		"addExternalIdCredentials",
		"addFacebookCredentials",
		"changePassword",
		"generatePassword",
		"getLoginCredentialStatus",
		"getPrivateProperty",
		"getProfile",
		"getProfileProperty",
		"getUsers",
		"loginByAuthenticationToken",
		"loginByEmail",
		"loginByExternalId",
		"loginByFacebook",
		"logoutByPut",
		"registerAsGuest",
		"registerByEmail",
		"removeExternalId",
		"removeFacebookCredentials",
		"requestDeletion",
		"requestEmailChange",
		"requestPasswordChange",
		"scheduleUserForDeletion",
		"setPrivateProperty",
		"setProfileProperty",
		"updateProfile",
		"verifyEmail",
		"verifyPasswordChange",
		"User",
		"usersAPI",
		"user",
		"authenticationToken",
		"pttvSession",
		"email",
		"UserController",
		"loginBy",
		"loginByToken",
		"optionalValues",
		"profile",
		"propertyName",
		"extendPrivateProfile",
		"LocalUser",
		"authenticationMethod",
		"localUser",
		"onServerReject",
		"saveAuthentication",
		"remember",
		"credentials",
		"loginCredentialStatus",
		"onLogout",
		"userId",
		"baseParams",
		"runtimeId",
		"optionalParams",
		"teamTag",
		"emailOptinMode",
		"processParams",
		"optionalKeys",
		"rememberMe",
		"forget",
		"onExpire",
		"CountdownWidget",
		"dd",
		"hh",
		"mm",
		"ss",
		"updateDigit",
		"STATE_PASSIVE",
		"STATE_ACTIVE",
		"DraggableWidget",
		"orientation",
		"restrict",
		"elastic",
		"inertia",
		"friction",
		"priority",
		"handle",
		"handleAnim",
		"outside",
		"limiter",
		"restricter",
		"dragStart",
		"dragMove",
		"dragEnd",
		"handleSwipe",
		"setup",
		"moveTo",
		"setState",
		"getState",
		"handleFrame",
		"touchId",
		"lastOrientation",
		"hasPriority",
		"restricted",
		"factor",
		"pulling",
		"swipe",
		"handleStopped",
		"requested",
		"moveBy",
		"moveIntoView",
		"swipeTo",
		"setRelative",
		"getRelative",
		"moved",
		"pos",
		"ex",
		"ey",
		"res",
		"ValidityTest",
		"REQURIED",
		"fallback",
		"supported",
		"validate",
		"input",
		"checkValidity",
		"validityTests",
		"form",
		"elements",
		"FormWidget",
		"highlight",
		"field",
		"validateChange",
		"highlightClass",
		"onSubmit",
		"tests",
		"validateForm",
		"errors",
		"valid",
		"validity",
		"originalEvent",
		"validateInput",
		"getElements",
		"element",
		"option",
		"selected",
		"ScalableWidget",
		"resize",
		"onResize",
		"setScale",
		"sizeToScale",
		"landscape",
		"offside",
		"getScale",
		"ScrollableWidget",
		"thumbH",
		"thumbV",
		"active",
		"disabled",
		"activeClass",
		"disabledClass",
		"dir",
		"pane",
		"class",
		"handleStart",
		"handleDrag",
		"handleEnd",
		"updateThumbs",
		"relative",
		"elasticity",
		"thumbSize",
		"thumbSpace",
		"thumbPos",
		"horizontal",
		"vertical",
		"toggleActive",
		"scrolling",
		"scrollIntoView",
		"scrollTo",
		"indicate",
		"sx",
		"scrollLeft",
		"sy",
		"scrollTop",
		"ThemeWidget",
		"theme",
		"TimerWidget",
		"indicator",
		"inverted",
		"autoplay",
		"bar",
		"inv",
		"_options",
		"_start",
		"starttime",
		"DAY_HOURS",
		"HOUR_MINUTES",
		"MINUTE_SECONDS",
		"HOUR_SECONDS",
		"DAY_SECONDS",
		"TimestampWidget",
		"seconds",
		"translation",
		"scaling",
		"rotation",
		"deltaMove",
		"deltaAngle",
		"deltaScale",
		"begin",
		"getTranslation",
		"getRotation",
		"getScaling",
		"VisualWidget",
		"handleResize",
		"img",
		"margin",
		"imageRatio",
		"viewRatio",
		"marginTop",
		"marginLeft",
		"WidgetManager",
		"definitions",
		"instances",
		"register",
		"createInstances",
		"unregister",
		"disposeInstances",
		"onMutations",
		"mutations",
		"mutation",
		"onNodeRemoved",
		"getWidget"
	],
	"mappings": "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",
	"file": "playtotv-client-lib-1.17.4a.min.js",
	"sourcesContent": [
		"/**\n * EcmaScript 5 shim, mostly for IE8.\n * Note: Does not provide complete ES5 compatibility.\n */\n(function() {\n\t/*jshint maxstatements: 100, maxcomplexity:100*/\n\n\t'use strict';\n\n\tvar nativeSlice = [].slice;\n\tvar nativeConcat = [].concat;\n\n\t/**\n\t * Function prototype\n\t */\n\n\tvar funcProto = Function.prototype;\n\n\tif (!funcProto.bind) {\n\t\tfuncProto.bind = function(scope) {\n\t\t\tvar method = this;\n\n\t\t\tif (arguments.length > 1) {\n\t\t\t\t// any arguments in addition to scope are prepended when the method is called\n\t\t\t\tvar prepend = nativeSlice.call(arguments, 1);\n\t\t\t\treturn function() {\n\t\t\t\t\tvar params = nativeConcat.apply(prepend, arguments);\n\t\t\t\t\treturn method.apply(scope, params);\n\t\t\t\t};\n\n\t\t\t} else {\n\t\t\t\t// conditional for performance, don't want to concat empty arrays\n\t\t\t\treturn function() {\n\t\t\t\t\treturn method.apply(scope, arguments);\n\t\t\t\t};\n\t\t\t}\n\t\t};\n\t}\n\n\t/**\n\t * String prototype\n\t */\n\n\tvar stringProto = String.prototype;\n\n\tif (!stringProto.trim) {\n\t\tvar trimmer = /(^\\s+)|(\\s+)$/g;\n\t\tstringProto.trim = function() {\n\t\t\treturn this.replace(trimmer, '');\n\t\t};\n\t}\n\n\t/**\n\t * Date\n\t */\n\n\tif (!Date.now) {\n\t\tDate.now = function() {\n\t\t\treturn (new Date()).getTime();\n\t\t};\n\t}\n\n\t// Ensure Date.parse properly supports ISO8601\n\t(function() {\n\t\t// Based on: http://stackoverflow.com/questions/11020658/javascript-json-date-parse-in-ie7-ie8-returns-nan\n\t\tvar d1 = Date.parse('2011-06-02T09:34:29+02:00');\n\t\tvar d2 = Date.parse('2011-06-02T09:34:29+0200');\n\t\tif (d1 !== d2 || d1 !== 1307000069000) {\n\t\t\t// ISO8601 support needs to be improved\n\t\t\tvar _parse = Date.parse;\n\t\t\tDate.parse = function(s) {\n\t\t\t\tvar day, tz;\n\t\t\t\tvar rx = /^(\\d{4}\\-\\d\\d\\-\\d\\d([tT][\\d:\\.]*)?)([zZ]|([+\\-])(\\d\\d):?(\\d\\d))?$/;\n\t\t\t\tvar p = rx.exec(s) || [];\n\t\t\t\tif (p[1]) {\n\t\t\t\t\tday = p[1].split(/\\D/);\n\t\t\t\t\tfor (var i = 0, L = day.length; i < L; i++) {\n\t\t\t\t\t\tday[i] = parseInt(day[i], 10) || 0;\n\t\t\t\t\t}\n\t\t\t\t\tday[1] -= 1;\n\t\t\t\t\tday = new Date(Date.UTC.apply(Date, day));\n\t\t\t\t\tif (!day.getDate()) { return NaN; }\n\t\t\t\t\tif (p[5]) {\n\t\t\t\t\t\ttz = parseInt(p[5], 10) * 60;\n\t\t\t\t\t\tif (p[6]) { tz += parseInt(p[6], 10); }\n\t\t\t\t\t\tif (p[4] === '+') { tz *= -1; }\n\t\t\t\t\t\tif (tz) { day.setUTCMinutes(day.getUTCMinutes() + tz); }\n\t\t\t\t\t}\n\t\t\t\t\treturn day.getTime();\n\t\t\t\t} else {\n\t\t\t\t\t// Regex failed, not ISO8601? Fallback to native Date.parse().\n\t\t\t\t\treturn _parse(s);\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t})();\n\n\t/**\n\t * Array prototype\n\t */\n\n\tvar arrayProto = Array.prototype;\n\n\t// 1.6\n\n\tif (!arrayProto.indexOf) {\n\t\tarrayProto.indexOf = function(value, start) {\n\t\t\t/*jshint newcap:false*/\n\t\t\tvar i, obj = Object(this), l = obj.length;\n\t\t\tfor (i = start || 0; i < l; i++) {\n\t\t\t\tif (i in obj && obj[i] === value) {\n\t\t\t\t\treturn i;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn -1;\n\t\t};\n\t}\n\n\tif (!arrayProto.lastIndexOf) {\n\t\tarrayProto.lastIndexOf = function(value, start) {\n\t\t\t/*jshint newcap:false*/\n\t\t\tvar i, obj = Object(this), l = obj.length;\n\t\t\tfor (i = start || (l - 1); i >= 0; i--) {\n\t\t\t\tif (i in obj && obj[i] === value) {\n\t\t\t\t\treturn i;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn -1;\n\t\t};\n\t}\n\n\tif (!arrayProto.forEach) {\n\t\tarrayProto.forEach = function(callback, scope) {\n\t\t\t/*jshint newcap:false*/\n\t\t\tvar i, obj = Object(this), l = obj.length;\n\t\t\tfor (i = 0; i < l; i++) {\n\t\t\t\tif (i in obj) {\n\t\t\t\t\tcallback.call(scope, obj[i], i, obj);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\tif (!arrayProto.map) {\n\t\tarrayProto.map = function(callback, scope) {\n\t\t\t/*jshint newcap:false*/\n\t\t\tvar i, result = [], obj = Object(this), l = obj.length;\n\t\t\tfor (i = 0; i < l; i++) {\n\t\t\t\tif (i in obj) {\n\t\t\t\t\tresult[i] = callback.call(scope, obj[i], i, obj);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn result;\n\t\t};\n\t}\n\n\tif (!arrayProto.filter) {\n\t\tarrayProto.filter = function(callback, scope) {\n\t\t\t/*jshint newcap:false*/\n\t\t\tvar i, result = [], value, obj = Object(this), l = obj.length;\n\t\t\tfor (i = 0; i < l; i++) {\n\t\t\t\tif (i in obj) {\n\t\t\t\t\tvalue = obj[i];\n\t\t\t\t\tif (callback.call(scope, value, i, obj)) {\n\t\t\t\t\t\tresult.push(value);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn result;\n\t\t};\n\t}\n\n\tif (!arrayProto.some) {\n\t\tarrayProto.some = function(callback, scope) {\n\t\t\t/*jshint newcap:false*/\n\t\t\tvar i, obj = Object(this), l = obj.length;\n\t\t\tfor (i = 0; i < l; i++) {\n\t\t\t\tif (i in obj && callback.call(scope, obj[i], i, obj)) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t};\n\t}\n\n\tif (!arrayProto.every) {\n\t\tarrayProto.every = function(callback, scope) {\n\t\t\t/*jshint newcap:false*/\n\t\t\tvar i, obj = Object(this), l = obj.length;\n\t\t\tfor (i = 0; i < l; i++) {\n\t\t\t\tif (i in obj && !callback.call(scope, obj[i], i, obj)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t};\n\t}\n\n\t// 1.8\n\n\tif (!arrayProto.reduce) {\n\t\tarrayProto.reduce = function(callback, current) {\n\t\t\t/*jshint newcap:false*/\n\t\t\tvar i = 0, obj = Object(this), l = obj.length;\n\t\t\tif (arguments.length <= 1) {\n\t\t\t\tcurrent = obj[0];\n\t\t\t\ti = 1;\n\t\t\t}\n\n\t\t\tfor (; i < l; i++) {\n\t\t\t\tif (i in obj) {\n\t\t\t\t\tcurrent = callback(current, obj[i], i, obj);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn current;\n\t\t};\n\t}\n\n\tif (!arrayProto.reduceRight) {\n\t\tarrayProto.reduceRight = function(callback, current) {\n\t\t\t/*jshint newcap:false*/\n\t\t\tvar obj = Object(this), l = obj.length, i = l - 1;\n\t\t\tif (arguments.length <= 1) {\n\t\t\t\tcurrent = obj[i];\n\t\t\t\ti = l - 2;\n\t\t\t}\n\n\t\t\tfor (; i >= 0; i--) {\n\t\t\t\tif (i in obj) {\n\t\t\t\t\tcurrent = callback(current, obj[i], i, obj);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn current;\n\t\t};\n\t}\n\n\t/**\n\t * Object\n\t */\n\n\tif (!Object.keys) {\n\t\tObject.keys = function(obj) {\n\t\t\tvar key, keys = [];\n\t\t\tvar has = Object.prototype.hasOwnProperty; // for `window` on <=IE8\n\t\t\tfor (key in obj) {\n\t\t\t\tif (has.call(obj, key)) {\n\t\t\t\t\tkeys.push(key);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn keys;\n\t\t};\n\t}\n\n}());\n",
		"/**\n * EcmaScript 6 shim.\n * Note: Does not provide complete ES6 compatibility (just a tiny bit right now actually).\n *\n * TODO: Just use all/subset of https://github.com/zloirock/core-js? (also good for Babel ES Next support)\n */\n(function() {\n\t/*jshint maxstatements: 100, maxcomplexity:100*/\n\n\t'use strict';\n\n\t// Source: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/from\n\tif (!Array.from) {\n\t\tArray.from = (function() {\n\t\t\tvar toStr = Object.prototype.toString;\n\t\t\tvar isCallable = function(fn) {\n\t\t\t\treturn typeof fn === 'function' || toStr.call(fn) === '[object Function]';\n\t\t\t};\n\t\t\tvar toInteger = function(value) {\n\t\t\t\tvar number = Number(value);\n\t\t\t\tif (isNaN(number)) { return 0; }\n\t\t\t\tif (number === 0 || !isFinite(number)) { return number; }\n\t\t\t\treturn (number > 0 ? 1 : -1) * Math.floor(Math.abs(number));\n\t\t\t};\n\t\t\tvar maxSafeInteger = Math.pow(2, 53) - 1;\n\t\t\tvar toLength = function(value) {\n\t\t\t\tvar len = toInteger(value);\n\t\t\t\treturn Math.min(Math.max(len, 0), maxSafeInteger);\n\t\t\t};\n\n\t\t\treturn function from(arrayLike/*, mapFn, thisArg */) {\n\t\t\t\tvar C = this;\n\t\t\t\tvar items = Object(arrayLike);\n\t\t\t\tif (arrayLike === null || arrayLike === undefined) {\n\t\t\t\t\tthrow new TypeError('Array.from requires an array-like object - not null or undefined');\n\t\t\t\t}\n\n\t\t\t\tvar mapFn = arguments.length > 1 ? arguments[1] : void undefined;\n\t\t\t\tvar T;\n\t\t\t\tif (typeof mapFn !== 'undefined') {\n\t\t\t\t\tif (!isCallable(mapFn)) {\n\t\t\t\t\t\tthrow new TypeError('Array.from: when provided, the second argument must be a function');\n\t\t\t\t\t}\n\n\t\t\t\t\tif (arguments.length > 2) {\n\t\t\t\t\t\tT = arguments[2];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tvar len = toLength(items.length);\n\t\t\t\tvar A = isCallable(C) ? Object(new C(len)) : new Array(len);\n\t\t\t\tvar k = 0;\n\t\t\t\tvar kValue;\n\t\t\t\twhile (k < len) {\n\t\t\t\t\tkValue = items[k];\n\t\t\t\t\tif (mapFn) {\n\t\t\t\t\t\tA[k] = typeof T === 'undefined' ? mapFn(kValue, k) : mapFn.call(T, kValue, k);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tA[k] = kValue;\n\t\t\t\t\t}\n\t\t\t\t\tk += 1;\n\t\t\t\t}\n\n\t\t\t\tA.length = len;\n\t\t\t\treturn A;\n\t\t\t};\n\t\t}());\n\t}\n\n\tif (!Array.prototype.find) {\n\t\tArray.prototype.find = function(predicate) {\n\t\t\tvar list = this;\n\t\t\tvar length = list.length;\n\t\t\tvar thisArg = arguments[1]; // optional argument\n\t\t\tvar value;\n\t\t\tfor (var i = 0; i < length; i++) {\n\t\t\t\tvalue = list[i];\n\t\t\t\tif (predicate.call(thisArg, value, i, list)) {\n\t\t\t\t\treturn value;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn undefined;\n\t\t};\n\t}\n\n}());\n",
		"(function() {\n\n\t'use strict';\n\n\t// Reliably get a global reference on all platforms by looking at a non-strict function's \"this\"\n\tvar global = /*jshint evil:true*/ new Function('return this')(); /*jshint evil:false*/\n\tvar window = global.window || {};\n\tvar MutationObserver = window.MutationObserver || window.WebKitMutationObserver;\n\tvar tasks = [];\n\n\tfunction tick() {\n\t\t// Note current length, any tasks beyond should be processed in the next tick\n\t\tvar i = 0;\n\t\tvar len = tasks.length;\n\t\tvar task;\n\n\t\t// Catch exceptions without actually catching them to leave stack traces nice and pristine\n\t\ttry {\n\t\t\tfor (; i < len; i++) {\n\t\t\t\ttask = tasks[i];\n\t\t\t\ttask.cb.apply(task.on, task.args);\n\t\t\t}\n\t\t} finally {\n\t\t\t// If we did not cleanly finish the iteration then move past the task that threw the exception\n\t\t\t// and request another tick if necessary to finish processing the remaining tasks\n\t\t\tif (i < len && ++i < len) {\n\t\t\t\trequestTick();\n\t\t\t}\n\n\t\t\t// Remove tasks that were called in this tick\n\t\t\ttasks.splice(0, i);\n\t\t}\n\t}\n\n\tvar requestTick =\n\n\t\t// MutationObserver is crazy fast (micro task)\n\t\t// Supported by: Chrome, FF, Safari, IE11+\n\t\tMutationObserver ?\n\t\t(function() {\n\t\t\tvar el = document.createElement('div');\n\t\t\tnew MutationObserver(tick).observe(el, { attributes: true });\n\t\t\t// MutationObserver already takes care of batching observer callbacks itself so forget about pending\n\t\t\treturn function() {\n\t\t\t\tel.setAttribute('x', 'x');\n\t\t\t};\n\t\t}()) :\n\n\t\t// setImmediate is 3 times faster then message events in IE10 and very fast in Node\n\t\t// Supported by: IE10+, Node 0.10+\n\t\tglobal.setImmediate ?\n\t\t(function() {\n\t\t\tvar pending = false;\n\t\t\treturn function() {\n\t\t\t\tif (!pending) {\n\t\t\t\t\tpending = global.setImmediate(function() {\n\t\t\t\t\t\tpending = false;\n\t\t\t\t\t\ttick();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\t\t}()) :\n\n\t\t// Window message events are about 25 times slower then MutationObserver, but still fast\n\t\t// Supported by: IE9, IE10, Android\n\t\t// Note: IE8 does have message support using attachEvent instead of addEventListener, but is not asynchronous\n\t\twindow.addEventListener ?\n\t\t(function() {\n\t\t\tvar pending = false;\n\t\t\tvar msg = 'nextTick';\n\t\t\tfunction onMessage(e) {\n\t\t\t\tif (e.source === window && e.data === msg) {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tpending = false;\n\t\t\t\t\ttick();\n\t\t\t\t}\n\t\t\t}\n\t\t\twindow.addEventListener('message', onMessage, true);\n\t\t\treturn function() {\n\t\t\t\tif (!pending) {\n\t\t\t\t\twindow.postMessage(msg, '*');\n\t\t\t\t\tpending = true;\n\t\t\t\t}\n\t\t\t};\n\t\t}()) :\n\n\t\t// setTimeout is about 500 times slower then MutationObserver\n\t\t// Supported by: everything\n\t\t(function() {\n\t\t\tvar pending = false;\n\t\t\treturn function() {\n\t\t\t\tif (!pending) {\n\t\t\t\t\tpending = setTimeout(function() {\n\t\t\t\t\t\tpending = false;\n\t\t\t\t\t\ttick();\n\t\t\t\t\t}, 0);\n\t\t\t\t}\n\t\t\t};\n\t\t}());\n\n\t/**\n\t * Call the specified callback asynchronously, but as soon as possible.\n\t *\n\t * The name is inspired by Node.js' process.nextTick.\n\t *\n\t * The similar setImmediate function was drafted for W3C but remains impopular with FireFox and Chrome developers\n\t * (<a href=\"http://www.nczonline.net/blog/2013/07/09/the-case-for-setimmediate/\">more info</a>).\n\t *\n\t * This either uses MutationObserver, setImmediate, window message events or plain old setTimeout.\n\t *\n\t * Callbacks are batched to improve performance.\n\t * If an exception is thrown by a callback it is not caught to prevent losing valuable stack trace information.\n\t * In such a case the remainder of the batch of callbacks will still be executed, but not on the same tick to\n\t * prevent issues due to excessive recursion.\n\t *\n\t * Note: Do not immediately call nextTick again from each tick callback.\n\t *\n\t * TODO: Replace by setImmediate shim.\n\t *\n\t * @param {Function} callback\n\t * @param {Object} [thisArg=undefined]\n\t * @param {Array} [args=[]]\n\t */\n\tfunction nextTick(callback, thisArg, args) {\n\t\ttasks.push({ cb: callback, on: thisArg, args: args || [] });\n\t\trequestTick();\n\t}\n\n\t// Expose function\n\tglobal.nextTick = nextTick;\n\n}());\n",
		"/*\nECMAScript 6 Promise shim.\n\nImproved version of ypromise: https://github.com/yahoo/ypromise\n\nCopyright 2013 Yahoo! Inc. All rights reserved.\nLicensed under the BSD License.\nhttp://yuilibrary.com/license/\n\nPasses promises-aplus-tests (https://github.com/promises-aplus/promises-tests).\nAlso passes extension test copied from es6-promise project (see: test/promise.js).\n*/\n(function() {\n\n\t'use strict';\n\n\tfunction isArray(obj) {\n\t\treturn Object.prototype.toString.call(obj) === '[object Array]';\n\t}\n\n\tfunction extend(dst, src) {\n\t\tfor (var key in src) {\n\t\t\tif (src.hasOwnProperty(key)) {\n\t\t\t\tdst[key] = src[key];\n\t\t\t}\n\t\t}\n\t}\n\n\t// Reliably get a global reference on all platforms by looking at a non-strict function's \"this\"\n\tvar global = /*jshint evil:true*/ new Function('return this')(); /*jshint evil:false*/\n\n\t// Shim basic Promise constructor and prototype if necessary\n\tif (!global.Promise) {\n\t\tglobal.Promise = (function() {\n\t\t\tfunction Resolver(promise) {\n\t\t\t\tthis._callbacks = [];\n\t\t\t\tthis._errbacks = [];\n\t\t\t\tthis.promise = promise;\n\t\t\t\tthis._status = 'pending';\n\t\t\t\tthis._result = null;\n\t\t\t}\n\n\t\t\textend(Resolver.prototype, {\n\t\t\t\tfulfill: function(value) {\n\t\t\t\t\tvar status = this._status;\n\n\t\t\t\t\tif (status === 'pending' || status === 'accepted') {\n\t\t\t\t\t\tthis._result = value;\n\t\t\t\t\t\tthis._status = 'fulfilled';\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this._status === 'fulfilled') {\n\t\t\t\t\t\tthis._notify(this._callbacks, this._result);\n\t\t\t\t\t\tthis._callbacks = [];\n\t\t\t\t\t\tthis._errbacks = null;\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\treject: function(reason) {\n\t\t\t\t\tif (reason === this.promise) {\n\t\t\t\t\t\treason = new TypeError('You can not reject a promise with itself');\n\t\t\t\t\t}\n\n\t\t\t\t\tvar status = this._status;\n\n\t\t\t\t\tif (status === 'pending' || status === 'accepted') {\n\t\t\t\t\t\tthis._result = reason;\n\t\t\t\t\t\tthis._status = 'rejected';\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this._status === 'rejected') {\n\t\t\t\t\t\tthis._notify(this._errbacks, this._result);\n\t\t\t\t\t\tthis._callbacks = null;\n\t\t\t\t\t\tthis._errbacks = [];\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\tresolve: function(value) {\n\t\t\t\t\tif (value === this.promise) {\n\t\t\t\t\t\tthis.reject(new TypeError('You can not resolve a promise with itself'));\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this._status === 'pending') {\n\t\t\t\t\t\tthis._status = 'accepted';\n\t\t\t\t\t\tthis._value = value;\n\t\t\t\t\t\tthis._unwrap(this._value);\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\t_unwrap: function(value) {\n\t\t\t\t\tvar self = this, unwrapped = false, then;\n\n\t\t\t\t\tif (!value || (typeof value !== 'object' &&\n\t\t\t\t\t\ttypeof value !== 'function')) {\n\t\t\t\t\t\tself.fulfill(value);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tthen = value.then;\n\n\t\t\t\t\t\tif (typeof then === 'function') {\n\t\t\t\t\t\t\tthen.call(value, function(value) {\n\t\t\t\t\t\t\t\tif (!unwrapped) {\n\t\t\t\t\t\t\t\t\tunwrapped = true;\n\t\t\t\t\t\t\t\t\tself._unwrap(value);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}, function(reason) {\n\t\t\t\t\t\t\t\tif (!unwrapped) {\n\t\t\t\t\t\t\t\t\tunwrapped = true;\n\t\t\t\t\t\t\t\t\tself.reject(reason);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tself.fulfill(value);\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tif (!unwrapped) {\n\t\t\t\t\t\t\tself.reject(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\t_addCallbacks: function(callback, errback) {\n\t\t\t\t\tvar callbackList = this._callbacks,\n\t\t\t\t\t\terrbackList  = this._errbacks;\n\n\t\t\t\t\tif (callbackList) {\n\t\t\t\t\t\tcallbackList.push(callback);\n\t\t\t\t\t}\n\t\t\t\t\tif (errbackList) {\n\t\t\t\t\t\terrbackList.push(errback);\n\t\t\t\t\t}\n\n\t\t\t\t\tswitch (this._status) {\n\t\t\t\t\t\tcase 'accepted':\n\t\t\t\t\t\t\tthis._unwrap(this._value);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'fulfilled':\n\t\t\t\t\t\t\tthis.fulfill(this._result);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'rejected':\n\t\t\t\t\t\t\tthis.reject(this._result);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\t_notify: function(subs, result) {\n\t\t\t\t\tif (subs.length) {\n\t\t\t\t\t\t// TODO: Replace by use of setImmediate\n\t\t\t\t\t\tnextTick(function() {\n\t\t\t\t\t\t\tvar i, len;\n\t\t\t\t\t\t\tfor (i = 0, len = subs.length; i < len; ++i) {\n\t\t\t\t\t\t\t\tsubs[i](result);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tfunction makeCallback(promise, resolve, reject, fn) {\n\t\t\t\treturn function(valueOrReason) {\n\t\t\t\t\tvar result;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tresult = fn(valueOrReason);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\treject(e);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve(result);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Promise instances can be used to facilitate dealing with asynchronous data.\n\t\t\t *\n\t\t\t * The fn will be called with resolve and reject callback arguments.\n\t\t\t * Call these when you want to resolve or reject the Promise instance.\n\t\t\t *\n\t\t\t * Promises can be chained and will be unwrapped.\n\t\t\t *\n\t\t\t * Exceptions thrown within Promise callback functions are caught and converted into rejections.\n\t\t\t *\n\t\t\t * @see <a href=\"http://www.html5rocks.com/en/tutorials/es6/promises/\">Tutorial</a>\n\t\t\t *\n\t\t\t * @memberOf _global_\n\t\t\t * @class\n\t\t\t * @param {Function} fn\n\t\t\t */\n\t\t\tfunction Promise(fn) {\n\t\t\t\tif (!(this instanceof Promise)) {\n\t\t\t\t\tthrow new TypeError('Failed to construct \"Promise\": Please use the \"new\" operator.');\n\t\t\t\t}\n\t\t\t\tif (typeof fn !== 'function') {\n\t\t\t\t\tthrow new TypeError('Promise constructor takes a function argument');\n\t\t\t\t}\n\n\t\t\t\tvar resolver = new Resolver(this);\n\t\t\t\tthis._resolver = resolver;\n\t\t\t\ttry {\n\t\t\t\t\tfn(function(value) {\n\t\t\t\t\t\tresolver.resolve(value);\n\t\t\t\t\t}, function(reason) {\n\t\t\t\t\t\tresolver.reject(reason);\n\t\t\t\t\t});\n\t\t\t\t} catch (e) {\n\t\t\t\t\tresolver.reject(e);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Returns a Promise that resolves with return value from onResolve or onReject.\n\t\t\t *\n\t\t\t * When this promise resolves onResolve will be called.\n\t\t\t * When this promise rejects onReject will be called.\n\t\t\t *\n\t\t\t * @param {Function} [onResolve]\n\t\t\t * @param {Function} [onReject]\n\t\t\t * @returns {Promise}\n\t\t\t */\n\t\t\tPromise.prototype.then = function(onResolve, onReject) {\n\t\t\t\tvar resolver = this._resolver;\n\t\t\t\tvar promise = new this.constructor(function(resolve, reject) {\n\t\t\t\t\tresolver._addCallbacks(\n\t\t\t\t\t\ttypeof onResolve === 'function' ?\n\t\t\t\t\t\t\tmakeCallback(promise, resolve, reject, onResolve) : resolve,\n\t\t\t\t\t\ttypeof onReject === 'function' ?\n\t\t\t\t\t\t\tmakeCallback(promise, resolve, reject, onReject) : reject\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t\treturn promise;\n\t\t\t};\n\n\t\t\treturn Promise;\n\t\t}());\n\t}\n\n\t// Define catch and static methods regardless of previous existence to fix numerous bugs in current Promise\n\t// implementations and to facilitate extending by Cancellable.\n\n\t/**\n\t * Returns a Promise that resolves with return value from this promise or onReject.\n\t *\n\t * When this promise resolves onReject will not be called.\n\t * When this promise rejects onReject will be called.\n\t *\n\t * @param {Function} [onReject]\n\t * @returns {Promise}\n\t */\n\tPromise.prototype.catch = function(onReject) {\n\t\treturn this.then(undefined, onReject);\n\t};\n\n\textend(Promise, {\n\t\t/** @lends Promise */\n\n\t\t/**\n\t\t * Returns a Promise that is resolved with specified value.\n\t\t *\n\t\t * @param {mixed} [value]\n\t\t * @returns {Promise}\n\t\t */\n\t\tresolve: function(value) {\n\t\t\tif (value && value.constructor === this) {\n\t\t\t\treturn value;\n\t\t\t}\n\t\t\t/*jshint newcap: false */\n\t\t\treturn new this(function(resolve) {\n\t\t\t\t/*jshint newcap: true */\n\t\t\t\tresolve(value);\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Returns a Promise that is rejected with specified reason.\n\t\t *\n\t\t * @param {mixed} [reason]\n\t\t * @returns {Promise}\n\t\t */\n\t\treject: function(reason) {\n\t\t\t/*jshint newcap: false */\n\t\t\treturn new this(function(resolve, reject) {\n\t\t\t\t/*jshint newcap: true */\n\t\t\t\treject(reason);\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Returns a Promise that resolves with resolved values after they have all resolved.\n\t\t *\n\t\t * @param {[Promise]} values\n\t\t * @returns {Promise}\n\t\t */\n\t\tall: function(values) {\n\t\t\tif (!isArray(values)) {\n\t\t\t\tthrow new TypeError('Promise.all expects an array of values or promises');\n\t\t\t}\n\n\t\t\tvar Promise = this;\n\t\t\treturn new Promise(function(resolve, reject) {\n\t\t\t\tvar remaining = values.length,\n\t\t\t\t\ti = 0,\n\t\t\t\t\tlength = values.length,\n\t\t\t\t\tresults = [];\n\n\t\t\t\tfunction oneDone(index) {\n\t\t\t\t\treturn function(value) {\n\t\t\t\t\t\tresults[index] = value;\n\t\t\t\t\t\tremaining--;\n\t\t\t\t\t\tif (!remaining) {\n\t\t\t\t\t\t\tresolve(results);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tif (length < 1) {\n\t\t\t\t\treturn resolve(results);\n\t\t\t\t}\n\n\t\t\t\tfor (; i < length; i++) {\n\t\t\t\t\tPromise.resolve(values[i]).then(oneDone(i), reject);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Returns a Promise that resolves with the first value to resolve from values.\n\t\t *\n\t\t * @param {[Promise]} values\n\t\t * @returns {Promise}\n\t\t */\n\t\trace: function(values) {\n\t\t\tif (!isArray(values)) {\n\t\t\t\tthrow new TypeError('Promise.race expects an array of values or promises');\n\t\t\t}\n\n\t\t\tvar Promise = this;\n\t\t\tvar i, value, count = values.length;\n\n\t\t\t// First try to resolve with any non-then-able\n\t\t\tfor (i = 0; i < count; i++) {\n\t\t\t\tvalue = values[i];\n\t\t\t\tif (!(value && value.then && typeof value.then === 'function')) {\n\t\t\t\t\treturn Promise.resolve(value);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn new Promise(function(resolve, reject) {\n\t\t\t\tfor (i = 0; i < count; i++) {\n\t\t\t\t\tPromise.resolve(values[i]).then(resolve, reject);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n\n\tglobal.Promise = Promise;\n\n}());\n",
		"/*\nFor lack of possibility of extending Promise (https://github.com/slightlyoff/Promises/issues/71) we will extend the\nglobal Promise instead. It's not ideal, but it's the best we can do for now.\n\nStill passes promises-aplus-tests (https://github.com/promises-aplus/promises-tests).\n*/\n(function() {\n\n\t'use strict';\n\n\tfunction extend(dst, src) {\n\t\tfor (var key in src) {\n\t\t\tif (src.hasOwnProperty(key)) {\n\t\t\t\tdst[key] = src[key];\n\t\t\t}\n\t\t}\n\t}\n\n\textend(Promise.prototype, {\n\t\t/** @lends Promise.prototype */\n\n\t\t/**\n\t\t * Extended version of {@link Promise#catch} with predicate function argument to filter by.\n\t\t *\n\t\t * If predicate returns true for rejection reason then onReject will be called and returned\n\t\t * otherwise the original reason will be re-thrown.\n\t\t *\n\t\t * @param {Function} predicate\n\t\t * @param {Function} onReject\n\t\t * @returns {Promise}\n\t\t */\n\t\tcatchIf: function(predicate, onReject) {\n\t\t\treturn this.catch(function(reason) {\n\t\t\t\tif (predicate(reason)) {\n\t\t\t\t\treturn onReject(reason);\n\t\t\t\t} else {\n\t\t\t\t\tthrow(reason);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Extended version of {@link Promise#catch} with Class argument to filter by.\n\t\t *\n\t\t * If rejection reason is an instance of specified Class then onReject will be called and returned\n\t\t * otherwise the original reason will be re-thrown.\n\t\t *\n\t\t * @param {Function} Class\n\t\t * @param {Function} onReject\n\t\t * @returns {Promise}\n\t\t */\n\t\tcatchClass: function(Class, onReject) {\n\t\t\treturn this.catch(function(reason) {\n\t\t\t\tif (reason instanceof Class) {\n\t\t\t\t\treturn onReject(reason);\n\t\t\t\t} else {\n\t\t\t\t\tthrow(reason);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Call specified callback when this Promise either resolves or rejects.\n\t\t * Returns a Promise that resolves/rejects with the original value/reason when the callback result is resolved.\n\t\t * If the callback throws or the result is rejected the returned Promise will reject with that reason.\n\t\t *\n\t\t * @param {Function} callback\n\t\t * @returns {Promise}\n\t\t */\n\t\tfinally: function(callback) {\n\t\t\tvar Constructor = this.constructor;\n\t\t\treturn this.then(function(value) {\n\t\t\t\treturn Constructor.resolve(callback()).then(function() {\n\t\t\t\t\treturn value;\n\t\t\t\t});\n\t\t\t}, function(reason) {\n\t\t\t\treturn Constructor.resolve(callback()).then(function() {\n\t\t\t\t\tthrow reason;\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t});\n\n\textend(Promise, {\n\t\t/** @lends Promise */\n\n\t\t/**\n\t\t * Returns a deferred object with promise, resolve and reject properties.\n\t\t *\n\t\t * Use of this is generally discouraged, but can be practical in specific cases and eases porting of old code.\n\t\t *\n\t\t * @returns {Object}\n\t\t */\n\t\tdefer: function() {\n\t\t\tvar deferred = {};\n\t\t\tdeferred.promise = new this(function(resolve, reject) {\n\t\t\t\tdeferred.resolve = resolve;\n\t\t\t\tdeferred.reject = reject;\n\t\t\t});\n\t\t\treturn deferred;\n\t\t},\n\n\t\t/**\n\t\t * Returns a Promise that resolves after specified amount of milliseconds.\n\t\t *\n\t\t * @param {number} ms\n\t\t * @returns {Promise}\n\t\t */\n\t\tdelay: function(ms) {\n\t\t\treturn new this(function(resolve) {\n\t\t\t\tsetTimeout(resolve, ms);\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Returns a function that will unstack calls using {@link nextTick} and then call callback after any previous\n\t\t * callback has resolved/rejected and with at least the specified interval in ms between callbacks.\n\t\t * When callback is called it will use the arguments of the most recent call.\n\t\t * Any extra calls made in the meantime are ignored; they will not cause callback to be called and their\n\t\t * arguments will be discarded.\n\t\t *\n\t\t * TODO: Improve this JSDOC and also JSDOC limit() and debounce()\n\t\t * TODO: Add support for getShard argument like in limit()\n\t\t *\n\t\t * @param {Function} callback\n\t\t * @param {number} interval\n\t\t * @returns {Function}\n\t\t */\n\t\tthrottle: function(callback, interval) {\n\t\t\t// TODO: Ensure this and limit and debounce also work like they should in Cancellable\n\t\t\t// E.g: throttled.cancel() should cancel any Cancellable returned by callback\n\n\t\t\tvar Promise = this;\n\t\t\tvar thisArg, args, timeout, promise;\n\t\t\tvar deferred = Promise.defer();\n\n\t\t\tfunction call() {\n\t\t\t\tif (!args || promise || timeout) {\n\t\t\t\t\treturn; // wait for timeout/promise to call when it is finished\n\t\t\t\t}\n\n\t\t\t\tpromise = Promise.resolve(callback.apply(thisArg, args));\n\t\t\t\tthisArg = null;\n\t\t\t\targs = null;\n\n\t\t\t\tpromise.then(deferred.resolve, deferred.reject).finally(function() {\n\t\t\t\t\tpromise = null;\n\t\t\t\t\tcall();\n\t\t\t\t});\n\n\t\t\t\tdeferred = Promise.defer();\n\n\t\t\t\ttimeout = setTimeout(function() {\n\t\t\t\t\ttimeout = null;\n\t\t\t\t\tcall();\n\t\t\t\t}, interval);\n\t\t\t}\n\n\t\t\treturn function() {\n\t\t\t\tthisArg = this;\n\t\t\t\tif (args || promise || timeout) { // already waiting for tick, promise or timeout\n\t\t\t\t\targs = arguments;\n\t\t\t\t} else {\n\t\t\t\t\targs = arguments;\n\t\t\t\t\tnextTick(call);\n\t\t\t\t}\n\t\t\t\treturn deferred.promise;\n\t\t\t};\n\t\t},\n\n\t\t// Like throttle, but without the trailing call\n\t\t// Returns previous call's promise when called during wait\n\t\t// Otherwise calls and returns that promise\n\t\tlimit: function(callback, interval, getShard) {\n\t\t\tgetShard = getShard || callback.getShard || function() {\n\t\t\t\treturn JSON.stringify(Array.from(arguments));\n\t\t\t};\n\n\t\t\tvar Promise = this;\n\t\t\tvar shardMap = {};\n\n\t\t\tfunction limited() {\n\t\t\t\t/*jshint validthis: true */\n\t\t\t\tvar key = getShard.apply(this, arguments);\n\t\t\t\tvar shard = shardMap[key] || (shardMap[key] = { last: 0 });\n\t\t\t\tvar now = Date.now();\n\n\t\t\t\tif (!shard.busy && now > shard.last + interval) {\n\t\t\t\t\tshard.busy = true;\n\t\t\t\t\tshard.last = now;\n\n\t\t\t\t\tshard.promise = Promise.resolve(callback.apply(this, arguments)).finally(function() {\n\t\t\t\t\t\tshard.busy = false;\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn shard.promise;\n\t\t\t}\n\n\t\t\tlimited.getShard = getShard;\n\n\t\t\treturn limited;\n\t\t},\n\n\t\t// Waits for an interval to pass without being called again before calling callback\n\t\t// Returns promise of that call's return value\n\t\tdebounce: function(callback, interval, getShard) {\n\t\t\tgetShard = getShard || callback.getShard || function() {\n\t\t\t\treturn JSON.stringify(Array.from(arguments));\n\t\t\t};\n\n\t\t\tvar Promise = this;\n\t\t\tvar shardMap = {};\n\n\t\t\tfunction debounced() {\n\t\t\t\t/*jshint validthis: true */\n\t\t\t\tvar thisArg = this;\n\t\t\t\tvar args = arguments;\n\t\t\t\tvar key = getShard.apply(thisArg, args);\n\t\t\t\tvar shard = shardMap[key] || (shardMap[key] = {});\n\n\t\t\t\tif (!shard.deferred) {\n\t\t\t\t\tshard.deferred = Promise.defer();\n\t\t\t\t}\n\t\t\t\tif (shard.timeout) {\n\t\t\t\t\tclearTimeout(shard.timeout);\n\t\t\t\t}\n\t\t\t\t// TODO: Double check that this acts reasonably when callback takes longer to resolve then interval\n\t\t\t\tshard.timeout = setTimeout(function() {\n\t\t\t\t\tshard.timeout = 0;\n\t\t\t\t\tPromise.resolve(callback.apply(thisArg, args)).\n\t\t\t\t\t\tthen(shard.deferred.resolve, shard.deferred.reject).\n\t\t\t\t\t\tfinally(function() {\n\t\t\t\t\t\t\tshard.deferred = 0;\n\t\t\t\t\t\t});\n\t\t\t\t}, interval);\n\n\t\t\t\treturn shard.deferred.promise;\n\t\t\t}\n\n\t\t\tdebounced.getShard = getShard;\n\n\t\t\treturn debounced;\n\t\t}\n\t});\n}());\n",
		"/*\nDefines Promise.Cancellable, CancellationError and TimeoutError to facilitate cancelling functions returning Promises.\n\nPasses promises-aplus-tests (https://github.com/promises-aplus/promises-tests).\n */\n(function() {\n\n\t'use strict';\n\n\tfunction extend(dst, src) {\n\t\tfor (var key in src) {\n\t\t\tif (src.hasOwnProperty(key)) {\n\t\t\t\tdst[key] = src[key];\n\t\t\t}\n\t\t}\n\t\treturn dst;\n\t}\n\n\t// Minimal Object.create shim for IE8\n\tvar objectCreate = Object.create || function(proto) {\n\t\tfunction F() {}\n\t\tF.prototype = proto;\n\t\treturn new F();\n\t};\n\n\tfunction createClass(Extend, Constructor, stat, proto) {\n\t\textend(Constructor, Extend);\n\t\textend(Constructor, stat);\n\t\tproto = extend(objectCreate(Extend.prototype), proto);\n\t\tConstructor.prototype = proto;\n\t\tproto.constructor = Constructor;\n\t\treturn Constructor;\n\t}\n\n\t/**\n\t * Error class that can be used to recognize rejection due to cancellation.\n\t *\n\t * @name CancellationError\n\t * @memberOf Promise\n\t * @class\n\t * @extends Error\n\t * @param {string} [message='Cancelled']\n\t */\n\tvar CancellationError = createClass(Error, function(message) {\n\t\tthis.message = message || 'Cancelled';\n\t\t// Workarounds for not being able to properly extend Error\n\t\tif (Error.captureStackTrace) {\n\t\t\tError.captureStackTrace(this, this.constructor);\n\t\t} else {\n\t\t\tthis.stack = new Error().stack;\n\t\t}\n\t}, null, { name: 'CancellationError' });\n\n\t/**\n\t * Error class that can be used to recognize cancellation due to timeout.\n\t *\n\t * @name TimeoutError\n\t * @memberOf Promise\n\t * @class\n\t * @extends Promise.CancellationError\n\t * @param {string} [message='Timed out']\n\t */\n\tvar TimeoutError = createClass(CancellationError, function(message) {\n\t\tCancellationError.call(this, message || 'Timed out');\n\t}, null, { name: 'TimeoutError' });\n\n\t/**\n\t * A special kind of Promise that can be cancelled.\n\t *\n\t * The fn callback will be called with the Cancellable instance as 'this' argument.\n\t * This facilitates immediately registering a cancellation callback with access to your function scope.\n\t *\n\t * @example\n\t * function request(method, url) {\n\t *   return new Cancellable(function(resolve, reject) {\n\t *     var xhr = new XMLHttpRequest();\n\t *     xhr.addEventListener('load', function() {\n\t *       resolve(xhr.responseText);\n\t *     });\n\t *     xhr.addEventListener('error', function() {\n\t *       reject(xhr.status);\n\t *     });\n\t *     xhr.open(method, url, true);\n\t *     xhr.send();\n\t *     this.catchClass(Promise.CancellationError, function() {\n\t *       xhr.abort();\n\t *     });\n\t *   });\n\t * }\n\t *\n\t * @name Cancellable\n\t * @memberOf Promise\n\t * @class\n\t * @extends Promise\n\t * @param {Function} fn\n\t */\n\tvar Cancellable = createClass(Promise, function(fn) {\n\n\t\tif (!(this instanceof Cancellable)) {\n\t\t\tthrow new TypeError('Failed to construct \"Cancellable\": Please use the \"new\" operator.');\n\t\t}\n\t\tif (typeof fn !== 'function') {\n\t\t\tthrow new TypeError('Cancellable constructor takes a function argument');\n\t\t}\n\n\t\tvar resolve, reject;\n\t\tthis._promise = new Promise(function(_resolve, _reject) {\n\t\t\tresolve = _resolve;\n\t\t\treject = _reject;\n\t\t});\n\t\tthis._parentPromises = [];\n\t\tthis._reject = reject;\n\n\t\ttry {\n\t\t\tfn.call(this, resolve, reject);\n\t\t} catch (e) {\n\t\t\treject(e);\n\t\t}\n\n\t}, {\n\t\t/** @lends Promise.Cancellable */\n\n\t\t// Note: Need to manually link these static methods since they do not show up in extend: for (i in Promise)\n\t\tresolve: Promise.resolve,\n\t\treject: Promise.reject,\n\t\tdefer: Promise.defer,\n\n\t\t/**\n\t\t * Extended version of {@link Promise.all} that adds all Cancellable values as parents to the returned\n\t\t * Cancellable.\n\t\t *\n\t\t * @param {Array} values\n\t\t * @returns {Cancellable}\n\t\t */\n\t\tall: function(values) {\n\t\t\tvar cancellable = Promise.all.call(this, values);\n\n\t\t\tvar parents = cancellable._parentPromises;\n\t\t\tvar i, value, length = values.length;\n\t\t\tfor (i = 0; i < length; i++) {\n\t\t\t\tvalue = values[i];\n\t\t\t\tif (value instanceof Cancellable) {\n\t\t\t\t\tparents.push(value);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn cancellable;\n\t\t},\n\n\t\t/**\n\t\t * Extended version of {@link Promise.race} that adds all Cancellable values as parents to the returned\n\t\t * Cancellable.\n\t\t *\n\t\t * @param {Array} values\n\t\t * @returns {Cancellable}\n\t\t */\n\t\trace: function(values) {\n\t\t\tvar cancellable = Promise.race.call(this, values);\n\n\t\t\tvar parents = cancellable._parentPromises;\n\t\t\tvar i, value, length = values.length;\n\t\t\tfor (i = 0; i < length; i++) {\n\t\t\t\tvalue = values[i];\n\t\t\t\tif (value instanceof Cancellable) {\n\t\t\t\t\tparents.push(value);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn cancellable;\n\t\t}\n\n\t}, {\n\t\t/** @lends Promise.Cancellable.prototype */\n\n\t\t/**\n\t\t * Extended version of {@link Promise#then} that adds this Cancellable and any Cancellable returned by\n\t\t * onResolve or onReject to the returned Cancellable's parents.\n\t\t *\n\t\t * @param {Function} [onResolve]\n\t\t * @param {Function} [onReject]\n\t\t * @returns {Cancellable}\n\t\t */\n\t\tthen: function(onResolve, onReject) {\n\t\t\tvar onThenResolve = typeof onResolve !== 'function' ? onResolve : function(value) {\n\t\t\t\tvar result = onResolve(value);\n\t\t\t\tif (result === thenCancellable) {\n\t\t\t\t\tthrow new TypeError('You can not resolve a promise with itself');\n\t\t\t\t}\n\t\t\t\tif (result instanceof Cancellable) {\n\t\t\t\t\tparents.push(result);\n\t\t\t\t}\n\t\t\t\treturn result;\n\t\t\t};\n\t\t\tvar onThenReject = typeof onReject !== 'function' ? onReject : function(value) {\n\t\t\t\tvar result = onReject(value);\n\t\t\t\tif (result === thenCancellable) {\n\t\t\t\t\tthrow new TypeError('You can not reject a promise with itself');\n\t\t\t\t}\n\t\t\t\tif (result instanceof Cancellable) {\n\t\t\t\t\tparents.push(result);\n\t\t\t\t}\n\t\t\t\treturn result;\n\t\t\t};\n\n\t\t\tvar promise = this._promise;\n\t\t\tvar thenCancellable = new Cancellable(function(resolve) {\n\t\t\t\tresolve(promise.then(onThenResolve, onThenReject));\n\t\t\t});\n\n\t\t\tvar parents = thenCancellable._parentPromises;\n\t\t\tparents.push(this);\n\n\t\t\treturn thenCancellable;\n\t\t},\n\n\t\t/**\n\t\t * If this Cancellable has parents then cancel those, otherwise reject this promise, with specified reason.\n\t\t *\n\t\t * @param {Object} [reason=new Promise.CancellationError()]\n\t\t */\n\t\tcancel: function(reason) {\n\t\t\treason = reason || new CancellationError();\n\t\t\tvar parents = this._parentPromises;\n\t\t\tvar parentsLen = parents.length;\n\t\t\tif (parentsLen === 0) {\n\t\t\t\tthis._reject(reason);\n\t\t\t} else {\n\t\t\t\tfor (var i = 0; i < parentsLen; i++) {\n\t\t\t\t\tparents[i].cancel(reason);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Cancel with specified reason after specified time.\n\t\t *\n\t\t * @param {number} ms Time in milliseconds after which to time out\n\t\t * @param {Object} [reason=new Promise.TimeoutError('Timed out after ' + ms + 'ms')]\n\t\t * @returns {number} setTimeout() id, can be cleared with clearTimeout()\n\t\t */\n\t\tsetTimeout: function(ms, reason) {\n\t\t\treason = reason || new TimeoutError('Timed out after ' + ms + 'ms');\n\n\t\t\treturn setTimeout(function() {\n\t\t\t\tthis.cancel(reason);\n\t\t\t}.bind(this), ms);\n\t\t},\n\n\t\t/**\n\t\t * Returns a plain Promise version of this Cancellable.\n\t\t *\n\t\t * This can be useful if you want to prevent another scope from cancelling this Cancellable.\n\t\t *\n\t\t * @returns {Promise}\n\t\t */\n\t\ttoPromise: function() {\n\t\t\treturn this._promise;\n\t\t}\n\t});\n\n\t// Expose Cancellable etc. as static properties on Promise\n\textend(Promise, {\n\t\tCancellable: Cancellable,\n\t\tCancellationError: CancellationError,\n\t\tTimeoutError: TimeoutError\n\t});\n}());\n",
		"/**\n * Dollar shortcuts to querySelector() and querySelectorAll() like commonly provided by browser console API's.\n */\n(function() {\n\n\t'use strict';\n\n\twindow.$ = window.$ || function(selector, context = document) {\n\t\treturn context.querySelector(selector);\n\t};\n\n\twindow.$$ = window.$$ || function(selector, context = document) {\n\t\treturn Array.from(context.querySelectorAll(selector));\n\t};\n}());\n",
		"(function() {\n\n\t// TODO: Update and cleanup (e.g: replace toArray and find by use of ES Array shims etc)\n\n\t'use strict';\n\n\t// Reliably get a global reference on all platforms by looking at a non-strict function's \"this\"\n\tvar global = /*jshint evil:true*/ new Function('return this')(); /*jshint evil:false*/\n\n\t/**\n\t * Global playtotv namespace, contains everything.\n\t *\n\t * @name playtotv\n\t * @namespace\n\t */\n\tvar ptv = global.playtotv = {};\n\n\tvar nativeEach = [].forEach;\n\tvar uid = 1;\n\n\t/**\n\t * Object literal extender, extends a target object with the properties of 1 or more other\n\t * object literals. Because this method is called - a lot - it contains next to no checks on\n\t * the validity of the arguments passed to it.\n\t *\n\t * @name extend\n\t * @memberOf playtotv\n\t * @function\n\t * @param {Object} target\n\t * @param {Object} literal\n\t */\n\tptv.extend = function(target) {\n\t\tvar literal, name, i, l = arguments.length;\n\t\tfor (i = 1; i < l; i++) {\n\t\t\tliteral = arguments[i];\n\t\t\tfor (name in literal) {\n\t\t\t\tif (literal.hasOwnProperty(name)) {\n\t\t\t\t\ttarget[name] = literal[name];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn target;\n\t};\n\n\t/**\n\t * Core playtotv features\n\t *\n\t */\n\tptv.extend(ptv, {\n\n\t\t/** @lends playtotv */\n\n\t\t/**\n\t\t * Turns an array like object (arguments, nodelists) into a real array, enabling use of Array prototype\n\t\t * functions.\n\t\t *\n\t\t * @deprecated Use Array.from() method instead\n\t\t *\n\t\t * @param {Object} list\n\t\t * @returns {Array} array\n\t\t */\n\t\ttoArray: function(list) {\n\t\t\tvar array;\n\n\t\t\t// if the object has a toArray, call that\n\t\t\tif (list.toArray) {\n\t\t\t\tarray = list.toArray();\n\t\t\t} else {\n\t\t\t\tvar i = list.length;\n\t\t\t\tarray = new Array(i);\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tarray[i] = list[i];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn array;\n\t\t},\n\n\t\t/**\n\t\t * Gets a unique ID.\n\t\t *\n\t\t * @param {string} [prefix]\n\t\t * @returns {number} uid\n\t\t */\n\t\tgetUID: function(prefix) {\n\t\t\tuid += 1;\n\t\t\treturn prefix ? (prefix + uid) : uid;\n\t\t},\n\n\t\t/**\n\t\t * Slightly smarter each, does nodelists and object literals too.\n\t\t *\n\t\t * @param {Object} list\n\t\t * @param {Function} callback\n\t\t * @param {Object} [thisArg]\n\t\t */\n\t\teach: function(list, callback, thisArg) {\n\t\t\tif (!list) {\n\t\t\t\treturn;\n\t\t\t} else if (list.forEach) {\n\t\t\t\tlist.forEach(callback, thisArg);\n\t\t\t} else if (list.length === +list.length) {\n\t\t\t\tnativeEach.call(list, callback, thisArg);\n\t\t\t} else {\n\t\t\t\tvar key;\n\t\t\t\tfor (key in list) {\n\t\t\t\t\tif (list.hasOwnProperty(key)) {\n\t\t\t\t\t\tcallback.call(thisArg, list[key], key, list);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Returns the first value of an array or object literal for which the callback returns true.\n\t\t *\n\t\t * @deprecated Use Array find() prototype method instead\n\t\t *\n\t\t * @param {Array|Object} list\n\t\t * @param {Function} callback\n\t\t * @param {Object} [thisArg]\n\t\t * @returns {mixed} value\n\t\t */\n\t\tfind: function(list, callback, thisArg) {\n\t\t\t/*jshint maxdepth:4*/\n\t\t\tvar value;\n\t\t\tif (list instanceof Array) {\n\t\t\t\tvar i, l = list.length;\n\t\t\t\tfor (i = 0; i < l; i++) {\n\t\t\t\t\tvalue = list[i];\n\t\t\t\t\tif (callback.call(thisArg, value, i, list)) {\n\t\t\t\t\t\treturn value;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tvar key;\n\t\t\t\tfor (key in list) {\n\t\t\t\t\tif (list.hasOwnProperty(key)) {\n\t\t\t\t\t\tvalue = list[key];\n\t\t\t\t\t\tif (callback.call(thisArg, value, key, list)) {\n\t\t\t\t\t\t\treturn value;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Returns an array of property values from an array of objects.\n\t\t *\n\t\t * @param {Array} list\n\t\t * @param {string} key\n\t\t * @returns {Array}\n\t\t */\n\t\tpluck: function(list, key) {\n\t\t\treturn list.map(function(item) {\n\t\t\t\treturn item[key];\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Creates an array of unique values, in order, from all of the provided arrays.\n\t\t *\n\t\t * @returns {Array} The new array of combined values\n\t\t */\n\t\tunion: function() {\n\t\t\tvar union = [];\n\t\t\tthis.toArray(arguments).forEach(function(array) {\n\t\t\t\tarray.forEach(function(item) {\n\t\t\t\t\tif (union.indexOf(item) < 0) {\n\t\t\t\t\t\tunion.push(item);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t\treturn union;\n\t\t},\n\n\t\t/**\n\t\t * Returns a copy of the object only containing the whitelisted properties.\n\t\t *\n\t\t * @param {Object} obj\n\t\t * @param {[string]} keys\n\t\t * @returns {Object}\n\t\t */\n\t\tpick: function(obj, keys) {\n\t\t\tvar copy = {};\n\t\t\tkeys.forEach(function(key) {\n\t\t\t\tif (key in obj) {\n\t\t\t\t\tcopy[key] = obj[key];\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn copy;\n\t\t},\n\n\t\t/**\n\t\t * Returns a copy of the object without the blacklisted properties.\n\t\t *\n\t\t * @param {Object} obj\n\t\t * @param {[string]} keys\n\t\t * @returns {Object}\n\t\t */\n\t\tomit: function(obj, keys) {\n\t\t\tvar copy = {};\n\t\t\tfor (var key in obj) {\n\t\t\t\tif (keys.indexOf(key) === -1) {\n\t\t\t\t\tcopy[key] = obj[key];\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn copy;\n\t\t},\n\n\t\t// TODO: Move these (also shuffle?) into util?\n\t\trandomNr: function(max, min = 0) {\n\t\t\tvar delta = max - min;\n\t\t\treturn min + Math.floor(Math.random() * delta);\n\t\t},\n\n\t\trandomItem: function(array) {\n\t\t\treturn array[this.randomNr(array.length)];\n\t\t},\n\n\t\t/**\n\t\t * Returns a copy of specified array with it's items shuffled randomly.\n\t\t *\n\t\t * @param {Array} array Array of items to shuffle\n\t\t * @returns {Array} Shuffled array\n\t\t */\n\t\tshuffle: function(array) {\n\t\t\tvar cursor = array.length;\n\t\t\tvar shuffled = array.slice(0); // start with a copy\n\t\t\tvar temp, rand;\n\t\t\twhile (cursor > 0) { // go from tail to head\n\t\t\t\trand = Math.floor(Math.random() * cursor--); // pick a random preceding index\n\t\t\t\ttemp = shuffled[cursor]; // remember value at cursor\n\t\t\t\tshuffled[cursor] = shuffled[rand]; // swap cursor value with random index value\n\t\t\t\tshuffled[rand] = temp; // swap random index value with cursor value\n\t\t\t}\n\t\t\treturn shuffled;\n\t\t},\n\n\t\t/**\n\t\t * Returns a function that will unstack calls using {@link nextTick} and then call callback with at least the\n\t\t * specified time in ms between callbacks.\n\t\t * When callback is called it will use the arguments of the most recent call.\n\t\t * Any extra calls made in the meantime are ignored; they will not cause callback to be called and their\n\t\t * arguments will be discarded.\n\t\t *\n\t\t * @param {Function} callback\n\t\t * @param {number} ms\n\t\t * @returns {Function}\n\t\t */\n\t\tthrottle: function(callback, ms) {\n\t\t\tvar thisArg, args, timeout;\n\n\t\t\tfunction call() {\n\t\t\t\tif (args && !timeout) {\n\t\t\t\t\tcallback.apply(thisArg, args);\n\t\t\t\t\tthisArg = null;\n\t\t\t\t\targs = null;\n\n\t\t\t\t\ttimeout = setTimeout(function() {\n\t\t\t\t\t\ttimeout = null;\n\t\t\t\t\t\tcall();\n\t\t\t\t\t}, ms);\n\t\t\t\t} // else wait for timeout to call when it is finished\n\t\t\t}\n\n\t\t\treturn function() {\n\t\t\t\tthisArg = this;\n\t\t\t\tif (args || timeout) { // already waiting for tick or timeout\n\t\t\t\t\targs = arguments;\n\t\t\t\t} else {\n\t\t\t\t\targs = arguments;\n\t\t\t\t\tnextTick(call);\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t/**\n\t\t * Returns a function that will call the callback function after it has not been called for ms. If it is called\n\t\t * again within that time the previously scheduled callback will be cancelled and another period of waiting\n\t\t * will be started. This will effectively result in the callback only being called after a period of quiet.\n\t\t *\n\t\t * @param {Function} callback\n\t\t * @param {number} ms\n\t\t * @returns {Function}\n\t\t */\n\t\tdebounce: function(callback, ms) {\n\t\t\tvar timeout;\n\n\t\t\treturn function() {\n\t\t\t\tvar thisArg = this;\n\t\t\t\tvar args = arguments;\n\n\t\t\t\tclearTimeout(timeout);\n\n\t\t\t\ttimeout = setTimeout(function() {\n\t\t\t\t\ttimeout = null;\n\t\t\t\t\tcallback.apply(thisArg, args);\n\t\t\t\t\tthisArg = null;\n\t\t\t\t\targs = null;\n\t\t\t\t}, ms);\n\t\t\t};\n\t\t},\n\n\t\t/**\n\t\t * Returns a function that will call the callback function once after the stack has cleared (using\n\t\t * {@link nextTick}).\n\t\t * This effectively consolidates multiple calls from a single stack into one.\n\t\t *\n\t\t * @param {Function} callback\n\t\t * @return {Function}\n\t\t */\n\t\tunstack: function(callback) {\n\t\t\tvar thisArg, args;\n\n\t\t\tfunction call() {\n\t\t\t\tcallback.apply(thisArg, args);\n\t\t\t\tthisArg = null;\n\t\t\t\targs = null;\n\t\t\t}\n\n\t\t\treturn function() {\n\t\t\t\tthisArg = this;\n\t\t\t\tif (args) { // already waiting for tick\n\t\t\t\t\targs = arguments;\n\t\t\t\t} else {\n\t\t\t\t\targs = arguments;\n\t\t\t\t\tnextTick(call);\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t/**\n\t\t * Returns a function that will only call the callback function if it has not been called already.\n\t\t *\n\t\t * @param {Function} callback\n\t\t * @returns {Function}\n\t\t */\n\t\tonce: function(callback) {\n\t\t\tvar ran = false, memo;\n\t\t\treturn function() {\n\t\t\t\tif (ran) {\n\t\t\t\t\treturn memo;\n\t\t\t\t}\n\t\t\t\tran = true;\n\t\t\t\tmemo = callback.apply(this, arguments);\n\t\t\t\treturn memo;\n\t\t\t};\n\t\t},\n\n\t\t/**\n\t\t * Returns a function that will defer calling the callback function untill the current call stack is empty\n\t\t * (using {@link nextTick}).\n\t\t *\n\t\t * @param {Function} callback\n\t\t * @param {Object} [thisArg]\n\t\t * @returns {Function}\n\t\t */\n\t\tdefer: function(callback, thisArg) {\n\t\t\treturn function() {\n\t\t\t\tnextTick(callback, thisArg || this, arguments);\n\t\t\t};\n\t\t},\n\n\t\t/**\n\t\t * Abstract function for mixins or superclasses. Throws an error if not implemented by the\n\t\t * class that uses it.\n\t\t *\n\t\t */\n\t\tAbstractFunction: function() {\n\t\t\tthrow new ReferenceError('Abstract function not implemented.');\n\t\t},\n\n\t\t/**\n\t\t * May be used to make a param required for playtotv.params and the playtotv.Options mixin.\n\t\t * @property REQUIRED\n\t\t * @type String\n\t\t * @default \"__required__\"\n\t\t */\n\t\tREQUIRED: '__required__',\n\n\t\t/**\n\t\t * Augments an options object with properties from a defaults object if undefined. If a default\n\t\t * property is required to have a value, and is not stated in the options, an error is thrown.\n\t\t * Likewise, options that are not present on the defaults throw an error. Note that the original\n\t\t * options parameter is modified, not cloned or used as a reference.\n\t\t *\n\t\t * @param {Object} options\n\t\t * @param {Object} defaults\n\t\t * @returns {Object}\n\t\t */\n\t\tparams: function(options, defaults) {\n\t\t\toptions = options || {};\n\n\t\t\t// assign options only via keys from defaults, and error on missing required params\n\t\t\tptv.each(defaults, function(value, key) {\n\t\t\t\tvar hasKey = options.hasOwnProperty(key);\n\t\t\t\tif (!hasKey) {\n\t\t\t\t\tif (value === ptv.REQUIRED) {\n\t\t\t\t\t\tthrow new Error('Missing required parameter: ' + key);\n\t\t\t\t\t}\n\n\t\t\t\t\toptions[key] = value;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// check options for any unrecognized params\n\t\t\tptv.each(options, function(value, key) {\n\t\t\t\tif (!defaults.hasOwnProperty(key)) {\n\t\t\t\t\tthrow new Error('Invalid parameter: ' + key + ' = ' + value); // error or warn?\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn options;\n\t\t},\n\n\t\t/**\n\t\t * Removes a selection of options derived from defaults from specified options (by reference!)\n\t\t * and returns the selection augmented and validated by the playtotv.params function.\n\t\t *\n\t\t * @param {Object} options\n\t\t * @param {Object} defaults\n\t\t * @returns {Object}\n\t\t */\n\t\tspliceParams: function(options, defaults) {\n\t\t\toptions = options || {};\n\n\t\t\tvar keys = Object.keys(defaults);\n\t\t\tvar spliced = ptv.pick(options, keys);\n\n\t\t\tkeys.forEach(function(key) {\n\t\t\t\tdelete options[key];\n\t\t\t});\n\n\t\t\treturn ptv.params(spliced, defaults);\n\t\t},\n\n\t\t/**\n\t\t * Creates a script node and adds it to the head of the DOM.\n\t\t *\n\t\t * @param {string} src URL of script to load\n\t\t * @param {boolean} [async=true] Whether to load asynchronously\n\t\t * @return {Promise} Script node promise which will be resolved when script has finished loading\n\t\t */\n\t\tloadScript: function(src, async) {\n\t\t\t// TODO: Rewrite without use of Promise.defer()\n\t\t\tvar deferred = Promise.defer();\n\t\t\tvar script = document.createElement('script');\n\t\t\tscript.type = 'text/javascript';\n\t\t\tscript.async = async === false ? false : true;\n\t\t\tscript.src = src;\n\n\t\t\tvar loaded = false;\n\t\t\tscript.onload = script.onreadystatechange = function() {\n\t\t\t\tvar rs = this.readyState;\n\t\t\t\tif (!loaded && (rs === undefined || rs === 'complete' || rs === 'loaded')) {\n\t\t\t\t\tloaded = true;\n\t\t\t\t\tdeferred.resolve(script);\n\t\t\t\t}\n\t\t\t};\n\t\t\tscript.onerror = function() {\n\t\t\t\tdeferred.reject(new Error('Error loading script: ' + src));\n\t\t\t};\n\n\t\t\tdocument.head.appendChild(script);\n\t\t\treturn deferred.promise;\n\t\t},\n\n\t\t/**\n\t\t * Class instance dispose helper.\n\t\t *\n\t\t * Deletes all instance properties, overrides dispose method with a noop function and adds a disposed property.\n\t\t *\n\t\t * @param {Object} instance\n\t\t */\n\t\tdispose: function(instance) {\n\t\t\tObject.keys(instance).forEach(function(key) { delete instance[key]; });\n\t\t\tinstance.dispose = function() {};\n\t\t\tinstance.disposed = true;\n\t\t}\n\t});\n\n}());\n",
		"(function() {\n\n\t'use strict';\n\n\tvar objectCreate = Object.create || function(proto) {\n\t\tfunction Proto() {}\n\t\tProto.prototype = proto;\n\t\treturn new Proto();\n\t};\n\n\t/**\n\t * Creates a class of which instances can be created at a later stage. The definition object defines a few\n\t * predefined properties for class construction. Any other properties and/or methods are added to the class'\n\t * prototype.\n\t *\n\t * @class\n\t * @param {Object} definition\n\t * @param {Function} definition.initialize constructor function\n\t * @param {playtotv.Class} [defition.extend] Class to extend on\n\t * @param {Array} [definition.callbacks] Array of method names that are bound to each instance (e.g. for callbacks)\n\t * @returns {Class} the created class\n\t */\n\tplaytotv.Class = function(definition) {\n\t\t/*jshint maxcomplexity:100*/\n\n\t\tvar Construct;\n\t\tvar Base;\n\t\tvar proto = {};\n\t\tvar callbacks = [];\n\n\t\tvar entity, type;\n\t\tfor (type in definition) {\n\t\t\tif (definition.hasOwnProperty(type)) {\n\t\t\t\tentity = definition[type];\n\t\t\t\tswitch (type) {\n\n\t\t\t\t// constructor\n\t\t\t\tcase 'initialize':\n\t\t\t\t\tConstruct = entity;\n\t\t\t\t\tbreak;\n\n\t\t\t\t// class to extend\n\t\t\t\tcase 'extend':\n\t\t\t\t\tBase = entity;\n\t\t\t\t\tbreak;\n\n\t\t\t\t// callbacks to bind\n\t\t\t\tcase 'callbacks':\n\t\t\t\t\tcallbacks = entity;\n\t\t\t\t\tbreak;\n\n\t\t\t\t// prototype methods\n\t\t\t\tdefault:\n\t\t\t\t\tproto[type] = entity;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Base must be a function\n\t\tif (Base && !(Base instanceof Function)) {\n\t\t\tthrow new TypeError('Function expected using \\'extend\\' with playtotv.Class');\n\t\t}\n\n\t\t// Allow omitting the constructor, also when extending\n\t\tif (!Construct) {\n\t\t\tConstruct = Base ? function() {\n\t\t\t\t// in case of extending, auto super\n\t\t\t\tthis._super.apply(this, arguments);\n\t\t\t} : function() {\n\t\t\t\t// otherwise, do nothing\n\t\t\t};\n\t\t}\n\n\t\t// wrap the constructor function if necessary\n\t\tif (Base || callbacks.length > 0) {\n\t\t\tConstruct = this.wrap(Construct, Base, callbacks);\n\t\t}\n\n\t\t// extend with our class prototype (can override base and mixin prototypes)\n\t\tplaytotv.extend(Construct.prototype, proto);\n\n\t\t// and finally return it.\n\t\treturn Construct;\n\t};\n\n\tplaytotv.Class.prototype = {\n\n\t\t/**\n\t\t * Wraps a constructor function with another function that can extend a class with a base class, mix in more\n\t\t * classes and have callback methods be bound to their instances.\n\t\t *\n\t\t * @param {Function} Construct The class to extend\n\t\t * @param {Function} [Base] The base class\n\t\t * @param {Array} callbacks Array of callback method names\n\t\t * @returns {Function} combined constructor\n\t\t */\n\t\twrap: function(Construct, Base, callbacks) {\n\n\t\t\tvar Wrapped = function() {\n\n\t\t\t\t// hardwire callbacks to the current instance\n\t\t\t\tcallbacks.forEach(function(name) {\n\t\t\t\t\tvar entity = this[name];\n\t\t\t\t\tif (entity instanceof Function) {\n\t\t\t\t\t\tthis[name] = entity.bind(this);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// callbacks MUST exist, leniency here might cause really obscure behaviour or errors.\n\t\t\t\t\t\tthrow new ReferenceError('Callback \"' + name + '\" is undefined or not a Function');\n\t\t\t\t\t}\n\t\t\t\t}, this);\n\n\t\t\t\t// set a super reference during instanciation only, end with undefined\n\t\t\t\t// TODO: rename to super when IE8 no longer needs to be supported\n\t\t\t\tthis._super = Base || undefined;\n\n\t\t\t\t// and run the actual constructor\n\t\t\t\treturn Construct.apply(this, arguments);\n\t\t\t};\n\n\t\t\t// Maintain the prototype chain for the instanceof operator.\n\t\t\tif (Base) {\n\t\t\t\tWrapped.prototype = objectCreate(Base.prototype);\n\t\t\t\tWrapped.prototype.constructor = Wrapped;\n\t\t\t}\n\n\t\t\treturn Wrapped;\n\t\t}\n\t};\n\n\t/**\n\t * Immediately returns an instance of the given definition, for singletons / static classes.\n\t *\n\t * @static\n\t * @param {Object} definition\n\t * @returns {Object} instance\n\t */\n\tplaytotv.Class.getInstance = function(definition) {\n\t\tvar Type = new playtotv.Class(definition);\n\t\treturn new Type();\n\t};\n\n}());\n",
		"(function() {\n\t/*jshint maxcomplexity:100, maxstatements:100*/\n\n\t'use strict';\n\n\t// Abort if we are not running in a browser (e.g: in Node)\n\tif (typeof window === 'undefined') {\n\t\treturn;\n\t}\n\n\tvar ptv = playtotv;\n\tvar document = window.document;\n\tvar documentElement = document.documentElement;\n\tvar dataAttr = 'data-em-uid';\n\tvar dataMap = {};\n\n\t//\n\t// polyfills\n\t//\n\n\t// matches implementation for dom.matches\n\tvar matchesImplementation =\n\t\tdocumentElement.matches ||\n\t\tdocumentElement.webkitMatchesSelector ||\n\t\tdocumentElement.mozMatchesSelector ||\n\t\tdocumentElement.msMatchesSelector ||\n\t\tdocumentElement.oMatchesSelector;\n\n\t// node.contains polyfill for firefox < 9\n\tvar Node = window.Node;\n\tif (Node && Node.prototype && !Node.prototype.contains) {\n\t\tNode.prototype.contains = function(arg) {\n\t\t\t/*jshint bitwise:false*/\n\t\t\treturn !!(this.compareDocumentPosition(arg) & 16);\n\t\t};\n\t}\n\n\t// classList.toggle polyfill for IE10, ff < 24 and Android < 4.4, that don't support the force argument\n\t(function(DOMTokenList, node) {\n\t\tnode.classList.toggle('test', false);\n\t\tif (node.classList.contains('test')) {\n\t\t\tvar _toggle = DOMTokenList.prototype.toggle;\n\t\t\tDOMTokenList.prototype.toggle = function(token, force) {\n\t\t\t\treturn (1 in arguments && this.contains(token) === force) ?\n\t\t\t\t\tforce : _toggle.call(this, token);\n\t\t\t};\n\t\t}\n\t})(window.DOMTokenList, document.createElement('_'));\n\n\t/**\n\t * playtotv.dom\n\t */\n\tptv.dom = {\n\t\t/** @lends playtotv.dom */\n\n\t\t/**\n\t\t * Returns an Array of matching elements for the given selector. An optional context Node\n\t\t * may be used to search within, otherwise the whole document is searched.\n\t\t *\n\t\t * TODO: Remove and replace uses of this by $$()\n\t\t *\n\t\t * @function\n\t\t * @param {string} selector\n\t\t * @param {Node} context\n\t\t * @returns {Array} result\n\t\t */\n\t\tfind: function(selector, context) {\n\t\t\treturn ptv.toArray(\n\t\t\t\t(context || document).querySelectorAll(selector)\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Returns a boolean whether the given Node matches the selector string.\n\t\t *\n\t\t * @function\n\t\t * @param {string} selector\n\t\t * @param {Node} node\n\t\t * @returns {boolean} matches\n\t\t */\n\t\tmatches: function(selector, context) {\n\t\t\treturn (context && context !== document) ?\n\t\t\t\tmatchesImplementation.call(context, selector) : false;\n\t\t},\n\n\t\t/**\n\t\t * Returns the first Node matching the given selector.\n\t\t *\n\t\t * TODO: Remove and replace uses of this by $()\n\t\t *\n\t\t * @param {string} selector\n\t\t * @param {Node} context\n\t\t * @returns {Node} node\n\t\t */\n\t\tfirst: function(selector, context) {\n\t\t\treturn (context || document).querySelector(selector);\n\t\t},\n\n\t\t/**\n\t\t * Returns the last Node matching the given selector.\n\t\t *\n\t\t * @param {string} selector\n\t\t * @param {Node} context\n\t\t * @returns {Node} node\n\t\t */\n\t\tlast: function(selector, context) {\n\t\t\tvar result = this.find(selector, context);\n\t\t\tvar index = Math.max(0, result.length - 1);\n\t\t\treturn result[index];\n\t\t},\n\n\t\t/**\n\t\t * Traverses the dom from a given context until the selector is matched or no sibling is found,\n\t\t * and returns the result.\n\t\t *\n\t\t * @param {string} selector\n\t\t * @param {Node} context\n\t\t * @param {string} sibling\n\t\t * @returns {Node} node\n\t\t */\n\t\ttraverse: function(selector, context, sibling) {\n\t\t\twhile (context) {\n\t\t\t\tif (this.matches(selector, context)) {\n\t\t\t\t\treturn context;\n\t\t\t\t}\n\t\t\t\tcontext = context[sibling];\n\t\t\t}\n\t\t\treturn null;\n\t\t},\n\n\t\t/**\n\t\t * Returns the first matching sibling traversing forward from the given context.\n\t\t *\n\t\t * @param {string} selector\n\t\t * @param {Node} context\n\t\t * @returns {Node} node\n\t\t */\n\t\tnext: function(selector, context) {\n\t\t\treturn this.traverse(selector, context.nextSibling, 'nextSibling');\n\t\t},\n\n\t\t/**\n\t\t * Returns the first matching sibling traversing backward from the given context.\n\t\t *\n\t\t * @param {string} selector\n\t\t * @param {Node} context\n\t\t * @returns {Node} node\n\t\t */\n\t\tprevious: function(selector, context) {\n\t\t\treturn this.traverse(selector, context.previousSibling, 'previousSibling');\n\t\t},\n\n\t\t/**\n\t\t * Traverses upward in the DOM from the given context Node, and returns the first Node matching the given\n\t\t * selector (including the given node).\n\t\t *\n\t\t * @param {string} selector\n\t\t * @param {Node} context\n\t\t * @returns {Node} node\n\t\t */\n\t\tclosest: documentElement.closest ?\n\t\t\tfunction(selector, context) {\n\t\t\t\treturn context.closest(selector);\n\t\t\t} :\n\n\t\t\tfunction(selector, context) {\n\t\t\t\treturn this.traverse(selector, context, 'parentNode');\n\t\t\t},\n\n\t\t/**\n\t\t * Like find, but includes the context itself (as first result) if it matches the given selector\n\t\t *\n\t\t * @param {string} selector\n\t\t * @param {Node} context\n\t\t * @returns {Array} result\n\t\t */\n\t\tany: function(selector, context) {\n\t\t\tvar nodes = this.find(selector, context);\n\t\t\tif (context && this.matches(selector, context)) {\n\t\t\t\tnodes.splice(0, 0, context);\n\t\t\t}\n\n\t\t\treturn nodes;\n\t\t},\n\n\t\t/**\n\t\t * Filters an Array or NodeList, and returns an array that contains only those nodes that match the selector.\n\t\t *\n\t\t * @param {string} selector\n\t\t * @param {Array|NodeList} nodes\n\t\t * @returns {Array} result\n\t\t */\n\t\tfilter: function(selector, nodes) {\n\t\t\tvar result = [];\n\t\t\tvar i, item, l = nodes.length;\n\t\t\tfor (i = 0; i < l; i++) {\n\t\t\t\titem = nodes[i];\n\t\t\t\tif (this.matches(selector, item)) {\n\t\t\t\t\tresult.push(item);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn result;\n\t\t},\n\n\t\t/**\n\t\t * Returns a boolean whether the given object is a Node\n\t\t *\n\t\t * @param {Object} object\n\t\t * @returns {boolean} isNode\n\t\t */\n\t\tisNode: function(node) {\n\t\t\treturn node && node.nodeType && (node.nodeType === 1);\n\t\t},\n\n\t\t/**\n\t\t * Returns a boolean whether the given Node is a child of the given context Node\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {Node} context\n\t\t * @returns {boolean} isChild\n\t\t */\n\t\tisChild: function(node, context) {\n\t\t\treturn this.isNode(context) ? context.contains(node) : false;\n\t\t},\n\n\t\t/**\n\t\t * Creates a Node with optional attributes and options for inserting and/or writing content.\n\t\t *\n\t\t * @param {string} name\n\t\t * @param {Object} attributes\n\t\t * @param {Object} options\n\t\t * @returns {Node} node\n\t\t */\n\t\tcreate: function(name, attributes, options) {\n\n\t\t\tvar node = document.createElement(name);\n\n\t\t\tif (attributes) {\n\t\t\t\tptv.each(attributes, function(value, attr) {\n\t\t\t\t\tnode.setAttribute(attr, value);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (options) {\n\n\t\t\t\tif (options.html !== undefined) {\n\t\t\t\t\tthis.innerHTML = options.html;\n\t\t\t\t}\n\n\t\t\t\t[ 'appendTo', 'insertBefore', 'insertAfter', 'prependTo', 'replace' ].forEach(function(type) {\n\t\t\t\t\tvar target = options[type];\n\t\t\t\t\tif (target !== undefined) {\n\t\t\t\t\t\tptv.dom[type](node, target);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (options.text !== undefined) {\n\t\t\t\t\tnode.appendChild(document.createTextNode(options.text));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn node;\n\t\t},\n\n\t\t/**\n\t\t * Removes the a Node from the DOM, and returns it.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @returns {Node} node\n\t\t */\n\t\tremove: function(node) {\n\t\t\treturn node.parentNode.removeChild(node);\n\t\t},\n\n\t\t/**\n\t\t * Appends the Node to the given reference Node, and returns it.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {Node} refnode\n\t\t * @returns {Node} node\n\t\t */\n\t\tappendTo: function(node, refnode) {\n\t\t\treturn refnode.appendChild(node);\n\t\t},\n\n\t\t/**\n\t\t * Inserts the Node before the given reference Node, and returns it.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {Node} refnode\n\t\t * @returns {Node} node\n\t\t */\n\t\tinsertBefore: function(node, refnode) {\n\t\t\treturn refnode.parentNode.insertBefore(node, refnode);\n\t\t},\n\n\t\t/**\n\t\t * Inserts the Node after the given reference Node, and returns it.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {Node} refnode\n\t\t * @returns {Node} node\n\t\t */\n\t\tinsertAfter: function(node, refnode) {\n\t\t\tif (refnode.nextSibling) {\n\t\t\t\treturn this.insertBefore(node, refnode.nextSibling);\n\t\t\t} else {\n\t\t\t\treturn this.appendTo(node, refnode);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Inserts the Node as first child of the given reference Node, and returns it.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {Node} refnode\n\t\t * @returns {Node} node\n\t\t */\n\t\tprependTo: function(node, refnode) {\n\t\t\tif (refnode.firstChild) {\n\t\t\t\treturn this.insertBefore(node, refnode.firstChild);\n\t\t\t} else {\n\t\t\t\treturn this.appendTo(node, refnode);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Replaces reference Node for the the given Node, and returns the removed Node.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {Node} refnode\n\t\t * @returns {Node} node\n\t\t */\n\t\treplace: function(node, refnode) {\n\t\t\treturn refnode.parentNode.replaceChild(node, refnode);\n\t\t},\n\n\t\t/**\n\t\t * Returns a DocumentFragment with the specified HTML.\n\t\t *\n\t\t * @param {string} html\n\t\t * @returns {DocumentFragment}\n\t\t */\n\t\tparseHTML: function(html) {\n\t\t\tvar div = document.createElement('div');\n\t\t\tdiv.innerHTML = html;\n\n\t\t\tvar fragment = document.createDocumentFragment();\n\t\t\tvar i, l = div.childNodes.length;\n\t\t\tfor (i = 0; i < l; i++) {\n\t\t\t\tfragment.appendChild(div.firstChild);\n\t\t\t}\n\t\t\treturn fragment;\n\t\t},\n\n\t\t/**\n\t\t * Returns the value of a key/value pair that was saved to this node earlier. Values may be of any type, as\n\t\t * the data is stored in an object literal that is linked to the node via a custom identifier. Note that this\n\t\t * data is not accessible via attributes or native datasets, and does not span multiple sessions or views.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {string} key\n\t\t * @returns {mixed} value\n\t\t */\n\t\tgetData: function(node, key) {\n\t\t\tvar uid = node[dataAttr];\n\t\t\tvar data = uid ? dataMap[uid] : null;\n\n\t\t\treturn data ? data[key] : null;\n\t\t},\n\n\t\t/**\n\t\t * Stores a key/value pair on a node. Values may be of any type, as the data is stored in an object literal\n\t\t * that is linked to the node via a custom identifier. Note that this data is not accessible via attributes\n\t\t * or native datasets, and does not span multiple sessions or views.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {string} key\n\t\t * @param {mixed} value\n\t\t * @returns {mixed} value\n\t\t */\n\t\tsetData: function(node, key, value) {\n\t\t\tvar uid = node[dataAttr];\n\t\t\tif (!uid) {\n\t\t\t\tuid = ptv.getUID();\n\t\t\t\tnode[dataAttr] = uid;\n\t\t\t}\n\n\t\t\tvar data = dataMap[uid];\n\n\t\t\tif (!data) {\n\t\t\t\tdataMap[uid] = data = {};\n\t\t\t}\n\n\t\t\tdata[key] = value;\n\n\t\t\treturn value;\n\t\t},\n\n\t\t/**\n\t\t * Removes data with specified key from specified node, stored by earlier call to {@link playtotv.dom.setData}.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {string} key\n\t\t */\n\t\tremoveData: function(node, key) {\n\t\t\tvar uid = node[dataAttr];\n\t\t\tvar data = dataMap[uid];\n\t\t\tif (data) {\n\t\t\t\tdelete data[key];\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Returns the attribute value of the closest node that has specified attribute.\n\t\t *\n\t\t * @param {Node} node Node from which to start looking\n\t\t * @param {string} key Attribute key to look for\n\t\t * @return {string} Attribute value of the closest node\n\t\t */\n\t\tgetClosestAttr: function(node, key) {\n\t\t\tnode = this.closest('[' + key + ']', node);\n\t\t\treturn node ? node.getAttribute(key) : undefined;\n\t\t},\n\n\t\t/**\n\t\t * Returns dataset or a read-only dataset like data attribute map Object.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @returns {Object} dataset\n\t\t */\n\t\tgetDataSet: function(node) {\n\t\t\tvar dataset = node.dataset;\n\n\t\t\tif (!dataset) {\n\t\t\t\treturn ptv.toArray(node.attributes).reduce(function(dataset, attr) {\n\t\t\t\t\tvar name = attr.name;\n\t\t\t\t\tif (name.indexOf('data-') !== 0) {\n\t\t\t\t\t\treturn dataset;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Remove data- prefix and convert to camel case\n\t\t\t\t\tname = name.substr(5).replace(/-([a-z])/g, function(match, letter) {\n\t\t\t\t\t\treturn letter.toUpperCase();\n\t\t\t\t\t});\n\n\t\t\t\t\tdataset[name] = attr.value;\n\t\t\t\t\treturn dataset;\n\t\t\t\t}, {});\n\t\t\t}\n\n\t\t\t// Workaround for Android 4.3 that returns an \"object\" without hasOwnProperty() method etc.\n\t\t\tif (!dataset.hasOwnProperty) {\n\t\t\t\tvar key, copy = {};\n\t\t\t\tfor (key in dataset) {\n\t\t\t\t\t/*jshint forin:false*/\n\t\t\t\t\tcopy[key] = dataset[key];\n\t\t\t\t}\n\t\t\t\tdataset = copy;\n\t\t\t}\n\n\t\t\treturn dataset;\n\t\t}\n\t};\n\n}());\n",
		"(function() {\n\n\t'use strict';\n\n\t// Abort if we are not running in a browser (e.g: in Node)\n\tif (typeof window === 'undefined') {\n\t\treturn;\n\t}\n\n\tvar document = window.document;\n\n\t/**\n\t * @name Event\n\t * @memberOf playtotv.event\n\t * @class\n\t * @param {String} type\n\t * @param {object} params\n\t*/\n\tvar Event = window.Event;\n\n\t/**\n\t * @name MouseEvent\n\t * @memberOf playtotv.event\n\t * @class\n\t * @param {String} type\n\t * @param {object} params\n\t*/\n\tvar MouseEvent = window.MouseEvent;\n\n\t/**\n\t * @name CustomEvent\n\t * @memberOf playtotv.event\n\t * @class\n\t * @param {String} type\n\t * @param {object} params\n\t*/\n\tvar CustomEvent = window.CustomEvent;\n\n\t// determine whether Event(s) as constructor are supported\n\tvar supportsCustom = (function() {\n\t\ttry {\n\t\t\tvar custom = new CustomEvent('test');\n\t\t\tcustom.preventDefault();\n\t\t\treturn true;\n\t\t} catch (e) {\n\t\t\treturn false;\n\t\t}\n\t}());\n\n\t// IE9 and up support for Event(s) as constructor. Note that these Event classes are exposed via playtotv.event\n\t// for manually dispatching them on nodes if so needed. For convenience, event.triggerNative may be used.\n\tif (!supportsCustom) {\n\t\tvar eventProto = Event.prototype;\n\n\t\tEvent = function(event, params) {\n\t\t\tparams = playtotv.params(params, {\n\t\t\t\tbubbles: false,\n\t\t\t\tcancelable: false\n\t\t\t});\n\n\t\t\tvar evt = document.createEvent('HTMLEvents');\n\t\t\tevt.initEvent(event, params.bubbles, params.cancelable);\n\t\t\treturn evt;\n\t\t};\n\n\t\tEvent.prototype = eventProto;\n\n\t\tCustomEvent = function(event, params) {\n\t\t\tparams = playtotv.params(params, {\n\t\t\t\tbubbles: false,\n\t\t\t\tcancelable: false,\n\t\t\t\tdetail: null\n\t\t\t});\n\n\t\t\tvar evt = document.createEvent( 'CustomEvent' );\n\t\t\tevt.initCustomEvent( event, params.bubbles, params.cancelable, params.detail );\n\t\t\treturn evt;\n\t\t};\n\n\t\tCustomEvent.prototype = eventProto;\n\n\t\tMouseEvent = function(event, params) {\n\t\t\tparams = playtotv.params(params, {\n\t\t\t\tbubbles: false,\n\t\t\t\tcancelable: false,\n\t\t\t\tscreenX: 0,\n\t\t\t\tscreenY: 0,\n\t\t\t\tclientX: 0,\n\t\t\t\tclientY: 0,\n\t\t\t\tctrlKey: false,\n\t\t\t\taltKey: false,\n\t\t\t\tshiftKey: false,\n\t\t\t\tmetaKey: false,\n\t\t\t\tbutton: 0,\n\t\t\t\tbuttons: 0,\n\t\t\t\trelatedTarget: null\n\t\t\t});\n\n\t\t\tvar evt = document.createEvent('MouseEvent');\n\t\t\tevt.initMouseEvent(\n\t\t\t\tevent, params.bubbles, params.cancelable, window, 1,\n\t\t\t\tparams.screenX, params.screenY, params.clientX, params.clientY,\n\t\t\t\tparams.ctrlKey, params.altKey, params.shiftKey, params.metaKey,\n\t\t\t\tparams.button,\n\t\t\t\tparams.relatedTarget\n\t\t\t);\n\t\t\treturn evt;\n\t\t};\n\n\t\tMouseEvent.prototype = eventProto;\n\t}\n\n\t/**\n\t * EventListener, represents a listener function for an event on the given node. Returned by\n\t * {@link playtotv.event.addListener} for easy removal at {@link playtotv.event.removeListener}, instead of passing\n\t * the separate node, type and listener arguments.\n\t *\n\t * @name EventListener\n\t * @memberOf playtotv.event\n\t * @class\n\t * @param {Node} node\n\t * @param {String} type\n\t * @param {Function} listener\n\t */\n\tvar EventListener = new playtotv.Class({\n\t\tinitialize: function(node, type, listener) {\n\t\t\tthis.node = node;\n\t\t\tthis.type = type;\n\t\t\tthis.listener = listener;\n\t\t},\n\n\t\tdispose: function() {\n\t\t\tdelete this.node;\n\t\t\tdelete this.type;\n\t\t\tdelete this.listener;\n\t\t}\n\t});\n\n\t/**\n\t * Event namespace\n\t *\n\t * @namespace Public event namespace, enables binding, unbinding and dispatching of events.\n\t */\n\tplaytotv.event = {\n\n\t\t/**\n\t\t * Adds an event listener of the given type to a Node and returns an {@link playtotv.event.EventListener}\n\t\t * listener object for easy removal at {@link playtotv.event#removeListener}.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {string} type\n\t\t * @param {Function} listener\n\t\t * @returns {playtotv.event.EventListener} listener\n\t\t */\n\t\taddListener: function(node, type, listener) {\n\t\t\tif (!node) {\n\t\t\t\tthrow new ReferenceError('Node is undefined at event.addListener for \"' + type + '\"');\n\t\t\t}\n\n\t\t\tnode.addEventListener(type, listener, false);\n\n\t\t\t// return optional listener object for removeListener\n\t\t\treturn new EventListener(node, type, listener);\n\t\t},\n\n\t\t/**\n\t\t * Removes an event listener of the given type from a Node. A single {@link playtotv.event.EventListener}\n\t\t * listener object may be passed as returned by {@link playtotv.event#addListener}, instead of calling this\n\t\t * function with separate node, type and listener parameters.\n\t\t *\n\t\t * @param {Node|playtotv.event.EventListener} subject\n\t\t * @param {string} [type]\n\t\t * @param {Function} [listener]\n\t\t */\n\t\tremoveListener: function(subject, type, listener) {\n\t\t\tvar node = subject;\n\n\t\t\t// subject may either be a node, or an EventListener object\n\t\t\tif (subject instanceof EventListener) {\n\t\t\t\tlistener = subject.listener;\n\t\t\t\ttype = subject.type;\n\t\t\t\tnode = subject.node;\n\t\t\t\tsubject.dispose();\n\t\t\t}\n\n\t\t\tif (!node) {\n\t\t\t\tthrow new ReferenceError('Node is undefined at event.removeListener for \"' + type + '\"');\n\t\t\t}\n\n\t\t\tnode.removeEventListener(type, listener, false);\n\t\t},\n\n\t\t/**\n\t\t * Dispatches a CustomEvent on the given Node, and returns a boolean whether any handler that listened to it\n\t\t * called preventDefault on the event object (if cancelable), as it traversed the DOM.\n\t\t *\n\t\t * @function\n\t\t * @param {Node} node\n\t\t * @param {string} type\n\t\t * @param {boolean} bubbles\n\t\t * @param {boolean} cancelable\n\t\t * @param {Object} detail\n\t\t * @returns {boolean} unprevented\n\t\t */\n\t\tdispatchEvent: function(node, event, bubbles, cancelable, detail) {\n\t\t\treturn node.dispatchEvent(new CustomEvent(event, {\n\t\t\t\tbubbles: bubbles,\n\t\t\t\tcancelable: cancelable,\n\t\t\t\tdetail: detail\n\t\t\t}));\n\t\t},\n\n\t\t/**\n\t\t * Triggers a native HTML event or mouse event on a node. This method is more or less just convenience for\n\t\t * dispatching a (Mouse)Event instance with node.dispatchEvent, although using this method does ensure\n\t\t * IE9 compatibility by using the deprecated event.initMouseEvent if needed.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {string} type\n\t\t * @param {object} params\n\t\t * @returns {boolean} unprevented\n\t\t */\n\t\ttriggerNative: function(node, type, params) {\n\t\t\tparams = playtotv.extend({\n\t\t\t\tbubbles: true,\n\t\t\t\tcancelable: true\n\t\t\t}, params);\n\n\t\t\tvar event = /mouse|click/.test(type) ?\n\t\t\t\tnew MouseEvent(type, params) : new Event(type, params);\n\n\t\t\treturn node.dispatchEvent(event);\n\t\t},\n\n\t\t/**\n\t\t * Prevents the default action of an event. May be passed to addListener for shorthand purposes.\n\t\t * @param {playtotv.event.Event} event\n\t\t * @returns {boolean} false\n\t\t */\n\t\tpreventDefault: function(e) {\n\t\t\te.preventDefault();\n\t\t\treturn false;\n\t\t},\n\n\t\t/**\n\t\t * Stops event propagation through the dom. May be passed to addListener for shorthand purposes.\n\t\t * @param {playtotv.event.Event} event\n\t\t */\n\t\tstopPropagation: function(e) {\n\t\t\te.stopPropagation();\n\t\t},\n\n\t\t/**\n\t\t * Set window.onerror to a function that calls any previously set window.onerror function\n\t\t * and then calls specified callback with the Error instance.\n\t\t *\n\t\t * If error is not provided by browser then an approximation is constructed using the other arguments.\n\t\t *\n\t\t * @param {Function} callback Function to call with uncaught error\n\t\t */\n\t\taddWindowOnError: function(callback) {\n\t\t\tvar originalOnError = window.onerror;\n\n\t\t\twindow.onerror = function(errorMsg, url, line, column, error) {\n\t\t\t\t/*jshint maxcomplexity:10*/\n\t\t\t\tvar originalReturnValue;\n\t\t\t\tif (originalOnError) {\n\t\t\t\t\toriginalReturnValue = originalOnError.apply(this, arguments);\n\t\t\t\t}\n\n\t\t\t\tif (!error) {\n\t\t\t\t\terror = new Error((errorMsg.match(/Error: (.*)/) || [])[1] || errorMsg);\n\t\t\t\t\terror.name = (errorMsg.match(/\\w+Error/) || [])[0] || 'Error';\n\t\t\t\t\terror.stack = url + ':' + line + (column === undefined ? '' : ':' + column);\n\t\t\t\t}\n\n\t\t\t\treturn callback(error) || originalReturnValue;\n\t\t\t};\n\t\t}\n\t};\n\n\t/**\n\t * add local objects to public namespace\n\t *\n\t */\n\n\tplaytotv.extend(playtotv.event, {\n\t\tCustomEvent: CustomEvent,\n\t\tEvent: Event,\n\t\tEventListener: EventListener,\n\t\tMouseEvent: MouseEvent\n\t});\n\n}());\n",
		"(function() {\n\n\t'use strict';\n\n\t// Reliably get a global reference on all platforms by looking at a non-strict function's \"this\"\n\tvar global = /*jshint evil:true*/ new Function('return this')(); /*jshint evil:false*/\n\n\t// Variables\n\n\tvar pkgURL = playtotv.pkgURL = {};\n\tvar loadPromises = {};\n\tvar definePromises = playtotv.definePromises = {};\n\tvar modules = playtotv.modules = {};\n\n\t// Private functions\n\n\tfunction getModuleURL(id) {\n\t\tvar base = '';\n\t\tplaytotv.each(pkgURL, function(url, pkg) {\n\t\t\tif (!base && id.indexOf(pkg) === 0) {\n\t\t\t\tbase = url;\n\t\t\t\tid = id.replace(pkg, '');\n\t\t\t}\n\t\t});\n\t\t// Replace camel case by lower case dash separated and replace dots by slashes, then add .js extension\n\t\tvar path = id.replace(/([a-z0-9])([A-Z])/g, '$1-$2').toLowerCase().replace(/\\./g, '/') + '.js';\n\t\treturn base + path;\n\t}\n\n\tfunction registerModule(id, module) {\n\t\tvar space = global;\n\t\tvar spaces = id.split('.');\n\t\tvar i, name, current, l = spaces.length, last = l - 1;\n\t\tfor (i = 0; i < l; i++) {\n\t\t\tname = spaces[i];\n\t\t\tcurrent = space[name];\n\t\t\tif (i < last) {\n\t\t\t\tspace = current || (space[name] = {});\n\t\t\t} else {\n\t\t\t\t// a.b.c may be defined before a.b, if so, extend a.b with c\n\t\t\t\tspace[name] = current ? playtotv.extend(module, current) : module;\n\t\t\t}\n\t\t}\n\t}\n\n\t// Public functions\n\n\t/**\n\t * Returns a Promise of the module with specified id, loading the related script file if necessary.\n\t *\n\t * @param {string} id Module id\n\t * @return {Promise} Module promise\n\t */\n\tplaytotv.getModule = function(id) {\n\t\tvar url = getModuleURL(id) + '?nocache=' + Date.now(); // bust cache to ease development\n\t\treturn definePromises[id] || loadPromises[id] || (loadPromises[id] = playtotv.loadScript(url).then(function() {\n\t\t\tif (!definePromises[id]) {\n\t\t\t\tthrow new Error(id + ' was not defined by ' + url);\n\t\t\t}\n\t\t\treturn definePromises[id];\n\t\t}));\n\t};\n\n\t/**\n\t * Defines a module using the given id.\n\t * An array of dependencies may be passed, which will be loaded dynamically if not already defined.\n\t * The factory function will be called after all depencies are loaded to create the module.\n\t * The module will also be registered in the global namespace to facilitate usage by third party JavaScript.\n\t *\n\t * A define/require implementation inspired by CommonJS Asynchronous Definition.\n\t * <p>\n\t * Main differences:\n\t * <ul>\n\t * <li>Module id's are dot separated and map to URLs (dots replaced by slashes and camel case by dashed lower case)\n\t * <li>Module dependencies are strings like the module id and can not be relative\n\t * <li>Module dependencies will be dynamically loaded if not already defined\n\t * <li>Module dependencies that are dynamically loaded must use playtotv.define to complete their definition\n\t * </ul>\n\t * </p>\n\t *\n\t * @param {string} id Module id\n\t * @param {Array} dependencies Module dependency id's\n\t * @param {Function} factory Module factory function\n\t * @return {Promise} A Promise of the defined module\n\t */\n\tplaytotv.define = function(id, deps, factory) {\n\t\tif (arguments.length !== 3) {\n\t\t\tthrow new Error('Three arguments required');\n\t\t}\n\n\t\t// TODO: Enable module factory functions to return a promise\n\t\t// Now, when a module depends on such a module it will wait for that promise to resolve instead of just waiting\n\t\t// for the promise of the factory function execution around it to resolve.\n\t\treturn definePromises[id] ||\n\t\t\t(\n\t\t\t\tdefinePromises[id] = Promise.all(deps.map(playtotv.getModule)).then(function(dependencies) {\n\t\t\t\t\tvar thisArg = { id: id, dependencies: deps };\n\t\t\t\t\tvar module = (factory instanceof Function) ? factory.apply(thisArg, dependencies) : factory;\n\t\t\t\t\tmodules[id] = module;\n\t\t\t\t\tregisterModule(id, module);\n\t\t\t\t\treturn module;\n\t\t\t\t})\n\t\t\t);\n\t};\n\n\t/**\n\t * Returns the module with specified id if it has been defined.\n\t *\n\t * @param {string} id Module id\n\t * @returns {Object} Module\n\t */\n\tplaytotv.require = function(id) {\n\t\treturn modules[id];\n\t};\n\n\t/**\n\t * Returns the id of specified module.\n\t *\n\t * @param {Object} module Module\n\t * @return {string} Module id\n\t */\n\tplaytotv.getModuleId = function(module) {\n\t\treturn playtotv.find(Object.keys(modules), function(id) {\n\t\t\treturn modules[id] === module;\n\t\t});\n\t};\n\n\t/**\n\t * Returns an object mapping the names of the specified module ids without their 'package prefixes' to their\n\t * corresponding modules, similar to Java's import statement.\n\t *\n\t * @param {Array} ids Module id's\n\t * @returns {Object} Module map\n\t */\n\tplaytotv.importModules = function(ids) {\n\t\tvar nameReg = /[^.]+$/i;\n\t\tvar importModules = {};\n\t\tvar i, id, name, l = ids.length;\n\t\tfor (i = 0; i < l; i++) {\n\t\t\tid = ids[i];\n\t\t\tname = nameReg.exec(id)[0];\n\t\t\timportModules[name] = modules[id];\n\t\t}\n\t\treturn importModules;\n\t};\n\n}());\n",
		"(function() {\n\n\t'use strict';\n\n\t/**\n\t * Shorthands\n\t *\n\t */\n\tvar ptv = playtotv;\n\n\t// Improved decodeURIComponent with added support for things like: '?key=foo+bar'\n\tfunction decodeURIComponent(s) {\n\t\treturn window.decodeURIComponent(s.replace(/\\+/g, ' '));\n\t}\n\n\tptv.util = {\n\t\t/** @lends playtotv.util */\n\n\t\t// Ease up on regex-es\n\t\t/*jshint regexdash:true, quotmark:false, maxlen:250*/\n\n\t\t/**\n\t\t * Regular expression to validate the format of an email.\n\t\t * @type RegExp\n\t\t */\n\t\tEMAIL_REGEXP: new RegExp(\"^[A-Za-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\\\.[A-Za-z0-9!#$%&'*+/=?^_`{|}~-]+)*@\" +\n\t\t\t'(?:[A-Za-z0-9](?:[A-Za-z0-9-]*[A-Za-z0-9])?\\\\.)+[A-Za-z0-9](?:[A-Za-z0-9-]*[A-Za-z0-9])$'),\n\n\t\t/**\n\t\t * Regular expression for matching URL's in a string.\n\t\t * @type RegExp\n\t\t */\n\t\tURL_REGEXP: /\b((?:[a-z][\\w-]+:(?:\\/{1,3}|[a-z0-9%])|www\\d{0,3}[.]|[a-z0-9.\\-]+[.][a-z]{2,4}\\/)(?:[^\\s()<>]+|\\(([^\\s()<>]+|(\\([^\\s()<>]+\\)))*\\))+(?:\\(([^\\s()<>]+|(\\([^\\s()<>]+\\)))*\\)|[^\\s`!()\\[\\]{};:'\".,<>?«»“”‘’]))/gi,\n\n\t\t/**\n\t\t * Regular expression to derive the Origin from a URL.\n\t\t * @type RegExp\n\t\t */\n\t\tORIGIN_REGEXP: /(\\w+:)?\\/{2,}[^\\/]+/,\n\n\t\t/**\n\t\t * Returns an HTML escaped version of the given String.\n\t\t *\n\t\t * @param {string} unescaped\n\t\t * @returns {string} HTML escaped version\n\t\t */\n\t\tescapeHtml: function(unescaped) {\n\t\t\treturn ptv.dom.create('div', null, { text: unescaped }).innerHTML;\n\t\t},\n\n\t\t/**\n\t\t * Returns an escaped version of the given string for use with the RegExp class.\n\t\t *\n\t\t * @param {string} text String to escape\n\t\t * @returns {string} RegExp escaped string\n\t\t */\n\t\tescapeRegEx: function(text) {\n\t\t\treturn text.replace(/[\\-\\[\\]{}()*+?.,\\\\\\^$|#\\s]/g, '\\\\$&');\n\t\t},\n\n\t\t/**\n\t\t * Basic glob to RegExp converter, just supports * wildcards for now.\n\t\t *\n\t\t * @param {string} glob\n\t\t * @returns {RegExp}\n\t\t */\n\t\tglobToRegEx: function(glob) {\n\t\t\treturn new RegExp('^' + this.escapeRegEx(glob).replace(/\\\\\\*/g, '(.*)') + '$');\n\t\t},\n\n\t\t/**\n\t\t * Glob test specified candidate string.\n\t\t *\n\t\t * @param {string} glob\n\t\t * @param {string} candidate\n\t\t * @returns {boolean} True if candidate matches glob\n\t\t */\n\t\tglob: function(glob, candidate) {\n\t\t\treturn this.globToRegEx(glob).test(candidate);\n\t\t},\n\n\t\t/**\n\t\t * Adds a key value pair to an URL. Checks for existing parameters and a possible hash for insertion.\n\t\t *\n\t\t * @param {string} URL\n\t\t * @param {string} key\n\t\t * @param {string} value\n\t\t * @returns {string} URL with key and value added to it\n\t\t */\n\t\taddURLParam: function(url, key, value) {\n\t\t\tvar sep = (url.indexOf('?') !== -1) ? '&' : '?';\n\t\t\treturn url.replace(/((#.*)?$)/, sep + encodeURIComponent(key) + '=' + encodeURIComponent(value) + '$1');\n\t\t},\n\n\t\t/**\n\t\t * Adds multiple URL params via an object literal.\n\t\t *\n\t\t * @param {string} URL\n\t\t * @param {Object} params\n\t\t * @returns {string} URL with params added to it\n\t\t */\n\t\taddURLParams: function(url, params) {\n\t\t\tptv.each(params, function(value, key) {\n\t\t\t\turl = this.addURLParam(url, key, value);\n\t\t\t}, this);\n\t\t\treturn url;\n\t\t},\n\n\t\t/**\n\t\t * Returns an object literal of the key value pairs in the specified URL.\n\t\t *\n\t\t * @param {string} [url=window.location.href] Defaults to current window URL\n\t\t * @returns {Object} URL parameters\n\t\t */\n\t\tgetURLParams: function(url) {\n\t\t\turl = url || window.location.href;\n\t\t\tvar query = url.replace(/[^\\?]*\\??([^#]*)(#.*)?/, '$1');\n\t\t\tvar params = {};\n\t\t\tvar regex = /([^&=]+)=?([^&]*)/g;\n\t\t\tvar match;\n\t\t\t/*jshint boss:true*/ // suppress warning about following line\n\t\t\twhile (match = regex.exec(query)) {\n\t\t\t\tparams[ decodeURIComponent(match[1]) ] = decodeURIComponent(match[2]);\n\t\t\t}\n\t\t\treturn params;\n\t\t},\n\n\t\t/**\n\t\t * Returns the origin of the specified URL.\n\t\t *\n\t\t * @param {string} [url=window.location.href] URL to derive origin from\n\t\t * @param {string} [baseUrl=window.location.href] Base URL to use for deriving a relative URL's origin\n\t\t * @return {string} Origin of the specified URL\n\t\t */\n\t\tgetOrigin: function(url, baseUrl) {\n\t\t\tvar loc = window.location;\n\t\t\turl = url || loc.href;\n\t\t\tbaseUrl = baseUrl || loc.href;\n\n\t\t\t// If URL matches origin regexp then it is absolute, otherwise it is relative\n\t\t\tvar matches = url.match(this.ORIGIN_REGEXP);\n\t\t\tvar origin = matches ? matches[0] : baseUrl.match(this.ORIGIN_REGEXP)[0];\n\n\t\t\t// Use location protocol by default if not specified (e.g: '//foo.com')\n\t\t\tif (origin.indexOf('//') === 0) {\n\t\t\t\torigin = loc.protocol + origin;\n\t\t\t}\n\n\t\t\t// Origin of file://foo/bar should be file:// instead of file://foo\n\t\t\tif (origin.indexOf('file://') === 0) {\n\t\t\t\torigin = 'file://';\n\t\t\t}\n\n\t\t\treturn origin;\n\t\t},\n\n\t\t/**\n\t\t * Opens a popup window, facilitating specifying window features by an object instead of a string.\n\t\t *\n\t\t * Width and height options are ensured to be smaller then or equal to screen size.\n\t\t * Note: Unfortunately this does not account for space used by bars around content.\n\t\t *\n\t\t * If width and/or height are defined then the window will be automatically centered on screen by calculating\n\t\t * the appropriate values for the left and top options (unless those are already manually defined).\n\t\t *\n\t\t * @param {string} url URL to open in popup window\n\t\t * @param {string} [target='_blank'] Name of target window, '_blank' for new window\n\t\t * @param {Object} [options={}] Object with window features to request\n\t\t * @return {Window} Popup window\n\t\t */\n\t\tpopup: function(url, target, options) {\n\t\t\ttarget = target || '_blank';\n\t\t\toptions = options || {};\n\n\t\t\tvar width = options.width;\n\t\t\tif (width) {\n\t\t\t\tvar winWidth = window.screen.width;\n\t\t\t\toptions.width = width = Math.min(width, winWidth);\n\t\t\t\toptions.left = options.left || Math.round((winWidth / 2) - (width / 2));\n\t\t\t}\n\n\t\t\tvar height = options.height;\n\t\t\tif (height) {\n\t\t\t\tvar winHeight = window.screen.height;\n\t\t\t\toptions.height = height = Math.min(height, winHeight);\n\t\t\t\toptions.top = options.top || Math.round((winHeight / 2) - (height / 2));\n\t\t\t}\n\n\t\t\tvar features = Object.keys(options).map(function(key) {\n\t\t\t\treturn key + '=' + options[key];\n\t\t\t}).join(',');\n\n\t\t\treturn window.open(url, target, features);\n\t\t},\n\n\t\t/**\n\t\t * Pads a string with a leading character (or 0 if omited) up to the given length.\n\t\t *\n\t\t * @param {string} str String to pad\n\t\t * @param {number} [len=2] Length to pad up to\n\t\t * @param {Char} [ch='0'] Character to pad with\n\t\t * @returns {string} Padded string\n\t\t */\n\t\tpad: function(str, len, ch) {\n\t\t\tstr = String(str);\n\t\t\tlen = parseInt(len, 10) || 2;\n\t\t\tch = ch || '0';\n\t\t\twhile (str.length < len) {\n\t\t\t\tstr = ch + str;\n\t\t\t}\n\t\t\treturn str;\n\t\t},\n\n\t\t/**\n\t\t * Returns a formatted version of the given date, in hh:mm:ss and optional ms.\n\t\t *\n\t\t * @param {Date} [date=new Date()] Defaults to current date\n\t\t * @param {boolean} [ms=false] Whether to show milliseconds\n\t\t * @returns {string} Formatted time string\n\t\t */\n\t\ttimeStr: function(date, ms) {\n\t\t\tdate = date || new Date();\n\t\t\treturn this.pad(date.getHours()) + ':' +\n\t\t\t\tthis.pad(date.getMinutes()) + ':' +\n\t\t\t\tthis.pad(date.getSeconds()) +\n\t\t\t\t(ms ? '.' + this.pad(date.getMilliseconds(), 3) : '');\n\t\t},\n\n\t\t/**\n\t\t * Date format function based on Java's SimpleDateFormat.\n\t\t * @see https://docs.oracle.com/javase/8/docs/api/index.html?java/text/SimpleDateFormat.html\n\t\t *\n\t\t * Pattern letters:\n\t\t *   G*  Era designator  Text  AD\n\t\t *   y   Year  Year  1996; 96\n\t\t *   Y*  Week year  Year  2009; 09\n\t\t *   M   Month in year (context sensitive)  Month  July; Jul; 07\n\t\t *   L*  Month in year (standalone form)  Month  July; Jul; 07\n\t\t *   w*  Week in year  Number  27\n\t\t *   W*  Week in month  Number  2\n\t\t *   D*  Day in year  Number  189\n\t\t *   d   Day in month  Number  10\n\t\t *   F*  Day of week in month  Number  2\n\t\t *   E*  Day name in week  Text  Tuesday; Tue\n\t\t *   u*  Day number of week (1 = Monday, ..., 7 = Sunday)  Number  1\n\t\t *   a   Am/pm marker  Text  PM\n\t\t *   H   Hour in day (0-23)  Number  0\n\t\t *   k*  Hour in day (1-24)  Number  24\n\t\t *   K*  Hour in am/pm (0-11)  Number  0\n\t\t *   h   Hour in am/pm (1-12)  Number  12\n\t\t *   m   Minute in hour  Number  30\n\t\t *   s   Second in minute  Number  55\n\t\t *   S   Millisecond  Number  978\n\t\t *   z*  Time zone  General time zone  Pacific Standard Time; PST; GMT-08:00\n\t\t *   Z*  Time zone  RFC 822 time zone  -0800\n\t\t *   X*  Time zone  ISO 8601 time zone  -08; -0800; -08:00\n\t\t *\n\t\t * TODO: Add support for unsupported letters, e.g. marked with (*)\n\t\t * TODO: Add support for number/name depending on length, e.g: MMM => Aug and: MMMM => August\n\t\t * TODO: Add support for escaping, e.g: \"hh 'o''clock' a\" => \"12 o'clock PM\"\n\t\t *\n\t\t * @param {string} pattern\n\t\t * @param {Date|number|string} [date] Defaults to current date\n\t\t * @returns {string} Formatted date string\n\t\t */\n\t\tformatDate: function(pattern, date = new Date()) {\n\t\t\t// Convert to Date if necessary (e.g: unix timestamp number or date string)\n\t\t\tif (!(date instanceof Date)) {\n\t\t\t\tdate = new Date(date);\n\t\t\t}\n\n\t\t\t// Note: An attempt was made to optimize this a bit by only calling Date methods when necessary etc.\n\t\t\tvar hours = date.getHours();\n\t\t\treturn pattern.replace(/([a-zA-Z])\\1*/g, letters => {\n\t\t\t\t/*jshint maxcomplexity:100*/\n\n\t\t\t\tvar letter = letters[0];\n\t\t\t\tvar len = letters.length;\n\t\t\t\tvar output =\n\t\t\t\t\tletter === 'y' ? (len === 2 ? String(date.getFullYear()).substr(2) : date.getFullYear()) :\n\t\t\t\t\tletter === 'M' ? date.getMonth() + 1 :\n\t\t\t\t\tletter === 'd' ? date.getDate() :\n\t\t\t\t\tletter === 'H' ? hours :\n\t\t\t\t\tletter === 'h' ? (hours <= 12 ? (hours === 0 ? 12 : hours) : hours - 12) :\n\t\t\t\t\tletter === 'm' ? date.getMinutes() :\n\t\t\t\t\tletter === 's' ? date.getSeconds() :\n\t\t\t\t\tletter === 'S' ? date.getMilliseconds() :\n\t\t\t\t\tletter === 'a' ? (hours < 12 ? 'AM' : 'PM') :\n\t\t\t\t\tnull;\n\n\t\t\t\tif (output === null) {\n\t\t\t\t\tthrow new Error(`Unsupported letter: ${letter} in pattern: ${pattern}`);\n\t\t\t\t}\n\n\t\t\t\t// Pad number with 0's if necessary, e.g: 1 with MM => 01\n\t\t\t\tif (len > 1) {\n\t\t\t\t\toutput = this.pad(output, len);\n\t\t\t\t}\n\n\t\t\t\treturn output;\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Returns a currency formatted value from the given number.\n\t\t *\n\t\t * @param {number} number Value to format\n\t\t * @param {boolean} [cents=true] Whether to round to cents or whole units\n\t\t * @returns {string} Formatted currency string\n\t\t */\n\t\ttoCurrency: function(number, cents) {\n\t\t\t// number.toLocaleString() fails in chrome and adds no decimals\n\t\t\tvar split = parseFloat(number).toFixed(2).split('.');\n\t\t\tvar nr = split[0].split(''), i, l = nr.length - 3;\n\t\t\tfor (i = l; i >= 1; i -= 3) {\n\t\t\t\tnr.splice(i, 0, '.');\n\t\t\t}\n\t\t\treturn nr.join('') + ',' + (cents === false ? '-' : split[1]);\n\t\t},\n\n\t\t/**\n\t\t * Returns lower case formatted string with words separated by dashes.\n\t\t *\n\t\t * @param {string} str\n\t\t * @returns {string}\n\t\t */\n\t\tdashCase: function(str) {\n\t\t\treturn str.\n\t\t\t\treplace(/\\W+/g, '-').\n\t\t\t\treplace(/\\w+/g, m => m.toLowerCase());\n\t\t},\n\n\t\t/**\n\t\t * Returns string formatted with only the first letters of words upper case and words separated by spaces.\n\t\t *\n\t\t * @param {string} str\n\t\t * @returns {string}\n\t\t */\n\t\ttitleCase: function(str) {\n\t\t\treturn str.\n\t\t\t\treplace(/[\\W_]+/g, ' ').\n\t\t\t\treplace(/(\\w)(\\w*)/g, (m, p1, p2) => p1.toUpperCase() + p2.toLowerCase());\n\t\t},\n\n\t\t/**\n\t\t * Returns head of path string separated by specified separator.\n\t\t *\n\t\t * @param {string} path Path (e.g: object property keys) string\n\t\t * @param {string} [sep='.'] Path string separator character\n\t\t * @returns {string} Head of path\n\t\t */\n\t\tgetPathHead: function(path, sep = '.') {\n\t\t\tvar i = path.indexOf(sep);\n\t\t\treturn i < 0 ? path : path.substr(0, i);\n\t\t},\n\n\t\t/**\n\t\t * Returns tail of path string separated by specified separator.\n\t\t *\n\t\t * @param {string} path Path (e.g: object property keys) string\n\t\t * @param {string} [sep='.'] Path string separator character\n\t\t * @returns {string} Tail of path\n\t\t */\n\t\tgetPathTail: function(path, sep = '.') {\n\t\t\tvar i = path.indexOf(sep);\n\t\t\treturn i < 0 ? '' : path.substr(i + 1);\n\t\t},\n\n\t\t/**\n\t\t * Returns a reference object with object, key and value properties.\n\t\t * Or object if path is falsy (e.g: in case you just want to return the object itself).\n\t\t * Or undefined if object is falsy (e.g: path was not found after recursion).\n\t\t *\n\t\t * @param {Object} [object] Object to seek through\n\t\t * @param {string} [path=''] Path (e.g: object property keys) to seek in object\n\t\t * @param {string} [sep='.'] Path string separator character\n\t\t * @returns {Object} Reference object with object, key and value\n\t\t */\n\t\tseekRef: function(object, path = '', sep = '.') {\n\t\t\tif (!path) {\n\t\t\t\treturn { object: object, key: '', value: object };\n\t\t\t}\n\t\t\tif (!object) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\tvar key = this.getPathHead(path, sep);\n\t\t\tvar value = object[key];\n\t\t\treturn key === path ?\n\t\t\t\t{ object: object, key: key, value: value } :\n\t\t\t\tthis.seekRef(value, this.getPathTail(path, sep));\n\t\t},\n\n\t\t/**\n\t\t * Returns value of property with specified path within specified object.\n\t\t * Or undefined if property at path could not be found.\n\t\t *\n\t\t * @param {Object} [object] Object to seek through\n\t\t * @param {string} [path=''] Path (e.g: object property keys) to seek in object\n\t\t * @param {string} [sep='.'] Path string separator character\n\t\t * @returns {mixed} Value of property with specified path within specified object\n\t\t */\n\t\tseek: function(object, path = '', sep = '.') {\n\t\t\tvar ref = this.seekRef(object, path, sep);\n\t\t\treturn ref && ref.value;\n\t\t},\n\n\t\t/**\n\t\t * Resolves a base 'from' and a relative 'to' path to a combined file path.\n\t\t *\n\t\t * Note: This currently only works for a relative from path (not starting with '/').\n\t\t *\n\t\t * TODO: Make this work for absolute paths as well, depending on whether from is absolute or not.\n\t\t *\n\t\t * @param {string} from Path to start from\n\t\t * @param {string} to Relative path to resolve to\n\t\t * @returns {string} Resolved path\n\t\t */\n\t\tresolvePath: function(from, to) {\n\t\t\tif (to.indexOf('/') === 0) {\n\t\t\t\treturn to.substr(1);\n\t\t\t}\n\n\t\t\tvar fromDir = from.substr(0, from.lastIndexOf('/') + 1);\n\n\t\t\twhile (to.indexOf('../') === 0) {\n\t\t\t\tto = to.substr(3);\n\t\t\t\tfromDir = fromDir.replace(/[^\\/]+\\/$/, '');\n\t\t\t}\n\n\t\t\treturn fromDir + to;\n\t\t},\n\n\t\t/**\n\t\t * Returns a UTC time zone string (e.g: UTC+01:00).\n\t\t *\n\t\t * @param {number} [hours] Defaults to value derived from Date getTimezoneOffset()\n\t\t * @returns {string} UTC time zone string\n\t\t */\n\t\tgetTimeZone: function(hours) {\n\t\t\thours = hours === undefined ? -1 * (new Date().getTimezoneOffset() / 60) : hours;\n\t\t\tvar sign = hours < 0 ? '-' : '+';\n\t\t\thours = Math.abs(hours);\n\t\t\treturn 'UTC' + sign + this.pad(Math.floor(hours)) + ':' + this.pad((hours * 60) % 60);\n\t\t},\n\n\t\t/**\n\t\t * Evaluates specified script within specified context.\n\t\t *\n\t\t * Besides context properties being available like variables, it is also used as the 'this' argument.\n\t\t *\n\t\t * Strict mode is used to prevent leaking onto global scope (e.g: \"x = 1\" => window.x = 1) etc.\n\t\t *\n\t\t * Script is wrapped in eval to return block value without requiring explicit return.\n\t\t * E.g: script = \"x + 1\" instead of \"return x + 1\", like in a do-expression (ECMAScript proposal)\n\t\t * See: https://gist.github.com/DmitrySoshnikov/de4727f57c5acc17e9469d1a91743125\n\t\t *\n\t\t * Notes:\n\t\t * - Be careful when using this! Only use when you are sure it is appropriate and safe!\n\t\t * - Context can not have a property with key: '_script'\n\t\t *\n\t\t * @param {string} [script=''] Script to evaluate\n\t\t * @param {Object} [context={}] Context to evaluate within\n\t\t * @returns {mixed} Script return value\n\t\t */\n\t\teval: function(script = '', context = {}) {\n\t\t\t// Make context properties available through arguments of new Function\n\t\t\tvar args = Object.keys(context);\n\t\t\tvar values = args.map(arg => context[arg]);\n\n\t\t\t// Final argument is the Function script\n\t\t\t// Use eval only if necessary (it has a performance impact)\n\t\t\tscript = script.trim();\n\t\t\tvar semiIndex = script.indexOf(';');\n\t\t\tif (semiIndex >= 0 && semiIndex < script.length) {\n\t\t\t\targs.push('_script', '\"use strict\"; return eval(_script);');\n\t\t\t\tvalues.push(script);\n\t\t\t} else {\n\t\t\t\targs.push('\"use strict\"; return ' + script);\n\t\t\t}\n\n\t\t\t// Add script to error message to facilitate debugging (try-catch should barely have a performance impact)\n\t\t\ttry {\n\t\t\t\tvar fn = Function.apply(null, args);\n\t\t\t\treturn fn.apply(context, values);\n\t\t\t} catch (error) {\n\t\t\t\terror.message += ' in script: ' + script.trim().replace(/\\s+/g, ' ');\n\t\t\t\tthrow error;\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Returns list filtered by value specified by item path matching specified value by specified mode.\n\t\t *\n\t\t * When you pass a string value it is turned into a function for you based on mode.\n\t\t *\n\t\t * If you want a more exact form of matching then provide your own RegExp or Function test value.\n\t\t *\n\t\t * @param {Array} list List to filter\n\t\t * @param {string} path Filter value path, e.g: '' (item) or: 'x.y' (item.x.y)\n\t\t * @param {string|RegExp|Function|mixed} value Value to test for or Function to test with\n\t\t * @params {string} [mode] Filter mode: fuzzy/contains/startsWith/endsWith/equals (default: exact)\n\t\t * @returns {Array} Filtered list\n\t\t */\n\t\tfilter: function(list, path, value, mode) {\n\t\t\tif (typeof value === 'string') {\n\t\t\t\tvar escapedValue = this.escapeRegEx(value);\n\t\t\t\tvar regexStr = {\n\t\t\t\t\t// Very simple fuzzy-like matching algorithm\n\t\t\t\t\tfuzzy: value.split('').map(ch => this.escapeRegEx(ch) + '.*').join(''),\n\t\t\t\t\tcontains: escapedValue,\n\t\t\t\t\tstartsWith: '^' + escapedValue,\n\t\t\t\t\tendsWith: escapedValue + '$',\n\t\t\t\t\tequals: '^' + escapedValue + '$'\n\t\t\t\t}[mode];\n\t\t\t\tif (regexStr !== undefined) {\n\t\t\t\t\tvalue = new RegExp(regexStr, 'i');\n\t\t\t\t} // else default to exact string value match\n\t\t\t}\n\n\t\t\tvar filterFn = value instanceof RegExp ? value.test.bind(value) :\n\t\t\t\tvalue instanceof Function ? value.bind(list) :\n\t\t\t\tvalue === undefined ? function(candidate) { return !!candidate; } :\n\t\t\t\tfunction(candidate) { return candidate === value; };\n\n\t\t\treturn list.filter(item => filterFn(this.seek(item, path)));\n\t\t},\n\n\t\t/**\n\t\t * Returns a copy of list ordered by value specified by item path.\n\t\t *\n\t\t * @param {Array} list List to order\n\t\t * @param {string} [path=''] Filter value path, e.g: '' (item) or: 'x.y' (item.x.y)\n\t\t * @params {boolean} [desc=false] Whether to order in descencing order (or ascending)\n\t\t * @returns {Array} Ordered list\n\t\t */\n\t\torder: function(list, path = '', desc = false) {\n\t\t\t// Do not modify original array\n\t\t\tlist = list.slice(0);\n\n\t\t\treturn list.sort((a, b) => {\n\t\t\t\ta = this.seek(a, path);\n\t\t\t\tb = this.seek(b, path);\n\t\t\t\treturn (desc ? -1 : 1) * (a < b ? -1 : a > b ? 1 : 0);\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Returns specified page of list with added properties.\n\t\t *\n\t\t * The properties that are added are:\n\t\t * - page = actual page returned (bound between 1 and last page)\n\t\t * - prev = page - 1 or false if page is already <= 1\n\t\t * - next = page + 1 or false if page is already >= last\n\t\t * - last = last page number\n\t\t *\n\t\t * @param {Array} list List to page\n\t\t * @param {number} [page=1] Number of page to return (starting at 1)\n\t\t * @param {number} [size=10] Page size to use\n\t\t * @returns {Array} Specified page of list with added properties\n\t\t */\n\t\tpage: function(list, page = 1, size = 10) {\n\t\t\tvar last = Math.ceil(list.length / size);\n\t\t\tpage = Math.max(1, page);\n\t\t\tpage = Math.min(last, page);\n\n\t\t\tvar paged = list.slice((page - 1) * size, page * size);\n\n\t\t\tptv.extend(paged, {\n\t\t\t\tpage: page,\n\t\t\t\tprev: page > 1 && page - 1,\n\t\t\t\tnext: page < last && page + 1,\n\t\t\t\tlast: last\n\t\t\t});\n\n\t\t\treturn paged;\n\t\t}\n\t};\n\n}());\n",
		"(function() {\n\t/*global console*/\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar util = ptv.util;\n\n\tvar loggers = {};\n\tvar numericLevelMap = {\n\t\tSPAM: 4,\n\t\tDEBUG: 3,\n\t\tINFO: 2,\n\t\tWARNING: 1,\n\t\tERROR: 0,\n\t\tNONE: -1\n\t};\n\tvar logFuncMap = {\n\t\tSPAM: 'log',\n\t\tDEBUG: 'debug',\n\t\tINFO: 'info',\n\t\tWARNING: 'warn',\n\t\tERROR: 'error'\n\t};\n\tvar urlParams = typeof window !== 'undefined' ? util.getURLParams(window.location.href) : {};\n\n\t// If requested, include firebug lite\n\tif (urlParams.fbl) {\n\t\tptv.loadScript('//getfirebug.com/firebug-lite.js#startOpened', false);\n\t}\n\n\t// If requested, include weinre\n\tvar weinre = urlParams.weinre;\n\tif (weinre !== undefined) {\n\t\tptv.loadScript('https://weinre.exmachina.nl/target/target-script-min.js#' + (weinre || 'anonymous'), false);\n\t}\n\n\tvar Logger = new ptv.Class({\n\t\t/** @lends playtotv.Logger.prototype */\n\n\t\t/**\n\t\t * Logger enables named loggers throughout different classes.\n\t\t * The level parameter is optional, and defaults to the static playtotv.Logger.level.\n\t\t * Both instance logger levels and static default level can be changed at runtime.\n\t\t *\n\t\t * Note: It is recommended to use {@link playtotv.Logger.get} to create Logger instances.\n\t\t *\n\t\t * Default log level and log join flag values can be controlled by URL parameters, see:\n\t\t * {@link playtotv.Logger.level} and {@link playtotv.Logger.join}.\n\t\t *\n\t\t * Specifying a truthy \"fbl\" URL parameter (e.g: ?fbl=1) will result in injection of a Firebug Lite inspector.\n\t\t *\n\t\t * Specifying a \"weinre\" URL parameter (e.g: ?weinre=lan-pp.playtotv.com:8080) will result in injection of\n\t\t * Weinre Javascript from specified host and port.\n\t\t *\n\t\t * @constructs\n\t\t * @param {string} [name=logger-[uid]]\n\t\t * @param {string} [level]\n\t\t */\n\t\tinitialize: function(name, level) {\n\t\t\tthis.name = name || ptv.getUID('logger-');\n\t\t\tthis.level = level;\n\t\t},\n\n\t\t/**\n\t\t * Indicates whether the logger is enabled for the given level.\n\t\t *\n\t\t * @param {string} level Logger level\n\t\t * @return {boolean} True if logger is enabled\n\t\t */\n\t\tisEnabled: function(level) {\n\t\t\tvar myLevel = this.level || Logger.level; // default to global level\n\t\t\treturn numericLevelMap[myLevel] >= numericLevelMap[level];\n\t\t},\n\n\t\t/**\n\t\t * Logs arguments to console if possible and specified level is enabled.\n\t\t *\n\t\t * Each argument that is a Promise will be substituted by an array of it's status and value.\n\t\t * When the Promise resolves or rejects log will be called again with the updated Promise status and value.\n\t\t *\n\t\t * If an argument is an Array it will be flattened to result in more readable console log output in most cases.\n\t\t *\n\t\t * Note: This is a shallow flatten, e.g: if that Array contains other Arrays, those will not be flattened.\n\t\t *\n\t\t * Finally, the log statement is prefixed with call time, call level and logger name.\n\t\t *\n\t\t * TODO: Update example below with Cancellable.setTimeout instead of when.timeout.\n\t\t *\n\t\t * @example\n\t\t * logger = playtotv.Logger.get('example');\n\t\t * logger.log('INFO', [\n\t\t *   'Test', 1, [2], [[3,4]],\n\t\t *   when.timeout(Promise.delay('yup', 1000), 2000),\n\t\t *   when.timeout(Promise.delay('yup', 3000), 2000)\n\t\t * ]);\n\t\t * // Output:\n\t\t * // 16:21:55 [INFO] example | Test 1 2 [3, 4] [promise] [promise]\n\t\t * // 16:21:56 [INFO] example | Test 1 2 [3, 4] [resolved] yup [promise]\n\t\t * // 16:21:57 [INFO] example | Test 1 2 [3, 4] [resolved] yup [rejected] timeout\n\t\t *\n\t\t * @param {string} level Logger level\n\t\t * @param {arguments} args Arguments to log\n\t\t */\n\t\tlog: function(level, args) {\n\t\t\tif (console && this.isEnabled(level)) {\n\t\t\t\targs = ptv.toArray(args);\n\n\t\t\t\t// Log again once a Promise resolves or rejects, deferred by Promise until after logger.apply below\n\t\t\t\targs = args.map(function(arg) {\n\t\t\t\t\tif (arg instanceof Promise) {\n\t\t\t\t\t\tvar p = [ '[promise]' ];\n\t\t\t\t\t\targ.then(function(data) {\n\t\t\t\t\t\t\tp.push('[resolved]', data);\n\t\t\t\t\t\t\tthis.log(level, args);\n\t\t\t\t\t\t}.bind(this), function(reason) {\n\t\t\t\t\t\t\tp.push('[rejected]', reason);\n\t\t\t\t\t\t\tthis.log(level, args);\n\t\t\t\t\t\t}.bind(this));\n\t\t\t\t\t\treturn p;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn arg;\n\t\t\t\t\t}\n\t\t\t\t}, this);\n\n\t\t\t\t// Prefix and flatten args\n\t\t\t\tvar prefix = util.timeStr(new Date(), true) + ' [' + level + '] ' + this.name + ' |';\n\t\t\t\tvar processed = Array.prototype.concat.apply([ prefix ], args);\n\n\t\t\t\t// Determine logger function at runtime to allow for effective Firebug Lite etc. injection\n\t\t\t\tvar logger = console[logFuncMap[level]] || console.log;\n\t\t\t\t// IE8 does not allow logger.apply and has type 'unknown'\n\t\t\t\tif (typeof logger.apply === 'function') {\n\t\t\t\t\tlogger.apply(console, Logger.join ? [ processed.join(' ') ] : processed);\n\t\t\t\t} else {\n\t\t\t\t\tlogger(processed.join(' '));\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Outputs a stacktrace to console if possible and specified level is enabled.\n\t\t *\n\t\t * @param {string} [level] Logger level\n\t\t */\n\t\ttrace: function(level) {\n\t\t\tif (console && console.trace && (!level || this.isEnabled(level))) {\n\t\t\t\tconsole.trace();\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Shortcut to {@link playtotv.Logger#log}('SPAM', arguments)\n\t\t */\n\t\ts: function() {\n\t\t\tthis.log('SPAM', arguments);\n\t\t},\n\n\t\t/**\n\t\t * Shortcut to {@link playtotv.Logger#log}('DEBUG', arguments)\n\t\t */\n\t\td: function() {\n\t\t\tthis.log('DEBUG', arguments);\n\t\t},\n\n\t\t/**\n\t\t * Shortcut to {@link playtotv.Logger#log}('INFO', arguments)\n\t\t */\n\t\ti: function() {\n\t\t\tthis.log('INFO', arguments);\n\t\t},\n\n\t\t/**\n\t\t * Shortcut to {@link playtotv.Logger#log}('WARNING', arguments)\n\t\t */\n\t\tw: function() {\n\t\t\tthis.log('WARNING', arguments);\n\t\t},\n\n\t\t/**\n\t\t * Shortcut to {@link playtotv.Logger#log}('ERROR', arguments)\n\t\t */\n\t\te: function() {\n\t\t\tthis.log('ERROR', arguments);\n\t\t}\n\t});\n\n\tptv.extend(Logger, {\n\t\t/** @lends playtotv.Logger */\n\n\t\t/**\n\t\t * Default Logger level.\n\t\t * Legal values are: SPAM, DEBUG, INFO, WARNING, ERROR, NONE.\n\t\t *\n\t\t * If you specify a logLevel URL parameter then that value will be used as default (e.g: ?logLevel=DEBUG).\n\t\t *\n\t\t * @type string\n\t\t * @default 'INFO'\n\t\t */\n\t\tlevel: urlParams.logLevel || 'INFO',\n\n\t\t/**\n\t\t * Whether to join arguments into a single string before logging to console.\n\t\t * Useful for iOS and Android log implementations that only display the first argument.\n\t\t * Downside is that it does poor string conversion (e.g. you see [object Object]).\n\t\t *\n\t\t * If you specify a truthy logJoin URL parameter then that value will be used as default (e.g: ?logJoin=1).\n\t\t *\n\t\t * @type boolean\n\t\t * @default false\n\t\t */\n\t\tjoin: urlParams.logJoin ? true : false,\n\n\t\t/**\n\t\t * Returns a Logger instance with the given name and level.\n\t\t *\n\t\t * If a Logger with the same name was previously created by this function then that will be returned.\n\t\t * If a level is specified then the level of that instance will be updated.\n\t\t *\n\t\t * Otherwise a new Logger instance will be created with specified name and level and stored for future re-use.\n\t\t *\n\t\t * @param {string} [name]\n\t\t * @param {string} [level]\n\t\t * @returns {playtotv.Logger}\n\t\t */\n\t\tget: function(name, level) {\n\t\t\tvar logger = name && loggers[name];\n\t\t\tif (logger) {\n\t\t\t\tif (level) {\n\t\t\t\t\tlogger.level = level;\n\t\t\t\t}\n\t\t\t\treturn logger;\n\t\t\t}\n\n\t\t\tlogger = new Logger(name, level);\n\t\t\tloggers[name] = logger;\n\t\t\treturn logger;\n\t\t}\n\t});\n\n\tptv.Logger = Logger;\n\n}());\n",
		"playtotv.define('playtotv.analytics.ComScoreAnalytics', [], function() {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar util = ptv.util;\n\n\treturn ptv.Class({\n\t\t/** @lends playtotv.analytics.ComScoreAnalytics.prototype */\n\n\t\t/**\n\t\t * ComScore Analytics class.\n\t\t *\n\t\t * This will define window.udm_() as specified by ComScore if it has not been defined already.\n\t\t *\n\t\t * @constructs\n\t\t * @param {Object} options\n\t\t * @param {string} options.url Base UDM log URL\n\t\t *\n\t\t * @property {string} url Base UDM URL\n\t\t */\n\t\tinitialize: function(config) {\n\t\t\tptv.params(config, {\n\t\t\t\turl: ptv.REQUIRED\n\t\t\t});\n\n\t\t\tthis.url = config.url;\n\n\t\t\tif (!window.udm_) {\n\t\t\t\t// Following is fugly code as specified by ComScore\n\t\t\t\t// Note: it is slightly modified to leak ns_p to window as intended\n\t\t\t\t/*jshint ignore:start*/\n\t\t\t\t/*jscs:disable*/\n\t\t\t\twindow.udm_ = function udm_(e) {var t=\"comScore=\",n=document,r=n.cookie,i=\"\",s=\"indexOf\",o=\"substring\",u=\"length\",a=2048,f,l=\"&ns_\",c=\"&\",h,p,d,v,m=window,g=m.encodeURIComponent||escape;if(r[s](t)+1)for(d=0,p=r.split(\";\"),v=p[u];d<v;d++)h=p[d][s](t),h+1&&(i=c+unescape(p[d][o](h+t[u])));e+=l+\"_t=\"+ +(new Date)+l+\"c=\"+(n.characterSet||n.defaultCharset||\"\")+\"&c8=\"+g(n.title)+i+\"&c7=\"+g(n.URL)+\"&c9=\"+g(n.referrer),e[u]>a&&e[s](c)>0&&(f=e[o](0,a-8).lastIndexOf(c),e=(e[o](0,f)+l+\"cut=\"+g(e[o](f+1)))[o](0,a)),n.images?(h=new Image,m.ns_p||(m.ns_p=h),h.src=e):n.write(\"<\",\"p\",\"><\",'img src=\"',e,'\" height=\"1\" width=\"1\" alt=\"*\"',\"><\",\"/p\",\">\")};\n\t\t\t\t/*jscs:enable*/\n\t\t\t\t/*jshint ignore:end*/\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Calls window.udm_() (Unified Digital Measurement) with this.url and optional tag and params.\n\t\t *\n\t\t * @param {string} [tag=''] Occurrences of '__TAG__' in URL will be replaced by this value\n\t\t * @param {Object} [params={}] Map of parameters to add to URL\n\t\t */\n\t\tudm: function(tag, params) {\n\t\t\tvar url = this.url.replace(/__TAG__/g, tag || '');\n\t\t\turl = util.addURLParams(url, params || {});\n\t\t\twindow.udm_(url);\n\t\t}\n\t});\n});\n",
		"playtotv.define('playtotv.analytics.GoogleAnalytics', [], function() {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar log = ptv.Logger.get(this.id);\n\n\treturn new ptv.Class({\n\t\t/** @lends playtotv.analytics.GoogleAnalytics.prototype */\n\n\t\t/**\n\t\t * Google Analytics class.\n\t\t *\n\t\t * <ol>\n\t\t * <li>Loads window.ga() if necessary using the standard asynchronous snippet\n\t\t * <li>Creates a tracker with specified fields\n\t\t * <li>If a name is specified then the tracker will be created with and this instance scoped to that name\n\t\t * <li>If setFields are specified then they are set\n\t\t * <li>If requires are specified then they are required\n\t\t * <li>If skipView is not true then immediately calls {@link playtotv.analytics.GoogleAnalytics#sendView}\n\t\t * </ol>\n\t\t *\n\t\t * When fields are passed to setFields or send then if a dimension or metric property is specified\n\t\t * it will be mapped to dimension1, metric1 etc. by the processFields method.\n\t\t * This facilitates use of custom dimensions and metric by making them named\n\t\t * and by facilitating different mappings per GoogleAnalytics instance.\n\t\t *\n\t\t * @see <a href=\"developers.google.com/analytics/devguides/collection/analyticsjs/\">Google Dev Guide</a>\n\t\t * @see <a href=\"developers.google.com/analytics/devguides/collection/analyticsjs/field-reference\">Fields</a>\n\t\t *\n\t\t * @constructs\n\t\t * @param {Object} options\n\t\t * @param {string} options.id Tracker ID\n\t\t * @param {string} [options.name] Tracker name\n\t\t * @param {Object} [options.fields={}] Tracker create fields (cookieDomain, sampleRate, ..)\n\t\t * @param {Object} [options.setFields={}] Tracker set fields (appName, appId, appVersion, ..)\n\t\t * @param {Object} [options.dimensionMap={}] Map of dimension names to indexes\n\t\t * @param {Object} [options.metricMap={}] Map of metric names to indexes\n\t\t * @param {[string]} [options.requires=[]] Array of plugin name strings or argument arrays to require\n\t\t * @param {string} [options.skipView=false] If true then skip sending initial screen or page view\n\t\t *\n\t\t * @property {string} prefix Tracker name prefix to use before method names\n\t\t * @property {string} mode Tracker mode, if setFields.appId was defined then 'app' otherwise 'web'\n\t\t * @property {Object} dimensionMap Map of dimension names to indexes\n\t\t * @property {Object} metricMap Map of metric names to indexes\n\t\t * @property {Promise} trackerPromise Promise of GA tracker reference used by this instance\n\t\t * @property {Object} tracker GA tracker reference used by this instance\n\t\t */\n\t\tinitialize: function(options) {\n\t\t\tptv.params(options, {\n\t\t\t\tid: ptv.REQUIRED,\n\t\t\t\tname: null,\n\t\t\t\tfields: {},\n\t\t\t\tsetFields: null,\n\t\t\t\tdimensionMap: {},\n\t\t\t\tmetricMap: {},\n\t\t\t\trequires: [],\n\t\t\t\tskipView: false\n\t\t\t});\n\n\t\t\tif (!window.ga) {\n\t\t\t\t/*jshint -W030, -W033, -W069, -W072*/\n\t\t\t\t/*jscs:disable*/\n\t\t\t\t(function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {\n\t\t\t\t(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),\n\t\t\t\tm=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)\n\t\t\t\t})(window,document,'script','//www.google-analytics.com/analytics.js','ga');\n\t\t\t\t/*jscs:enable*/\n\t\t\t}\n\n\t\t\tvar name = options.name;\n\t\t\tvar fields = options.fields;\n\t\t\tvar setFields = options.setFields;\n\t\t\tvar prefix = '';\n\t\t\tif (name) {\n\t\t\t\tprefix = name + '.';\n\t\t\t\tfields.name = name;\n\t\t\t}\n\n\t\t\tthis.prefix = prefix;\n\n\t\t\tthis.mode = setFields && setFields.appId ? 'app' : 'web';\n\t\t\tthis.dimensionMap = options.dimensionMap;\n\t\t\tthis.metricMap = options.metricMap;\n\n\t\t\twindow.ga('create', options.id, fields);\n\n\t\t\tif (setFields) {\n\t\t\t\tthis.setFields(setFields);\n\t\t\t}\n\n\t\t\toptions.requires.forEach(function(args) {\n\t\t\t\targs = [ 'require' ].concat(args);\n\t\t\t\tthis.ga.apply(this, args);\n\t\t\t}.bind(this));\n\n\t\t\t// TODO: Rewrite without use of Promise.defer()\n\t\t\tvar deferred = Promise.defer();\n\t\t\tthis.trackerPromise = deferred.promise;\n\t\t\twindow.ga(function(tracker) {\n\t\t\t\ttracker = name ? window.ga.getByName(name) : tracker;\n\t\t\t\tthis.tracker = tracker;\n\t\t\t\tdeferred.resolve(tracker);\n\t\t\t}.bind(this));\n\n\t\t\tif (!options.skipView) {\n\t\t\t\tthis.sendView();\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Send a view using either sendScreenview (in 'app' mode) or sendPageview.\n\t\t *\n\t\t * @param {string} [name] The name of the view\n\t\t * @param {Object} [fields={}] An object containing one or more field/value pairs\n\t\t * @returns {Promise} Promise that resolves once the tracker has completed sending data\n\t\t */\n\t\tsendView: function(name, fields) {\n\t\t\tif (this.mode === 'app') {\n\t\t\t\treturn this.sendScreenview(name, fields);\n\t\t\t} else {\n\t\t\t\treturn this.sendPageview(name, null, fields);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Send an error using either sendException (in 'app' mode) or sendEvent.\n\t\t *\n\t\t * The error description is formatted by combining error name, message and location.\n\t\t * Error location is determined by examining error stack or falling back to document location.\n\t\t *\n\t\t * @param {Error} error The error to send\n\t\t * @param {boolean} [isFatal=false] Whether the error was fatal\n\t\t * @param {Object} [fields={}] An object containing one or more field/value pairs\n\t\t * @returns {Promise} Promise that resolves once the tracker has completed sending data\n\t\t */\n\t\tsendError: function(error, isFatal, fields) {\n\t\t\tfields = fields || {};\n\t\t\tvar loc = ((error.stack || '').match(/[^\\s\\(@]*(:\\d+)+/) || [])[0] || document.location;\n\t\t\tvar description = error.name + ': ' + error.message + ' [' + loc + ']';\n\t\t\tif (this.mode === 'app') {\n\t\t\t\treturn this.sendException(description, isFatal, fields);\n\t\t\t} else {\n\t\t\t\tfields.nonInteraction = true;\n\t\t\t\treturn this.sendEvent(isFatal ? 'fatal' : 'error', description, fields);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Send a pageview.\n\t\t *\n\t\t * @param {string} [page=pathname+search] The page path and query string (must start with a / character)\n\t\t * @param {string} [title=document.title] The title of the page\n\t\t * @param {Object} [fields={}] An object containing one or more field/value pairs\n\t\t * @param {string} [fields.location=protocol+'//'+hostname+pathname+search] URL of the page being tracked\n\t\t * @returns {Promise} Promise that resolves once the tracker has completed sending data\n\t\t */\n\t\tsendPageview: function(page, title, fields) {\n\t\t\tfields = fields || {};\n\t\t\tif (page) {\n\t\t\t\tfields.page = page;\n\t\t\t}\n\t\t\tif (title) {\n\t\t\t\tfields.title = title;\n\t\t\t}\n\t\t\treturn this.send('pageview', fields);\n\t\t},\n\n\t\t/**\n\t\t * Send an App screenview.\n\t\t *\n\t\t * @param {string} [name] The name of the screen\n\t\t * @param {Object} [fields={}] An object containing one or more field/value pairs\n\t\t * @returns {Promise} Promise that resolves once the tracker has completed sending data\n\t\t */\n\t\tsendScreenview: function(name, fields) {\n\t\t\tfields = fields || {};\n\t\t\tif (name) {\n\t\t\t\tfields.screenName = name;\n\t\t\t}\n\t\t\treturn this.send('screenview', fields);\n\t\t},\n\n\t\t/**\n\t\t * Send an App exception.\n\t\t *\n\t\t * @param {string} description The description of the exception\n\t\t * @param {boolean} [isFatal=false] Whether the exception was fatal\n\t\t * @param {Object} [fields={}] An object containing one or more field/value pairs\n\t\t * @returns {Promise} Promise that resolves once the tracker has completed sending data\n\t\t */\n\t\tsendException: function(description, isFatal, fields) {\n\t\t\tfields = fields || {};\n\t\t\tfields.exDescription = description;\n\t\t\tfields.exFatal = isFatal ? true : false;\n\t\t\treturn this.send('exception', fields);\n\t\t},\n\n\t\t/**\n\t\t * Measure amount of milliseconds it takes a promise to resolve and send it as user timing data.\n\t\t *\n\t\t * @param {Promise} promise Promise to time\n\t\t * @param {string} category A string for categorizing all user timing variables into logical groups\n\t\t * @param {string} variable A string to identify the variable being recorded. (e.g. JavaScript Load)\n\t\t * @param {number} value The number of milliseconds in elapsed time to report to Google Analytics\n\t\t * @param {Object} [fields={}] An object containing one or more field/value pairs\n\t\t * @param {string} [fields.timingLabel] Used to add flexibility in visualizing user timings in the reports\n\t\t * @returns {Promise} Original promise to facilitate chaining\n\t\t */\n\t\ttime: function(promise, category, variable, fields) {\n\t\t\tvar start = Date.now();\n\t\t\tpromise.then(function() {\n\t\t\t\tthis.sendTiming(category, variable, Date.now() - start, fields);\n\t\t\t}.bind(this));\n\t\t\treturn promise;\n\t\t},\n\n\t\t/**\n\t\t * Send user timing data.\n\t\t *\n\t\t * @param {string} category A string for categorizing all user timing variables into logical groups\n\t\t * @param {string} variable A string to identify the variable being recorded. (e.g. JavaScript Load)\n\t\t * @param {number} value The number of milliseconds in elapsed time to report to Google Analytics\n\t\t * @param {Object} [fields={}] An object containing one or more field/value pairs\n\t\t * @param {string} [fields.timingLabel] Used to add flexibility in visualizing user timings in the reports\n\t\t * @returns {Promise} Promise that resolves once the tracker has completed sending data\n\t\t */\n\t\tsendTiming: function(category, variable, value, fields) {\n\t\t\tfields = fields || {};\n\t\t\tfields.timingCategory = category;\n\t\t\tfields.timingVar = variable;\n\t\t\tfields.timingValue = value;\n\t\t\treturn this.send('timing', fields);\n\t\t},\n\n\t\t/**\n\t\t * Send an event.\n\t\t *\n\t\t * @param {string} category Typically the object that was interacted with (e.g. button)\n\t\t * @param {string} action The type of interaction (e.g. click)\n\t\t * @param {Object} [fields={}] An object containing one or more field/value pairs\n\t\t * @param {string} [fields.eventLabel] Useful for categorizing events (e.g. nav buttons)\n\t\t * @param {number} [fields.eventValue] Values must be non-negative. Useful to pass counts (e.g. 4 times)\n\t\t * @param {boolean} [fields.nonInteraction] Specifies that a hit be considered non-interactive\n\t\t * @returns {Promise} Promise that resolves once the tracker has completed sending data\n\t\t */\n\t\tsendEvent: function(category, action, fields) {\n\t\t\tfields = fields || {};\n\t\t\tfields.eventCategory = category;\n\t\t\tfields.eventAction = action;\n\t\t\treturn this.send('event', fields);\n\t\t},\n\n\t\t/**\n\t\t * Send a social interaction.\n\t\t *\n\t\t * @param {string} network The network on which the action occurs (e.g. Facebook, Twitter)\n\t\t * @param {string} action The type of action that happens (e.g. Like, Send, Tweet)\n\t\t * @param {string} target Specifies the target of a social interaction (e.g. URL)\n\t\t * @param {Object} [fields={}] An object containing one or more field/value pairs\n\t\t * @returns {Promise} Promise that resolves once the tracker has completed sending data\n\t\t */\n\t\tsendSocial: function(network, action, target, fields) {\n\t\t\tfields = fields || {};\n\t\t\tfields.socialNetwork = network;\n\t\t\tfields.socialAction = action;\n\t\t\tfields.socialTarget = target;\n\t\t\treturn this.send('social', fields);\n\t\t},\n\n\t\t/**\n\t\t * Returns a Promise of the value currently associated with the given field.\n\t\t *\n\t\t * TODO: Add reverse dimension and metric index mapping support?\n\t\t *\n\t\t * @param {string} fieldName Name of the field to retrieve\n\t\t * @returns {Promise} Promise of the value of the field\n\t\t */\n\t\tget: function(fieldName) {\n\t\t\treturn this.trackerPromise.then(function(tracker) {\n\t\t\t\treturn tracker.get(fieldName);\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Updates the value currently associated with the given field.\n\t\t *\n\t\t * This delegates to: {@link playtotv.analytics.GoogleAnalytics#setFields}\n\t\t *\n\t\t * @param {string} fieldName Name of the field to set\n\t\t * @param {string|number|Object} value New value to associate with the given field\n\t\t */\n\t\tset: function(fieldName, value) {\n\t\t\tvar fields = {};\n\t\t\tfields[fieldName] = value;\n\t\t\tthis.setFields(fields);\n\t\t},\n\n\t\t/**\n\t\t * Updates multiple field/value pairs.\n\t\t *\n\t\t * This calls: {@link playtotv.analytics.GoogleAnalytics#processFields} before setting.\n\t\t *\n\t\t * @param {Object} fields An object containing one or more field/value pairs to set\n\t\t */\n\t\tsetFields: function(fields) {\n\t\t\tfields = this.processFields(fields);\n\t\t\tthis.ga('set', fields);\n\t\t},\n\n\t\t/**\n\t\t * Returns a copy of fields with dimension and metric object properties replaced by\n\t\t * dimension1 and metric1 etc. properties based on dimensionMap and metricMap.\n\t\t *\n\t\t * @param {Object} fields An object containing one or more field/value pairs\n\t\t * @returns {Object} Field object with dimension and metric properties mapped to their indices\n\t\t */\n\t\tprocessFields: function(fields) {\n\t\t\tvar keys = [ 'dimension', 'metric' ];\n\t\t\tvar processed = ptv.omit(fields, keys);\n\t\t\tkeys.forEach(function(key) {\n\t\t\t\tvar map = this[key + 'Map'];\n\t\t\t\tptv.each(fields[key], function(value, name) {\n\t\t\t\t\tvar index = map[name];\n\t\t\t\t\tif (index) {\n\t\t\t\t\t\tprocessed[key + index] = value;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}, this);\n\t\t\treturn processed;\n\t\t},\n\n\t\t/**\n\t\t * Sends a tracking beacon to Google’s collection servers.\n\t\t *\n\t\t * The optional fields object allows users to override one or more field values for this hit only.\n\t\t *\n\t\t * A hitCallback field is automatically added to the fields to resolve the returned data sending Promise.\n\t\t *\n\t\t * This calls: {@link playtotv.analytics.GoogleAnalytics#processFields} before sending.\n\t\t *\n\t\t * @param {string} hitType The type of hit to send (pageview/event/social/timing/..)\n\t\t * @param {Object} [fields={}] An object containing one or more field/value pairs\n\t\t * @returns {Promise} Promise that resolves once the tracker has completed sending data\n\t\t */\n\t\tsend: function(hitType, fields) {\n\t\t\tfields = this.processFields(fields || {});\n\t\t\t// TODO: Rewrite without use of Promise.defer()\n\t\t\tvar deferred = Promise.defer();\n\t\t\tfields.hitCallback = deferred.resolve;\n\t\t\tthis.ga('send', hitType, fields);\n\t\t\treturn deferred.promise;\n\t\t},\n\n\t\t/**\n\t\t * Prefixes the first argument (method) and then applies arguments to window.ga().\n\t\t */\n\t\tga: function() {\n\t\t\tvar prefix = this.prefix;\n\t\t\tvar args = ptv.toArray(arguments);\n\t\t\tvar method = args.shift();\n\t\t\tlog.s(prefix + method, args);\n\t\t\targs.unshift(prefix + method);\n\t\t\twindow.ga.apply(window, args);\n\t\t}\n\t});\n});\n",
		"playtotv.define('playtotv.widget.Widget', [], function() {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar event = ptv.event;\n\n\treturn new ptv.Class({\n\t\t/** @lends playtotv.widget.Widget.prototype */\n\n\t\t/**\n\t\t * Widget Prototype, used as a super class to create specific widgets from.\n\t\t *\n\t\t * @constructs\n\t\t * @param {Node} node Node this widget is being instantiated on\n\t\t *\n\t\t * @property {Node} node Widget node\n\t\t * @property {Array} eventListeners Array of event listeners to automatically remove on dispose\n\t\t * @property {Array} subscriptionRecords Array of subscription records to automatically unsubscribe on dispose\n\t\t * @property {Array} timeoutIds Array of timeout id's to automatically remove on dispose\n\t\t */\n\t\tinitialize: function(node) {\n\t\t\tthis.node = node;\n\t\t\tthis.eventListeners = [];\n\t\t\tthis.subscriptionRecords = [];\n\t\t\tthis.timeoutIds = [];\n\t\t},\n\n\t\t/**\n\t\t * Returns the node represented by this widget instance\n\t\t *\n\t\t * @returns {Node} node\n\t\t */\n\t\tgetNode: function() {\n\t\t\treturn this.node;\n\t\t},\n\n\t\t/**\n\t\t * Adds an event listener of the given type to a Node and returns an {@link playtotv.event.EventListener} for\n\t\t * removal with {@link playtotv.widget.Widget#removeEventListener}. Listeners are added to the instance's\n\t\t * {@link playtotv.widget.Widget#eventListeners} array for automatic removal when widgets are disposed by\n\t\t * {@link playtotv.widget.Widget#dispose}.\n\t\t *\n\t\t * @param {Node} node Node to listen to\n\t\t * @param {string} type Type of events to listen to\n\t\t * @param {Function} listener Listener function to call on event\n\t\t * @returns {playtotv.event.EventListener} Object with node, type and listener references\n\t\t */\n\t\taddEventListener: function(node, type, listener) {\n\t\t\tvar eventListener = event.addListener(node, type, listener);\n\t\t\tthis.eventListeners.push(eventListener);\n\t\t\treturn eventListener;\n\t\t},\n\n\t\t/**\n\t\t * Removes an {@link playtotv.event.EventListener} listener from this widget provided it was added and\n\t\t * returned by {@link playtotv.widget.Widget#addEventListener}\n\t\t *\n\t\t * @param {playtotv.event.EventListener} eventListener\n\t\t * @returns {boolean} True if listener was successfully removed\n\t\t */\n\t\tremoveEventListener: function(eventListener) {\n\t\t\tvar eventListeners = this.eventListeners;\n\t\t\tvar index = eventListeners.indexOf(eventListener);\n\t\t\tvar found = index >= 0;\n\t\t\tif (found) {\n\t\t\t\tevent.removeListener(eventListener);\n\t\t\t\teventListeners.splice(index, 1);\n\t\t\t}\n\t\t\treturn found;\n\t\t},\n\n\t\t/**\n\t\t * Subscribe and add pubsub subscription record for automatic unsubscription on dispose.\n\t\t *\n\t\t * Note: All arguments beyond the first (e.g: selector and handler) are passed to the call made to\n\t\t * {@link playtotv.pubsub.PubSub#subscribe}, so calls like {@link playtotv.model.AbstractModel#subscribe}\n\t\t * with extra arguments can also be made through this.\n\t\t *\n\t\t * @param {playtotv.pubsub.PubSub} pubsub PubSub to subscribe to\n\t\t * @param {string} selector\n\t\t * @param {Function} handler\n\t\t * @returns {Object} Subscription record object with pubsub and subscription references\n\t\t */\n\t\tsubscribe: function(pubsub) {\n\t\t\tvar args = ptv.toArray(arguments).slice(1);\n\t\t\tvar record = {\n\t\t\t\tpubsub: pubsub,\n\t\t\t\tsubscription: pubsub.subscribe.apply(pubsub, args)\n\t\t\t};\n\t\t\tthis.subscriptionRecords.push(record);\n\t\t\treturn record;\n\t\t},\n\n\t\t/**\n\t\t * Unsubscribe and remove pubsub subscription.\n\t\t *\n\t\t * @param {Object} record Object with pubsub and subscription references\n\t\t * @returns {boolean} True if subscription was successfully removed\n\t\t */\n\t\tunsubscribe: function(record) {\n\t\t\tvar records = this.subscriptionRecords;\n\t\t\tvar index = records ? records.lastIndexOf(record) : -1;\n\t\t\tif (index === -1) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\trecords.splice(index, 1);\n\t\t\trecord.pubsub.unsubscribe(record.subscription);\n\t\t\tdelete record.pubsub;\n\t\t\tdelete record.subscription;\n\t\t\treturn true;\n\t\t},\n\n\t\t/**\n\t\t * Set a timeout for callback to called and remember the id for automatic clearing on dispose.\n\t\t *\n\t\t * @param {Function} callback Function to call\n\t\t * @param {number} ms Time in ms after which to call callback\n\t\t * @returns {number} Timeout id\n\t\t */\n\t\tsetTimeout: function(callback, ms) {\n\t\t\tvar id = setTimeout(callback, ms);\n\t\t\tthis.timeoutIds.push(id);\n\t\t\treturn id;\n\t\t},\n\n\t\t/**\n\t\t * Clear and remove timeout id.\n\t\t *\n\t\t * @param {number} id Object with pubsub and subscription references\n\t\t * @returns {boolean} True if subscription was successfully removed\n\t\t */\n\t\tclearTimeout: function(id) {\n\t\t\tvar timeoutIds = this.timeoutIds;\n\t\t\tvar index = timeoutIds.indexOf(id);\n\t\t\tvar found = index >= 0;\n\t\t\tif (found) {\n\t\t\t\tclearTimeout(id);\n\t\t\t\ttimeoutIds.splice(index, 1);\n\t\t\t}\n\t\t\treturn found;\n\t\t},\n\n\t\t/**\n\t\t * If a widget is created by a {@link playtotv.widget.WidgetManager} then the dispose method is called\n\t\t * before the widget's containing node is removed from the DOM. Dispose may be used to clean up event\n\t\t * listeners, and/or any other references that could potentially lead to memory leaks etc.\n\t\t *\n\t\t * This cleans up all event listeners, subscriptions and timeouts added by\n\t\t * {@link playtotv.widget.Widget#addEventListener}, {@link playtotv.widget.Widget#subscribe} and\n\t\t * {@link playtotv.widget.Widget#setTimeout}.\n\t\t */\n\t\tdispose: function() {\n\t\t\tthis.eventListeners.forEach(event.removeListener);\n\n\t\t\tthis.subscriptionRecords.forEach(function(record) {\n\t\t\t\trecord.pubsub.unsubscribe(record.subscription);\n\t\t\t\tdelete record.pubsub;\n\t\t\t\tdelete record.subscription;\n\t\t\t});\n\n\t\t\tthis.timeoutIds.forEach(clearTimeout);\n\n\t\t\tptv.dispose(this);\n\t\t}\n\t});\n});\n",
		"playtotv.define('playtotv.analytics.AnalyticsWidget', [\n\t'playtotv.widget.Widget'\n], function(\n\tWidget\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\n\t/**\n\t * Widget facilitating tracking of node insertion, and events through an AnalyticsController.\n\t *\n\t * Option values are split by separator (e.g: comma) in arguments (e.g: category, action, label).\n\t * Type of logging is equal to the option key or in case of key \"event\" to the first argument.\n\t * The action argument is optional and will default to type.\n\t * The label argument is optional and will default to undefined.\n\t *\n\t * Note: You will need to ensure that category, action and label values do not match the separator!\n\t *\n\t * @example\n\t * <span {{widgets (widget \"analytics-track\" view=\"question\")}}></span>\n\t * <div {{widgets (widget \"analytics-track\" load=\"banner\")}}> ..banner.. </div>\n\t * <div {{widgets (widget \"analytics-track\" click=\"answer\")}}> ..answer.. </div>\n\t * <form {{widgets (widget \"analytics-track\" submit=\"profile, update, avatar\")}}>..</form>\n\t * <input {{widgets (widget \"analytics-track\" change=\"rating\")}}>\n\t * <div {{widgets (widget \"analytics-track\" event=\"eventType, category, action, label\")}}>..</div>\n\t *\n\t * @extends playtotv.widget.Widget\n\t * @param {Node} node Widget node\n\t * @param {Object} options Widget options\n\t * @param {playtotv.analytics.AnalyticsController} options.controller AnalyticsController instance to use\n\t * @param {RegExp} [options.nonInteraction=/view|load/] Matching types are considered not to be interactions\n\t * @param {RegExp} [options.separator=/,\\s+/] Option value separator\n\t * @param {string} [options.view=''] \"[name]\" controller.view()\n\t * @param {string} [options.load=''] \"[category], [action], [label]\" controller.event() on load\n\t * @param {string} [options.click=''] \"[category], [action], [label]\" controller.event() on click events\n\t * @param {string} [options.submit=''] \"[category], [action], [label]\" controller.event() on submit events\n\t * @param {string} [options.change=''] \"[category], [action], [label]\" controller.event() on change events\n\t * @param {string} [options.event=''] \"[type], [category], [action], [label]\" controller.event() on type events\n\t */\n\treturn class AnalyticsWidget extends Widget {\n\n\t\tconstructor(node, options) {\n\t\t\toptions = ptv.params(options, {\n\t\t\t\tapp: null,\n\t\t\t\tcontroller: ptv.REQUIRED,\n\t\t\t\tnonInteraction: /view|load/,\n\t\t\t\tseparator: /,\\s+/,\n\t\t\t\tview: '',\n\t\t\t\tload: '',\n\t\t\t\tclick: '',\n\t\t\t\tsubmit: '',\n\t\t\t\tchange: '',\n\t\t\t\tevent: ''\n\t\t\t});\n\n\t\t\tvar controller = options.controller;\n\t\t\tvar nonInteractionRE = options.nonInteraction;\n\t\t\tvar separator = options.separator;\n\n\t\t\tsuper(node);\n\n\t\t\tvar eventOptions = ptv.omit(options, [ 'controller', 'nonInteraction', 'separator' ]);\n\t\t\tptv.each(eventOptions, (value, key) => {\n\t\t\t\tif (!value) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar parts = value.split(separator);\n\t\t\t\tvar type = key === 'event' ? parts.shift() : key;\n\t\t\t\tvar nonInteraction = nonInteractionRE.test(type);\n\n\t\t\t\tif (type === 'view') {\n\t\t\t\t\tcontroller.view(value, { nonInteraction: nonInteraction });\n\t\t\t\t} else {\n\t\t\t\t\tvar onEvent = function() {\n\t\t\t\t\t\tcontroller.event(parts[0], parts[1] || type, {\n\t\t\t\t\t\t\teventLabel: parts[2],\n\t\t\t\t\t\t\tnonInteraction: nonInteraction\n\t\t\t\t\t\t});\n\t\t\t\t\t};\n\t\t\t\t\tif (type === 'load') {\n\t\t\t\t\t\tonEvent();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.addEventListener(node, type, onEvent);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.animationFrame', [], function() {\n\n\t'use strict';\n\n\t// Abort if we are not running in a browser (e.g: in Node)\n\tif (typeof window === 'undefined') {\n\t\treturn;\n\t}\n\n\tvar request = window.requestAnimationFrame;\n\tvar cancel = window.cancelAnimationFrame;\n\n\tvar vendors = [ 'webkit', 'moz', 'ms', 'o' ];\n\tvar i, vendor, l = vendors.length;\n\tfor (i = 0; i < l && !request; i++) {\n\t\tvendor = vendors[i];\n\t\trequest = window[vendor + 'RequestAnimationFrame'];\n\t\tcancel = window[vendor + 'CancelAnimationFrame'] || window[vendor + 'CancelRequestAnimationFrame'];\n\t}\n\n\tvar callTime = 0;\n\n\trequest = request ? request.bind(window) : function(callback) {\n\t\tvar time = Date.now();\n\t\tvar delay = Math.max(0, 16 - (time - callTime));\n\n\t\tcallTime = time + delay;\n\t\treturn setTimeout(function() {\n\t\t\tcallback(callTime);\n\t\t}, delay);\n\t};\n\n\tcancel = cancel ? cancel.bind(window) : function(id) {\n\t\tclearTimeout(id);\n\t};\n\n\t/**\n\t * This module facilitates working with requestAnimationFrame, providing a 'shim' if necessary, but without\n\t * actually shimming window.requestAnimationFrame as that might have some averse side effects when combined with\n\t * other libraries.\n\t *\n\t * @name animationFrame\n\t * @memberOf playtotv\n\t * @namespace\n\t */\n\n\treturn /** @lends playtotv.animationFrame */ {\n\n\t\t/**\n\t\t * Either window.requestAnimationFrame, a vendor prefixed version or a shim.\n\t\t *\n\t\t * @function\n\t\t * @param {Function} callback\n\t\t * @returns {number} id\n\t\t */\n\t\trequest: request,\n\n\t\t/**\n\t\t * Either window.cancelAnimationFrame, a vendor prefixed version or a shim.\n\t\t *\n\t\t * @function\n\t\t * @param {number} id\n\t\t */\n\t\tcancel: cancel\n\t};\n});\n",
		"playtotv.define('playtotv.cookie', [], function() {\n\n\t'use strict';\n\n\t/**\n\t * Sets, gets or deletes cookies\n\t *\n\t * @name cookie\n\t * @namespace Cookie module. Sets, gets or deletes cookies\n\t * @memberOf playtotv\n\t */\n\tvar cookie = {\n\n\t\t/** @lends playtotv.cookie */\n\n\t\t/**\n\t\t * Gets a cookie value by name\n\t\t *\n\t\t * @param {string} name\n\t\t */\n\t\tget: function(name) {\n\t\t\tvar nameEQ = name + '=';\n\t\t\tvar ca = document.cookie.split(';');\n\n\t\t\tvar i, l = ca.length;\n\t\t\tfor (i = 0; i < l; i++) {\n\t\t\t\tvar c = ca[i];\n\t\t\t\twhile (c.charAt(0) === ' ') {\n\t\t\t\t\tc = c.substring(1, c.length);\n\t\t\t\t}\n\t\t\t\tif (c.indexOf(nameEQ) === 0) {\n\t\t\t\t\treturn c.substring(nameEQ.length, c.length);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn null;\n\t\t},\n\n\t\t/**\n\t\t * Sets a cookie\n\t\t *\n\t\t * @param {string} name\n\t\t * @param {string} value\n\t\t * @param {number} days to expire\n\t\t */\n\t\tset: function(name, value, days) {\n\t\t\tvar expires = '';\n\t\t\tif (days) {\n\t\t\t\tvar date = new Date();\n\t\t\t\tdate.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));\n\t\t\t\texpires = '; expires=' + date.toGMTString();\n\t\t\t}\n\t\t\tdocument.cookie = name + '=' + value + expires + '; path=/';\n\t\t},\n\n\t\t/**\n\t\t * Erases a cookie by name\n\t\t *\n\t\t * @param {string} name\n\t\t */\n\t\tremove: function(name) {\n\t\t\tthis.set(name, '', -1);\n\t\t}\n\t};\n\n\treturn cookie;\n});\n",
		"playtotv.define('playtotv.cron', [], function() {\n\n\t'use strict';\n\n\tvar log = playtotv.Logger.get(this.id);\n\n\tvar tickTimeout = null;\n\tvar tick;\n\tvar jobs = {};\n\tvar timeoutJobs = {};\n\tvar promisedJobs = {};\n\tvar id = 1;\n\n\tfunction now() {\n\t\treturn Date.now();\n\t}\n\n\tfunction labelledLog(msg, job) {\n\t\tif (!job.quiet) {\n\t\t\tlog.s('job #' + job.id + ' \"' + job.label + '\": ' + msg);\n\t\t}\n\t}\n\n\tfunction repeat(job) {\n\t\tlabelledLog('Scheduling repeat @ ' + job.time, job);\n\t\tjob.timeout = undefined;\n\t\tjob.time = now() + job.repeat;\n\t\tjobs[job.id] = job;\n\t\tif (!tickTimeout) {\n\t\t\ttick();\n\t\t}\n\t}\n\n\tfunction exec(id) {\n\t\tvar job;\n\t\tif ((job = timeoutJobs[id]) !== undefined) {\n\t\t\tdelete timeoutJobs[id];\n\t\t} else if ((job = jobs[id]) !== undefined) {\n\t\t\tdelete jobs[id];\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\n\t\tvar _now = now();\n\t\tvar delta = job.time - _now;\n\t\tdelta = delta < 0 ? delta : '+' + delta;\n\t\tlabelledLog('Executing @ ' + _now + ' (' + delta + 'ms)', job);\n\n\t\tpromisedJobs[id] = job;\n\t\tvar returnValueOrPromise = job.func.apply(job.context, job.args);\n\t\tPromise.resolve(returnValueOrPromise).then(function(returnValue) {\n\t\t\tif (promisedJobs[id]) { // ensure job still exists (e.g. has not been cancelled)\n\t\t\t\tdelete promisedJobs[id];\n\t\t\t\tif (job.repeat > 0 && returnValue !== false) {\n\t\t\t\t\trepeat(job);\n\t\t\t\t}\n\t\t\t}\n\t\t}, function() {\n\t\t\tdelete promisedJobs[id];\n\t\t});\n\t}\n\n\tfunction process(id) {\n\t\tvar job = jobs[id];\n\t\tif (!job) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar timeLeft = job.time - now();\n\n\t\tif (timeLeft <= 0) {\n\t\t\texec(id);\n\t\t} else if (timeLeft < cron.tickInterval) {\n\t\t\tdelete jobs[id];\n\t\t\ttimeoutJobs[id] = job;\n\t\t\tjob.timeout = setTimeout(function() {\n\t\t\t\texec(id);\n\t\t\t}, timeLeft);\n\t\t} // else execute in a future tick\n\t}\n\n\ttick = function() {\n\t\tif (tickTimeout) {\n\t\t\tclearTimeout(tickTimeout);\n\t\t\ttickTimeout = null;\n\t\t}\n\n\t\t// TODO: process jobs in order of job.time and then id\n\t\tObject.keys(jobs).forEach(process);\n\n\t\t// must check again, process deletes keys\n\t\tif (Object.keys(jobs).length > 0) {\n\t\t\ttickTimeout = setTimeout(tick, cron.tickInterval);\n\t\t}\n\t};\n\n\tfunction at(time, func, options) {\n\t\toptions = playtotv.extend({\n\t\t\tcontext: func,\n\t\t\targs: [],\n\t\t\trepeat: 0, // repeat job after specified amount of ms (cancel job to stop repeating)\n\t\t\tlabel: 'unlabeled', // to facilitate debugging\n\t\t\tquiet: false\n\t\t}, options);\n\n\t\tvar job = playtotv.extend({\n\t\t\tid: id,\n\t\t\ttime: time,\n\t\t\tfunc: func\n\t\t}, options);\n\n\t\tjobs[id++] = job;\n\t\tlog.s('at(): #' + job.id + ' \"' + job.label + '\"', job);\n\n\t\tif (options.repeat > 0 && options.repeat < cron.tickInterval) {\n\t\t\tcron.tickInterval = options.repeat;\n\t\t\tlog.d('Setting tick interval to ' + cron.tickInterval + ' to keep up with job #' + job.id + ' (' +\n\t\t\t\tjob.label + ')');\n\t\t}\n\n\t\t// Process as soon as possible, but still asynchronously (do not wait for next scheduled timeout)\n\t\tnextTick(tick);\n\n\t\treturn job.id;\n\t}\n\n\tfunction get(id) {\n\t\treturn jobs[id] || timeoutJobs[id] || promisedJobs[id];\n\t}\n\n\tfunction cancel(id) {\n\t\tvar job;\n\t\tif ((job = timeoutJobs[id]) !== undefined) {\n\t\t\tclearTimeout(job.timeout);\n\t\t\tdelete timeoutJobs[id];\n\t\t} else if ((job = promisedJobs[id]) !== undefined) {\n\t\t\tdelete promisedJobs[id];\n\t\t} else if ((job = jobs[id]) !== undefined) {\n\t\t\tdelete jobs[id];\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t\tlabelledLog('Cancelled', job);\n\t\treturn true;\n\t}\n\n\tfunction halt() {\n\t\tif (tickTimeout) {\n\t\t\tlog.s('Halting..');\n\n\t\t\tObject.keys(jobs).forEach(cancel);\n\t\t\tObject.keys(timeoutJobs).forEach(cancel);\n\t\t\tObject.keys(promisedJobs).forEach(cancel);\n\n\t\t\tclearTimeout(tickTimeout);\n\t\t\ttickTimeout = null;\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tvar cron = {\n\t\ttickInterval: 1000, // subject to change\n\t\tat: at,\n\t\tget: get,\n\t\tcancel: cancel,\n\t\thalt: halt,\n\t\tdebug: { // exposed for debugging purposes, do not abuse\n\t\t\tjobs: jobs,\n\t\t\ttimeoutJobs: timeoutJobs,\n\t\t\tpromisedJobs: promisedJobs\n\t\t}\n\t};\n\n\treturn cron;\n});\n",
		"playtotv.define('playtotv.css.Vector', [], function() {\n\n\t'use strict';\n\n\t/**\n\t * Shorthands\n\t *\n\t */\n\n\tvar _min = Math.min;\n\tvar _max = Math.max;\n\tvar _sqrt = Math.sqrt;\n\n\t/**\n\t * 2D Vector\n\t *\n\t * @name playtotv.css.Vector\n\t * @class\n\t * @constructor\n\t * @param {number} x\n\t * @param {number} y\n\t */\n\tvar Vector = new playtotv.Class({\n\t\tinitialize: function(x, y) {\n\t\t\tthis.x = x;\n\t\t\tthis.y = y;\n\t\t},\n\n\t\t/** @lends playtotv.css.Vector.prototype */\n\n\t\t/**\n\t\t * Adds a vector and returns the result.\n\t\t *\n\t\t * @param {playtotv.css.Vector} vector\n\t\t * @returns {playtotv.css.Vector} result\n\t\t */\n\t\tadd: function(v) {\n\t\t\treturn new Vector(this.x + v.x, this.y + v.y);\n\t\t},\n\n\t\t/**\n\t\t * Subtracts a vector and returns the result.\n\t\t *\n\t\t * @param {playtotv.css.Vector} vector\n\t\t * @returns {playtotv.css.Vector} result\n\t\t */\n\t\tsubtract: function(v) {\n\t\t\treturn new Vector(this.x - v.x, this.y - v.y);\n\t\t},\n\n\t\t/**\n\t\t * Multiplies with a vector and returns the result.\n\t\t *\n\t\t * @param {playtotv.css.Vector} vector\n\t\t * @returns {playtotv.css.Vector} result\n\t\t */\n\t\tmultiply: function(v) {\n\t\t\treturn new Vector(this.x * v.x, this.y * v.y);\n\t\t},\n\n\t\t/**\n\t\t * Returns a vector multiplied by a single number\n\t\t *\n\t\t * @param {number} value\n\t\t */\n\t\tmultiplyBy: function(n) {\n\t\t\treturn new Vector(this.x * n, this.y * n);\n\t\t},\n\n\t\t/**\n\t\t * Divides by a vector and returns the result.\n\t\t *\n\t\t * @param {playtotv.css.Vector} vector\n\t\t * @returns {playtotv.css.Vector} result\n\t\t */\n\t\tdivide: function(v) {\n\t\t\treturn new Vector(this.x / v.x, this.y / v.y);\n\t\t},\n\n\t\t/**\n\t\t * Returns a vector divided by a single number\n\t\t *\n\t\t * @param {playtotv.css.Vector} vector\n\t\t * @returns {playtotv.css.Vector} result\n\t\t */\n\t\tdivideBy: function(n) {\n\t\t\treturn new Vector(this.x / n, this.y / n);\n\t\t},\n\n\t\t/**\n\t\t * Returns the dot product with another vector\n\t\t *\n\t\t * @param {playtotv.css.Vector} vector\n\t\t * @returns {Float} dot\n\t\t */\n\t\tdot: function(b) {\n\t\t\tvar d = this.multiply(b);\n\t\t\treturn (d.x + d.y);\n\t\t},\n\n\t\t/**\n\t\t * Returns the vector's magnitude\n\t\t *\n\t\t * @param {playtotv.css.Vector} vector\n\t\t * @returns {Float} magnitude\n\t\t */\n\t\tmagnitude: function() {\n\t\t\tvar x = this.x;\n\t\t\tvar y = this.y;\n\t\t\treturn _sqrt(x * x + y * y);\n\t\t},\n\n\t\t/**\n\t\t * Returns a normalized version of this vector\n\t\t *\n\t\t * @param {playtotv.css.Vector} vector\n\t\t * @returns {playtotv.css.Vector} result\n\t\t */\n\t\tnormalize: function() {\n\t\t\tvar m = this.magnitude();\n\t\t\treturn new Vector(this.x / m, this.y / m);\n\t\t},\n\n\t\t/**\n\t\t * Returns the inversed version of this vector\n\t\t *\n\t\t */\n\t\tinverse: function() {\n\t\t\treturn new Vector(-this.x, -this.y);\n\t\t},\n\n\t\t/**\n\t\t * Returns modulo result with another vector\n\t\t *\n\t\t * @param {playtotv.css.Vector} vector\n\t\t * @returns {playtotv.css.Vector} result\n\t\t */\n\t\tmodulo: function(v) {\n\t\t\treturn new Vector(\n\t\t\t\tv.x ? this.x % v.x : this.x,\n\t\t\t\tv.y ? this.y % v.y : this.y\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Indicates whether a vector exceeds another one (in any 1 direction)\n\t\t *\n\t\t * @param {playtotv.css.Vector} vector\n\t\t * @returns {boolean} result\n\t\t */\n\t\texceeds: function(v) {\n\t\t\treturn this.x > v.x || this.y > v.y || false;\n\t\t},\n\n\t\t/**\n\t\t * Returns a vector with the smallest x and y values\n\t\t *\n\t\t * @param {playtotv.css.Vector} vector\n\t\t * @returns {playtotv.css.Vector} result\n\t\t */\n\t\tmin: function(v) {\n\t\t\treturn new Vector(\n\t\t\t\t_min(this.x, v.x),\n\t\t\t\t_min(this.y, v.y)\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Returns a vector with the largest x and y values\n\t\t *\n\t\t * @param {playtotv.css.Vector} vector\n\t\t * @returns {playtotv.css.Vector} result\n\t\t */\n\t\tmax: function(v) {\n\t\t\treturn new Vector(\n\t\t\t\t_max(this.x, v.x),\n\t\t\t\t_max(this.y, v.y)\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Limits a vector to x and y values that are within the given minimal and maximal boundary vectors.\n\t\t *\n\t\t * @param {playtotv.css.Vector} min\n\t\t * @param {playtotv.css.Vector} max\n\t\t * @returns {playtotv.css.Vector} limited\n\t\t */\n\t\tlimit: function(min, max) {\n\t\t\t// return this.max(min).min(max); // creates 2 Vector instances\n\t\t\treturn new Vector(\n\t\t\t\t_min(_max(this.x, min.x), max.x),\n\t\t\t\t_min(_max(this.y, min.y), max.y)\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Returns a comma separated string of the vector's x and y properties. An optional unit\n\t\t * type may be given (px, %, etc), which defaults to px for CSS purposes.\n\t\t *\n\t\t * @param {string} [unit='px']\n\t\t * @returns {string} position\n\t\t */\n\t\ttoString: function(unit) {\n\t\t\tunit = unit || 'px';\n\t\t\treturn this.x + unit + ',' + this.y + unit;\n\t\t}\n\t});\n\n\t// static Vector members\n\tplaytotv.extend(Vector, {\n\n\t\t/** @lends playtotv.css.Vector */\n\n\t\t/**\n\t\t * @property\n\t\t * @type number\n\t\t */\n\t\tFREE: 0,\n\n\t\t/**\n\t\t * @property\n\t\t * @type number\n\t\t */\n\t\tVERTICAL: 1,\n\n\t\t/**\n\t\t * @property\n\t\t * @type number\n\t\t */\n\t\tHORIZONTAL: 2,\n\n\t\t/**\n\t\t * @property\n\t\t * @type number\n\t\t */\n\t\tUP: 3,\n\n\t\t/**\n\t\t * @property\n\t\t * @type number\n\t\t */\n\t\tRIGHT: 4,\n\n\t\t/**\n\t\t * @property\n\t\t * @type number\n\t\t */\n\t\tDOWN: 5,\n\n\t\t/**\n\t\t * @property\n\t\t * @type number\n\t\t */\n\t\tLEFT: 6,\n\n\t\t/**\n\t\t * Zero vector\n\t\t * @property\n\t\t * @type Vector\n\t\t */\n\t\tZERO: new Vector(0, 0),\n\n\t\t/**\n\t\t * Parses values into a Vector. Uses x for y when not specified.\n\t\t *\n\t\t * @static\n\t\t * @param {string|number} x\n\t\t * @param {string|number} [y]\n\t\t * @returns {playtotv.css.Vector} vector\n\t\t */\n\t\tparseFloat: function(x, y) {\n\t\t\tx = parseFloat(x);\n\t\t\ty = arguments.length < 2 ? x : parseFloat(y);\n\t\t\treturn new Vector(x, y);\n\t\t}\n\t});\n\n\treturn Vector;\n});\n",
		"playtotv.define('playtotv.css.Point', [\n\t'playtotv.css.Vector'\n], function(\n\tVector\n) {\n\n\t'use strict';\n\n\t/**\n\t * 3D point, as returned by {@link playtotv.css.Matrix#transformPoint}.\n\t *\n\t * @name playtotv.css.Point\n\t * @class\n\t * @constructor\n\t * @param {number} x\n\t * @param {number} y\n\t * @param {number} z\n\t */\n\tvar Point = new playtotv.Class({\n\t\tinitialize: function(x, y, z) {\n\t\t\tthis.x = x;\n\t\t\tthis.y = y;\n\t\t\tthis.z = z;\n\t\t},\n\n\t\t/** @lends playtotv.css.Point.prototype */\n\n\t\t/**\n\t\t * Returns a 2D vector representation of this point, discarding the z.\n\t\t *\n\t\t * @returns {playtotv.css.Vector} vector\n\t\t */\n\t\ttoVector: function() {\n\t\t\treturn new Vector(this.x, this.y);\n\t\t}\n\t});\n\n\t/**\n\t * Parses values into a point. Uses x for y and/or z when not specified.\n\t *\n\t * @static\n\t * @function\n\t * @name parseFloat\n\t * @memberOf playtotv.css.Point\n\t * @param {string|number} x\n\t * @param {string|number} [y]\n\t * @param {string|number} [z]\n\t * @returns {playtotv.css.Point} point\n\t */\n\tPoint.parseFloat = function(x, y, z) {\n\t\tx = parseFloat(x);\n\t\ty = arguments.length < 2 ? x : parseFloat(y);\n\t\tz = arguments.length < 3 ? x : parseFloat(z);\n\t\treturn new Point(x, y, z);\n\t};\n\n\treturn Point;\n});\n",
		"playtotv.define('playtotv.css.Matrix', [\n\t'playtotv.css.Point'\n], function(\n\tPoint\n) {\n\n\t'use strict';\n\n\tvar IDENTITY = [\n\t\t1, 0, 0, 0,\n\t\t0, 1, 0, 0,\n\t\t0, 0, 1, 0,\n\t\t0, 0, 0, 1\n\t];\n\n\tvar entityMap = 'm11,m12,m13,m14,m21,m22,m23,m24,m31,m32,m33,m34,m41,m42,m43,m44'.split(',');\n\n\tvar regMatrix = /matrix3?d?\\(([^\\)]+)\\)/;\n\tfunction parseCSSMatrix(matrix) {\n\t\treturn regMatrix.test(matrix) ?\n\t\t\tregMatrix.exec(matrix)[1].split(',').map(parseFloat) : IDENTITY;\n\t}\n\n\t/**\n\t * CSS compatible 4x4 matrix, similar to the native WebKitCSSMatrix. Accepts a CSS transform string or entity\n\t * Array of a 6 or 16 entity matrix. If no value is given, an identity matrix is returned. The 2D matrix entities\n\t * are exposed as instance properties .a through .f, and the 3D entities as .m11 through .m44.\n\t *\n\t * @name playtotv.css.Matrix\n\t * @class\n\t * @constructor\n\t * @param {string|Array} [transform]\n\t */\n\tvar Matrix = new playtotv.Class({\n\t\tinitialize: function(matrix) {\n\t\t\tthis.setMatrixValue(matrix);\n\t\t},\n\n\t\t/** @lends playtotv.css.Matrix.prototype */\n\n\t\t/**\n\t\t * Sets the matrix value. Accepts a CSS transform string or entity Array of a 6 or 16 entity matrix.\n\t\t *\n\t\t * @param {string|Array} [transform]\n\t\t */\n\t\tsetMatrixValue: function(matrix) {\n\t\t\tvar m = (typeof matrix === 'string') ? parseCSSMatrix(matrix) : (matrix || IDENTITY);\n\t\t\tif (!(m instanceof Array)) {\n\t\t\t\tthrow new Error('Failed to parse ' + matrix);\n\t\t\t}\n\n\t\t\tthis.entities = m = (m.length === 6) ?\n\t\t\t\t[ m[0], m[1], 0, 0, m[2], m[3], 0, 0, 0, 0, 1, 0, m[4], m[5], 0, 1 ] : m;\n\n\t\t\t// 4x4 references\n\t\t\tentityMap.forEach(function(key, index) {\n\t\t\t\tthis[key] = m[index];\n\t\t\t}, this);\n\n\t\t\t// 2x2+2 references\n\t\t\tthis.a = this.m11;\n\t\t\tthis.b = this.m12;\n\t\t\tthis.c = this.m21;\n\t\t\tthis.d = this.m22;\n\t\t\tthis.e = this.m41;\n\t\t\tthis.f = this.m42;\n\t\t},\n\n\t\t/**\n\t\t * Returns the result of multiplying this matrix with the given one.\n\t\t *\n\t\t * @param {playtotv.css.Matrix} matrix\n\t\t * @returns {playtotv.css.Matrix} result\n\t\t */\n\t\tmultiply: function(matrix) {\n\t\t\tvar a = this.entities;\n\t\t\tvar b = (matrix instanceof Array) ? matrix : matrix.entities;\n\t\t\tvar i, j, k, m, entities = [];\n\t\t\tfor (i = 0; i < 4; i++) {\n\t\t\t\tfor (j = 0; j < 4; j++) {\n\t\t\t\t\tm = 0;\n\t\t\t\t\tfor (k = 0; k < 4; k++) {\n\t\t\t\t\t\tm += a[i * 4 + k] * b[k * 4 + j];\n\t\t\t\t\t}\n\t\t\t\t\tentities[i * 4 + j] = m;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn new Matrix(entities);\n\t\t},\n\n\t\t/**\n\t\t * Returns the result of translating this matrix over the given vector.\n\t\t *\n\t\t * @param {playtotv.css.Point|playtotv.css.Vector} translate\n\t\t * @returns {playtotv.css.Matrix} translated\n\t\t */\n\t\ttranslate: function(translate) {\n\t\t\tvar x = translate.x;\n\t\t\tvar y = translate.y;\n\t\t\tvar z = translate.z || 0;\n\t\t\treturn this.multiply([\n\t\t\t\t1, 0, 0, 0,\n\t\t\t\t0, 1, 0, 0,\n\t\t\t\t0, 0, 1, 0,\n\t\t\t\tx, y, z, 1\n\t\t\t]);\n\t\t},\n\n\t\t/**\n\t\t * Returns the result of scaling this matrix by the given number or vector.\n\t\t *\n\t\t * @param {number|playtotv.css.Point|playtotv.css.Vector} scale\n\t\t * @returns {playtotv.css.Matrix} result\n\t\t */\n\t\tscale: function(scale) {\n\t\t\tif (typeof scale === 'number') {\n\t\t\t\tscale = Point.parseFloat(scale);\n\t\t\t}\n\n\t\t\tvar x = scale.x;\n\t\t\tvar y = scale.y;\n\t\t\tvar z = scale.z || 1;\n\t\t\treturn this.multiply([\n\t\t\t\tx, 0, 0, 0,\n\t\t\t\t0, y, 0, 0,\n\t\t\t\t0, 0, z, 0,\n\t\t\t\t0, 0, 0, 1\n\t\t\t]);\n\t\t},\n\n\t\t/**\n\t\t * Returns the result of rotating this matrix over the given x, y and z angles.\n\t\t *\n\t\t * @param {number} x\n\t\t * @param {number} y\n\t\t * @param {number} z\n\t\t * @returns {playtotv.css.Matrix} rotated\n\t\t */\n\t\trotate: function(x, y, z) {\n\t\t\tx = x || 0;\n\t\t\ty = arguments.length < 2 ? x : y;\n\t\t\tz = arguments.length < 3 ? x : z;\n\t\t\treturn this.rotateX(x).rotateY(y).rotateZ(z);\n\t\t},\n\n\t\t/**\n\t\t * Returns the result of rotating this matrix over the X-axis by the given angle.\n\t\t *\n\t\t * @param {number} angle\n\t\t * @returns {playtotv.css.Matrix} rotated\n\t\t */\n\t\trotateX: function(angle) {\n\t\t\tvar c = Math.cos(angle);\n\t\t\tvar s = Math.sin(angle);\n\t\t\treturn this.multiply([\n\t\t\t\t1, 0,  0, 0,\n\t\t\t\t0, c, -s, 0,\n\t\t\t\t0, s,  c, 0,\n\t\t\t\t0, 0,  0, 1\n\t\t\t]);\n\t\t},\n\n\t\t/**\n\t\t * Returns the result of rotating this matrix over the Y-axis by the given angle.\n\t\t *\n\t\t * @param {number} angle\n\t\t * @returns {playtotv.css.Matrix} rotated\n\t\t */\n\t\trotateY: function(angle) {\n\t\t\tvar c = Math.cos(angle);\n\t\t\tvar s = Math.sin(angle);\n\t\t\treturn this.multiply([\n\t\t\t\t c, 0, s, 0,\n\t\t\t\t 0, 1, 0, 0,\n\t\t\t\t-s, 0, c, 0,\n\t\t\t\t 0, 0, 0, 1\n\t\t\t]);\n\t\t},\n\n\t\t/**\n\t\t * Returns the result of rotating this matrix over the Z-axis by the given angle. This is the axis over which\n\t\t * to rotate in 2D space.\n\t\t *\n\t\t * @param {number} angle\n\t\t * @returns {playtotv.css.Matrix} rotated\n\t\t */\n\t\trotateZ: function(angle) {\n\t\t\tvar c = Math.cos(angle);\n\t\t\tvar s = Math.sin(angle);\n\t\t\treturn this.multiply([\n\t\t\t\tc, -s, 0, 0,\n\t\t\t\ts,  c, 0, 0,\n\t\t\t\t0,  0, 1, 0,\n\t\t\t\t0,  0, 0, 1\n\t\t\t]);\n\t\t},\n\n\t\t/**\n\t\t * Returns the result of inversing this matrix. The inverse matrix returns the identity matrix when multiplied\n\t\t * with the original matrix.\n\t\t *\n\t\t * @returns {playtotv.css.Matrix} inversed\n\t\t */\n\t\tinverse: function() {\n\t\t\tvar m = this.entities;\n\t\t\tvar a = m[0];\n\t\t\tvar b = m[1];\n\t\t\tvar c = m[2];\n\t\t\tvar d = m[4];\n\t\t\tvar e = m[5];\n\t\t\tvar f = m[6];\n\t\t\tvar g = m[8];\n\t\t\tvar h = m[9];\n\t\t\tvar k = m[10];\n\n\t\t\tvar A = e * k - f * h;\n\t\t\tvar B = f * g - d * k;\n\t\t\tvar C = d * h - e * g;\n\t\t\tvar D = c * h - b * k;\n\t\t\tvar E = a * k - c * g;\n\t\t\tvar F = b * g - a * h;\n\t\t\tvar G = b * f - c * e;\n\t\t\tvar H = c * d - a * f;\n\t\t\tvar K = a * e - b * d;\n\n\t\t\tvar det = a * A + b * B + c * C;\n\n\t\t\tvar inverse = new Matrix([\n\t\t\t\tA / det, D / det, G / det, 0,\n\t\t\t\tB / det, E / det, H / det, 0,\n\t\t\t\tC / det, F / det, K / det, 0,\n\t\t\t\t0, 0, 0, 1\n\t\t\t]);\n\n\t\t\tvar translate = new Matrix([\n\t\t\t\t1, 0, 0, 0,\n\t\t\t\t0, 1, 0, 0,\n\t\t\t\t0, 0, 1, 0,\n\t\t\t\t-m[12], -m[13], -m[14], 1\n\t\t\t]);\n\n\t\t\treturn translate.multiply(inverse);\n\t\t},\n\n\t\t/**\n\t\t * Returns the result of transforming a vector using this matrix.\n\t\t *\n\t\t * @param {playtotv.css.Point|playtotv.css.Vector} point\n\t\t * @returns {playtotv.css.Point} transformed\n\t\t */\n\t\ttransformPoint: function(p) {\n\t\t\tvar m = this.entities;\n\t\t\tvar x = p.x;\n\t\t\tvar y = p.y;\n\t\t\tvar z = p.z || 0;\n\t\t\treturn new Point(\n\t\t\t\tm[0] * x + m[4] * y + m[8]  * z + m[12],\n\t\t\t\tm[1] * x + m[5] * y + m[9]  * z + m[13],\n\t\t\t\tm[2] * x + m[6] * y + m[10] * z + m[14]\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Returns a css compatible transform value of this matrix.\n\t\t *\n\t\t * @returns {string} transform\n\t\t */\n\t\ttoString: function() {\n\t\t\t// TODO: should this return a 2D transform if the input was?\n\t\t\treturn 'matrix3d(' + this.entities.toString() + ')';\n\t\t}\n\t});\n\n\treturn Matrix;\n});\n",
		"playtotv.define('playtotv.css.style', [\n\t'playtotv.css.Matrix',\n\t'playtotv.css.Vector'\n], function(\n\tMatrix,\n\tVector\n) {\n\t/*jshint maxcomplexity:100*/\n\n\t'use strict';\n\n\t// Abort if we are not running in a browser (e.g: in Node)\n\tif (typeof window === 'undefined') {\n\t\treturn;\n\t}\n\n\tvar ua = navigator.userAgent;\n\tvar browser = {\n\t\tgecko: /gecko\\//i.test(ua),\n\t\ttrident: /trident\\//i.test(ua),\n\t\twebkit: /webkit\\//i.test(ua),\n\t\tpresto: /presto\\//i.test(ua)\n\t};\n\n\tvar PRIORITY = '';\n\n\tvar prefix =\n\t\tbrowser.webkit ? '-webkit-' :\n\t\tbrowser.gecko ? '-moz-' :\n\t\tbrowser.presto ? '-o-' :\n\t\tbrowser.trident ? '-ms-' : '';\n\n\tvar cssTransform = prefix + 'transform';\n\tvar cssOrigin = prefix + 'transform-origin';\n\n\tvar webkitConvert = window.WebKitPoint && window.webkitConvertPointFromPageToNode;\n\n\t/**\n\t * Style modifications for nodes, including transforms and transitions\n\t *\n\t * @name style\n\t * @namespace\n\t * @memberOf playtotv.css\n\t */\n\tvar style = {\n\n\t\t/** @lends playtotv.css.style */\n\n\t\t/**\n\t\t * Sets a css property of a node's style to the given value.\n\t\t *\n\t\t * @function\n\t\t * @param {Node} node\n\t\t * @param {string} property\n\t\t * @param {string} value\n\t\t */\n\t\tset:\n\t\t\twindow.getComputedStyle ?\n\n\t\t\tfunction(node, property, value) {\n\t\t\t\tnode.style.setProperty(property, value, PRIORITY);\n\t\t\t} :\n\n\t\t\tfunction(node, property, value) {\n\t\t\t\tnode.style[property] = value;\n\t\t\t},\n\n\t\t/**\n\t\t * Attempts a variety of methods to retreive the calculated style property value of\n\t\t * a given node.\n\t\t *\n\t\t * @function\n\t\t * @param {Node} node\n\t\t * @param {string} property\n\t\t * @returns {string} value\n\t\t */\n\t\tget:\n\n\t\t\twindow.getComputedStyle ?\n\n\t\t\tfunction(node, property) {\n\t\t\t\tvar computed = window.getComputedStyle(node, null);\n\t\t\t\treturn computed.getPropertyValue(property);\n\t\t\t} :\n\n\t\t\tfunction(node, property) {\n\t\t\t\tvar computed = node.currentStyle || node.style;\n\t\t\t\treturn computed[property];\n\t\t\t},\n\n\t\t/**\n\t\t * Removes a style property from a node\n\t\t *\n\t\t * @function\n\t\t * @param {Node} node\n\t\t * @param {string} property\n\t\t */\n\t\tremove:\n\n\t\t\twindow.getComputedStyle ?\n\n\t\t\tfunction(node, property) {\n\t\t\t\tnode.style.removeProperty(property);\n\t\t\t} :\n\n\t\t\tfunction(node, property) {\n\t\t\t\tnode.style[property] = '';\n\t\t\t},\n\n\t\t/**\n\t\t * Returns the css vendor prefixed versions of a property. Note that it does not check if the property\n\t\t * requires one, it merely prefixes.\n\t\t *\n\t\t * @param {string} property\n\t\t * @returns {string} prefixed\n\t\t */\n\t\tprefix: function(property) {\n\t\t\treturn prefix + property || '';\n\t\t},\n\n\t\t// metrics\n\n\t\t/**\n\t\t * Calculates the size of a Node, and returns an Object with x and y properties. Though not a Vector itself,\n\t\t * the returned object is compatible with existing Vectors.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @returns {playtotv.css.Vector} size\n\t\t */\n\t\tgetSize: function(node) {\n\t\t\treturn new Vector(\n\t\t\t\tnode.offsetWidth,\n\t\t\t\tnode.offsetHeight\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Calculates the inner size of a Node, excluding borders, and returns a Vector compatible object with x and y\n\t\t * properties.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @returns {playtotv.css.Vector} size\n\t\t */\n\t\tgetInnerSize: function(node) {\n\t\t\treturn new Vector(\n\t\t\t\tnode.clientWidth,\n\t\t\t\tnode.clientHeight\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Calculates the offset of a Node, optionally in respect to a parent Node, and returns an object with x and y\n\t\t * properties. Though not a Vector itself, the returned object is compatible with existing Vectors.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {Node} parent\n\t\t * @returns {playtotv.css.Vector} offset\n\t\t */\n\t\tgetOffset: function(node, parent) {\n\t\t\tvar x = 0, y = 0;\n\t\t\twhile (node && (node !== parent)) {\n\t\t\t\tx += node.offsetLeft;\n\t\t\t\ty += node.offsetTop;\n\t\t\t\tnode = node.offsetParent;\n\t\t\t}\n\n\t\t\treturn new Vector(x, y);\n\t\t},\n\n\t\t/**\n\t\t * Converts a point from (local) node coordinate space to the same point in page coordinate space. This is\n\t\t * especially helpful when nodes have css transformations applied to them like scaling and rotation.\n\t\t * See also http://www.w3.org/TR/2009/WD-css3-2d-transforms-20090320/#dom-interfaces\n\t\t *\n\t\t * @function\n\t\t * @param {Node} node\n\t\t * @param {playtotv.css.Vector} vector\n\t\t */\n\t\tfromNodeToPage:\n\t\t\twebkitConvert ?\n\n\t\t\tfunction(node, vector) {\n\t\t\t\tvar point = new window.WebKitPoint(vector.x, vector.y);\n\t\t\t\tvar converted = window.webkitConvertPointFromNodeToPage(node, point);\n\t\t\t\treturn new Vector(converted.x, converted.y);\n\t\t\t} :\n\n\t\t\tfunction(node, vector) {\n\t\t\t\tvar transform = this.getFullTransform(node);\n\t\t\t\treturn transform.transformPoint(vector).toVector();\n\t\t\t},\n\n\t\t/**\n\t\t * Converts a point from page coordinate space to the same point in (local) node coordinate space. This is\n\t\t * especially helpful when nodes have css transformations applied to them like scaling and rotation.\n\t\t * See also http://www.w3.org/TR/2009/WD-css3-2d-transforms-20090320/#dom-interfaces\n\t\t *\n\t\t * @function\n\t\t * @param {Node} node\n\t\t * @param {playtotv.css.Vector} vector\n\t\t */\n\t\tfromPageToNode:\n\t\t\twebkitConvert ?\n\n\t\t\tfunction(node, vector) {\n\t\t\t\tvar point = new window.WebKitPoint(vector.x, vector.y);\n\t\t\t\tvar converted = window.webkitConvertPointFromPageToNode(node, point);\n\t\t\t\treturn new Vector(converted.x, converted.y);\n\t\t\t} :\n\n\t\t\tfunction(node, vector) {\n\t\t\t\tvar transform = this.getFullTransform(node);\n\t\t\t\treturn transform.inverse().transformPoint(vector).toVector();\n\t\t\t},\n\n\t\t// Matrices\n\n\t\t/**\n\t\t * Sets the node style's transform property (vendor specific if needed) to the given value.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {string|playtotv.css.Matrix} transform\n\t\t */\n\t\tsetTransform: function(node, transform) {\n\t\t\tif (transform instanceof Matrix) {\n\t\t\t\ttransform = transform.toString();\n\t\t\t}\n\t\t\tthis.set(node, cssTransform, transform);\n\t\t},\n\n\t\t/**\n\t\t * Returns a matrix representing the current node style's transform property value.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @returns {playtotv.css.Matrix} transform\n\t\t */\n\t\tgetTransform: function(node) {\n\t\t\tvar transform = this.get(node, cssTransform);\n\t\t\treturn new Matrix(transform);\n\t\t},\n\n\t\t/**\n\t\t * Removes any transforms on the given node's style.\n\t\t *\n\t\t * @param {Node} node\n\t\t */\n\t\tremoveTransform: function(node) {\n\t\t\tthis.remove(node, cssTransform);\n\t\t},\n\n\t\t/**\n\t\t * Returns a matrix representing the node's complete transformation (translation, scale and rotation) in\n\t\t * respect to the document's origin. This includes any transformations inherited from ascendant nodes.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @returns {playtotv.css.Matrix} transformation\n\t\t */\n\t\tgetFullTransform: function(node) {\n\t\t\tvar nodeTransform, transform = new Matrix();\n\t\t\twhile (node) {\n\t\t\t\tnodeTransform = this.getTransform(node);\n\t\t\t\tif (nodeTransform) {\n\t\t\t\t\tvar origin = this.getTransformOrigin(node);\n\t\t\t\t\tif (origin) {\n\t\t\t\t\t\tnodeTransform = new Matrix().\n\t\t\t\t\t\t\ttranslate(origin.inverse()).\n\t\t\t\t\t\t\tmultiply(nodeTransform).\n\t\t\t\t\t\t\ttranslate(origin);\n\t\t\t\t\t}\n\n\t\t\t\t\ttransform = transform.multiply(nodeTransform);\n\t\t\t\t}\n\n\t\t\t\ttransform = transform.translate(\n\t\t\t\t\tnew Vector(node.offsetLeft, node.offsetTop)\n\t\t\t\t);\n\n\t\t\t\tnode = node.offsetParent;\n\t\t\t}\n\n\t\t\treturn transform;\n\t\t},\n\n\t\t/**\n\t\t * Returns a vector representing the transformation origin of the given node.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @returns {playtotv.css.Vector} origin\n\t\t */\n\t\tgetTransformOrigin: function(node) {\n\t\t\tvar origin = (this.get(node, cssOrigin) || '0 0').split(' ');\n\t\t\treturn Vector.parseFloat(origin[0], origin[1]);\n\t\t},\n\n\t\t// Vectors\n\n\t\t/**\n\t\t * Sets the given node style's left and top position to the given vector.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {playtotv.css.Vector} position\n\t\t */\n\t\tsetPosition: function(node, vector) {\n\t\t\tvar css = node.style;\n\t\t\tcss.left = vector.x + 'px';\n\t\t\tcss.top = vector.y + 'px';\n\t\t},\n\n\t\t/**\n\t\t * Returns a vector representing the node style's left and top position.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @returns {playtotv.css.Vector} position\n\t\t */\n\t\tgetPosition: function(node) {\n\t\t\treturn Vector.parseFloat(\n\t\t\t\tthis.get(node, 'left'),\n\t\t\t\tthis.get(node, 'top')\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Moves a node by the given vector using translate3d.\n\t\t *\n\t\t * @function\n\t\t * @param {Node} node\n\t\t * @param {playtotv.css.Vector} translate\n\t\t */\n\t\tsetTranslate: function(node, vector) {\n\t\t\tthis.set(node, cssTransform, 'translate3d(' + vector + ',0)');\n\t\t},\n\n\t\t/**\n\t\t * Returns a vector representing the current translation of the given node.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @returns {playtotv.css.Vector} translate\n\t\t */\n\t\tgetTranslate: function(node) {\n\t\t\tvar transform = this.getTransform(node);\n\t\t\treturn transform.transformPoint(Vector.ZERO).toVector();\n\t\t}\n\t};\n\n\treturn style;\n});\n",
		"/**\n * Auto generated API: <tt>src/episode/episode-session-api.js</tt>\n *\n * <b>DO NOT MODIFY! CHANGES WILL BE OVERWRITTEN THE NEXT TIME YOU UPDATE!</b>\n *\n * <b>Note:</b> These are not real functions but method definitions for\n * {@link playtotv.server.Server#call}.\n *\n * @name episodeSessionAPI\n * @memberOf playtotv.episode\n * @namespace\n */\nplaytotv.define('playtotv.episode.episodeSessionAPI', [], function() {\n\n\t'use strict';\n\n\treturn {\n\t\t/*jshint maxlen:300*/ // On occassion generated lines can be too long\n\n\t\t/** @lends playtotv.episode.episodeSessionAPI */\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>id</b></li>\n\t\t * <li><i>{string}</i> <b>showId</b></li>\n\t\t * <li><i>{string}</i> <b>showName</b></li>\n\t\t * <li><i>{string}</i> <b>episodeCode</b></li>\n\t\t * <li><i>{number}</i> <b>createDate</b></li>\n\t\t * <li><i>{Long}</i> <b>phaseDates</b></li>\n\t\t * <li><i>{number}</i> <b>maxScore</b></li>\n\t\t * <li><i>{EpisodeSessionPhase}</i> <b>currentPhase</b> Valid values: 'UPCOMING', 'PROLOGUE', 'COUNTDOWN', 'BROADCAST', 'BROADCAST_ENDED', 'EPILOGUE', 'CLOSED'</li>\n\t\t * <li><i>{number}</i> <b>slaveOffset</b></li>\n\t\t * <li><i>{[string]}</i> <b>timeZones</b></li>\n\t\t * <li><i>{string}</i> <b>clientMetaData</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.episodeSessionId\n\t\t * @returns {Promise} Promise of response data (ClientEpisodeSessionNoStatesDTO)\n\t\t */\n\t\tget: {\n\t\t\tlabel: 'episodeSession.get',\n\t\t\turl: '1/episodesessions/{episodeSessionId}'\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>type</b></li>\n\t\t * <li><i>{string}</i> <b>interactionId</b></li>\n\t\t * <li><i>{EpisodeSessionPhase}</i> <b>phase</b> Valid values: 'UPCOMING', 'PROLOGUE', 'COUNTDOWN', 'BROADCAST', 'BROADCAST_ENDED', 'EPILOGUE', 'CLOSED'</li>\n\t\t * <li><i>{Object}</i> <b>data</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.episodeSessionId\n\t\t * @param {EpisodeSessionPhase} [params.phase] Valid values: 'UPCOMING', 'PROLOGUE', 'COUNTDOWN', 'BROADCAST', 'BROADCAST_ENDED', 'EPILOGUE', 'CLOSED'\n\t\t * @returns {Promise} Promise of response data (ClientEpisodeSessionAsyncDataItemDTO)\n\t\t */\n\t\tgetAsyncDataForEpisodeSession: {\n\t\t\tlabel: 'episodeSession.getAsyncDataForEpisodeSession',\n\t\t\turl: '1/episodesessions/{episodeSessionId}/async',\n\t\t\tqueryKeys: [\n\t\t\t\t'phase'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{[ClientEpisodeSessionStateChangeDTO]}</i> <b>stateChanges</b>\n\t\t * <ul>\n\t\t * <li><i>{StateChangeSubject}</i> <b>subject</b> Valid values: 'INTERACTION', 'PHASE', 'LEADERBOARD_UPDATED', 'LEADERBOARD_FINAL', 'PLACEHOLDER'</li>\n\t\t * <li><i>{string}</i> <b>type</b></li>\n\t\t * <li><i>{EpisodeSessionPhase}</i> <b>sessionPhase</b> Valid values: 'UPCOMING', 'PROLOGUE', 'COUNTDOWN', 'BROADCAST', 'BROADCAST_ENDED', 'EPILOGUE', 'CLOSED'</li>\n\t\t * <li><i>{string}</i> <b>interactionState</b></li>\n\t\t * <li><i>{number}</i> <b>time</b></li>\n\t\t * <li><i>{string}</i> <b>interactionId</b></li>\n\t\t * <li><i>{Long}</i> <b>duration</b></li>\n\t\t * <li><i>{Object}</i> <b>data</b></li>\n\t\t * <li><i>{number}</i> <b>version</b></li>\n\t\t * </ul></li>\n\t\t * <li><i>{number}</i> <b>version</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.episodeSessionId\n\t\t * @returns {Promise} Promise of response data (ClientEpisodeSessionStateAsChangesDTO)\n\t\t */\n\t\tgetEpisodeSessionStateAsChanges: {\n\t\t\tlabel: 'episodeSession.getEpisodeSessionStateAsChanges',\n\t\t\turl: '1/episodesessions/{episodeSessionId}/statechanges/active'\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{[ClientEpisodeSessionStateChangeDTO]}</i> <b>stateChanges</b>\n\t\t * <ul>\n\t\t * <li><i>{StateChangeSubject}</i> <b>subject</b> Valid values: 'INTERACTION', 'PHASE', 'LEADERBOARD_UPDATED', 'LEADERBOARD_FINAL', 'PLACEHOLDER'</li>\n\t\t * <li><i>{string}</i> <b>type</b></li>\n\t\t * <li><i>{EpisodeSessionPhase}</i> <b>sessionPhase</b> Valid values: 'UPCOMING', 'PROLOGUE', 'COUNTDOWN', 'BROADCAST', 'BROADCAST_ENDED', 'EPILOGUE', 'CLOSED'</li>\n\t\t * <li><i>{string}</i> <b>interactionState</b></li>\n\t\t * <li><i>{number}</i> <b>time</b></li>\n\t\t * <li><i>{string}</i> <b>interactionId</b></li>\n\t\t * <li><i>{Long}</i> <b>duration</b></li>\n\t\t * <li><i>{Object}</i> <b>data</b></li>\n\t\t * <li><i>{number}</i> <b>version</b></li>\n\t\t * </ul></li>\n\t\t * <li><i>{number}</i> <b>version</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.episodeSessionId\n\t\t * @param {number} params.sinceVersion\n\t\t * @returns {Promise} Promise of response data (ClientEpisodeSessionStateAsChangesDTO)\n\t\t */\n\t\tgetEpisodeSessionStateAsChangesSince: {\n\t\t\tlabel: 'episodeSession.getEpisodeSessionStateAsChangesSince',\n\t\t\turl: '1/episodesessions/{episodeSessionId}/statechanges/active/{sinceVersion}'\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{number}</i> <b>maxScore</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.episodeSessionId\n\t\t * @returns {Promise} Promise of response data (EpisodeSessionMaxScoreDTO)\n\t\t */\n\t\tgetMaxScore: {\n\t\t\tlabel: 'episodeSession.getMaxScore',\n\t\t\turl: '1/episodesessions/{episodeSessionId}/maxscore'\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>id</b></li>\n\t\t * <li><i>{string}</i> <b>showId</b></li>\n\t\t * <li><i>{string}</i> <b>showName</b></li>\n\t\t * <li><i>{string}</i> <b>episodeCode</b></li>\n\t\t * <li><i>{number}</i> <b>createDate</b></li>\n\t\t * <li><i>{Long}</i> <b>phaseDates</b></li>\n\t\t * <li><i>{number}</i> <b>maxScore</b></li>\n\t\t * <li><i>{EpisodeSessionPhase}</i> <b>currentPhase</b> Valid values: 'UPCOMING', 'PROLOGUE', 'COUNTDOWN', 'BROADCAST', 'BROADCAST_ENDED', 'EPILOGUE', 'CLOSED'</li>\n\t\t * <li><i>{number}</i> <b>slaveOffset</b></li>\n\t\t * <li><i>{[string]}</i> <b>timeZones</b></li>\n\t\t * <li><i>{string}</i> <b>clientMetaData</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} [params.timeZone]\n\t\t * @returns {Promise} Promise of response data (ClientEpisodeSessionNoStatesDTO)\n\t\t */\n\t\tgetNonClosedSessions: {\n\t\t\tlabel: 'episodeSession.getNonClosedSessions',\n\t\t\turl: '1/episodesessions/nonclosed',\n\t\t\tqueryKeys: [\n\t\t\t\t'timeZone'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>id</b></li>\n\t\t * <li><i>{string}</i> <b>showId</b></li>\n\t\t * <li><i>{string}</i> <b>showName</b></li>\n\t\t * <li><i>{string}</i> <b>episodeCode</b></li>\n\t\t * <li><i>{number}</i> <b>createDate</b></li>\n\t\t * <li><i>{Long}</i> <b>phaseDates</b></li>\n\t\t * <li><i>{number}</i> <b>maxScore</b></li>\n\t\t * <li><i>{EpisodeSessionPhase}</i> <b>currentPhase</b> Valid values: 'UPCOMING', 'PROLOGUE', 'COUNTDOWN', 'BROADCAST', 'BROADCAST_ENDED', 'EPILOGUE', 'CLOSED'</li>\n\t\t * <li><i>{number}</i> <b>slaveOffset</b></li>\n\t\t * <li><i>{[string]}</i> <b>timeZones</b></li>\n\t\t * <li><i>{string}</i> <b>clientMetaData</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.showId\n\t\t * @param {string} [params.timeZone]\n\t\t * @returns {Promise} Promise of response data (ClientEpisodeSessionNoStatesDTO)\n\t\t */\n\t\tgetNonClosedSessionsForShow: {\n\t\t\tlabel: 'episodeSession.getNonClosedSessionsForShow',\n\t\t\turl: '1/episodesessions/show/{showId}/nonclosed',\n\t\t\tqueryKeys: [\n\t\t\t\t'timeZone'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>id</b></li>\n\t\t * <li><i>{string}</i> <b>showId</b></li>\n\t\t * <li><i>{string}</i> <b>showName</b></li>\n\t\t * <li><i>{string}</i> <b>episodeCode</b></li>\n\t\t * <li><i>{number}</i> <b>createDate</b></li>\n\t\t * <li><i>{Long}</i> <b>phaseDates</b></li>\n\t\t * <li><i>{number}</i> <b>maxScore</b></li>\n\t\t * <li><i>{EpisodeSessionPhase}</i> <b>currentPhase</b> Valid values: 'UPCOMING', 'PROLOGUE', 'COUNTDOWN', 'BROADCAST', 'BROADCAST_ENDED', 'EPILOGUE', 'CLOSED'</li>\n\t\t * <li><i>{number}</i> <b>slaveOffset</b></li>\n\t\t * <li><i>{[string]}</i> <b>timeZones</b></li>\n\t\t * <li><i>{string}</i> <b>clientMetaData</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.showName\n\t\t * @param {string} [params.timeZone]\n\t\t * @returns {Promise} Promise of response data (ClientEpisodeSessionNoStatesDTO)\n\t\t */\n\t\tgetNonClosedSessionsForShowByName: {\n\t\t\tlabel: 'episodeSession.getNonClosedSessionsForShowByName',\n\t\t\turl: '1/episodesessions/show/byname/{showName}/nonclosed',\n\t\t\tqueryKeys: [\n\t\t\t\t'timeZone'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>id</b></li>\n\t\t * <li><i>{string}</i> <b>showId</b></li>\n\t\t * <li><i>{string}</i> <b>showName</b></li>\n\t\t * <li><i>{string}</i> <b>episodeCode</b></li>\n\t\t * <li><i>{number}</i> <b>createDate</b></li>\n\t\t * <li><i>{Long}</i> <b>phaseDates</b></li>\n\t\t * <li><i>{number}</i> <b>maxScore</b></li>\n\t\t * <li><i>{EpisodeSessionPhase}</i> <b>currentPhase</b> Valid values: 'UPCOMING', 'PROLOGUE', 'COUNTDOWN', 'BROADCAST', 'BROADCAST_ENDED', 'EPILOGUE', 'CLOSED'</li>\n\t\t * <li><i>{number}</i> <b>slaveOffset</b></li>\n\t\t * <li><i>{[string]}</i> <b>timeZones</b></li>\n\t\t * <li><i>{string}</i> <b>clientMetaData</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {EpisodeSessionPhase} params.state Valid values: 'UPCOMING', 'PROLOGUE', 'COUNTDOWN', 'BROADCAST', 'BROADCAST_ENDED', 'EPILOGUE', 'CLOSED'\n\t\t * @param {string} [params.timeZone]\n\t\t * @returns {Promise} Promise of response data (ClientEpisodeSessionNoStatesDTO)\n\t\t */\n\t\tgetSessionsInPhase: {\n\t\t\tlabel: 'episodeSession.getSessionsInPhase',\n\t\t\turl: '1/episodesessions/state/{state}',\n\t\t\tqueryKeys: [\n\t\t\t\t'timeZone'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>id</b></li>\n\t\t * <li><i>{string}</i> <b>showId</b></li>\n\t\t * <li><i>{string}</i> <b>showName</b></li>\n\t\t * <li><i>{string}</i> <b>episodeCode</b></li>\n\t\t * <li><i>{number}</i> <b>createDate</b></li>\n\t\t * <li><i>{Long}</i> <b>phaseDates</b></li>\n\t\t * <li><i>{number}</i> <b>maxScore</b></li>\n\t\t * <li><i>{EpisodeSessionPhase}</i> <b>currentPhase</b> Valid values: 'UPCOMING', 'PROLOGUE', 'COUNTDOWN', 'BROADCAST', 'BROADCAST_ENDED', 'EPILOGUE', 'CLOSED'</li>\n\t\t * <li><i>{number}</i> <b>slaveOffset</b></li>\n\t\t * <li><i>{[string]}</i> <b>timeZones</b></li>\n\t\t * <li><i>{string}</i> <b>clientMetaData</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.showId\n\t\t * @param {EpisodeSessionPhase} params.state Valid values: 'UPCOMING', 'PROLOGUE', 'COUNTDOWN', 'BROADCAST', 'BROADCAST_ENDED', 'EPILOGUE', 'CLOSED'\n\t\t * @param {string} [params.timeZone]\n\t\t * @returns {Promise} Promise of response data (ClientEpisodeSessionNoStatesDTO)\n\t\t */\n\t\tgetSessionsInPhaseForShow: {\n\t\t\tlabel: 'episodeSession.getSessionsInPhaseForShow',\n\t\t\turl: '1/episodesessions/show/{showId}/state/{state}',\n\t\t\tqueryKeys: [\n\t\t\t\t'timeZone'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>id</b></li>\n\t\t * <li><i>{string}</i> <b>showId</b></li>\n\t\t * <li><i>{string}</i> <b>showName</b></li>\n\t\t * <li><i>{string}</i> <b>episodeCode</b></li>\n\t\t * <li><i>{number}</i> <b>createDate</b></li>\n\t\t * <li><i>{Long}</i> <b>phaseDates</b></li>\n\t\t * <li><i>{number}</i> <b>maxScore</b></li>\n\t\t * <li><i>{EpisodeSessionPhase}</i> <b>currentPhase</b> Valid values: 'UPCOMING', 'PROLOGUE', 'COUNTDOWN', 'BROADCAST', 'BROADCAST_ENDED', 'EPILOGUE', 'CLOSED'</li>\n\t\t * <li><i>{number}</i> <b>slaveOffset</b></li>\n\t\t * <li><i>{[string]}</i> <b>timeZones</b></li>\n\t\t * <li><i>{string}</i> <b>clientMetaData</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.showName\n\t\t * @param {EpisodeSessionPhase} params.state Valid values: 'UPCOMING', 'PROLOGUE', 'COUNTDOWN', 'BROADCAST', 'BROADCAST_ENDED', 'EPILOGUE', 'CLOSED'\n\t\t * @param {string} [params.timeZone]\n\t\t * @returns {Promise} Promise of response data (ClientEpisodeSessionNoStatesDTO)\n\t\t */\n\t\tgetSessionsInPhaseForShowByName: {\n\t\t\tlabel: 'episodeSession.getSessionsInPhaseForShowByName',\n\t\t\turl: '1/episodesessions/show/byname/{showName}/state/{state}',\n\t\t\tqueryKeys: [\n\t\t\t\t'timeZone'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>episodeSessionId</b></li>\n\t\t * <li><i>{number}</i> <b>newUsers</b></li>\n\t\t * <li><i>{number}</i> <b>returningUsers</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.episodeSessionId\n\t\t * @returns {Promise} Promise of response data (EpisodeSessionUserStatisticsDTO)\n\t\t */\n\t\tgetUserStatistics: {\n\t\t\tlabel: 'episodeSession.getUserStatistics',\n\t\t\turl: '1/episodesessions/{episodeSessionId}/users'\n\t\t},\n\n\t\t/**\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.episodeSessionId\n\t\t * @returns {Promise} Promise of response data (Object)\n\t\t */\n\t\tjoin: {\n\t\t\tlabel: 'episodeSession.join',\n\t\t\turl: '1/episodesessions/{episodeSessionId}',\n\t\t\ttype: 'PUT'\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{ClientEpisodeSessionNoStatesDTO}</i> <b>episodeSession</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>id</b></li>\n\t\t * <li><i>{string}</i> <b>showId</b></li>\n\t\t * <li><i>{string}</i> <b>showName</b></li>\n\t\t * <li><i>{string}</i> <b>episodeCode</b></li>\n\t\t * <li><i>{number}</i> <b>createDate</b></li>\n\t\t * <li><i>{Long}</i> <b>phaseDates</b></li>\n\t\t * <li><i>{number}</i> <b>maxScore</b></li>\n\t\t * <li><i>{EpisodeSessionPhase}</i> <b>currentPhase</b> Valid values: 'UPCOMING', 'PROLOGUE', 'COUNTDOWN', 'BROADCAST', 'BROADCAST_ENDED', 'EPILOGUE', 'CLOSED'</li>\n\t\t * <li><i>{number}</i> <b>slaveOffset</b></li>\n\t\t * <li><i>{[string]}</i> <b>timeZones</b></li>\n\t\t * <li><i>{string}</i> <b>clientMetaData</b></li>\n\t\t * </ul></li>\n\t\t * <li><i>{ClientEpisodeSessionStateAsChangesDTO}</i> <b>state</b>\n\t\t * <ul>\n\t\t * <li><i>{[ClientEpisodeSessionStateChangeDTO]}</i> <b>stateChanges</b>\n\t\t * <ul>\n\t\t * <li><i>{StateChangeSubject}</i> <b>subject</b> Valid values: 'INTERACTION', 'PHASE', 'LEADERBOARD_UPDATED', 'LEADERBOARD_FINAL', 'PLACEHOLDER'</li>\n\t\t * <li><i>{string}</i> <b>type</b></li>\n\t\t * <li><i>{EpisodeSessionPhase}</i> <b>sessionPhase</b> Valid values: 'UPCOMING', 'PROLOGUE', 'COUNTDOWN', 'BROADCAST', 'BROADCAST_ENDED', 'EPILOGUE', 'CLOSED'</li>\n\t\t * <li><i>{string}</i> <b>interactionState</b></li>\n\t\t * <li><i>{number}</i> <b>time</b></li>\n\t\t * <li><i>{string}</i> <b>interactionId</b></li>\n\t\t * <li><i>{Long}</i> <b>duration</b></li>\n\t\t * <li><i>{Object}</i> <b>data</b></li>\n\t\t * <li><i>{number}</i> <b>version</b></li>\n\t\t * </ul></li>\n\t\t * <li><i>{number}</i> <b>version</b></li>\n\t\t * </ul></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} [params.showName]\n\t\t * @param {string} [params.showId]\n\t\t * @param {string} [params.episodeSessionId]\n\t\t * @param {string} [params.timeZone]\n\t\t * @returns {Promise} Promise of response data (CurrentEpisodeSessionDTO)\n\t\t */\n\t\tjoinAndGetState: {\n\t\t\tlabel: 'episodeSession.joinAndGetState',\n\t\t\turl: '1/episodesessions/joinandgetstate',\n\t\t\ttype: 'PUT',\n\t\t\tqueryKeys: [\n\t\t\t\t'showName',\n\t\t\t\t'showId',\n\t\t\t\t'episodeSessionId',\n\t\t\t\t'timeZone'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>id</b></li>\n\t\t * <li><i>{string}</i> <b>showId</b></li>\n\t\t * <li><i>{string}</i> <b>showName</b></li>\n\t\t * <li><i>{string}</i> <b>episodeCode</b></li>\n\t\t * <li><i>{number}</i> <b>createDate</b></li>\n\t\t * <li><i>{Long}</i> <b>phaseDates</b></li>\n\t\t * <li><i>{number}</i> <b>maxScore</b></li>\n\t\t * <li><i>{EpisodeSessionPhase}</i> <b>currentPhase</b> Valid values: 'UPCOMING', 'PROLOGUE', 'COUNTDOWN', 'BROADCAST', 'BROADCAST_ENDED', 'EPILOGUE', 'CLOSED'</li>\n\t\t * <li><i>{number}</i> <b>slaveOffset</b></li>\n\t\t * <li><i>{[string]}</i> <b>timeZones</b></li>\n\t\t * <li><i>{string}</i> <b>clientMetaData</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.showId\n\t\t * @param {string} params.episodeCode\n\t\t * @param {number} params.msSinceSessionStart\n\t\t * @param {number} params.timeWindow\n\t\t * @param {boolean} params.createIfNoneAvailable\n\t\t * @returns {Promise} Promise of response data (ClientEpisodeSessionNoStatesDTO)\n\t\t */\n\t\tjoinInSync: {\n\t\t\tlabel: 'episodeSession.joinInSync',\n\t\t\turl: '1/episodesessions/show/{showId}/episode/{episodeCode}/joinInSync',\n\t\t\ttype: 'PUT',\n\t\t\tdataKeys: [\n\t\t\t\t'msSinceSessionStart',\n\t\t\t\t'timeWindow',\n\t\t\t\t'createIfNoneAvailable'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.episodeSessionId\n\t\t * @returns {Promise} Promise of response data (Object)\n\t\t */\n\t\tleave: {\n\t\t\tlabel: 'episodeSession.leave',\n\t\t\turl: '1/episodesessions/{episodeSessionId}',\n\t\t\ttype: 'DELETE'\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.facebook.FacebookAdapter', [], function() {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\n\treturn new ptv.Class({\n\t\t/** @lends playtotv.facebook.FacebookAdapter.prototype */\n\n\t\t/**\n\t\t * Adapter between {@link playtotv.facebook.Facebook} and PlayToTV API call parameters.\n\t\t *\n\t\t * @constructs\n\t\t * @param {playtotv.facebook.Facebook} facebook Facebook instance to use\n\t\t */\n\t\tinitialize: function(facebook) {\n\t\t\tthis.facebook = facebook;\n\t\t},\n\n\t\t/**\n\t\t * Returns a params object to pass to {@link playtotv.user.UserManager#loginByFacebook}.\n\t\t *\n\t\t * In addition to the basic PlayToTV user properties, all of the Facebook user data is returned as private\n\t\t * properties for advanced usage purposes. This enables you to use Facebook's extended \"scope\" properties like\n\t\t * email. Please note that PlayToTV property values are strings, so any object values are JSON stringified.\n\t\t *\n\t\t * Note: Picture size URL parameters can optionally be appended to resulting avatarUrl:\n\t\t * <a href=\"http://developers.facebook.com/docs/reference/api/using-pictures/#sizes\">Pictures API</a>\n\t\t *\n\t\t * @param {boolean} [interactive] {@link playtotv.facebook.Facebook#login} interactive\n\t\t * @param {number} [timeout] {@link playtotv.facebook.Facebook#call} timeout for fetching Facebook name\n\t\t * @return {Promise} Promise of params object\n\t\t */\n\t\tgetLoginParams: function(interactive, timeout) {\n\t\t\tvar facebook = this.facebook;\n\t\t\treturn facebook.login(interactive).then(function(id) {\n\t\t\t\treturn facebook.call('api', timeout, '/me').then(function(data) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tfacebookId: id,\n\t\t\t\t\t\tfbsr: facebook.signedRequest,\n\t\t\t\t\t\tdisplayName: data.name,\n\t\t\t\t\t\tavatarUrl: '//graph.facebook.com/' + id + '/picture',\n\t\t\t\t\t\tprivateProperties: Object.keys(data).reduce(function(props, key) {\n\t\t\t\t\t\t\tvar value = data[key];\n\t\t\t\t\t\t\tprops[key] = typeof value === 'object' ? JSON.stringify(value) : value;\n\t\t\t\t\t\t\treturn props;\n\t\t\t\t\t\t}, {})\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Returns a params object to pass to {@link playtotv.user.UserManager#addFacebookCredentials}.\n\t\t *\n\t\t * @param {boolean} [interactive] {@link playtotv.facebook.Facebook#login} interactive\n\t\t * @return {Promise} Promise of params object\n\t\t */\n\t\tgetCredentialParams: function(interactive) {\n\t\t\tvar facebook = this.facebook;\n\t\t\treturn facebook.login(interactive).then(function(id) {\n\t\t\t\treturn {\n\t\t\t\t\tfacebookId: id,\n\t\t\t\t\tfbsr: facebook.signedRequest\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\t});\n});\n",
		"playtotv.define('playtotv.facebook.FacebookPostWidget', [ 'playtotv.widget.Widget' ], function(Widget) {\n\n\t'use strict';\n\n\tvar ATTR_PREFIX = 'data-facebook-';\n\n\tvar log = playtotv.Logger.get(this.id);\n\n\treturn new playtotv.Class({\n\t\t/** @lends playtotv.facebook.FacebookPostWidget.prototype */\n\n\t\textend: Widget,\n\n\t\t/**\n\t\t * Widget that facilitates making a Facebook post when a user clicks on a node.\n\t\t *\n\t\t * Content parameters:\n\t\t * <ul>\n\t\t * <li><a href=\"http://developers.facebook.com/docs/reference/dialogs/feed/\">Facebook documentation</a>\n\t\t * <li>Can be defined using options.content and overridden using data-facebook-* attributes\n\t\t * <li>Values will be processed at post time by options.process, allowing for substitutions etc.\n\t\t * </ul>\n\t\t *\n\t\t * Note: If you do not post interactively you should use onPost to show a confirmation to the user!\n\t\t *\n\t\t * @constructs\n\t\t * @extends playtotv.widget.Widget\n\t\t * @param {Node} node\n\t\t * @param {Options} options\n\t\t * @param {playtotv.facebook.Facebook} options.facebook Facebook instance to use\n\t\t * @param {boolean} [options.interactive=true] {@link playtotv.facebook.Facebook#post} interactive\n\t\t * @param {number} [options.timeout] {@link playtotv.facebook.Facebook#post} timeout\n\t\t * @param {string} [options.content={}] Default post content params (e.g. name, link, etc.)\n\t\t * @param {Function} [options.process] Content processing function which is passed (value, key)\n\t\t * @param {Function} [options.onResolve] Function to be called each time a post successfully resolves\n\t\t * @param {Function} [options.onReject] Function to be called each time a post is rejected (e.g. cancelled)\n\t\t */\n\t\tinitialize: function(node, options) {\n\t\t\tthis._super(node);\n\t\t\tthis.options = playtotv.params(options, {\n\t\t\t\tfacebook: playtotv.REQUIRED,\n\t\t\t\tinteractive: true,\n\t\t\t\ttimeout: undefined,\n\t\t\t\tcontent: {},\n\t\t\t\tprocess: function(value /*, key*/) { return value; }, // leave as-is by default\n\t\t\t\tonResolve: function(postId) { log.d('onResolve, post id:', postId); },\n\t\t\t\tonReject: function(reason) { log.d('onReject', reason); }\n\t\t\t});\n\t\t\tthis.addEventListener(node, 'click', this.onClick);\n\t\t},\n\n\t\tonClick: function(e) {\n\t\t\te.preventDefault();\n\t\t\tthis.post();\n\t\t\treturn false;\n\t\t},\n\n\t\tpost: function() {\n\t\t\tvar node = this.node;\n\t\t\tvar options = this.options;\n\t\t\tvar facebook = options.facebook;\n\n\t\t\tvar content = playtotv.extend({}, options.content);\n\n\t\t\tplaytotv.toArray(node.attributes).forEach(function(attr) {\n\t\t\t\tif (attr.name.indexOf(ATTR_PREFIX) === 0) {\n\t\t\t\t\tcontent[attr.name.substr(ATTR_PREFIX.length)] = attr.value;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tplaytotv.each(content, function(value, key) {\n\t\t\t\tcontent[key] = options.process(content[key], key);\n\t\t\t});\n\n\t\t\tfacebook.post(content, options.interactive, options.timeout).then(options.onResolve, options.onReject);\n\t\t},\n\n\t\tcallbacks: [\n\t\t\t'onClick'\n\t\t]\n\t});\n});\n",
		"playtotv.define('playtotv.fx.Animation', [\n\t'playtotv.animationFrame'\n], function(\n\tanimationFrame\n) {\n\t'use strict';\n\n\t/**\n\t * Animation super class. Increments an animation fraction from 0 to 1 over a given duration, and passes the\n\t * current value to the onFrame function using a requestAnimationFrame callback. The onFrame function MUST be\n\t * implemented by subclasses. Super class for {@link playtotv.fx.Transition} and {@link playtotv.fx.Timeline}.\n\t *\n\t * @name Animation\n\t * @class\n\t * @memberOf playtotv.fx\n\t * @param {Object} options\n\t * @param {boolean} [options.alternate=false] Whether an animation with multiple cycles alternates direction\n\t * @param {number} [options.cycles=1] Amount of repeating animation cycles\n\t * @param {number} [options.duration=1000] Duration of one animation cycle in ms\n\t * @param {number} [options.fps=0] Fps limit on requestAnimationFrame callbacks\n\t * @param {number} [options.rate=1] Time rate multiplier\n\t * @param {number} [options.start] Alternate start timestamp in ms; past starts mid-animation, future delays start\n\t */\n\tvar Animation = new playtotv.Class({\n\t\tinitialize: function(options) {\n\t\t\tthis.settings = playtotv.params(options, {\n\t\t\t\talternate: false,\n\t\t\t\tcycles: 1,\n\t\t\t\tduration: playtotv.REQUIRED,\n\t\t\t\tfps: 0,\n\t\t\t\trate: 1,\n\t\t\t\tstart: 0\n\t\t\t});\n\t\t},\n\n\t\t/** @lends playtotv.fx.Animation.prototype */\n\n\t\t/**\n\t\t * Internal requestAnimationFrame\n\t\t * @private\n\t\t */\n\t\trequestFrame: function() {\n\t\t\tthis.playing = animationFrame.request(this.onTick);\n\t\t},\n\n\t\t/**\n\t\t * Internal cancelAnimationFrame\n\t\t * @private\n\t\t */\n\t\tcancelFrame: function() {\n\t\t\tif (this.playing) {\n\t\t\t\tanimationFrame.cancel(this.playing);\n\t\t\t\tdelete this.playing;\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Public play function. Options that are passed will overrule the instance's, but only for this animation. If\n\t\t * an animation was currently playing, it will be stopped. This will NOT trigger onFinish(). Calls onStart().\n\t\t * @param {Object} options See instance options.\n\t\t */\n\t\tplay: function(options) {\n\t\t\tif (this.playing) {\n\t\t\t\tthis.stop();\n\t\t\t}\n\n\t\t\tthis.animation = options = playtotv.params(options, this.settings);\n\t\t\tthis.frame = options.fps ? 1000 / options.fps : 0;\n\t\t\tthis.startTime = options.start || Date.now();\n\t\t\tthis.frameTime = 0;\n\t\t\tthis.reversed = false;\n\n\t\t\tthis.onStart();\n\n\t\t\tthis.requestFrame();\n\t\t},\n\n\t\t/**\n\t\t * Pauses the current animation.\n\t\t */\n\t\tpause: function() {\n\t\t\tif (this.playing) {\n\t\t\t\tthis.paused = true;\n\t\t\t\tthis.pauseTime = Date.now();\n\t\t\t\tthis.cancelFrame();\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Resumes a currently paused animation.\n\t\t */\n\t\tresume: function() {\n\t\t\tif (this.paused) {\n\t\t\t\tdelete this.paused;\n\t\t\t\tthis.startTime = this.startTime + (Date.now() - this.pauseTime);\n\t\t\t\tthis.requestFrame();\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Stops a currently playing animation. A reset boolean may be passed to indicate whether the onFrame function\n\t\t * should be called with the initial animation fraction value of 0.\n\t\t * @param {boolean} reset\n\t\t */\n\t\tstop: function(reset) {\n\t\t\tthis.cancelFrame();\n\t\t\tif (reset) {\n\t\t\t\tthis.onFrame(0);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Internal tick. Calculates the current fraction value, and passes it to onFrame.\n\t\t * @private\n\t\t */\n\t\tonTick: function() {\n\t\t\t/*jshint maxcomplexity:10*/\n\n\t\t\tvar time = Date.now();\n\t\t\tvar anim = this.animation;\n\t\t\tvar cycles = anim.cycles;\n\t\t\tvar totalTime = (time - this.startTime) * anim.rate;\n\t\t\tvar cycle = Math.max(0, totalTime / anim.duration);\n\t\t\tvar finished = cycle >= cycles;\n\n\t\t\tvar at = (cycles > 1) ? cycle % 1 : Math.min(1, cycle);\n\t\t\tif (anim.alternate) {\n\t\t\t\tvar reversed = cycle % 2 > 1;\n\t\t\t\tif (reversed !== this.reversed) {\n\t\t\t\t\tthis.reversed = reversed;\n\t\t\t\t\tthis.onCycle(reversed);\n\t\t\t\t}\n\n\t\t\t\tat = reversed ? 1 - at : at;\n\t\t\t}\n\n\t\t\tif (!this.frame || finished || (time - this.frameTime) > this.frame) {\n\t\t\t\tthis.frameTime = time;\n\t\t\t\tthis.onFrame(at);\n\t\t\t}\n\n\t\t\tif (!finished) {\n\t\t\t\tthis.requestFrame();\n\t\t\t} else {\n\t\t\t\tthis.onFinish();\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Frame callback that MUST be implemented by subclasses. Receives the animation fraction as a number between\n\t\t * 0 and 1, which indicates how much of the animation has passed.\n\t\t * @param {number} fraction\n\t\t */\n\t\tonFrame: playtotv.AbstractFunction,\n\n\t\t/**\n\t\t * Start callback that may be implemented by subclasses. Called immediately before an animation is started\n\t\t * using play().\n\t\t */\n\t\tonStart: function() {},\n\n\t\t/**\n\t\t * Cycle callback that may be implemented by subclasses. Called immediately before subsequent animation cycles\n\t\t * start. Receives a boolean indicating whether this cycle is a reversed one. This function is called only when\n\t\t * an animation has more than one animation cycle.\n\t\t * @param {boolean} reversed\n\t\t */\n\t\tonCycle: function() {},\n\n\t\t/**\n\t\t * End callback that may be implemented by subclasses. Called immediately after an animation ended.\n\t\t */\n\t\tonFinish: function() {},\n\n\t\tcallbacks: [\n\t\t\t'onTick'\n\t\t]\n\t});\n\n\treturn Animation;\n});\n",
		"playtotv.define('playtotv.fx.easing', [], function() {\n\n\t'use strict';\n\n\t/**\n\t * Easing, provides callbacks that transform a 0 - 1 range to their eased equivalents.\n\t *\n\t * @name easing\n\t * @memberOf playtotv.fx\n\t * @namespace Easing equations, returns eased value from a 0 - 1 range.\n\t */\n\tvar easing = {\n\n\t\t/** @lends playtotv.fx.easing */\n\n\t\t/**\n\t\t * Returns the requested easing equation, or linear if not found.\n\t\t *\n\t\t * @param {string} name\n\t\t * @returns {Function} easing\n\t\t */\n\t\tget: function(name) {\n\t\t\treturn this[name] || this.linear;\n\t\t},\n\n\t\t/**\n\t\t * Adds an easing equation under the given name.\n\t\t *\n\t\t * @param {string} name\n\t\t * @param {Function} easing\n\t\t * @returns {Function} easing\n\t\t */\n\t\tset: function(name, easing) {\n\t\t\tif (this.hasOwnProperty(name)) {\n\t\t\t\tthrow new Error('\"' + name + '\" easing is already defined.');\n\t\t\t}\n\n\t\t\tthis[name] = easing;\n\t\t\treturn easing;\n\t\t},\n\n\t\t/**\n\t\t * Linear easing, input equals output.\n\t\t *\n\t\t * @param {number} value\n\t\t * @returns {number} eased\n\t\t */\n\t\tlinear: function(i) {\n\t\t\treturn i;\n\t\t},\n\n\t\t/**\n\t\t * Quadratic ease-in\n\t\t *\n\t\t * @param {number} value\n\t\t * @returns {number} eased\n\t\t */\n\t\tquadin: function(i) {\n\t\t\treturn i * i;\n\t\t},\n\n\t\t/**\n\t\t * Quadratic ease-out\n\t\t *\n\t\t * @param {number} value\n\t\t * @returns {number} eased\n\t\t */\n\t\tquadout: function(i) {\n\t\t\treturn i * (2 - i);\n\t\t},\n\n\t\t/**\n\t\t * Quadratic ease-in-out\n\t\t *\n\t\t * @param {number} value\n\t\t * @returns {number} eased\n\t\t */\n\t\tquadinout: function(i) {\n\t\t\treturn (i < 0.5) ?\n\t\t\t\t2 * i * i :\n\t\t\t\t1 - (2 * (--i) * i);\n\t\t},\n\n\t\t/**\n\t\t * Cubic ease-in\n\t\t *\n\t\t * @param {number} value\n\t\t * @returns {number} eased\n\t\t */\n\t\tcubicin: function(i) {\n\t\t\treturn i * i * i;\n\t\t},\n\n\t\t/**\n\t\t * Cubic ease-out\n\t\t *\n\t\t * @param {number} value\n\t\t * @returns {number} eased\n\t\t */\n\t\tcubicout: function(i) {\n\t\t\treturn ((--i) * i * i + 1);\n\t\t},\n\n\t\t/**\n\t\t * Cubic ease-in-out\n\t\t *\n\t\t * @param {number} value\n\t\t * @returns {number} eased\n\t\t */\n\t\tcubicinout: function(i) {\n\t\t\treturn (i < 0.5) ?\n\t\t\t\t4 * i * i * i :\n\t\t\t\t1 + (4 * (--i) * i * i);\n\t\t},\n\n\t\t/**\n\t\t * Quartic ease-in\n\t\t *\n\t\t * @param {number} value\n\t\t * @returns {number} eased\n\t\t */\n\t\tquartin: function(i) {\n\t\t\treturn i * i * i * i;\n\t\t},\n\n\t\t/**\n\t\t * Quartic ease-out\n\t\t *\n\t\t * @param {number} value\n\t\t * @returns {number} eased\n\t\t */\n\t\tquartout: function(i) {\n\t\t\treturn -((--i) * i * i * i - 1);\n\t\t},\n\n\t\t/**\n\t\t * Quartic ease-in-out\n\t\t *\n\t\t * @param {number} value\n\t\t * @returns {number} eased\n\t\t */\n\t\tquartinout: function(i) {\n\t\t\treturn (i < 0.5) ?\n\t\t\t\t8 * i * i * i * i :\n\t\t\t\t1 - (8 * (--i) * i * i * i);\n\t\t}\n\t};\n\n\treturn easing;\n});\n",
		"playtotv.define('playtotv.fx.Timeline', [\n\t'playtotv.fx.Animation'\n], function(\n\tAnimation\n) {\n\n\t'use strict';\n\n\t/**\n\t * Creates a timeline on which actions may be added. Like its super class Animation, timelines may be run at\n\t * different rates, and can cycle with or without alternating direction.\n\t *\n\t * @name Timeline\n\t * @class\n\t * @memberOf playtotv.fx\n\t * @extends playtotv.fx.Animation\n\t * @param {Object} options\n\t * @param {boolean} [options.alternate=false] Whether a timeline with multiple cycles alternates direction\n\t * @param {number} [options.cycles=1] Amount of repeating timeline cycles\n\t * @param {number} [options.duration=1000] Duration of one timeline cycle in ms\n\t * @param {number} [options.fps=0] Fps limit on requestAnimationFrame callbacks\n\t * @param {number} [options.rate=1] Time rate multiplier\n\t * @param {number} [options.start] Alternate start timestamp in ms; past starts mid-timeline, future delays start\n\t * @param {number} [options.to=1] End value\n\t */\n\tvar Timeline = new playtotv.Class({\n\t\textend: Animation,\n\n\t\tinitialize: function(options) {\n\t\t\tthis._super(options);\n\t\t\tthis.actions = [];\n\t\t},\n\n\t\t/**\n\t\t * Adds an action to the timeline at the given time, in the form of a callback. Actions are executed from the\n\t\t * timeline's onFrame() function, which is subject to the fps option value. Because of this, the given time is\n\t\t * an approximation of the actual time at which the action will be performed (with lower fps increasing the\n\t\t * possible deviation). Considerably lowering the fps or queuing actions closer to another than the time\n\t\t * between two consecutive frames may result in multiple actions being called in the same onFrame() callstack.\n\t\t *\n\t\t * @param {number} time Time relative to the start of the timeline at which the action is executed\n\t\t * @param {Object} action\n\t\t * @param {Function} action.callback Function to execute\n\t\t * @param {Object} [action.context] Optional context the callback will be applied to\n\t\t * @param {Array} [action.args] Optional array of callback arguments\n\t\t * @returns {Object} action\n\t\t */\n\t\tadd: function(time, action) {\n\t\t\taction = playtotv.params(action, {\n\t\t\t\tcallback: playtotv.REQUIRED,\n\t\t\t\tcontext: undefined,\n\t\t\t\targs: []\n\t\t\t});\n\n\t\t\tthis.actions.push(playtotv.extend(action, {\n\t\t\t\ttime: time,\n\t\t\t\trun: true\n\t\t\t}));\n\n\t\t\treturn action;\n\t\t},\n\n\t\t/**\n\t\t * Removes an action from the timeline. Accepts actions as given to or returned by add()\n\t\t *\n\t\t * @param {Object} action\n\t\t */\n\t\tremove: function(action) {\n\t\t\tvar index = this.actions.indexOf(action);\n\t\t\tif (index >= 0) {\n\t\t\t\tthis.actions.splice(index, 1);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Resets all actions when the timeline starts or cycles, allowing them to be run at their respective time.\n\t\t *\n\t\t */\n\t\treset: function() {\n\t\t\tthis.actions.forEach(function(frame) {\n\t\t\t\tframe.run = false;\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Called when the timeline starts, triggers a reset()\n\t\t *\n\t\t */\n\t\tonStart: function() {\n\t\t\tthis.reset();\n\t\t},\n\n\t\t/**\n\t\t * Called when a timeline with multiple cycles cycles, triggers a reset()\n\t\t *\n\t\t */\n\t\tonCycle: function() {\n\t\t\tthis.reset();\n\t\t},\n\n\t\t/**\n\t\t * Checks the elapsed time, and executes any actions of which the indicated time matches or has passed.\n\t\t *\n\t\t * @param {number} fraction\n\t\t */\n\t\tonFrame: function(n) {\n\t\t\tvar anim = this.animation;\n\t\t\tvar current = n * anim.duration;\n\t\t\tvar reverse = this.reversed;\n\n\t\t\tthis.actions.forEach(function(frame) {\n\t\t\t\tvar passed = current >= frame.time;\n\t\t\t\tif (!frame.run && ((reverse && !passed) || (!reverse && passed))) {\n\t\t\t\t\tframe.run = true;\n\t\t\t\t\tframe.callback.apply(frame.context, frame.args);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n\n\treturn Timeline;\n});\n",
		"playtotv.define('playtotv.fx.Transition', [\n\t'playtotv.fx.Animation',\n\t'playtotv.fx.easing'\n], function(\n\tAnimation,\n\teasing\n) {\n\n\t'use strict';\n\n\tvar transitionOptions = [ 'callback', 'easing', 'from', 'to' ];\n\n\t/**\n\t * Creates a transition that runs a requestAnimationFrame based callback over a given duration when played, passing\n\t * the current value between the from and to option values, based on the elapsed time since the transition started.\n\t *\n\t * @name Transition\n\t * @class\n\t * @memberOf playtotv.fx\n\t * @extends playtotv.fx.Animation\n\t * @param {Object} options\n\t * @param {boolean} [options.alternate=false] Whether a transition with multiple cycles alternates its direction\n\t * @param {Function} options.callback Callback that is called each frame with the current transtion value\n\t * @param {number} [options.cycles=1] Amount of animation cycles\n\t * @param {number} [options.duration=1000] Transition duration in ms\n\t * @param {string} [options.easing='linear'] callback value easing, see {@link playtotv.fx.easing}\n\t * @param {number} [options.fps=0] Frames per second cap, 0 for no cap\n\t * @param {number} [options.from=0] Starting value\n\t * @param {number} [options.rate=1] Time rate multiplier\n\t * @param {number} [options.start] Alternate start timestamp in ms; past starts mid-animation, future delays start\n\t * @param {number} [options.to=1] End value\n\t */\n\tvar Transition = new playtotv.Class({\n\t\textend: Animation,\n\n\t\tinitialize: function(options) {\n\t\t\toptions = playtotv.params(options, {\n\t\t\t\talternate: false,\n\t\t\t\tcallback: playtotv.REQUIRED,\n\t\t\t\tcycles: 1,\n\t\t\t\tduration: playtotv.REQUIRED,\n\t\t\t\teasing: 'linear',\n\t\t\t\tfps: 0,\n\t\t\t\tfrom: 0,\n\t\t\t\trate: 1,\n\t\t\t\tstart: 0,\n\t\t\t\tto: 1\n\t\t\t});\n\n\t\t\tthis._super(playtotv.omit(options, transitionOptions));\n\t\t\tthis.settings = options;\n\t\t},\n\n\t\t/** @lends playtotv.fx.Transition.prototype */\n\n\t\t/**\n\t\t * Calculates the current transition value based on the given animation fraction and any easing, and passes\n\t\t * this value to the transition's callback. This function is called via requestAnimationFrame (and may be\n\t\t * throttled further with the fps option) for optimized rendering performance.\n\t\t *\n\t\t * @param {number} fraction\n\t\t */\n\t\tonFrame: function(n) {\n\t\t\tvar animation = this.animation || this.settings;\n\t\t\tvar ease = this.ease || (this.ease = easing.get(animation.easing));\n\n\t\t\tanimation.callback(\n\t\t\t\tanimation.from + ((animation.to - animation.from) * ease(n))\n\t\t\t);\n\t\t}\n\t});\n\n\treturn Transition;\n});\n",
		"/**\n * Auto generated API: <tt>src/global/generic-content-api.js</tt>\n *\n * <b>DO NOT MODIFY! CHANGES WILL BE OVERWRITTEN THE NEXT TIME YOU UPDATE!</b>\n *\n * <b>Note:</b> These are not real functions but method definitions for\n * {@link playtotv.server.Server#call}.\n *\n * @name genericContentAPI\n * @memberOf playtotv.global\n * @namespace\n */\nplaytotv.define('playtotv.global.genericContentAPI', [], function() {\n\n\t'use strict';\n\n\treturn {\n\t\t/*jshint maxlen:300*/ // On occassion generated lines can be too long\n\n\t\t/** @lends playtotv.global.genericContentAPI */\n\n\t\t/**\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.category\n\t\t * @returns {Promise} Promise of response data (Object)\n\t\t */\n\t\tgetCategory: {\n\t\t\tlabel: 'genericContent.getCategory',\n\t\t\turl: '1/genericcontent/{category}'\n\t\t}\n\t};\n});\n",
		"/**\n * Auto generated API: <tt>src/global/global-data-api.js</tt>\n *\n * <b>DO NOT MODIFY! CHANGES WILL BE OVERWRITTEN THE NEXT TIME YOU UPDATE!</b>\n *\n * <b>Note:</b> These are not real functions but method definitions for\n * {@link playtotv.server.Server#call}.\n *\n * @name globalDataAPI\n * @memberOf playtotv.global\n * @namespace\n */\nplaytotv.define('playtotv.global.globalDataAPI', [], function() {\n\n\t'use strict';\n\n\treturn {\n\t\t/*jshint maxlen:300*/ // On occassion generated lines can be too long\n\n\t\t/** @lends playtotv.global.globalDataAPI */\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} [params.timeZone]\n\t\t * @returns {Promise} Promise of response data (GlobalDataDTO)\n\t\t */\n\t\tget: {\n\t\t\tlabel: 'globalData.get',\n\t\t\turl: '1/globaldata/',\n\t\t\tqueryKeys: [\n\t\t\t\t'timeZone'\n\t\t\t]\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.handlebars.hbsUtil', [], function() {\n\t/*global Handlebars:false*/\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\n\tvar hbsUtil = {\n\t\t// Throw Exception, but in separate tick so as not to break down subsequent code execution\n\t\tsoftException: function(message) {\n\t\t\tvar exception = new Handlebars.Exception(message);\n\t\t\twindow.nextTick(function() {\n\t\t\t\tthrow exception;\n\t\t\t});\n\t\t\treturn '';\n\t\t},\n\n\t\t// Call if value is a getter function otherwise just return value as-is\n\t\tgetValue: function(context, value) {\n\t\t\treturn value instanceof Function ? value.call(context) : value;\n\t\t},\n\n\t\tgetHash: function(context, hash) {\n\t\t\treturn Object.keys(hash).reduce(function(newHash, key) {\n\t\t\t\tnewHash[key] = this.getValue(context, hash[key]);\n\t\t\t\treturn newHash;\n\t\t\t}.bind(this), {});\n\t\t},\n\n\t\tgetArgs: function(context, args, names, nrRequired, nrOptional) {\n\t\t\targs = ptv.toArray(args);\n\t\t\tvar options = args.pop();\n\t\t\targs = args.map(arg => this.getValue(context, arg));\n\n\t\t\tvar map = {\n\t\t\t\targs: args,\n\t\t\t\toptions: options,\n\t\t\t\thash: this.getHash(context, options.hash)\n\t\t\t};\n\n\t\t\t// If defined then validate and map required and optional arguments to their names\n\t\t\tif (names) {\n\t\t\t\tnames = names.split(', ');\n\n\t\t\t\tvar nrNames = names.length;\n\t\t\t\tnrRequired = nrRequired !== undefined ? nrRequired : nrNames;\n\t\t\t\tnrOptional = nrOptional !== undefined ? nrOptional : nrNames - nrRequired;\n\t\t\t\tvar nrArgs = args.length;\n\t\t\t\tif (nrArgs < nrRequired || nrArgs > nrRequired + nrOptional) {\n\t\t\t\t\tvar requiredNames = names.slice(0, nrRequired);\n\t\t\t\t\tvar optionalNames = names.slice(nrRequired, nrOptional);\n\t\t\t\t\tthis.softException(\n\t\t\t\t\t\toptions.name + ' got invalid number of arguments, ' +\n\t\t\t\t\t\t' expected: ' + nrRequired + (nrOptional ? ' to ' + (nrRequired + nrOptional) : '') + ' (' +\n\t\t\t\t\t\trequiredNames.concat(optionalNames.map(function(n) { return '[' + n + ']'; })).join(', ') +\n\t\t\t\t\t\t'), but got: ' + nrArgs + ' (' + args.join(', ') + ')'\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tnames.forEach(function(name, i) {\n\t\t\t\t\tmap[name] = args[i];\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn map;\n\t\t},\n\n\t\textendContext: function(context, hash) {\n\t\t\t// Note: Using hash context extending will break any context prototype chaining\n\t\t\treturn hash instanceof Object && Object.keys(hash).length > 0 ?\n\t\t\t\tptv.extend({}, context, hash) :\n\t\t\t\tcontext;\n\t\t},\n\n\t\tcallHelper: function(name, context, ...args) {\n\t\t\treturn Handlebars.helpers[name].apply(context, args);\n\t\t},\n\n\t\tdelegateIfBlock: function(helperName, context, value, options, clearHash) {\n\t\t\tif (options.fn) {\n\t\t\t\tif (clearHash) {\n\t\t\t\t\toptions = ptv.extend({}, options, { hash: {} });\n\t\t\t\t}\n\t\t\t\treturn this.callHelper(helperName, context, value, options);\n\t\t\t}\n\n\t\t\treturn value;\n\t\t}\n\t};\n\n\treturn hbsUtil;\n});\n",
		"playtotv.define('playtotv.handlebars.helpers', [\n\t'playtotv.handlebars.hbsUtil'\n], function(\n\thbsUtil\n) {\n\t/*global Handlebars:false*/\n\n\t// TODO: JSDOC\n\n\t'use strict';\n\n\t// For more helper inspiration see:\n\t// http://assemble.io/helpers\n\t// http://elving.github.io/swag\n\t// https://github.com/shannonmoeller/handlebars-layouts (OO Templating)\n\t// https://github.com/wycats/handlebars.js/issues/208 (Inline partial overriding/inheritance)\n\n\tvar ptv = playtotv;\n\tvar util = ptv.util;\n\n\tvar helpers = {\n\t\t/** @lends playtotv.handlebars.helpers */\n\n\t\t/**\n\t\t * Change Handlebars variable values by hash, making them available through @key data references.\n\t\t * Calling this as a block helper is usually the best thing to do as it will not leak outside of it's block.\n\t\t * As a non-block helper this will change the variable value within the current render frame context.\n\t\t *\n\t\t * Note: Variables will be available in child blocks with different contexts like {{#with}} as well.\n\t\t *\n\t\t * @example\n\t\t * Template: {{#var x=\"foo\"}} {{@x}}bar {{/var}}\n\t\t * Template: {{var x=\"foo\"}} {{@x}}bar\n\t\t * Output: foobar\n\t\t */\n\t\tvar: function() {\n\t\t\tvar { options, hash } = hbsUtil.getArgs(this, arguments, '');\n\t\t\tvar { fn, data } = options;\n\n\t\t\t// If called as block helper then frame our data so that we do not override variables in our parent block\n\t\t\t// If not called as block helper then let the variable changes operate through side effects\n\t\t\tif (fn) {\n\t\t\t\tdata = Handlebars.createFrame(data);\n\t\t\t}\n\n\t\t\tptv.extend(data, hash);\n\n\t\t\treturn fn ? fn(this, { data: data }) : '';\n\t\t},\n\n\t\t/**\n\t\t * @example\n\t\t * Template: {{#is state \"ok\"}} Cool {{else}} Oh no! {{/is}}\n\t\t */\n\t\tis: function() {\n\t\t\tvar { value1, value2, options } = hbsUtil.getArgs(this, arguments, 'value1, value2');\n\t\t\treturn hbsUtil.delegateIfBlock('if', this, value1 === value2, options);\n\t\t},\n\n\t\t/**\n\t\t * @example\n\t\t * Template: {{#isnt state \"bad\"}} Cool {{else}} Oh no! {{/isnt}}\n\t\t */\n\t\tisnt: function() {\n\t\t\tvar { value1, value2, options } = hbsUtil.getArgs(this, arguments, 'value1, value2');\n\t\t\treturn hbsUtil.delegateIfBlock('if', this, value1 !== value2, options);\n\t\t},\n\n\t\tdefault: function() {\n\t\t\tvar { value, def } = hbsUtil.getArgs(this, arguments, 'value, def');\n\t\t\treturn value === undefined ? def : value;\n\t\t},\n\n\t\t/**\n\t\t * Note: The def argument is optional.\n\t\t *\n\t\t * @example\n\t\t * Data: { state: 'y' }\n\t\t * Template: {{switch state \"Default\" x=\"Foo\" y=\"Bar\"}}\n\t\t * Output: Bar\n\t\t */\n\t\tswitch: function() {\n\t\t\tvar { value, def, hash } = hbsUtil.getArgs(this, arguments, 'value, def', 1);\n\t\t\tif (Object.keys(hash).indexOf(value) >= 0) {\n\t\t\t\treturn hash[value];\n\t\t\t} else if (def === undefined) {\n\t\t\t\treturn hbsUtil.softException('No matching case or default for value: ' + value);\n\t\t\t} else {\n\t\t\t\treturn def;\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * @example\n\t\t * Data: { isFoo: true, isBar: false }\n\t\t * Template: &lt;li class=\"{{classes foo=isFoo bar=isBar}}\">\n\t\t * Output: &lt;li class=\"foo\">\n\t\t */\n\t\tclasses: function() {\n\t\t\tvar { hash } = hbsUtil.getArgs(this, arguments);\n\t\t\tvar str = '';\n\t\t\tptv.each(hash, function(value, key) {\n\t\t\t\tif (value) {\n\t\t\t\t\tstr = str ? str + ' ' + key : key;\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t\treturn str;\n\t\t},\n\n\t\t/**\n\t\t * Data: { x: 3 }\n\t\t *\n\t\t * Example: {{inc x}}\n\t\t * Output: 4\n\t\t *\n\t\t * Example: {{inc x 2}}\n\t\t * Output: 5\n\t\t */\n\t\tinc: function() {\n\t\t\tvar { x, y } = hbsUtil.getArgs(this, arguments, 'x, y', 1);\n\t\t\ty = y === undefined ? 1 : y;\n\t\t\treturn x + y;\n\t\t},\n\n\t\t/**\n\t\t * Data: { x: 3 }\n\t\t *\n\t\t * Example: {{dec x}}\n\t\t * Output: 2\n\t\t *\n\t\t * Example: {{dec x 2}}\n\t\t * Output: 1\n\t\t */\n\t\tdec: function() {\n\t\t\tvar { x, y } = hbsUtil.getArgs(this, arguments, 'x, y', 1);\n\t\t\ty = y === undefined ? 1 : y;\n\t\t\treturn x - y;\n\t\t},\n\n\t\t/**\n\t\t * Example: {{#gt x 10}} Wow! {{else}} Meh.. {{/gt}}\n\t\t * Can also be used to compose sub-expressions.\n\t\t */\n\t\tgt: function() {\n\t\t\tvar { x, y, options } = hbsUtil.getArgs(this, arguments, 'x, y');\n\t\t\treturn hbsUtil.delegateIfBlock('if', this, x > y, options);\n\t\t},\n\n\t\t/**\n\t\t * Example: {{#lt x 10}} Meh.. {{else}} Wow! {{/lt}}\n\t\t * Can also be used to compose sub-expressions.\n\t\t */\n\t\tlt: function() {\n\t\t\tvar { x, y, options } = hbsUtil.getArgs(this, arguments, 'x, y');\n\t\t\treturn hbsUtil.delegateIfBlock('if', this, x < y, options);\n\t\t},\n\n\t\t/**\n\t\t * Example: {{#not x}} is equal to {{#unless x}}\n\t\t * Can also be used to compose sub-expressions.\n\t\t */\n\t\tnot: function() {\n\t\t\tvar { value, options } = hbsUtil.getArgs(this, arguments, 'value');\n\t\t\treturn hbsUtil.delegateIfBlock('if', this, !value, options);\n\t\t},\n\n\t\t/**\n\t\t * Example: {{#or x y z}} is equal to {{#if (eval 'x || y || z')}}\n\t\t * Can also be used to compose sub-expressions.\n\t\t */\n\t\tor: function() {\n\t\t\tvar { args, options } = hbsUtil.getArgs(this, arguments);\n\t\t\tvar result = args.find(arg => arg);\n\t\t\treturn hbsUtil.delegateIfBlock('if', this, result, options);\n\t\t},\n\n\t\t/**\n\t\t * Example: {{#and x y z}} is equal to {{#if (eval 'x && y && z')}}\n\t\t * Can also be used to compose sub-expressions.\n\t\t */\n\t\tand: function() {\n\t\t\tvar { args, options } = hbsUtil.getArgs(this, arguments);\n\t\t\tvar result = args.reduce((result, arg) => result && arg, true);\n\t\t\treturn hbsUtil.delegateIfBlock('if', this, result, options);\n\t\t},\n\n\t\t/**\n\t\t * Example: {{#inArray (Array 2 3 5 7) x}}small prime{{/inArray}}\n\t\t * Can also be used to compose sub-expressions.\n\t\t */\n\t\tinArray: function() {\n\t\t\tvar { list, value, options } = hbsUtil.getArgs(this, arguments, 'list, value');\n\t\t\treturn hbsUtil.delegateIfBlock('if', this, list.indexOf(value) >= 0, options);\n\t\t},\n\n\t\tArray: function() {\n\t\t\tvar { args, options } = hbsUtil.getArgs(this, arguments);\n\t\t\treturn hbsUtil.delegateIfBlock('each', this, args, options);\n\t\t},\n\n\t\tObject: function() {\n\t\t\tvar { options, hash } = hbsUtil.getArgs(this, arguments);\n\t\t\treturn hbsUtil.delegateIfBlock('with', this, hash, options);\n\t\t},\n\n\t\ttoNumber: function() {\n\t\t\tvar { str } = hbsUtil.getArgs(this, arguments, 'str');\n\t\t\treturn parseFloat(str);\n\t\t},\n\n\t\ttoBool: function() {\n\t\t\tvar { str } = hbsUtil.getArgs(this, arguments, 'str');\n\t\t\treturn str === 'true' ? true : false;\n\t\t},\n\n\t\t// To: 'foo bar'\n\t\tlowerCase: function() {\n\t\t\tvar { text } = hbsUtil.getArgs(this, arguments, 'text');\n\t\t\treturn ('' + text).toLowerCase();\n\t\t},\n\n\t\t// To: 'FOO BAR'\n\t\tupperCase: function() {\n\t\t\tvar { text } = hbsUtil.getArgs(this, arguments, 'text');\n\t\t\treturn ('' + text).toUpperCase();\n\t\t},\n\n\t\t// To: 'foo-bar'\n\t\tdashCase: function() {\n\t\t\tvar { text } = hbsUtil.getArgs(this, arguments, 'text');\n\t\t\treturn util.dashCase('' + text);\n\t\t},\n\n\t\t// To: 'Foo bar'\n\t\tsentenceCase: function() {\n\t\t\tvar { text } = hbsUtil.getArgs(this, arguments, 'text');\n\t\t\ttext = '' + text;\n\t\t\treturn text[0].toUpperCase() + text.substr(1).toLowerCase();\n\t\t},\n\n\t\t// To: 'Foo Bar'\n\t\ttitleCase: function() {\n\t\t\tvar { text } = hbsUtil.getArgs(this, arguments, 'text');\n\t\t\treturn util.titleCase('' + text);\n\t\t},\n\n\t\tconcat: function() {\n\t\t\tvar { args } = hbsUtil.getArgs(this, arguments);\n\t\t\treturn args.join('');\n\t\t},\n\n\t\t/**\n\t\t * @example\n\t\t * Data: { names: [ 'John', 'Mary', 'Elizabeth' ] }\n\t\t * Template 1: {{join names last=\" and \"}}\n\t\t * Template 2: {{#join names last=\" and \"}}{{.}}{{/join}}\n\t\t * Output: John, Mary and Elizabeth\n\t\t */\n\t\tjoin: function() {\n\t\t\tvar { array, hash, options } = hbsUtil.getArgs(this, arguments, 'array');\n\t\t\tvar { fn, inverse } = options;\n\t\t\tvar separator = hash.separator || ', ';\n\t\t\tvar last = hash.last || separator;\n\t\t\tarray = fn ? array.map(fn) : array.slice(0);\n\t\t\tvar len = array.length;\n\t\t\treturn len === 0 ? (inverse ? inverse(this) : '') :\n\t\t\t\tlen === 1 ? array[0] :\n\t\t\t\tarray.slice(0, -1).join(separator) + last + array[len - 1];\n\t\t},\n\n\t\t/**\n\t\t * @example\n\t\t * Data: { str: 'John, Mary,Elizabeth' }\n\t\t * Template: -{{#split str}}{{.}}-{{/split}}\n\t\t * Output: -John-Mary-Elizabeth-\n\t\t */\n\t\tsplit: function() {\n\t\t\tvar { str, hash, options } = hbsUtil.getArgs(this, arguments, 'str');\n\t\t\tvar separator = hash.separator || /,\\s?/;\n\t\t\tvar array = str.length > 0 ? str.split(separator) : [];\n\t\t\treturn hbsUtil.delegateIfBlock('each', this, array, options, true);\n\t\t},\n\n\t\t/**\n\t\t * @example\n\t\t * Template: {{inflect nrEnemies \"one enemy\" \"%d enemies\"}}\n\t\t * Output: 3 enemies\n\t\t */\n\t\tinflect: function() {\n\t\t\tvar { count, singular, plural } = hbsUtil.getArgs(this, arguments, 'count, singular, plural');\n\t\t\tvar result = count === 1 ? singular : plural;\n\t\t\treturn result.replace(/%d/g, count);\n\t\t},\n\n\t\t/**\n\t\t * @example\n\t\t * Template: {{truncate \"Bender should not be allowed on tv.\" 10}}\n\t\t * Template: {{truncate \"Bender should not be allowed on tv.\" 10 dots=\"..\"}}\n\t\t * Output: Bender s..\n\t\t */\n\t\ttruncate: function() {\n\t\t\tvar { str, len, hash } = hbsUtil.getArgs(this, arguments, 'str, len');\n\t\t\tvar dots = hash.dots || '..';\n\t\t\tif (str.length > len) {\n\t\t\t\tstr = str.substr(0, len - dots.length) + dots;\n\t\t\t}\n\t\t\treturn str;\n\t\t},\n\n\t\t/**\n\t\t * Returns URL with hash added as query parameters.\n\t\t * The url argument defaults to location.href.\n\t\t */\n\t\taddURLParams: function() {\n\t\t\tvar { url, hash } = hbsUtil.getArgs(this, arguments, 'url', 0);\n\t\t\turl = url || window.location.href;\n\t\t\treturn util.addURLParams(url, hash);\n\t\t},\n\n\t\t/**\n\t\t * Returns hash of url's query parameters.\n\t\t * The url argument defaults to location.href.\n\t\t */\n\t\tgetURLParams: function() {\n\t\t\tvar { url } = hbsUtil.getArgs(this, arguments, 'url', 0);\n\t\t\turl = url || window.location.href;\n\t\t\treturn util.getURLParams(url);\n\t\t},\n\n\t\t/**\n\t\t * Returns value of url's query parameter with specified key.\n\t\t * You can call this with two arguments (url, key) or with one (key).\n\t\t * In the latter case the url argument defaults to location.href.\n\t\t */\n\t\tgetURLParam: function() {\n\t\t\tvar { urlOrKey, key } = hbsUtil.getArgs(this, arguments, 'urlOrKey, key', 1);\n\t\t\tvar url = key ? urlOrKey : '';\n\t\t\tkey = key || urlOrKey;\n\t\t\treturn util.getURLParams(url)[key];\n\t\t},\n\n\t\t/**\n\t\t * Returns specified or current date formatted with specified pattern using {@link playtotv.util.formatDate}.\n\t\t */\n\t\tformatDate: function() {\n\t\t\tvar { pattern, date } = hbsUtil.getArgs(this, arguments, 'pattern, date', 1);\n\t\t\treturn util.formatDate(pattern, date);\n\t\t},\n\n\t\t/**\n\t\t * @example\n\t\t * Template: {{addCommas 1000}}\n\t\t * Output: 1,000\n\t\t *\n\t\t * Template: {{addCommas 1000 \".\"}}\n\t\t * Output: 1.000\n\t\t *\n\t\t * Template: {{addCommas 1000.123}}\n\t\t * Output: 1,000.123\n\t\t */\n\t\taddCommas: function() {\n\t\t\tvar { number, separator } = hbsUtil.getArgs(this, arguments, 'number, separator', 1, 1);\n\n\t\t\tif (separator === undefined) {\n\t\t\t\tseparator = ',';\n\t\t\t}\n\n\t\t\tvar decimal = (separator === ',') ? '.' : ',';\n\t\t\tvar parts = number.toString().split('.');\n\n\t\t\treturn parts[0].replace(/\\B(?=(\\d{3})+(?!\\d))/g, separator) + (parts[1] ? decimal + parts[1] : '');\n\t\t},\n\n\t\t/**\n\t\t * @example\n\t\t * Template: {{toFixed 1.23456}}\n\t\t * Output: 1.23\n\t\t *\n\t\t * Template: {{toFixed 1.23456 4}}\n\t\t * Output: 1.2345\n\t\t *\n\t\t * Template: {{toFixed 1.23456 0}}\n\t\t * Output: 1\n\t\t */\n\t\ttoFixed: function() {\n\t\t\tvar { value, digits } = hbsUtil.getArgs(this, arguments, 'value, digits', 1, 1);\n\n\t\t\tif (digits === undefined) {\n\t\t\t\tdigits = 2;\n\t\t\t}\n\n\t\t\treturn value.toFixed(digits);\n\t\t},\n\n\t\t/**\n\t\t * Transform value to string\n\t\t *\n\t\t * @example\n\t\t * Template: {{toString 1.23}}\n\t\t * Output: 1.23\n\t\t */\n\t\ttoString: function() {\n\t\t\tvar { value } = hbsUtil.getArgs(this, arguments, 'value', 1, 0);\n\t\t\treturn String(value);\n\t\t},\n\n\t\t/**\n\t\t * @example\n\t\t * Template: {{pad 1}}\n\t\t * Output: 01\n\t\t *\n\t\t * Template: {{pad 1 10}}\n\t\t * Output: 0000000001\n\t\t *\n\t\t * Template: {{pad 1 10 \"-\"}}\n\t\t * Output: ---------1\n\t\t */\n\t\tpad: function() {\n\t\t\tvar { value, len, ch } = hbsUtil.getArgs(this, arguments, 'value, len, ch', 1, 2);\n\t\t\treturn util.pad(value, len, ch);\n\t\t},\n\n\t\t// TODO: More helpers like:\n\t\t//   L10n: (see also: mozilla l20n, cordova globalization, etc.)\n\t\t//     {{l10n \"Translate this\"}}\n\t\t//     {{ordinalize 3}} => 3rd\n\t\t//     {{toPrecision 555.322 4}} => 555.3\n\t\t//     {{formatNumber number type=\"decimal|percent|currency\"}}\n\t\t//     {{formatPhoneNumber 4444444444}} => (444) 444-4444\n\n\t\tseek: function() {\n\t\t\tvar { path, context } = hbsUtil.getArgs(this, arguments, 'path, context', 1);\n\t\t\tcontext = context || this;\n\t\t\treturn util.seek(context, path);\n\t\t},\n\n\t\teval: function() {\n\t\t\tvar { script, context, hash, options } = hbsUtil.getArgs(this, arguments, 'script, context', 0);\n\n\t\t\t// Default to this render context, but if hash properties are passed, use those as context instead\n\t\t\tcontext = context || this;\n\t\t\tif (Object.keys(hash).length > 0) {\n\t\t\t\tcontext = hash;\n\t\t\t}\n\n\t\t\t// If called with a block then the block is the script\n\t\t\tif (options.fn) {\n\t\t\t\tscript = options.fn(this);\n\t\t\t}\n\n\t\t\treturn util.eval(script, context);\n\t\t},\n\n\t\t/**\n\t\t * Returns list filtered by value specified by item path matching value by specified mode.\n\t\t * If used as block helper this delegates to \"each\" helper.\n\t\t */\n\t\tfilter: function() {\n\t\t\tvar { list, path, value, hash, options } = hbsUtil.getArgs(this, arguments, 'list, path, value', 1);\n\t\t\tvar { mode } = hash;\n\t\t\tvar filtered = util.filter(list, path, value, mode);\n\t\t\treturn hbsUtil.delegateIfBlock('each', this, filtered, options, true);\n\t\t},\n\n\t\t/**\n\t\t * Returns list ordered by value specified by item path, optionally descending.\n\t\t * If used as block helper this delegates to \"each\" helper.\n\t\t */\n\t\torder: function() {\n\t\t\tvar { list, path, hash, options } = hbsUtil.getArgs(this, arguments, 'list, path', 1);\n\t\t\tvar { desc } = hash;\n\t\t\tvar ordered = util.order(list, path, desc);\n\t\t\treturn hbsUtil.delegateIfBlock('each', this, ordered, options, true);\n\t\t},\n\n\t\t/**\n\t\t * Returns specified page of list with added properties: page, prev, next and last.\n\t\t * If used as a block helper this delegates to \"each\" helper.\n\t\t */\n\t\tpaginate: function() {\n\t\t\tvar { list, page, size, options } = hbsUtil.getArgs(this, arguments, 'list, page, size', 1);\n\t\t\tpage = parseInt(page, 10);\n\t\t\tsize = parseInt(size, 10);\n\t\t\tvar paged = util.page(list, page, size);\n\t\t\treturn hbsUtil.delegateIfBlock('each', this, paged, options, true);\n\t\t},\n\n\t\tjson: function() {\n\t\t\tvar { obj, hash } = hbsUtil.getArgs(this, arguments, 'obj');\n\t\t\treturn hash.pretty ? JSON.stringify(obj, null, '\t') :  JSON.stringify(obj);\n\t\t},\n\n\t\t/**\n\t\t * Returns hash path relative to current hash or current hash if no path is specified\n\t\t *\n\t\t * @example\n\t\t * From: #/episodes/ep1/schedule\n\t\t * Data: { interactionId: 'abc123' }\n\t\t *\n\t\t * Template: {{hash}}\n\t\t * Output: #/episodes/ep1/schedule\n\t\t *\n\t\t * Template: {{hash \"interaction/create\"}}\n\t\t * Output: #/episodes/ep1/interaction/create\n\t\t *\n\t\t * Template: {{hash \"../ep2/\"}}\n\t\t * Output: #/episodes/ep2/\n\t\t *\n\t\t * Template: {{hash \"interaction/\" interactionId \"/edit\"}}\n\t\t * Output: #/episodes/ep1/interaction/abc123/edit\n\t\t */\n\t\thash: function() {\n\t\t\tvar hash = window.location.hash;\n\t\t\tvar { args } = hbsUtil.getArgs(this, arguments);\n\t\t\tvar path = args.join('');\n\t\t\tif (!path) {\n\t\t\t\treturn hash;\n\t\t\t}\n\t\t\tvar from = hash.slice(1); // strip leading #\n\t\t\tif (from) {\n\t\t\t\tpath = hbsUtil.pathResolve(from, path);\n\t\t\t}\n\t\t\treturn '#' + path;\n\t\t},\n\n\t\thelperMissing: function() {\n\t\t\tvar options = arguments[arguments.length - 1];\n\t\t\thbsUtil.softException('Unknown field or helper: ' + options.name);\n\t\t}\n\t};\n\n\treturn helpers;\n});\n",
		"playtotv.define('playtotv.pubsub.Subscription', [], function() {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar util = ptv.util;\n\n\treturn new ptv.Class({\n\t\t/** @lends playtotv.pubsub.Subscription.prototype */\n\n\t\t/**\n\t\t * Class used to represent a {@link playtotv.pubsub.PubSub} Subscription.\n\t\t *\n\t\t * When a selector string contains star (*) characters it is converted to a basic glob RegExp.\n\t\t *\n\t\t * @constructs\n\t\t * @param {string|RegExp} selector Channel selector\n\t\t * @param {Function} handler Subscription callback\n\t\t * @throws {TypeError} If selector or handler is invalid\n\t\t *\n\t\t * @property {string|RegExp} selector\n\t\t * @property {Function} handler\n\t\t */\n\t\tinitialize: function(selector, handler) {\n\t\t\tif (!(typeof selector === 'string' || selector instanceof RegExp)) {\n\t\t\t\tthrow new TypeError('Invalid selector (not a string or RegExp)');\n\t\t\t}\n\t\t\tif (!(handler instanceof Function)) {\n\t\t\t\tthrow new TypeError('Invalid handler (not a function)');\n\t\t\t}\n\n\t\t\tif (typeof selector === 'string' && selector.indexOf('*') >= 0) {\n\t\t\t\tselector = new RegExp('^' + util.escapeRegEx(selector).replace(/\\\\\\*/g, '.*?') + '$');\n\t\t\t}\n\n\t\t\tthis.selector = selector;\n\t\t\tthis.handler = handler;\n\t\t},\n\n\t\t/**\n\t\t * Returns true if this subscription's selector matches specified channel.\n\t\t *\n\t\t * @param {string} channel Channel to match\n\t\t * @returns {boolean} True if this subscription's selector matches specified channel\n\t\t */\n\t\tmatch: function(channel) {\n\t\t\tvar selector = this.selector;\n\t\t\treturn typeof selector === 'string' ? selector === channel : selector.test(channel);\n\t\t},\n\n\t\t/**\n\t\t * Deliver data to handler on specified channel.\n\t\t *\n\t\t * If subscription has been disposed then handler will no longer be called.\n\t\t *\n\t\t * Handler will be called with this subscription as thisArg.\n\t\t *\n\t\t * @param {mixed} [data] Data to deliver\n\t\t * @param {string} channel Channel we are delivering to\n\t\t */\n\t\tdeliver: function(data, channel) {\n\t\t\tif (this.handler) {\n\t\t\t\tthis.handler(data, channel);\n\t\t\t}\n\t\t},\n\n\t\tdispose: function() {\n\t\t\tptv.dispose(this);\n\t\t}\n\t});\n});\n",
		"playtotv.define('playtotv.model.ModelSubscription', [\n\t'playtotv.pubsub.Subscription'\n], function(\n\tSubscription\n) {\n\n\t'use strict';\n\n\tvar util = playtotv.util;\n\n\treturn new playtotv.Class({\n\t\t/** @lends playtotv.model.ModelSubscription.prototype */\n\n\t\textend: Subscription,\n\n\t\t/**\n\t\t * RegExp used to test validity of selector strings.\n\t\t * @type {RegExp}\n\t\t */\n\t\tselectorRegex: /^([\\w\\*]+:[\\w\\*\\.]+(=.*)?)|\\*$/,\n\n\t\t/**\n\t\t * Class used to represent an {@link playtotv.model.AbstractModel} Subscription.\n\t\t *\n\t\t * @extends playtotv.pubsub.Subscription\n\t\t * @constructs\n\t\t * @param {string} selector Model selector string\n\t\t * @param {Function} handler Subscription callback\n\t\t * @throws {Error} If selector string is invalid\n\t\t *\n\t\t * @property {string|RegExp} selector Model selector string converted to channel string or RegExp\n\t\t * @property {Function} handler Subscription callback\n\t\t */\n\t\tinitialize: function(selector, handler) {\n\t\t\tif (!this.selectorRegex.test(selector)) {\n\t\t\t\tthrow new Error('Invalid selector string: ' + selector);\n\t\t\t}\n\n\t\t\t// Convert model selector into RegExp\n\t\t\tif (selector === '*') {\n\t\t\t\tselector = /.*/;\n\t\t\t} else {\n\t\t\t\tvar noValue = selector.indexOf('=') === -1;\n\t\t\t\tif (noValue) {\n\t\t\t\t\tselector += '=';\n\t\t\t\t}\n\t\t\t\tif (noValue || selector.indexOf('*') !== -1) {\n\t\t\t\t\tselector = util.escapeRegEx(selector);\n\t\t\t\t\tselector = selector.replace(/\\\\\\*/g, '[^:\\\\.=]+');\n\t\t\t\t\tselector = new RegExp('^' + selector);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._super(selector, handler);\n\t\t},\n\n\t\t/**\n\t\t * Deliver data to handler.\n\t\t *\n\t\t * If subscription has been disposed then handler will no longer be called.\n\t\t *\n\t\t * Handler will be called with this subscription as thisArg and data.value, data.action, data.key as arguments.\n\t\t *\n\t\t * @param {mixed} [data] Data to deliver\n\t\t * @param {string} channel Channel we are delivering to\n\t\t */\n\t\tdeliver: function(data/*, channel*/) {\n\t\t\tif (this.handler) {\n\t\t\t\tthis.handler(data.value, data.action, data.key);\n\t\t\t}\n\t\t}\n\t});\n});\n",
		"playtotv.define('playtotv.pubsub.PubSub', [\n\t'playtotv.pubsub.Subscription'\n], function(\n\tSubscription\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\n\tfunction remove(list, item) {\n\t\tvar index = list.indexOf(item);\n\t\tif (index !== -1) {\n\t\t\tlist.splice(index, 1);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\treturn new ptv.Class({\n\t\t/** @lends playtotv.pubsub.PubSub.prototype */\n\n\t\t/**\n\t\t * Class for managing publishing of data to handlers subscribed to channels.\n\t\t *\n\t\t * @constructs\n\t\t *\n\t\t * @property {[playtotv.pubsub.Subscription]} subscriptions Subscriptions container array\n\t\t * @property {[Promise.Cancellable]} cancellables List of active cancellables\n\t\t */\n\t\tinitialize: function() {\n\t\t\tthis.subscriptions = [];\n\t\t\tthis.cancellables = [];\n\t\t},\n\n\t\t/**\n\t\t * Creates and adds a subscription.\n\t\t *\n\t\t * @param {string|RegExp} selector Channel selector\n\t\t * @param {Function} handler Subscription callback\n\t\t * @throws {TypeError} If selector or handler is invalid\n\t\t * @returns {playtotv.pubsub.Subscription} Added subscription\n\t\t */\n\t\tsubscribe: function(selector, handler) {\n\t\t\tvar subscription = new Subscription(selector, handler);\n\t\t\tthis.subscriptions.push(subscription);\n\t\t\treturn subscription;\n\t\t},\n\n\t\t/**\n\t\t * Removes and disposes a subscription.\n\t\t *\n\t\t * @param {playtotv.pubsub.Subscription} subscription Subscription to remove\n\t\t * @returns {boolean} True if subscription was successfully removed\n\t\t */\n\t\tunsubscribe: function(subscription) {\n\t\t\tvar subscriptions = this.subscriptions;\n\t\t\tsubscription.dispose();\n\t\t\treturn subscriptions ? remove(subscriptions, subscription) : false;\n\t\t},\n\n\t\t/**\n\t\t * Convenience method to make a number of subscriptions at once.\n\t\t *\n\t\t * @param {Array} args Array of argument arrays to apply to {@link playtotv.pubsub.PubSub#subscribe}\n\t\t * @returns {[playtotv.pubsub.Subscription]} Array of subscriptions\n\t\t */\n\t\tsubscribeAll: function(args) {\n\t\t\tvar i, len = args.length;\n\t\t\tvar subscriptions = [];\n\t\t\tfor (i = 0; i < len; i++) {\n\t\t\t\tsubscriptions.push(this.subscribe.apply(this, args[i]));\n\t\t\t}\n\t\t\treturn subscriptions;\n\t\t},\n\n\t\t/**\n\t\t * Convenience method to remove a number of subscriptions at once.\n\t\t *\n\t\t * @param {[playtotv.pubsub.Subscription]} [subscriptions=this.subscriptions] Subscriptions to unsubscribe\n\t\t */\n\t\tunsubscribeAll: function(subscriptions) {\n\t\t\tsubscriptions = subscriptions || this.subscriptions;\n\t\t\tvar i, len = subscriptions.length;\n\t\t\tfor (i = 0; i < len; i++) {\n\t\t\t\tthis.unsubscribe(subscriptions[i]);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Creates a one-time subscription and returns a cancellable promise that resolves on it's first match.\n\t\t *\n\t\t * A reference is also added to cancellables so that it can be cancelled on dispose.\n\t\t *\n\t\t * @param {string} selector Selector to match\n\t\t * @returns {Promise.Cancellable} Cancellable promise which will resolve when selector first matches\n\t\t */\n\t\twhen: function(selector) {\n\t\t\tvar cancellables = this.cancellables;\n\t\t\tvar pubsub = this;\n\t\t\treturn new Promise.Cancellable(function(resolve) {\n\t\t\t\tvar cancellable = this;\n\t\t\t\tcancellables.push(cancellable);\n\n\t\t\t\tvar subscription = pubsub.subscribe(selector, function(data) {\n\t\t\t\t\tresolve(data);\n\t\t\t\t});\n\n\t\t\t\tcancellable.finally(function() {\n\t\t\t\t\tpubsub.unsubscribe(subscription);\n\t\t\t\t\tremove(cancellables, cancellable);\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Publish data to specified channel and notify all subscribers with matching selectors.\n\t\t *\n\t\t * The handler is called asynchronously to provide consistent code execution order.\n\t\t * As an added benefit this also prevents an exception in one callback from interrupting any other callbacks.\n\t\t *\n\t\t * @param {string} channel Channel to publish to\n\t\t * @param {mixed} [data] Data to publish\n\t\t * @param {boolean} [sync=false] Publish synchronously (beware of exceptions!)\n\t\t */\n\t\tpublish: function(channel, data, sync) {\n\t\t\t// Code below has been optimized for performance, hence no pretty use of forEach etc.\n\t\t\tvar subscriptions = this.subscriptions;\n\t\t\tvar len = subscriptions.length;\n\t\t\tvar i, subscription, match;\n\t\t\tfor (i = 0; i < len; i++) {\n\t\t\t\tsubscription = subscriptions[i];\n\t\t\t\tmatch = subscription.match(channel);\n\t\t\t\tif (match) {\n\t\t\t\t\tif (sync) {\n\t\t\t\t\t\tsubscription.deliver(data, channel);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// TODO: Add matches as third argument in case you specified a RegExp as selector\n\t\t\t\t\t\t// And with wildcard selector strings\n\t\t\t\t\t\t// Or as second argument (instead of full channel)\n\t\t\t\t\t\t// That way you can easily subscribe to 'foo-*' and then deal with the value of '*'\n\t\t\t\t\t\tnextTick(subscription.deliver, subscription, [ data, channel ]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Dispose.\n\t\t */\n\t\tdispose: function() {\n\t\t\t// TODO: Extract this (and eventListeners etc. from Widget) into generic Disposable class\n\t\t\t// And/or automatically detect any properties that are (arrays of) instances of Disposable?\n\t\t\t// And/or just keep track of disposables and make Cancellable etc. Disposable\n\t\t\tthis.subscriptions.forEach(function(subscription) {\n\t\t\t\tsubscription.dispose();\n\t\t\t});\n\n\t\t\tthis.cancellables.forEach(function(cancellable) {\n\t\t\t\tcancellable.cancel(new Promise.CancellationError('Disposed'));\n\t\t\t});\n\n\t\t\tptv.dispose(this);\n\t\t}\n\t});\n});\n",
		"playtotv.define('playtotv.model.AbstractModel', [\n\t'playtotv.model.ModelSubscription',\n\t'playtotv.pubsub.PubSub'\n], function(\n\tModelSubscription,\n\tPubSub\n) {\n\n\t'use strict';\n\n\treturn new playtotv.Class({\n\t\t/** @lends playtotv.model.AbstractModel.prototype */\n\n\t\textend: PubSub,\n\n\t\t/**\n\t\t * Abstract model class that facilitates subscribing to mutations of data with handlers.\n\t\t *\n\t\t * Subscriptions are defined by selector strings which look like this: \"[action]:[key]=[value]\".\n\t\t * <ul>\n\t\t * <li>Both \"[action]\" and \"[key]\" can be replaced by \"*\" wildcards, matching all actions/key mutations.\n\t\t * <li>The special global wildcard selector \"*\" will match all mutations, also those of nested data.\n\t\t * <li>The optional \"=[value]\" will perform a simple value comparison casting value to string if necessary.\n\t\t * </ul>\n\t\t *\n\t\t * Possible actions are: \"add\", \"remove\", \"change\" and \"init\".\n\t\t *\n\t\t * Example selectors:\n\t\t * <ul>\n\t\t * <li>\"change:status=full\"\n\t\t * <li>\"change:status\"\n\t\t * <li>\"add:*\"\n\t\t * <li>\"*:status\"\n\t\t * <li>\"*\"\n\t\t * </ul>\n\t\t *\n\t\t * Handler callbacks take place asynchronously on the next 'tick', see {@link playtotv.pubsub.PubSub#publish}.\n\t\t * This should in general result with your model being in a more consistent state during callbacks.\n\t\t * Do note however that the handler value might not be in sync with the model state anymore during that time.\n\t\t * Depending on your use you will want to work with the published value or lookup the current model value.\n\t\t *\n\t\t * While a property is set to an AbstractModel value that child model's publishes will bubble up to this model.\n\t\t * It's key will be prefixed with that property's key and a dot.\n\t\t *\n\t\t * Note: This talks about object, property and key. For ArrayModels imagine array, item and index instead.\n\t\t *\n\t\t * @extends playtotv.pubsub.PubSub\n\t\t * @constructs\n\t\t */\n\t\tinitialize: function() {\n\t\t\tthis._super();\n\t\t},\n\n\t\t/**\n\t\t * Returns a shallowly de-modeled plain JavaScript Object copy of the model data.\n\t\t *\n\t\t * If any child properties are models, they will still be models in the copy.\n\t\t * To recursively de-model a model use {@link playtotv.model.modelUtil.toObject}.\n\t\t *\n\t\t * Note: This is an {@link playtotv.AbstractFunction}\n\t\t *\n\t\t * @function\n\t\t * @returns {Object} Plain JavaScript Object copy of the model data\n\t\t */\n\t\ttoObject: playtotv.AbstractFunction,\n\n\t\t/**\n\t\t * Updates model data to match that of specified plain JavaScript source Object.\n\t\t *\n\t\t * If any child properties are models, this model will be updated to refer to those models.\n\t\t * To recursively update a model use {@link playtotv.model.modelUtil.update}.\n\t\t *\n\t\t * Note: This is an {@link playtotv.AbstractFunction}\n\t\t *\n\t\t * @function\n\t\t * @param {Object} source Source data to update model to\n\t\t * @returns {[mixed]} Array with any removed values for garbage collection etc.\n\t\t */\n\t\tupdateModel: playtotv.AbstractFunction,\n\n\t\t/**\n\t\t * Returns true if this model or any of our child models equals specified root model.\n\t\t *\n\t\t * This can be used to test for and prevent creation of cyclic models leading to infinite publishes.\n\t\t *\n\t\t * Note: This is an {@link playtotv.AbstractFunction}\n\t\t *\n\t\t * @param {playtotv.model.AbstractModel} root Root model to compare to\n\t\t * @returns {boolean} True if this model has a cyclic relation to root\n\t\t */\n\t\tisRelatedModel: playtotv.AbstractFunction,\n\n\t\t/**\n\t\t * Returns the action from specified selector.\n\t\t *\n\t\t * @param {string} selector Model subscription selector\n\t\t * @return {string} The action from specified selector\n\t\t */\n\t\tgetSelectorAction: function(selector) {\n\t\t\tvar colonIndex = selector.indexOf(':');\n\t\t\treturn colonIndex === -1 ? undefined : selector.substr(0, colonIndex);\n\t\t},\n\n\t\t/**\n\t\t * Returns the key from specified selector.\n\t\t *\n\t\t * @param {string} selector Model subscription selector\n\t\t * @return {string} The key from specified selector\n\t\t */\n\t\tgetSelectorKey: function(selector) {\n\t\t\tvar colonIndex = selector.indexOf(':');\n\t\t\tif (colonIndex === -1) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\tvar key = selector.substring(colonIndex + 1);\n\t\t\tvar eqIndex = key.indexOf('=');\n\t\t\treturn eqIndex === -1 ? key : key.substring(0, eqIndex);\n\t\t},\n\n\t\t/**\n\t\t * Returns the value from specified selector.\n\t\t *\n\t\t * @param {string} selector Model subscription selector\n\t\t * @return {string} The value from specified selector\n\t\t */\n\t\tgetSelectorValue: function(selector) {\n\t\t\tvar eqIndex = selector.indexOf('=');\n\t\t\treturn eqIndex === -1 ? undefined : selector.substring(eqIndex + 1);\n\t\t},\n\n\t\t/**\n\t\t * Returns an Array of {key, value} property tuples that match specified selector.\n\t\t *\n\t\t * <ul>\n\t\t * <li>\"[add/change/*]:[key]=[value]\": property with matching [key] and [value]\n\t\t * <li>\"[add/change/*]:[*]=[value]\": property with matching [value]\n\t\t * <li>\"[add/change/*]:[key]\": property with matching [key]\n\t\t * <li>\"[add/change/*]:*\": all of this object's properties\n\t\t * <li>\"*\": is equal to \"*:*\" for the sake of this type of matching\n\t\t * </ul>\n\t\t *\n\t\t * @param {string} selector Model subscription selector\n\t\t * @throws {Error} If selector matching is not supported\n\t\t * @returns {[Object]} Array of matching {key, value} tuples\n\t\t */\n\t\tgetSelectorMatches: function(selector) {\n\t\t\tvar action = this.getSelectorAction(selector) || '*';\n\t\t\tvar key = this.getSelectorKey(selector) || '*';\n\t\t\tvar val = this.getSelectorValue(selector);\n\n\t\t\tif (action === 'remove') {\n\t\t\t\tthrow new Error('Matching with remove action selector is not supported: ' + selector);\n\t\t\t}\n\t\t\tif (!key || key.indexOf('.') !== -1) {\n\t\t\t\tthrow new Error('Only basic key matching is supported: ' + selector);\n\t\t\t}\n\n\t\t\tvar matches = [];\n\t\t\tplaytotv.each(this.toObject(), function(v, k) {\n\t\t\t\tif (key !== '*' && k !== key) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (val !== undefined && String(v) !== val) { // includes 'undefined'\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tmatches.push({ key: k, value: v });\n\t\t\t});\n\t\t\treturn matches;\n\t\t},\n\n\t\t/**\n\t\t * Subscribe handler to specified selector.\n\t\t *\n\t\t * This overrides {@link playtotv.pubsub.PubSub#subscribe}.\n\t\t *\n\t\t * If init is true then handler will be called with action \"init\" on nextTick for each match returned by\n\t\t * {@link playtotv.model.AbstractModel#getSelectorMatches}.\n\t\t *\n\t\t * @param {string} selector Selector to match\n\t\t * @param {Function} handler Handler to call on mutation with value, action and key arguments\n\t\t * @param {boolean} [init=false] If true then initialize by publishing current value(s)\n\t\t * @throws {Error} If init is true but selector matching is not supported\n\t\t * @returns {playtotv.model.ModelSubscription} Subscription\n\t\t */\n\t\tsubscribe: function(selector, handler, init) {\n\t\t\tvar subscription = new ModelSubscription(selector, handler);\n\n\t\t\tif (init) {\n\t\t\t\tthis.getSelectorMatches(selector).forEach(function(match) {\n\t\t\t\t\tvar key = match.key;\n\t\t\t\t\tvar value = match.value;\n\t\t\t\t\tvar channel = 'init:' + key + '=' + value;\n\t\t\t\t\tvar data = { key: key, action: 'init', value: value };\n\t\t\t\t\tnextTick(subscription.deliver, subscription, [ data, channel ]);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.subscriptions.push(subscription);\n\t\t\treturn subscription;\n\t\t},\n\n\t\t/**\n\t\t * Creates a one-time subscription and returns a promise that resolves on it's first match.\n\t\t *\n\t\t * This extends {@link playtotv.pubsub.PubSub#when} with initialization support.\n\t\t * If selector value is defined and specified selector matches the model's current value\n\t\t * then this will immediately return a Cancellable that is resolved with the first matching value.\n\t\t *\n\t\t * @param {string} selector Selector to match\n\t\t * @returns {Promise.Cancellable} Cancellable promise which will resolve when selector first matches\n\t\t */\n\t\twhen: function(selector) {\n\t\t\tif (this.getSelectorValue(selector) !== undefined) {\n\t\t\t\tvar matches = this.getSelectorMatches(selector);\n\t\t\t\tif (matches.length > 0) {\n\t\t\t\t\treturn Promise.Cancellable.resolve(matches[0].value);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn PubSub.prototype.when.call(this, selector);\n\t\t},\n\n\t\t/**\n\t\t * Publish an action with value on property specified by key.\n\t\t *\n\t\t * This overrides and delegates to {@link playtotv.pubsub.PubSub#publish}.\n\t\t *\n\t\t * @param {string} key\n\t\t * @param {string} action\n\t\t * @param {mixed} value\n\t\t */\n\t\tpublish: function(key, action, value) {\n\t\t\tvar channel = action + ':' + key + '=' + value;\n\t\t\tvar data = { key: key, action: action, value: value };\n\t\t\tPubSub.prototype.publish.call(this, channel, data);\n\t\t}\n\t});\n});\n",
		"playtotv.define('playtotv.model.ObjectModel', [\n\t'playtotv.model.AbstractModel'\n], function(\n\tAbstractModel\n) {\n\n\t'use strict';\n\n\treturn new playtotv.Class({\n\t\t/** @lends playtotv.model.ObjectModel.prototype */\n\n\t\textend: AbstractModel,\n\n\t\t/**\n\t\t * Concrete implementation of {@link playtotv.model.AbstractModel} for storing Object properties.\n\t\t *\n\t\t * If a source object is specified then it's properties will be copied using\n\t\t * {@link playtotv.model.ObjectModel#copyProperties}.\n\t\t *\n\t\t * Reading and iterating:\n\t\t * <ul>\n\t\t * <li>For basic read access you can simply access the properties of this model\n\t\t * <li>This model does however have some extra Class properties and methods\n\t\t * </ul>\n\t\t *\n\t\t * Modify and publish methods:\n\t\t * <ul>\n\t\t * <li>{@link playtotv.model.ObjectModel#addProperty}\n\t\t * <li>{@link playtotv.model.ObjectModel#removeProperty}\n\t\t * <li>{@link playtotv.model.ObjectModel#changeProperty}\n\t\t * <li>{@link playtotv.model.ObjectModel#setProperty}\n\t\t * <li>{@link playtotv.model.ObjectModel#copyProperties}\n\t\t * </ul>\n\t\t *\n\t\t * Note: Only modify this model's properties through the above methods!\n\t\t *\n\t\t * @extends playtotv.model.AbstractModel\n\t\t * @constructs\n\t\t * @param {Object} [source] Source object to copy into this model\n\t\t *\n\t\t * @property {[string]} propertyKeys This model's property keys\n\t\t * @property {Object} childSubscriptionMap Map of property keys to child model subscriptions\n\t\t */\n\t\tinitialize: function(source) {\n\t\t\tthis._super();\n\n\t\t\tthis.propertyKeys = [];\n\t\t\tthis.childSubscriptionMap = {};\n\n\t\t\tif (source) {\n\t\t\t\tthis.copyProperties(source);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Implementation of {@link playtotv.model.AbstractModel#toObject}.\n\t\t *\n\t\t * @returns {Object} Plain JavaScript Object copy of the model data\n\t\t */\n\t\ttoObject: function() {\n\t\t\tvar obj = {};\n\t\t\tvar keys = this.propertyKeys;\n\t\t\tvar keysLength = keys.length;\n\t\t\tvar i, key;\n\t\t\tfor (i = 0; i < keysLength; i++) {\n\t\t\t\tkey = keys[i];\n\t\t\t\tobj[key] = this[key];\n\t\t\t}\n\t\t\treturn obj;\n\t\t},\n\n\t\t/**\n\t\t * Implementation of {@link playtotv.model.AbstractModel#updateModel}.\n\t\t *\n\t\t * Properties are {@link playtotv.model.ObjectModel#removeProperty}d, then\n\t\t * {@link playtotv.model.ObjectModel#addProperty}ed and then {@link playtotv.model.ObjectModel#changeProperty}d.\n\t\t *\n\t\t * @param {Object} source Source data to update model to\n\t\t * @returns {[mixed]} Array with any removed values for garbage collection etc.\n\t\t */\n\t\tupdateModel: function(source) {\n\t\t\tvar keys = this.propertyKeys;\n\t\t\tvar sourceKeys = Object.keys(source);\n\t\t\tvar removedValues = [];\n\n\t\t\tkeys.filter(function(key) {\n\t\t\t\treturn sourceKeys.indexOf(key) === -1;\n\t\t\t}).forEach(function(key) {\n\t\t\t\tremovedValues.push(this.removeProperty(key));\n\t\t\t}.bind(this));\n\n\t\t\tsourceKeys.filter(function(sourceKey) {\n\t\t\t\treturn keys.indexOf(sourceKey) === -1;\n\t\t\t}).forEach(function(sourceKey) {\n\t\t\t\tthis.addProperty(sourceKey, source[sourceKey]);\n\t\t\t}.bind(this));\n\n\t\t\tsourceKeys.filter(function(sourceKey) {\n\t\t\t\treturn keys.indexOf(sourceKey) !== -1;\n\t\t\t}).forEach(function(sourceKey) {\n\t\t\t\tremovedValues.push(this.changeProperty(sourceKey, source[sourceKey]));\n\t\t\t}.bind(this));\n\n\t\t\treturn removedValues;\n\t\t},\n\n\t\t/**\n\t\t * Implementation of {@link playtotv.model.AbstractModel#isRelatedModel}.\n\t\t *\n\t\t * @param {playtotv.model.AbstractModel} root Root model to compare to\n\t\t * @returns {boolean} True if this model has a cyclic relation to root\n\t\t */\n\t\tisRelatedModel: function(root) {\n\t\t\tif (this === root) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tvar childSubscriptionMap = this.childSubscriptionMap;\n\t\t\tvar keys = Object.keys(childSubscriptionMap);\n\t\t\tvar keysLength = keys.length;\n\t\t\tvar i, childModel;\n\n\t\t\tfor (i = 0; i < keysLength; i++) {\n\t\t\t\tchildModel = childSubscriptionMap[keys[i]].model;\n\t\t\t\tif (childModel instanceof AbstractModel) {\n\t\t\t\t\tif (childModel.isRelatedModel(root)) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\n\t\t/**\n\t\t * Subscribe to child model to have it's publishes bubble up to this one.\n\t\t *\n\t\t * Note: It is required that child model is not in a cyclic relationship with this model.\n\t\t *\n\t\t * @param {string} key Child model key\n\t\t * @param {playtotv.model.AbstractModel} child Child model to subscribe to\n\t\t */\n\t\tsubscribeChild: function(key, child) {\n\t\t\tvar subscription = child.subscribe('*', function(childValue, childAction, childKey) {\n\t\t\t\tthis.publish(key + '.' + childKey, childAction, childValue);\n\t\t\t}.bind(this));\n\n\t\t\tthis.childSubscriptionMap[key] = {\n\t\t\t\tmodel: child,\n\t\t\t\tsubscription: subscription\n\t\t\t};\n\t\t},\n\n\t\t/**\n\t\t * Unsubscribe child model so it's publishes no longer bubble up to this one.\n\t\t *\n\t\t * @param {string} key Child model key\n\t\t */\n\t\tunsubscribeChild: function(key) {\n\t\t\tvar childSubscriptionMap = this.childSubscriptionMap;\n\t\t\tvar childSubscription = childSubscriptionMap[key];\n\t\t\tchildSubscription.model.unsubscribe(childSubscription.subscription);\n\t\t\tdelete childSubscriptionMap[key];\n\t\t},\n\n\t\t/**\n\t\t * Add property with specified key and value to this model.\n\t\t *\n\t\t * @param {string} key\n\t\t * @param {mixed} value\n\t\t * @throws {Error} If property with specified key already exists\n\t\t * @throws {Error} If specified key is reserved\n\t\t * @throws {Error} If value is a model in a cyclic relationship with this model\n\t\t */\n\t\taddProperty: function(key, value) {\n\t\t\tvar keys = this.propertyKeys;\n\t\t\tvar valueIsModel = value instanceof AbstractModel;\n\n\t\t\tif (keys.indexOf(key) !== -1) {\n\t\t\t\tthrow new Error('Property with specified key already exists: ' + key);\n\t\t\t}\n\t\t\tif (key in this) {\n\t\t\t\tthrow new Error('Specified key is reserved: ' + key);\n\t\t\t}\n\t\t\tif (valueIsModel && value.isRelatedModel(this)) {\n\t\t\t\tthrow new Error('Value is a model in a cyclic relationship with this model');\n\t\t\t}\n\n\t\t\tkeys.push(key);\n\t\t\tthis[key] = value;\n\n\t\t\tif (valueIsModel) {\n\t\t\t\tthis.subscribeChild(key, value);\n\t\t\t}\n\n\t\t\tthis.publish(key, 'add', value);\n\t\t},\n\n\t\t/**\n\t\t * Change property specified by key to specified value.\n\t\t *\n\t\t * @param {string} key\n\t\t * @param {mixed} value\n\t\t * @param {Object} [options]\n\t\t * @param {boolean} [options.force] If true then force change even if value is equal to old value\n\t\t * @param {boolean} [options.json] If true then use JSON.stringify to compare value with old value\n\t\t * @throws {Error} If property with specified key does not exist\n\t\t * @throws {Error} If value is a model in a cyclic relationship with this model\n\t\t * @returns {mixed} Removed value (if any) for garbage collection etc.\n\t\t */\n\t\tchangeProperty: function(key, value, options) {\n\t\t\t/*jshint maxcomplexity:10*/\n\t\t\toptions = options || {};\n\t\t\tvar oldValue = this[key];\n\t\t\tvar valueIsModel = value instanceof AbstractModel;\n\n\t\t\tif (this.propertyKeys.indexOf(key) === -1) {\n\t\t\t\tthrow new Error('Property with specified key does not exist: ' + key);\n\t\t\t}\n\n\t\t\tif (!options.force) {\n\t\t\t\tif (value === oldValue || options.json && JSON.stringify(value) === JSON.stringify(oldValue)) {\n\t\t\t\t\treturn; // no change\n\t\t\t\t}\n\t\t\t\tif (valueIsModel && value.isRelatedModel(this)) {\n\t\t\t\t\tthrow new Error('Value is a model in a cyclic relationship with this model');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (oldValue instanceof AbstractModel) {\n\t\t\t\tthis.unsubscribeChild(key);\n\t\t\t}\n\n\t\t\tthis[key] = value;\n\n\t\t\tif (valueIsModel) {\n\t\t\t\tthis.subscribeChild(key, value);\n\t\t\t}\n\n\t\t\tthis.publish(key, 'change', value);\n\n\t\t\treturn oldValue;\n\t\t},\n\n\t\t/**\n\t\t * Remove property with specified key from this model.\n\t\t *\n\t\t * @param {string} key\n\t\t * @throws {Error} If property with specified key does not exist\n\t\t * @returns {mixed} Removed value for garbage collection etc.\n\t\t */\n\t\tremoveProperty: function(key) {\n\t\t\tvar keys = this.propertyKeys;\n\t\t\tvar index = keys.indexOf(key);\n\t\t\tvar oldValue = this[key];\n\n\t\t\tif (index === -1) {\n\t\t\t\tthrow new Error('Property with specified key does not exist: ' + key);\n\t\t\t}\n\n\t\t\tif (oldValue instanceof AbstractModel) {\n\t\t\t\tthis.unsubscribeChild(key);\n\t\t\t}\n\n\t\t\tkeys.splice(index, 1);\n\t\t\tdelete this[key];\n\n\t\t\tthis.publish(key, 'remove', oldValue);\n\n\t\t\treturn oldValue;\n\t\t},\n\n\t\t/**\n\t\t * Either calls {@link playtotv.model.ObjectModel#addProperty} or\n\t\t * {@link playtotv.model.ObjectModel#changeProperty} depending on property existence.\n\t\t *\n\t\t * @param {string} key Argument to addProperty or changeProperty\n\t\t * @param {mixed} value Argument to addProperty or changeProperty\n\t\t * @param {Object} [options] Options to pass to changeProperty\n\t\t * @returns {mixed} Removed value (if any) for garbage collection etc.\n\t\t */\n\t\tsetProperty: function(key, value, options) {\n\t\t\tif (this.propertyKeys.indexOf(key) === -1) {\n\t\t\t\tthis.addProperty(key, value);\n\t\t\t} else {\n\t\t\t\treturn this.changeProperty(key, value, options);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Copy all properties from specified source object to this model using\n\t\t * {@link playtotv.model.ObjectModel#setProperty}.\n\t\t *\n\t\t * This will change existing properties and add them if they were missing, but it will not remove them.\n\t\t * To have this model data match source use {@link playtotv.model.ObjectModel#updateModel}.\n\t\t *\n\t\t * @param {Object} source Source to copy from\n\t\t * @returns {[mixed]} Array with any removed values for garbage collection etc.\n\t\t */\n\t\tcopyProperties: function(source) {\n\t\t\tvar removedValues = [];\n\t\t\tfor (var key in source) {\n\t\t\t\tif (source.hasOwnProperty(key)) {\n\t\t\t\t\tremovedValues.push(this.setProperty(key, source[key]));\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn removedValues;\n\t\t},\n\n\t\t/**\n\t\t * Dispose keys and child subscriptions.\n\t\t *\n\t\t * Note: Do not forget to also dispose any child models that are no longer used.\n\t\t */\n\t\tdispose: function() {\n\t\t\tplaytotv.each(this.childSubscriptionMap, function(childSubscription) {\n\t\t\t\tchildSubscription.model.unsubscribe(childSubscription.subscription);\n\t\t\t});\n\n\t\t\tAbstractModel.prototype.dispose.call(this);\n\t\t}\n\t});\n});\n",
		"playtotv.define('playtotv.facebook.Facebook', [\n\t'playtotv.model.ObjectModel'\n], function(\n\tObjectModel\n) {\n\n\t'use strict';\n\n\t////////// Private variables\n\n\tvar ptv = playtotv;\n\tvar util = ptv.util;\n\tvar log = ptv.Logger.get(this.id);\n\tvar REQUIRED = ptv.REQUIRED;\n\n\t////////// Class declaration\n\n\treturn new ptv.Class({\n\t\t/** @lends playtotv.facebook.Facebook.prototype */\n\n\t\textend: ObjectModel,\n\n\t\t/**\n\t\t * Class facilitating use of Facebook's JavaScript API.\n\t\t *\n\t\t * Note: Use redirect when popups are unusual or even unusable, e.g: on touch devices or within other apps.\n\t\t *\n\t\t * TODO: Rewrite to use and support Promise.Cancellable and have apps set and deal with timeouts themselves.\n\t\t * Also try to improve the ability of this code to recover from issues automatically (e.g. reload script).\n\t\t *\n\t\t * @extends playtotv.model.ObjectModel\n\t\t * @constructs\n\t\t * @param {Options} options\n\t\t * @param {string} options.appId Facebook App Id to use\n\t\t * @param {string} [options.version='v2.3'] API version to use\n\t\t * @param {string} [options.cookie=false] Create session cookie or not\n\t\t * @param {string} [options.status=true] Refresh user login status on init\n\t\t * @param {string} [options.xfbml=false] Parse social plugin XFBML tags\n\t\t * @param {string} [options.frictionlessRequests=false] Enable Frictionless Requests for games\n\t\t * @param {string} [options.hideFlashCallback=null] Callback to hide any Adobe Flash objects\n\t\t * @param {string} [options.locale='en_US'] Facebook API locale\n\t\t * @param {string} [options.redirect] If defined, redirect using this URL instead of showing popup/.. dialogs\n\t\t * @param {string} [options.scope] Comma separated list of extended permissions to require when you login\n\t\t * @param {number} [options.timeout=20000] Initialization timeout in ms\n\t\t *\n\t\t * @property {string} status Subscribable: Current Facebook API status\n\t\t * @property {string} id Subscribable: If connected then your Facebook user id, otherwise null\n\t\t * @property {string} accessToken Subscribable: If connected then your accessToken, otherwise null\n\t\t * @property {string} signedRequest Subscribable: If connected then your signedRequest, otherwise null\n\t\t */\n\t\tinitialize: function(options) {\n\t\t\tthis._super({\n\t\t\t\tstatus: null,\n\t\t\t\tid: null,\n\t\t\t\taccessToken: null,\n\t\t\t\tsignedRequest: null\n\t\t\t});\n\n\t\t\toptions = ptv.params(options, {\n\t\t\t\tappId: REQUIRED,\n\t\t\t\tversion: 'v2.3',\n\t\t\t\tcookie: false,\n\t\t\t\tstatus: true,\n\t\t\t\txfbml: false, // seems pointless with dynamic html\n\t\t\t\tfrictionlessRequests: false,\n\t\t\t\thideFlashCallback: null,\n\n\t\t\t\tlocale: 'en_US',\n\t\t\t\tredirect: undefined,\n\t\t\t\tscope: undefined,\n\t\t\t\ttimeout: 20000\n\t\t\t});\n\n\t\t\t// TODO: Rewrite without use of Promise.defer()\n\t\t\tvar deferred = Promise.defer();\n\n\t\t\tthis.appId = options.appId;\n\t\t\tthis.version = options.version;\n\t\t\tthis.locale = options.locale;\n\t\t\tthis.redirect = options.redirect;\n\t\t\tthis.scope = options.scope;\n\n\t\t\t////////// Documented properties\n\n\t\t\t/**\n\t\t\t * Promise of initialization, rejected in case of timeout.\n\t\t\t * @type Promise\n\t\t\t */\n\t\t\tthis.initialized = new Promise.Cancellable(function(resolve, reject) {\n\t\t\t\tdeferred.promise.then(resolve, reject);\n\t\t\t\tif (options.timeout) {\n\t\t\t\t\tthis.setTimeout(options.timeout);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t////////// Initialize\n\t\t\twindow.fbAsyncInit = function() {\n\t\t\t\tvar FB = window.FB;\n\n\t\t\t\tFB.init(ptv.pick(options, [\n\t\t\t\t\t'appId', 'version', 'cookie', 'status', 'xfbml', 'frictionlessRequests', 'hideFlashCallback'\n\t\t\t\t]));\n\n\t\t\t\tFB.Event.subscribe('auth.authResponseChange', this.onStatusResponse);\n\n\t\t\t\t// Get login status now to get started with the current session\n\t\t\t\tFB.getLoginStatus(function(response) {\n\t\t\t\t\tthis.onStatusResponse(response);\n\t\t\t\t\tdeferred.resolve(FB);\n\t\t\t\t}.bind(this));\n\t\t\t}.bind(this);\n\n\t\t\tptv.loadScript('//connect.facebook.net/' + this.locale + '/sdk.js', true);\n\t\t},\n\n\t\t////////// Undocumented methods\n\n\t\tonStatusResponse: function(response) {\n\t\t\tvar authResponse = response.authResponse || {};\n\t\t\tthis.copyProperties({\n\t\t\t\tstatus: response.status,\n\t\t\t\tid: authResponse.userID || null,\n\t\t\t\taccessToken: authResponse.accessToken || null,\n\t\t\t\tsignedRequest: authResponse.signedRequest || null\n\t\t\t});\n\t\t},\n\n\t\t////////// Documented methods\n\n\t\t/**\n\t\t * Generic FB function wrapper adding support for timeout, error reporting and promise.\n\t\t *\n\t\t * Any further arguments past the timeout argument are passed to the FB function being called.\n\t\t *\n\t\t * Note: This assumes that the last argument of the FB.[what] function is a response callback function.\n\t\t *\n\t\t * @param {string} what Name of function to call on FB (e.g: 'api' for FB.api())\n\t\t * @param {number} [timeout=20000] Timeout in ms (beware of user interaction!) (falsy to disable)\n\t\t * @return {Promise} Promise of FB call response, rejected if response.error is set or call times out\n\t\t */\n\t\tcall: function(what, timeout) {\n\t\t\ttimeout = timeout !== undefined ? timeout : 20000;\n\n\t\t\tvar args = ptv.toArray(arguments).slice(2);\n\t\t\tvar details = { what: what, timeout: timeout, args: args };\n\n\t\t\tlog.s('FB.' + what + '(', args, '), timeout: ' + timeout);\n\n\t\t\tvar cancellable = this.initialized.then(function(FB) {\n\t\t\t\t// TODO: Rewrite without use of Promise.defer()\n\t\t\t\tvar deferred = Promise.defer();\n\n\t\t\t\targs.push(function(response) {\n\t\t\t\t\tif (response && response.error) {\n\t\t\t\t\t\t// Note: usual properties: message, code, error_subcode, error_user_msg, error_user_title\n\t\t\t\t\t\t// See: https://developers.facebook.com/docs/graph-api/using-graph-api/v2.3#errors\n\t\t\t\t\t\tdeferred.reject(ptv.extend(new Error('Call failed'), details, response.error, {\n\t\t\t\t\t\t\tmessage: 'Request error: ' + response.error.message\n\t\t\t\t\t\t}));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdeferred.resolve(response);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tFB[what].apply(FB, args);\n\n\t\t\t\treturn deferred.promise;\n\t\t\t});\n\n\t\t\t// TODO: Remove timeout arg here and leave it to calling code to add timeout on returned Cancellable\n\t\t\tif (timeout) {\n\t\t\t\tvar timeoutDetails = ptv.extend({ message: 'Request timeout' }, details);\n\t\t\t\tcancellable.setTimeout(timeout, timeoutDetails);\n\t\t\t}\n\n\t\t\treturn cancellable;\n\t\t},\n\n\t\t/**\n\t\t * Shortcut to {@link playtotv.facebook.Facebook#call}('api', ..).\n\t\t *\n\t\t * TODO: Add support for paging.\n\t\t *\n\t\t * @return {Promise} As returned by {@link playtotv.facebook.Facebook#call}\n\t\t */\n\t\tapi: function() {\n\t\t\tvar args = ptv.toArray(arguments);\n\t\t\targs.unshift('api');\n\t\t\treturn this.call.apply(this, args);\n\t\t},\n\n\t\t/**\n\t\t * Shortcut to {@link playtotv.facebook.Facebook#call}('ui', false, ..).\n\t\t *\n\t\t * @return {Promise} As returned by {@link playtotv.facebook.Facebook#call}\n\t\t */\n\t\tui: function() {\n\t\t\tvar args = ptv.toArray(arguments);\n\t\t\targs.unshift('ui', false);\n\t\t\treturn this.call.apply(this, args);\n\t\t},\n\n\t\t/**\n\t\t * Returns friends who have used (via Facebook Login) the app making the request.\n\t\t *\n\t\t * Requires permission: user_friends\n\t\t *\n\t\t * @see <a href=\"https://developers.facebook.com/docs/graph-api/reference/v2.3/user/friends\">Graph API</a>\n\t\t *\n\t\t * @param {number} [timeout] {@link playtotv.facebook.Facebook#call} timeout\n\t\t * @return {Promise} Promise of array of friends\n\t\t */\n\t\tgetFriends: function(timeout) {\n\t\t\treturn this.api(timeout, '/me/friends').then(function(data) {\n\t\t\t\treturn data.data;\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Facility function for logging into Facebook.\n\t\t *\n\t\t * <ul>\n\t\t * <li>If you are already logged in this will resolve immediately.\n\t\t * <li>Otherwise if not interactive (e.g. asking for user input is disabled) this will reject.\n\t\t * <li>Otherwise if options.redirect is set this will use {@link playtotv.facebook.Facebook#loginByRedirect}.\n\t\t * <li>Otherwise this will use {@link playtotv.facebook.Facebook#loginByDialog}.\n\t\t * </ul>\n\t\t *\n\t\t * @param {boolean} [interactive=false] Whether to allow user interaction through a popup or redirect\n\t\t * @return {Promise} Promise of Facebook user id, rejected if cancelled by user\n\t\t */\n\t\tlogin: function(interactive) {\n\t\t\treturn this.initialized.then(function() {\n\t\t\t\tif (this.id) {\n\t\t\t\t\treturn Promise.resolve(this.id); // already logged in\n\t\t\t\t} else if (!interactive) {\n\t\t\t\t\treturn Promise.reject(new Error('Login requires user interaction'));\n\t\t\t\t} else if (this.redirect) {\n\t\t\t\t\tthis.loginByRedirect();\n\t\t\t\t\t// TODO: Rewrite without use of Promise.defer()\n\t\t\t\t\treturn Promise.defer().promise; // redirect does not resolve\n\t\t\t\t} else {\n\t\t\t\t\treturn this.loginByDialog();\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t},\n\n\t\t/**\n\t\t * Login to Facebook using FB popup dialog.\n\t\t *\n\t\t * TODO: Add support for options besides scope and move that out of Facebook options to login and loginByX\n\t\t *\n\t\t * @see <a href=\"https://developers.facebook.com/docs/reference/javascript/FB.login/v2.3\">SDK</a>\n\t\t *\n\t\t * @return {Promise} Promise of Facebook user id, rejected if cancelled by user\n\t\t */\n\t\tloginByDialog: function() {\n\t\t\treturn this.initialized.then(function(FB) {\n\t\t\t\t// Note: we can not use this.call() since the last argument is not the callback function with FB.login\n\t\t\t\t// TODO: Rewrite without use of Promise.defer()\n\t\t\t\tvar deferred = Promise.defer();\n\t\t\t\tFB.login(function(response) {\n\t\t\t\t\tif (response.authResponse && response.authResponse.userID) {\n\t\t\t\t\t\tdeferred.resolve(response.authResponse.userID);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdeferred.reject(ptv.extend(new Error('Login failed'), response)); // e.g. cancelled by user\n\t\t\t\t\t}\n\t\t\t\t}, { scope: this.scope });\n\t\t\t\treturn deferred.promise;\n\t\t\t}.bind(this));\n\t\t},\n\n\t\t/**\n\t\t * Login to Facebook by redirecting to Facebook and then having Facebook redirect back to us with a token.\n\t\t *\n\t\t * @see <a href=\"https://developers.facebook.com/docs/facebook-login/manually-build-a-login-flow/v2.3\">Docs</a>\n\t\t *\n\t\t * @param {string} [redirect=options.redirect] URL that Facebook should redirect back to once done\n\t\t */\n\t\tloginByRedirect: function(redirect) {\n\t\t\t/*jshint camelcase:false*/\n\t\t\t/*jscs:disable requireCamelCaseOrUpperCaseIdentifiers*/\n\t\t\twindow.top.location = util.addURLParams('https://www.facebook.com/' + this.version + '/dialog/oauth', {\n\t\t\t\tclient_id: this.appId,\n\t\t\t\tresponse_type: 'token',\n\t\t\t\tscope: this.scope || '',\n\t\t\t\tredirect_uri: redirect || this.redirect\n\t\t\t});\n\t\t\t/*jscs:enable requireCamelCaseOrUpperCaseIdentifiers*/\n\t\t},\n\n\t\t/**\n\t\t * Logout of Facebook using FB API.\n\t\t *\n\t\t * @param {number} [timeout] {@link playtotv.facebook.Facebook#call} timeout for logout\n\t\t * @return {Promise} Promise of an object with a status property\n\t\t */\n\t\tlogout: function(timeout) {\n\t\t\treturn this.initialized.then(function() {\n\t\t\t\treturn this.id ? this.call('logout', timeout) : Promise.resolve({ status: this.status });\n\t\t\t}.bind(this));\n\t\t},\n\n\t\t/**\n\t\t * Facility function for posting to Facebook.\n\t\t *\n\t\t * <ul>\n\t\t * <li>If interactive and options.redirect is set then use {@link playtotv.facebook.Facebook#postByRedirect}.\n\t\t * <li>Otherwise login using {@link playtotv.facebook.Facebook#login}.<br>\n\t\t * Note: The login will reject if not interactive and not already logged in.\n\t\t * <li>Then if interactive use {@link playtotv.facebook.Facebook#postByDialog}.\n\t\t * <li>Otherwise use {@link playtotv.facebook.Facebook#postByAPI}.\n\t\t * </ul>\n\t\t *\n\t\t *\n\t\t * @param {Object} params <a href=\"http://developers.facebook.com/docs/reference/dialogs/feed/\">FB Doc</a>\n\t\t * @param {boolean} [interactive=false] Whether to let user review and confirm message before posting\n\t\t * @param {number} [timeout] {@link playtotv.facebook.Facebook#postByAPI} timeout (not used while interactive)\n\t\t * @return {Promise} Promise of post_id\n\t\t */\n\t\tpost: function(params, interactive, timeout) {\n\t\t\tif (interactive && this.redirect) {\n\t\t\t\tthis.postByRedirect(params, this.redirect);\n\t\t\t\t// TODO: Rewrite without use of Promise.defer()\n\t\t\t\treturn Promise.defer().promise; // redirect does not resolve\n\t\t\t} else {\n\t\t\t\treturn this.login(interactive).then(function() {\n\t\t\t\t\treturn interactive ? this.postByDialog(params) : this.postByAPI(params, timeout);\n\t\t\t\t}.bind(this));\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Post to Facebook wall using FB API, e.g: in the background, without asking for user input.\n\t\t *\n\t\t * TODO: Updated this to v2.3 (this is still legacy v1.0 code which probably does not work anymore)\n\t\t *\n\t\t * Note: This requires the publish_stream extended permission; get it using options.scope.\n\t\t *\n\t\t * @param {Object} params <a href=\"http://developers.facebook.com/docs/reference/dialogs/feed/\">FB Doc</a>\n\t\t * @param {[type]} [timeout] {@link playtotv.facebook.Facebook#call} timeout for api feed post\n\t\t * @return {Promise} Promise of post_id\n\t\t */\n\t\tpostByAPI: function(params, timeout) {\n\t\t\treturn this.call('api', timeout, '/me/feed', 'post', params).then(function(response) {\n\t\t\t\t/*jshint camelcase:false*/\n\t\t\t\treturn response.id;\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Post to Facebook wall using FB UI dialog.\n\t\t *\n\t\t * @param {Object} params <a href=\"http://developers.facebook.com/docs/reference/dialogs/feed/\">FB Doc</a>\n\t\t * @return {Promise} Promise of post_id\n\t\t */\n\t\tpostByDialog: function(params) {\n\t\t\treturn this.ui(ptv.extend({\n\t\t\t\tmethod: 'feed'\n\t\t\t}, params)).then(function(response) {\n\t\t\t\t/*jshint camelcase:false*/\n\t\t\t\t/*jscs:disable requireCamelCaseOrUpperCaseIdentifiers*/\n\t\t\t\treturn response && response.post_id || Promise.reject(ptv.extend(new Error('Post failed'), response));\n\t\t\t\t/*jscs:enable requireCamelCaseOrUpperCaseIdentifiers*/\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Post to Facebook wall by redirecting to Facebook and then having Facebook redirect back to us.\n\t\t *\n\t\t * @param {Object} params <a href=\"http://developers.facebook.com/docs/reference/dialogs/feed/\">FB Doc</a>\n\t\t * @param {string} [redirect=options.redirect] URL that Facebook should redirect back to once done\n\t\t * @return {Promise} Promise of post_id\n\t\t */\n\t\tpostByRedirect: function(params, redirect) {\n\t\t\t/*jshint camelcase:false*/\n\t\t\t/*jscs:disable requireCamelCaseOrUpperCaseIdentifiers*/\n\t\t\twindow.top.location = util.addURLParams('https://www.facebook.com/dialog/feed', ptv.extend({\n\t\t\t\tapp_id: this.appId,\n\t\t\t\tredirect_uri: redirect || this.redirect\n\t\t\t}, params));\n\t\t\t/*jscs:enable requireCamelCaseOrUpperCaseIdentifiers*/\n\t\t},\n\n\t\t////////// Callback methods\n\n\t\tcallbacks: [\n\t\t\t'onStatusResponse'\n\t\t]\n\t});\n});\n",
		"playtotv.define('playtotv.model.ArrayModel', [\n\t'playtotv.model.AbstractModel'\n], function(\n\tAbstractModel\n) {\n\n\t'use strict';\n\n\tfunction countEqualItems(array, item) {\n\t\tvar count = 0;\n\t\tvar len = array.length;\n\t\tvar i;\n\t\tfor (i = 0; i < len; i++) {\n\t\t\tif (array[i] === item) {\n\t\t\t\tcount++;\n\t\t\t}\n\t\t}\n\t\treturn count;\n\t}\n\n\treturn new playtotv.Class({\n\t\t/** @lends playtotv.model.ArrayModel.prototype */\n\n\t\textend: AbstractModel,\n\n\t\t/**\n\t\t * Concrete implementation of {@link playtotv.model.AbstractModel} for storing an Array of items.\n\t\t *\n\t\t * If a source array is specified then it's items will be copied using {@link playtotv.model.ArrayModel#add}.\n\t\t *\n\t\t * Model items can be read and iterated etc. by using this instance's {@link playtotv.model.ArrayModel#array}\n\t\t * property.\n\t\t *\n\t\t * @extends playtotv.model.AbstractModel\n\t\t * @constructs\n\t\t * @param {Array} [source] Source array to copy into this model\n\t\t *\n\t\t * @property {Array} array Container of this model's items\n\t\t * @property {Array} childSubscriptions Array mapping item indexes to child model subscriptions\n\t\t */\n\t\tinitialize: function(source) {\n\t\t\tthis._super();\n\n\t\t\tthis.array = [];\n\t\t\tthis.childSubscriptions = [];\n\n\t\t\tif (source) {\n\t\t\t\tsource.forEach(function(item) {\n\t\t\t\t\tthis.add(item);\n\t\t\t\t}.bind(this));\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Implementation of {@link playtotv.model.AbstractModel#toObject}.\n\t\t *\n\t\t * @returns {Array} Plain JavaScript Array Object copy of the model data\n\t\t */\n\t\ttoObject: function() {\n\t\t\treturn this.array.slice(0);\n\t\t},\n\n\t\t/**\n\t\t * Implementation of {@link playtotv.model.AbstractModel#updateModel}.\n\t\t *\n\t\t * First tries to check whether JSON stringified versions of source and array are equal and aborts if so.\n\t\t *\n\t\t * Items are {@link playtotv.model.ArrayModel#remove}d from right to left then\n\t\t * {@link playtotv.model.ArrayModel#add}ed and then {@link playtotv.model.ArrayModel#change}d from left to\n\t\t * right.\n\t\t *\n\t\t * @param {Array} source Source data array to update model to\n\t\t * @returns {[mixed]} Array with any removed items for garbage collection etc.\n\t\t */\n\t\tupdateModel: function(source) {\n\t\t\tvar array = this.array;\n\t\t\tvar sourceLength = source.length;\n\t\t\tvar removedItems = [];\n\t\t\tvar i, item;\n\n\t\t\t// TODO: JSON stringify compare items individually to try to minimize number of removes, adds and changes\n\t\t\ttry {\n\t\t\t\tif (JSON.stringify(source) === JSON.stringify(array)) {\n\t\t\t\t\treturn [];\n\t\t\t\t}\n\t\t\t} catch (e) {}\n\n\t\t\tfor (i = array.length - 1; i >= 0; i--) {\n\t\t\t\titem = array[i];\n\t\t\t\tif (countEqualItems(source, item) < countEqualItems(array, item)) {\n\t\t\t\t\tremovedItems.push(this.remove(i));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (i = 0; i < sourceLength; i++) {\n\t\t\t\titem = source[i];\n\t\t\t\tif (countEqualItems(source, item) > countEqualItems(array, item)) {\n\t\t\t\t\tthis.add(item, i);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (i = 0; i < sourceLength; i++) {\n\t\t\t\tremovedItems.push(this.change(i, source[i]));\n\t\t\t}\n\n\t\t\treturn removedItems;\n\t\t},\n\n\t\t/**\n\t\t * Implementation of {@link playtotv.model.AbstractModel#isRelatedModel}.\n\t\t *\n\t\t * @param {playtotv.model.AbstractModel} root Root model to compare to\n\t\t * @returns {boolean} True if this model has a cyclic relation to root\n\t\t */\n\t\tisRelatedModel: function(root) {\n\t\t\t/*jshint maxdepth:4*/\n\n\t\t\tif (this === root) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tvar childSubscriptions = this.childSubscriptions;\n\t\t\tvar length = childSubscriptions.length;\n\t\t\tvar i, childSubscription, childModel;\n\n\t\t\tfor (i = 0; i < length; i++) {\n\t\t\t\tchildSubscription = childSubscriptions[i];\n\t\t\t\tif (childSubscription) {\n\t\t\t\t\tchildModel = childSubscription.model;\n\t\t\t\t\tif (childModel instanceof AbstractModel) {\n\t\t\t\t\t\tif (childModel.isRelatedModel(root)) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\n\t\t/**\n\t\t * Subscribe to child model to have it's publishes bubble up to this one.\n\t\t *\n\t\t * Note: It is required that child model is not in a cyclic relationship with this model.\n\t\t *\n\t\t * @param {number} index Child model index\n\t\t * @param {playtotv.model.AbstractModel} child Child model to subscribe to\n\t\t */\n\t\tsubscribeChild: function(index, child) {\n\t\t\tvar childSubscriptions = this.childSubscriptions;\n\n\t\t\tvar subscription = child.subscribe('*', function(childValue, childAction, childKey) {\n\t\t\t\t// Index could have changed\n\t\t\t\tindex = childSubscriptions.indexOf(childSubscription);\n\t\t\t\tthis.publish(index + '.' + childKey, childAction, childValue);\n\t\t\t}.bind(this));\n\n\t\t\tvar childSubscription = {\n\t\t\t\tmodel: child,\n\t\t\t\tsubscription: subscription\n\t\t\t};\n\n\t\t\tchildSubscriptions[index] = childSubscription;\n\t\t},\n\n\t\t/**\n\t\t * Unsubscribe child model so it's publishes no longer bubble up to this one.\n\t\t *\n\t\t * @param {number} index Child model index\n\t\t */\n\t\tunsubscribeChild: function(index) {\n\t\t\tvar childSubscriptions = this.childSubscriptions;\n\t\t\tvar childSubscription = childSubscriptions[index];\n\t\t\tchildSubscription.model.unsubscribe(childSubscription.subscription);\n\t\t\tchildSubscriptions[index] = null;\n\t\t},\n\n\t\t/**\n\t\t * Add item to this model.\n\t\t *\n\t\t * @param {mixed} item Item to add\n\t\t * @param {number} [index=array.length] Index at which to add item\n\t\t * @throws {RangeError} If index is out of bounds\n\t\t * @throws {Error} If item is a model in a cyclic relationship with this model\n\t\t */\n\t\tadd: function(item, index) {\n\t\t\tvar array = this.array;\n\t\t\tvar arrayLength = array.length;\n\t\t\tvar childSubscriptions = this.childSubscriptions;\n\t\t\tvar itemIsModel = item instanceof AbstractModel;\n\n\t\t\tif (arguments.length < 2) {\n\t\t\t\tindex = arrayLength;\n\t\t\t}\n\n\t\t\tif (index < 0) {\n\t\t\t\tthrow new RangeError('Index out of bounds: ' + index);\n\t\t\t}\n\t\t\tif (itemIsModel && item.isRelatedModel(this)) {\n\t\t\t\tthrow new Error('Item is a model in a cyclic relationship with this model');\n\t\t\t}\n\n\t\t\tif (index < arrayLength) {\n\t\t\t\tarray.splice(index, 0, item);\n\t\t\t\tchildSubscriptions.splice(index, 0, null);\n\t\t\t} else {\n\t\t\t\tarray[index] = item;\n\t\t\t\tchildSubscriptions[index] = null;\n\t\t\t}\n\n\t\t\tif (itemIsModel) {\n\t\t\t\tthis.subscribeChild(index, item);\n\t\t\t}\n\n\t\t\tthis.publish(index, 'add', item);\n\t\t},\n\n\t\t/**\n\t\t * Change item at specified index in this model.\n\t\t *\n\t\t * @param {number} index Index at which to change item\n\t\t * @param {mixed} item Item to change to\n\t\t * @throws {RangeError} If index is out of bounds\n\t\t * @throws {Error} If item is a model in a cyclic relationship with this model\n\t\t * @returns {mixed} Removed item (if any) for garbage collection etc.\n\t\t */\n\t\tchange: function(index, item) {\n\t\t\tvar array = this.array;\n\t\t\tvar itemIsModel = item instanceof AbstractModel;\n\n\t\t\tif (index < 0 || index >= array.length) {\n\t\t\t\tthrow new RangeError('Index out of bounds: ' + index);\n\t\t\t}\n\n\t\t\tvar oldItem = array[index];\n\n\t\t\tif (item === oldItem) {\n\t\t\t\treturn; // no change\n\t\t\t}\n\n\t\t\tif (itemIsModel && item.isRelatedModel(this)) {\n\t\t\t\tthrow new Error('Item is a model in a cyclic relationship with this model');\n\t\t\t}\n\n\t\t\tif (oldItem instanceof AbstractModel) {\n\t\t\t\tthis.unsubscribeChild(index);\n\t\t\t}\n\n\t\t\tarray[index] = item;\n\n\t\t\tif (itemIsModel) {\n\t\t\t\tthis.subscribeChild(index, item);\n\t\t\t}\n\n\t\t\tthis.publish(index, 'change', item);\n\n\t\t\treturn oldItem;\n\t\t},\n\n\t\t/**\n\t\t * Remove item with specified index from this model.\n\t\t *\n\t\t * @param {number} [index=0] Index from which to remove item\n\t\t * @throws {RangeError} If index is out of bounds\n\t\t * @returns {mixed} Removed item for garbage collection etc.\n\t\t */\n\t\tremove: function(index) {\n\t\t\tvar array = this.array;\n\n\t\t\tif (arguments.length < 1) {\n\t\t\t\tindex = 0;\n\t\t\t} else if (index < 0 || index >= array.length) {\n\t\t\t\tthrow new RangeError('Index out of bounds: ' + index);\n\t\t\t}\n\n\t\t\tvar oldItem = array[index];\n\n\t\t\tif (oldItem instanceof AbstractModel) {\n\t\t\t\tthis.unsubscribeChild(index);\n\t\t\t}\n\n\t\t\tarray.splice(index, 1);\n\t\t\tthis.childSubscriptions.splice(index, 1);\n\n\t\t\tthis.publish(index, 'remove', oldItem);\n\n\t\t\treturn oldItem;\n\t\t},\n\n\t\t/**\n\t\t * Remove all items that match the specified condition from this model.\n\t\t *\n\t\t * @param {Function|mixed} condition Evaluation function or value to match items with\n\t\t * @returns {Array} Removed items for garbage collection etc.\n\t\t */\n\t\tremoveWhere: function(condition) {\n\t\t\tif (!(condition instanceof Function)) {\n\t\t\t\tvar value = condition;\n\t\t\t\tcondition = function(candidate) {\n\t\t\t\t\treturn candidate === value;\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tvar removed = [];\n\t\t\tvar array = this.array;\n\t\t\tfor (var i = array.length - 1; i >= 0; i--) {\n\t\t\t\tif (condition(array[i])) {\n\t\t\t\t\tremoved.push(this.remove(i));\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn removed;\n\t\t},\n\n\t\t/**\n\t\t * Remove all items from this model.\n\t\t *\n\t\t * @returns {Array} Removed items for garbage collection etc.\n\t\t */\n\t\tclear: function() {\n\t\t\tvar removed = [];\n\t\t\tfor (var i = this.array.length - 1; i >= 0; i--) {\n\t\t\t\tremoved.push(this.remove(i));\n\t\t\t}\n\t\t\treturn removed;\n\t\t},\n\n\t\t/**\n\t\t * Either calls {@link playtotv.model.ArrayModel#change} or {@link playtotv.model.ArrayModel#add} depending on\n\t\t * whether index is smaller then array length or not.\n\t\t *\n\t\t * @param {number} index Argument to #add or #change\n\t\t * @param {mixed} item Argument to #add or #change\n\t\t * @returns {mixed} Removed item (if any) for garbage collection etc.\n\t\t */\n\t\tset: function(index, item) {\n\t\t\tif (index < this.array.length) {\n\t\t\t\treturn this.change(index, item);\n\t\t\t} else {\n\t\t\t\tthis.add(item, index);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Dispose array and child subscriptions.\n\t\t *\n\t\t * Note: Do not forget to also dispose any child models that are no longer used.\n\t\t */\n\t\tdispose: function() {\n\t\t\tthis.array.length = 0;\n\n\t\t\tthis.childSubscriptions.forEach(function(childSubscription) {\n\t\t\t\tif (childSubscription) {\n\t\t\t\t\tchildSubscription.model.unsubscribe(childSubscription.subscription);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tAbstractModel.prototype.dispose.call(this);\n\t\t}\n\t});\n});\n",
		"playtotv.define('playtotv.model.modelUtil', [\n\t'playtotv.model.AbstractModel',\n\t'playtotv.model.ArrayModel',\n\t'playtotv.model.ObjectModel'\n], function(\n\tAbstractModel,\n\tArrayModel,\n\tObjectModel\n) {\n\n\t'use strict';\n\n\t/**\n\t * @name playtotv.model.modelUtil\n\t * @namespace Namespace for model utility functions\n\t */\n\treturn {\n\t\t/** @lends playtotv.model.modelUtil */\n\n\t\t/**\n\t\t * Returns a recursively modelified copy of specified value.\n\t\t *\n\t\t * Note: This may create many models, so take care, especially with regards to memory leaks.\n\t\t *\n\t\t * @param {mixed} value Value to modelify\n\t\t * @param {boolean} [doNotThrow=false] If true then just return original value instead of throwing an exception\n\t\t * @throws {TypeError} If value is already a Model\n\t\t * @throws {TypeError} If value can not be modelified (it is neither Array nor Object)\n\t\t * @returns {playtotv.model.ArrayModel|playtotv.model.ObjectModel} Modelified copy\n\t\t */\n\t\tcreate: function(value, doNotThrow) {\n\t\t\tif (value instanceof AbstractModel) {\n\t\t\t\tif (doNotThrow) {\n\t\t\t\t\treturn value;\n\t\t\t\t}\n\t\t\t\tthrow new TypeError('Value is already a Model');\n\t\t\t} else if (value instanceof Array) {\n\t\t\t\treturn new ArrayModel(value.map(function(item) {\n\t\t\t\t\treturn this.create(item, true);\n\t\t\t\t}.bind(this)));\n\t\t\t} else if (typeof value === 'object' && value !== null) {\n\t\t\t\treturn new ObjectModel(Object.keys(value).reduce(function(model, key) {\n\t\t\t\t\tmodel[key] = this.create(value[key], true);\n\t\t\t\t\treturn model;\n\t\t\t\t}.bind(this), {}));\n\t\t\t} else {\n\t\t\t\tif (doNotThrow) {\n\t\t\t\t\treturn value;\n\t\t\t\t}\n\t\t\t\tthrow new TypeError('Value can not be modelified');\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Returns a recursively de-modelified copy of specified model.\n\t\t *\n\t\t * @param {playtotv.model.AbstractModel} model Model to de-modelify\n\t\t * @return {Object} De-modelified copy\n\t\t */\n\t\ttoObject: function(model) {\n\t\t\t// This code works on both normal and Array objects\n\t\t\tvar obj = model.toObject();\n\t\t\tplaytotv.each(obj, function(value, key) {\n\t\t\t\tif (value instanceof AbstractModel) {\n\t\t\t\t\tobj[key] = this.toObject(value);\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t\treturn obj;\n\t\t},\n\n\t\t/**\n\t\t * Recursively updates a model using {@link playtotv.model.AbstractModel#updateModel}.\n\t\t *\n\t\t * Note: Any child models removed in this process will be assumed to no longer be used and disposed.\n\t\t *\n\t\t * @example\n\t\t * var m = modelUtil.create({\n\t\t *   a: 1,\n\t\t *   b: { p: 'p' },\n\t\t *   c: [ { q: 'q' } ],\n\t\t *   d: { x: 2 }\n\t\t * });\n\t\t *\n\t\t * modelUtil.update(m, {\n\t\t *   a: 2,\n\t\t *   b: { p: 'P' },\n\t\t *   c: [ { q: 'Q' }, { r: 'R' } ]\n\t\t * });\n\t\t *\n\t\t * // Is equivalent to:\n\t\t * // m.b.changeProperty('p', 'P');\n\t\t * // m.c.array[0].changeProperty('q', 'Q');\n\t\t * // m.c.add(new ObjectModel({ r: 'R' }));\n\t\t * // d = m.d;\n\t\t * // m.removeProperty('d');\n\t\t * // d.dispose();\n\t\t * // m.changeProperty('a', 2);\n\t\t *\n\t\t * @param {playtotv.model.AbstractModel} model Model to update\n\t\t * @param {Object} source Source data to update model to\n\t\t * @throws {TypeError} If model is not an {@link playtotv.model.AbstractModel}\n\t\t * @throws {TypeError} If source is already an {@link playtotv.model.AbstractModel}\n\t\t */\n\t\tupdate: function(model, source) {\n\t\t\tif (!(model instanceof AbstractModel)) {\n\t\t\t\tthrow new TypeError('Model argument is not a model');\n\t\t\t}\n\t\t\tif (source instanceof AbstractModel) {\n\t\t\t\tthrow new TypeError('Source is already a Model');\n\t\t\t}\n\n\t\t\tvar isArray = model instanceof ArrayModel;\n\t\t\tvar updatedSource = isArray ? [] : {};\n\n\t\t\t// Recurse into children updates or modelifications\n\t\t\tplaytotv.each(source, function(sValue, key) {\n\t\t\t\tif (sValue instanceof AbstractModel) {\n\t\t\t\t\tthrow new Error('Source value is already a Model');\n\t\t\t\t}\n\n\t\t\t\tvar mValue = isArray ? model.array[key] : model[key];\n\t\t\t\tvar svIsArray = sValue instanceof Array;\n\t\t\t\tvar svIsObject = !svIsArray && typeof sValue === 'object' && sValue !== null;\n\n\t\t\t\tif ((svIsObject && mValue instanceof ObjectModel) || (svIsArray && mValue instanceof ArrayModel)) {\n\t\t\t\t\tthis.update(mValue, sValue);\n\t\t\t\t\tupdatedSource[key] = mValue;\n\t\t\t\t} else if (svIsObject || svIsArray) {\n\t\t\t\t\tupdatedSource[key] = this.create(sValue);\n\t\t\t\t} else {\n\t\t\t\t\tupdatedSource[key] = sValue;\n\t\t\t\t}\n\t\t\t}.bind(this));\n\n\t\t\tvar removedValues = model.updateModel(updatedSource);\n\t\t\tremovedValues.filter(function(rValue) {\n\t\t\t\treturn rValue instanceof AbstractModel;\n\t\t\t}).forEach(function(rModel) {\n\t\t\t\tthis.dispose(rModel);\n\t\t\t}.bind(this));\n\t\t},\n\n\t\t/**\n\t\t * Recursively dispose a model and all of it's child models.\n\t\t *\n\t\t * @param {playtotv.model.AbstractModel} model Model to dispose\n\t\t */\n\t\tdispose: function(model) {\n\t\t\tplaytotv.each(model.toObject(), function(value) {\n\t\t\t\tif (value instanceof AbstractModel) {\n\t\t\t\t\tthis.dispose(value);\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t\tmodel.dispose();\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.logUtil', [\n\t'playtotv.model.modelUtil'\n], function(\n\tmodelUtil\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar util = ptv.util;\n\n\t/**\n\t * @name playtotv.logUtil\n\t * @namespace Log utility functions\n\t */\n\treturn {\n\t\t/** @lends playtotv.logUtil */\n\n\t\t/**\n\t\t * Log publishes made to specified PubSub with specified log function.\n\t\t *\n\t\t * @param {playtotv.pubsub.PubSub} pubsub PubSub to subscribe to\n\t\t * @param {Function} fn Log function to call on publish\n\t\t * @param {Object} [options={}] Options\n\t\t * @param {[string]} [options.blacklist=[]] Array of channel globs to ignore\n\t\t * @param {string} [options.name] Name of PubSub to prefix log string with\n\t\t * @returns {playtotv.pubsub.Subscription} PubSub subscription\n\t\t */\n\t\tlogPubSub: function(pubsub, fn, options) {\n\t\t\toptions = ptv.params(options, { blacklist: [], name: '' });\n\t\t\tvar blacklist = options.blacklist.map(glob => util.globToRegEx(glob));\n\t\t\tvar prefix = options.name;\n\t\t\tprefix = prefix ? prefix + '.' : '';\n\t\t\treturn pubsub.subscribe(/.*/, function(data, channel) {\n\t\t\t\tif (blacklist.find(regex => regex.test(channel))) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (data && data.toObject) {\n\t\t\t\t\tdata = modelUtil.toObject(data);\n\t\t\t\t}\n\n\t\t\t\tvar pc = prefix + channel;\n\t\t\t\tif (typeof data === 'object') {\n\t\t\t\t\tfn(pc, data);\n\t\t\t\t} else {\n\t\t\t\t\tfn(pc + ': ' + data);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Log mutations made to specified Model with specified log function.\n\t\t *\n\t\t * @param {playtotv.model.AbstractModel} model Model to subscribe to\n\t\t * @param {Function} fn Log function to call on mutation\n\t\t * @param {Object} [options={}] Options\n\t\t * @param {[string]} [options.blacklist=[]] Array of key globs to ignore\n\t\t * @param {string} [options.name] Name of Model to prefix log string with\n\t\t * @returns {playtotv.model.ModelSubscription} Model subscription\n\t\t */\n\t\tlogModel: function(model, fn, options) {\n\t\t\toptions = ptv.params(options, { blacklist: [], name: '' });\n\t\t\tvar blacklist = options.blacklist.map(glob => util.globToRegEx(glob));\n\t\t\tvar prefix = options.name;\n\t\t\tprefix = prefix ? prefix + ' ' : '';\n\t\t\treturn model.subscribe('*', function(v, a, k) {\n\t\t\t\tif (blacklist.find(regex => regex.test(k))) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (v && v.toObject) {\n\t\t\t\t\tv = modelUtil.toObject(v);\n\t\t\t\t}\n\n\t\t\t\tvar pak = prefix + a + ' ' + k;\n\t\t\t\tif (typeof v === 'object') {\n\t\t\t\t\tfn(pak, v);\n\t\t\t\t} else {\n\t\t\t\t\tfn(pak + ' => ' + v);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Log calls made to specified instance method with specified log function.\n\t\t *\n\t\t * Note: This replaces specfified instance method by another function that calls the original function.\n\t\t *\n\t\t * @param {Object} instance Instance to which the method belongs\n\t\t * @param {string} methodName Name of instance method\n\t\t * @param {Function} fn Log function to call with logName and call arguments\n\t\t * @param {string} [logName=methodName] Method name to use for logging\n\t\t */\n\t\tlogMethod: function(instance, methodName, fn, logName) {\n\t\t\tlogName = logName || methodName;\n\t\t\tvar method = instance[methodName];\n\t\t\tinstance[methodName] = function() {\n\t\t\t\tvar args = ptv.toArray(arguments);\n\t\t\t\tfn(logName, args);\n\t\t\t\treturn method.apply(instance, args);\n\t\t\t};\n\t\t},\n\n\t\t/**\n\t\t * Log calls made to methods of specified instance with specified log function.\n\t\t *\n\t\t * Note: This replaces specfified instance methods by other functions that call the original functions.\n\t\t *\n\t\t * @param {Object} instance Instance to which the method belongs\n\t\t * @param {Function} fn Log function to call with name and call arguments\n\t\t * @param {Object} [options={}] Options\n\t\t * @param {[string]} [options.blacklist=[]] Array of method name globs to ignore\n\t\t * @param {string} [options.name] Name of instance to prefix method names with\n\t\t */\n\t\tlogMethods: function(instance, fn, options) {\n\t\t\toptions = ptv.params(options, { blacklist: [], name: '' });\n\t\t\tvar blacklist = options.blacklist.map(glob => util.globToRegEx(glob));\n\t\t\tvar prefix = options.name;\n\t\t\tprefix = prefix ? prefix + '.' : '';\n\t\t\t/*jshint forin:false*/\n\t\t\tfor (var key in instance) {\n\t\t\t\tif (instance[key] instanceof Function && !blacklist.find(regex => regex.test(key))) {\n\t\t\t\t\tthis.logMethod(instance, key, fn, prefix + key);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.MutationObserver', [], function() {\n\n\t'use strict';\n\n\t// Abort if we are not running in a browser (e.g: in Node)\n\tif (typeof window === 'undefined') {\n\t\treturn;\n\t}\n\n\tvar event = playtotv.event;\n\n\t/**\n\t * MutationRecord\n\t * https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver#MutationRecord\n\t *\n\t * @name MutationRecord\n\t * @namespace\n\t * @memberOf playtotv\n\t * @property {String} type The event's type: childList, attributes or characterData\n\t * @property {Node} target The affected node, for childList the inserted/removed node's parent, otherwise self.\n\t * @property {Array} addedNodes Array of insterted nodes for childList mutations.\n\t * @property {Array} removedNodes Array of removed nodes for childList mutations.\n\t * @property {Node} previousSibling Previous sibling of inserted/removed nodes or null\n\t * @property {Node} nextSibling Next sibling of inserted/removed nodes or null\n\t * @property {String} attributeName The name of the attribute that changed or null\n\t * @property {String} attributeNamespace The namespace of the changed attribute or null\n\t * @property {String} oldValue The previous value of changed attributes or characterData, or null\n\t */\n\tvar mutationRecord = {\n\t\ttype: null,\n\t\ttarget: null,\n\t\taddedNodes: [], // Spec says null, but actually returns an empty nodelist.\n\t\tremovedNodes: [], // Spec says null, but actually returns an empty nodelist.\n\t\tpreviousSibling: null,\n\t\tnextSibling: null,\n\t\tattributeName: null,\n\t\tattributeNamespace: null,\n\t\toldValue: null\n\t};\n\n\t// https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver#MutationObserverInit\n\tvar mutationOptions = {\n\t\tchildList: false,\n\t\tattributes: false,\n\t\tcharacterData: false,\n\t\tsubtree: false,\n\t\tattributeOldValue: false,\n\t\tcharacterDataOldValue: false,\n\t\tattributeFilter: false\n\t};\n\n\t/**\n\t * DOM3 event to DOM4 mutationRecord processors\n\t *\n\t */\n\tvar processors = {\n\t\tDOMNodeInserted: function(e, options, node) {\n\t\t\tvar inserted = e.target;\n\t\t\treturn (options.subtree || (inserted.parentNode === node)) ? playtotv.params({\n\t\t\t\ttype: 'childList',\n\t\t\t\ttarget: inserted.parentNode,\n\t\t\t\taddedNodes: [ inserted ],\n\t\t\t\tpreviousSibling: inserted.previousSibling,\n\t\t\t\tnextSibling: inserted.nextSibling\n\t\t\t}, mutationRecord) : null;\n\t\t},\n\n\t\tDOMNodeRemoved: function(e, options, node) {\n\t\t\tvar removed = e.target;\n\t\t\treturn (options.subtree || (removed.parentNode === node)) ? playtotv.params({\n\t\t\t\ttype: 'childList',\n\t\t\t\ttarget: removed.parentNode,\n\t\t\t\tremovedNodes: [ removed ],\n\t\t\t\tpreviousSibling: removed.previousSibling,\n\t\t\t\tnextSibling: removed.nextSibling\n\t\t\t}, mutationRecord) : null;\n\t\t},\n\n\t\tDOMAttrModified: function(e, options, node) {\n\t\t\tvar attr = e.attrName;\n\t\t\tvar filter = options.attributeFilter;\n\t\t\treturn (options.subtree || (e.target === node)) && (!filter || filter.indexOf(attr) >= 0) ?\n\t\t\t\tplaytotv.params({\n\t\t\t\t\ttype: 'attributes',\n\t\t\t\t\ttarget: e.target,\n\t\t\t\t\tattributeName: attr,\n\t\t\t\t\toldValue: options.attributeOldValue ? e.prevValue : null\n\t\t\t\t}, mutationRecord) :\n\t\t\t\tnull;\n\t\t},\n\n\t\tDOMCharacterDataModified: function(e, options, node) {\n\t\t\treturn (options.subtree || (e.target === node)) ? playtotv.params({\n\t\t\t\ttype: 'characterData',\n\t\t\t\ttarget: e.target,\n\t\t\t\toldValue: options.characterDataOldValue ? e.prevValue : null\n\t\t\t}, mutationRecord) : null;\n\t\t}\n\t};\n\n\t/**\n\t * MutationProxy,\n\t *\n\t */\n\tvar MutationProxy = new playtotv.Class({\n\t\tinitialize: function(node, proxyEvent, observer) {\n\t\t\tthis.node = node;\n\t\t\tthis.proxyEvent = proxyEvent;\n\t\t\tthis.observer = observer;\n\t\t\tthis.processor = processors[proxyEvent];\n\t\t\tevent.addListener(node, proxyEvent, this.onModified);\n\t\t},\n\n\t\tonModified: function(e) {\n\t\t\tvar observer = this.observer;\n\t\t\tvar record = this.processor(e, observer.options, this.node);\n\t\t\tif (record) {\n\t\t\t\tobserver.addRecord(record);\n\t\t\t}\n\t\t},\n\n\t\tdisconnect: function() {\n\t\t\tevent.removeListener(this.node, this.proxyEvent, this.onModified);\n\t\t\tdelete this.node;\n\t\t\tdelete this.proxyEvent;\n\t\t\tdelete this.observer;\n\t\t\tdelete this.processor;\n\t\t},\n\n\t\tcallbacks: [\n\t\t\t'onModified'\n\t\t]\n\t});\n\n\t/**\n\t * Mutation Observer pollyfill. The pollyfill is only applied if a native implementation is not supported.\n\t * https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver\n\t *\n\t * @name MutationObserver\n\t * @memberOf playtotv\n\t * @class\n\t * @param {Function} callback\n\t */\n\tvar MutationObserver =\n\t\twindow.MutationObserver ||\n\t\twindow.WebkitMutationObserver ||\n\t\twindow.MozMutationObserver ||\n\t\tnew playtotv.Class({\n\n\t\t\tinitialize: function(callback) {\n\t\t\t\tthis.callback = callback;\n\t\t\t\tthis.listeners = [];\n\t\t\t\tthis.records = [];\n\t\t\t},\n\n\t\t\t/** @lends playtotv.MutationObserver.prototype */\n\n\t\t\t/**\n\t\t\t * Observes changes within a target Node and notifies them to the instance's callback as an array of\n\t\t\t * mutation records, https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver#MutationRecord.\n\t\t\t * At least one type of mutations (childList, attributes and/or characterData) must be observed,\n\t\t\t * or an error is thrown.\n\t\t\t *\n\t\t\t * @param {Node} target\n\t\t\t * @param {MutationOptions} options\n\t\t\t * @param {boolean} options.childList=false Observe changes to the target's child nodes when true\n\t\t\t * @param {boolean} options.attributes=false Observe changes to the target's attributes when true\n\t\t\t * @param {boolean} options.characterData=false Observe changes to the target's data when true\n\t\t\t * @param {boolean} [options.subtree=false] Observe all descendent nodes' changes when true\n\t\t\t * @param {boolean} [options.attributeOldValue=false] Record the previous attribute value when true\n\t\t\t * @param {boolean} [options.characterDataOldValue=false] Record the previous data value when true\n\t\t\t * @param {Array} [options.attributeFilter] Attribute names that should be observed rather than all of them\n\t\t\t */\n\t\t\tobserve: function(target, options) {\n\t\t\t\t// fill in the blanks\n\t\t\t\toptions = this.options = playtotv.params(options, mutationOptions);\n\n\t\t\t\t// as per spec; options MUST define at least one type of DOM changes to monitor\n\t\t\t\tif (!options.childList && !options.attributes && !options.characterData) {\n\t\t\t\t\tthrow new Error('An invalid or illegal string was specified');\n\t\t\t\t}\n\n\t\t\t\tvar listeners = this.listeners;\n\t\t\t\tif (options.childList) {\n\t\t\t\t\tlisteners.push(\n\t\t\t\t\t\tnew MutationProxy(target, 'DOMNodeInserted', this),\n\t\t\t\t\t\tnew MutationProxy(target, 'DOMNodeRemoved', this)\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tif (options.attributes) {\n\t\t\t\t\tlisteners.push(\n\t\t\t\t\t\tnew MutationProxy(target, 'DOMAttrModified', this)\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tif (options.characterData) {\n\t\t\t\t\tlisteners.push(\n\t\t\t\t\t\tnew MutationProxy(target, 'DOMCharacterDataModified', this)\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Adds a record via a proxy, and notifies\n\t\t\t * @private\n\t\t\t */\n\t\t\taddRecord: function(record) {\n\t\t\t\tthis.records.push(record);\n\t\t\t\tthis.notify();\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Empties the mutation record queue and returns any mutations it contained.\n\t\t\t * The instance's callback will not be called for these mutations.\n\t\t\t *\n\t\t\t * @returns {Array} mutationRecords\n\t\t\t */\n\t\t\ttakeRecords: function() {\n\t\t\t\tvar records = this.records;\n\t\t\t\tthis.records = [];\n\t\t\t\treturn records;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Takes the current record queue, and sends them to the instance's callback.\n\t\t\t * @private\n\t\t\t */\n\t\t\tnotify: function() {\n\t\t\t\tvar records = this.takeRecords();\n\t\t\t\tif (records.length) {\n\t\t\t\t\tthis.callback(records);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Disconnects all observers from this instance.\n\t\t\t *\n\t\t\t */\n\t\t\tdisconnect: function() {\n\t\t\t\tthis.listeners.forEach(function(listener) {\n\t\t\t\t\tlistener.disconnect();\n\t\t\t\t});\n\n\t\t\t\tthis.listeners = [];\n\t\t\t}\n\t\t});\n\n\treturn MutationObserver;\n});\n",
		"playtotv.define('playtotv.mvc.helpers', [\n\t'playtotv.handlebars.hbsUtil',\n\t'playtotv.handlebars.helpers'\n], function(\n\thbsUtil,\n\thelpers\n) {\n\t/*global Handlebars:false*/\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar util = ptv.util;\n\tvar templateStack = [];\n\n\treturn ptv.extend(helpers, {\n\t\t/** @lends playtotv.mvc.helpers */\n\n\t\t// TODO: JSDOC\n\t\t// E.g: {{call \"controller.method\" arg1 .. key1=value1 ..}}\n\t\t// => controller.method(arg, { key1: value1 })\n\t\tcall: function() {\n\t\t\tvar { args, hash, options } = hbsUtil.getArgs(this, arguments);\n\t\t\tvar methodPath = args.shift();\n\t\t\tvar context = options.data.root;\n\n\t\t\t// First argument is optional context argument\n\t\t\tif (typeof methodPath === 'object') {\n\t\t\t\tcontext = methodPath;\n\t\t\t\tmethodPath = args.shift();\n\t\t\t}\n\n\t\t\tif (!methodPath) {\n\t\t\t\treturn hbsUtil.softException('Call methodPath argument missing');\n\t\t\t}\n\n\t\t\t// If called with a block then add that as an argument\n\t\t\tif (options.fn) {\n\t\t\t\targs.push(options.fn(this));\n\t\t\t}\n\n\t\t\t// If called with hash key-value pairs then add the hash as an argument\n\t\t\tif (Object.keys(hash).length > 0) {\n\t\t\t\targs.push(hash);\n\t\t\t}\n\n\t\t\tvar methodRef = util.seekRef(context, methodPath);\n\t\t\tvar method = methodRef && methodRef.value;\n\t\t\tif (!method) {\n\t\t\t\treturn hbsUtil.softException('Call method not found: ' + methodPath);\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\treturn method.apply(methodRef.object, args);\n\t\t\t} catch (error) {\n\t\t\t\treturn hbsUtil.softException('Call ' + error.name + ':' + error.message);\n\t\t\t}\n\n\t\t\t// TODO: de-promisify return value if necessary\n\t\t\t/*\n\t\t\t// Wrap method to deal with Promise return values\n\t\t\tvar shardMap = {};\n\t\t\t// Note: If promise value does not depends on arguments or arguments are not JSON stringifyable\n\t\t\t// then method has to define a getShard() property\n\t\t\tvar getShard = method.getShard || function() {\n\t\t\t\treturn JSON.stringify(ptv.toArray(arguments));\n\t\t\t};\n\t\t\tvar scope = this;\n\t\t\thbsUtil.addMethod(name, function() { // note: fat arrow (=>) would mess with \"arguments\"\n\t\t\t\tvar returnValue;\n\t\t\t\ttry {\n\t\t\t\t\treturnValue = method.apply(null, arguments);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tscope.onError(error);\n\t\t\t\t}\n\t\t\t\tif (!(returnValue instanceof Promise)) {\n\t\t\t\t\treturn returnValue;\n\t\t\t\t}\n\n\t\t\t\t// Note: In case of rejection the returned lastValue is left unchanged (e.g: undefined)\n\t\t\t\tvar shardKey = getShard.apply(null, arguments);\n\t\t\t\tvar shard = shardMap[shardKey] || (shardMap[shardKey] = {});\n\t\t\t\treturnValue.then(value => {\n\t\t\t\t\tif (JSON.stringify(value) !== JSON.stringify(shard.lastValue)) {\n\t\t\t\t\t\tshard.lastValue = value;\n\t\t\t\t\t\tthis.view.update();\n\t\t\t\t\t}\n\t\t\t\t}, error => scope.onError(error));\n\t\t\t\treturn shard.lastValue;\n\t\t\t}.bind(this));\n\t\t\t */\n\t\t},\n\n\t\t// TODO: JSDOC\n\t\tscript: function() {\n\t\t\tvar { script, hash, options } = hbsUtil.getArgs(this, arguments, 'script', 0);\n\n\t\t\t// If called with a block then the block is the script\n\t\t\tif (options.fn) {\n\t\t\t\tscript = options.fn(this);\n\t\t\t}\n\n\t\t\t// Compact script for the sake of compact render output\n\t\t\t// Note: You can circumvent tab chars etc. getting changed by passing them in a hash (context) value\n\t\t\tscript = script.trim().replace(/\\s+/g, ' ');\n\n\t\t\tvar serialized = Object.keys(hash).length > 0 ? JSON.stringify([ script, hash ]) : script;\n\t\t\tserialized = Handlebars.Utils.escapeExpression(serialized);\n\t\t\treturn new Handlebars.SafeString(serialized);\n\t\t},\n\n\t\t// TODO: JSDOC\n\t\ton: function() {\n\t\t\tvar args = ptv.toArray(arguments);\n\t\t\tvar type = args.shift();\n\t\t\tvar script = helpers.script.apply(this, args);\n\t\t\treturn new Handlebars.SafeString('on-' + type + '=\"' + script + '\"');\n\t\t},\n\n\t\t// TODO: JSDOC\n\t\t/**\n\t\t * {{widgets (widget ..) (widget ..)}}\n\t\t */\n\t\twidgets: function() {\n\t\t\tvar { args } = hbsUtil.getArgs(this, arguments);\n\t\t\tvar serialized = JSON.stringify(args);\n\t\t\tserialized = Handlebars.Utils.escapeExpression(serialized);\n\t\t\treturn new Handlebars.SafeString('widgets=\"' + serialized + '\"');\n\t\t},\n\n\t\t// TODO: JSDOC\n\t\t/**\n\t\t * (widget \"rating.Input\" bar=bar)\n\t\t */\n\t\twidget: function() {\n\t\t\tvar { name, hash } = hbsUtil.getArgs(this, arguments, 'name');\n\t\t\treturn [ name, hash ];\n\t\t},\n\n\t\t/**\n\t\t * Returns path relative to current path or just current path if path argument is undefined.\n\t\t *\n\t\t * The base path is determined using the render context provided by App.\n\t\t */\n\t\ttemplatePath: function() {\n\t\t\tvar { path, options } = hbsUtil.getArgs(this, arguments, 'path', 0);\n\t\t\tvar current = templateStack[templateStack.length - 1] || options.data.root.router.pattern;\n\t\t\treturn path === undefined ? current : util.resolvePath(current, path);\n\t\t},\n\n\t\t/**\n\t\t * Renders and returns the partial specified by name relative to the current template path.\n\t\t *\n\t\t * Partial is rendered with specified or current render context.\n\t\t *\n\t\t * TODO: Update JSDOC\n\t\t * Any hash properties are added as @ variables within this block similar to using {{#var}}.\n\t\t *\n\t\t * If this is called as a block helper then the block will be available as the @partial-block partial.\n\t\t * E.g: {{#partial \"_x\"}}..{{/partial}} is equal to {{#> _x}}..{{/x}} in Handlebars v4 and up.\n\t\t *\n\t\t * Note: If a partial with the specified name is not found but a template is then that will be used instead.\n\t\t * This facilitates \"aliasing\" from one template to another.\n\t\t *\n\t\t * @example\n\t\t * Data: { template: 'episodes/__episodeCode__/index', episodePartial: '_episode', state: 'y' }\n\t\t *\n\t\t * Template: {{partial \"_interaction\"}}\n\t\t * Output: {{> episodes/__episodeCode__/_interaction}}\n\t\t *\n\t\t * Template: {{partial (eval '\"../\" + episodePartial')}}\n\t\t * Output: {{> episodes/_episode}}\n\t\t *\n\t\t * Template: {{partial (switch state \"_default\" x=\"_foo\" y=\"_bar\")}}\n\t\t * Output: {{> episodes/__episodeCode__/_bar}}\n\t\t */\n\t\tpartial: function() {\n\t\t\tvar { path, context, hash, options } = hbsUtil.getArgs(this, arguments, 'path, context', 1);\n\n\t\t\t// Default to this render context, but if hash properties are passed, use those as context instead\n\t\t\tcontext = context || this;\n\t\t\tif (Object.keys(hash).length > 0) {\n\t\t\t\tcontext = hash;\n\t\t\t\toptions.hash = {};\n\t\t\t}\n\n\t\t\tvar partialBlock = options.fn;\n\t\t\tif (partialBlock) {\n\t\t\t\tHandlebars.registerPartial('@partial-block', partialBlock);\n\t\t\t\tdelete options.fn;\n\t\t\t}\n\n\t\t\tvar name = hbsUtil.callHelper('templatePath', this, path, options);\n\t\t\tvar partial = Handlebars.partials[name] || Handlebars.templates[name];\n\t\t\tif (!partial) {\n\t\t\t\treturn hbsUtil.softException('Partial not found: ' + name);\n\t\t\t}\n\n\t\t\ttemplateStack.push(name);\n\t\t\tvar output = new Handlebars.SafeString(partial(context, options));\n\t\t\ttemplateStack.pop();\n\n\t\t\tif (partialBlock) {\n\t\t\t\tHandlebars.unregisterPartial('@partial-block');\n\t\t\t}\n\n\t\t\treturn output;\n\t\t},\n\n\t\t/**\n\t\t * Register block as partial with name based on path relative to current template.\n\t\t *\n\t\t * TODO: Use new Handlebars v4 features instead.\n\t\t *\n\t\t * @example\n\t\t * Data: { dude: { name: 'Peter' } }\n\t\t * Template:\n\t\t *   {{#registerPartial \"greet\"}}{{greeting}} {{name}}!{{/registerPartial}}\n\t\t *   {{partial \"greet\" dude greeting=\"Yo\"}}\n\t\t * Output: Yo Peter!\n\t\t */\n\t\tregisterPartial: function() {\n\t\t\tvar { path, options } = hbsUtil.getArgs(this, arguments, 'path');\n\t\t\tvar name = hbsUtil.callHelper('templatePath', this, path, options);\n\t\t\tHandlebars.registerPartial(name, options.fn);\n\t\t}\n\t});\n});\n",
		"playtotv.define('playtotv.mvc.Router', [\n\t'playtotv.pubsub.PubSub'\n], function(\n\tPubSub\n) {\n\n\t// TODO: JSDOC\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\n\treturn new ptv.Class({\n\t\textend: PubSub,\n\n\t\tinitialize: function(options) {\n\t\t\toptions = ptv.params(options, {\n\t\t\t\troot: 'index',\n\t\t\t\trescue: 'route-not-found',\n\t\t\t\tpatterns: ptv.REQUIRED\n\t\t\t});\n\n\t\t\tthis._super();\n\n\t\t\tthis.root = options.root;\n\t\t\tthis.rescue = options.rescue;\n\t\t\tthis.routes = options.patterns.map(function(pattern) {\n\t\t\t\treturn {\n\t\t\t\t\tpattern: pattern,\n\t\t\t\t\tregex: new RegExp('^' + pattern.replace(/__\\w+__/g, '([^/]*)') + '$'),\n\t\t\t\t\tkeys: (pattern.match(/__\\w+__/g) || []).map(function(key) {\n\t\t\t\t\t\treturn key.substr(2, key.length - 4); // strip surrounding __ and __\n\t\t\t\t\t})\n\t\t\t\t};\n\t\t\t});\n\n\t\t\twindow.onhashchange = this.update.bind(this);\n\t\t\tthis.update();\n\t\t},\n\n\t\tfind: function(path) {\n\t\t\treturn ptv.find(this.routes, function(candidate) {\n\t\t\t\treturn candidate.pattern === path;\n\t\t\t}) || ptv.find(this.routes, function(candidate) {\n\t\t\t\treturn candidate.regex.test(path);\n\t\t\t});\n\t\t},\n\n\t\tgetParams: function(route, path) {\n\t\t\tvar values = (path.match(route.regex) || []).slice(1);\n\t\t\treturn values.reduce(function(params, value, i) {\n\t\t\t\tparams[route.keys[i]] = value;\n\t\t\t\treturn params;\n\t\t\t}, {});\n\t\t},\n\n\t\tupdate: function() {\n\t\t\tvar loc = window.location;\n\t\t\tvar path = loc.hash.substr(1); // strip leading #\n\t\t\tif (!path) {\n\t\t\t\tpath = this.root;\n\t\t\t\tloc.hash = '#' + path;\n\t\t\t}\n\n\t\t\t// Add 'index' to paths that end with '/' (like on a web server)\n\t\t\tif (/\\/$/.test(path)) {\n\t\t\t\tpath += 'index';\n\t\t\t}\n\n\t\t\tif (path === this.path) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.path = path;\n\n\t\t\tvar route = this.find(path);\n\t\t\tvar params;\n\t\t\tif (route) {\n\t\t\t\tparams = this.getParams(route, path);\n\t\t\t} else {\n\t\t\t\tvar rescue = this.rescue;\n\t\t\t\troute = this.find(rescue);\n\t\t\t\tif (!route) {\n\t\t\t\t\tthrow new Error('Could not find rescue route: ' + rescue);\n\t\t\t\t}\n\t\t\t\tparams = ptv.extend(this.getParams(route, rescue), { path: path });\n\t\t\t}\n\n\t\t\tvar pattern = route.pattern;\n\t\t\tthis.pattern = pattern;\n\t\t\tthis.params = params;\n\t\t\tthis.publish(pattern, params);\n\t\t}\n\t});\n});\n",
		"playtotv.define('playtotv.PauseDog', [], function() {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar log = new ptv.Logger(this.id);\n\n\t/**\n\t * PauseDog is a watchdog for monitoring JS pauses.\n\t * E.g: When you have switched to another tab/app on a mobile device.\n\t *\n\t * Note: Safari and Firefox also pause/slow down JS after they are left in the background for a minute or two.\n\t */\n\treturn class PauseDog {\n\t\tconstructor() {\n\t\t\tthis.pauseCallbacks = [];\n\t\t\tthis.interval = 1000;\n\t\t\tthis.scheduleTick();\n\t\t}\n\n\t\tscheduleTick() {\n\t\t\tthis.lastTick = Date.now();\n\t\t\tthis.timeout = setTimeout(this.onTick.bind(this), this.interval);\n\t\t}\n\n\t\tadd(threshold, callback) {\n\t\t\tvar pauseCallback = {\n\t\t\t\tthreshold: threshold,\n\t\t\t\tcallback: callback\n\t\t\t};\n\t\t\tthis.pauseCallbacks.push(pauseCallback);\n\t\t\treturn pauseCallback;\n\t\t}\n\n\t\tremove(pauseCallback) {\n\t\t\tvar pauseCallbacks = this.pauseCallbacks;\n\t\t\tvar index = pauseCallbacks.indexOf(pauseCallback);\n\t\t\tif (index !== -1) {\n\t\t\t\tpauseCallbacks.splice(index, 1);\n\t\t\t}\n\t\t}\n\n\t\tonTick() {\n\t\t\tvar now = Date.now();\n\t\t\tvar pause = now - this.interval - this.lastTick;\n\n\t\t\tvar desc = 'Paused: ' + Math.round(pause / 1000) + ' seconds';\n\t\t\tif (pause > 10000) {\n\t\t\t\tlog.d(desc);\n\t\t\t} else if (pause > 1000) {\n\t\t\t\tlog.s(desc);\n\t\t\t}\n\n\t\t\tthis.pauseCallbacks.\n\t\t\t\tfilter(pcb => pause > pcb.threshold).\n\t\t\t\tforEach(pcb => pcb.callback(pause));\n\n\t\t\tthis.scheduleTick();\n\t\t}\n\n\t\tdispose() {\n\t\t\tthis.pauseCallbacks.length = 0;\n\t\t\tclearTimeout(this.timeout);\n\t\t\tptv.dispose(this);\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.mvc.BindWidget', [\n\t'playtotv.widget.Widget'\n], function(\n\tWidget\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar event = ptv.event;\n\n\treturn class BindWidget extends Widget {\n\n\t\tconstructor(node, options) {\n\t\t\tsuper(node);\n\n\t\t\tvar { controller, path } = ptv.params(options, {\n\t\t\t\tapp: null,\n\t\t\t\tcontroller: ptv.REQUIRED,\n\t\t\t\tpath: ptv.REQUIRED\n\t\t\t});\n\n\t\t\tptv.extend(this, options);\n\n\t\t\t// If controller value is defined then initialize input to match\n\t\t\t// else initialize controller to match input\n\t\t\tvar value = controller.seek(path);\n\t\t\tif (value !== undefined) {\n\t\t\t\tthis.updateInput(value);\n\t\t\t} else {\n\t\t\t\tthis.updateController();\n\t\t\t}\n\n\t\t\t// Bind input to controller\n\t\t\t// TODO: Only updateController after input and/or form are validated?\n\t\t\t// See if/how this can tie in with our FormWidget widget\n\t\t\tvar onInputChange = () => this.updateController();\n\t\t\tthis.addEventListener(node, 'change', onInputChange);\n\t\t\tthis.addEventListener(node, 'keyup', onInputChange);\n\n\t\t\t// Bind controller to input\n\t\t\tthis.subscribe(controller, path, value => this.updateInput(value));\n\t\t}\n\n\t\tupdateController() {\n\t\t\tvar node = this.node;\n\t\t\tvar value = node.type === 'checkbox' ? node.checked : node.value;\n\t\t\tthis.controller.set(this.path, value);\n\t\t}\n\n\t\tupdateInput(value) {\n\t\t\tvar node = this.node;\n\t\t\tif (node.type === 'checkbox') {\n\t\t\t\tif (value !== node.checked) {\n\t\t\t\t\tnode.checked = value;\n\t\t\t\t\tevent.triggerNative(node, 'change');\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (value !== node.value) {\n\t\t\t\t\tnode.value = value;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.mvc.UpdateWidget', [\n\t'playtotv.widget.Widget',\n\t'playtotv.cron'\n], function(\n\tWidget,\n\tcron\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\n\t/**\n\t * Callback defaults to controller.update() but can be made to point to another function in the options.\n\t *\n\t * The repeat option value defaults to 10 minutes.\n\t * If you pause your app on your phone and resume it the next day the callback will fire almost immediately.\n\t * Also, if you walk away from your desktop and come back after lunch it will be roughly kept up-to-date.\n\t */\n\treturn class UpdateWidget extends Widget {\n\n\t\tconstructor(node, options) {\n\t\t\toptions = ptv.params(options, {\n\t\t\t\tapp: null,\n\t\t\t\tcontroller: ptv.REQUIRED,\n\t\t\t\tcallback: null,\n\t\t\t\trepeat: 10 * 60 * 1000\n\t\t\t});\n\n\t\t\tsuper(node);\n\n\t\t\tvar controller = options.controller;\n\t\t\tvar callback = options.callback || controller.update.bind(controller);\n\n\t\t\t// TODO: Add support for starting at or after a specified time (default: now)\n\t\t\tthis.job = cron.at(0, callback, { repeat: options.repeat });\n\t\t}\n\n\t\tdispose() {\n\t\t\tcron.cancel(this.job);\n\t\t\tsuper();\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.mvc.Controller', [\n\t'playtotv.mvc.BindWidget',\n\t'playtotv.mvc.UpdateWidget',\n\t'playtotv.pubsub.PubSub'\n], function(\n\tBindWidget,\n\tUpdateWidget,\n\tPubSub\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar util = ptv.util;\n\tvar REQUIRED = ptv.REQUIRED;\n\n\treturn class Controller extends PubSub {\n\t\t/** @lends playtotv.mvc.Controller.prototype */\n\n\t\t/**\n\t\t * PlayToTV MVC Controller.\n\t\t *\n\t\t * A base context object will be provided by App.addController().\n\t\t * A specific Controller can add or customize the context.store property as desired.\n\t\t *\n\t\t * @constructs\n\t\t * @param {Object} context Controller context\n\t\t * @param {string} context.name Name of Controller within App\n\t\t * @param {playtotv.mvc.App} context.app App instance this controller belongs to\n\t\t * @param {Object} [context.stored] Any stored data to deserialize\n\t\t * @param {[string]} [context.store={}] Properties with default values to be serialized and persisted\n\t\t *\n\t\t * @property {string} name Name of Controller within App\n\t\t * @property {playtotv.mvc.App} app App instance this controller belongs to\n\t\t * @property {[string]} [storeKeys=Object.keys(store)] Keys of properties to be serialized and persisted\n\t\t */\n\t\tconstructor(context) {\n\t\t\tvar { name, app, stored, store } = ptv.params(context, {\n\t\t\t\tname: REQUIRED,\n\t\t\t\tapp: REQUIRED,\n\t\t\t\tstored: undefined,\n\t\t\t\tstore: {}\n\t\t\t});\n\n\t\t\tsuper();\n\n\t\t\tthis.name = name;\n\t\t\tthis.app = app;\n\t\t\tthis.storeKeys = Object.keys(store);\n\n\t\t\tthis.deserialize(store, stored);\n\n\t\t\tthis.setWidgets([\n\t\t\t\t[ 'bind', BindWidget ],\n\t\t\t\t[ 'update', UpdateWidget ]\n\t\t\t]);\n\t\t}\n\n\t\t/**\n\t\t * Returns any JSON stringify-able data to be persisted in storage.\n\t\t * Called by App when it wants to persist this Controller's data.\n\t\t * Returns this instance's properties with keys matching this.storekeys.\n\t\t *\n\t\t * @returns {Object} Data to be persisted in storage\n\t\t */\n\t\tserialize() {\n\t\t\treturn ptv.pick(this, this.storeKeys);\n\t\t}\n\n\t\t/**\n\t\t * Called by constructor with any previously stored data.\n\t\t * Extends this instance with data properties or default values.\n\t\t *\n\t\t * @param {Object} defaults Default values\n\t\t * @param {Object} data Previously stored data\n\t\t */\n\t\tdeserialize(defaults, data) {\n\t\t\tptv.extend(this, defaults, data);\n\t\t}\n\n\t\t/**\n\t\t * Registers widget named [this.name]-[name] to specified Widget class and base options.\n\t\t *\n\t\t * @param {string} name Widget name (within this Controller)\n\t\t * @param {[type]} WidgetClass Class to use for Widget instantiation\n\t\t * @param {Object} [options={}] Base options\n\t\t */\n\t\tsetWidget(name, WidgetClass, options = {}) {\n\t\t\toptions.controller = this;\n\t\t\treturn this.app.setWidget(this.name + '-' + name, WidgetClass, options);\n\t\t}\n\n\t\t/**\n\t\t * Registers an array of Widgets.\n\t\t *\n\t\t * @param {[args]} widgets Array of array of setWidget arguments\n\t\t */\n\t\tsetWidgets(widgets) {\n\t\t\twidgets.forEach(args => this.setWidget.apply(this, args));\n\t\t}\n\n\t\t/**\n\t\t * Persists this controller's data to storage.\n\t\t *\n\t\t * @returns {Promise} Promise of data being persisted\n\t\t */\n\t\tflush() {\n\t\t\treturn this.app.flush(this.name);\n\t\t}\n\n\t\t/**\n\t\t * Returns value of property with specified path.\n\t\t *\n\t\t * @param {string} path Property path\n\t\t * @returns {mixed} Property value or undefined\n\t\t */\n\t\tseek(path) {\n\t\t\treturn util.seek(this, path);\n\t\t}\n\n\t\t/**\n\t\t * Set controllery property with specified path to specified value and publish it.\n\t\t *\n\t\t * If value already equals current value then this does nothing.\n\t\t *\n\t\t * @param {string} path Path of property to set\n\t\t * @param {mixed} value Value to change property to\n\t\t * @param {options={}} [options={}]\n\t\t * @param {boolean} [options.json] Compare values using JSON stringify (default true if typeof value 'object')\n\t\t * @param {boolean} [options.force=false] Assume value to be changed\n\t\t */\n\t\tset(path, value, options) {\n\t\t\toptions = ptv.params(options, {\n\t\t\t\tjson: typeof value === 'object',\n\t\t\t\tforce: false\n\t\t\t});\n\n\t\t\tvar ref = util.seekRef(this, path);\n\t\t\tif (!ref) {\n\t\t\t\tthrow new Error('Can not set property on undefined object: ' + path);\n\t\t\t}\n\n\t\t\tvar current = ref.value;\n\t\t\tif (\n\t\t\t\toptions.force ||\n\t\t\t\t(!options.json && value !== current) ||\n\t\t\t\t(options.json && JSON.stringify(value) !== JSON.stringify(current))\n\t\t\t) {\n\t\t\t\tref.object[ref.key] = value;\n\t\t\t\tthis.publish(path, value);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Toggle boolean value of property with specified path.\n\t\t *\n\t\t * If the value argument is undefined then this will change the property to !x where x is the current value.\n\t\t * If typeof value is 'string' then this will change to false unless value equals 'true'.\n\t\t * Otherwise this will change to true if value is truthy or false otherwise.\n\t\t *\n\t\t * @param {string} path Path of property to toggle\n\t\t * @param {boolean} [value] Value to change to\n\t\t */\n\t\ttoggle(path, value) {\n\t\t\tvalue = value === undefined ? !this.seek(path) :\n\t\t\t\ttypeof value === 'string' ? value === 'true' :\n\t\t\t\tvalue ? true : false;\n\n\t\t\tthis.set(path, value);\n\t\t}\n\n\t\t// TODO: For Array: add/remove(path, value)\n\t\t// TODO: For number: inc/dec(path, amount=1)\n\t};\n});\n",
		"playtotv.define('playtotv.episode.EpisodeController', [\n\t'playtotv.mvc.Controller',\n\t'playtotv.episode.episodeSessionAPI'\n], function(\n\tController,\n\tepisodeSessionAPI\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar util = ptv.util;\n\tvar log = ptv.Logger.get(this.id);\n\n\treturn class EpisodeController extends Controller {\n\t\tconstructor(context, options) {\n\t\t\toptions = ptv.params(options, {\n\t\t\t\ttimeZone: util.getTimeZone(),\n\t\t\t\tshowName: undefined,\n\t\t\t\tshowId: undefined,\n\t\t\t\tepisodeSessionId: undefined\n\t\t\t});\n\n\t\t\tvar stored = context.stored || {};\n\t\t\tsuper(context, {\n\t\t\t\tmodel: {\n\t\t\t\t\tcurrent: null,\n\t\t\t\t\twaiting: false,\n\t\t\t\t\t// Note: Used as a backup for server side storage of user data\n\t\t\t\t\tepisodeInteractionUserDataMap: stored.episodeInteractionUserDataMap || {}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.options = options;\n\n\t\t\tthis.addMethods([\n\t\t\t\t'getEpisode',\n\t\t\t\t'getInteraction',\n\t\t\t\t'getCurrentInteraction',\n\t\t\t\t'getNextAsyncInteraction',\n\t\t\t\t'submitInteraction'\n\t\t\t]);\n\n\t\t\tthis.predictionTypes = [ 'PREDICTION' ];\n\n\t\t\tthis.scope.observe('user.online', this.start.bind(this));\n\n\t\t\tthis.scope.subscribe('change:push.stream', this.onStreamChange.bind(this));\n\t\t\tthis.scope.subscribe('push.EPISODESESSION-STATECHANGE', this.onChangeEvent.bind(this));\n\t\t\tthis.scope.subscribe('push.EPISODESESSION-INTERACTIONSTATEUPDATE', this.onUpdateEvent.bind(this));\n\t\t}\n\n\t\t// Note: Currently no support for going offline and online again, but that does not seem necessary\n\t\tstart(online) {\n\t\t\tif (this.hasStarted || !online) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.join();\n\t\t\tthis.hasStarted = true;\n\t\t}\n\n\t\tadaptEpisode(data) {\n\t\t\treturn ptv.extend(data, {\n\t\t\t\tinteractionMap: {},\n\t\t\t\tinteractionQueue: [],\n\t\t\t\tasyncInteractions: {},\n\t\t\t\tposition: 'BEFORE'\n\t\t\t});\n\t\t}\n\n\t\tjoin() {\n\t\t\treturn this.scope.call('server.call', episodeSessionAPI.joinAndGetState, this.options).then(data => {\n\t\t\t\tvar episodeData = data.episodeSession;\n\t\t\t\tif (!episodeData) {\n\t\t\t\t\tthis.set('waiting', true);\n\n\t\t\t\t\treturn Promise.race([\n\t\t\t\t\t\tthis.scope.when('push.EPISODESESSION-OPENED'),\n\t\t\t\t\t\tthis.scope.when('change:push.stream')\n\t\t\t\t\t]).then(() => this.join());\n\t\t\t\t}\n\n\t\t\t\tvar episode = this.adaptEpisode(episodeData);\n\n\t\t\t\tthis.set('waiting', false);\n\t\t\t\tthis.set('current', episode);\n\n\t\t\t\tdata.state.stateChanges.forEach(change => {\n\t\t\t\t\t// Quietly work up to current state (already publishing current episode etc)\n\t\t\t\t\tthis.onStateChange(change, true);\n\t\t\t\t});\n\n\t\t\t\treturn episode;\n\t\t\t}).catch(error => {\n\t\t\t\tlog.e('join()', error);\n\t\t\t\tthis.set('current', null);\n\t\t\t\treturn Promise.delay(5000).then(() => this.join());\n\t\t\t});\n\t\t}\n\n\t\tcheckState() {\n\t\t\tvar episode = this.getEpisode();\n\n\t\t\tif (this.checkingState) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.checkingState = true;\n\n\t\t\t// Note: For some reason this returns changes including specified version, hence the +1\n\t\t\tthis.scope.call('server.call', episodeSessionAPI.getEpisodeSessionStateAsChangesSince, {\n\t\t\t\tepisodeSessionId: episode.id,\n\t\t\t\tsinceVersion: episode.version ? episode.version + 1 : 1\n\t\t\t}).then(data => {\n\t\t\t\tdata.stateChanges.forEach(change => this.onStateChange(change));\n\t\t\t}).finally(() => {\n\t\t\t\tthis.checkingState = false;\n\t\t\t});\n\t\t}\n\n\t\tgetEpisode() {\n\t\t\treturn this.model.current;\n\t\t}\n\n\t\tgetInteraction(id) {\n\t\t\tvar episode = this.getEpisode();\n\t\t\treturn episode && episode.interactionMap[id];\n\t\t}\n\n\t\tgetCurrentInteraction() {\n\t\t\tvar episode = this.getEpisode();\n\t\t\treturn episode && episode.interactionQueue[0];\n\t\t}\n\n\t\t/**\n\t\t * Returns a Promise of an array of interactions from specified async phase.\n\t\t *\n\t\t * Interactions are stored in {@link playtotv.episode.Episode#asyncInteractions}.\n\t\t * If interactions for specified phase were already previously stored there, they are returned.\n\t\t * Otherwise {@link playtotv.episode.episodeSessionAPI.getAsyncDataForEpisodeSession} is called.\n\t\t *\n\t\t * @param {string} [phase=Current episode phase]\n\t\t * @returns {Promise} Promise of an array of interactions from specified async phase\n\t\t */\n\t\tgetAsyncInteractions(phase) {\n\t\t\tvar episode = this.getEpisode();\n\n\t\t\t// TODO: Also add support for getting async data for all phases (phase param has become optional)?\n\t\t\tphase = phase || episode.currentPhase;\n\n\t\t\tvar interactions = episode.asyncInteractions[phase];\n\t\t\tif (interactions) {\n\t\t\t\treturn Promise.resolve(interactions);\n\t\t\t}\n\n\t\t\treturn this.scope.call('server.call', episodeSessionAPI.getAsyncDataForEpisodeSession, {\n\t\t\t\tepisodeSessionId: episode.id,\n\t\t\t\tphase: phase\n\t\t\t}).then(data => {\n\t\t\t\tinteractions = data.map(item => {\n\t\t\t\t\tvar interaction = this.upsertInteraction(item);\n\t\t\t\t\t// Change state to ANSWER to enable answering\n\t\t\t\t\tinteraction.state = 'ANSWER';\n\t\t\t\t\treturn interaction;\n\t\t\t\t});\n\n\t\t\t\tepisode.asyncInteractions[phase] = interactions;\n\n\t\t\t\treturn interactions;\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Returns a Promise of the first interaction from specified async phase that has no user data.\n\t\t * E.g: For which no answer has been submitted yet.\n\t\t *\n\t\t * Uses: {@link playtotv.episode.EpisodeController#getAsyncInteractions}\n\t\t *\n\t\t * @param {string} [phase=Current episode phase]\n\t\t * @returns {Promise} Promise of the first interaction from specified async phase that has no user data\n\t\t */\n\t\tgetNextAsyncInteraction(phase) {\n\t\t\tphase = phase || this.getEpisode().currentPhase;\n\t\t\treturn this.getAsyncInteractions(phase).then(interactions => {\n\t\t\t\treturn interactions.find(interaction => !interaction.data);\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * TODO: JSDoc\n\t\t */\n\t\tsubmitInteraction(method, interactionId, params, adaptor) {\n\t\t\treturn this.scope.call('server.toServerTime').then(serverTime => {\n\t\t\t\tvar episode = this.getEpisode();\n\t\t\t\tvar interaction = episode.interactionMap[interactionId];\n\t\t\t\tvar stateTime = interaction.stateTimeMap.ANSWER;\n\n\t\t\t\tparams.episodeSessionId = episode.id;\n\t\t\t\tif (params.clientAnswerTime) {\n\t\t\t\t\tparams.clientAnswerTime = serverTime - stateTime;\n\t\t\t\t}\n\n\t\t\t\treturn this.scope.call('server.call', method, params).then(data => {\n\t\t\t\t\tif (adaptor) {\n\t\t\t\t\t\tdata = adaptor(interaction.data, data);\n\t\t\t\t\t}\n\t\t\t\t\tthis.setInteractionUserData(episode.id, interaction, data);\n\t\t\t\t\tthis.publish('interaction-submitted-' + interactionId, data);\n\t\t\t\t\treturn data;\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tgetInteractionUserData(episodeId, interactionId) {\n\t\t\tvar interactionUserDataMap = this.model.episodeInteractionUserDataMap[episodeId];\n\t\t\treturn interactionUserDataMap && interactionUserDataMap[interactionId];\n\t\t}\n\n\t\tsetInteractionUserData(episodeId, interaction, data) {\n\t\t\t// Note: No need for more then one episode\n\t\t\tvar episodeInteractionUserDataMap = ptv.pick(this.model.episodeInteractionUserDataMap, [ episodeId ]);\n\t\t\tvar interactionUserDataMap = episodeInteractionUserDataMap[episodeId] ||\n\t\t\t\t(episodeInteractionUserDataMap[episodeId] = {});\n\t\t\tinteraction.data = interactionUserDataMap[interaction.id] = data;\n\t\t\tthis.set('episodeInteractionUserDataMap', episodeInteractionUserDataMap, { force: true });\n\t\t}\n\n\t\tupsertInteraction(payload) {\n\t\t\tvar id = payload.interactionId;\n\t\t\tvar data = payload.data || {};\n\t\t\tvar episode = this.getEpisode();\n\t\t\tvar interactionMap = episode.interactionMap;\n\t\t\tvar interaction = interactionMap[id];\n\n\t\t\tif (!interaction) {\n\t\t\t\tinteraction = interactionMap[id] = {\n\t\t\t\t\tid: id,\n\t\t\t\t\ttype: payload.type,\n\t\t\t\t\tstateTimeMap: {},\n\t\t\t\t\tstateDurationMap: {},\n\t\t\t\t\tdata: this.getInteractionUserData(episode.id, id)\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (data.interactionContent) {\n\t\t\t\tinteraction.content = data.interactionContent;\n\t\t\t}\n\t\t\tif (data.interactionStats) {\n\t\t\t\tinteraction.stats = data.interactionStats;\n\t\t\t}\n\t\t\tif (data.interactionUserData) {\n\t\t\t\tthis.setInteractionUserData(episode.id, interaction, data.interactionUserData);\n\t\t\t}\n\n\t\t\treturn interaction;\n\t\t}\n\n\t\tqueueInteraction(interaction) {\n\t\t\tvar episode = this.getEpisode();\n\t\t\tvar queue = episode.interactionQueue;\n\t\t\tvar index = queue.indexOf(interaction);\n\n\t\t\t// Remove interaction from wherever it was in the queue\n\t\t\tif (index !== -1) {\n\t\t\t\tqueue.splice(index, 1);\n\t\t\t}\n\n\t\t\t// Add interaction back to beginning of queue unless it is finished\n\t\t\t// Note: Prediction interactions behave differently, popping off while AWAITING_RESULTS\n\t\t\tvar state = interaction.state;\n\t\t\tvar type = interaction.type;\n\t\t\tif (\n\t\t\t\tstate === 'FINISHED' ||\n\t\t\t\tstate === 'AWAITING_RESULTS' && this.predictionTypes.indexOf(type) >= 0\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tqueue.unshift(interaction);\n\t\t}\n\n\t\tupdateInteractionPosition(interaction) {\n\t\t\tvar content = interaction.content || {};\n\t\t\tvar episode = this.getEpisode();\n\t\t\t// TODO: Check with Mark whether we can replace lastquestion by lastInteraction\n\t\t\tepisode.position =\n\t\t\t\tinteraction.state === 'FINISHED' && content.lastquestion === 'true' ? 'AFTER' : 'BETWEEN';\n\t\t}\n\n\t\tonStreamChange() {\n\t\t\tif (this.getEpisode()) {\n\t\t\t\tthis.checkState();\n\t\t\t}\n\t\t}\n\n\t\tonChangeEvent(event) {\n\t\t\tvar payload = event.payload;\n\t\t\tvar episode = this.getEpisode();\n\t\t\tif (!episode || payload.episodeSessionId !== episode.id) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.onStateChange(payload);\n\t\t}\n\n\t\tonStateChange(change, quiet) {\n\t\t\tvar episode = this.getEpisode();\n\t\t\tvar version = episode.version;\n\t\t\tvar subject = change.subject;\n\t\t\tvar newVersion = change.version;\n\n\t\t\t// Catch any unusual changes\n\t\t\tif (newVersion <= version) {\n\t\t\t\tlog.d('onStateChange: Skipping: ' + newVersion + ' (already at: ' + version + ')');\n\t\t\t\treturn;\n\t\t\t} else if (newVersion > version + 1) {\n\t\t\t\tlog.d('onStateChange: Missed changes between: ' + version + ' and ' + newVersion);\n\t\t\t\tthis.checkState();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar publishIfNotQuiet = function(channel) {\n\t\t\t\tif (!quiet) {\n\t\t\t\t\tthis.publish(channel, change);\n\t\t\t\t}\n\t\t\t}.bind(this);\n\n\t\t\tswitch (subject) {\n\t\t\t\tcase 'PHASE': this.onPhaseChange(change, quiet); break;\n\t\t\t\tcase 'INTERACTION': this.onInteractionChange(change, quiet); break;\n\t\t\t\tcase 'LEADERBOARD_UPDATED': publishIfNotQuiet('leaderboard-update'); break;\n\t\t\t\tcase 'LEADERBOARD_FINAL': publishIfNotQuiet('leaderboard-final'); break;\n\t\t\t\tdefault: log.d('onStateChange: No handler defined for subject: ' + subject);\n\t\t\t}\n\n\t\t\tepisode.version = newVersion;\n\t\t}\n\n\t\tonPhaseChange(change, quiet) {\n\t\t\tvar episode = this.getEpisode();\n\t\t\tvar phase = change.sessionPhase;\n\n\t\t\tepisode.currentPhase = phase;\n\t\t\tif (!quiet) {\n\t\t\t\tthis.publish('phase-change-' + phase, change);\n\t\t\t}\n\n\t\t\tif (phase === 'CLOSED') {\n\t\t\t\tthis.set('current', null);\n\t\t\t\tthis.join();\n\t\t\t}\n\t\t}\n\n\t\tonInteractionChange(change, quiet) {\n\t\t\tvar interaction = this.upsertInteraction(change);\n\n\t\t\tvar state = change.interactionState;\n\t\t\tinteraction.state = state;\n\t\t\tinteraction.stateTimeMap[state] = change.time;\n\t\t\tinteraction.stateDurationMap[state] = change.duration;\n\n\t\t\tchange.interaction = interaction;\n\n\t\t\tthis.queueInteraction(interaction);\n\n\t\t\tthis.updateInteractionPosition(interaction);\n\n\t\t\tif (!quiet) {\n\t\t\t\tthis.publish('interaction-change-' + change.interactionId, change);\n\t\t\t}\n\t\t}\n\n\t\tonUpdateEvent(event) {\n\t\t\tvar payload = event.payload;\n\t\t\tvar episode = this.getEpisode();\n\n\t\t\tif (!episode || payload.episodeSessionId !== episode.id) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar oldJSON = JSON.stringify(this.getInteraction(payload.interactionId));\n\n\t\t\tvar interaction = this.upsertInteraction(payload);\n\n\t\t\tif (JSON.stringify(interaction) === oldJSON) {\n\t\t\t\treturn; // nothing changed\n\t\t\t}\n\n\t\t\tpayload.interaction = interaction;\n\n\t\t\tthis.publish('interaction-update-' + payload.interactionId, payload);\n\t\t}\n\n\t\tserialize(data) {\n\t\t\treturn ptv.pick(data, [ 'episodeInteractionUserDataMap' ]);\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.fx.EffectsController', [\n\t'playtotv.mvc.Controller'\n], function(\n\tController\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar dom = ptv.dom;\n\n\t/**\n\t * Monitors DOM mutations and triggers transitions on nodes matching selectors from transitionMap.\n\t * Transitions are objects with enter and leave properties that are class names that start animations.\n\t */\n\treturn class EffectsController extends Controller {\n\t\tconstructor(context, options) {\n\t\t\toptions = ptv.params(options, {\n\t\t\t\ttransitions: {}, // name to transition object with enter and leave properties (animation class names)\n\t\t\t\tdefaults: {},\n\t\t\t\tfxDelay: 250\n\t\t\t});\n\n\t\t\tsuper(context);\n\n\t\t\tthis.addMethods([\n\t\t\t\t'once'\n\t\t\t]);\n\n\t\t\tthis.transitionMap = options.transitions;\n\t\t\tthis.defaultMap = options.defaults;\n\t\t\tthis.onceMap = {};\n\t\t\tthis.delay = options.fxDelay;\n\n\t\t\tvar view = this.scope.view;\n\t\t\tview.nodeAddedListeners.push(this.onNodeAdded.bind(this));\n\t\t\tview.nodeRemoveListeners.push(this.onNodeRemove.bind(this));\n\t\t}\n\n\t\t/**\n\t\t * Queues a transition to be played on the next DOM mutation that matches the given selector.\n\t\t * May be used to override default transitions.\n\t\t * Once played, the once entry is removed.\n\t\t */\n\t\tonce(selector, transitionName) {\n\t\t\tif (!this.transitionMap[transitionName]) {\n\t\t\t\tthrow new Error('Unknown transition: ' + transitionName);\n\t\t\t}\n\t\t\tthis.onceMap[selector] = transitionName;\n\t\t}\n\n\t\tgetSelectors() {\n\t\t\treturn ptv.union(Object.keys(this.defaultMap), Object.keys(this.onceMap));\n\t\t}\n\n\t\t/**\n\t\t * Returns any transition that should be applied to nodes matching specified selector.\n\t\t */\n\t\tgetTransition(selector) {\n\t\t\tvar transitionName = this.onceMap[selector] || this.defaultMap[selector];\n\t\t\treturn this.transitionMap[transitionName];\n\t\t}\n\n\t\t/**\n\t\t * Called by the view before nodes are removed from DOM.\n\t\t * Returns a delay to allow for any leave animations to finish before the node is removed.\n\t\t *\n\t\t * TODO: Enable overriding default delay, e.g: with a data attribute\n\t\t */\n\t\tonNodeRemove(node) {\n\t\t\tvar affected = false;\n\n\t\t\tthis.getSelectors().\n\t\t\t\tfilter(selector => dom.matches(selector, node)).\n\t\t\t\tforEach(selector => {\n\t\t\t\t\tvar transition = this.getTransition(selector);\n\t\t\t\t\tthis.playAnimation(node, transition.leave);\n\t\t\t\t\taffected = true;\n\t\t\t\t});\n\n\t\t\treturn affected ? this.delay : 0;\n\t\t}\n\n\t\t/**\n\t\t * Checks the added node and triggers animations for matching selectors of registered transitions.\n\t\t */\n\t\tonNodeAdded(node) {\n\t\t\tthis.getSelectors().\n\t\t\t\tfilter(selector => dom.matches(selector, node)).\n\t\t\t\tforEach(selector => {\n\t\t\t\t\tvar transition = this.getTransition(selector);\n\t\t\t\t\tthis.playAnimation(node, transition.enter);\n\n\t\t\t\t\t// Clear any onced entry here to ensure that both leave and enter animations are played\n\t\t\t\t\t// since in transitions the node remove (leave) precedes the node add (enter)\n\t\t\t\t\tdelete this.onceMap[selector];\n\t\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Starts animation by adding it as a class and storing it for later removal.\n\t\t */\n\t\tplayAnimation(node, animation) {\n\t\t\tif (!animation) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Clean up any previous animation class\n\t\t\tvar prevAnimation = dom.getData(node, 'fx-animation');\n\t\t\tif (prevAnimation) {\n\t\t\t\tdom.removeData(node, 'fx-animation');\n\t\t\t\tnode.classList.remove(prevAnimation);\n\t\t\t}\n\n\t\t\tdom.setData(node, 'fx-animation', animation);\n\t\t\tnode.classList.add(animation);\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.global.GlobalController', [\n\t'playtotv.global.genericContentAPI',\n\t'playtotv.global.globalDataAPI',\n\t'playtotv.mvc.Controller',\n\t'playtotv.cron'\n], function(\n\tgenericContentAPI,\n\tglobalDataAPI,\n\tController,\n\tcron\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar util = ptv.util;\n\n\treturn class GlobalController extends Controller {\n\t\tconstructor(context, options) {\n\t\t\toptions = ptv.params(options, {\n\t\t\t\ttimeZone: util.getTimeZone()\n\t\t\t});\n\n\t\t\t// Note: model with global data is implicitly persisted\n\t\t\tsuper(context);\n\n\t\t\tthis.getContent = Promise.limit(this.getContentNow, 10 * 60 * 1000);\n\n\t\t\tthis.addMethods([\n\t\t\t\t'update',\n\t\t\t\t'getContent'\n\t\t\t]);\n\n\t\t\tthis.options = options;\n\n\t\t\t// Note: Using slow polling as a reliable method for staying up-to-date\n\t\t\tvar update = this.update.bind(this);\n\t\t\tcron.at(Date.now(), update, { repeat: 5 * 60 * 1000 });\n\n\t\t\t// Fast, but slightly unreliable, ways of staying up-to-date\n\t\t\tthis.scope.subscribe('push.GLOBALDATA-REPLACED', event => this.onData(event.payload));\n\t\t\tthis.scope.subscribe('push.GLOBALDATA-UPDATED', event => this.onUpdate(event.payload));\n\t\t}\n\n\t\tupdate() {\n\t\t\tthis.scope.call('server.call', globalDataAPI.get, this.options).then(this.onData.bind(this));\n\t\t}\n\n\t\tgetContentNow(category) {\n\t\t\treturn this.scope.call('server.call', genericContentAPI.getCategory, {\n\t\t\t\tcategory: category\n\t\t\t});\n\t\t}\n\n\t\tonData(data) {\n\t\t\tptv.each(data, (value, key) => {\n\t\t\t\t// Note: set() will only trigger model changes when value has actually changed\n\t\t\t\tthis.set(key, value);\n\t\t\t});\n\t\t}\n\n\t\tonUpdate(payload) {\n\t\t\tvar { category, object, uniqueIdField } = payload;\n\t\t\tvar items = this.model[category] || [];\n\t\t\tvar item = items.find(candidate => candidate[uniqueIdField] === object[uniqueIdField]);\n\n\t\t\tif (item) {\n\t\t\t\tptv.extend(item, object);\n\t\t\t} else {\n\t\t\t\titems.push(object);\n\t\t\t}\n\n\t\t\t// Force change publish in case we just changed an existing item in the existing array\n\t\t\tthis.set(category, items, { force: true });\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.Timer', [], function() {\n\n\t'use strict';\n\n\t/**\n\t * A simple class for tracking timings and producing a summarizing string for those.\n\t *\n\t * Parts of the total timing interval can be marked using the start() and end() methods.\n\t * Note: Those parts should not overlap, otherwise the unaccounted time will be incorrect.\n\t */\n\treturn class Timer {\n\t\tconstructor() {\n\t\t\tthis.t0 = Date.now();\n\t\t\tthis.accounted = 0;\n\t\t\tthis.timings = [];\n\t\t}\n\n\t\tnow() {\n\t\t\t// Note: You can also use window.performance.now() for increased accuracy, but it quickly becomes spammy\n\t\t\treturn Date.now();\n\t\t}\n\n\t\tstart() {\n\t\t\tthis.tx = Date.now();\n\t\t}\n\n\t\tend(label) {\n\t\t\tvar time = Date.now() - this.tx;\n\t\t\tdelete this.tx;\n\t\t\tthis.accounted += time;\n\t\t\tthis.timings.push(label + ': ' + time);\n\t\t}\n\n\t\ttoString() {\n\t\t\tvar total = Date.now() - this.t0;\n\t\t\tvar timings = this.timings.join(', ');\n\t\t\tvar unaccounted = total - this.accounted;\n\t\t\treturn `${total}ms (${timings}) +${unaccounted}`;\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.mvc.View', [\n\t'playtotv.pubsub.PubSub',\n\t'playtotv.Timer'\n], function(\n\tPubSub,\n\tTimer\n) {\n\t// TODO: JSDOC\n\t// TODO: Convert all functions to class methods to allow extending and overriding\n\n\t'use strict';\n\n\t// Copied from: https://developer.mozilla.org/en-US/docs/Web/API/Node.nodeType\n\tvar ELEMENT_NODE = 1;\n\tvar TEXT_NODE = 3;\n\tvar COMMENT_NODE = 8;\n\n\tvar ptv = playtotv;\n\tvar REQUIRED = ptv.REQUIRED;\n\n\t// Polymer.dom() is used where necessary (and if available) to mix nicely with WebComponents\n\tfunction pdom(node) {\n\t\tvar Polymer = window.Polymer;\n\t\treturn Polymer ? Polymer.dom(node) : node;\n\t}\n\n\tfunction linkNode(node, domNode) {\n\t\tnode.domNode = domNode;\n\n\t\t// A simple way of linking nodes to nodes that assumes the node trees match\n\t\tvar childNodes = node.childNodes;\n\t\tvar domChildNodes = pdom(domNode).childNodes;\n\t\tvar i, len = childNodes.length;\n\t\tfor (i = 0; i < len; i++) {\n\t\t\tlinkNode(childNodes[i], domChildNodes[i]);\n\t\t}\n\t}\n\n\t// Note: This does not recurse to test equality of children\n\t// If id or view-id are specified then other attributes are ignored\n\t// Text/Comment node data and Element class attribute are also ignored here\n\tfunction nodesEqual(node1, node2) {\n\t\t/*jshint maxcomplexity:100, maxstatements:100*/\n\n\t\tvar nodeType = node1.nodeType;\n\n\t\tif (nodeType !== node2.nodeType) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (nodeType === TEXT_NODE || nodeType === COMMENT_NODE) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (node1.nodeName !== node2.nodeName) {\n\t\t\treturn false;\n\t\t}\n\n\t\tvar id1 = node1.id;\n\t\tvar id2 = node2.id;\n\t\tif (id1 || id2) {\n\t\t\treturn id1 === id2;\n\t\t}\n\n\t\tid1 = node1.getAttribute('view-id');\n\t\tid2 = node2.getAttribute('view-id');\n\t\tif (id1 || id2) {\n\t\t\treturn id1 === id2;\n\t\t}\n\n\t\tvar attributes = node1.attributes;\n\t\tvar i, len, attr, name;\n\t\tfor (i = 0, len = attributes.length; i < len; i++) {\n\t\t\tattr = attributes[i];\n\t\t\tname = attr.name;\n\t\t\tif (name !== 'class' && node2.getAttribute(name) !== attr.value) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\tattributes = node2.attributes;\n\t\tfor (i = 0, len = attributes.length; i < len; i++) {\n\t\t\tattr = attributes[i];\n\t\t\tname = attr.name;\n\t\t\tif (name !== 'class' && node1.getAttribute(name) !== attr.value) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tfunction popEqualNode(node, candidates) {\n\t\tvar i, candidate, len = candidates.length;\n\t\tfor (i = 0; i < len; i++) {\n\t\t\tcandidate = candidates[i];\n\t\t\tif (nodesEqual(node, candidate)) {\n\t\t\t\treturn candidates.splice(i, 1)[0];\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction addAttributeDiffs(oldNode, newNode, domNode, diffs) {\n\t\tvar attributes, i, len, attr, name, value;\n\n\t\tattributes = newNode.attributes;\n\t\tfor (i = 0, len = attributes.length; i < len; i++) {\n\t\t\tattr = attributes[i];\n\t\t\tname = attr.name;\n\t\t\tvalue = attr.value;\n\t\t\tif (name !== 'class' && oldNode.getAttribute(name) !== attr.value) {\n\t\t\t\tdiffs.push({ action: 'set-attr', node: domNode, name: name, value: value });\n\t\t\t}\n\t\t}\n\n\t\tattributes = oldNode.attributes;\n\t\tfor (i = 0, len = attributes.length; i < len; i++) {\n\t\t\tattr = attributes[i];\n\t\t\tname = attr.name;\n\t\t\tif (name !== 'class' && !newNode.hasAttribute(name)) {\n\t\t\t\tdiffs.push({ action: 'remove-attr', node: domNode, name: name });\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction addClassDiffs(oldNode, newNode, domNode, diffs) {\n\t\tvar oldClassList = oldNode.classList;\n\t\tvar newClassList = newNode.classList;\n\t\tvar i, name, len;\n\n\t\tfor (i = 0, len = newClassList.length; i < len; i++) {\n\t\t\tname = newClassList[i];\n\t\t\tif (!oldClassList.contains(name)) {\n\t\t\t\tdiffs.push({ action: 'add-class', node: domNode, name: name });\n\t\t\t}\n\t\t}\n\n\t\tfor (i = 0, len = oldClassList.length; i < len; i++) {\n\t\t\tname = oldClassList[i];\n\t\t\tif (!newClassList.contains(name)) {\n\t\t\t\tdiffs.push({ action: 'remove-class', node: domNode, name: name });\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction diffNodes(oldNode, newNode, diffs) {\n\t\tvar oldChildren = oldNode.childNodes;\n\t\tvar newChildren = Array.from(newNode.childNodes);\n\t\tvar i, len, oldChild, newChild;\n\n\t\t// Pass on domNode reference\n\t\tvar domNode = oldNode.domNode;\n\t\tnewNode.domNode = domNode;\n\n\t\t// Consider text nodes to be equal and just change their text through their data property via a 'text' diff\n\t\tvar nodeType = oldNode.nodeType;\n\t\tif (nodeType === TEXT_NODE || nodeType === COMMENT_NODE) {\n\t\t\tvar text = newNode.data;\n\t\t\tif (text !== oldNode.data) {\n\t\t\t\tdiffs.push({ action: 'text', node: domNode, data: text });\n\t\t\t}\n\t\t\treturn; // done; text nodes do not have attributes or children\n\t\t}\n\n\t\tif (nodeType === ELEMENT_NODE) {\n\t\t\t// Handle any changes to attribute values via 'set-attr' and 'remove-attr' diffs\n\t\t\taddAttributeDiffs(oldNode, newNode, domNode, diffs);\n\n\t\t\t// Handle class changes by individual 'add-class' and 'remove-class' diffs for more mergeable diffs\n\t\t\taddClassDiffs(oldNode, newNode, domNode, diffs);\n\t\t}\n\n\t\tfor (i = 0, len = oldChildren.length; i < len; i++) {\n\t\t\toldChild = oldChildren[i];\n\t\t\tnewChild = popEqualNode(oldChild, newChildren);\n\t\t\tif (newChild) {\n\t\t\t\t// Recurse into equal children's children\n\t\t\t\tdiffNodes(oldChild, newChild, diffs);\n\t\t\t} else {\n\t\t\t\tdiffs.push({ action: 'remove', node: oldChild });\n\t\t\t}\n\t\t}\n\n\t\tfor (i = 0, len = newChildren.length; i < len; i++) {\n\t\t\tnewChild = newChildren[i];\n\t\t\tdiffs.push({ action: 'add', node: newChild });\n\t\t}\n\t}\n\n\t// Remove text nodes that consist only of tabs and/or new lines\n\t// (e.g: html or template code indentation that is generally pointless)\n\t// We do this because it usually provides a big (e.g: 4x) performance improvement*\n\t// If undesired, you can work around this by using other space characters\n\t// or disable this for all of a node's children by adding a view-indented attribute\n\t// *) It's not just about the number of nodes, but also about DOM slowing down especially because of these nodes\n\tfunction pruneIndentation(node) {\n\t\tif (node.hasAttribute && node.hasAttribute('view-indented')) {\n\t\t\treturn;\n\t\t}\n\t\tvar children = node.childNodes;\n\t\tvar i, child, len = children.length;\n\t\tfor (i = len - 1; i >= 0; i--) {\n\t\t\tchild = children[i];\n\t\t\tif (child.nodeType === TEXT_NODE) {\n\t\t\t\tif (/^[\t\n]+$/.test(child.data)) {\n\t\t\t\t\tnode.removeChild(child);\n\t\t\t\t}\n\t\t\t} else if (child.childNodes) {\n\t\t\t\tpruneIndentation(child);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * View projects model onto DOM by rendering the main template and analyzing and applying DOM diffs.\n\t */\n\treturn class View extends PubSub {\n\n\t\tconstructor(options) {\n\t\t\tptv.params(options, {\n\t\t\t\trender: REQUIRED,\n\t\t\t\tthrottle: 100,\n\t\t\t\tinterval: 10000 // continuous update interval\n\t\t\t});\n\n\t\t\tsuper();\n\n\t\t\tthis.render = options.render;\n\t\t\tvar throttle = options.throttle;\n\t\t\tthis.interval = options.interval;\n\n\t\t\tvar parser = this.parser = new window.DOMParser();\n\t\t\tthis.nodeAddedListeners = [];\n\t\t\tthis.nodeRemoveListeners = [];\n\n\t\t\t// Initialize with empty old render document, next render will append the initial view nodes\n\t\t\t// other nodes already in the document are left as-is\n\t\t\tvar oldHTML = this.oldHTML = '';\n\t\t\tvar oldDoc = this.oldDoc = parser.parseFromString(oldHTML, 'text/html');\n\t\t\toldDoc.domNode = document;\n\t\t\t[ 'documentElement', 'head', 'body' ].forEach(prop => {\n\t\t\t\toldDoc[prop].domNode = document[prop];\n\t\t\t});\n\n\t\t\t// Use Promise.throttle to throttle and block change processing until last update has resolved\n\t\t\tthis.update = Promise.throttle(this.updateNow.bind(this), throttle);\n\t\t}\n\n\t\tupdateNow() {\n\t\t\t/*jshint maxstatements:100*/\n\n\t\t\tvar timer = new Timer();\n\t\t\tvar oldHTML = this.oldHTML;\n\n\t\t\tclearTimeout(this.intervalTimeout);\n\t\t\tthis.intervalTimeout = setTimeout(this.update, this.interval);\n\n\t\t\ttimer.start();\n\t\t\tvar newHTML = this.render();\n\t\t\ttimer.end('render');\n\n\t\t\tif (newHTML === oldHTML) {\n\t\t\t\tthis.publish('update', timer.toString());\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar oldDoc = this.oldDoc;\n\t\t\ttimer.start();\n\t\t\tvar newDoc = this.parser.parseFromString(newHTML, 'text/html');\n\t\t\ttimer.end('parse');\n\n\t\t\tpruneIndentation(newDoc);\n\n\t\t\ttimer.start();\n\t\t\tvar diffs = [];\n\t\t\tdiffNodes(oldDoc, newDoc, diffs);\n\t\t\ttimer.end('diff');\n\n\t\t\tvar finish = () => {\n\t\t\t\tthis.fixNodeOrder(newDoc);\n\n\t\t\t\tthis.oldDoc = newDoc;\n\t\t\t\tthis.oldHTML = newHTML;\n\n\t\t\t\tthis.publish('update', timer.toString());\n\t\t\t};\n\n\t\t\tif (diffs.length === 0) {\n\t\t\t\tfinish();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar delay = this.getDiffsDelay(diffs);\n\n\t\t\t// Compensate timer for delay\n\t\t\ttimer.t0 += delay;\n\n\t\t\tvar apply = () => {\n\t\t\t\tthis.publish('diffs', diffs);\n\n\t\t\t\ttimer.start();\n\t\t\t\tthis.applyDiffs(diffs);\n\t\t\t\ttimer.end('apply');\n\n\t\t\t\tfinish();\n\t\t\t};\n\n\t\t\treturn delay ? Promise.delay(delay).then(apply) : apply();\n\t\t}\n\n\t\t/**\n\t\t * Diff and Apply try to re-use nodes as much as possible, but can result in nodes ending up out of order.\n\t\t */\n\t\tfixNodeOrder(newNode) {\n\t\t\t/*global Node:false*/\n\t\t\t/*jshint bitwise:false*/\n\n\t\t\tvar parentDomNode = newNode.domNode;\n\t\t\tvar newChildren = newNode.childNodes;\n\t\t\tvar i, newDomChild, prevDomChild, len = newChildren.length;\n\n\t\t\tfor (i = len - 1; i > 0; i--) {\n\t\t\t\tnewDomChild = newChildren[i].domNode;\n\t\t\t\tprevDomChild = newChildren[i - 1].domNode;\n\n\t\t\t\t// Note: WebComponents can split up siblings, hence we ensure the nodes still share their parent\n\t\t\t\tif (\n\t\t\t\t\tnewDomChild.parentNode === prevDomChild.parentNode &&\n\t\t\t\t\tnewDomChild.compareDocumentPosition(prevDomChild) & Node.DOCUMENT_POSITION_FOLLOWING\n\t\t\t\t) {\n\t\t\t\t\tthis.publish('fix-node-order', prevDomChild);\n\t\t\t\t\tpdom(parentDomNode).insertBefore(prevDomChild, newDomChild);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (i = 0; i < len; i++) {\n\t\t\t\tthis.fixNodeOrder(newChildren[i]);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Calls onNodeRemove() hook on all removed nodes and returns maximum delay value returned by those.\n\t\t *\n\t\t * E.g: for exit animations\n\t\t */\n\t\tgetDiffsDelay(diffs) {\n\t\t\tvar delay = 0;\n\t\t\tvar i, diff, diffNode, len = diffs.length;\n\t\t\tfor (i = 0; i < len; i++) {\n\t\t\t\tdiff = diffs[i];\n\t\t\t\tdiffNode = diff.node;\n\t\t\t\tif (diff.action === 'remove') {\n\t\t\t\t\tdelay = Math.max(delay, this.onNodeRemove(diffNode));\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn delay;\n\t\t}\n\n\t\t/**\n\t\t * Applies diffs to DOM.\n\t\t */\n\t\tapplyDiffs(diffs) {\n\t\t\t/*jshint maxcomplexity:100*/\n\t\t\tvar i, diff, diffNode, importedNode, sibling, domSibling, len = diffs.length;\n\n\t\t\tfor (i = 0; i < len; i++) {\n\t\t\t\tdiff = diffs[i];\n\t\t\t\tdiffNode = diff.node;\n\n\t\t\t\tswitch (diff.action) {\n\t\t\t\t\tcase 'add':\n\t\t\t\t\t\t// Import diffNode from render and diff document to main document\n\t\t\t\t\t\timportedNode = document.importNode(diffNode, true);\n\t\t\t\t\t\tlinkNode(diffNode, importedNode);\n\n\t\t\t\t\t\t// Try to immediately insert a node in the right place\n\t\t\t\t\t\tif ((sibling = diffNode.nextSibling) && (domSibling = sibling.domNode)) {\n\t\t\t\t\t\t\tpdom(diffNode.parentNode.domNode).insertBefore(importedNode, domSibling);\n\t\t\t\t\t\t} else { // no siblings, just append\n\t\t\t\t\t\t\tpdom(diffNode.parentNode.domNode).appendChild(importedNode);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.onNodeAdded(diffNode);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'remove':\n\t\t\t\t\t\tpdom(diffNode.parentNode.domNode).removeChild(diffNode.domNode);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'text':\n\t\t\t\t\t\tdiffNode.data = diff.data;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'set-attr':\n\t\t\t\t\t\t// TODO: Should we trigger a 'change' event here or something?\n\t\t\t\t\t\tpdom(diffNode).setAttribute(diff.name, diff.value);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'remove-attr':\n\t\t\t\t\t\tpdom(diffNode).removeAttribute(diff.name);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'add-class':\n\t\t\t\t\t\tpdom(diffNode).classList.add(diff.name);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'remove-class':\n\t\t\t\t\t\tpdom(diffNode).classList.remove(diff.name);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Calls all nodeAddedListeners with a node after it has been added to the DOM.\n\t\t *\n\t\t * Note: This is called recursively for each node that is added and it's children.\n\t\t *\n\t\t * @param {Node} node Node that has just been added to DOM\n\t\t */\n\t\tonNodeAdded(node) {\n\t\t\tif (node.nodeType !== ELEMENT_NODE) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar domNode = node.domNode;\n\n\t\t\tvar listeners = this.nodeAddedListeners;\n\t\t\tvar i, len = listeners.length;\n\t\t\tfor (i = 0; i < len; i++) {\n\t\t\t\tlisteners[i](domNode);\n\t\t\t}\n\n\t\t\tvar childNodes = node.childNodes;\n\t\t\tlen = childNodes.length;\n\t\t\tfor (i = 0; i < len; i++) {\n\t\t\t\tthis.onNodeAdded(childNodes[i]);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Calls all nodeRemoveListeners with a node before it is removed from the DOM.\n\t\t *\n\t\t * Remove listeners can return a delay in ms specifying the minimum amount of time to wait before actually\n\t\t * removing the node from the DOM (e.g: to allow an exit animation to finish first).\n\t\t *\n\t\t * Note: This is called recursively for each node that is removed and it's children.\n\t\t *\n\t\t * @param {Node} node Node that is about to be removed\n\t\t * @returns {number} Maximum of all the delays returned by the listeners\n\t\t */\n\t\tonNodeRemove(node) {\n\t\t\tif (node.nodeType !== ELEMENT_NODE) {\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\tvar domNode = node.domNode;\n\n\t\t\tvar listeners = this.nodeRemoveListeners;\n\t\t\tvar delay = 0;\n\t\t\tvar i, len = listeners.length;\n\t\t\tfor (i = 0; i < len; i++) {\n\t\t\t\tdelay = Math.max(delay, listeners[i](domNode) || 0);\n\t\t\t}\n\n\t\t\tvar childNodes = node.childNodes;\n\t\t\tlen = childNodes.length;\n\t\t\tfor (i = 0; i < len; i++) {\n\t\t\t\tdelay = Math.max(delay, this.onNodeRemove(childNodes[i]));\n\t\t\t}\n\n\t\t\treturn delay;\n\t\t}\n\n\t\tdispose() {\n\t\t\tclearTimeout(this.intervalTimeout);\n\t\t\tsuper();\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.native.NativeController', [\n\t'playtotv.mvc.Controller'\n], function(\n\tController\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar REQUIRED = ptv.REQUIRED;\n\tvar util = ptv.util;\n\tvar commandIdCounter = 1;\n\n\treturn class NativeController extends Controller {\n\t\tconstructor(context) {\n\t\t\tsuper(context);\n\n\t\t\tthis.addMethods([\n\t\t\t\t'getGatekeeper',\n\t\t\t\t'getWrapper',\n\t\t\t\t'sendMessage',\n\t\t\t\t'sendCommand',\n\t\t\t\t'popup',\n\t\t\t\t'browser',\n\t\t\t\t'overlay',\n\t\t\t\t'dialog',\n\t\t\t\t'isTwitterAvailable',\n\t\t\t\t'tweet',\n\t\t\t\t'fbLogin',\n\t\t\t\t'fbLogout',\n\t\t\t\t'fbGraph',\n\t\t\t\t'fbShare',\n\t\t\t\t'loadAudio',\n\t\t\t\t'playAudio',\n\t\t\t\t'stopAudio'\n\t\t\t]);\n\n\t\t\tthis.wrapperPromise = this.when('Event.BridgeReady').then(this.onWrapper.bind(this));\n\t\t\tthis.gatekeeperPromise = this.when('Event.GatekeeperReady').then(this.onGatekeeper.bind(this));\n\n\t\t\tthis.subscribe('Event.BackButton', this.onBackButton.bind(this));\n\n\t\t\tthis.subscribe('Event.PushEnabled', this.onPushEnabled.bind(this));\n\t\t\tthis.model.subscribe('change:pushEnabled', this.onPushEnabledChange.bind(this));\n\n\t\t\tvar wrapper = window.nativeWrapper;\n\t\t\tif (wrapper) {\n\t\t\t\tthis.publish('Event.BridgeReady');\n\t\t\t\tthis.sendMessage({ type: 'Event', subject: 'AppReady' });\n\t\t\t} else {\n\t\t\t\twrapper = window.nativeWrapper = {};\n\t\t\t}\n\n\t\t\tif (wrapper.onMessage) {\n\t\t\t\tthrow new Error('onMessage handler already defined');\n\t\t\t}\n\t\t\twrapper.onMessage = this.onMessage.bind(this);\n\n\t\t\t// Fake AppResume, Wrappers do not (yet) send these\n\t\t\tthis.scope.pauseDog.add(10 * 1000, () => this.publish('Event.AppResume', {}));\n\t\t}\n\n\t\tonMessage(message) {\n\t\t\tvar type = message.type || 'Event';\n\t\t\tvar subject = message.subject;\n\t\t\tvar channel = type + '.' + subject;\n\n\t\t\tif (type === 'CommandResult') {\n\t\t\t\tchannel += '.' + message.commandId;\n\t\t\t}\n\n\t\t\tthis.publish(channel, message);\n\t\t}\n\n\t\tsendMessage(message) {\n\t\t\tptv.params(message, {\n\t\t\t\ttype: REQUIRED,\n\t\t\t\tsubject: REQUIRED,\n\t\t\t\tcommandId: -1,\n\t\t\t\tpayload: {}\n\t\t\t});\n\t\t\treturn this.wrapperPromise.then(wrapper => wrapper.sendMessage(message));\n\t\t}\n\n\t\tsendCommand(subject, payload) {\n\t\t\tvar commandId = commandIdCounter++;\n\n\t\t\t// Note: iOS wrapper sometimes synchronously calls onMessage so we need to start listening before we send\n\t\t\tvar resultPromise = this.when('CommandResult.' + subject + '.' + commandId).then(message => {\n\t\t\t\tvar error = message.error;\n\t\t\t\tif (error) {\n\t\t\t\t\tthrow ptv.extend(new Error(error.message || 'Command rejected: ' + error.code), error);\n\t\t\t\t}\n\n\t\t\t\treturn message.payload || {};\n\t\t\t});\n\n\t\t\tthis.sendMessage({\n\t\t\t\ttype: 'Command',\n\t\t\t\tsubject: subject,\n\t\t\t\tcommandId: commandId,\n\t\t\t\tpayload: payload\n\t\t\t});\n\n\t\t\treturn resultPromise;\n\t\t}\n\n\t\tonWrapper() {\n\t\t\tvar wrapper = window.nativeWrapper;\n\n\t\t\tthis.model.copyProperties(ptv.omit(wrapper, [\n\t\t\t\t'sendMessage', 'onMessage', 'gatekeeperResponse', 'gatekeeperTimestamp'\n\t\t\t]));\n\n\t\t\tif (wrapper.gatekeeperResponse) {\n\t\t\t\tthis.publish('Event.GatekeeperReady', {\n\t\t\t\t\tpayload: ptv.pick(wrapper, [ 'gatekeeperResponse', 'gatekeeperTimestamp' ])\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn wrapper;\n\t\t}\n\n\t\tonGatekeeper(message) {\n\t\t\tvar payload = message.payload;\n\t\t\treturn {\n\t\t\t\turl: window.nativeWrapper.serverUrl,\n\t\t\t\tgatekeeperData: payload.gatekeeperResponse,\n\t\t\t\tgatekeeperDataTime: payload.gatekeeperTimestamp\n\t\t\t};\n\t\t}\n\n\t\tonBackButton() {\n\t\t\tif (window.location.hash === '#' + this.scope.router.root) {\n\t\t\t\treturn this.dialog({\n\t\t\t\t\tmessage: 'Are you sure you want to close ' + this.model.name + '?',\n\t\t\t\t\tbuttons: [ 'YES', 'NO' ]\n\t\t\t\t}).then(result => {\n\t\t\t\t\tif (result.pressed === 'YES') {\n\t\t\t\t\t\tthis.sendCommand('Close');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.scope.back();\n\t\t}\n\n\t\tonPushEnabled(message) {\n\t\t\tthis.set('pushEnabled', message.payload.value);\n\t\t}\n\n\t\tonPushEnabledChange(enabled) {\n\t\t\t// Effectuate in wrapper or rollback local tentative state\n\t\t\tthis.sendCommand('SetPushEnabled', { value: enabled }).catch(() => {\n\t\t\t\t// E.g: reason.error === 'CannotEnablePush'\n\t\t\t\tthis.set('pushEnabled', false);\n\t\t\t});\n\t\t}\n\n\t\tgetWrapper() {\n\t\t\treturn this.wrapperPromise;\n\t\t}\n\n\t\tgetGatekeeper() {\n\t\t\treturn this.gatekeeperPromise;\n\t\t}\n\n\t\tdialog(options) {\n\t\t\toptions = ptv.params(options, {\n\t\t\t\ttitle: this.model.name,\n\t\t\t\tmessage: '',\n\t\t\t\tbuttons: [ 'OK' ]\n\t\t\t});\n\t\t\treturn this.sendCommand('OpenDialog', options);\n\t\t}\n\n\t\tpopup(url, target) {\n\t\t\treturn target === 'overlay' ? this.overlay(url) : this.browser(url);\n\t\t}\n\n\t\tbrowser(url) {\n\t\t\treturn this.sendCommand('BrowserOpen', { url: url });\n\t\t}\n\n\t\toverlay(url) {\n\t\t\treturn this.sendCommand('OverlayOpen', { url: url });\n\t\t}\n\n\t\t// TODO: Replace by iTunesOpen Command or something once that becomes available\n\t\titunes(id, options) {\n\t\t\tvar { affiliate } = ptv.params(options, {\n\t\t\t\taffiliate: undefined\n\t\t\t});\n\t\t\twindow.location = 'https://itunes.apple.com/dummy/id' + id +\n\t\t\t\taffiliate ? '?at=' + affiliate : '';\n\t\t}\n\n\t\t/* TWITTER */\n\n\t\tisTwitterAvailable() {\n\t\t\treturn this.sendCommand('IsTwitterAccountAvailable', {}).then(result => result.available);\n\t\t}\n\n\t\t// TODO: Replace by TwitterTweet Command or something once that becomes available\n\t\t// Legal option keys right now are: text, url, hashtags, via, related and in-reply-to\n\t\ttweet(options) {\n\t\t\tvar url = util.addURLParams('https://twitter.com/intent/tweet', options);\n\t\t\tutil.popup(url, 'tweet', { width: 550, height: 420 });\n\t\t}\n\n\t\t/* FACEBOOK */\n\n\t\tfbLogin(options) {\n\t\t\toptions = ptv.params(options, {\n\t\t\t\tinteractive: false,\n\t\t\t\tpermissions: []\n\t\t\t});\n\n\t\t\t// Facilitate calling by also allowing permissions to be specified as a comma separated string\n\t\t\tif (typeof options.permissions === 'string') {\n\t\t\t\toptions.permissions = options.permissions.split(/\\s*,\\s*/);\n\t\t\t}\n\n\t\t\treturn this.sendCommand('FacebookLogin', options);\n\t\t}\n\n\t\tfbLogout() {\n\t\t\treturn this.sendCommand('FacebookLogout');\n\t\t}\n\n\t\tfbGraph(path, method = 'get', params = {}) {\n\t\t\treturn this.sendCommand('FacebookGraphRequest', {\n\t\t\t\tpath: path,\n\t\t\t\tparameters: params,\n\t\t\t\thttpMethod: method\n\t\t\t});\n\t\t}\n\n\t\tfbShare(options) {\n\t\t\toptions = ptv.params(options, {\n\t\t\t\ttitle: '',\n\t\t\t\tdescription: '',\n\t\t\t\turl: REQUIRED,\n\t\t\t\timage: null\n\t\t\t});\n\t\t\tvar params = {\n\t\t\t\tcontentTitle: options.title,\n\t\t\t\tcontentDescription: options.description,\n\t\t\t\tcontentURL: options.url\n\t\t\t};\n\t\t\tif (options.image) {\n\t\t\t\tparams.imageURL = options.image;\n\t\t\t}\n\t\t\treturn this.sendCommand('FacebookShare', params);\n\t\t}\n\n\t\t/* AUDIO */\n\n\t\tloadAudio(url) {\n\t\t\treturn this.sendCommand('LoadAudio', { url: url });\n\t\t}\n\n\t\tplayAudio(url) {\n\t\t\treturn this.sendCommand('PlayAudio', { url: url });\n\t\t}\n\n\t\tstopAudio(url) {\n\t\t\treturn this.sendCommand('StopAudio', { url: url });\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.net.jsonp', [], function() {\n\n\t'use strict';\n\n\tvar nr = 0;\n\tvar id = this.id;\n\n\t/**\n\t * Loads a json response via jsonp, and returns a Promise that - when resolved - receives the json data.\n\t *\n\t * @name jsonp\n\t * @memberOf playtotv.net\n\t * @function\n\t * @param {string} url\n\t * @param {object} [params] Parameters to add to url\n\t * @param {number} [timeout=20000] Timeout in ms after which to reject this promise\n\t * @returns {Promise} Promise of JSON callback data\n\t */\n\tvar jsonp = function(url, params, timeout) {\n\t\tparams = params || {};\n\t\ttimeout = timeout || 20000;\n\n\t\t// TODO: Rewrite without use of Promise.defer() and as Cancellable for optional timeout\n\t\tvar deferred = Promise.defer();\n\t\tvar callback = 'cb' + (nr += 1);\n\t\tparams.callback = id + '.' + callback;\n\t\tvar request = playtotv.util.addURLParams(url, params);\n\t\tvar timeoutId;\n\n\t\tjsonp[callback] = function(json) {\n\t\t\tdeferred.resolve(json);\n\t\t\tdelete jsonp[callback];\n\t\t\tclearTimeout(timeoutId);\n\t\t};\n\n\t\tplaytotv.loadScript(request).then(function(script) {\n\t\t\tplaytotv.dom.remove(script);\n\t\t});\n\n\t\ttimeoutId = setTimeout(function() {\n\t\t\tdeferred.reject(new Error('Timeout'));\n\t\t\tdelete jsonp[callback];\n\t\t}, timeout);\n\n\t\treturn deferred.promise;\n\t};\n\n\treturn jsonp;\n});\n",
		"/**\n * Facilitates making cross origin requests by creating a mock XMLHttpRequest that proxies function calls on to a real\n * XMLHttpRequest created in an iframe of the target origin. These iframes require the 'xhr-proxy.html' file to be\n * available from the target server's root to complete the proxy functionality.\n *\n * @function\n * @name xhrProxy\n * @memberOf playtotv\n * @namespace\n */\nplaytotv.define('playtotv.net.xhrProxy', [], function() {\n\n\t'use strict';\n\n\t// Abort if we are not running in a browser (e.g: in Node)\n\tif (typeof window === 'undefined') {\n\t\treturn;\n\t}\n\n\tvar log = playtotv.Logger.get(this.id);\n\tvar dom = playtotv.dom;\n\tvar event = playtotv.event;\n\n\tvar xhrMethods = [ 'open', 'setRequestHeader', 'send', 'abort' ]; // to be proxied\n\tvar deferredWindows = {};\n\tvar xhrs = {};\n\tvar xhrCounter = 0;\n\tvar supportsObject = false; // start without object support for messaging\n\tvar rpcAbort = { method: 'abort', args: [] }; // special instance for easy detection with indexOf\n\n\t// Test to see if we can skip data stringification\n\tfunction supportsObjectTestHandler(msg) {\n\t\tsupportsObject = typeof msg.data === 'object';\n\t\tevent.removeListener(window, 'message', supportsObjectTestHandler);\n\t}\n\tevent.addListener(window, 'message', supportsObjectTestHandler);\n\twindow.postMessage({}, '*');\n\n\tevent.addListener(window, 'message', function(msg) {\n\t\t/*jshint maxcomplexity:100*/\n\t\tvar deferredWindow = deferredWindows[msg.origin];\n\t\tif (deferredWindow) { // ignore messages from other origins (Facebook, Hyves, ..)\n\t\t\tvar data = typeof msg.data === 'string' ? JSON.parse(msg.data) : msg.data;\n\t\t\tvar type = data.type;\n\t\t\tvar xhr = xhrs[data.id];\n\t\t\tvar label = 'onMessage: ' + msg.origin + ': ' + type;\n\n\t\t\t// Note: We use immediate to prevent Facebook's window message handler from whining\n\t\t\t(msg.stopImmediatePropagation || msg.stopPropagation).call(msg);\n\n\t\t\tif (type === 'initialized') {\n\t\t\t\tlog.s(label);\n\t\t\t\t// Resolving with a direct iframe window reference would result in 'when' examining the value to see\n\t\t\t\t// if it is a Promise later and in doing so throwing a cross origin DOM Exception 18.\n\t\t\t\t// We circumvent this by wrapping the window reference in another object.\n\t\t\t\tdeferredWindow.resolve({ win: msg.source });\n\t\t\t} else if (!xhr) {\n\t\t\t\tlog.d(label + ': xhr: ' + data.id + ' is undefined');\n\t\t\t} else if (type === 'event') {\n\t\t\t\tvar uploadEvent = data.upload;\n\t\t\t\tvar e = data.event;\n\t\t\t\tvar eventType = e.type;\n\t\t\t\tlog.s(label + ': ' + (uploadEvent ? 'upload: ' : '') + eventType + ': ' + e.loaded);\n\t\t\t\tvar obj = uploadEvent ? xhr.upload : xhr;\n\t\t\t\tvar listeners = obj._eventListenersMap[eventType];\n\t\t\t\tlisteners.forEach(function(listener) {\n\t\t\t\t\tlistener(e);\n\t\t\t\t});\n\t\t\t} else if (type === 'readyStateChange') {\n\t\t\t\txhr.status = data.status;\n\t\t\t\txhr.responseText = data.responseText;\n\t\t\t\txhr._readyStateChange(data.readyState);\n\t\t\t} else {\n\t\t\t\tlog.w(label + ': unsupported type');\n\t\t\t}\n\t\t}\n\t});\n\n\tfunction createIFrame(url) {\n\t\tvar iframe = dom.create('iframe', {\n\t\t\tsrc: url\n\t\t});\n\t\tplaytotv.extend(iframe.style, {\n\t\t\twidth: 0,\n\t\t\theight: 0,\n\t\t\tvisibility: 'hidden',\n\t\t\toverflow: 'hidden',\n\t\t\tposition: 'absolute',\n\t\t\tdisplay: 'none'\n\t\t});\n\t\treturn iframe;\n\t}\n\n\tfunction getWindow(origin) {\n\t\tvar deferredWindow = deferredWindows[origin];\n\t\tif (deferredWindow) {\n\t\t\treturn deferredWindow.promise;\n\t\t}\n\n\t\t// Create an iframe, then check to see if that has successfully initialized.\n\t\tlog.d('getWindow(): ' + origin);\n\n\t\t// TODO: Rewrite without use of Promise.defer()\n\t\tvar deferred = deferredWindows[origin] = Promise.defer();\n\n\t\tvar initialized = false;\n\t\tdeferred.promise.then(function() {\n\t\t\tinitialized = true;\n\t\t});\n\n\t\tvar url = origin + '/xhr-proxy.html';\n\t\tvar iframe = createIFrame(url);\n\n\t\t// Note: Listening to 'error' event does not seem to be necessary\n\t\t// A 'load' event will always fire, any errors will be returned as iframe contents\n\n\t\tevent.addListener(iframe, 'load', function() {\n\t\t\t// The initialization confirmation is sent back as a window message by xhr-proxy.html so the check also\n\t\t\t// has to be deferred through a window message to ensure that it is processed after the initialization.\n\t\t\t// Note: I could not find a good way to defer this compatible with IE browsers, hence the setTimeout\n\t\t\tsetTimeout(function() {\n\t\t\t\tif (!initialized) {\n\t\t\t\t\t// Clean up to allow for future retries\n\t\t\t\t\tdeferredWindows[origin] = null;\n\t\t\t\t\tdom.remove(iframe);\n\t\t\t\t\tdeferred.reject(new Error('Failed to initialize: ' + url));\n\t\t\t\t}\n\t\t\t}, 1000);\n\t\t});\n\n\t\tdom.appendTo(iframe, document.body);\n\n\t\treturn deferred.promise; // will be resolved by window initialized callback eventlistener\n\t}\n\n\tfunction execBatch(origin, originWindow, id) {\n\t\tvar xhr = xhrs[id];\n\t\tif (!xhr) {\n\t\t\treturn; // batch with abort has been processed already\n\t\t}\n\n\t\tvar batch = xhr._batch;\n\t\tif (batch.length === 0) {\n\t\t\treturn; // batch has been processed already\n\t\t}\n\n\t\tif (batch.indexOf(rpcAbort) >= 0) {\n\t\t\tdelete xhrs[id]; // clean up (prevent leak)\n\t\t\tif (batch.length > 1) {\n\t\t\t\tbatch = [ rpcAbort ]; // no use to send anything but abort\n\t\t\t}\n\t\t}\n\n\t\tvar data = { id: id, rpcs: batch };\n\t\toriginWindow.postMessage(supportsObject ? data : JSON.stringify(data), origin);\n\n\t\txhr._batch = []; // batch has been processed\n\t}\n\n\tfunction exec(id, method, args) {\n\t\tvar xhr = xhrs[id];\n\n\t\tif (!xhr) {\n\t\t\tthrow new Error('xhr undefined: ' + id); // note: xhr can no longer be used after abort() or readyState 4\n\t\t}\n\n\t\txhr._batch.push(method === 'abort' ? rpcAbort : { // special abort instance for easy detection with indexOf\n\t\t\tmethod: method,\n\t\t\targs: [].slice.call(args, 0) // turn arguments into array so Safari's JSON.stringify works properly\n\t\t});\n\n\t\txhr._execBatch();\n\t}\n\n\tfunction addEventSupport(id, upload) {\n\t\tvar xhr = xhrs[id];\n\t\tvar obj = upload ? xhr.upload : xhr;\n\t\tobj._eventListenersMap = {};\n\t\tobj.addEventListener = function(type, listener) {\n\t\t\tvar eventListeners = obj._eventListenersMap[type];\n\t\t\tif (!eventListeners) {\n\t\t\t\teventListeners = obj._eventListenersMap[type] = [];\n\t\t\t\texec(id, 'addEventListener', [ upload, type ]);\n\t\t\t}\n\t\t\teventListeners.push(listener);\n\t\t};\n\t}\n\n\treturn {\n\t\t/** @lends playtotv.net.xhrProxy */\n\n\t\t/**\n\t\t * Creates a mock XMLHttpRequest instance.\n\t\t *\n\t\t * @param {string} origin The request origin to proxy to.\n\t\t * @return {Object} Mock XMLHttpRequest instance.\n\t\t */\n\t\tcreate: function(origin) {\n\t\t\tvar id = xhrCounter++;\n\t\t\tvar xhr = xhrs[id] = {\n\t\t\t\t_batch: [], // private field\n\t\t\t\t_readyStateChange: function(readyState) {\n\t\t\t\t\txhr.readyState = readyState;\n\t\t\t\t\tif (xhr.onreadystatechange) {\n\t\t\t\t\t\txhr.onreadystatechange();\n\t\t\t\t\t}\n\t\t\t\t\tif (readyState === 4) {\n\t\t\t\t\t\tdelete xhrs[id]; // clean up (prevent leak)\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t_execBatch: playtotv.unstack(function() { // private function, unstack to optimize batching\n\t\t\t\t\tgetWindow(origin).then(function(originWindow) {\n\t\t\t\t\t\texecBatch(origin, originWindow.win, id);\n\t\t\t\t\t}, function(reason) {\n\t\t\t\t\t\txhr.status = 'no-xhr-proxy';\n\t\t\t\t\t\txhr.reason = reason;\n\t\t\t\t\t\txhr._readyStateChange(4);\n\t\t\t\t\t});\n\t\t\t\t}),\n\t\t\t\tupload: {},\n\t\t\t\tonreadystatechange: null,\n\t\t\t\treadyState: 0,\n\t\t\t\tstatus: 0,\n\t\t\t\tresponseText: ''\n\t\t\t};\n\n\t\t\txhrMethods.forEach(function(method) {\n\t\t\t\txhr[method] = function() {\n\t\t\t\t\texec(id, method, arguments);\n\t\t\t\t};\n\t\t\t});\n\n\t\t\taddEventSupport(id, false); // main xhr events\n\t\t\taddEventSupport(id, true); // upload events\n\n\t\t\treturn xhr;\n\t\t},\n\n\t\t/** For debugging purposes */\n\t\tdebug: {\n\t\t\tdeferredWindows: deferredWindows,\n\t\t\txhrs: xhrs\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.net.request', [\n\t'playtotv.net.xhrProxy'\n], function(\n\txhrProxy\n) {\n\n\t// TODO: Use Promise.Cancellable instead of Promise and have it xhr.abort() on cancellation\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar log = ptv.Logger.get(this.id);\n\tvar util = ptv.util;\n\n\t/**\n\t * Performs an HTTP request, optionally using {@link playtotv.net.xhrProxy} for improved cross-origin support.\n\t *\n\t * @function\n\t * @name request\n\t * @memberOf playtotv\n\t *\n\t * @param {string} url URL to request\n\t * @param {Object} [settings] Request settings\n\t * @param {string} [settings.label=type + ' ' + url] Optional label for debugging\n\t * @param {string} [settings.type='GET'] HTTP request type (GET/POST/PUT/DELETE)\n\t * @param {Object} [settings.urlParams={}] Parameters to add to url\n\t * @param {Object} [settings.headers={}] HTTP request headers\n\t * @param {Object} [settings.username] HTTP Basic Authentication username\n\t * @param {Object} [settings.password] HTTP Basic Authentication password\n\t * @param {Object} [settings.data={}] HTTP request data\n\t * @param {Function} [settings.onProgressDown] Download progress callback\n\t * @param {Function} [settings.onProgressUp] Upload progress callback\n\t * @param {string} [settings.dataType='text'] If 'json' then response text will be processed through JSON.parse()\n\t * @param {boolean} [settings.xhrProxy] Whether to use {@link playtotv.net.xhrProxy}, default true if cross-origin\n\t * @param {boolean} [settings.cache=true] If false, will prevent caching by adding a cache buster query to url\n\t * @param {number} [settings.timeout=0] If set, will timeout request after specified time in ms\n\t * @property {[Function]} taps Array of tap functions to call on each request with url, label and promise arguments\n\t * @returns {Promise} Response data promise, resolves if status code is in: 2xx, 304, 1223, rejects otherwise\n\t */\n\tvar request = function(url, settings) {\n\t\t/*jshint maxstatements:100, maxcomplexity:100*/\n\n\t\tvar windowOrigin = util.getOrigin();\n\t\tvar urlOrigin = util.getOrigin(url);\n\n\t\tsettings = ptv.params(settings, {\n\t\t\tlabel: ((settings && settings.type) || 'GET') + ' ' + url,\n\t\t\ttype: 'GET',\n\t\t\turlParams: {},\n\t\t\theaders: {},\n\t\t\tusername: undefined,\n\t\t\tpassword: undefined,\n\t\t\tdata: {},\n\t\t\tonProgressDown: undefined,\n\t\t\tonProgressUp: undefined,\n\t\t\tdataType: 'text',\n\t\t\txhrProxy: urlOrigin !== windowOrigin,\n\t\t\tcache: true,\n\t\t\ttimeout: 0\n\t\t});\n\n\t\tvar xhr;\n\t\t// TODO: Rewrite without use of Promise.defer()\n\t\tvar deferred = Promise.defer();\n\t\tvar finished = false;\n\t\tvar timeoutRef = null;\n\n\t\tlog.s(settings.label);\n\n\t\tfunction finish(status) {\n\t\t\tif (finished) {\n\t\t\t\treturn; // already finished\n\t\t\t}\n\n\t\t\tif (timeoutRef) {\n\t\t\t\tclearTimeout(timeoutRef);\n\t\t\t}\n\n\t\t\tvar responseData = xhr.responseText;\n\t\t\tif (settings.dataType === 'json') {\n\t\t\t\ttry {\n\t\t\t\t\tresponseData = responseData ? JSON.parse(responseData) : {};\n\t\t\t\t} catch (e) {}\n\t\t\t}\n\n\t\t\t// IE8 and IE9 mangle status 204 to 1223 sometimes, so we have to accept that as well\n\t\t\tif ((status >= 200 && status < 300) || [ 304, 1223 ].indexOf(status) !== -1) {\n\t\t\t\tdeferred.resolve(responseData);\n\t\t\t} else {\n\t\t\t\tvar error = new Error(\n\t\t\t\t\t// Use error message from server response if available\n\t\t\t\t\tresponseData && responseData.error && responseData.error.message ||\n\t\t\t\t\t'Request ' + settings.label + ' failed with status ' + status\n\t\t\t\t);\n\t\t\t\tdeferred.reject(ptv.extend(error, {\n\t\t\t\t\tlabel: settings.label,\n\t\t\t\t\tstatus: status,\n\t\t\t\t\txhr: xhr,\n\t\t\t\t\tdata: responseData\n\t\t\t\t}));\n\t\t\t}\n\n\t\t\tfinished = true;\n\t\t}\n\n\t\t// Use xhrProxy for cross origin requests\n\t\txhr = settings.xhrProxy ? xhrProxy.create(urlOrigin) : new XMLHttpRequest();\n\n\t\tvar loadEventSupported = 'onload' in xhr;\n\t\tvar errorEventSupported = 'onerror' in xhr;\n\t\tvar abortEventSupported = 'onabort' in xhr;\n\t\tvar timeoutEventSupported = 'ontimeout' in xhr;\n\n\t\turl = util.addURLParams(url, settings.urlParams);\n\t\tif (!settings.cache) {\n\t\t\turl = util.addURLParam(url, 'nocache', Date.now());\n\t\t}\n\n\t\txhr.open(settings.type, url, true, settings.username, settings.password);\n\n\t\tif (loadEventSupported) {\n\t\t\txhr.addEventListener('load', function() {\n\t\t\t\t// Note (pp): Chrome fires 'load' event with 404 on my localhost Apache so have to double check status\n\t\t\t\tfinish(xhr.status);\n\t\t\t}, false);\n\t\t} else {\n\t\t\txhr.onreadystatechange = function() {\n\t\t\t\tif (xhr.readyState !== 4) {\n\t\t\t\t\treturn; // not yet DONE\n\t\t\t\t}\n\t\t\t\tfinish(xhr.status);\n\t\t\t};\n\t\t}\n\n\t\tif (errorEventSupported) {\n\t\t\txhr.addEventListener('error', function() {\n\t\t\t\tfinish(xhr.status);\n\t\t\t}, false);\n\t\t}\n\n\t\tif (abortEventSupported) {\n\t\t\txhr.addEventListener('abort', function() {\n\t\t\t\tfinish('abort');\n\t\t\t}, false);\n\t\t}\n\n\t\tif (settings.timeout) {\n\t\t\tif (timeoutEventSupported) {\n\t\t\t\txhr.addEventListener('timeout', function() {\n\t\t\t\t\tfinish('timeout');\n\t\t\t\t}, false);\n\t\t\t\txhr.timeout = settings.timeout;\n\t\t\t} else {\n\t\t\t\ttimeoutRef = setTimeout(function() {\n\t\t\t\t\tfinish('timeout');\n\t\t\t\t\txhr.abort();\n\t\t\t\t}, settings.timeout);\n\t\t\t}\n\t\t}\n\n\t\tvar onProgressDown = settings.onProgressDown;\n\t\tif (onProgressDown) {\n\t\t\txhr.addEventListener('progress', function(e) {\n\t\t\t\tif (e.lengthComputable) {\n\t\t\t\t\tonProgressDown(e);\n\t\t\t\t}\n\t\t\t}, false);\n\t\t}\n\n\t\tvar onProgressUp = settings.onProgressUp;\n\t\tif (onProgressUp) {\n\t\t\txhr.upload.addEventListener('progress', function(e) {\n\t\t\t\tif (e.lengthComputable) {\n\t\t\t\t\tonProgressUp(e);\n\t\t\t\t}\n\t\t\t}, false);\n\t\t}\n\n\t\tptv.each(settings.headers, function(value, key) {\n\t\t\txhr.setRequestHeader(key, value);\n\t\t});\n\n\t\tif (settings.type === 'PUT' || settings.type === 'POST') {\n\t\t\txhr.setRequestHeader('Content-type', 'application/json');\n\t\t\txhr.send(JSON.stringify(settings.data));\n\t\t} else {\n\t\t\txhr.send();\n\t\t}\n\n\t\trequest.taps.forEach(function(tap) {\n\t\t\ttap(url, settings.label, deferred.promise);\n\t\t});\n\n\t\treturn deferred.promise;\n\t};\n\n\trequest.taps = [];\n\n\treturn request;\n});\n",
		"playtotv.define('playtotv.analytics.AnalyticsController', [\n\t'playtotv.analytics.AnalyticsWidget',\n\t'playtotv.analytics.ComScoreAnalytics',\n\t'playtotv.analytics.GoogleAnalytics',\n\t'playtotv.mvc.Controller',\n\t'playtotv.net.request'\n], function(\n\tAnalyticsWidget,\n\tComScoreAnalytics,\n\tGoogleAnalytics,\n\tController,\n\trequest\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar util = ptv.util;\n\tvar event = ptv.event;\n\tvar log = new ptv.Logger(this.id);\n\n\treturn class AnalyticsController extends Controller {\n\t\t/** @lends playtotv.analytics.AnalyticsController.prototype */\n\n\t\t/**\n\t\t * TODO: JSDOC\n\t\t *\n\t\t * @extends playtotv.mvc.Controller\n\t\t * @constructs\n\t\t */\n\t\tconstructor(context, options) {\n\t\t\toptions = ptv.params(options, {\n\t\t\t\t// privateGoogle is required but a default config is provided to facilitate it's use\n\t\t\t\tprivateGoogle: { name: 'private', id: 'UA-20746434-1', fields: { sampleRate: 1 } },\n\t\t\t\tgoogles: [],\n\t\t\t\tcomScore: null\n\t\t\t});\n\n\t\t\tsuper(context);\n\n\t\t\tthis.addMethods([\n\t\t\t\t'privateTime',\n\t\t\t\t'privateError',\n\t\t\t\t'privateEvent',\n\t\t\t\t'view',\n\t\t\t\t'event',\n\t\t\t\t'setFields'\n\t\t\t]);\n\n\t\t\tthis.addWidget('track', AnalyticsWidget);\n\n\t\t\tvar privateGoogle = this.privateGoogle = new GoogleAnalytics(options.privateGoogle);\n\n\t\t\tvar googles = this.googles = [ privateGoogle ];\n\n\t\t\toptions.googles.forEach(googleOptions => {\n\t\t\t\t// Googles can be easily disabled by providing a falsy id option\n\t\t\t\tif (googleOptions.id) {\n\t\t\t\t\tgoogles.push(new GoogleAnalytics(googleOptions));\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// ComScore can be easily disabled by providing a falsy url option\n\t\t\tvar comScoreOptions = options.comScore;\n\t\t\tif (comScoreOptions && comScoreOptions.url) {\n\t\t\t\tthis.comScore = new ComScoreAnalytics(comScoreOptions);\n\t\t\t}\n\n\t\t\tevent.addWindowOnError(this.privateError.bind(this));\n\n\t\t\tthis.hookRequestTap();\n\t\t}\n\n\t\t/**\n\t\t * Called by constructor to hook playtotv.net.request.tap to log request timings and rejections to\n\t\t * our private Google tracker.\n\t\t */\n\t\thookRequestTap() {\n\t\t\trequest.taps.push((url, label, promise) => {\n\t\t\t\tvar cleanUrl = url.replace(/.nocache=\\d+/, '');\n\n\t\t\t\t// Time all but long poll requests, recognizable by timeout URL param\n\t\t\t\tif (!util.getURLParams(url).timeout) {\n\t\t\t\t\tthis.privateTime(promise, 'request', label, {\n\t\t\t\t\t\ttimingLabel: cleanUrl\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t// Rejections are not always errors, so log them as events\n\t\t\t\tpromise.catch(reason => {\n\t\t\t\t\tthis.privateEvent('request', 'reject ' + label + ' ' + reason.status, {\n\t\t\t\t\t\teventLabel: cleanUrl,\n\t\t\t\t\t\tnonInteraction: true\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Calls and returns this.privateGoogle.time(promise, category, variable, fields).\n\t\t */\n\t\tprivateTime(promise, category, variable, fields) {\n\t\t\treturn this.privateGoogle.time(promise, category, variable, fields);\n\t\t}\n\n\t\t/**\n\t\t * Calls and returns this.privateGoogle.sendError(error, isFatal, fields).\n\t\t */\n\t\tprivateError(error, isFatal, fields) {\n\t\t\treturn this.privateGoogle.sendError(error, isFatal, fields);\n\t\t}\n\n\t\t/**\n\t\t * Calls and returns this.privateGoogle.sendEvent(category, action, fields).\n\t\t */\n\t\tprivateEvent(category, action, fields) {\n\t\t\treturn this.privateGoogle.sendEvent(category, action, fields);\n\t\t}\n\n\t\t/**\n\t\t * Calls this.googles sendView(name) and this.udm(name).\n\t\t */\n\t\tview(name, fields) {\n\t\t\tlog.d('view: ' + name, fields);\n\n\t\t\tthis.lastView = name;\n\n\t\t\tthis.googles.forEach(google => google.sendView(name, fields));\n\n\t\t\tthis.udm(name);\n\t\t}\n\n\t\t/**\n\t\t * Calls this.googles sendEvent(category, action, fields) and\n\t\t * this.udm('[category].[action].[label]', { type: 'hidden' }).\n\t\t */\n\t\tevent(category, action, fields) {\n\t\t\tlog.d('event: ' + category + ', ' + action, fields);\n\n\t\t\tthis.googles.forEach(google => google.sendEvent(category, action, fields));\n\n\t\t\tvar label = fields && fields.eventLabel;\n\t\t\tthis.udm(category + '.' + action + (label ? '.' + label : ''), { type: 'hidden' });\n\t\t}\n\n\t\t/**\n\t\t * Calls this.googles setFields(fields).\n\t\t */\n\t\tsetFields(fields) {\n\t\t\tthis.googles.forEach(google => google.setFields(fields));\n\t\t}\n\n\t\t/**\n\t\t * Calls this.comScore.udm(tag, params), if available.\n\t\t * Note: Override this to add project specific and runtime params.\n\t\t */\n\t\tudm(tag, params) {\n\t\t\tvar comScore = this.comScore;\n\t\t\tif (comScore) {\n\t\t\t\tcomScore.udm(tag, params);\n\t\t\t}\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.native.MockNativeController', [\n\t'playtotv.facebook.Facebook',\n\t'playtotv.native.NativeController',\n\t'playtotv.net.request'\n], function(\n\tFacebook,\n\tNativeController,\n\trequest\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar dom = ptv.dom;\n\tvar util = ptv.util;\n\tvar log = ptv.Logger.get(this.id);\n\n\tfunction getMatch(str, regex, idx) {\n\t\tvar matches = str.match(regex);\n\t\treturn matches && matches[idx || 0];\n\t}\n\n\treturn class MockNativeController extends NativeController {\n\t\tconstructor(context, options) {\n\t\t\tptv.params(options, {\n\t\t\t\tserverUrl: ptv.REQUIRED,\n\t\t\t\tfacebook: null\n\t\t\t});\n\t\t\tvar serverUrl = options.serverUrl;\n\n\t\t\tsuper(context);\n\n\t\t\tthis.audioNodeMap = {};\n\n\t\t\tif (options.facebook) {\n\t\t\t\tthis.facebook = new Facebook(options.facebook);\n\t\t\t}\n\n\t\t\tvar wrapper = window.nativeWrapper;\n\t\t\tptv.extend(wrapper, this.getDevice(), {\n\t\t\t\tname: document.title,\n\t\t\t\tversion: '1.0-mock',\n\t\t\t\tcapabilities: [],\n\t\t\t\tpushEnabled: false,\n\t\t\t\tserverUrl: serverUrl,\n\t\t\t\tsendMessage: this.sendMessage.bind(this)\n\t\t\t});\n\n\t\t\tthis.publish('Event.BridgeReady');\n\n\t\t\tvar requestUrl = (/\\/\\//.test(serverUrl) ? '' : '//') + serverUrl;\n\t\t\tvar gatekeeperDataPromise = serverUrl === 'mock' ?\n\t\t\t\tPromise.resolve({ serverTime: Date.now(), status: 'AVAILABLE', services: [] }) :\n\t\t\t\trequest(requestUrl + '/api/1/gatekeeper/init', { dataType: 'json', cache: false });\n\n\t\t\tgatekeeperDataPromise.then(data => {\n\t\t\t\tdata = { gatekeeperResponse: data, gatekeeperTimestamp: Date.now() };\n\t\t\t\tptv.extend(wrapper, data);\n\t\t\t\tthis.mockMessage({ type: 'Event', subject: 'GatekeeperReady', payload: data });\n\t\t\t});\n\n\t\t\tthis.initLoading();\n\t\t}\n\n\t\tinitLoading() {\n\t\t\tvar loadingNode = dom.create('div', {\n\t\t\t\tclassName: 'native-loading'\n\t\t\t}, {\n\t\t\t\ttext: 'Loading..',\n\t\t\t\tappendTo: document.body\n\t\t\t});\n\n\t\t\tptv.extend(loadingNode.style, {\n\t\t\t\tposition: 'absolute',\n\t\t\t\ttop: 0, left: 0, bottom: 0, right: 0,\n\t\t\t\tbackground: 'rgba(255, 255, 255, 0.9)', color: '#000',\n\t\t\t\t'text-align': 'center', 'padding-top': '150px',\n\t\t\t\t'z-index': 99999\n\t\t\t});\n\n\t\t\tthis.loadingNode = loadingNode;\n\t\t}\n\n\t\tgetDevice() {\n\t\t\tvar ua = navigator.userAgent;\n\t\t\treturn ptv.extend({\n\t\t\t\tdeviceName: 'Mock Device',\n\t\t\t\tdeviceModel: ua\n\t\t\t}, /android/i.test(ua) ? {\n\t\t\t\tos: 'Android',\n\t\t\t\tosVersion: getMatch(ua, /android ([\\d\\.]+)/i, 1) || '4.4'\n\t\t\t} : /ip(ad|hone)/i.test(ua) ? {\n\t\t\t\tos: 'iOS',\n\t\t\t\tosVersion: getMatch(ua, /OS (\\d)_\\d/, 1) || '8'\n\t\t\t} : {\n\t\t\t\tos: 'Browser',\n\t\t\t\tosVersion: '1.0'\n\t\t\t});\n\t\t}\n\n\t\tmockMessage(message) {\n\t\t\tPromise.resolve().then(() => window.nativeWrapper.onMessage(message));\n\t\t}\n\n\t\tsendMessage(message) {\n\t\t\tif (message.type === 'Command') {\n\t\t\t\tvar subject = message.subject;\n\t\t\t\tvar handler = this['onCommand' + subject];\n\t\t\t\tvar result = {\n\t\t\t\t\ttype: 'CommandResult',\n\t\t\t\t\tsubject: subject,\n\t\t\t\t\tcommandId: message.commandId\n\t\t\t\t};\n\n\t\t\t\tif (handler) {\n\t\t\t\t\tPromise.resolve(handler.call(this, message.payload)).then(payload => {\n\t\t\t\t\t\tthis.mockMessage(ptv.extend(result, { payload: payload }));\n\t\t\t\t\t}, error => {\n\t\t\t\t\t\tthis.mockMessage(ptv.extend(result, { error: error }));\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\t// Let's just be lenient and log instead of rejecting\n\t\t\t\t\t// this.mockMessage(ptv.extend(result, { error: 'UnsupportedCommand' }));\n\t\t\t\t\tlog.d(subject, message.payload);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tpopup(url, target, options) {\n\t\t\tvar { width, height } = ptv.params(options, { width: 0, height: 0 });\n\t\t\treturn util.popup(url, target, { width: width, height: height });\n\t\t}\n\n\t\tonCommandHideLoading() {\n\t\t\tdom.remove(this.loadingNode);\n\t\t}\n\n\t\tonCommandOpenDialog(payload) {\n\t\t\t// Not a great mock; this blocks JS and does not really support payload.buttons (assumes first is OK)\n\t\t\tvar buttons = payload.buttons;\n\t\t\tvar text = payload.title + '\n' + payload.message + '\n' + '[' + buttons.join('], [') + ']';\n\t\t\tvar ok = buttons.length > 1 ? window.confirm(text) : window.alert(text) || true;\n\t\t\treturn { pressed: buttons[ok ? 0 : 1] };\n\t\t}\n\n\t\tonCommandSetPushEnabled(payload) {\n\t\t\treturn payload.value && Math.random() > 0.8 ? Promise.reject({}) : {};\n\t\t}\n\n\t\t/* TWITTER */\n\n\t\tonCommandIsTwitterAccountAvailable() {\n\t\t\t// This can only be available on iOS, so let's simply mock that it is always available there\n\t\t\treturn this.wrapperPromise.then(wrapper => {\n\t\t\t\treturn { available: wrapper.os === 'iOS' };\n\t\t\t});\n\t\t}\n\n\t\t/* FACEBOOK */\n\n\t\tonCommandFacebookLogin(options) {\n\t\t\tif (this.facebook) {\n\t\t\t\t// TODO: Add permissions support\n\t\t\t\treturn this.facebook.login(options.interactive).then(() => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\ttoken: this.facebook.accessToken\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Rudimentary mock for when we have no Facebook (JS SDK based) instance\n\t\t\treturn {\n\t\t\t\ttoken: 'mock-facebook-token'\n\t\t\t};\n\t\t}\n\n\t\tonCommandFacebookLogout() {\n\t\t\tif (this.facebook) {\n\t\t\t\treturn this.facebook.logout();\n\t\t\t}\n\t\t}\n\n\t\tonCommandFacebookGraphRequest(options) {\n\t\t\t/*jshint camelcase:false*/\n\t\t\t/*jscs:disable requireCamelCaseOrUpperCaseIdentifiers*/\n\n\t\t\tif (this.facebook) {\n\t\t\t\treturn this.facebook.api(5000, options.path, options.httpMethod, options.parameters);\n\t\t\t}\n\n\t\t\t// Rudimentary mock for when we have no Facebook (JS SDK based) instance\n\t\t\tvar { path } = options;\n\t\t\tvar friends = {\n\t\t\t\tdata: [\n\t\t\t\t\t{ name: 'Peter Ex Machina', id: '100002151356216' }\n\t\t\t\t],\n\t\t\t\tpaging: { next: '' },\n\t\t\t\tsummary: { total_count: 1 }\n\t\t\t};\n\t\t\treturn {\n\t\t\t\tme: {\n\t\t\t\t\tid: 'mock-facebook-id',\n\t\t\t\t\tpermissions: { data: [\n\t\t\t\t\t\t{ permission: 'public_profile', status: 'granted' },\n\t\t\t\t\t\t{ permission: 'user_friends', status: 'granted' }\n\t\t\t\t\t] },\n\t\t\t\t\tfirst_name: 'Peter Paul',\n\t\t\t\t\tlast_name: 'Ex Machina',\n\t\t\t\t\tname: 'Peter Paul Ex Machina',\n\t\t\t\t\tpicture: { data: { url: '//graph.facebook.com/100001721575332/picture' } },\n\t\t\t\t\tfriends: friends\n\t\t\t\t},\n\t\t\t\t'me/friends': friends\n\t\t\t}[path] || Promise.reject(new Error('No mock response for FacebookGraphRequest path: ' + path));\n\t\t}\n\n\t\tonCommandFacebookShare(options) {\n\t\t\t/*jshint camelcase:false*/\n\t\t\t/*jscs:disable requireCamelCaseOrUpperCaseIdentifiers*/\n\n\t\t\tvar params = {\n\t\t\t\tlink: options.contentURL,\n\t\t\t\tname: options.contentTitle,\n\t\t\t\tdescription: options.contentDescription,\n\t\t\t\tpicture: options.imageURL\n\t\t\t};\n\n\t\t\t// Prune empty params\n\t\t\tObject.keys(params).forEach(key => {\n\t\t\t\tif (!params[key]) {\n\t\t\t\t\tdelete params[key];\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (this.facebook) {\n\t\t\t\treturn this.facebook.postByDialog(params);\n\t\t\t}\n\n\t\t\twindow.location = util.addURLParams('https://www.facebook.com/dialog/feed', ptv.extend({\n\t\t\t\tapp_id: '160288680666821', // PlayToTV (works from *.playtotv.com)\n\t\t\t\tredirect_uri: window.location.href\n\t\t\t}, params));\n\t\t}\n\n\t\t/* AUDIO */\n\n\t\tonCommandLoadAudio(payload) {\n\t\t\tvar url = payload.url;\n\t\t\tvar node = document.createElement('audio');\n\t\t\tnode.src = url;\n\t\t\tnode.load();\n\t\t\tthis.audioNodeMap[url] = node;\n\t\t}\n\n\t\tonCommandPlayAudio(payload) {\n\t\t\tvar url = payload.url;\n\t\t\tvar node = this.audioNodeMap[url];\n\t\t\tnode.play();\n\t\t}\n\n\t\tonCommandStopAudio(payload) {\n\t\t\tvar url = payload.url;\n\t\t\tvar node = this.audioNodeMap[url];\n\t\t\tnode.stop();\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.push.PushController', [\n\t'playtotv.mvc.Controller'\n], function(\n\tController\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar log = ptv.Logger.get(this.id);\n\n\t// Not published as a normal resource api definition, so hard coded here\n\tvar pushPollAPI = {\n\t\tgetEvents: {\n\t\t\tlabel: 'pushPoll.getEvents',\n\t\t\ttype: 'GET',\n\t\t\turl: '1/events',\n\t\t\tqueryKeys: [\n\t\t\t\t'stream',\n\t\t\t\t'timeout'\n\t\t\t]\n\t\t}\n\t};\n\n\treturn class PushController extends Controller {\n\t\tconstructor(context, options) {\n\t\t\toptions = ptv.params(options, {\n\t\t\t\tpollTimeout: 10000\n\t\t\t});\n\n\t\t\tsuper(context);\n\n\t\t\tthis.pollTimeout = options.pollTimeout;\n\n\t\t\tthis.scope.observe('user.online', this.start.bind(this));\n\t\t}\n\n\t\t// Note: Currently no support for going offline and online again, but that does not seem necessary\n\t\tstart(online) {\n\t\t\tif (this.hasStarted || !online) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.poll();\n\t\t\tthis.hasStarted = true;\n\t\t}\n\n\t\t/**\n\t\t * Performs a single getEvents call and then recurses.\n\t\t * Received events are published to their corresponding channels: '[event.subject]-[event.action]'.\n\t\t * To stop polling dispose this controller.\n\t\t */\n\t\tpoll() {\n\t\t\tif (this.disposed) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.getEvents().then(events => {\n\t\t\t\tevents.forEach(event => this.publish(event.subject + '-' + event.action, event));\n\t\t\t}).catch(error => {\n\t\t\t\t// Brute force sturdiness; catch rejection and continue polling after a delay\n\t\t\t\tlog.i('poll: getEvents rejected, delaying next poll', error);\n\t\t\t\treturn Promise.delay(5000);\n\t\t\t}).then(() => this.poll());\n\t\t}\n\n\t\t/**\n\t\t * Gets events from server and updates stream id in model for following requests.\n\t\t *\n\t\t * @returns {Promise} Promise of an array of event data objects\n\t\t */\n\t\tgetEvents() {\n\t\t\tvar model = this.model;\n\t\t\tvar stream = model.stream;\n\t\t\tvar pollTimeout = this.pollTimeout;\n\n\t\t\treturn this.scope.call('server.call', pushPollAPI.getEvents, {\n\t\t\t\tstream: stream,\n\t\t\t\ttimeout: pollTimeout\n\t\t\t}, {\n\t\t\t\t// Extend server call timeout with long poll timeout\n\t\t\t\ttimeout: 20000 + pollTimeout\n\t\t\t}).then(data => {\n\t\t\t\tthis.set('stream', data.stream);\n\t\t\t\treturn data.events;\n\t\t\t});\n\t\t}\n\n\t\tserialize() {\n\t\t\treturn false;\n\t\t}\n\t};\n});\n",
		"/**\n * Auto generated API: <tt>src/question/question-api.js</tt>\n *\n * <b>DO NOT MODIFY! CHANGES WILL BE OVERWRITTEN THE NEXT TIME YOU UPDATE!</b>\n *\n * <b>Note:</b> These are not real functions but method definitions for\n * {@link playtotv.server.Server#call}.\n *\n * @name questionAPI\n * @memberOf playtotv.question\n * @namespace\n */\nplaytotv.define('playtotv.question.questionAPI', [], function() {\n\n\t'use strict';\n\n\treturn {\n\t\t/*jshint maxlen:300*/ // On occassion generated lines can be too long\n\n\t\t/** @lends playtotv.question.questionAPI */\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>questionId</b></li>\n\t\t * <li><i>{number}</i> <b>answerTime</b></li>\n\t\t * <li><i>{[string]}</i> <b>submittedAnswers</b></li>\n\t\t * <li><i>{number}</i> <b>maxPossibleScore</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.episodeSessionId\n\t\t * @returns {Promise} Promise of response data (QuestionParticipantAnswerDTO)\n\t\t */\n\t\tgetParticipantAnswers: {\n\t\t\tlabel: 'question.getParticipantAnswers',\n\t\t\turl: '1/question/episodesession/{episodeSessionId}/stats'\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>questionId</b></li>\n\t\t * <li><i>{string}</i> <b>type</b></li>\n\t\t * <li><i>{[ClientAnswerDTO]}</i> <b>answers</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>code</b></li>\n\t\t * <li><i>{string}</i> <b>answer</b></li>\n\t\t * <li><i>{string}</i> <b>mediaUrl</b></li>\n\t\t * </ul></li>\n\t\t * <li><i>{string}</i> <b>subject</b></li>\n\t\t * <li><i>{string}</i> <b>text</b></li>\n\t\t * <li><i>{string}</i> <b>mediaUrl</b></li>\n\t\t * <li><i>{number}</i> <b>correctScore</b></li>\n\t\t * <li><i>{number}</i> <b>participationScore</b></li>\n\t\t * <li><i>{number}</i> <b>answerCount</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.questionId\n\t\t * @param {string} params.episodeSessionId\n\t\t * @returns {Promise} Promise of response data (ClientQuestionDTO)\n\t\t */\n\t\tgetQuestion: {\n\t\t\tlabel: 'question.getQuestion',\n\t\t\turl: '1/question/questions/{questionId}/episodesession/{episodeSessionId}'\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>questionId</b></li>\n\t\t * <li><i>{string}</i> <b>categoryKey</b></li>\n\t\t * <li><i>{string}</i> <b>categoryValue</b></li>\n\t\t * <li><i>{Long}</i> <b>totalAnswers</b></li>\n\t\t * <li><i>{[Double]}</i> <b>answersNormalizedOverTime</b></li>\n\t\t * <li><i>{Long}</i> <b>correctAnswers</b></li>\n\t\t * <li><i>{Long}</i> <b>averageCorrectAnswers</b></li>\n\t\t * <li><i>{[QuestionAnswerEpisodeStatsDTO]}</i> <b>answers</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>code</b></li>\n\t\t * <li><i>{Long}</i> <b>count</b></li>\n\t\t * <li><i>{number}</i> <b>percentage</b></li>\n\t\t * <li><i>{[Double]}</i> <b>normalizedOverTime</b></li>\n\t\t * <li><i>{Boolean}</i> <b>correct</b></li>\n\t\t * </ul></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.questionId\n\t\t * @param {string} params.episodeSessionId\n\t\t * @returns {Promise} Promise of response data (QuestionEpisodeStatsDTO)\n\t\t */\n\t\tgetQuestionStats: {\n\t\t\tlabel: 'question.getQuestionStats',\n\t\t\turl: '1/question/questions/{questionId}/episodesession/{episodeSessionId}/stats'\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>questionId</b></li>\n\t\t * <li><i>{number}</i> <b>answerTime</b></li>\n\t\t * <li><i>{[string]}</i> <b>submittedAnswers</b></li>\n\t\t * <li><i>{number}</i> <b>maxPossibleScore</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.questionId\n\t\t * @param {string} params.episodeSessionId\n\t\t * @param {[string]} params.answerCodes\n\t\t * @param {number} params.clientAnswerTime\n\t\t * @returns {Promise} Promise of response data (QuestionParticipantAnswerDTO)\n\t\t */\n\t\tsubmitAnswer: {\n\t\t\tlabel: 'question.submitAnswer',\n\t\t\turl: '1/question/questions/{questionId}/episodesession/{episodeSessionId}/answer',\n\t\t\ttype: 'PUT',\n\t\t\tdataKeys: [\n\t\t\t\t'answerCodes',\n\t\t\t\t'clientAnswerTime'\n\t\t\t]\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.question.QuestionController', [\n\t'playtotv.mvc.Controller',\n\t'playtotv.question.questionAPI'\n], function(\n\tController,\n\tquestionAPI\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\n\treturn class QuestionController extends Controller {\n\t\tconstructor(context) {\n\t\t\tsuper(context);\n\n\t\t\tthis.addMethods([\n\t\t\t\t'submitAnswer',\n\t\t\t\t'decorateAnswers'\n\t\t\t]);\n\t\t}\n\n\t\tsubmitAnswer(id, code, options) {\n\t\t\toptions = ptv.params(options, {\n\t\t\t\tdelay: 0\n\t\t\t});\n\n\t\t\tvar idCode = id + '-' + code;\n\t\t\tthis.submitting = idCode;\n\t\t\tthis.publish('submitting', this.submitting);\n\n\t\t\treturn Promise.delay(options.delay).then(() => {\n\t\t\t\treturn this.scope.call('episode.submitInteraction', questionAPI.submitAnswer, id, {\n\t\t\t\t\tquestionId: id,\n\t\t\t\t\tanswerCodes: [ code ],\n\t\t\t\t\tclientAnswerTime: true\n\t\t\t\t}).finally(() => {\n\t\t\t\t\tif (this.submitting === idCode) {\n\t\t\t\t\t\tdelete this.submitting;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tdecorateAnswers(question) {\n\t\t\tvar stats = question.stats;\n\t\t\tvar data = question.data;\n\t\t\tvar statsAnswers = (stats && stats.answers) || [];\n\t\t\tvar submittedAnswerCodes = (data && data.submittedAnswers) || [];\n\n\t\t\treturn question.content.answers.map(answer => {\n\t\t\t\tvar answerCode = answer.code;\n\t\t\t\tvar answerStats = statsAnswers.find(answerStats => answerStats.code === answerCode);\n\t\t\t\treturn ptv.extend({\n\t\t\t\t\tquestion: question,\n\t\t\t\t\tsubmitting: this.submitting === question.id + '-' + answerCode,\n\t\t\t\t\tsubmitted: submittedAnswerCodes.indexOf(answerCode) >= 0\n\t\t\t\t}, answer, answerStats);\n\t\t\t});\n\t\t}\n\t};\n});\n",
		"/**\n * Auto generated API: <tt>src/rating/rating-api.js</tt>\n *\n * <b>DO NOT MODIFY! CHANGES WILL BE OVERWRITTEN THE NEXT TIME YOU UPDATE!</b>\n *\n * <b>Note:</b> These are not real functions but method definitions for\n * {@link playtotv.server.Server#call}.\n *\n * @name ratingAPI\n * @memberOf playtotv.rating\n * @namespace\n */\nplaytotv.define('playtotv.rating.ratingAPI', [], function() {\n\n\t'use strict';\n\n\treturn {\n\t\t/*jshint maxlen:300*/ // On occassion generated lines can be too long\n\n\t\t/** @lends playtotv.rating.ratingAPI */\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>ratingId</b></li>\n\t\t * <li><i>{string}</i> <b>subject</b></li>\n\t\t * <li><i>{string}</i> <b>text</b></li>\n\t\t * <li><i>{string}</i> <b>mediaUrl</b></li>\n\t\t * <li><i>{number}</i> <b>participationScore</b></li>\n\t\t * <li><i>{[ClientRatingSubjectDTO]}</i> <b>subjects</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>name</b></li>\n\t\t * <li><i>{string}</i> <b>code</b></li>\n\t\t * <li><i>{string}</i> <b>mediaUrl</b></li>\n\t\t * </ul></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.ratingId\n\t\t * @param {string} params.episodeSessionId\n\t\t * @returns {Promise} Promise of response data (ClientRatingDTO)\n\t\t */\n\t\tgetRating: {\n\t\t\tlabel: 'rating.getRating',\n\t\t\turl: '1/rating/ratings/{ratingId}/episodesession/{episodeSessionId}'\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>ratingId</b></li>\n\t\t * <li><i>{boolean}</i> <b>finalized</b></li>\n\t\t * <li><i>{[SingleRatingValueDTO]}</i> <b>values</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>code</b></li>\n\t\t * <li><i>{number}</i> <b>value</b></li>\n\t\t * </ul></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.ratingId\n\t\t * @param {string} params.episodeSessionId\n\t\t * @returns {Promise} Promise of response data (RatingStatsDTO)\n\t\t */\n\t\tgetRatingStats: {\n\t\t\tlabel: 'rating.getRatingStats',\n\t\t\turl: '1/rating/ratings/{ratingId}/episodesession/{episodeSessionId}/stats'\n\t\t},\n\n\t\t/**\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.ratingId\n\t\t * @param {string} params.episodeSessionId\n\t\t * @param {Long} params.values\n\t\t * @returns {Promise} Promise of response data (Object)\n\t\t */\n\t\tsubmitRating: {\n\t\t\tlabel: 'rating.submitRating',\n\t\t\turl: '1/rating/ratings/{ratingId}/episodesession/{episodeSessionId}/answer',\n\t\t\ttype: 'PUT',\n\t\t\tdataKeys: [\n\t\t\t\t'values'\n\t\t\t]\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.rating.RatingInputWidget', [\n\t'playtotv.widget.Widget'\n], function(\n\tWidget\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar REQUIRED = ptv.REQUIRED;\n\n\treturn class RatingInputWidget extends Widget {\n\n\t\tconstructor(node, options) {\n\t\t\tptv.params(options, {\n\t\t\t\tapp: null,\n\t\t\t\tcontroller: REQUIRED,\n\t\t\t\tid: REQUIRED,\n\t\t\t\tcode: REQUIRED\n\t\t\t});\n\n\t\t\tsuper(node);\n\n\t\t\tptv.extend(this, options);\n\n\t\t\tthis.addEventListener(node, 'change', this.onChange.bind(this));\n\t\t}\n\n\t\tonChange() {\n\t\t\tthis.controller.submit(this.id, this.code, this.node.value);\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.rating.RatingController', [\n\t'playtotv.mvc.Controller',\n\t'playtotv.rating.ratingAPI',\n\t'playtotv.rating.RatingInputWidget'\n], function(\n\tController,\n\tratingAPI,\n\tRatingInputWidget\n) {\n\n\t'use strict';\n\n\tvar FACTOR = 10;\n\n\tvar ptv = playtotv;\n\n\treturn class RatingController extends Controller {\n\t\tconstructor(context) {\n\t\t\tsuper(context);\n\n\t\t\tthis.addMethods([\n\t\t\t\t'submit',\n\t\t\t\t'decorateSubjects'\n\t\t\t]);\n\n\t\t\tthis.addWidgets([\n\t\t\t\t[ 'input', RatingInputWidget ]\n\t\t\t]);\n\t\t}\n\n\t\tsubmit(id, code, value) {\n\t\t\tvar valueMap = {};\n\t\t\tvalueMap[code] = Math.round(value * FACTOR);\n\n\t\t\treturn this.scope.call('episode.submitInteraction', ratingAPI.submitRating, id, {\n\t\t\t\tratingId: id,\n\t\t\t\tvalues: valueMap\n\t\t\t}, submittedValueMap => {\n\t\t\t\tsubmittedValueMap = submittedValueMap || {};\n\t\t\t\tsubmittedValueMap[code] = value;\n\t\t\t\treturn submittedValueMap;\n\t\t\t});\n\t\t}\n\n\t\tdecorateSubjects(rating) {\n\t\t\tvar stats = rating.stats;\n\t\t\tvar subjectAverages = (stats && stats.values) || [];\n\t\t\tvar submittedValueMap = rating.data || {};\n\n\t\t\treturn rating.content.subjects.map(subject => {\n\t\t\t\tvar subjectCode = subject.code;\n\t\t\t\tvar subjectAverage = subjectAverages.find(subjectAverage => subjectAverage.code === subjectCode);\n\t\t\t\treturn ptv.extend({\n\t\t\t\t\trating: rating,\n\t\t\t\t\tsubmitted: submittedValueMap[subjectCode],\n\t\t\t\t\taverage: subjectAverage && subjectAverage.value / FACTOR\n\t\t\t\t}, subject);\n\t\t\t});\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.relation.RelationSubscription', [\n\t'playtotv.pubsub.Subscription'\n], function(\n\tSubscription\n) {\n\n\t'use strict';\n\n\tvar util = playtotv.util;\n\n\treturn new playtotv.Class({\n\t\t/** @lends playtotv.relation.RelationSubscription.prototype */\n\n\t\textend: Subscription,\n\n\t\t/**\n\t\t * Class used to represent a {@link playtotv.relation.RelationManager} Subscription.\n\t\t *\n\t\t * If selector is a string it is converted to a RegExp that enables matching multiple space separated rels.\n\t\t * And this.regexIndex is set so that publishes are delivered to only the matching part of the channel string.\n\t\t *\n\t\t * @extends playtotv.pubsub.Subscription\n\t\t * @constructs\n\t\t * @param {string|RegExp} selector Relation selector string or RegExp\n\t\t * @param {Function} handler Subscription callback\n\t\t * @throws {TypeError} If selector or handler is invalid\n\t\t *\n\t\t * @property {RegExp} selector Relation selector RegExp\n\t\t * @property {Function} handler Subscription callback\n\t\t * @property {number} regexIndex Index of selector RegExp match result to deliver to\n\t\t */\n\t\tinitialize: function(selector, handler) {\n\t\t\tif (typeof selector === 'string') {\n\t\t\t\tselector = new RegExp('(\\\\s|^)(' + util.escapeRegEx(selector).replace(/\\\\\\*/g, '\\\\S*?') + ')(\\\\s|$)');\n\t\t\t\tthis.regexIndex = 2;\n\t\t\t}\n\n\t\t\tthis._super(selector, handler);\n\t\t},\n\n\t\t/**\n\t\t * Deliver data to handler on specified channel.\n\t\t *\n\t\t * If regexIndex is defined then channel is replaced by specified index of the selector matches.\n\t\t *\n\t\t * @param {mixed} [data] Data to deliver\n\t\t * @param {string} channel Channel we are delivering to\n\t\t */\n\t\tdeliver: function(data, channel) {\n\t\t\tif (this.handler) {\n\t\t\t\tvar regexIndex = this.regexIndex;\n\t\t\t\tif (regexIndex !== undefined) {\n\t\t\t\t\tchannel = this.selector.exec(channel)[regexIndex];\n\t\t\t\t}\n\n\t\t\t\tthis.handler(data, channel);\n\t\t\t}\n\t\t}\n\t});\n});\n",
		"playtotv.define('playtotv.relation.RelationManager', [\n\t'playtotv.pubsub.PubSub',\n\t'playtotv.relation.RelationSubscription'\n], function(\n\tPubSub,\n\tRelationSubscription\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar dom = ptv.dom;\n\tvar event = ptv.event;\n\n\treturn new ptv.Class({\n\t\t/** @lends playtotv.relation.RelationManager.prototype */\n\n\t\textend: PubSub,\n\n\t\t/**\n\t\t * Enables subscribing to clicks on nodes with \"rel\" attribute values matching strings or regular expressions.\n\t\t *\n\t\t * @extends playtotv.pubsub.PubSub\n\t\t * @constructs\n\t\t * @param {Node} [node=document] Root node on which to listen to click events\n\t\t */\n\t\tinitialize: function(node) {\n\t\t\tnode = node || document;\n\t\t\tthis._super();\n\t\t\tthis.node = node;\n\t\t\tevent.addListener(node, 'click', this.onClick);\n\t\t},\n\n\t\t/**\n\t\t * Subscribe handler to specified selector.\n\t\t *\n\t\t * This overrides {@link playtotv.pubsub.PubSub#subscribe} to return a\n\t\t * {@link playtotv.relation.RelationSubscription} to facilitate matching multiple rels.\n\t\t *\n\t\t * P.e: If you subscribe to \"foo\" then a click on a link with rel=\"foo bar\" will result in handler being called\n\t\t * with rel channel \"foo\".\n\t\t *\n\t\t * @param {string|RegExp} selector Channel selector\n\t\t * @param {Function} handler Subscription callback\n\t\t * @throws {TypeError} If selector or handler is invalid\n\t\t * @returns {playtotv.relation.RelationSubscription} Added subscription\n\t\t */\n\t\tsubscribe: function(selector, handler) {\n\t\t\tvar subscription = new RelationSubscription(selector, handler);\n\t\t\tthis.subscriptions.push(subscription);\n\t\t\treturn subscription;\n\t\t},\n\n\t\t/**\n\t\t * Click handler that publishes link node to rel attribute value channel.\n\t\t *\n\t\t * @param {Event} e DOM Event\n\t\t */\n\t\tonClick: function(e) {\n\t\t\tvar link = dom.closest('a[rel]', e.target);\n\t\t\tvar rel = link ? link.rel : null;\n\t\t\tif (rel) {\n\t\t\t\te.preventDefault();\n\t\t\t\t// Publish synchronously to allow for privileged callbacks (e.g. play audio on iOS and Android)\n\t\t\t\t// Besides, we are already in an async event listener callback\n\t\t\t\tthis.publish(rel, link, true);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Dispose.\n\t\t */\n\t\tdispose: function() {\n\t\t\tevent.removeListener(this.node, 'click', this.onClick);\n\n\t\t\tPubSub.prototype.dispose.call(this);\n\t\t},\n\n\t\tcallbacks: [\n\t\t\t'onClick'\n\t\t]\n\t});\n});\n",
		"/**\n * Auto generated API: <tt>src/score/score-api.js</tt>\n *\n * <b>DO NOT MODIFY! CHANGES WILL BE OVERWRITTEN THE NEXT TIME YOU UPDATE!</b>\n *\n * <b>Note:</b> These are not real functions but method definitions for\n * {@link playtotv.server.Server#call}.\n *\n * @name scoreAPI\n * @memberOf playtotv.score\n * @namespace\n */\nplaytotv.define('playtotv.score.scoreAPI', [], function() {\n\n\t'use strict';\n\n\treturn {\n\t\t/*jshint maxlen:300*/ // On occassion generated lines can be too long\n\n\t\t/** @lends playtotv.score.scoreAPI */\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>showId</b></li>\n\t\t * <li><i>{ScoreTimeInterval}</i> <b>interval</b> Valid values: 'DAY', 'WEEK', 'MONTH', 'ALLTIME'</li>\n\t\t * <li><i>{number}</i> <b>intervalIndex</b></li>\n\t\t * <li><i>{[LeaderboardEntryDTO]}</i> <b>entries</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * <li><i>{number}</i> <b>score</b></li>\n\t\t * <li><i>{string}</i> <b>displayName</b></li>\n\t\t * <li><i>{string}</i> <b>avatarUrl</b></li>\n\t\t * <li><i>{number}</i> <b>ranking</b></li>\n\t\t * </ul></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.showId\n\t\t * @param {string} [params.pageIndex=1]\n\t\t * @param {string} [params.pageSize=10]\n\t\t * @returns {Promise} Promise of response data (TimeSpanLeaderboardDTO)\n\t\t */\n\t\tgetCurrentLeaderboardPage: {\n\t\t\tlabel: 'score.getCurrentLeaderboardPage',\n\t\t\turl: '1/score/show/{showId}/leaderboard',\n\t\t\tqueryKeys: [\n\t\t\t\t'pageIndex',\n\t\t\t\t'pageSize'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>showId</b></li>\n\t\t * <li><i>{ScoreTimeInterval}</i> <b>interval</b> Valid values: 'DAY', 'WEEK', 'MONTH', 'ALLTIME'</li>\n\t\t * <li><i>{number}</i> <b>intervalIndex</b></li>\n\t\t * <li><i>{[LeaderboardEntryDTO]}</i> <b>entries</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * <li><i>{number}</i> <b>score</b></li>\n\t\t * <li><i>{string}</i> <b>displayName</b></li>\n\t\t * <li><i>{string}</i> <b>avatarUrl</b></li>\n\t\t * <li><i>{number}</i> <b>ranking</b></li>\n\t\t * </ul></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.showId\n\t\t * @param {string} params.interval\n\t\t * @param {string} [params.pageIndex=1]\n\t\t * @param {string} [params.pageSize=10]\n\t\t * @returns {Promise} Promise of response data (TimeSpanLeaderboardDTO)\n\t\t */\n\t\tgetCurrentLeaderboardPageForInterval: {\n\t\t\tlabel: 'score.getCurrentLeaderboardPageForInterval',\n\t\t\turl: '1/score/show/{showId}/{interval}/leaderboard',\n\t\t\tqueryKeys: [\n\t\t\t\t'pageIndex',\n\t\t\t\t'pageSize'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>episodeSessionId</b></li>\n\t\t * <li><i>{[LeaderboardEntryDTO]}</i> <b>entries</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * <li><i>{number}</i> <b>score</b></li>\n\t\t * <li><i>{string}</i> <b>displayName</b></li>\n\t\t * <li><i>{string}</i> <b>avatarUrl</b></li>\n\t\t * <li><i>{number}</i> <b>ranking</b></li>\n\t\t * </ul></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.episodeSessionId\n\t\t * @param {string} [params.pageIndex=1]\n\t\t * @param {string} [params.pageSize=10]\n\t\t * @returns {Promise} Promise of response data (EpisodeLeaderboardDTO)\n\t\t */\n\t\tgetEpisodeLeaderboardPage: {\n\t\t\tlabel: 'score.getEpisodeLeaderboardPage',\n\t\t\turl: '1/score/episodesession/{episodeSessionId}/leaderboard',\n\t\t\tqueryKeys: [\n\t\t\t\t'pageIndex',\n\t\t\t\t'pageSize'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * <li><i>{string}</i> <b>episodeSessionId</b></li>\n\t\t * <li><i>{number}</i> <b>score</b></li>\n\t\t * <li><i>{number}</i> <b>ranking</b></li>\n\t\t * <li><i>{Long}</i> <b>phaseScores</b></li>\n\t\t * <li><i>{string}</i> <b>displayName</b></li>\n\t\t * <li><i>{string}</i> <b>avatarUrl</b></li>\n\t\t * <li><i>{boolean}</i> <b>notPlayed</b></li>\n\t\t * <li><i>{string}</i> <b>facebookId</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.episodeSessionId\n\t\t * @param {string} [params.userIds]\n\t\t * @param {string} [params.facebookIds]\n\t\t * @param {string} [params.callId]\n\t\t * @returns {Promise} Promise of response data (ParticipantEpisodeScoreDTO)\n\t\t */\n\t\tgetEpisodeScores: {\n\t\t\tlabel: 'score.getEpisodeScores',\n\t\t\turl: '1/score/episodesession/{episodeSessionId}',\n\t\t\tqueryKeys: [\n\t\t\t\t'userIds',\n\t\t\t\t'facebookIds',\n\t\t\t\t'callId'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>showId</b></li>\n\t\t * <li><i>{ScoreTimeInterval}</i> <b>interval</b> Valid values: 'DAY', 'WEEK', 'MONTH', 'ALLTIME'</li>\n\t\t * <li><i>{number}</i> <b>intervalIndex</b></li>\n\t\t * <li><i>{[LeaderboardEntryDTO]}</i> <b>entries</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * <li><i>{number}</i> <b>score</b></li>\n\t\t * <li><i>{string}</i> <b>displayName</b></li>\n\t\t * <li><i>{string}</i> <b>avatarUrl</b></li>\n\t\t * <li><i>{number}</i> <b>ranking</b></li>\n\t\t * </ul></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.showId\n\t\t * @param {string} params.interval\n\t\t * @param {string} params.year\n\t\t * @param {string} params.subIntervalIndex\n\t\t * @param {string} [params.pageIndex=1]\n\t\t * @param {string} [params.pageSize=10]\n\t\t * @returns {Promise} Promise of response data (TimeSpanLeaderboardDTO)\n\t\t */\n\t\tgetLeaderboardPageForInterval: {\n\t\t\tlabel: 'score.getLeaderboardPageForInterval',\n\t\t\turl: '1/score/show/{showId}/time/{interval}/{year}/{subIntervalIndex}/leaderboard',\n\t\t\tqueryKeys: [\n\t\t\t\t'pageIndex',\n\t\t\t\t'pageSize'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * <li><i>{string}</i> <b>showId</b></li>\n\t\t * <li><i>{number}</i> <b>score</b></li>\n\t\t * <li><i>{string}</i> <b>displayName</b></li>\n\t\t * <li><i>{string}</i> <b>avatarUrl</b></li>\n\t\t * <li><i>{number}</i> <b>ranking</b></li>\n\t\t * <li><i>{string}</i> <b>facebookId</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.showId\n\t\t * @param {ScoreTimeInterval} params.interval Valid values: 'DAY', 'WEEK', 'MONTH', 'ALLTIME'\n\t\t * @param {string} params.year\n\t\t * @param {string} params.subIntervalIndex\n\t\t * @param {string} [params.userIds]\n\t\t * @param {string} [params.facebookIds]\n\t\t * @param {string} [params.callId]\n\t\t * @returns {Promise} Promise of response data (ParticipantTimeSpanScoreDTO)\n\t\t */\n\t\tgetTimeSpanScores: {\n\t\t\tlabel: 'score.getTimeSpanScores',\n\t\t\turl: '1/score/show/{showId}/time/{interval}/{year}/{subIntervalIndex}',\n\t\t\tqueryKeys: [\n\t\t\t\t'userIds',\n\t\t\t\t'facebookIds',\n\t\t\t\t'callId'\n\t\t\t]\n\t\t}\n\t};\n});\n",
		"/**\n * Auto generated API: <tt>src/server/gatekeeper-api.js</tt>\n *\n * <b>DO NOT MODIFY! CHANGES WILL BE OVERWRITTEN THE NEXT TIME YOU UPDATE!</b>\n *\n * <b>Note:</b> These are not real functions but method definitions for\n * {@link playtotv.server.Server#call}.\n *\n * @name gatekeeperAPI\n * @memberOf playtotv.server\n * @namespace\n */\nplaytotv.define('playtotv.server.gatekeeperAPI', [], function() {\n\n\t'use strict';\n\n\treturn {\n\t\t/*jshint maxlen:300*/ // On occassion generated lines can be too long\n\n\t\t/** @lends playtotv.server.gatekeeperAPI */\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{Long}</i> <b>serverTime</b></li>\n\t\t * <li><i>{SystemStatus}</i> <b>status</b> Valid values: 'STARTING', 'AVAILABLE', 'FULL'</li>\n\t\t * <li><i>{[ClientStartupInfoServiceDTO]}</i> <b>services</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>serviceType</b></li>\n\t\t * <li><i>{[string]}</i> <b>serviceUrls</b></li>\n\t\t * </ul></li>\n\t\t * <li><i>{ClientVersionInfoDTO}</i> <b>clientMinimalVersion</b>\n\t\t * <ul>\n\t\t * <li><i>{Long}</i> <b>android</b></li>\n\t\t * <li><i>{Long}</i> <b>ios</b></li>\n\t\t * <li><i>{Long}</i> <b>web</b></li>\n\t\t * <li><i>{Long}</i> <b>windowsPhone</b></li>\n\t\t * <li><i>{Long}</i> <b>windows</b></li>\n\t\t * </ul></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @returns {Promise} Promise of response data (ClientStartupInfoDTO)\n\t\t */\n\t\tgetInit: {\n\t\t\tlabel: 'gatekeeper.getInit',\n\t\t\turl: '1/gatekeeper/init'\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.storage.MockStorage', [], function() {\n\n\t'use strict';\n\n\treturn new playtotv.Class({\n\t\t/** @lends playtotv.storage.MockStorage.prototype */\n\n\t\t/**\n\t\t * DOM Storage (e.g. localStorage) compatible class for mocking.\n\t\t *\n\t\t * Note: Data is stored in a plain object, so it will not be persisted beyond reloads etc.\n\t\t *\n\t\t * Note: This does not support Storage events (yet).\n\t\t *\n\t\t * @constructs\n\t\t */\n\t\tinitialize: function() {\n\t\t\t/**\n\t\t\t * The number of key/value pairs currently present in the list associated with the object.\n\t\t\t * @type number\n\t\t\t */\n\t\t\tthis.length = 0;\n\n\t\t\tthis._container = {};\n\t\t},\n\n\t\t/** @lends playtotv.storage.MockStorage.prototype */\n\n\t\t/**\n\t\t * Returns the name of the key with the given index.\n\t\t *\n\t\t * @param {number} index\n\t\t * @return {string} key\n\t\t */\n\t\tkey: function(index) {\n\t\t\treturn Object.keys(this._container)[index];\n\t\t},\n\n\t\t/**\n\t\t * Returns the current value associated with the given key.\n\t\t *\n\t\t * @param {string} key\n\t\t * @returns {string} value\n\t\t */\n\t\tgetItem: function(key) {\n\t\t\treturn Object.keys(this._container).indexOf(key) === -1 ? null : this._container[key];\n\t\t},\n\n\t\t/**\n\t\t * Adds or updates value of key/value pair to given value.\n\t\t *\n\t\t * @param {string} key\n\t\t * @param {string} value\n\t\t */\n\t\tsetItem: function(key, value) {\n\t\t\tthis._container[key] = value;\n\t\t\tthis._updateLength();\n\t\t},\n\n\t\t/**\n\t\t * Causes the key/value pair with the given key to be removed.\n\t\t *\n\t\t * @param {string} key\n\t\t */\n\t\tremoveItem: function(key) {\n\t\t\tdelete this._container[key];\n\t\t\tthis._updateLength();\n\t\t},\n\n\t\t/**\n\t\t * Causes the list associated with the object to be emptied of all key/value pairs.\n\t\t */\n\t\tclear: function() {\n\t\t\tthis.length = 0;\n\t\t\tthis._container = {};\n\t\t},\n\n\t\t_updateLength: function() {\n\t\t\tthis.length = Object.keys(this._container).length;\n\t\t}\n\t});\n});\n",
		"playtotv.define('playtotv.storage.Storage', [\n\t'playtotv.storage.MockStorage'\n], function(\n\tMockStorage\n) {\n\n\t'use strict';\n\n\tvar log = playtotv.Logger.get(this.id);\n\n\tvar Storage = new playtotv.Class({\n\t\t/** @lends playtotv.storage.Storage.prototype */\n\n\t\t/**\n\t\t * Wraps localStorage or sessionStorage, providing support for storage scoping through prefixing and getting\n\t\t * and setting non-string values through JSON encoding.\n\t\t *\n\t\t * This depends on the storage object's setItem, getItem, removeItem and key methods and length property.\n\t\t *\n\t\t * If window.localStorage is falsy then a new {@link playtotv.storage.MockStorage} instance is used by default.\n\t\t *\n\t\t * In any case, storage should be considered unreliable. For reliable persistence of data, use our servers.\n\t\t *\n\t\t * @constructs\n\t\t * @param {Object} [storage=window.localStorage] Storage object to use\n\t\t * @param {string} [prefix=''] Key prefix for this instance\n\t\t */\n\t\tinitialize: function(storage, prefix) {\n\t\t\tthis.storage = storage || window.localStorage || new MockStorage();\n\t\t\tthis.prefix = prefix || '';\n\t\t},\n\n\t\t/** @lends playtotv.storage.Storage.prototype */\n\n\t\t/**\n\t\t * Returns the stored value for a given key. Returns defaultValue if no value is found.\n\t\t *\n\t\t * @param {string} key\n\t\t * @param {mixed} defaultValue\n\t\t * @returns {mixed} value\n\t\t */\n\t\tget: function(key, defaultValue) {\n\t\t\tvar value = this.storage.getItem(this.prefix + key);\n\n\t\t\tif (value === null || value === undefined) {\n\t\t\t\treturn defaultValue; // always return defaultValue/undefined if not found (Firefox returns null)\n\t\t\t} else {\n\t\t\t\ttry { value = JSON.parse(value); } catch (e) {} // catch for backwards compatibility (e.g. strings)\n\t\t\t\treturn value;\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Stores a value with the given key. If value equals null or undefined then stored value is removed instead.\n\t\t *\n\t\t * Note: This should not be considered to be reliable let alone secure, always provide fallbacks.\n\t\t *\n\t\t * @param {string} key\n\t\t * @param {mixed} value\n\t\t * @param {Function} [quotaHandler=this.quotaHandler]\n\t\t */\n\t\tset: function(key, value, quotaHandler) {\n\t\t\tquotaHandler = quotaHandler || this.quotaHandler;\n\n\t\t\tif (value === null || value === undefined) {\n\t\t\t\tthis.remove(key); // setting undefined is not supported, remove it instead with likewise result\n\t\t\t} else {\n\t\t\t\t// Catch quota exceptions in case we run out or have none like in Safari Private Browsing\n\t\t\t\ttry {\n\t\t\t\t\tthis.storage.setItem(this.prefix + key, JSON.stringify(value));\n\t\t\t\t} catch (e) {\n\t\t\t\t\tif (e instanceof window.DOMException && e.code === e.QUOTA_EXCEEDED_ERR) {\n\t\t\t\t\t\tquotaHandler.call(this, e, key, value);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow e; // pass on any other exceptions\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Default quota exceeded exception handler that simply logs the exception.\n\t\t *\n\t\t * @param {Exception} e\n\t\t * @param {string} key\n\t\t * @param {mixed} value\n\t\t */\n\t\tquotaHandler: function(e, key, value) {\n\t\t\tlog.e('Caught quota exception: ' + e.name + ', while setting: ' + key, value, e);\n\t\t},\n\n\t\t/**\n\t\t * Removes a key\n\t\t *\n\t\t * @param {string} key\n\t\t * @returns {mixed} value\n\t\t */\n\t\tremove: function(key) {\n\t\t\tthis.storage.removeItem(this.prefix + key);\n\t\t},\n\n\t\t/**\n\t\t * Removes all items with this instance's prefix.\n\t\t */\n\t\tclear: function() {\n\t\t\tvar storage = this.storage;\n\t\t\tvar i = 0;\n\t\t\twhile (i < storage.length) {\n\t\t\t\tvar key = storage.key(i);\n\t\t\t\tif (key.indexOf(this.prefix) === 0) {\n\t\t\t\t\tstorage.removeItem(key);\n\t\t\t\t} else {\n\t\t\t\t\ti++;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Returns a sub storage instance with combined prefixes.\n\t\t *\n\t\t * @param {string} subprefix\n\t\t * @returns {playtotv.storage.Storage} storage\n\t\t */\n\t\tsubStorage: function(subPrefix) {\n\t\t\treturn new Storage(this.storage, this.prefix + subPrefix);\n\t\t}\n\t});\n\n\treturn Storage;\n});\n",
		"playtotv.define('playtotv.storage.AsyncStorage', [\n\t'playtotv.storage.Storage'\n], function(\n\tStorage\n) {\n\t/* global openDatabase:false*/\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar moduleId = this.id;\n\tvar log = ptv.Logger.get(moduleId);\n\tvar TABLE = 'keyvaluepairs';\n\n\tfunction sql(db, query, args) {\n\t\targs = args || [];\n\n\t\tlog.s(query, args);\n\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tdb.transaction(function(transaction) {\n\t\t\t\ttransaction.executeSql(query, args, function(transaction, results) {\n\t\t\t\t\tresolve(results);\n\t\t\t\t}, function(transaction, error) {\n\t\t\t\t\treject(error);\n\t\t\t\t});\n\t\t\t}, reject);\n\t\t});\n\t}\n\n\treturn new ptv.Class({\n\t\t/** @lends playtotv.storage.AsyncStorage.prototype */\n\n\t\t/**\n\t\t * Async key value storage using Web SQL as backend or falling back to localStorage if necessary.\n\t\t *\n\t\t * The interface is similar to {@link playtotv.storage.Storage} (which is also used for localStorage fallback)\n\t\t * but async using Promises.\n\t\t *\n\t\t * Code is inspired by localForage which is excellent but slightly on the heavy side\n\t\t * (localforage.nopromises.min.js is 17.5KB minified vs 2.7KB for Storage and AsyncStorage).\n\t\t * Note: IndexedDB still has limited support and issues so it has been left out for now.\n\t\t *\n\t\t * @constructs\n\t\t * @param {string} [prefix=''] Key prefix for this instance\n\t\t */\n\t\tinitialize: function(prefix) {\n\t\t\tthis.prefix = prefix || '';\n\n\t\t\tthis.ready = Promise.resolve().then(function() {\n\t\t\t\t// Default DB size is _JUST UNDER_ 5MB, as it's the highest size we can use without a prompt\n\t\t\t\tvar db = openDatabase(moduleId, '1.0', '', 4980736);\n\t\t\t\tvar query = 'CREATE TABLE IF NOT EXISTS ' + TABLE + ' (id INTEGER PRIMARY KEY, key unique, value)';\n\t\t\t\treturn sql(db, query).then(function() {\n\t\t\t\t\treturn { db: db };\n\t\t\t\t});\n\t\t\t}).catch(function(error) {\n\t\t\t\tlog.d('Falling back to localStorage', error);\n\t\t\t\treturn { storage: new Storage(window.localStorage, prefix) };\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Returns Promise of stored value for a given key. Returns defaultValue if no value is found.\n\t\t *\n\t\t * @param {string} key\n\t\t * @param {mixed} defaultValue\n\t\t * @returns {Promise} Promise of value\n\t\t */\n\t\tget: function(key, defaultValue) {\n\t\t\tvar prefix = this.prefix;\n\n\t\t\treturn this.ready.then(function(ref) {\n\t\t\t\tvar db = ref.db;\n\t\t\t\tif (!db) {\n\t\t\t\t\treturn ref.storage.get(key, defaultValue);\n\t\t\t\t}\n\n\t\t\t\tvar query = 'SELECT * FROM ' + TABLE + ' WHERE key = ? LIMIT 1';\n\t\t\t\treturn sql(db, query, [ prefix + key ]).then(function(results) {\n\t\t\t\t\tvar rows = results.rows;\n\t\t\t\t\treturn rows.length ? JSON.parse(rows.item(0).value) : defaultValue;\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Stores a value with the given key. If value equals null or undefined then stored value is removed instead.\n\t\t *\n\t\t * Note: This should not be considered to be reliable let alone secure, always provide fallbacks.\n\t\t *\n\t\t * @param {string} key\n\t\t * @param {mixed} value\n\t\t * @returns {Promise} Promise\n\t\t */\n\t\tset: function(key, value) {\n\t\t\t// Remove instead of setting null/undefined so as to match behavior of Storage class\n\t\t\tif (value === null || value === undefined) {\n\t\t\t\treturn this.remove(key);\n\t\t\t}\n\n\t\t\tvar prefix = this.prefix;\n\n\t\t\treturn this.ready.then(function(ref) {\n\t\t\t\tvar db = ref.db;\n\t\t\t\tif (!db) {\n\t\t\t\t\treturn ref.storage.set(key, value, function(error) {\n\t\t\t\t\t\tthrow new Error('Quota error: ' + error.name);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tvar query = 'INSERT OR REPLACE INTO ' + TABLE + ' (key, value) VALUES (?, ?)';\n\t\t\t\treturn sql(db, query, [ prefix + key, JSON.stringify(value) ]);\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Removes a key\n\t\t *\n\t\t * @param {string} key\n\t\t * @returns {Promise} Promise\n\t\t */\n\t\tremove: function(key) {\n\t\t\tvar prefix = this.prefix;\n\n\t\t\treturn this.ready.then(function(ref) {\n\t\t\t\tvar db = ref.db;\n\t\t\t\tif (!db) {\n\t\t\t\t\treturn ref.storage.remove(key);\n\t\t\t\t}\n\n\t\t\t\treturn sql(db, 'DELETE FROM ' + TABLE + ' WHERE key = ?', [ prefix + key ]);\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Removes all items with this instance's prefix.\n\t\t *\n\t\t * @returns {Promise} Promise\n\t\t */\n\t\tclear: function() {\n\t\t\tvar prefix = this.prefix;\n\n\t\t\treturn this.ready.then(function(ref) {\n\t\t\t\tvar db = ref.db;\n\t\t\t\tif (!db) {\n\t\t\t\t\treturn ref.storage.clear();\n\t\t\t\t}\n\n\t\t\t\t// Would be prettier to use ? instead of directly injecting prefix here, but don't know how\n\t\t\t\treturn sql(db, 'DELETE FROM ' + TABLE + ' WHERE key LIKE \"' + prefix + '%\"');\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Returns a sub storage instance with combined prefixes.\n\t\t *\n\t\t * @param {string} subPrefix\n\t\t * @returns {playtotv.storage.AsyncStorage} storage\n\t\t */\n\t\tsubStorage: function(subPrefix) {\n\t\t\treturn new this.constructor(this.prefix + subPrefix);\n\t\t},\n\n\t\t/**\n\t\t * Debug method for directly executing a query on Web SQL database.\n\n\t\t * @param {string} query\n\t\t * @param {Array} args\n\t\t * @returns {Promise} Promise\n\t\t */\n\t\tsql: function(query, args) {\n\t\t\treturn this.ready.then(function(ref) {\n\t\t\t\treturn sql(ref.db, query, args);\n\t\t\t});\n\t\t}\n\t});\n});\n",
		"playtotv.define('playtotv.storage.MockAsyncStorage', [\n\t'playtotv.storage.AsyncStorage',\n\t'playtotv.storage.MockStorage',\n\t'playtotv.storage.Storage'\n], function(\n\tAsyncStorage,\n\tMockStorage,\n\tStorage\n) {\n\n\t'use strict';\n\n\treturn class MockAsyncStorage extends AsyncStorage {\n\t\tconstructor(prefix) {\n\t\t\tsuper(prefix);\n\n\t\t\tthis.ready = Promise.resolve({ storage: new Storage(new MockStorage(), prefix) });\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.server.Server', [\n\t'playtotv.server.gatekeeperAPI',\n\t'playtotv.model.ObjectModel',\n\t'playtotv.net.request',\n\t'playtotv.storage.Storage'\n], function(\n\tgatekeeperAPI,\n\tObjectModel,\n\trequest,\n\tStorage\n) {\n\n\t'use strict';\n\n\t// TODO: Once playtotv.net.request() returns Promise.Cancellable have this also deal properly with cancellation\n\t// TODO: Cache service URL(s) (for a limited amount of time) to enable fast resume\n\t// TODO: replace onRetry callback option, resolveTaps and rejectTaps by publish-ing (and publish responseTime?)\n\t// TODO: Cleanup gatekeeper code (e.g: getServiceUrls, request, ..)\n\n\t////////// Private variables\n\n\tvar ptv = playtotv;\n\tvar REQUIRED = ptv.REQUIRED;\n\tvar util = ptv.util;\n\tvar log = ptv.Logger.get(this.id);\n\tvar event = ptv.event;\n\tvar gatekeeperInit = gatekeeperAPI.getInit;\n\n\t////////// Class declaration\n\n\t// Patch gatekeeperAPI.getInit method while this is not taken care of by server API generation\n\tgatekeeperInit.gatekeeper = true;\n\n\treturn new ptv.Class({\n\t\t/** @lends playtotv.server.Server.prototype */\n\n\t\textend: ObjectModel,\n\n\t\t/**\n\t\t * PlayToTV Server Class, used to manage a client-server connection.\n\t\t *\n\t\t * This requests service urls from the gatekeeper server and then sends server requests to the first url.\n\t\t * When a server request times out, that service url is scratched and the request is retried using the next.\n\t\t * When no more service urls are available, the client will request new service urls from the gatekeeper.\n\t\t *\n\t\t * @extends playtotv.model.ObjectModel\n\t\t * @constructs\n\t\t * @param {Object} options\n\t\t * @param {string} [options.url=''] URL of gatekeeper server, will be prefixed with '//' protocol if necessary\n\t\t * @param {number} [options.badDelay=5000] Number of ms to delay status BAD by to prevent unnecessary warnings\n\t\t * @param {Function} [options.onRetry] Callback(url, reason) for monitoring when this class retries a request\n\t\t * @param {Object} [options.gatekeeperData] Gatekeeper data to use (rather then request it ourselves)\n\t\t * @param {number} [options.gatekeeperDataTime] Unix time at which gatekeeperData was received\n\t\t *\n\t\t * @property {playtotv.model.ObjectModel} urls Subscribable: Map of service types to their current urls\n\t\t * @property {string} status Subscribable: Current server connection status: GOOD, BAD or BUSY\n\t\t * @property {number} timeOffset Subscribable: Client to server time offset in ms (add to server time)\n\t\t * @property {Object} clientMinimalVersion Subscribable: Client minimal version values returned by gatekeeper\n\t\t */\n\t\tinitialize: function(options) {\n\t\t\tthis._super({\n\t\t\t\turls: new ObjectModel({}),\n\t\t\t\tstatus: undefined,\n\t\t\t\ttimeOffset: undefined,\n\t\t\t\tclientMinimalVersion: {}\n\t\t\t});\n\n\t\t\t// TODO: extend options or add extra arguments for initializing with other settings, retryDelay etc.\n\t\t\toptions = ptv.params(options, {\n\t\t\t\turl: '',\n\t\t\t\tbadDelay: 5000,\n\t\t\t\tonRetry: function(url, reason) {\n\t\t\t\t\tlog.d('Retry: ' + url + ' (' + reason + ')');\n\t\t\t\t},\n\t\t\t\tgatekeeperData: undefined,\n\t\t\t\tgatekeeperDataTime: undefined\n\t\t\t});\n\n\t\t\t// If it looks like a hostname without a protocol prefix then prefix with //.\n\t\t\t// If it does not look like a hostname it is probably a relative path.\n\t\t\tvar url = options.url;\n\t\t\tif (url.length > 0 && /^localhost|.+\\..+/.test(url) && url.indexOf('//') === -1) {\n\t\t\t\turl = '//' + url;\n\t\t\t}\n\n\t\t\t////////// Undocumented properties\n\n\t\t\tthis.badDelay = options.badDelay;\n\t\t\tthis.onRetry = options.onRetry;\n\t\t\tthis.serverUrl = url;\n\t\t\tthis.serviceUrls = {};\n\t\t\tthis.urlPromises = {};\n\t\t\tthis.gatekeeperUrl = this.getGatekeeperServiceUrl(gatekeeperInit.service || 'API') + gatekeeperInit.url;\n\t\t\tthis.gatekeeperData = options.gatekeeperData;\n\t\t\tthis.gatekeeperDataTime = options.gatekeeperDataTime;\n\n\t\t\t////////// Documented properties\n\n\t\t\t/**\n\t\t\t * Default {@link playtotv.net.request} settings:\n\t\t\t * { cache: false, dataType: 'json' timeout: 20000, headers: {}, urlParams: {} }\n\t\t\t *\n\t\t\t * @type Object\n\t\t\t */\n\t\t\tthis.settings = {\n\t\t\t\tcache: false,\n\t\t\t\tdataType: 'json',\n\t\t\t\ttimeout: 20000,\n\t\t\t\theaders: {},\n\t\t\t\turlParams: {}\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * Time in ms to delay before retrying a request that fails due to a lack of connection or unavailability\n\t\t\t * of servers.\n\t\t\t *\n\t\t\t * @type number\n\t\t\t * @default 5000\n\t\t\t */\n\t\t\tthis.retryDelay = 5000;\n\n\t\t\t/**\n\t\t\t * Array of callbacks to call upon each request resolve.\n\t\t\t * Callbacks will be called with the API method object as 'this' and resolve data object as argument.\n\t\t\t *\n\t\t\t * @type [Function]\n\t\t\t */\n\t\t\tthis.resolveTaps = [];\n\n\t\t\t/**\n\t\t\t * Array of callbacks to call upon each request reject.\n\t\t\t * Callbacks will be called with the API method object as 'this' and reject reason object as argument.\n\t\t\t *\n\t\t\t * @type [Function]\n\t\t\t */\n\t\t\tthis.rejectTaps = [];\n\n\t\t\t/**\n\t\t\t * Storage instance prefixed with server URL.\n\t\t\t *\n\t\t\t * @type {playtotv.storage.Storage}\n\t\t\t */\n\t\t\tthis.storage = new Storage(window.localStorage, url + '/');\n\n\t\t\tevent.addListener(window, 'offline', function() {\n\t\t\t\tlog.d('Event: offline');\n\t\t\t\t// Improve speed of feedback by immediately changing to BAD without waiting for timeout.\n\t\t\t\tthis.setStatus('BAD');\n\t\t\t}.bind(this));\n\n\t\t\tevent.addListener(window, 'online', function() {\n\t\t\t\tlog.d('Event: online');\n\t\t\t\t// Experiments with immediate request retries here resulted in status 0 and thus worse recovery speed.\n\t\t\t\t// So instead of adding complexity here, I simply fake immediate recovery by changing status to GOOD.\n\t\t\t\t// In case things are not GOOD after all, this will change back to BAD upon the next request issue.\n\t\t\t\tthis.setStatus('GOOD');\n\t\t\t}.bind(this));\n\n\t\t\t// Immediately start by fetching service urls\n\t\t\t// Go straight for API for now since that will immediately define this.urlPromises.API and prevent another\n\t\t\t// call to getServiceUrls from any subsequent requests. And since API is the only service we really use :P\n\t\t\tthis.getServiceUrl('API');\n\t\t},\n\n\t\t////////// Undocumented methods\n\n\t\tsetStatus: (function() {\n\t\t\t// Try not to bother users with BAD connection warnings unnecessarily by delaying that status.\n\t\t\t// But do not delay other statuses (GOOD and BUSY) since we want to confirm those as quickly as possible.\n\t\t\tvar badPending = false;\n\n\t\t\tfunction checkBad() {\n\t\t\t\tif (badPending) {\n\t\t\t\t\tbadPending.changeProperty('status', 'BAD');\n\t\t\t\t\tbadPending = null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn function(status) {\n\t\t\t\tif (status === 'BAD') {\n\t\t\t\t\tif (!badPending) {\n\t\t\t\t\t\tbadPending = this;\n\t\t\t\t\t\tsetTimeout(checkBad, this.badDelay);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tbadPending = false;\n\t\t\t\t\tthis.changeProperty('status', status);\n\t\t\t\t}\n\t\t\t};\n\t\t}()),\n\n\t\turlKeys: function(url) {\n\t\t\tvar placeholders = url.match(/\\{(\\w+)\\}/g) || [];\n\t\t\treturn placeholders.map(function(placeholder) {\n\t\t\t\treturn placeholder.substr(1, placeholder.length - 2);\n\t\t\t});\n\t\t},\n\n\t\tvalidateCall: function(method, params, urlKeys) {\n\t\t\turlKeys = urlKeys || this.urlKeys(method.url);\n\n\t\t\tvar label = method.label;\n\t\t\tvar dataKeys = method.dataKeys;\n\t\t\tvar keys = Object.keys(params || {});\n\n\t\t\tvar validKeys = urlKeys.concat(method.queryKeys).concat(dataKeys);\n\t\t\tvar invalidKeys = [];\n\t\t\tkeys.forEach(function(key) {\n\t\t\t\tif (validKeys.indexOf(key) === -1) {\n\t\t\t\t\tinvalidKeys.push(key);\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (invalidKeys.length > 0) {\n\t\t\t\tthrow new Error(label + ': invalid parameters: ' + invalidKeys.join(', '));\n\t\t\t}\n\n\t\t\t// URL (a.k.a: path) and data keys are required, query keys are optional\n\t\t\tvar requiredKeys = urlKeys.concat(dataKeys);\n\t\t\tvar undefinedKeys = [];\n\t\t\trequiredKeys.forEach(function(key) {\n\t\t\t\tif (params[key] === undefined) {\n\t\t\t\t\tundefinedKeys.push(key);\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (undefinedKeys.length > 0) {\n\t\t\t\tthrow new Error(label + ': required parameters are undefined: ' + undefinedKeys.join(', '));\n\t\t\t}\n\t\t},\n\n\t\t_getServiceUrls: function() {\n\t\t\t// Use externally provided gatekeeper response data if available, otherwise call/request it ourselves\n\t\t\tvar gatekeeperData = this.gatekeeperData;\n\t\t\tvar gatekeeperDataTime = this.gatekeeperDataTime;\n\t\t\tvar dataPromise;\n\t\t\tif (gatekeeperData && gatekeeperDataTime) {\n\t\t\t\t// Compensate for time that has passed since receiving gatekeeperData\n\t\t\t\tgatekeeperData.serverTime += Date.now() - gatekeeperDataTime;\n\t\t\t\tdataPromise = Promise.resolve(gatekeeperData);\n\t\t\t\tdelete this.gatekeeperData;\n\t\t\t\tdelete this.gatekeeperDataTime;\n\t\t\t} else {\n\t\t\t\tdataPromise = this.call(gatekeeperInit);\n\t\t\t}\n\n\t\t\treturn dataPromise.then(function(data) {\n\t\t\t\t// If status is undefined assume it's AVAILABLE (for same origin CF cached init)\n\t\t\t\tif (!data.status || data.status === 'AVAILABLE') {\n\t\t\t\t\tthis.setStatus('GOOD');\n\t\t\t\t} else {\n\t\t\t\t\tthis.setStatus('BUSY');\n\t\t\t\t\tthis.onRetry(this.gatekeeperUrl, 'busy-' + data.status.toLowerCase());\n\t\t\t\t\treturn Promise.delay(this.retryDelay).then(this._getServiceUrls);\n\t\t\t\t}\n\n\t\t\t\tthis.changeProperty('timeOffset', Date.now() - data.serverTime);\n\t\t\t\tthis.changeProperty('clientMinimalVersion', data.clientMinimalVersion);\n\n\t\t\t\treturn data.services.reduce(function(map, service) {\n\t\t\t\t\t// Randomly shuffle service urls to evenly distribute client load\n\t\t\t\t\tmap[service.serviceType] = ptv.shuffle(\n\t\t\t\t\t\tservice.serviceUrls.map(function(url) {\n\t\t\t\t\t\t\t// Strip API version (belongs to method descriptors, not service urls)\n\t\t\t\t\t\t\treturn url.replace(/\\d+\\/$/, '');\n\t\t\t\t\t\t})\n\t\t\t\t\t);\n\t\t\t\t\treturn map;\n\t\t\t\t}.bind(this), {});\n\t\t\t}.bind(this), function(reason) {\n\t\t\t\t// We should only end up here if error is considered unrecoverable by this.call/request() (e.g. 404)\n\t\t\t\t// However, we still want to keep retry-ing gatekeeper in such cases to allow for auto recovery\n\t\t\t\t// Because sometimes servers being restarted etc. (e.g. during up/down-scale) will return such errors\n\t\t\t\tlog.i('getServiceUrls: retry: ' + reason.status);\n\t\t\t\tthis.setStatus('BAD');\n\t\t\t\tthis.onRetry(this.gatekeeperUrl, 'status-' + reason.status);\n\t\t\t\treturn Promise.delay(this.retryDelay).then(this._getServiceUrls);\n\t\t\t}.bind(this));\n\t\t},\n\n\t\t/**\n\t\t * Get service URLs from server.\n\t\t *\n\t\t * Has the side effect that status, timeOffset and clientMinimalVersion properties are updated.\n\t\t *\n\t\t * This is throttled (2s) to prevent too many or parallel requests.\n\t\t *\n\t\t * @function\n\t\t * @returns {Promise} Promise of service URL map object\n\t\t */\n\t\tgetServiceUrls: Promise.throttle(function() {\n\t\t\treturn this._getServiceUrls();\n\t\t}, 2000),\n\n\t\tgetGatekeeperServiceUrl: function(service) {\n\t\t\treturn this.serverUrl + '/' + service.toLowerCase() + '/';\n\t\t},\n\n\t\tgetServiceUrl: function(service) {\n\t\t\tvar urlPromises = this.urlPromises;\n\t\t\tif (!urlPromises[service]) {\n\t\t\t\tvar serviceUrls = this.serviceUrls;\n\t\t\t\tvar myServiceUrls = serviceUrls[service] || [];\n\t\t\t\tif (myServiceUrls.length > 0) {\n\t\t\t\t\t// Just pop next url of the stack\n\t\t\t\t\turlPromises[service] = Promise.resolve(myServiceUrls.shift());\n\t\t\t\t} else {\n\t\t\t\t\t// Get new service urls\n\t\t\t\t\turlPromises[service] = this.getServiceUrls().then(function(newServiceUrls) {\n\t\t\t\t\t\t// Store service urls for all services; could save on making another request later\n\t\t\t\t\t\t// Override any previously fetched urls since some of those might be deprecated\n\t\t\t\t\t\tptv.each(newServiceUrls, function(urls, urlsService) {\n\t\t\t\t\t\t\tserviceUrls[urlsService] = urls;\n\t\t\t\t\t\t});\n\t\t\t\t\t\tvar myNewServiceUrls = newServiceUrls[service] || [];\n\t\t\t\t\t\tif (myNewServiceUrls.length === 0) {\n\t\t\t\t\t\t\t// Default to gatekeeper service url (e.g. single node cluster)\n\t\t\t\t\t\t\treturn this.getGatekeeperServiceUrl(service);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Return first service url (and remember the rest)\n\t\t\t\t\t\t\treturn serviceUrls[service].shift();\n\t\t\t\t\t\t}\n\t\t\t\t\t}.bind(this));\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn urlPromises[service];\n\t\t},\n\n\t\tinvalidateServiceUrl: function(service, promise) {\n\t\t\tvar urlPromises = this.urlPromises;\n\t\t\tif (urlPromises[service] === promise) { // only invalidate if the promise has not changed already\n\t\t\t\turlPromises[service] = null;\n\t\t\t}\n\t\t},\n\n\t\trequest: function(url, settings, retry) {\n\t\t\t// Default to simply retry-ing with same url and settings\n\t\t\tretry = retry || function() {\n\t\t\t\treturn this.request(url, settings, retry);\n\t\t\t}.bind(this);\n\n\t\t\tvar currentSettings = ptv.extend({}, this.settings, settings);\n\n\t\t\treturn request(url, currentSettings).then(function(data) {\n\t\t\t\t// Prevent unnecessary status change on successful gatekeeperInit\n\t\t\t\tif (settings.label === gatekeeperInit.label && data.status && data.status !== 'AVAILABLE') {\n\t\t\t\t\treturn data;\n\t\t\t\t}\n\t\t\t\tthis.setStatus('GOOD');\n\t\t\t\treturn data;\n\t\t\t}.bind(this), function(reason) {\n\t\t\t\tvar status = reason.status;\n\t\t\t\t// TODO: Add setting option to retry after a delay (true=>always, callback=>if true)?\n\t\t\t\t// Retry requests that were most likely rejected without delay after a minimum delay\n\t\t\t\tif (status === 0 || status === 'no-xhr-proxy' || (status > 12000 && status < 13000)) { // IE uses 12xxx\n\t\t\t\t\tthis.onRetry(url, 'status-' + status);\n\t\t\t\t\t// TODO: Double check that status 0 does not lead to false positive BAD statusses\n\t\t\t\t\t// TODO: Only look at gatekeeper requests and offline events for BAD?\n\t\t\t\t\tthis.setStatus('BAD');\n\t\t\t\t\treturn Promise.delay(this.retryDelay).then(retry);\n\t\t\t\t// Retry temporary server error after a delay\n\t\t\t\t} else if (status === 503) {\n\t\t\t\t\tthis.onRetry(url, 'status-' + status);\n\t\t\t\t\treturn Promise.delay(this.retryDelay).then(retry);\n\t\t\t\t// Retry requests that rejected after waiting for timeout straight away\n\t\t\t\t} else if (status === 'timeout') {\n\t\t\t\t\tthis.onRetry(url, 'timeout');\n\t\t\t\t\tthis.setStatus('BAD');\n\t\t\t\t\treturn retry();\n\t\t\t\t// Unrecoverable\n\t\t\t\t} else {\n\t\t\t\t\t// TODO: Facilitate retry-ing from rejection handlers (reason.retry = retry)?\n\t\t\t\t\treturn Promise.reject(reason);\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t},\n\n\t\tgetUrlAndRequest: function(serviceType, methodUrl, settings) {\n\t\t\tvar urlPromise = this.getServiceUrl(serviceType);\n\t\t\treturn urlPromise.then(function(serviceUrl) {\n\t\t\t\tthis.urls.setProperty(serviceType, serviceUrl);\n\t\t\t\treturn this.request(serviceUrl + methodUrl, settings, function retry() {\n\t\t\t\t\tthis.invalidateServiceUrl(serviceType, urlPromise);\n\t\t\t\t\treturn this.getUrlAndRequest(serviceType, methodUrl, settings);\n\t\t\t\t}.bind(this));\n\t\t\t}.bind(this));\n\t\t},\n\n\t\ttap: function(method, requestPromise) {\n\t\t\trequestPromise.then(function(data) {\n\t\t\t\tthis.resolveTaps.forEach(function(tap) {\n\t\t\t\t\ttap.call(method, data);\n\t\t\t\t});\n\t\t\t}.bind(this), function(reason) {\n\t\t\t\tthis.rejectTaps.forEach(function(tap) {\n\t\t\t\t\ttap.call(method, reason);\n\t\t\t\t});\n\t\t\t}.bind(this));\n\n\t\t\treturn requestPromise;\n\t\t},\n\n\t\t////////// Documented methods\n\n\t\t/**\n\t\t * Call specified method on this server with optional method parameters and request settings.\n\t\t *\n\t\t * TODO: Add abort() function to returned promise for aborting this call.\n\t\t *\n\t\t * @example\n\t\t *\n\t\t *var server = new Server({ host: demo-backend.playtotv.com });\n\t\t *\n\t\t *var testAPI = {\n\t\t *\tcreateA: {\n\t\t *\t\tlabel: 'test.createA',\n\t\t *\t\ttype: 'POST',\n\t\t *\t\turl: 'test/a',\n\t\t *\t\tdataKeys: [ 'x', 'y' ]\n\t\t *\t},\n\t\t *\treadA: {\n\t\t *\t\tlabel: 'test.readA',\n\t\t *\t\turl: 'test/a/{id}'\n\t\t *\t},\n\t\t *\tupdateA: {\n\t\t *\t\tlabel: 'test.updateA',\n\t\t *\t\ttype: 'PUT',\n\t\t *\t\turl: 'test/a/{id}',\n\t\t *\t\tdataKeys: [ 'x', 'y' ]\n\t\t *\t},\n\t\t *\tdeleteA: {\n\t\t *\t\tlabel: 'test.deleteA',\n\t\t *\t\ttype: 'DELETE',\n\t\t *\t\turl: 'test/a/{id}'\n\t\t *\t},\n\t\t *};\n\t\t *\n\t\t *server.call(testAPI.createA, { x: 'foo', y: 'bar' }).then(function(a) {\n\t\t *\t// created a\n\t\t *\treturn server.call(testAPI.deleteA, { id: a.id }, { timeout: -1 });\n\t\t *}).catch(function(reason) {\n\t\t *\t// reason.label can be either 'test.createA' or 'test.deleteA'\n\t\t *\t// response status and data are returned as reason.status and reason.data\n\t\t *});\n\t\t *\n\t\t * @param {Object} method Definition of server method to call\n\t\t * @param {string} [method.label] Request label to be used to identify this request\n\t\t * @param {string} [method.service='API'] Service type\n\t\t * @param {boolean} [method.gatekeeper=false] Request directly from gatekeeper server\n\t\t * @param {string} [method.type='GET'] Request type (GET/POST/PUT/DELETE)\n\t\t * @param {string} method.url Request URL including path variables\n\t\t * @param {Array} [method.queryKeys=[]] Array of request query parameter keys\n\t\t * @param {Array} [method.dataKeys=[]] Array of request data parameter keys\n\t\t * @param {Object} [params] Parameters to pass to method\n\t\t * @param {Object} [settings] Extra settings/overrides to apply to {@link playtotv.net.request}\n\t\t * @return {Promise} Promise of server response to method call\n\t\t */\n\t\tcall: function(method, params, settings) {\n\t\t\tptv.params(method, {\n\t\t\t\tlabel: undefined,\n\t\t\t\tservice: 'API',\n\t\t\t\tgatekeeper: false,\n\t\t\t\ttype: 'GET',\n\t\t\t\turl: REQUIRED,\n\t\t\t\tqueryKeys: [],\n\t\t\t\tdataKeys: []\n\t\t\t});\n\t\t\tparams = params || {};\n\t\t\tsettings = ptv.extend({\n\t\t\t\tlabel: method.label,\n\t\t\t\ttype: method.type\n\t\t\t}, settings);\n\n\t\t\tvar methodUrl = method.url;\n\t\t\tvar urlKeys = this.urlKeys(methodUrl);\n\n\t\t\tthis.validateCall(method, params, urlKeys);\n\n\t\t\turlKeys.forEach(function(key) {\n\t\t\t\tmethodUrl = methodUrl.replace('{' + key + '}', encodeURIComponent(params[key]));\n\t\t\t});\n\n\t\t\tmethod.queryKeys.forEach(function(key) {\n\t\t\t\tif (params[key] !== undefined) {\n\t\t\t\t\tmethodUrl = util.addURLParam(methodUrl, key, params[key]);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tvar dataKeys = method.dataKeys;\n\t\t\tif (dataKeys.length > 0) {\n\t\t\t\tsettings.data = {};\n\t\t\t\tdataKeys.forEach(function(key) {\n\t\t\t\t\tsettings.data[key] = params[key];\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tvar methodService = method.service;\n\t\t\tif (method.gatekeeper) {\n\t\t\t\tvar gatekeeperMethodUrl = this.getGatekeeperServiceUrl(methodService) + methodUrl;\n\t\t\t\treturn this.tap(method, this.request(gatekeeperMethodUrl, settings));\n\t\t\t} else {\n\t\t\t\treturn this.tap(method, this.getUrlAndRequest(methodService, methodUrl, settings));\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Converts a server time into a local client time by adding the server time offset.\n\t\t *\n\t\t * @param {number} serverTime Server time in ms since Unix time epoch\n\t\t * @return {number} Client time in ms since Unix time epoch\n\t\t */\n\t\ttoClientTime: function(serverTime) {\n\t\t\treturn serverTime + this.timeOffset;\n\t\t},\n\n\t\t/**\n\t\t * Converts a local client time into a server time by subtracting the server time offset.\n\t\t *\n\t\t * @param {number} [clientTime=Date.now()] Client time in ms since Unix time epoch\n\t\t * @return {number} Server time in ms since Unix time epoch\n\t\t */\n\t\ttoServerTime: function(clientTime) {\n\t\t\tclientTime = clientTime || Date.now();\n\t\t\treturn clientTime - this.timeOffset;\n\t\t},\n\n\t\t/**\n\t\t * Shortcut to make a server call and log the resolve/reject value.\n\t\t *\n\t\t * @param {Object} method {@link playtotv.server.Server#call} method\n\t\t * @param {Object} [params] {@link playtotv.server.Server#call} params\n\t\t * @param {Object} [settings] {@link playtotv.server.Server#call} settings\n\t\t * @param {string} [level='DEBUG'] {@link playtotv.Logger} level\n\t\t * @return {Promise} {@link playtotv.server.Server#call} promise\n\t\t */\n\t\tlog: function(method, params, settings, level) {\n\t\t\tvar promise = this.call(method, params, settings);\n\t\t\tlog.log(level || 'DEBUG', [ method.label, params, promise ]);\n\t\t\treturn promise;\n\t\t},\n\n\t\tcallbacks: [\n\t\t\t'_getServiceUrls'\n\t\t]\n\t});\n});\n",
		"playtotv.define('playtotv.server.ServerController', [\n\t'playtotv.mvc.Controller',\n\t'playtotv.server.Server'\n], function(\n\tController,\n\tServer\n) {\n\n\t// TODO: Merge Server into this\n\t// TODO: JSDoc\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar callAsyncCounter = 0;\n\n\treturn class ServerController extends Controller {\n\t\tconstructor(context, options) {\n\t\t\tsuper(context);\n\n\t\t\tvar server = this.getServer(options);\n\n\t\t\t// Proxy to Server\n\t\t\tvar properties = [ 'status', 'timeOffset', 'clientMinimalVersion' ];\n\t\t\tproperties.forEach(key => {\n\t\t\t\tserver.subscribe('change:' + key, value => this.set(key, value));\n\t\t\t});\n\t\t\tserver.urls.subscribe('*:API', url => this.set('url', url));\n\n\t\t\tvar methods = [ 'call', 'toClientTime', 'toServerTime', 'log' ];\n\t\t\tmethods.forEach(name => {\n\t\t\t\tthis[name] = server[name].bind(server);\n\t\t\t\tthis.addMethod(name);\n\t\t\t});\n\n\t\t\tthis.rejectTaps = server.rejectTaps;\n\n\t\t\tthis.addMethods([\n\t\t\t\t'addRejectTap',\n\t\t\t\t'callAsync'\n\t\t\t]);\n\n\t\t\t// Work with push controller to support slow async calls\n\t\t\tthis.asyncCalls = [];\n\t\t\tcontext.scope.subscribe('push.ASYNC-RESPONSE', this.onAsyncResponse.bind(this));\n\t\t}\n\n\t\tgetServer(options) {\n\t\t\treturn new Server(options);\n\t\t}\n\n\t\taddRejectTap(tapFn, filterFn) {\n\t\t\tfilterFn = filterFn || function() { return true; };\n\t\t\tthis.rejectTaps.push(function(error) {\n\t\t\t\tvar method = this;\n\t\t\t\tif (filterFn(error, method)) {\n\t\t\t\t\ttapFn(error, method);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// Use this instead of call() to get server to send response back later through a push event\n\t\t// This is useful in case server might take longer then timeout (20s) to respond\n\t\t// Also alleviates server load when responses are likely to be slow in general\n\t\tcallAsync(method, params, settings) {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t// Note: callId is passed as a query param so it has to be a string\n\t\t\t\tvar callId = '' + (++callAsyncCounter);\n\n\t\t\t\tthis.call(method, params, ptv.extend({}, settings, {\n\t\t\t\t\turlParams: { callId: callId }\n\t\t\t\t})).catch(reject);\n\n\t\t\t\t// TODO: Retry after async response event timeout in case we miss the event somehow?\n\t\t\t\t// Since this will be particularly used for potentially slow calls, I will leave this for now\n\n\t\t\t\tthis.asyncCalls.push({\n\t\t\t\t\tcallId: callId,\n\t\t\t\t\tlabel: method.label,\n\t\t\t\t\tresolve: resolve,\n\t\t\t\t\treject: reject\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tonAsyncResponse(event) {\n\t\t\tvar payload = event.payload;\n\t\t\tvar callId = payload.callId;\n\n\t\t\tvar asyncCalls = this.asyncCalls;\n\t\t\tvar call = asyncCalls.find(call => call.callId === callId);\n\t\t\tif (!call) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tasyncCalls.splice(asyncCalls.indexOf(call), 1);\n\n\t\t\tvar status = payload.responseStatus;\n\t\t\tvar data = payload.responseBody;\n\t\t\tif ((status >= 200 && status < 300) || status === 304) {\n\t\t\t\tcall.resolve(data);\n\t\t\t} else {\n\t\t\t\tvar error = new Error('Async call ' + call.label + ' failed with status ' + status);\n\t\t\t\tcall.reject(ptv.extend(error, {\n\t\t\t\t\tlabel: call.label,\n\t\t\t\t\tstatus: status,\n\t\t\t\t\txhr: null,\n\t\t\t\t\tdata: data\n\t\t\t\t}));\n\t\t\t}\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.server.MockServer', [\n\t'playtotv.server.gatekeeperAPI',\n\t'playtotv.server.Server',\n\t'playtotv.net.request'\n], function(\n\tgatekeeperAPI,\n\tServer,\n\trequest\n) {\n\n\t'use strict';\n\n\treturn new playtotv.Class({\n\t\t/** @lends playtotv.server.MockServer.prototype */\n\n\t\textend: Server,\n\n\t\t/**\n\t\t * PlayToTV MockServer Class, for mocking server calls.\n\t\t *\n\t\t * Calls will be handled by specified mocks if defined.\n\t\t * If a mock is a function then this will be called with the call arguments and returned as a Promise.\n\t\t * Else a Promise resolved with the mock value will be returned.\n\t\t *\n\t\t * If a string Promise would be returned, the call will recurse using that string as method label instead.\n\t\t *\n\t\t * If no mock is defined a request will be made for JSON file: \"<base>/<label>.json\".\n\t\t * Then if a render function is specified (e.g. {@link playtotv.mustache.render}) the JSON file content is\n\t\t * rendered as a template using the method params as view data before it is parsed as JSON, e.g:\n\t\t * <code>\"pollId\" : \"{{pollId}}\"</code>\n\t\t *\n\t\t * If the JSON request is rejected then the specified default resolve/reject value Promise will be returned.\n\t\t *\n\t\t * A default function is provided for the mock gatekeeper call (gatekeeperAPI.getInit).\n\t\t *\n\t\t * @extends playtotv.server.Server\n\t\t * @constructs\n\t\t * @param {Object} [options]\n\t\t * @param {Object} [options.mocks={}] Map of method labels to mock functions or value promises\n\t\t * @param {string} [options.base='mock'] Base URL to fetch JSON files with mock responses from\n\t\t * @param {Promise|mixed} [options.value={isDefaultValue: true}] Default Promise or resolve value\n\t\t * @param {Function} [render=null] Function for rendering response template file to JSON\n\t\t */\n\t\tinitialize: function(options) {\n\t\t\toptions = playtotv.params(options, {\n\t\t\t\tmocks: {},\n\t\t\t\tbase: 'mock',\n\t\t\t\tvalue: { // this default resolve value can facilitate some simple requests\n\t\t\t\t\tisDefaultValue: true\n\t\t\t\t},\n\t\t\t\trender: null\n\t\t\t});\n\n\t\t\tvar mockMap = this.mockMap = options.mocks;\n\t\t\tthis.baseUrl = options.base;\n\t\t\tthis.defaultValue = options.value;\n\t\t\tthis.render = options.render;\n\n\t\t\t// Some default mock functions\n\t\t\tvar gatekeeperLabel = gatekeeperAPI.getInit.label;\n\t\t\tvar pushPollLabel = 'pushPoll.getEvents'; // See: playtotv.push.EventsPoller\n\t\t\tmockMap[gatekeeperLabel] = mockMap[gatekeeperLabel] || this.mockGatekeeper;\n\t\t\tmockMap[pushPollLabel] = mockMap[pushPollLabel] || this.mockPushPoll;\n\n\t\t\tthis._super();\n\t\t},\n\n\t\t/**\n\t\t * Mocking override of {@link playtotv.server.Server#call}\n\t\t */\n\t\tcall: function(method, params, settings) {\n\t\t\tplaytotv.params(method, {\n\t\t\t\tlabel: undefined,\n\t\t\t\tservice: 'API',\n\t\t\t\tgatekeeper: false,\n\t\t\t\ttype: 'GET',\n\t\t\t\turl: playtotv.REQUIRED,\n\t\t\t\tqueryKeys: [],\n\t\t\t\tdataKeys: []\n\t\t\t});\n\t\t\tparams = params || {};\n\t\t\tsettings = playtotv.extend({\n\t\t\t\tlabel: method.label,\n\t\t\t\ttype: method.type\n\t\t\t}, settings);\n\n\t\t\tthis.validateCall(method, params);\n\n\t\t\tvar label = method.label || method.url.replace(/[\\{\\}]/g, '_') + (method.type ? '/' + method.type : '');\n\t\t\tvar mock = this.mockMap[label];\n\t\t\tif (mock) {\n\t\t\t\tif (mock instanceof Function) {\n\t\t\t\t\tmock = mock(method, params, settings);\n\t\t\t\t}\n\t\t\t\treturn this.tap(method, Promise.resolve(mock).then(function(value) {\n\t\t\t\t\treturn typeof value === 'string' ? this.call({ label: value }, params, settings) : value;\n\t\t\t\t}.bind(this)));\n\t\t\t}\n\n\t\t\tvar url = this.baseUrl + '/' + label + '.json';\n\t\t\tvar render = this.render;\n\t\t\treturn this.tap(method, request(url).then(function(template) {\n\t\t\t\tvar view = playtotv.extend({ method: method }, params);\n\t\t\t\tvar json = render ? render(template, view) : template;\n\t\t\t\treturn JSON.parse(json);\n\t\t\t}, function(/* reason */) {\n\t\t\t\treturn this.defaultValue;\n\t\t\t}.bind(this)));\n\t\t},\n\n\t\tmockGatekeeper: function() {\n\t\t\treturn {\n\t\t\t\tserverTime: Date.now(),\n\t\t\t\tstatus: 'AVAILABLE',\n\t\t\t\tservices: []\n\t\t\t};\n\t\t},\n\n\t\tmockPushPoll: function() {\n\t\t\t// Delay to prevent EventsPoller from going nuts\n\t\t\treturn Promise.delay(10000).then(function() {\n\t\t\t\treturn {\n\t\t\t\t\tstream: 'mock-stream',\n\t\t\t\t\tevents: []\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\t});\n});\n",
		"playtotv.define('playtotv.server.MockServerController', [\n\t'playtotv.server.ServerController',\n\t'playtotv.server.MockServer'\n], function(\n\tServerController,\n\tMockServer\n) {\n\n\t// TODO: Merge MockServer into this\n\t// TODO: JSDoc\n\n\t'use strict';\n\n\treturn class MockServerController extends ServerController {\n\t\tgetServer(/*options*/) {\n\t\t\treturn this.server || (this.server = new MockServer());\n\t\t}\n\n\t\tcallAsync() {\n\t\t\treturn this.call.apply(this, arguments);\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.touch.Sequence', [\n\t'playtotv.css.Vector'\n], function(\n\tVector\n) {\n\n\t'use strict';\n\n\tvar _max = Math.max;\n\n\tvar SWIPE_DELAY = 300;\n\tvar SENSITIVITY = 20;\n\n\t/**\n\t * Follows a mouse or touch pointer from start to end, and is continuously updated with properties like the\n\t * current point, offset and velocity vector. Updated automatically by the {@link playtotv.touch.TouchProxy} that\n\t * created it, and passed along with 'em:touch[type]' events as 'sequence' property on the event's details.\n\t *\n\t * @name Sequence\n\t * @class\n\t * @memberOf playtotv.touch\n\t * @constructor\n\t * @param {Node} target\n\t * @param {Event|Touch} e\n\t */\n\tvar Sequence = new playtotv.Class({\n\t\tinitialize: function(target, e) {\n\t\t\tthis.target = target;\n\t\t\tthis.id = e.pointerId || e.identifier;\n\t\t\tthis.start = new Vector(e.clientX, e.clientY);\n\t\t\tthis.screen = new Vector(e.screenX, e.screenY);\n\t\t\tthis.point = this.start;\n\t\t\tthis.offset = Vector.ZERO;\n\t\t\tthis.velocity = Vector.ZERO;\n\t\t\tthis.time = Date.now();\n\n\t\t\tthis.isTap = true;\n\t\t},\n\n\t\t/** @lends playtotv.touch.Sequence.prototype */\n\n\t\t/**\n\t\t * Updates this sequence's point, offset and velocity vectors with the given native event or touch, and sets\n\t\t * the isTap boolean to false when the offset's magnitude exceeds tap sensitivity.\n\t\t *\n\t\t * @param {Event|Touch} e\n\t\t */\n\t\tupdate: function(e) {\n\t\t\tvar t = Date.now();\n\t\t\tvar c = new Vector(e.clientX, e.clientY);\n\t\t\tvar w = new Vector(e.screenX, e.screenY);\n\t\t\tvar s = this.start;\n\t\t\tvar p = this.point;\n\t\t\tvar ms = t - this.time;\n\t\t\tvar v = 1000 / _max(ms, 40); // TODO: average over multiple updates more accurate?\n\n\t\t\tthis.velocity = new Vector(\n\t\t\t\t(c.x - p.x) * v,\n\t\t\t\t(c.y - p.y) * v\n\t\t\t);\n\n\t\t\tthis.offset = new Vector(\n\t\t\t\tc.x - s.x,\n\t\t\t\tc.y - s.y\n\t\t\t);\n\n\t\t\tif (this.isTap && (this.offset.magnitude() > SENSITIVITY)) {\n\t\t\t\tdelete this.isTap;\n\t\t\t\tthis.isSwipe = setTimeout(this.clearSwipe, SWIPE_DELAY);\n\t\t\t}\n\n\t\t\tthis.time = t;\n\t\t\tthis.point = c;\n\t\t\tthis.screen = w;\n\t\t},\n\n\t\t/**\n\t\t * Deletes the isSwipe property when swipe time has been exceeded. Used by the TouchProxy (in combination with\n\t\t * isTap) to determine whether a swipe event will be fired.\n\t\t */\n\t\tclearSwipe: function() {\n\t\t\tclearTimeout(this.isSwipe);\n\t\t\tdelete this.isSwipe;\n\t\t},\n\n\t\tcallbacks: [\n\t\t\t'clearSwipe'\n\t\t]\n\t});\n\n\treturn Sequence;\n});\n",
		"playtotv.define('playtotv.touch.Tracker', [\n\t'playtotv.touch.Sequence'\n], function(Sequence) {\n\n\t'use strict';\n\n\tvar nativeMap = [].map;\n\n\t/**\n\t * Tracker\n\t *\n\t */\n\tvar Tracker = new playtotv.Class({\n\t\tinitialize: function() {\n\t\t\tthis.map = {};\n\t\t},\n\n\t\tadd: function(touches, target) {\n\t\t\treturn nativeMap.call(touches, function(touch) {\n\t\t\t\tvar id = touch.pointerId || touch.identifier;\n\t\t\t\tvar sequence = this.map[id] = new Sequence(target, touch);\n\t\t\t\treturn sequence;\n\t\t\t}, this);\n\t\t},\n\n\t\tupdate: function(touches) {\n\t\t\treturn nativeMap.call(touches, function(touch) {\n\t\t\t\tvar id = touch.pointerId || touch.identifier;\n\t\t\t\tvar item = this.map[id];\n\t\t\t\titem.update(touch);\n\t\t\t\treturn item;\n\t\t\t}, this);\n\t\t},\n\n\t\tremove: function(touches) {\n\t\t\treturn nativeMap.call(touches, function(touch) {\n\t\t\t\tvar id = touch.pointerId || touch.identifier;\n\t\t\t\tvar item = this.map[id];\n\t\t\t\tdelete this.map[id];\n\t\t\t\treturn item;\n\t\t\t}, this);\n\t\t},\n\n\t\ttoArray: function() {\n\t\t\tvar result = [];\n\t\t\tvar map = this.map;\n\t\t\tfor (var id in map) {\n\t\t\t\tif (map.hasOwnProperty(id)) {\n\t\t\t\t\tresult.push(map[id]);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn result;\n\t\t},\n\n\t\tempty: function() {\n\t\t\tvar map = this.map;\n\t\t\tfor (var id in map) {\n\t\t\t\tif (map.hasOwnProperty(id)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\t});\n\n\treturn Tracker;\n});\n",
		"playtotv.define('playtotv.touch.TouchProxy', [\n\t'playtotv.touch.Tracker'\n], function(\n\tTracker\n) {\n\n\t'use strict';\n\n\tvar event = playtotv.event;\n\tvar dom = playtotv.dom;\n\n\tvar inputReg = /input|textarea|select|option/i;\n\tvar CLICK_DELAY = 500;\n\n\tvar nativeTouch = 'ontouchstart' in window;\n\tvar nativePointers = 'onpointerdown' in window;\n\tvar maxPointers = navigator.maxTouchPoints || navigator.msMaxTouchPoints || 0;\n\n\t// determines whether triggering a click on touchend is needed at all\n\tfunction needsFastClick(node) {\n\t\t/*jshint maxcomplexity:20*/\n\n\t\t// only touch enabled devices may have a click delay\n\t\tif (!nativeTouch && (!nativePointers || (maxPointers === 0))) {\n\t\t\treturn false;\n\t\t}\n\n\t\tvar ua = navigator.userAgent;\n\t\tvar winMobile = /Windows Phone/.test(ua);\n\t\tvar iOs = /iP(hone|ad|od)/.test(ua) && !winMobile;\n\n\t\t// iOs never disables the 300ms delay due to double-tap scrolling\n\t\tif (iOs) {\n\t\t\treturn true;\n\t\t}\n\n\t\tvar android = /Android/.test(ua) && !winMobile;\n\t\tvar chrome = /Chrome\\/([0-9]+)/.test(ua);\n\t\tvar firefox = /Firefox\\/([0-9]+)/.test(ua);\n\n\t\t// chrome and firefox disable the 300ms delay when user scaling is disabled\n\t\tif ((chrome && android) || firefox) {\n\t\t\tvar viewMeta = dom.first('meta[name=viewport]');\n\t\t\tif (viewMeta && /user-scalable=no/.test(viewMeta.content)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\t// IE disables the delay if touchAction is set to none or manipulation\n\t\tvar style = node.currentStyle || node.style;\n\t\tvar touchAction = style ? (style.touchAction || style.msTouchAction) : null;\n\t\tif (touchAction && /none|manipulation/.test(touchAction)) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// default fastclick to true on otherwise unknown touch-enabled devices\n\t\treturn true;\n\t}\n\n\t/**\n\t * Touch event proxy, fires custom em:touch[type] events by listening to native touch or mouse events, depending\n\t * on the device it is running on. Check {@link playtotv.touch.touchManager#captureEvents} on how to manage\n\t * TouchProxy instances and how to use the events fired by them.\n\t *\n\t * @name TouchProxy\n\t * @class\n\t * @memberOf playtotv.touch\n\t * @constructor\n\t */\n\tvar TouchProxy = new playtotv.Class({\n\n\t\tinitialize: function(node, options) {\n\t\t\toptions = playtotv.params(options, {\n\t\t\t\tfastClick: true,\n\t\t\t\tpreventNative: true,\n\t\t\t\tpropagateNative: false\n\t\t\t});\n\n\t\t\tthis.node = node;\n\t\t\tthis.fastClick = options.fastClick && needsFastClick(node);\n\t\t\tthis.preventNative = options.preventNative;\n\t\t\tthis.propagateNative = options.propagateNative;\n\n\t\t\tthis.startEvent = nativePointers ? 'pointerdown' : nativeTouch ? 'touchstart' : 'mousedown';\n\t\t\tthis.moveEvent = nativePointers ? 'pointermove' : nativeTouch ? 'touchmove' : 'mousemove';\n\t\t\tthis.endEvent = nativePointers ? 'pointerup' : nativeTouch ? 'touchend' : 'mouseup';\n\n\t\t\tthis.tracker = new Tracker();\n\n\t\t\tevent.addListener(node, this.startEvent, this.touchStart);\n\t\t},\n\n\t\t/** @lends playtotv.touch.TouchProxy.prototype */\n\n\t\t/**\n\t\t * Touchstart handler, fires a 'em:touchstart' event, and binds move and release event handlers for the rest of\n\t\t * the touch (or mouse) sequence.\n\t\t *\n\t\t * @param {Event} e\n\t\t */\n\t\ttouchStart: function(e) {\n\t\t\tvar target = e.target;\n\n\t\t\t// ignore touchstart on form elements; would make entering values impossible\n\t\t\t// TODO: enable as class options to include elements like video, object, etc\n\t\t\tif (inputReg.test(target.nodeName)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar changed = this.getChangedTouches(e);\n\t\t\tvar added = this.tracker.add(changed, target);\n\t\t\tvar prevent = false;\n\n\t\t\t// added.length is > 1 only if two pointers entered the same node in the same callstack, which is unlikely,\n\t\t\t// but possible. Separate native events are fired if the target differs. For unified behavior, custom\n\t\t\t// events are always fired separately.\n\t\t\tvar i, l = added.length;\n\t\t\tfor (i = 0; i < l; i++) {\n\t\t\t\tif (this.dispatchEvent('em:touchstart', added[i], e) === false) {\n\t\t\t\t\tprevent = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// stop native event behaviour for custom touch enabled elements if allowed and requested\n\t\t\tif (this.preventNative && prevent) {\n\t\t\t\te.preventDefault();\n\t\t\t}\n\n\t\t\t// stop propagation of native event unless explicitly allowed\n\t\t\tif (!this.propagateNative) {\n\t\t\t\te.stopPropagation();\n\t\t\t}\n\n\t\t\t// don't add more listeners when a second finger touches an already tracked node\n\t\t\tif (!this.tracking) {\n\t\t\t\tthis.bindEvents();\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Internal touchmove handler. Fires an 'em:touchmove' event for each individual moving pointer. Handlers that\n\t\t * wish to update the DOM with coordinates derived from this event should do so using interval based callbacks\n\t\t * like {@link playtotv.animationFrame} to minimize redraws.\n\t\t *\n\t\t * @param {Event} e\n\t\t */\n\t\ttouchMove: function(e) {\n\t\t\tvar changed = this.getChangedTouches(e);\n\t\t\tvar touches = this.tracker.update(changed);\n\t\t\tvar prevent = false;\n\n\t\t\t// The native touches.length is only > 1 if two or more pointers move within the same target. Separate\n\t\t\t// native events are fired otherwise. The custom events are always fired separately, because multi pointer\n\t\t\t// event handling is just as likely to be needed on complex dom fragments, in which case separate events\n\t\t\t// would natively be fired as well.\n\t\t\tvar i, l = touches.length;\n\t\t\tfor (i = 0; i < l; i++) {\n\t\t\t\tif (this.dispatchEvent('em:touchmove', touches[i], e) === false) {\n\t\t\t\t\tprevent = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.preventNative && prevent) {\n\t\t\t\te.preventDefault();\n\t\t\t}\n\n\t\t\tif (!this.propagateNative) {\n\t\t\t\te.stopPropagation();\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Checks the event sequence and fires a generic em:touchend event, followed by either an em:swipe, or a native\n\t\t * click event.\n\t\t *\n\t\t * @param {Event} e\n\t\t */\n\t\ttouchEnd: function(e) {\n\t\t\t/*jshint maxcomplexity:20*/\n\n\t\t\tvar changed = this.getChangedTouches(e);\n\t\t\tvar removed = this.tracker.remove(changed);\n\n\t\t\tvar preventNative = this.preventNative;\n\t\t\tvar prevent = false;\n\n\t\t\tvar touch, i, l = removed.length;\n\t\t\tfor (i = 0; i < l; i++) {\n\t\t\t\ttouch = removed[i];\n\n\t\t\t\t// default, always: fire em:touchend\n\t\t\t\tif (this.dispatchEvent('em:touchend', touch, e) === false) {\n\t\t\t\t\tprevent = true;\n\t\t\t\t}\n\n\t\t\t\t// trigger a faster click than a native one, which may be delayed for double-tap functionality on\n\t\t\t\t// various touch enabled devices. This delay can otherwise take up to 350ms, which is undesirable.\n\t\t\t\tif (touch.isTap && this.fastClick) {\n\n\t\t\t\t\tvar click = new event.MouseEvent('click', {\n\t\t\t\t\t\tbubbles: true,\n\t\t\t\t\t\tcancelable: true,\n\t\t\t\t\t\tclientX: touch.point.x,\n\t\t\t\t\t\tclientY: touch.point.y,\n\t\t\t\t\t\tscreenX: touch.screen.x,\n\t\t\t\t\t\tscreenY: touch.screen.y\n\t\t\t\t\t});\n\n\t\t\t\t\t// mark as custom for telling clicks apart\n\t\t\t\t\tclick.isFastClick = true;\n\n\t\t\t\t\ttouch.target.dispatchEvent(click);\n\n\t\t\t\t\t// Prevent any following native clicks if fired.\n\t\t\t\t\tthis.preventNextClick(touch.point);\n\t\t\t\t}\n\n\t\t\t\t// within swipe timeframe, trigger a swipe\n\t\t\t\tif (touch.isSwipe) {\n\t\t\t\t\tthis.dispatchEvent('em:swipe', touch, e);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (preventNative && prevent) {\n\t\t\t\te.preventDefault();\n\t\t\t}\n\n\t\t\tif (!this.propagateNative) {\n\t\t\t\te.stopPropagation();\n\t\t\t}\n\n\t\t\t// unbind only after all pointers/fingers left the node\n\t\t\tif (this.tracker.empty()) {\n\t\t\t\tthis.unbindEvents();\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Dispatches a touch event of the given type via event.dispatchEvent, automatically called by the proxy.\n\t\t * The event's detail property contains a reference to the proxy that dispatched it, the touch or mouse\n\t\t * sequence, and the native event from which it originated.\n\t\t *\n\t\t * @param {string} type\n\t\t * @param {playtotv.touch.Sequence} sequence\n\t\t * @param {Event} e\n\t\t */\n\t\tdispatchEvent: function(type, sequence, e) {\n\t\t\treturn event.dispatchEvent(sequence.target, type, true, true, {\n\t\t\t\tproxy: this,\n\t\t\t\tsequence: sequence,\n\t\t\t\tnativeEvent: e\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Binds move and end events\n\t\t * @private\n\t\t */\n\t\tbindEvents: function() {\n\t\t\tif (this.tracking) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tevent.addListener(document, this.moveEvent, this.touchMove);\n\t\t\tevent.addListener(document, this.endEvent, this.touchEnd);\n\t\t\tthis.tracking = true;\n\t\t},\n\n\t\t/**\n\t\t * Unbinds move and end events\n\t\t * @private\n\t\t */\n\t\tunbindEvents: function() {\n\t\t\tif (!this.tracking) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tevent.removeListener(document, this.moveEvent, this.touchMove);\n\t\t\tevent.removeListener(document, this.endEvent, this.touchEnd);\n\t\t\tthis.tracking = false;\n\t\t},\n\n\t\t/**\n\t\t * Returns the native touches list of the given event, or the event itself as only array value on non-touch\n\t\t * devices, effectively mimicking e.touches.\n\t\t * See https://developer.mozilla.org/en-US/docs/Web/API/TouchEvent.touches\n\t\t *\n\t\t * @param {Event} e\n\t\t * @returns {TouchList|Array} touches\n\t\t */\n\t\tgetTouches: function(e) {\n\t\t\treturn e.touches || [ e ];\n\t\t},\n\n\t\t/**\n\t\t * Returns the native changedTouches list of the given event, or the event itself as only array value on\n\t\t * non-touch devices, effectively mimicking the e.changedTouches array.\n\t\t * See https://developer.mozilla.org/en-US/docs/Web/API/TouchEvent.changedTouches\n\t\t *\n\t\t * @param {Event} e\n\t\t * @returns {TouchList|Array} changedTouches\n\t\t */\n\t\tgetChangedTouches: function(e) {\n\t\t\treturn e.changedTouches || [ e ];\n\t\t},\n\n\t\t/**\n\t\t * Returns the {@link playtotv.touch.Sequence} that tracks the currently active mouse or touch pointer that is\n\t\t * associated with te given identifier (see https://developer.mozilla.org/en-US/docs/Web/API/Touch.identifier).\n\t\t *\n\t\t * @param {String} identifier\n\t\t * @returns {playtotv.touch.Sequence} sequence\n\t\t */\n\t\tgetSequence: function(id) {\n\t\t\treturn this.tracker.map[id];\n\t\t},\n\n\t\t/**\n\t\t * Returns an array of all sequences of currently active mouse or touch pointers.\n\t\t *\n\t\t * @returns {Array} sequences\n\t\t */\n\t\tgetSequences: function() {\n\t\t\treturn this.tracker.toArray();\n\t\t},\n\n\t\t/**\n\t\t * Calls preventDefault in the capture phase of any click events that are fired both during ghost time and in\n\t\t * close proximity to the given point. This method is called by the proxy's touchEnd method after a faster\n\t\t * click is triggered on mobile devices, and prevents double click events from firing when a native click does\n\t\t * follow the triggered one.\n\t\t *\n\t\t * @param {playtotv.css.Vector} point\n\t\t */\n\t\tpreventNextClick: function(point) {\n\t\t\tvar nextClick = function(e) {\n\t\t\t\tvar dx = e.clientX - point.x;\n\t\t\t\tvar dy = e.clientY - point.y;\n\t\t\t\tif (!e.isFastClick && Math.sqrt((dx * dx) + (dy * dy)) < 20) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tvar node = this.node;\n\t\t\tnode.addEventListener('click', nextClick, true);\n\t\t\tsetTimeout(function() {\n\t\t\t\tnode.removeEventListener('click', nextClick, true);\n\t\t\t}, CLICK_DELAY);\n\t\t},\n\n\t\t/**\n\t\t * Unbinds all events and deletes the node reference. Call this method before the page unloads to prevent\n\t\t * any possible memory leaks.\n\t\t */\n\t\tdispose: function() {\n\t\t\tthis.unbindEvents();\n\t\t\tevent.removeListener(this.node, this.startEvent, this.touchStart);\n\t\t\tdelete this.node;\n\t\t},\n\n\t\tcallbacks: [\n\t\t\t'touchStart',\n\t\t\t'touchMove',\n\t\t\t'touchEnd'\n\t\t]\n\t});\n\n\treturn TouchProxy;\n});\n",
		"playtotv.define('playtotv.touch.touchManager', [\n\t'playtotv.css.Vector',\n\t'playtotv.touch.TouchProxy'\n], function(\n\tVector,\n\tTouchProxy\n) {\n\n\t'use strict';\n\n\tvar dom = playtotv.dom;\n\tvar TOUCH_ENABLED = 'TouchEnabled';\n\n\t/**\n\t * Touch controller for managing em:touch[type] events for use with both mouse and touch. Typically, only the root\n\t * node of an app is enabled via the captureEvents method, but an approach where individual nodes are captured and\n\t * released during their lifecycle is a possible one.\n\t * Various widgets like {@link playtotv.widget.ScrollableWidget} rely on a captured node (or ascendant) to\n\t * function properly, and will throw an error if none is found.\n\t *\n\t * Available events are em:touchstart, em:touchmove, em:touchend (which are fired from their native down, move and\n\t * up counterparts) and em:swipe, which (if at all) is fired immediately after em:touchend. The event object that\n\t * is passed to handlers contains a detail object with the following properties:\n\t *\n\t * - proxy, the {@link playtotv.touch.TouchProxy} that fired the event\n\t * - sequence, the {@link playtotv.touch.Sequence} of this event, exposing offset and velocity vectors etc.\n\t * - nativeEvent, the underlying native event\n\t *\n\t * Calling preventDefault on em:touchstart, -move and -end will prevent native mouse and touch behavior to trigger\n\t * (e.g. native scrolling, dragging, zooming) depending on preventNative option passed to the captureEvents\n\t * method. In general, handlers SHOULD call preventDefault, as custom event handling often implies\n\t * that native behavior is not desired at that time.\n\t *\n\t * Calling stopPropagation will prevent events to reach handlers higher up in the DOM, and MAY be called by\n\t * handlers that wish to claim the event. A horizontal slider could stop propagation of horizontally orientented\n\t * em:touchmove events to prevent them from reaching a vertically scrollable ascendant, which might otherwise\n\t * result in sliding and scrolling simultaneously.\n\t *\n\t * @name touchManager\n\t * @namespace Touch controller for managing em:touch[type] events.\n\t * @memberOf playtotv.touch\n\t */\n\tvar touchManager = {\n\n\t\t/** @lends playtotv.touch */\n\n\t\tproxies: [],\n\n\t\t/**\n\t\t * Enables custom em:touch[type] events for a node and its decendants via {@link playtotv.touch.TouchProxy}.\n\t\t * These events are required by {@link playtotv.widget.DraggableWidget} and any widgets that use it.\n\t\t *\n\t\t * Set the fastClick option to true (default) to allow a faster click event to be fired on touch enabled\n\t\t * devices, which may have an aproximately 300ms delay before a native click is fired. Some devices remove this\n\t\t * delay themselves if the viewport meta tag content contains 'user-scalable=no', and/or when the target node's\n\t\t * style has a touch-action css property with a value of 'none' or 'manipulation'. In this case, the fastClick\n\t\t * option will not fire clicks.\n\t\t *\n\t\t * When preventDefault is called on a custom event, the underlying native (pointer, touch or mouse) event is\n\t\t * also prevented. Set the em>preventNative</em> option to false (default true) to disallow this. This may be\n\t\t * required in special cases, for instance when combining custom horizontal scrolling with native vertical\n\t\t * scrolling etc.\n\t\t *\n\t\t * Set the propagateNative option to true to allow underlying native events to bubble unhindered.\n\t\t * This has no effect on native browser behavior, but might be needed when using other third party scripts that\n\t\t * need to handle these events on nodes higher up in the DOM. This may also apply to the preventNative option.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {Object} [options]\n\t\t * @param {boolean} [options.fastClick=true]\n\t\t * @param {boolean} [options.preventNative=true]\n\t\t * @param {boolean} [options.propagateNative=false]\n\t\t * @returns {playtotv.touch.TouchProxy} proxy\n\t\t */\n\t\tcaptureEvents: function(node, options) {\n\t\t\toptions = playtotv.params(options, {\n\t\t\t\tfastClick: true,\n\t\t\t\tpreventNative: true,\n\t\t\t\tpropagateNative: false\n\t\t\t});\n\n\t\t\tif (this.isCaptured(node)) {\n\t\t\t\tthrow new Error('Node or ascendant is already captured by playtotv.touch');\n\t\t\t}\n\n\t\t\tif (options.fastClick && !options.preventNative) {\n\t\t\t\tthrow new Error('Ambiguous options: preventNative (false) is overruled by fastClick (true)');\n\t\t\t}\n\n\t\t\t// flag as enabled\n\t\t\tdom.setData(node, TOUCH_ENABLED, true);\n\n\t\t\t// create the proxy\n\t\t\tvar proxy = new TouchProxy(node, options);\n\t\t\tthis.proxies.push(proxy);\n\n\t\t\t// and return it\n\t\t\treturn proxy;\n\t\t},\n\n\t\t/**\n\t\t * Removes custom em:touch[type] events of a previously enabled node. Returns a boolean whether the node\n\t\t * had its events removed successfully.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @returns {boolean} success\n\t\t */\n\t\treleaseEvents: function(node) {\n\t\t\tvar i, proxy, l = this.proxies.length;\n\t\t\tfor (i = 0; i < l; i++) {\n\t\t\t\tproxy = this.proxies[i];\n\t\t\t\tif (proxy.node === node) {\n\t\t\t\t\tdom.removeData(node, TOUCH_ENABLED);\n\t\t\t\t\tthis.proxies.splice(i, 1);\n\t\t\t\t\tproxy.dispose();\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\n\t\t/**\n\t\t * Returns a boolean whether em:touch[type] events are enabled for this node (or via an ascendant).\n\t\t *\n\t\t * @param {Node} node\n\t\t * @returns {boolean} captured\n\t\t */\n\t\tisCaptured: function(node) {\n\t\t\twhile (node) {\n\t\t\t\tif (dom.getData(node, TOUCH_ENABLED)) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\tnode = node.parentNode;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\n\t\t/**\n\t\t * Returns the angle (in radians) of a sequence's current velocity vector\n\t\t *\n\t\t * @param {playtotv.touch.Sequence} sequence\n\t\t * @return {number} angle\n\t\t */\n\t\tgetAngle: function(sequence) {\n\t\t\tvar v = sequence.velocity;\n\t\t\treturn Math.atan2(v.y, v.x);\n\t\t},\n\n\t\t/**\n\t\t * Returns the orientation of a sequence's current velocity, either Vector.HORIZONTAL or Vector.VERTICAL\n\t\t *\n\t\t * @param {playtotv.touch.Sequence} sequence\n\t\t * @return {number} orientation\n\t\t */\n\t\tgetOrientation: function(sequence) {\n\t\t\tvar v = sequence.velocity;\n\t\t\treturn Math.abs(v.x) > Math.abs(v.y) ?\n\t\t\t\tVector.HORIZONTAL : Vector.VERTICAL;\n\t\t},\n\n\t\t/**\n\t\t * Returns a given event's direction, as Vector property UP, DOWN, LEFT or RIGHT\n\t\t *\n\t\t * @param {playtotv.touch.Sequence} sequence\n\t\t * @return {number} direction\n\t\t */\n\t\tgetDirection: function(sequence) {\n\t\t\tvar v = sequence.velocity;\n\t\t\treturn this.getOrientation(sequence) === Vector.HORIZONTAL ?\n\t\t\t\t(v.x > 0 ? Vector.RIGHT : Vector.LEFT) : (v.y > 0 ? Vector.DOWN : Vector.UP);\n\t\t}\n\t};\n\n\t/**\n\t * return the module\n\t *\n\t */\n\n\treturn touchManager;\n});\n",
		"/*jshint maxparams:100*/\nplaytotv.define('playtotv.mvc.App', [\n\t'playtotv.mvc.Controller',\n\t'playtotv.mvc.helpers',\n\t'playtotv.mvc.Router',\n\t'playtotv.mvc.View',\n\t'playtotv.pubsub.PubSub',\n\t'playtotv.storage.AsyncStorage',\n\t'playtotv.storage.MockAsyncStorage',\n\t'playtotv.touch.touchManager',\n\t'playtotv.logUtil',\n\t'playtotv.PauseDog'\n], function(\n\tController,\n\thelpers,\n\tRouter,\n\tView,\n\tPubSub,\n\tAsyncStorage,\n\tMockAsyncStorage,\n\ttouchManager,\n\tlogUtil,\n\tPauseDog\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar util = ptv.util;\n\tvar event = ptv.event;\n\tvar log = ptv.Logger.get(this.id);\n\tvar Cancellable = Promise.Cancellable;\n\n\treturn class App extends PubSub {\n\t\t/** @lends playtotv.mvc.App.prototype */\n\n\t\t/**\n\t\t * PlayToTV MVC App containing global resources like templates, storage, router and view\n\t\t * and coordinating controllers, widgets and event listeners.\n\t\t *\n\t\t * Note: Controller has been left out for now. It can be added back again later if necessary.\n\t\t *\n\t\t * @constructs\n\t\t * @param {Object} options\n\t\t * @param {string} options.id App id to use for persistence and logging etc.\n\t\t * @param {[Function]} [options.templates=Handlebars.templates] Page template functions to use\n\t\t * @param {boolean} [options.mockStorage=false] If true then use MockStorage instead of (real) Storage\n\t\t * @param {Object} [options.router={}] Options for Router\n\t\t * @param {Object} [options.touch={}] Options for touchManager.captureEvents (will not capture if falsy)\n\t\t * @param {Object} [options.view={}] Options for View\n\t\t * @param {number} [options.reloadTime=4*60*60*1000] JavaScript pause time in ms after which to reload\n\t\t */\n\t\tconstructor(options) {\n\t\t\tvar Handlebars = window.Handlebars;\n\t\t\tif (Handlebars) {\n\t\t\t\toptions.templates = options.templates || Handlebars.templates;\n\t\t\t\tHandlebars.registerHelper(helpers);\n\t\t\t}\n\n\t\t\tptv.params(options, {\n\t\t\t\tid: ptv.REQUIRED,\n\t\t\t\ttemplates: ptv.REQUIRED,\n\t\t\t\tmockStorage: false,\n\t\t\t\trouter: {},\n\t\t\t\ttouch: {},\n\t\t\t\tview: {},\n\t\t\t\treloadTime: 4 * 60 * 60 * 1000\n\t\t\t});\n\n\t\t\tsuper();\n\n\t\t\t// TODO: JSDOC or privatize (_ prefix) properties\n\t\t\tthis.id = options.id;\n\t\t\tthis.templates = options.templates;\n\t\t\tthis.storage = this.constructStorage(options.mockStorage);\n\t\t\tthis.router = this.constructRouter(options.router);\n\t\t\tthis.touchCaptured = this.constructTouch(options.touch);\n\t\t\tthis.view = this.constructView(options.view);\n\t\t\tthis.pauseDog = this.constructPauseDog(options.reloadTime);\n\n\t\t\tthis.widgetMap = {};\n\t\t\tthis.widgets = [];\n\n\t\t\tevent.addWindowOnError(this.onError.bind(this));\n\t\t\tevent.addListener(window, 'beforeUnload', () => this.dispose());\n\n\t\t\tthis.startLog();\n\t\t}\n\n\t\t// TODO: JSDOC or privatize (_ prefix) methods\n\n\t\t////\n\t\t// CONSTRUCTORS\n\t\t//\n\n\t\tconstructStorage(mock) {\n\t\t\tvar StorageClass = mock ? MockAsyncStorage : AsyncStorage;\n\t\t\treturn new StorageClass(this.id + '.');\n\t\t}\n\n\t\tconstructRouter(options) {\n\t\t\tvar router = new Router(ptv.extend({\n\t\t\t\tpatterns: Object.keys(this.templates)\n\t\t\t}, options));\n\n\t\t\trouter.subscribe('*', (params, pattern) => {\n\t\t\t\t// Note: this will also trigger view.update subscription below\n\t\t\t\tthis.publish('route:' + pattern, params);\n\t\t\t});\n\n\t\t\treturn router;\n\t\t}\n\n\t\tconstructTouch(options) {\n\t\t\tif (options) {\n\t\t\t\ttouchManager.captureEvents(document, options);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t\tconstructView(options) {\n\t\t\t// View render template is determined by current route\n\t\t\tvar view = new View(ptv.extend({\n\t\t\t\trender: () => this.templates[this.router.pattern](this)\n\t\t\t}, options));\n\n\t\t\tview.nodeAddedListeners.push(this.onNodeAdded.bind(this));\n\t\t\tview.nodeRemoveListeners.push(this.onNodeRemove.bind(this));\n\n\t\t\treturn view;\n\t\t}\n\n\t\tconstructPauseDog(reloadTime) {\n\t\t\t// Reload if JS was paused for more then x (e.g: 4 hours) to prevent stale clients (e.g: in native wrapper)\n\t\t\t// Also can help to prevent or work around other issues in these types of situations\n\t\t\tvar pauseDog = new PauseDog();\n\t\t\tpauseDog.add(reloadTime, () => this.reload());\n\t\t\treturn pauseDog;\n\t\t}\n\n\t\t////\n\t\t// STARTERS\n\t\t//\n\n\t\t/**\n\t\t * Starts logging.\n\t\t *\n\t\t * This is called by the constructor and can be overridden if you like.\n\t\t */\n\t\tstartLog() {\n\t\t\t// Get reference to project App logger by id passed to our constructor\n\t\t\tvar log = ptv.Logger.get(this.id);\n\n\t\t\t// Basic DEBUG logging\n\t\t\t// TODO: Make default blacklist extendable (by logging through App log() method?)\n\t\t\t// Would be nice to automatically log all blacklisted entries to log.s instead of log.d (like push.* below)\n\t\t\tlogUtil.logPubSub(this, log.d.bind(log), { blacklist: [\n\t\t\t\t'push.*',\n\t\t\t\t'change:twitter.tweets'\n\t\t\t] });\n\t\t\tthis.view.subscribe('diffs', diffs => log.d('view.diffs: ' + diffs.length));\n\n\t\t\t// And details to SPAM\n\t\t\tthis.subscribe('push.*', (value, channel) => log.s(channel, value));\n\t\t\tlogUtil.logPubSub(this.view, log.s.bind(log), { name: 'view' });\n\t\t}\n\n\t\t/**\n\t\t * Call this when you are ready to have things rendered to the view.\n\t\t *\n\t\t * E.g: After you have added your controllers.\n\t\t *\n\t\t * @returns {Promise} Promise that resolves on first render\n\t\t */\n\t\tstartView() {\n\t\t\tthis.view.update();\n\t\t\tthis.subscribe('*', this.view.update);\n\t\t\treturn this.view.when('change');\n\t\t}\n\n\t\t////\n\t\t// STORAGE\n\t\t//\n\n\t\tflush(name) {\n\t\t\treturn this.storage.set(name, this[name].serialize());\n\t\t}\n\n\t\t////\n\t\t// CONTROLLERS\n\t\t//\n\n\t\taddController(name, ControllerClass, options) {\n\t\t\treturn this.storage.get(name).catch(() => undefined).then(stored => {\n\t\t\t\tif (this[name]) {\n\t\t\t\t\tthrow new Error('Controller name not available: ' + name);\n\t\t\t\t}\n\n\t\t\t\tvar controller = new ControllerClass({\n\t\t\t\t\tname: name,\n\t\t\t\t\tapp: this,\n\t\t\t\t\tstored: stored\n\t\t\t\t}, options);\n\n\t\t\t\tthis[name] = controller;\n\n\t\t\t\tvar debouncedFlush = ptv.debounce(() => this.flush(name), 500);\n\n\t\t\t\tcontroller.subscribe('*', (data, channel) => {\n\t\t\t\t\tthis.publish(name + '.' + channel, data);\n\t\t\t\t\tdebouncedFlush();\n\t\t\t\t});\n\n\t\t\t\tthis.publish(name, controller);\n\n\t\t\t\treturn controller;\n\t\t\t});\n\t\t}\n\n\t\taddControllers(controllers) {\n\t\t\treturn Promise.all(controllers.map(args => this.addController.apply(this, args)));\n\t\t}\n\n\t\t////\n\t\t// WIDGETS\n\t\t//\n\n\t\tsetWidget(name, WidgetClass, options = {}) {\n\t\t\toptions.app = this;\n\n\t\t\tthis.widgetMap[name] = {\n\t\t\t\tWidgetClass: WidgetClass,\n\t\t\t\toptions: options\n\t\t\t};\n\t\t}\n\n\t\tsetWidgets(widgets) {\n\t\t\twidgets.forEach(args => this.setWidget.apply(this, args));\n\t\t}\n\n\t\tinstantiateWidget(node, name, options) {\n\t\t\tvar widget = this.widgetMap[name];\n\t\t\tif (!widget) {\n\t\t\t\tthrow new Error('Widget not found: ' + name);\n\t\t\t}\n\n\t\t\tvar instanceOptions = ptv.extend({}, widget.options, options);\n\t\t\tvar instance = new widget.WidgetClass(node, instanceOptions);\n\n\t\t\tthis.widgets.push({ node: node, name: name, instance: instance });\n\n\t\t\treturn instance;\n\t\t}\n\n\t\tremoveWidgets(by, value) {\n\t\t\tthis.widgets = this.widgets.filter(widget => {\n\t\t\t\tvar matches = widget[by] === value;\n\t\t\t\tif (matches) {\n\t\t\t\t\twidget.instance.dispose();\n\t\t\t\t}\n\t\t\t\treturn !matches;\n\t\t\t});\n\t\t}\n\n\t\t////\n\t\t// SCRIPTS\n\t\t//\n\n\t\trunScript(script, context) {\n\t\t\treturn new Promise(resolve => {\n\t\t\t\t// If script looks like JSON then decode, e.g: when encoded by {{on}} or {{script}}\n\t\t\t\tvar scriptContext;\n\t\t\t\tif (script.indexOf('[\"') === 0) {\n\t\t\t\t\t[ script, scriptContext ] = JSON.parse(script);\n\t\t\t\t}\n\n\t\t\t\t// Combine a ref to this app, the app's properties, the script and the run context\n\t\t\t\tcontext = ptv.extend({ app: this }, this, scriptContext, context);\n\n\t\t\t\tresolve(util.eval(script, context));\n\t\t\t});\n\t\t}\n\n\t\t////\n\t\t// NODE BINDINGS (EVENT AND WIDGET)\n\t\t//\n\n\t\tonNodeAdded(node) {\n\t\t\tvar widgets = node.getAttribute('widgets');\n\t\t\tif (widgets) {\n\t\t\t\t// If widgets looks like JSON then decode them (e.g: encoded by {{widgets}})\n\t\t\t\t// Otherwise this is parsed as a space separated array of widget name strings\n\t\t\t\twidgets = widgets.indexOf('[[\"') === 0 ? JSON.parse(widgets) :\n\t\t\t\t\twidgets.split(/\\s+/).map(name => [ name, {} ]);\n\t\t\t\twidgets.forEach(widget => {\n\t\t\t\t\tvar [ name, options ] = widget;\n\t\t\t\t\tthis.instantiateWidget(node, name, options);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// TODO: Add these listeners before node is added to DOM\n\t\t\t// E.g: So that this is available on Polymer attached() callback\n\t\t\t// Note: View will have to provide an additional type of listeners? (e.g: nodeAddListeners)\n\t\t\t// Better/simpler yet, would it be OK for EffectsController to be notified at that moment as well?\n\t\t\tArray.from(node.attributes || []).forEach(attribute => {\n\t\t\t\tvar matches = attribute.name.match(/on-(.*)/);\n\t\t\t\tif (!matches) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tvar type = matches[1];\n\n\t\t\t\tvar runScript = function(event) {\n\t\t\t\t\tvar context = { node: node, event: event };\n\t\t\t\t\tthis.runScript(attribute.value, context).catch(error => this.onError(error));\n\t\t\t\t}.bind(this);\n\n\t\t\t\t// Note: With special cases node-added/remove no event listener is added\n\t\t\t\tif (type === 'node-added') {\n\t\t\t\t\trunScript();\n\t\t\t\t} else if (type === 'node-remove') {\n\t\t\t\t\tnode.onNodeRemove = runScript;\n\t\t\t\t} else {\n\t\t\t\t\tevent.addListener(node, type, runScript);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tonNodeRemove(node) {\n\t\t\tvar runScript = node.onNodeRemove;\n\t\t\tif (runScript) {\n\t\t\t\trunScript();\n\t\t\t}\n\n\t\t\tthis.removeWidgets('node', node);\n\t\t}\n\n\t\t////\n\t\t// CONTROLLER HELPERS (ASYNC)\n\t\t//\n\n\t\t// Generic async get method, mostly aimed at being used to get a controller reference\n\t\tget(name, timeout = 10000) {\n\t\t\tvar controller = this[name];\n\t\t\tif (controller) {\n\t\t\t\treturn Cancellable.resolve(controller);\n\t\t\t}\n\n\t\t\tvar cancellable = this.when(name);\n\n\t\t\tif (timeout) {\n\t\t\t\tcancellable.setTimeout(timeout);\n\t\t\t}\n\n\t\t\treturn cancellable;\n\t\t}\n\n\t\tseek(path) {\n\t\t\tvar head = util.getPathHead(path);\n\t\t\tvar tail = util.getPathTail(path);\n\t\t\treturn this.get(head).then(controller => controller.seek(tail));\n\t\t}\n\n\t\t// Callback handler with value and path on controller add and subsequent value changes.\n\t\tobserve(path, handler) {\n\t\t\tthis.seek(path).then(value => handler(value, path));\n\t\t\treturn this.subscribe(path, value => handler(value, path));\n\t\t}\n\n\t\tunobserve(subscription) {\n\t\t\treturn this.unsubscribe(subscription);\n\t\t}\n\n\t\tcall(path) {\n\t\t\tvar args = Array.from(arguments).slice(1);\n\t\t\treturn this.get(util.getPathHead(path)).then(controller => {\n\t\t\t\tvar method = controller[util.getPathTail(path)];\n\t\t\t\tif (!method) {\n\t\t\t\t\tthrow new Error('Method not found: ' + path);\n\t\t\t\t}\n\t\t\t\treturn method.apply(controller, args);\n\t\t\t});\n\t\t}\n\n\t\t////\n\t\t// APP HELPERS\n\t\t//\n\n\t\t/**\n\t\t * If target is truthy then this delegates to popup().\n\t\t * Otherwise the window location is changed to specified URL.\n\t\t *\n\t\t * @param {string} url\n\t\t * @param {string} [target]\n\t\t * @param {Object} [options]\n\t\t */\n\t\topen(url, target, options) {\n\t\t\tif (target) {\n\t\t\t\treturn this.popup(url, target, options);\n\t\t\t}\n\n\t\t\twindow.location = url;\n\t\t}\n\n\t\t/**\n\t\t * Adds on-click=\"event.preventDefault(); app.open(node.href, '${target}')\" to anchors of (3rd party) HTML.\n\t\t * That in turn can go through popup() which can be overridden to use certain Native Wrapper commands etc.\n\t\t *\n\t\t * @param {string} html HTML to openify\n\t\t * @param {Object} [options]\n\t\t * @param {string} [options.target=''] Target to open openified anchor links in\n\t\t * @returns {string} Openified version of html\n\t\t */\n\t\topenify(html, options) {\n\t\t\tvar { target } = ptv.params(options, { target: '' });\n\t\t\treturn html && html.replace(/<a /g,\n\t\t\t\t`<a on-click=\"event.preventDefault(); app.open(node.href, '${target}')\" `\n\t\t\t);\n\t\t}\n\n\t\t/**\n\t\t * Opens url with window.open (through playtotv.util.popup) and returns Window reference.\n\t\t *\n\t\t * If you are using NativeController you will want to override this method and delegate to it's popup method.\n\t\t *\n\t\t * @param {string} url\n\t\t * @param {string} [target]\n\t\t * @param {Object} [options]\n\t\t * @param {Object} [options.width=0]\n\t\t * @param {Object} [options.height=0]\n\t\t * @returns {Window}\n\t\t */\n\t\tpopup(url, target, options) {\n\t\t\tvar { width, height } = ptv.params(options, { width: 0, height: 0 });\n\t\t\treturn util.popup(url, target, { width: width, height: height });\n\t\t}\n\n\t\t/**\n\t\t * Go back to previous url using window history.\n\t\t */\n\t\tback() {\n\t\t\t// Note: Android does not seem to support window.history.back(), hence the history.go(-1)\n\t\t\twindow.history.go(-1);\n\t\t}\n\n\t\t/**\n\t\t * Reloads this app at it's current location.\n\t\t */\n\t\treload() {\n\t\t\twindow.location.reload(true);\n\t\t}\n\n\t\t/**\n\t\t * Clears storage and then reloads to make a clean app start.\n\t\t */\n\t\treset() {\n\t\t\tthis.storage.clear().finally(() => this.reload());\n\t\t}\n\n\t\t// You can override this so as to ignore exceptions if ('__ENV__' === production) and then pray it will be ok.\n\t\t// Most of the time, things will indeed be fine, but other times the client might get completely stuck\n\t\t// (e.g: with no way out other then hard killing the native wrapper app).\n\t\t// So yeah, only do that if the customer insists and only do that on production.\n\t\tonError(error) {\n\t\t\tlog.e(error);\n\t\t\tif (window.confirm(error.name + ': ' + error.message + '.\n\nPress OK to reload and try again.')) {\n\t\t\t\twindow.location.reload(true);\n\t\t\t}\n\t\t}\n\n\t\t////\n\t\t// DISPOSE\n\t\t//\n\n\t\tdispose() {\n\t\t\tthis.widgets.forEach(widget => widget.dispose());\n\n\t\t\tthis.pauseDog.dispose();\n\n\t\t\tthis.view.dispose();\n\n\t\t\tif (this.touchCaptured) {\n\t\t\t\ttouchManager.releaseEvents(document);\n\t\t\t}\n\n\t\t\tthis.router.dispose();\n\n\t\t\tsuper();\n\t\t}\n\t};\n});\n",
		"/**\n * Auto generated API: <tt>src/twitter/twitter-api.js</tt>\n *\n * <b>DO NOT MODIFY! CHANGES WILL BE OVERWRITTEN THE NEXT TIME YOU UPDATE!</b>\n *\n * <b>Note:</b> These are not real functions but method definitions for\n * {@link playtotv.server.Server#call}.\n *\n * @name twitterAPI\n * @memberOf playtotv.twitter\n * @namespace\n */\nplaytotv.define('playtotv.twitter.twitterAPI', [], function() {\n\n\t'use strict';\n\n\treturn {\n\t\t/*jshint maxlen:300*/ // On occassion generated lines can be too long\n\n\t\t/** @lends playtotv.twitter.twitterAPI */\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>tweetId</b></li>\n\t\t * <li><i>{number}</i> <b>createdAt</b></li>\n\t\t * <li><i>{string}</i> <b>text</b></li>\n\t\t * <li><i>{TwitterUser}</i> <b>user</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @returns {Promise} Promise of response data (TweetDTO)\n\t\t */\n\t\tgetRecentTweets: {\n\t\t\tlabel: 'twitter.getRecentTweets',\n\t\t\turl: '1/twitter/recent'\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.twitter.TwitterController', [\n\t'playtotv.mvc.Controller',\n\t'playtotv.twitter.twitterAPI'\n], function(\n\tController,\n\ttwitterAPI\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar util = ptv.util;\n\n\treturn class TwitterController extends Controller {\n\t\t/** @lends playtotv.twitter.TwitterController.prototype */\n\n\t\t/**\n\t\t * Generic controller that facilitates displaying a stream of tweets and tweeting etc.\n\t\t *\n\t\t * Uses Controller storage and then {@link playtotv.twitter.twitterAPI.getRecentTweets} to get tweets.\n\t\t * Also see that method for a specification of tweet object properties.\n\t\t *\n\t\t * Uses Twitter Streaming API tweets being distributed as PlayToTV events by our servers to update tweets.\n\t\t * This subscribes to push.TWITTER-POST events on scope that can be provided by\n\t\t * {@link playtotv.push.PushController}.\n\t\t *\n\t\t * @extends playtotv.mvc.Controller\n\t\t * @constructs\n\t\t * @param {Object} context\n\t\t * @param {number} [options.maxItems=25] Maximum number of items to keep in tweets list\n\t\t */\n\t\tconstructor(context, options) {\n\t\t\toptions = ptv.params(options, {\n\t\t\t\tmaxItems: 25\n\t\t\t});\n\n\t\t\tvar stored = context.stored || {};\n\t\t\tsuper(context, {\n\t\t\t\tmodel: {\n\t\t\t\t\ttweets: stored.tweets || []\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.addMethods([\n\t\t\t\t'getTweetParts',\n\t\t\t\t'intent'\n\t\t\t]);\n\n\t\t\tthis.maxItems = options.maxItems;\n\n\t\t\t// Fetch current list of Tweets\n\t\t\tthis.scope.call('server.call', twitterAPI.getRecentTweets, {\n\t\t\t\t// max: maxItems // TODO: not yet supported by server\n\t\t\t}).then(tweets => {\n\t\t\t\tthis.cap(tweets);\n\t\t\t\tthis.set('tweets', tweets);\n\n\t\t\t\t// And from this point on keep up-to-date by push events\n\t\t\t\tthis.scope.subscribe('push.TWITTER-POST', event => this.addTweet(event.payload));\n\t\t\t});\n\t\t}\n\n\t\tcap(tweets) {\n\t\t\ttweets.length = Math.min(tweets.length, this.maxItems);\n\t\t}\n\n\t\taddTweet(tweet) {\n\t\t\tvar tweets = this.model.tweets;\n\t\t\ttweets.unshift(tweet);\n\t\t\tthis.cap(tweets);\n\t\t\t// Note: We forego publishing here since we got here from a push.TWITTER-POST publish\n\t\t\t// this.publish('tweets-add', tweet);\n\t\t}\n\n\t\t/**\n\t\t * Returns array of parts of text with different types.\n\t\t *\n\t\t * Each part is an object with properties:\n\t\t * <ul>\n\t\t * <li>type - text/url/mention/hash\n\t\t * <li>text - text of part\n\t\t * <li>[match] - specific match of part text (e.g: without hash # or mention @ prefix)\n\t\t * </ul>\n\t\t *\n\t\t * @param {string} text Tweet text to split up\n\t\t * @returns {[Object]} Tweet text parts\n\t\t */\n\t\tgetTweetParts(text) {\n\t\t\tvar part = [\n\t\t\t\t{ type: 'url', regex: new RegExp(util.URL_REGEXP.source) }, // non-global copy of URL_REGEXP\n\t\t\t\t{ type: 'mention', regex: /@(\\w+)/ },\n\t\t\t\t{ type: 'hash', regex: /#(\\w+)/ }\n\t\t\t].reduce(function(part, test) {\n\t\t\t\tvar matches = test.regex.exec(text);\n\t\t\t\treturn matches && (part.type === 'text' || matches.index < part.index) ? {\n\t\t\t\t\tindex: matches.index,\n\t\t\t\t\ttype: test.type,\n\t\t\t\t\ttext: matches[0],\n\t\t\t\t\tmatch: matches[1]\n\t\t\t\t} : part;\n\t\t\t}, { index: 0, type: 'text', text: text });\n\n\t\t\tvar parts = [ part ];\n\n\t\t\tvar index = part.index;\n\t\t\tif (index > 0) {\n\t\t\t\tparts.unshift({ type: 'text', text: text.substr(0, index) });\n\t\t\t}\n\n\t\t\tvar tail = text.substr(index + part.text.length);\n\t\t\treturn tail ? parts.concat(this.getTweetParts(tail)) : parts;\n\t\t}\n\n\t\t/**\n\t\t * Opens intent with specified type and options in a fitting popup through scope.\n\t\t *\n\t\t * @example\n\t\t * <a href=\"#\" {{rels (rel \"twitter-intent\" \"tweet\" text=\"Tweet tweet!\")}}>\n\t\t * Will open: https://twitter.com/intent/tweet?text=Tweet%20tweet!\n\t\t *\n\t\t * @param {string} type\n\t\t * @param {Object} [options]\n\t\t */\n\t\tintent(type, options) {\n\t\t\tvar url = util.addURLParams('https://twitter.com/intent/' + type, options);\n\t\t\tthis.scope.open(url, 'twitter-intent', { width: 550, height: 420 });\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.user.User', [\n\t'playtotv.model.ObjectModel'\n], function(\n\tObjectModel\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\n\treturn new ptv.Class({\n\t\t/** @lends playtotv.user.User.prototype */\n\n\t\textend: ObjectModel,\n\n\t\t/**\n\t\t * User data model class.\n\t\t *\n\t\t * @extends playtotv.model.ObjectModel\n\t\t * @constructs\n\t\t * @param {playtotv.server.Server} server Server\n\t\t * @param {Object} data User data to initialize with\n\t\t * @param {string} data.id User id\n\t\t * @param {string} [data.displayName] User name\n\t\t * @param {string} [data.avatarUrl] User avatar URL\n\t\t * @param {Object} [data.profileProperties={}] User profile property map\n\t\t *\n\t\t * @property {playtotv.server.Server} server Server\n\t\t * @property {string} id User id\n\t\t * @property {string} displayName User name\n\t\t * @property {string} avatarUrl User avatar URL\n\t\t * @property {playtotv.model.ObjectModel} profileProperties User profile property map\n\t\t */\n\t\tinitialize: function(server, data) {\n\t\t\tthis.server = server;\n\n\t\t\tptv.params(data, {\n\t\t\t\tid: ptv.REQUIRED,\n\t\t\t\tdisplayName: undefined,\n\t\t\t\tavatarUrl: undefined,\n\t\t\t\tprofileProperties: {}\n\t\t\t});\n\n\t\t\tthis._super({\n\t\t\t\tid: data.id,\n\t\t\t\tdisplayName: data.displayName,\n\t\t\t\tavatarUrl: data.avatarUrl,\n\t\t\t\tprofileProperties: new ObjectModel(data.profileProperties)\n\t\t\t});\n\t\t},\n\n\t\t/** Dispose */\n\t\tdispose: function() {\n\t\t\tthis.profileProperties.dispose();\n\t\t\tObjectModel.prototype.dispose.call(this);\n\t\t}\n\t});\n});\n",
		"/**\n * Auto generated API: <tt>src/user/users-api.js</tt>\n *\n * <b>DO NOT MODIFY! CHANGES WILL BE OVERWRITTEN THE NEXT TIME YOU UPDATE!</b>\n *\n * <b>Note:</b> These are not real functions but method definitions for\n * {@link playtotv.server.Server#call}.\n *\n * @name usersAPI\n * @memberOf playtotv.user\n * @namespace\n */\nplaytotv.define('playtotv.user.usersAPI', [], function() {\n\n\t'use strict';\n\n\treturn {\n\t\t/*jshint maxlen:300*/ // On occassion generated lines can be too long\n\n\t\t/** @lends playtotv.user.usersAPI */\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>authenticationToken</b></li>\n\t\t * <li><i>{string}</i> <b>avatarUrl</b></li>\n\t\t * <li><i>{string}</i> <b>displayName</b></li>\n\t\t * <li><i>{string}</i> <b>pttvSession</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * <li><i>{LoginCredentialStatusDTO}</i> <b>loginCredentialStatus</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>email</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * <li><i>{string}</i> <b>username</b></li>\n\t\t * <li><i>{string}</i> <b>facebookId</b></li>\n\t\t * <li><i>{IdDataDoc}</i> <b>externalIds</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>id</b></li>\n\t\t * <li><i>{Date}</i> <b>added</b></li>\n\t\t * </ul></li>\n\t\t * <li><i>{string}</i> <b>authenticationToken</b></li>\n\t\t * </ul></li>\n\t\t * <li><i>{ClientUserProfileDTO}</i> <b>profile</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>profileProperties</b></li>\n\t\t * <li><i>{string}</i> <b>privateProperties</b></li>\n\t\t * <li><i>{string}</i> <b>displayName</b></li>\n\t\t * <li><i>{string}</i> <b>avatarUrl</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * </ul></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.email\n\t\t * @param {string} params.password\n\t\t * @returns {Promise} Promise of response data (RegisterResponseDTO)\n\t\t */\n\t\taddEmailCredentials: {\n\t\t\tlabel: 'users.addEmailCredentials',\n\t\t\turl: '1/users/credentials/email',\n\t\t\ttype: 'POST',\n\t\t\tdataKeys: [\n\t\t\t\t'email',\n\t\t\t\t'password'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {ExternalIdType} params.type Valid values: 'FACEBOOK', 'VK'\n\t\t * @param {string} params.externalId\n\t\t * @param {string} params.signature\n\t\t * @returns {Promise} Promise of response data (Object)\n\t\t */\n\t\taddExternalIdCredentials: {\n\t\t\tlabel: 'users.addExternalIdCredentials',\n\t\t\turl: '1/users/credentials/type/{type}',\n\t\t\ttype: 'POST',\n\t\t\tdataKeys: [\n\t\t\t\t'externalId',\n\t\t\t\t'signature'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.facebookId\n\t\t * @param {string} params.fbsr\n\t\t * @returns {Promise} Promise of response data (Object)\n\t\t */\n\t\taddFacebookCredentials: {\n\t\t\tlabel: 'users.addFacebookCredentials',\n\t\t\turl: '1/users/credentials/facebook',\n\t\t\ttype: 'POST',\n\t\t\tdataKeys: [\n\t\t\t\t'facebookId',\n\t\t\t\t'fbsr'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.oldPassword\n\t\t * @param {string} params.newPassword\n\t\t * @returns {Promise} Promise of response data (Object)\n\t\t */\n\t\tchangePassword: {\n\t\t\tlabel: 'users.changePassword',\n\t\t\turl: '1/users/credentials/changepassword',\n\t\t\ttype: 'POST',\n\t\t\tdataKeys: [\n\t\t\t\t'oldPassword',\n\t\t\t\t'newPassword'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.email\n\t\t * @returns {Promise} Promise of response data (Object)\n\t\t */\n\t\tgeneratePassword: {\n\t\t\tlabel: 'users.generatePassword',\n\t\t\turl: '1/users/credentials/generatepassword/email/{email}',\n\t\t\ttype: 'PUT'\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>email</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * <li><i>{string}</i> <b>username</b></li>\n\t\t * <li><i>{string}</i> <b>facebookId</b></li>\n\t\t * <li><i>{IdDataDoc}</i> <b>externalIds</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>id</b></li>\n\t\t * <li><i>{Date}</i> <b>added</b></li>\n\t\t * </ul></li>\n\t\t * <li><i>{string}</i> <b>authenticationToken</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @returns {Promise} Promise of response data (LoginCredentialStatusDTO)\n\t\t */\n\t\tgetLoginCredentialStatus: {\n\t\t\tlabel: 'users.getLoginCredentialStatus',\n\t\t\turl: '1/users/loginCredentialStatus'\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>value</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.propertyName\n\t\t * @returns {Promise} Promise of response data (ProfilePropertyValueDTO)\n\t\t */\n\t\tgetPrivateProperty: {\n\t\t\tlabel: 'users.getPrivateProperty',\n\t\t\turl: '1/users/profile/{propertyName}/private'\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>profileProperties</b></li>\n\t\t * <li><i>{string}</i> <b>privateProperties</b></li>\n\t\t * <li><i>{string}</i> <b>displayName</b></li>\n\t\t * <li><i>{string}</i> <b>avatarUrl</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} [params.userId]\n\t\t * @returns {Promise} Promise of response data (ClientUserProfileDTO)\n\t\t */\n\t\tgetProfile: {\n\t\t\tlabel: 'users.getProfile',\n\t\t\turl: '1/users/profile',\n\t\t\tqueryKeys: [\n\t\t\t\t'userId'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>value</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.propertyName\n\t\t * @param {string} [params.userId]\n\t\t * @returns {Promise} Promise of response data (ProfilePropertyValueDTO)\n\t\t */\n\t\tgetProfileProperty: {\n\t\t\tlabel: 'users.getProfileProperty',\n\t\t\turl: '1/users/profile/{propertyName}',\n\t\t\tqueryKeys: [\n\t\t\t\t'userId'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>displayName</b></li>\n\t\t * <li><i>{string}</i> <b>avatarUrl</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} [params.userIds]\n\t\t * @returns {Promise} Promise of response data (ClientUserDTO)\n\t\t */\n\t\tgetUsers: {\n\t\t\tlabel: 'users.getUsers',\n\t\t\turl: '1/users/',\n\t\t\tqueryKeys: [\n\t\t\t\t'userIds'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>authenticationToken</b></li>\n\t\t * <li><i>{string}</i> <b>avatarUrl</b></li>\n\t\t * <li><i>{string}</i> <b>displayName</b></li>\n\t\t * <li><i>{string}</i> <b>pttvSession</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * <li><i>{LoginCredentialStatusDTO}</i> <b>loginCredentialStatus</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>email</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * <li><i>{string}</i> <b>username</b></li>\n\t\t * <li><i>{string}</i> <b>facebookId</b></li>\n\t\t * <li><i>{IdDataDoc}</i> <b>externalIds</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>id</b></li>\n\t\t * <li><i>{Date}</i> <b>added</b></li>\n\t\t * </ul></li>\n\t\t * <li><i>{string}</i> <b>authenticationToken</b></li>\n\t\t * </ul></li>\n\t\t * <li><i>{ClientUserProfileDTO}</i> <b>profile</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>profileProperties</b></li>\n\t\t * <li><i>{string}</i> <b>privateProperties</b></li>\n\t\t * <li><i>{string}</i> <b>displayName</b></li>\n\t\t * <li><i>{string}</i> <b>avatarUrl</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * </ul></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.authenticationToken\n\t\t * @param {string} [params.runtimeId]\n\t\t * @returns {Promise} Promise of response data (RegisterResponseDTO)\n\t\t */\n\t\tloginByAuthenticationToken: {\n\t\t\tlabel: 'users.loginByAuthenticationToken',\n\t\t\turl: '1/users/usersessions/authenticationToken',\n\t\t\ttype: 'POST',\n\t\t\tqueryKeys: [\n\t\t\t\t'runtimeId'\n\t\t\t],\n\t\t\tdataKeys: [\n\t\t\t\t'authenticationToken'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>authenticationToken</b></li>\n\t\t * <li><i>{string}</i> <b>avatarUrl</b></li>\n\t\t * <li><i>{string}</i> <b>displayName</b></li>\n\t\t * <li><i>{string}</i> <b>pttvSession</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * <li><i>{LoginCredentialStatusDTO}</i> <b>loginCredentialStatus</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>email</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * <li><i>{string}</i> <b>username</b></li>\n\t\t * <li><i>{string}</i> <b>facebookId</b></li>\n\t\t * <li><i>{IdDataDoc}</i> <b>externalIds</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>id</b></li>\n\t\t * <li><i>{Date}</i> <b>added</b></li>\n\t\t * </ul></li>\n\t\t * <li><i>{string}</i> <b>authenticationToken</b></li>\n\t\t * </ul></li>\n\t\t * <li><i>{ClientUserProfileDTO}</i> <b>profile</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>profileProperties</b></li>\n\t\t * <li><i>{string}</i> <b>privateProperties</b></li>\n\t\t * <li><i>{string}</i> <b>displayName</b></li>\n\t\t * <li><i>{string}</i> <b>avatarUrl</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * </ul></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.email\n\t\t * @param {string} params.password\n\t\t * @param {Boolean} params.rememberMe\n\t\t * @param {string} [params.runtimeId]\n\t\t * @returns {Promise} Promise of response data (RegisterResponseDTO)\n\t\t */\n\t\tloginByEmail: {\n\t\t\tlabel: 'users.loginByEmail',\n\t\t\turl: '1/users/usersessions/email',\n\t\t\ttype: 'POST',\n\t\t\tqueryKeys: [\n\t\t\t\t'runtimeId'\n\t\t\t],\n\t\t\tdataKeys: [\n\t\t\t\t'email',\n\t\t\t\t'password',\n\t\t\t\t'rememberMe'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * <b>Request DTO's:</b>\n\t\t * <ul>\n\t\t * <li><i>{OptionalRegistrationValuesDTO}</i> <b>optionalValues</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>properties</b></li>\n\t\t * <li><i>{string}</i> <b>privateProperties</b></li>\n\t\t * </ul></li>\n\t\t * </ul>\n\t\t *\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>authenticationToken</b></li>\n\t\t * <li><i>{string}</i> <b>avatarUrl</b></li>\n\t\t * <li><i>{string}</i> <b>displayName</b></li>\n\t\t * <li><i>{string}</i> <b>pttvSession</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * <li><i>{LoginCredentialStatusDTO}</i> <b>loginCredentialStatus</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>email</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * <li><i>{string}</i> <b>username</b></li>\n\t\t * <li><i>{string}</i> <b>facebookId</b></li>\n\t\t * <li><i>{IdDataDoc}</i> <b>externalIds</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>id</b></li>\n\t\t * <li><i>{Date}</i> <b>added</b></li>\n\t\t * </ul></li>\n\t\t * <li><i>{string}</i> <b>authenticationToken</b></li>\n\t\t * </ul></li>\n\t\t * <li><i>{ClientUserProfileDTO}</i> <b>profile</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>profileProperties</b></li>\n\t\t * <li><i>{string}</i> <b>privateProperties</b></li>\n\t\t * <li><i>{string}</i> <b>displayName</b></li>\n\t\t * <li><i>{string}</i> <b>avatarUrl</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * </ul></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {ExternalIdType} params.type Valid values: 'FACEBOOK', 'VK'\n\t\t * @param {string} params.externalId\n\t\t * @param {string} params.signature\n\t\t * @param {string} params.displayName\n\t\t * @param {string} params.avatarUrl\n\t\t * @param {OptionalRegistrationValuesDTO} params.optionalValues\n\t\t * @param {string} [params.runtimeId]\n\t\t * @returns {Promise} Promise of response data (RegisterResponseDTO)\n\t\t */\n\t\tloginByExternalId: {\n\t\t\tlabel: 'users.loginByExternalId',\n\t\t\turl: '1/users/usersessions/externalId',\n\t\t\ttype: 'POST',\n\t\t\tqueryKeys: [\n\t\t\t\t'runtimeId'\n\t\t\t],\n\t\t\tdataKeys: [\n\t\t\t\t'type',\n\t\t\t\t'externalId',\n\t\t\t\t'signature',\n\t\t\t\t'displayName',\n\t\t\t\t'avatarUrl',\n\t\t\t\t'optionalValues'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * <b>Request DTO's:</b>\n\t\t * <ul>\n\t\t * <li><i>{OptionalRegistrationValuesDTO}</i> <b>optionalValues</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>properties</b></li>\n\t\t * <li><i>{string}</i> <b>privateProperties</b></li>\n\t\t * </ul></li>\n\t\t * </ul>\n\t\t *\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>authenticationToken</b></li>\n\t\t * <li><i>{string}</i> <b>avatarUrl</b></li>\n\t\t * <li><i>{string}</i> <b>displayName</b></li>\n\t\t * <li><i>{string}</i> <b>pttvSession</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * <li><i>{LoginCredentialStatusDTO}</i> <b>loginCredentialStatus</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>email</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * <li><i>{string}</i> <b>username</b></li>\n\t\t * <li><i>{string}</i> <b>facebookId</b></li>\n\t\t * <li><i>{IdDataDoc}</i> <b>externalIds</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>id</b></li>\n\t\t * <li><i>{Date}</i> <b>added</b></li>\n\t\t * </ul></li>\n\t\t * <li><i>{string}</i> <b>authenticationToken</b></li>\n\t\t * </ul></li>\n\t\t * <li><i>{ClientUserProfileDTO}</i> <b>profile</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>profileProperties</b></li>\n\t\t * <li><i>{string}</i> <b>privateProperties</b></li>\n\t\t * <li><i>{string}</i> <b>displayName</b></li>\n\t\t * <li><i>{string}</i> <b>avatarUrl</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * </ul></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.facebookId\n\t\t * @param {string} params.fbsr\n\t\t * @param {string} params.displayName\n\t\t * @param {string} params.avatarUrl\n\t\t * @param {OptionalRegistrationValuesDTO} params.optionalValues\n\t\t * @param {string} [params.runtimeId]\n\t\t * @returns {Promise} Promise of response data (RegisterResponseDTO)\n\t\t */\n\t\tloginByFacebook: {\n\t\t\tlabel: 'users.loginByFacebook',\n\t\t\turl: '1/users/usersessions/facebook',\n\t\t\ttype: 'POST',\n\t\t\tqueryKeys: [\n\t\t\t\t'runtimeId'\n\t\t\t],\n\t\t\tdataKeys: [\n\t\t\t\t'facebookId',\n\t\t\t\t'fbsr',\n\t\t\t\t'displayName',\n\t\t\t\t'avatarUrl',\n\t\t\t\t'optionalValues'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} [params.runtimeId]\n\t\t * @returns {Promise} Promise of response data (Object)\n\t\t */\n\t\tlogout: {\n\t\t\tlabel: 'users.logout',\n\t\t\turl: '1/users/usersessions/current',\n\t\t\ttype: 'DELETE',\n\t\t\tqueryKeys: [\n\t\t\t\t'runtimeId'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} [params.runtimeId]\n\t\t * @returns {Promise} Promise of response data (Object)\n\t\t */\n\t\tlogoutByPut: {\n\t\t\tlabel: 'users.logoutByPut',\n\t\t\turl: '1/users/usersessions/current/logout',\n\t\t\ttype: 'PUT',\n\t\t\tqueryKeys: [\n\t\t\t\t'runtimeId'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * <b>Request DTO's:</b>\n\t\t * <ul>\n\t\t * <li><i>{OptionalRegistrationValuesDTO}</i> <b>optionalValues</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>properties</b></li>\n\t\t * <li><i>{string}</i> <b>privateProperties</b></li>\n\t\t * </ul></li>\n\t\t * </ul>\n\t\t *\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>authenticationToken</b></li>\n\t\t * <li><i>{string}</i> <b>avatarUrl</b></li>\n\t\t * <li><i>{string}</i> <b>displayName</b></li>\n\t\t * <li><i>{string}</i> <b>pttvSession</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * <li><i>{LoginCredentialStatusDTO}</i> <b>loginCredentialStatus</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>email</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * <li><i>{string}</i> <b>username</b></li>\n\t\t * <li><i>{string}</i> <b>facebookId</b></li>\n\t\t * <li><i>{IdDataDoc}</i> <b>externalIds</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>id</b></li>\n\t\t * <li><i>{Date}</i> <b>added</b></li>\n\t\t * </ul></li>\n\t\t * <li><i>{string}</i> <b>authenticationToken</b></li>\n\t\t * </ul></li>\n\t\t * <li><i>{ClientUserProfileDTO}</i> <b>profile</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>profileProperties</b></li>\n\t\t * <li><i>{string}</i> <b>privateProperties</b></li>\n\t\t * <li><i>{string}</i> <b>displayName</b></li>\n\t\t * <li><i>{string}</i> <b>avatarUrl</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * </ul></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {OptionalRegistrationValuesDTO} params.optionalValues\n\t\t * @param {string} [params.runtimeId]\n\t\t * @returns {Promise} Promise of response data (RegisterResponseDTO)\n\t\t */\n\t\tregisterAsGuest: {\n\t\t\tlabel: 'users.registerAsGuest',\n\t\t\turl: '1/users/register/guest',\n\t\t\ttype: 'POST',\n\t\t\tqueryKeys: [\n\t\t\t\t'runtimeId'\n\t\t\t],\n\t\t\tdataKeys: [\n\t\t\t\t'optionalValues'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * <b>Request DTO's:</b>\n\t\t * <ul>\n\t\t * <li><i>{OptionalRegistrationValuesDTO}</i> <b>optionalValues</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>properties</b></li>\n\t\t * <li><i>{string}</i> <b>privateProperties</b></li>\n\t\t * </ul></li>\n\t\t * </ul>\n\t\t *\n\t\t * <b>Response data:</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>authenticationToken</b></li>\n\t\t * <li><i>{string}</i> <b>avatarUrl</b></li>\n\t\t * <li><i>{string}</i> <b>displayName</b></li>\n\t\t * <li><i>{string}</i> <b>pttvSession</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * <li><i>{LoginCredentialStatusDTO}</i> <b>loginCredentialStatus</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>email</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * <li><i>{string}</i> <b>username</b></li>\n\t\t * <li><i>{string}</i> <b>facebookId</b></li>\n\t\t * <li><i>{IdDataDoc}</i> <b>externalIds</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>id</b></li>\n\t\t * <li><i>{Date}</i> <b>added</b></li>\n\t\t * </ul></li>\n\t\t * <li><i>{string}</i> <b>authenticationToken</b></li>\n\t\t * </ul></li>\n\t\t * <li><i>{ClientUserProfileDTO}</i> <b>profile</b>\n\t\t * <ul>\n\t\t * <li><i>{string}</i> <b>profileProperties</b></li>\n\t\t * <li><i>{string}</i> <b>privateProperties</b></li>\n\t\t * <li><i>{string}</i> <b>displayName</b></li>\n\t\t * <li><i>{string}</i> <b>avatarUrl</b></li>\n\t\t * <li><i>{string}</i> <b>userId</b></li>\n\t\t * </ul></li>\n\t\t * </ul>\n\t\t *\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.displayName\n\t\t * @param {string} params.avatarUrl\n\t\t * @param {string} params.email\n\t\t * @param {string} params.username\n\t\t * @param {string} params.password\n\t\t * @param {OptionalRegistrationValuesDTO} params.optionalValues\n\t\t * @param {string} [params.runtimeId]\n\t\t * @returns {Promise} Promise of response data (RegisterResponseDTO)\n\t\t */\n\t\tregisterByEmail: {\n\t\t\tlabel: 'users.registerByEmail',\n\t\t\turl: '1/users/register/email',\n\t\t\ttype: 'POST',\n\t\t\tqueryKeys: [\n\t\t\t\t'runtimeId'\n\t\t\t],\n\t\t\tdataKeys: [\n\t\t\t\t'displayName',\n\t\t\t\t'avatarUrl',\n\t\t\t\t'email',\n\t\t\t\t'username',\n\t\t\t\t'password',\n\t\t\t\t'optionalValues'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {ExternalIdType} params.type Valid values: 'FACEBOOK', 'VK'\n\t\t * @returns {Promise} Promise of response data (Object)\n\t\t */\n\t\tremoveExternalId: {\n\t\t\tlabel: 'users.removeExternalId',\n\t\t\turl: '1/users/credentials/type/{type}',\n\t\t\ttype: 'DELETE'\n\t\t},\n\n\t\t/**\n\t\t * @function\n\t\t * @returns {Promise} Promise of response data (Object)\n\t\t */\n\t\tremoveFacebookCredentials: {\n\t\t\tlabel: 'users.removeFacebookCredentials',\n\t\t\turl: '1/users/credentials/facebook',\n\t\t\ttype: 'DELETE'\n\t\t},\n\n\t\t/**\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} [params.runtimeId]\n\t\t * @returns {Promise} Promise of response data (Object)\n\t\t */\n\t\trequestDeletion: {\n\t\t\tlabel: 'users.requestDeletion',\n\t\t\turl: '1/users/',\n\t\t\ttype: 'POST',\n\t\t\tqueryKeys: [\n\t\t\t\t'runtimeId'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.email\n\t\t * @returns {Promise} Promise of response data (Object)\n\t\t */\n\t\trequestEmailChange: {\n\t\t\tlabel: 'users.requestEmailChange',\n\t\t\turl: '1/users/email/{email}',\n\t\t\ttype: 'PUT'\n\t\t},\n\n\t\t/**\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.email\n\t\t * @returns {Promise} Promise of response data (Object)\n\t\t */\n\t\trequestPasswordChange: {\n\t\t\tlabel: 'users.requestPasswordChange',\n\t\t\turl: '1/users/credentials/changepassword/email/{email}',\n\t\t\ttype: 'PUT'\n\t\t},\n\n\t\t/**\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.reason\n\t\t * @param {string} [params.runtimeId]\n\t\t * @returns {Promise} Promise of response data (Object)\n\t\t */\n\t\tscheduleUserForDeletion: {\n\t\t\tlabel: 'users.scheduleUserForDeletion',\n\t\t\turl: '1/users/scheduled',\n\t\t\ttype: 'POST',\n\t\t\tqueryKeys: [\n\t\t\t\t'runtimeId'\n\t\t\t],\n\t\t\tdataKeys: [\n\t\t\t\t'reason'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.propertyName\n\t\t * @param {string} params.value\n\t\t * @returns {Promise} Promise of response data (Object)\n\t\t */\n\t\tsetPrivateProperty: {\n\t\t\tlabel: 'users.setPrivateProperty',\n\t\t\turl: '1/users/profile/{propertyName}/private',\n\t\t\ttype: 'PUT',\n\t\t\tdataKeys: [\n\t\t\t\t'value'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.propertyName\n\t\t * @param {string} params.value\n\t\t * @returns {Promise} Promise of response data (Object)\n\t\t */\n\t\tsetProfileProperty: {\n\t\t\tlabel: 'users.setProfileProperty',\n\t\t\turl: '1/users/profile/{propertyName}',\n\t\t\ttype: 'PUT',\n\t\t\tdataKeys: [\n\t\t\t\t'value'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.displayName\n\t\t * @param {string} params.avatarUrl\n\t\t * @param {string} params.properties\n\t\t * @param {string} params.privateProperties\n\t\t * @returns {Promise} Promise of response data (Object)\n\t\t */\n\t\tupdateProfile: {\n\t\t\tlabel: 'users.updateProfile',\n\t\t\turl: '1/users/profile',\n\t\t\ttype: 'PUT',\n\t\t\tdataKeys: [\n\t\t\t\t'displayName',\n\t\t\t\t'avatarUrl',\n\t\t\t\t'properties',\n\t\t\t\t'privateProperties'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.authenticationCode\n\t\t * @returns {Promise} Promise of response data (Object)\n\t\t */\n\t\tverifyEmail: {\n\t\t\tlabel: 'users.verifyEmail',\n\t\t\turl: '1/users/verifyemail',\n\t\t\ttype: 'POST',\n\t\t\tdataKeys: [\n\t\t\t\t'authenticationCode'\n\t\t\t]\n\t\t},\n\n\t\t/**\n\t\t * @function\n\t\t * @param {Object} params\n\t\t * @param {string} params.authenticationCode\n\t\t * @param {string} params.password\n\t\t * @returns {Promise} Promise of response data (Object)\n\t\t */\n\t\tverifyPasswordChange: {\n\t\t\tlabel: 'users.verifyPasswordChange',\n\t\t\turl: '1/users/password',\n\t\t\ttype: 'PUT',\n\t\t\tdataKeys: [\n\t\t\t\t'authenticationCode',\n\t\t\t\t'password'\n\t\t\t]\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.user.LocalUser', [\n\t'playtotv.model.ObjectModel',\n\t'playtotv.user.User',\n\t'playtotv.user.usersAPI'\n], function(\n\tObjectModel,\n\tUser,\n\tusersAPI\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\n\treturn new ptv.Class({\n\t\t/** @lends playtotv.user.LocalUser.prototype */\n\n\t\textend: User,\n\n\t\t/**\n\t\t * Local user data model class.\n\t\t *\n\t\t * @extends playtotv.user.User\n\t\t * @constructs\n\t\t * @param {playtotv.server.Server} server Server\n\t\t * @param {Object} user {@link playtotv.user.User} constructor data\n\t\t * @param {Object} [data] LocalUser data to initialize with\n\t\t * @param {Object} [data.privateProperties={}] LocalUser private property map\n\t\t * @param {string} [data.authenticationToken] LocalUser authentication token\n\t\t * @param {string} [data.pttvSession] LocalUser PlayToTV session token\n\t\t * @param {string} [data.email] LocalUser email\n\t\t * @param {string} [data.username] LocalUser username\n\t\t * @param {string} [data.facebookId] LocalUser Facebook ID\n\t\t *\n\t\t * @property {playtotv.storage.Storage} storage LocalUser storage\n\t\t * @property {playtotv.model.ObjectModel} privateProperties LocalUser private property map\n\t\t * @property {string} authenticationToken LocalUser authentication token\n\t\t * @property {string} pttvSession LocalUser PlayToTV session token\n\t\t * @property {string} email LocalUser email\n\t\t * @property {string} username LocalUser username\n\t\t * @property {string} facebookId LocalUser Facebook ID\n\t\t */\n\t\tinitialize: function(server, user, data) {\n\t\t\tdata = ptv.params(data, {\n\t\t\t\tprivateProperties: {},\n\t\t\t\tauthenticationToken: undefined,\n\t\t\t\tpttvSession: undefined,\n\t\t\t\temail: undefined,\n\t\t\t\tusername: undefined,\n\t\t\t\tfacebookId: undefined\n\t\t\t});\n\n\t\t\tthis._super(server, user);\n\n\t\t\tthis.storage = server.storage.subStorage('user/' + user.id + '/');\n\n\t\t\tthis.copyProperties({\n\t\t\t\tprivateProperties: new ObjectModel(data.privateProperties),\n\t\t\t\tauthenticationToken: data.authenticationToken,\n\t\t\t\tpttvSession: data.pttvSession,\n\t\t\t\temail: data.email,\n\t\t\t\tusername: data.username,\n\t\t\t\tfacebookId: data.facebookId\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Calls {@link playtotv.user.usersAPI.updateProfile} with this LocalUser's displayName,\n\t\t * avatarUrl, profileProperties and privateProperties.\n\t\t *\n\t\t * @returns {Promise} Promise of server response\n\t\t */\n\t\tupdateProfile: function() {\n\t\t\treturn this.server.call(usersAPI.updateProfile, {\n\t\t\t\tdisplayName: this.displayName || null,\n\t\t\t\tavatarUrl: this.avatarUrl || null,\n\t\t\t\tproperties: this.profileProperties.toObject(),\n\t\t\t\tprivateProperties: this.privateProperties.toObject()\n\t\t\t});\n\t\t},\n\n\t\t/** Dispose */\n\t\tdispose: function() {\n\t\t\tthis.privateProperties.dispose();\n\t\t\tUser.prototype.dispose.call(this);\n\t\t}\n\t});\n});\n",
		"playtotv.define('playtotv.user.UserController', [\n\t'playtotv.mvc.Controller',\n\t'playtotv.user.usersAPI'\n], function(\n\tController,\n\tusersAPI\n) {\n\n\t// Note: This just does automatic registerAsGuest and loginByAuthenticationToken for now\n\t// TODO: Complete this with manual (email, ..) login support and then remove UserManager, User and LocalUser\n\t// TODO: Add support for 463\n\t// TODO: Add support for 401 if necessary\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar log = ptv.Logger.get(this.id);\n\n\treturn class UserController extends Controller {\n\t\tconstructor(context) {\n\t\t\tvar stored = context.stored || {};\n\t\t\tsuper(context, {\n\t\t\t\tmodel: {\n\t\t\t\t\tcurrent: stored.current || null,\n\t\t\t\t\tonline: false\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.addMethods([\n\t\t\t\t'logout',\n\t\t\t\t'getPrivateProperty',\n\t\t\t\t'setPrivateProperty',\n\t\t\t\t'updateProfile',\n\t\t\t\t'extendPrivateProfile'\n\t\t\t]);\n\n\t\t\tthis.login();\n\t\t}\n\n\t\tloginBy(method, params) {\n\t\t\treturn this.scope.call('server.call', method, params).then(user => {\n\t\t\t\tthis.set('current', user);\n\n\t\t\t\t// Note: current user model property is persisted in storage for fast resume and offline support\n\t\t\t\t// Things depending on user being logged in for sure should wait for this\n\t\t\t\tthis.set('online', true);\n\n\t\t\t\treturn user;\n\t\t\t});\n\t\t}\n\n\t\tloginByToken() {\n\t\t\tvar user = this.model.current;\n\t\t\tvar authenticationToken = user && user.authenticationToken;\n\t\t\treturn !authenticationToken ? Promise.reject() :\n\t\t\t\tthis.loginBy(usersAPI.loginByAuthenticationToken, {\n\t\t\t\t\tauthenticationToken: authenticationToken\n\t\t\t\t});\n\t\t}\n\n\t\tregisterAsGuest() {\n\t\t\treturn this.loginBy(usersAPI.registerAsGuest, {\n\t\t\t\toptionalValues: null\n\t\t\t});\n\t\t}\n\n\t\tlogin() {\n\t\t\treturn this.loginByToken().catch(() => {\n\t\t\t\t// TODO: if mode is guest then registerAsGuest else set waiting true and wait for manual login\n\t\t\t\treturn this.registerAsGuest().catch(error => {\n\t\t\t\t\tlog.e('login(): registerAsGuest failed, retrying in 5s', error);\n\t\t\t\t\treturn Promise.delay(5000).then(() => this.login());\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tlogout() {\n\t\t\treturn this.scope.call('server.call', usersAPI.logout).finally(() => {\n\t\t\t\t// Reset (and reload) is a rough but simple solution to a rarely used feature\n\t\t\t\t// Makes the dealing with this easier for all controllers\n\t\t\t\tthis.scope.reset();\n\t\t\t});\n\t\t}\n\n\t\tgetPrivateProperty(name) {\n\t\t\tvar user = this.model.current;\n\t\t\treturn user && user.profile.privateProperties[name];\n\t\t}\n\n\t\tsetPrivateProperty(name, value) {\n\t\t\tvar user = this.model.current;\n\t\t\treturn this.scope.call('server.call', usersAPI.setPrivateProperty, {\n\t\t\t\tpropertyName: name,\n\t\t\t\tvalue: value\n\t\t\t}).then(() => {\n\t\t\t\tuser.profile.privateProperties[name] = value;\n\t\t\t\tthis.publish('set-private-property-' + name, value);\n\t\t\t});\n\t\t}\n\n\t\tupdateProfile(data) {\n\t\t\tvar user = this.model.current;\n\t\t\tdata = ptv.params(data, {\n\t\t\t\tdisplayName: user.displayName || null,\n\t\t\t\tavatarUrl: user.avatarUrl || null,\n\t\t\t\tproperties: user.profile.profileProperties,\n\t\t\t\tprivateProperties: user.profile.privateProperties\n\t\t\t});\n\t\t\treturn this.scope.call('server.call', usersAPI.updateProfile, data).then(() => {\n\t\t\t\tuser.displayName = data.displayName;\n\t\t\t\tuser.avatarUrl = data.avatarUrl;\n\t\t\t\tuser.profile.profileProperties = data.properties;\n\t\t\t\tuser.profile.privateProperties = data.privateProperties;\n\t\t\t\tthis.publish('update-profile', data);\n\t\t\t});\n\t\t}\n\n\t\textendPrivateProfile(properties) {\n\t\t\tvar user = this.model.current;\n\t\t\treturn this.updateProfile({\n\t\t\t\tprivateProperties: ptv.extend({}, user.profile.privateProperties, properties)\n\t\t\t});\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.user.UserManager', [\n\t'playtotv.pubsub.PubSub',\n\t'playtotv.user.LocalUser',\n\t'playtotv.user.usersAPI'\n], function(\n\tPubSub,\n\tLocalUser,\n\tusersAPI\n) {\n\n\t'use strict';\n\n\t// TODO: Check that is alright that we no longer bother about X-PlayToTV-Session header\n\t// TODO: Add: get(id) // get user from cache or server\n\n\tvar ptv = playtotv;\n\tvar REQUIRED = ptv.REQUIRED;\n\n\treturn new ptv.Class({\n\t\t/** @lends playtotv.user.UserManager.prototype */\n\n\t\textend: PubSub,\n\n\t\t/**\n\t\t * User manager class.\n\t\t *\n\t\t * <ul>\n\t\t * <li>Facilitates making registration, login and logout server calls.\n\t\t * <li>Will instantiate and keep track of a {@link playtotv.user.LocalUser} instance reference.\n\t\t * <li>Can also keep track of authentication token and method using {@link playtotv.server.Server#storage}.\n\t\t * <li>Will deal with user session expiry (e.g: status 463)\n\t\t * </ul>\n\t\t *\n\t\t * @extends playtotv.pubsub.PubSub\n\t\t * @constructs\n\t\t * @param {playtotv.server.Server} server Server\n\t\t *\n\t\t * @property {playtotv.server.Server} server Server\n\t\t * @property {playtotv.storage.Storage} storage Storage\n\t\t * @property {string} authenticationMethod Persisted last used authentication method\n\t\t * @property {string} authenticationToken Persisted authentication token\n\t\t * @property {playtotv.user.LocalUser} localUser Local user\n\t\t */\n\t\tinitialize: function(server) {\n\t\t\tthis._super();\n\n\t\t\tthis.server = server;\n\t\t\tvar storage = this.storage = server.storage;\n\t\t\tthis.authenticationMethod = storage.get('authenticationMethod');\n\t\t\tthis.authenticationToken = storage.get('authenticationToken');\n\t\t\tthis.localUser = null;\n\n\t\t\tserver.rejectTaps.push(this.onServerReject);\n\t\t},\n\n\t\t/**\n\t\t * Save authentication method and token and persist them in storage.\n\t\t *\n\t\t * @param {string} method Authentication method\n\t\t * @param {string} token Authentication token\n\t\t */\n\t\tsaveAuthentication: function(method, token) {\n\t\t\tthis.authenticationMethod = method;\n\t\t\tthis.storage.set('authenticationMethod', method);\n\t\t\tthis.authenticationToken = token;\n\t\t\tthis.storage.set('authenticationToken', token);\n\t\t},\n\n\t\t/**\n\t\t * Login with specified server method and params and then:\n\t\t * <ul>\n\t\t * <li>If we already have a local user reference then call {@link playtotv.user.UserManager#onLogout}\n\t\t * <li>Create a new LocalUser instance using the returned data and change local user reference to it\n\t\t * <li>Save and persist local user authentication token if remember is true\n\t\t * <li>Publish local user reference to 'login' channel\n\t\t * </ul>\n\t\t *\n\t\t * @param {Object} method Server call method\n\t\t * @param {Object} [params] Server call params\n\t\t * @param {boolean} [remember=false] Whether to save and persist authentication token for future logins\n\t\t * @returns {Promise} Promise of logged in {@link playtotv.user.LocalUser}\n\t\t */\n\t\tlogin: function(method, params, remember) {\n\t\t\treturn this.server.call(method, params).then(function(data) {\n\t\t\t\tvar token = data.authenticationToken;\n\t\t\t\tvar profile = data.profile || {};\n\t\t\t\tvar credentials = data.loginCredentialStatus || {};\n\n\t\t\t\tif (this.localUser) {\n\t\t\t\t\tthis.onLogout();\n\t\t\t\t}\n\n\t\t\t\tvar localUser = new LocalUser(this.server, {\n\t\t\t\t\tid: data.userId,\n\t\t\t\t\tdisplayName: data.displayName,\n\t\t\t\t\tavatarUrl: data.avatarUrl,\n\t\t\t\t\tprofileProperties: profile.profileProperties\n\t\t\t\t}, {\n\t\t\t\t\tprivateProperties: profile.privateProperties,\n\t\t\t\t\tauthenticationToken: token,\n\t\t\t\t\tpttvSession: data.pttvSession,\n\t\t\t\t\temail: credentials.email,\n\t\t\t\t\tusername: credentials.username,\n\t\t\t\t\tfacebookId: credentials.facebookId\n\t\t\t\t});\n\t\t\t\tthis.localUser = localUser;\n\n\t\t\t\tif (remember) {\n\t\t\t\t\tthis.saveAuthentication(method.label, token);\n\t\t\t\t}\n\n\t\t\t\tthis.publish('login', localUser);\n\n\t\t\t\treturn localUser;\n\t\t\t}.bind(this));\n\t\t},\n\n\t\t/**\n\t\t * Base server login and register call params.\n\t\t * @type {Object}\n\t\t */\n\t\tbaseParams: {\n\t\t\tdisplayName: null, // data key, so required, but not really required by server, so null\n\t\t\tavatarUrl: null, // data key, so required, but not really required by server, so null\n\t\t\truntimeId: undefined\n\t\t},\n\n\t\t/**\n\t\t * Optional server register call params.\n\t\t * @type {Object}\n\t\t */\n\t\toptionalParams: {\n\t\t\tteamTag: undefined,\n\t\t\temailOptinMode: undefined,\n\t\t\tproperties: undefined,\n\t\t\tprivateProperties: undefined\n\t\t},\n\n\t\t/**\n\t\t * Moves teamTag, emailOptinMode, properties and privateProperties into optionalValues sub params to match\n\t\t * request params structure expected by server.\n\t\t *\n\t\t * @param {Object} params Server register call params\n\t\t * @returns {Object} Server register call params with nested optionalValues\n\t\t */\n\t\tprocessParams: function(params) {\n\t\t\tvar optionalKeys = Object.keys(this.optionalParams);\n\t\t\tparams.optionalValues = ptv.pick(params, optionalKeys);\n\t\t\treturn ptv.omit(params, optionalKeys);\n\t\t},\n\n\t\t/**\n\t\t * Shortcut to {@link playtotv.user.UserManager#login} with\n\t\t * {@link playtotv.user.usersAPI.registerAsGuest}.\n\t\t *\n\t\t * @param {Object} [params] Parameters\n\t\t * @param {string} [params.displayName] Display name\n\t\t * @param {string} [params.avatarUrl] Avatar URL\n\t\t * @param {string} [params.runtimeId] Runtime ID\n\t\t * @param {string} [params.teamTag] Team tag\n\t\t * @param {string} [params.emailOptinMode] Email opt-in mode (UNDECIDED/OPTED_IN/OPTED_OUT)\n\t\t * @param {Object} [params.properties] Profile properties\n\t\t * @param {Object} [params.privateProperties] Private properties\n\t\t * @param {boolean} [remember=false] Whether to save and persist authentication token for future logins\n\t\t * @returns {Promise} Promise of logged in {@link playtotv.user.LocalUser}\n\t\t */\n\t\tregisterAsGuest: function(params, remember) {\n\t\t\tparams = ptv.params(params, ptv.extend({}, this.baseParams, this.optionalParams));\n\t\t\tparams = this.processParams(params);\n\t\t\treturn this.login(usersAPI.registerAsGuest, params, remember);\n\t\t},\n\n\t\t/**\n\t\t * Shortcut to {@link playtotv.user.UserManager#login} with\n\t\t * {@link playtotv.user.usersAPI.registerByEmail}.\n\t\t *\n\t\t * @param {Object} params Parameters\n\t\t * @param {string} params.email Email\n\t\t * @param {string} params.password Password\n\t\t * @param {string} [params.username] Username\n\t\t * @param {string} [params.displayName] Display name\n\t\t * @param {string} [params.avatarUrl] Avatar URL\n\t\t * @param {string} [params.runtimeId] Runtime ID\n\t\t * @param {string} [params.teamTag] Team tag\n\t\t * @param {string} [params.emailOptinMode] Email opt-in mode (UNDECIDED/OPTED_IN/OPTED_OUT)\n\t\t * @param {Object} [params.properties] Profile properties\n\t\t * @param {Object} [params.privateProperties] Private properties\n\t\t * @param {boolean} [remember=false] Whether to save and persist authentication token for future logins\n\t\t * @returns {Promise} Promise of logged in {@link playtotv.user.LocalUser}\n\t\t */\n\t\tregisterByEmail: function(params, remember) {\n\t\t\tparams = ptv.params(params, ptv.extend({\n\t\t\t\temail: REQUIRED,\n\t\t\t\tpassword: REQUIRED,\n\t\t\t\tusername: null // data key, so required, but not really required by server, so null\n\t\t\t}, this.baseParams, this.optionalParams));\n\t\t\tparams = this.processParams(params);\n\t\t\treturn this.login(usersAPI.registerByEmail, params, remember);\n\t\t},\n\n\t\t/**\n\t\t * Shortcut to {@link playtotv.user.UserManager#login} with\n\t\t * {@link playtotv.user.usersAPI.loginByEmail}.\n\t\t *\n\t\t * @param {Object} params Parameters\n\t\t * @param {string} params.email Email\n\t\t * @param {string} params.password Password\n\t\t * @param {boolean} [params.rememberMe=false] Cookie based remember-me (token is recommended instead)\n\t\t * @param {string} [params.displayName] Display name\n\t\t * @param {string} [params.avatarUrl] Avatar URL\n\t\t * @param {string} [params.runtimeId] Runtime ID\n\t\t * @param {boolean} [remember=false] Whether to save and persist authentication token for future logins\n\t\t * @returns {Promise} Promise of logged in {@link playtotv.user.LocalUser}\n\t\t */\n\t\tloginByEmail: function(params, remember) {\n\t\t\tparams = ptv.params(params, ptv.extend({\n\t\t\t\temail: REQUIRED,\n\t\t\t\tpassword: REQUIRED,\n\t\t\t\trememberMe: false\n\t\t\t}, this.baseParams));\n\t\t\treturn this.login(usersAPI.loginByEmail, params, remember);\n\t\t},\n\n\t\t/**\n\t\t * Shortcut to {@link playtotv.user.UserManager#login} with\n\t\t * {@link playtotv.user.usersAPI.loginByFacebook}.\n\t\t *\n\t\t * @param {Object} params Parameters\n\t\t * @param {string} params.facebookId Facebook ID\n\t\t * @param {string} params.fbsr Facebook signed request token\n\t\t * @param {string} [params.displayName] Display name\n\t\t * @param {string} [params.avatarUrl] Avatar URL\n\t\t * @param {string} [params.runtimeId] Runtime ID\n\t\t * @param {string} [params.teamTag] Team tag\n\t\t * @param {string} [params.emailOptinMode] Email opt-in mode (UNDECIDED/OPTED_IN/OPTED_OUT)\n\t\t * @param {Object} [params.properties] Profile properties\n\t\t * @param {Object} [params.privateProperties] Private properties\n\t\t * @param {boolean} [remember=false] Whether to save and persist authentication token for future logins\n\t\t * @returns {Promise} Promise of logged in {@link playtotv.user.LocalUser}\n\t\t */\n\t\tloginByFacebook: function(params, remember) {\n\t\t\tparams = ptv.params(params, ptv.extend({\n\t\t\t\tfacebookId: REQUIRED,\n\t\t\t\tfbsr: REQUIRED\n\t\t\t}, this.baseParams, this.optionalParams));\n\t\t\tparams = this.processParams(params);\n\t\t\treturn this.login(usersAPI.loginByFacebook, params, remember);\n\t\t},\n\n\t\t/**\n\t\t * Call {@link playtotv.user.usersAPI.addFacebookCredentials} on server.\n\t\t *\n\t\t * This will reject directly without making a server call in case this.localUser is undefined or in case\n\t\t * this.localUser.facebookId is already defined.\n\t\t *\n\t\t * If the call succeeds this.localUser's facebookId property is changed to specified facebookId.\n\t\t *\n\t\t * @param {Object} params Parameters\n\t\t * @param {string} params.facebookId Facebook ID\n\t\t * @param {string} params.fbsr Facebook signed request token\n\t\t * @returns {Promise} Promise of {@link playtotv.user.LocalUser}\n\t\t */\n\t\taddFacebookCredentials: function(params) {\n\t\t\tparams = ptv.params(params, {\n\t\t\t\tfacebookId: REQUIRED,\n\t\t\t\tfbsr: REQUIRED\n\t\t\t});\n\t\t\tvar localUser = this.localUser;\n\t\t\tif (!localUser) {\n\t\t\t\treturn Promise.reject(new Error('Not logged in'));\n\t\t\t}\n\t\t\tif (localUser.facebookId) {\n\t\t\t\treturn Promise.reject(new Error('Local user already has Facebook Id'));\n\t\t\t}\n\t\t\treturn this.server.call(usersAPI.addFacebookCredentials, params).then(function() {\n\t\t\t\tlocalUser.changeProperty('facebookId', params.facebookId);\n\t\t\t\treturn localUser;\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Call {@link playtotv.user.usersAPI.removeFacebookCredentials} on server.\n\t\t *\n\t\t * This will reject directly without making a server call in case this.localUser or this.localUser.facebookId\n\t\t * is undefined.\n\t\t *\n\t\t * If the call succeeds this.localUser's facebookId property is changed to undefined.\n\t\t *\n\t\t * @returns {Promise} Promise of {@link playtotv.user.LocalUser}\n\t\t */\n\t\tremoveFacebookCredentials: function() {\n\t\t\tvar localUser = this.localUser;\n\t\t\tif (!localUser) {\n\t\t\t\treturn Promise.reject(new Error('Not logged in'));\n\t\t\t}\n\t\t\tif (!localUser.facebookId) {\n\t\t\t\treturn Promise.reject(new Error('Local user does not have Facebook Id'));\n\t\t\t}\n\t\t\treturn this.server.call(usersAPI.removeFacebookCredentials).then(function() {\n\t\t\t\tlocalUser.changeProperty('facebookId', undefined);\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Shortcut to {@link playtotv.user.UserManager#login} with\n\t\t * {@link playtotv.user.usersAPI.loginByAuthenticationToken}.\n\t\t *\n\t\t * If params.authenticationToken and this.authenticationToken are both undefined this will reject directly\n\t\t * without making a server call.\n\t\t *\n\t\t * @param {Object} [params] Parameters\n\t\t * @param {string} [params.authenticationToken=this.authenticationToken] Authentication token\n\t\t * @param {boolean} [params.rememberMe=false] Cookie based remember-me (token is recommended instead)\n\t\t * @param {string} [params.displayName] Display name\n\t\t * @param {string} [params.avatarUrl] Avatar URL\n\t\t * @param {string} [params.runtimeId] Runtime ID\n\t\t * @returns {Promise} Promise of logged in {@link playtotv.user.LocalUser}\n\t\t */\n\t\tloginByToken: function(params) {\n\t\t\tparams = ptv.params(params, ptv.extend({\n\t\t\t\tauthenticationToken: this.authenticationToken\n\t\t\t}, this.baseParams));\n\t\t\treturn params.authenticationToken ?\n\t\t\t\tthis.login(usersAPI.loginByAuthenticationToken, params) :\n\t\t\t\tPromise.reject(new Error('Missing required parameter: authenticationToken'));\n\t\t},\n\n\t\t/**\n\t\t * Logout from server and optionally remove local user authentication token from instance and storage.\n\t\t *\n\t\t * @param {boolean} [forget=false] Whether to remove authentication token that was stored for future logins\n\t\t * @returns {Promise} Promise of logged out {@link playtotv.user.LocalUser}\n\t\t */\n\t\tlogout: function(forget) {\n\t\t\tif (forget) {\n\t\t\t\tthis.saveAuthentication(null, null);\n\t\t\t}\n\t\t\treturn this.server.call(usersAPI.logout).then(function() {\n\t\t\t\treturn this.onLogout();\n\t\t\t}.bind(this));\n\t\t},\n\n\t\t/**\n\t\t * Calls this.localUser.dispose and publishes localUser to 'logout' channel.\n\t\t *\n\t\t * If this.localUser is null then this simply returns null.\n\t\t *\n\t\t * @returns {playtotv.user.LocalUser} Logged out local user\n\t\t */\n\t\tonLogout: function() {\n\t\t\tvar localUser = this.localUser;\n\t\t\tif (localUser) {\n\t\t\t\tlocalUser.dispose();\n\t\t\t\tthis.localUser = null;\n\t\t\t\tthis.publish('logout', localUser);\n\t\t\t}\n\t\t\treturn localUser;\n\t\t},\n\n\t\t/**\n\t\t * User session expiry handler.\n\t\t *\n\t\t * <ul>\n\t\t * <li>Changes this.authenticationMethod and authenticationToken to null\n\t\t * <li>If this.localUser is defined it is published to 'expire'\n\t\t * <li>Calls {@link playtotv.user.UserManager#onLogout}\n\t\t * </ul>\n\t\t */\n\t\tonExpire: function() {\n\t\t\tvar localUser = this.localUser;\n\t\t\tthis.authenticationMethod = null;\n\t\t\tthis.authenticationToken = null;\n\t\t\tif (localUser) {\n\t\t\t\tthis.publish('expire', localUser);\n\t\t\t\tthis.onLogout();\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Server rejection tap handler.\n\t\t *\n\t\t * Calls {@link playtotv.user.UserManager#onExpire} if reason.status equals 463.\n\t\t *\n\t\t * TODO: Also facilitate handling of 401 and 403\n\t\t */\n\t\tonServerReject: function(reason) {\n\t\t\tif (reason.status === 463) {\n\t\t\t\tthis.onExpire();\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Dispose.\n\t\t */\n\t\tdispose: function() {\n\t\t\tvar rejectTaps = this.server.rejectTaps;\n\t\t\trejectTaps.splice(rejectTaps.indexOf(this.onServerReject), 1);\n\n\t\t\tvar localUser = this.localUser;\n\t\t\tif (localUser) {\n\t\t\t\tlocalUser.dispose();\n\t\t\t}\n\n\t\t\tPubSub.prototype.dispose.call(this);\n\t\t},\n\n\t\tcallbacks: [\n\t\t\t'onServerReject'\n\t\t]\n\t});\n});\n",
		"playtotv.define('playtotv.widget.CountdownWidget', [\n\t'playtotv.widget.Widget'\n], function(\n\tWidget\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar dom = ptv.dom;\n\tvar util = ptv.util;\n\n\treturn class CountdownWidget extends Widget {\n\n\t\tconstructor(node, options) {\n\t\t\tptv.params(options, {\n\t\t\t\tapp: null,\n\t\t\t\ttime: ptv.REQUIRED\n\t\t\t});\n\n\t\t\tsuper(node);\n\n\t\t\tthis.time = options.time;\n\n\t\t\tthis.dd = dom.first('.dd', node);\n\t\t\tthis.hh = dom.first('.hh', node);\n\t\t\tthis.mm = dom.first('.mm', node);\n\t\t\tthis.ss = dom.first('.ss', node);\n\n\t\t\tthis.update();\n\t\t}\n\n\t\tupdate() {\n\t\t\tif (!this.node) {\n\t\t\t\treturn; // disposed\n\t\t\t}\n\n\t\t\tvar time = Math.max(0, this.time - Date.now()) / 1000;\n\n\t\t\tthis.updateDigit(this.dd, time / 86400);\n\t\t\tthis.updateDigit(this.hh, (time % 86400 ) / 3600);\n\t\t\tthis.updateDigit(this.mm, (time % 3600) / 60);\n\t\t\tthis.updateDigit(this.ss, time % 60);\n\n\t\t\tsetTimeout(() => this.update(), 1000);\n\t\t}\n\n\t\tupdateDigit(node, time) {\n\t\t\tif (node) {\n\t\t\t\tnode.innerHTML = util.pad(Math.floor(time));\n\t\t\t}\n\t\t}\n\t};\n});\n",
		"/*jshint maxparams:100*/\nplaytotv.define('playtotv.widget.DraggableWidget', [\n\t'playtotv.widget.Widget',\n\t'playtotv.css.Vector',\n\t'playtotv.fx.Transition',\n\t'playtotv.animationFrame',\n\t'playtotv.css.style',\n\t'playtotv.touch.touchManager'\n], function(\n\tWidget,\n\tVector,\n\tTransition,\n\tanimationFrame,\n\tstyle,\n\ttouchManager\n) {\n\n\t'use strict';\n\n\t/**\n\t * Shorthands\n\t *\n\t */\n\n\tvar dom = playtotv.dom;\n\tvar event = playtotv.event;\n\n\tvar STATE_PASSIVE = 1;\n\tvar STATE_ACTIVE = 2;\n\n\tvar nativeTouch = 'ontouchstart' in window;\n\n\t/**\n\t * DraggableWidget element, used or extended by various UI components.\n\t * This widget requires em:touch[type] events to be enabled either on its own node, or an ascendant, using\n\t * {@link playtotv.touch.touchManager}.\n\t *\n\t * @name DraggableWidget\n\t * @class\n\t * @memberOf playtotv.widget\n\t * @extends playtotv.widget.Widget\n\t * @param {Node} node\n\t * @param {Object} [options]\n\t * @param {number} [options.orientation=Vector.VERTICAL] dragging orientation\n\t * @param {string} [options.restrict='inside'] Movement restriction, based on element size in respect to container\n\t * @param {boolean} [options.elastic=false] Let element be dragged beyond its limits (although heavily reduced)\n\t * @param {boolean} [options.inertia=false] Let element have inertia and be flung on release.\n\t * @param {boolean} [options.friction=30] Inertia friction, a lower value flings farther and longer.\n\t * @param {boolean} [options.priority=false] Let element claim events regardless of orientation, stops propagation.\n\t * @param {string} [options.handle] Selector for a child node by which the draggable node is actually dragged\n\t */\n\tvar DraggableWidget = new playtotv.Class({\n\t\textend: Widget,\n\n\t\tinitialize: function(node, options) {\n\t\t\tthis._super(node);\n\n\t\t\tif (!touchManager.isCaptured(node)) {\n\t\t\t\t// TODO: capture locally with release on dispose? nesting IS possible ...\n\t\t\t\tthrow new Error('Required events not captured via playtotv.touch');\n\t\t\t}\n\n\t\t\toptions = playtotv.params(options, {\n\t\t\t\torientation: Vector.VERTICAL,\n\t\t\t\trestrict: 'inside',\n\t\t\t\telastic: false,\n\t\t\t\tinertia: false,\n\t\t\t\tfriction: 50,\n\t\t\t\tpriority: false,\n\t\t\t\thandle: null\n\t\t\t});\n\n\t\t\tthis.start = Vector.ZERO;\n\t\t\tthis.position = Vector.ZERO;\n\t\t\tthis.transition = new Transition({\n\t\t\t\tcallback: this.handleAnim,\n\t\t\t\tduration: 1000,\n\t\t\t\teasing: 'cubicout'\n\t\t\t});\n\n\t\t\tthis.orientation = options.orientation;\n\t\t\tthis.elastic = options.elastic;\n\t\t\tthis.priority = options.priority;\n\t\t\tthis.inertia = options.inertia;\n\t\t\tthis.friction = options.friction;\n\n\t\t\tthis.outside = /outside/i.test(options.restrict) ? true : false;\n\t\t\tthis.limiter = new Vector(\n\t\t\t\tthis.orientation === Vector.VERTICAL ? 0 : 1,\n\t\t\t\tthis.orientation === Vector.HORIZONTAL ? 0 : 1\n\t\t\t);\n\n\t\t\tthis.restricter = this.limiter.multiplyBy(0.75);\n\n\t\t\tvar handle = options.handle;\n\t\t\tif (handle) {\n\t\t\t\tnode = dom.first(handle, node) || node;\n\t\t\t}\n\n\t\t\tthis.addEventListener(node, 'em:touchstart', this.dragStart);\n\t\t\tthis.addEventListener(node, 'em:touchmove', this.dragMove);\n\t\t\tthis.addEventListener(node, 'em:touchend', this.dragEnd);\n\t\t\tthis.addEventListener(node, 'em:swipe', this.handleSwipe);\n\n\t\t\tthis.setup();\n\t\t\tthis.moveTo(this.start);\n\t\t},\n\n\t\t/** @lends playtotv.widget.DraggableWidget.prototype */\n\n\t\t/**\n\t\t * Checks various element properties on drag start for limiting, swiping, etc. Must set this.space, this.min\n\t\t * and this.max members when redefined in subclasses.\n\t\t */\n\t\tsetup: function() {\n\t\t\tvar node = this.node;\n\n\t\t\tthis.content = style.getSize(node);\n\t\t\tthis.view = style.getInnerSize(node.parentNode);\n\t\t\tthis.space = this.view.subtract(this.content).multiply(this.limiter);\n\t\t\tthis.min = this.space.min(Vector.ZERO);\n\t\t\tthis.max = this.outside ? Vector.ZERO : this.space.max(Vector.ZERO);\n\t\t},\n\n\t\tsetState: function(state) {\n\t\t\tthis.state = state;\n\t\t},\n\n\t\tgetState: function() {\n\t\t\treturn this.state;\n\t\t},\n\n\t\trequestFrame: function() {\n\t\t\tthis.request = animationFrame.request(this.handleFrame);\n\t\t},\n\n\t\tcancelFrame: function() {\n\t\t\tif (this.request) {\n\t\t\t\tanimationFrame.cancel(this.request);\n\t\t\t\tdelete this.request;\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Internal dragstart handler, initialized a draggable sequence, and fires a 'em:dragstart' event.\n\t\t * @param {Event|playtotv.event.Event} event\n\t\t *\n\t\t */\n\t\tdragStart: function(e) {\n\t\t\t// prevent start event for native mouse and pointer implementations to prevent native drag behavior.\n\t\t\t// don't prevent for native touch implementations, as this prevents a native click on touchend, which may\n\t\t\t// not be fired by the fastClick option depending on device and app properties.\n\t\t\tif (!nativeTouch) {\n\t\t\t\te.preventDefault();\n\t\t\t}\n\n\t\t\t// follow only this touch, in case more than one finger enters the fray\n\t\t\tthis.touchId = e.detail.sequence.id;\n\n\t\t\t// disallow propagation only if instance has priority\n\t\t\tif (this.priority) {\n\t\t\t\te.stopPropagation();\n\t\t\t}\n\n\t\t\tif (this.transition.playing) {\n\t\t\t\tthis.transition.stop();\n\t\t\t\tthis.setState(STATE_PASSIVE);\n\t\t\t}\n\n\t\t\tthis.start = this.position;\n\t\t\tthis.lastOrientation = null;\n\t\t\tthis.setup();\n\n\t\t\tevent.dispatchEvent(this.node, 'em:dragstart', false, false, { offset: this.position });\n\t\t},\n\n\t\t/**\n\t\t * internal dragmove handler, checks movement, and sends a restricted position to this.moveTo. Prevents event\n\t\t * propagation if the event's orientation matches this instance's orientation, for nested components.\n\t\t * @param {Event|playtotv.event.Event} event\n\t\t */\n\t\tdragMove: function(e) {\n\t\t\tif (this.hasPriority(e)) {\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\n\t\t\t\tvar sequence = e.detail.sequence;\n\t\t\t\tvar target = this.start.add(sequence.offset);\n\t\t\t\tvar restricted = this.restrict(target, this.elastic);\n\t\t\t\tthis.position = restricted;\n\n\t\t\t\t// start animating when actual dragging starts\n\t\t\t\tif (this.getState() !== STATE_ACTIVE) {\n\t\t\t\t\tthis.setState(STATE_ACTIVE);\n\t\t\t\t\tthis.requestFrame();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Internal dragend handler. Checks event orientation and inertia to fire an optional swipe.\n\t\t *\n\t\t * @param {Event|playtotv.event.Event} event\n\t\t */\n\t\tdragEnd: function(e) {\n\t\t\tif (this.hasPriority(e)) {\n\t\t\t\tif (!nativeTouch) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t}\n\n\t\t\t\te.stopPropagation();\n\n\t\t\t\tdelete this.touchId;\n\n\t\t\t\tif (this.inertia) {\n\t\t\t\t\tvar sequence = e.detail.sequence;\n\t\t\t\t\tvar velocity = sequence.velocity;\n\t\t\t\t\tvar factor = Math.sqrt(velocity.magnitude()) / this.friction;\n\t\t\t\t\tvar time = this.pulling ? 300 : (factor * 1000);\n\t\t\t\t\tthis.swipe(velocity.multiplyBy(factor), time);\n\t\t\t\t} else {\n\t\t\t\t\tthis.handleStopped();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Internal swipe event handler. Prevents event propagation if the event's orientation matches this instance's\n\t\t * orientation, for nested components.\n\t\t *\n\t\t * @param {Event|playtotv.event.Event} event\n\t\t */\n\t\thandleSwipe: function(e) {\n\t\t\tif (this.hasPriority(e)) {\n\t\t\t\te.stopPropagation();\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Checks the event and returns a boolean whether the event may be claimed, and its propagation stopped.\n\t\t *\n\t\t * @param {Event|playtotv.event.Event} event\n\t\t * @returns {boolean} priority\n\t\t */\n\t\thasPriority: function(e) {\n\t\t\tvar requested = this.orientation;\n\t\t\tvar sequence = e.detail.sequence;\n\t\t\treturn (sequence.id === this.touchId) &&\n\t\t\t\t(this.priority || !requested || (this.getOrientation(sequence) === requested));\n\t\t},\n\n\t\t/**\n\t\t * Updates the on screen position of the node while dragging,\n\t\t *\n\t\t */\n\t\thandleFrame: function() {\n\t\t\tthis.moveTo(this.position);\n\t\t\tthis.requestFrame();\n\t\t},\n\n\t\t/**\n\t\t * Internal end handler when the draggable node has come to a full stop.\n\t\t *\n\t\t */\n\t\thandleStopped: function() {\n\t\t\tthis.cancelFrame();\n\t\t\tthis.setState(STATE_PASSIVE);\n\t\t\tevent.dispatchEvent(this.node, 'em:dragend', false, false, { offset: this.position });\n\t\t},\n\n\t\t/**\n\t\t * Moves this.node to the given position (unrestricted) and fires a 'em:dragmove' event.\n\t\t * @param {playtotv.css.Vector} position\n\t\t */\n\t\tmoveTo: function(position) {\n\t\t\tthis.position = position;\n\t\t\tstyle.setTranslate(this.node, position);\n\t\t\tevent.dispatchEvent(this.node, 'em:dragmove', false, false, { offset: position });\n\t\t},\n\n\t\t/**\n\t\t * Moves this.node by the given vector (unrestricted) via this.moveTo\n\t\t * @param {playtotv.css.Vector} vector\n\t\t */\n\t\tmoveBy: function(vector) {\n\t\t\tvar position = this.position.add(vector);\n\t\t\tthis.moveTo(position);\n\t\t},\n\n\t\t/**\n\t\t * Animates a target node into view, aligning it with the top-left edge of the view. The target node\n\t\t * must be a childnode of this instance's one, and content should exceed viewsize for best effect.\n\t\t *\n\t\t * @param {Node} target\n\t\t * @param {number} [time=1000]\n\t\t */\n\t\tmoveIntoView: function(target, time) {\n\t\t\tif (!this.node.contains(target)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.setup();\n\t\t\tthis.swipeTo(Vector.ZERO.subtract(\n\t\t\t\tstyle.getOffset(target)\n\t\t\t).add(\n\t\t\t\tstyle.getOffset(this.node)\n\t\t\t), time);\n\t\t},\n\n\t\t/**\n\t\t * Moves this.node to the given relative position, e.g. (0.5, 0.5) for half way.\n\t\t * @param {playtotv.css.Vector} position\n\t\t */\n\t\tsetRelative: function(position) {\n\t\t\tthis.moveTo(this.space.multiply(position));\n\t\t},\n\n\t\t/**\n\t\t * Returns this.node's relative position in regards to its available space. Essentially this is a normalized\n\t\t * vector with x and y properties between 0 and 1, though elasticity may lead to values exceeding this.\n\t\t *\n\t\t * @returns {playtotv.css.Vector} relative position\n\t\t */\n\t\tgetRelative: function() {\n\t\t\tvar position = this.position;\n\t\t\tvar space = this.space;\n\n\t\t\t// prevent NaNs if x or y space is 0\n\t\t\treturn new Vector(\n\t\t\t\tspace.x ? position.x / space.x : 0,\n\t\t\t\tspace.y ? position.y / space.y : 0\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Returns the orientation of the current dragging sequence. Once set, the orientation is locked until the\n\t\t * next drag sequence starts. This allows nested components to properly handle orientation preferences /\n\t\t * propagation; e.g. vertical scrolling within horizontal pages.\n\t\t *\n\t\t * @param {playtotv.touch.Sequence} sequence\n\t\t * @returns {number} orientation Vector.HORIZONTAL or Vector.VERTICAL\n\t\t */\n\t\tgetOrientation: function(sequence) {\n\t\t\tif (!this.lastOrientation) {\n\t\t\t\tthis.lastOrientation = touchManager.getOrientation(sequence);\n\t\t\t}\n\n\t\t\treturn this.lastOrientation;\n\t\t},\n\n\t\t/**\n\t\t * Returns the current position.\n\t\t *\n\t\t * @returns {playtotv.css.Vector} position\n\t\t */\n\t\tgetPosition: function() {\n\t\t\treturn this.position;\n\t\t},\n\n\t\t/**\n\t\t * Swipes the node across the given vector over the given time.\n\t\t *\n\t\t * @param {playtotv.css.Vector} vector\n\t\t * @param {number} [time=1000]\n\t\t */\n\t\tswipe: function(vector, time) {\n\t\t\tvar position = this.position;\n\t\t\tvar target = this.restrict(position.add(vector), false);\n\t\t\tthis.vector = target.subtract(position);\n\t\t\tthis.start = position;\n\n\t\t\tthis.cancelFrame(); // if any\n\n\t\t\tthis.transition.play({\n\t\t\t\tduration: time || 1000\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Swipes the node to the given position over the given time.\n\t\t *\n\t\t * @param {playtotv.css.Vector} position\n\t\t * @param {number} [time=1000]\n\t\t */\n\t\tswipeTo: function(position, time) {\n\t\t\tposition = position.subtract(this.position);\n\t\t\tthis.swipe(position, time);\n\t\t},\n\n\t\t/**\n\t\t * swipe transition frame callback\n\t\t * @private\n\t\t */\n\t\thandleAnim: function(n) {\n\t\t\tvar moved = this.vector.multiplyBy(n);\n\t\t\tthis.moveTo(this.start.add(moved));\n\n\t\t\tif (n === 1) {\n\t\t\t\tthis.handleStopped();\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Restricts the given position to the instance's orientation, and may optionally apply elasticity to\n\t\t * positions outside of min and max values.\n\t\t *\n\t\t * @param {playtotv.css.Vector} position\n\t\t * @param {boolean} elastic\n\t\t * @returns {playtotv.css.Vector} restricted\n\t\t */\n\t\trestrict: function(position, elastic) {\n\t\t\tvar pos = this.limiter.multiply(position);\n\t\t\tvar min = this.min;\n\t\t\tvar max = this.max;\n\n\t\t\tif (elastic && this.content.exceeds(this.view)) {\n\t\t\t\tvar ex = (pos.x < min.x) ? pos.x - min.x : (pos.x > max.x) ? pos.x - max.x : 0;\n\t\t\t\tvar ey = (pos.y < min.y) ? pos.y - min.y : (pos.y > max.y) ? pos.y - max.y : 0;\n\n\t\t\t\tthis.pulling = (ex || ey) ? true : false;\n\n\t\t\t\tvar res = this.restricter;\n\t\t\t\treturn new Vector(\n\t\t\t\t\tpos.x - (ex * res.x),\n\t\t\t\t\tpos.y - (ey * res.y)\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\treturn pos.limit(min, max);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Dispose handler, can automatically be called when this.node is removed from the DOM,\n\t\t * but ONLY if this instance is managed by the {@link playtotv.widget.widgetManager}.\n\t\t */\n\t\tdispose: function() {\n\t\t\tif (this.transition.playing) {\n\t\t\t\tthis.transition.stop();\n\t\t\t}\n\n\t\t\tthis.cancelFrame();\n\n\t\t\tWidget.prototype.dispose.call(this);\n\t\t},\n\n\t\tcallbacks: [\n\t\t\t'handleSwipe',\n\t\t\t'handleFrame',\n\t\t\t'handleAnim',\n\t\t\t'dragStart',\n\t\t\t'dragMove',\n\t\t\t'dragEnd'\n\t\t]\n\t});\n\n\treturn DraggableWidget;\n});\n",
		"playtotv.define('playtotv.widget.FormWidget', [\n\t'playtotv.widget.Widget'\n], function(\n\tWidget\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar dom = ptv.dom;\n\tvar event = ptv.event;\n\n\t/**\n\t * ValidityTest class, validates an input using either the native checkValidity method, or a specified fallback\n\t * when native support is not detected by the given test method. For example; with a \"pattern\" attribute, the test\n\t * method should test native support, and the fallback should implement a regex check on the input's value.\n\t *\n\t * Since native checkValidity errors on any illegal value, it may invalidate an input outside of the scope of a\n\t * test's instance, but this merely makes validation fail early, and prevents subsequent tests on the same input.\n\t */\n\tvar ValidityTest = new ptv.Class({\n\t\tinitialize: function(options) {\n\t\t\toptions = ptv.params(options, {\n\t\t\t\tselector: ptv.REQUIRED,\n\t\t\t\ttest: ptv.REQURIED,\n\t\t\t\tfallback: ptv.REQUIRED\n\t\t\t});\n\n\t\t\tthis.selector = options.selector;\n\t\t\tthis.supported = options.test();\n\t\t\tthis.fallback = options.fallback;\n\t\t},\n\n\t\tvalidate: function(input) {\n\t\t\t// this test doesn't apply, consider valid\n\t\t\tif (!dom.matches(this.selector, input)) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// validate native if supported\n\t\t\tif (this.supported) {\n\t\t\t\treturn input.checkValidity();\n\t\t\t}\n\n\t\t\t// otherwise, return the fallback implementation value\n\t\t\treturn this.fallback(input);\n\t\t}\n\t});\n\n\t/**\n\t * Implemented tests. Instances are created when FormWidget intances are, as to not execute any tests by loading\n\t * this module.\n\t */\n\tvar validityTests = [ {\n\t\tselector: '[required]',\n\t\ttest: function() {\n\t\t\tvar input = document.createElement('input');\n\t\t\tinput.setAttribute('required', true);\n\t\t\treturn input.checkValidity && input.checkValidity() === false;\n\t\t},\n\t\tfallback: function(input) {\n\t\t\tif (/radio|check/i.test(input.type)) {\n\t\t\t\t// one or more radios or checks: check at least one of [name]\n\t\t\t\tvar list = input.form.elements[input.name];\n\t\t\t\treturn list.length ?\n\t\t\t\t\t// multiple inputs sharing a name\n\t\t\t\t\tptv.toArray(list).some(item => item.checked) :\n\t\t\t\t\t// one input\n\t\t\t\t\tinput.checked;\n\t\t\t} else {\n\t\t\t\t// otherwise, check the current value\n\t\t\t\treturn !!input.value;\n\t\t\t}\n\t\t}\n\t}, {\n\t\tselector: '[pattern]',\n\t\ttest: function() {\n\t\t\tvar input = document.createElement('input');\n\t\t\tinput.setAttribute('pattern', '\\\\d+');\n\t\t\tinput.value = 'test';\n\t\t\treturn input.checkValidity && input.checkValidity() === false;\n\t\t},\n\t\tfallback: function(input) {\n\t\t\treturn input.value ?\n\t\t\t\t// with value: test on the pattern\n\t\t\t\t(new RegExp('^' + input.getAttribute('pattern') + '$')).test(input.value) :\n\t\t\t\t// without value: valid, required is another test.\n\t\t\t\ttrue;\n\t\t}\n\t}, {\n\t\tselector: '[min],[max]',\n\t\ttest: function() {\n\t\t\tvar input = document.createElement('input');\n\t\t\tinput.setAttribute('type', 'number');\n\t\t\tinput.setAttribute('min', 0);\n\t\t\tinput.value = -1;\n\t\t\t// when supported, value will be overruled, or validity will be false\n\t\t\t// min and max for unsupported types (date in firefox) is ignored, and will validate\n\t\t\t// min and max for types that don't support it is ignored, and will validate\n\t\t\treturn input.value === '0' || (input.checkValidity && input.checkValidity() === false);\n\t\t},\n\t\tfallback: function(input) {\n\t\t\tif (input.value) {\n\t\t\t\tvar value = parseFloat(input.value);\n\t\t\t\tvar min = input.getAttribute('min');\n\t\t\t\tvar max = input.getAttribute('max');\n\n\t\t\t\treturn !isNaN(value) &&\n\t\t\t\t\t(!min || value >= parseFloat(min)) &&\n\t\t\t\t\t(!max || value <= parseFloat(max));\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\t}, {\n\t\tselector: '[type=date]',\n\t\ttest: function() {\n\t\t\tvar input = document.createElement('input');\n\t\t\tinput.setAttribute('type', 'date');\n\t\t\tinput.value = 'invalid';\n\t\t\t// test for browsers that may support min and max for numbers, but not the date input\n\t\t\t// when supported, value will be overruled or validity will be false\n\t\t\treturn !input.value || (input.checkValidity && input.checkValidity() === false);\n\t\t},\n\t\tfallback: function(input) {\n\t\t\tif (input.value) {\n\t\t\t\tvar value = Date.parse(input.value);\n\t\t\t\tvar min = input.getAttribute('min');\n\t\t\t\tvar max = input.getAttribute('max');\n\n\t\t\t\treturn !isNaN(value) &&\n\t\t\t\t\t(!min || value >= Date.parse(min)) &&\n\t\t\t\t\t(!max || value <= Date.parse(max));\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\t} ];\n\n\t/**\n\t * The FormWidget provides convenient hooks to validation and custum submit actions for form nodes.\n\t * The widget node does not need to be a form itself, but if not MUST contain it.\n\t * By default this widget does not implement a custom submit action and only serves as a super class for specific\n\t * form widgets, which in turn MUST implement custom submit handling.\n\t *\n\t * @name FormWidget\n\t * @memberOf playtotv.widget\n\t * @class\n\t * @param {Node} node\n\t * @param {Object} [options] FormWidget options\n\t * @param {boolean} [options.preventNative=true] Indicates whether or not to preventDefault the native submit\n\t * @param {boolean} [options.validateChange=true] Indicates whether or not to validate inputs onchange\n\t */\n\tvar FormWidget = new ptv.Class({\n\t\textend: Widget,\n\n\t\tinitialize: function(node, options) {\n\t\t\tif (!dom.matches('form', node)) {\n\t\t\t\tthrow new Error('Form expected');\n\t\t\t}\n\n\t\t\toptions = ptv.params(options, {\n\t\t\t\tapp: null,\n\t\t\t\tcontroller: null,\n\t\t\t\thighlight: 'error',\n\t\t\t\tfield: '.field',\n\t\t\t\tpreventNative: true,\n\t\t\t\tvalidateChange: true\n\t\t\t});\n\n\t\t\tthis._super(node);\n\n\t\t\tthis.field = options.field;\n\t\t\tthis.highlightClass = options.highlight;\n\t\t\tthis.preventNative = options.preventNative;\n\n\t\t\tthis.addEventListener(node, 'submit', this.onSubmit);\n\n\t\t\tif (options.validateChange) {\n\t\t\t\tthis.addEventListener(node, 'change', this.onChange);\n\t\t\t}\n\n\t\t\t// Disable native onSubmit validation to allow the onSubmit event to fire. This generates a validity object\n\t\t\t// which is forwarded to the {@link playtotv.widget.FormWidget#submit} method for custom error handling.\n\t\t\tnode.setAttribute('novalidate', true);\n\n\t\t\t// get test instances for validateInput\n\t\t\tthis.tests = validityTests.map(\n\t\t\t\ttest => new ValidityTest(test)\n\t\t\t);\n\t\t},\n\n\t\t/** @lends playtotv.widget.FormWidget.prototype */\n\n\t\t/**\n\t\t * Native submit handler. Calls validateForm and passes the returned validity object to the\n\t\t * {@link playtotv.widget.FormWidget#submit} function for custom validation feedback. The native submit event is\n\t\t * prevented if the instance's preventNative option is set to true (default), or if submit returns false.\n\t\t *\n\t\t * @param {Event} submit\n\t\t */\n\t\tonSubmit: function(e) {\n\t\t\tif (this.preventNative) {\n\t\t\t\te.preventDefault();\n\t\t\t}\n\n\t\t\tvar result = this.validateForm();\n\t\t\tresult.elements.forEach(input => {\n\t\t\t\tthis.highlight(input, false);\n\t\t\t}, this);\n\n\t\t\tresult.errors.forEach(input => {\n\t\t\t\tthis.highlight(input, true);\n\t\t\t}, this);\n\n\t\t\tif (result.valid) {\n\t\t\t\tevent.dispatchEvent(this.node, 'submit-valid', true, true, {\n\t\t\t\t\tdata: this.serialize(),\n\t\t\t\t\tvalidity: result,\n\t\t\t\t\toriginalEvent: e\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Handles native onchange events to live-update input validity feedback as the user enters values.\n\t\t *\n\t\t * @param {Event} change\n\t\t */\n\t\tonChange: function(e) {\n\t\t\tvar input = e.target;\n\t\t\tvar valid = this.validateInput(input);\n\t\t\tthis.highlight(input, !valid);\n\t\t},\n\n\t\t/**\n\t\t * Toggle error on input\n\t\t */\n\t\thighlight: function(input, toggle) {\n\t\t\tvar field = dom.closest(this.field, input);\n\t\t\tif (field) {\n\t\t\t\tfield.classList.toggle(this.highlightClass, toggle);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Validates the input of this form using HTML5 validation properties including input types, required, pattern\n\t\t * and min max attributes, etc. Returns a validity object with an \"elements\" array of all the form's elements,\n\t\t * an \"errors\" array of invalid elemements, and a \"valid\" boolean indicating whether the form's current input\n\t\t * is valid.\n\t\t *\n\t\t * @returns {Object} validity Validity object with elements array, errors array and valid boolean.\n\t\t */\n\t\tvalidateForm: function() {\n\t\t\tvar elements = this.getElements();\n\t\t\tvar errors = [];\n\n\t\t\telements.forEach(function(input) {\n\t\t\t\tif (!this.validateInput(input)) {\n\t\t\t\t\terrors.push(input);\n\t\t\t\t}\n\t\t\t}, this);\n\n\t\t\treturn {\n\t\t\t\telements: elements,\n\t\t\t\terrors: errors,\n\t\t\t\tvalid: !errors.length\n\t\t\t};\n\t\t},\n\n\t\t/**\n\t\t * Validates a single input, and returns a boolean indicating whether the value is valid.\n\t\t *\n\t\t * @param {Node} input\n\t\t * @returns {boolean} valid\n\t\t */\n\t\tvalidateInput: function(input) {\n\t\t\t// start with an initial checkValidity if supported, otherwise assume valid before testing\n\t\t\tvar valid = input.checkValidity ? input.checkValidity() : true;\n\n\t\t\t// test until false (if not already) or all tests passed\n\t\t\tthis.tests.forEach(test => {\n\t\t\t\tvalid = valid && test.validate(input);\n\t\t\t});\n\n\t\t\treturn valid;\n\t\t},\n\n\t\t/**\n\t\t * Returns an array of the form's elements at the time of calling this method. As an array representation of\n\t\t * the native form.elements HTMLFormControlsCollection, this WILL include possible fieldset nodes.\n\t\t *\n\t\t * @returns {Array} elements\n\t\t */\n\t\tgetElements: function() {\n\t\t\treturn ptv.toArray(this.node.elements);\n\t\t},\n\n\t\t/**\n\t\t * Returns an object with name-value pairs of the form's current input. The values of range and number inputs\n\t\t * are parsed to a number. Inputs without a name attribute are ignored.\n\t\t *\n\t\t * @returns {Object} data Current input as name-value pairs.\n\t\t */\n\t\tserialize: function() {\n\t\t\tvar elements = this.getElements();\n\t\t\tvar data = {};\n\t\t\telements.forEach(function(element) {\n\t\t\t\tvar name = element.name;\n\t\t\t\tvar type = element.type;\n\t\t\t\tvar value = element.value;\n\n\t\t\t\t// TODO: aggregate multiple inputs sharing a name\n\n\t\t\t\t// can't store value without a name\n\t\t\t\tif (!name) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// only store the value of checked elements\n\t\t\t\tif (/check|radio/i.test(type) && !element.checked) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// parseFloat number elements\n\t\t\t\tif (value && /number|range/i.test(type)) {\n\t\t\t\t\tvalue = parseFloat(value);\n\t\t\t\t}\n\n\t\t\t\t// Retrieve selected option values as array\n\t\t\t\tif (type === 'select-multiple') {\n\t\t\t\t\tvalue = playtotv.toArray(element.options)\n\t\t\t\t\t\t.filter(option => option.selected)\n\t\t\t\t\t\t.map(option => option.value);\n\t\t\t\t}\n\n\t\t\t\t// store\n\t\t\t\tdata[name] = value;\n\t\t\t});\n\n\t\t\treturn data;\n\t\t},\n\n\t\tcallbacks: [\n\t\t\t'onChange',\n\t\t\t'onSubmit'\n\t\t]\n\t});\n\n\treturn FormWidget;\n});\n",
		"playtotv.define('playtotv.widget.ScalableWidget', [\n\t'playtotv.css.style',\n\t'playtotv.widget.Widget'\n], function(\n\tstyle,\n\tWidget\n) {\n\n\t'use strict';\n\n\t/**\n\t * Scales a node to fit its parent's dimensions, scaling in either width or height, and resizing in (respectively)\n\t * height or width to completely fill the parent's space. Use min- and/or max- css dimensions on the parent to set\n\t * hard limits on scaling. Note that {@link playtotv.css.style.fromPageToNode} may be needed to convert coordinate\n\t * spaces when working with user input, as transformed nodes will return their original position and dimensions.\n\t *\n\t * @name ScalableWidget\n\t * @memberOf playtotv.widget\n\t * @class\n\t * @param {Node} node\n\t * @param {Object} [options] ScalableWidget options\n\t * @param {Object} [options.mode='portrait'] The scaling mode, either \"portrait\" or \"landscape\"\n\t * @param {Object} [options.resize=true] Resizing may be set to false to have nodes scale only, not resize\n\t */\n\tvar ScalableWidget = new playtotv.Class({\n\t\textend: Widget,\n\t\tinitialize: function(node, options) {\n\t\t\toptions = playtotv.params(options, {\n\t\t\t\tmode: 'portrait',\n\t\t\t\tresize: true\n\t\t\t});\n\n\t\t\tthis._super(node);\n\n\t\t\tthis.mode = options.mode;\n\t\t\tthis.resize = options.resize;\n\n\t\t\tthis.addEventListener(window, 'resize', playtotv.debounce(this.onResize, 100));\n\t\t\tthis.onResize();\n\t\t},\n\n\t\t/** @lends playtotv.widget.ScalableWidget.prototype */\n\n\t\t/**\n\t\t * Resize handler, determines and applies scale and resizing.\n\t\t *\n\t\t * @param {Event} resize\n\t\t */\n\t\tonResize: function() {\n\t\t\tvar node = this.node;\n\t\t\tif (!node) {\n\t\t\t\treturn; // disposed during debounce\n\t\t\t}\n\n\t\t\tvar parent = node.parentNode;\n\t\t\tvar scale = (this.mode === 'landscape') ?\n\t\t\t\tparent.offsetWidth / node.offsetWidth :\n\t\t\t\tparent.offsetHeight / node.offsetHeight;\n\n\t\t\tthis.setScale(scale);\n\n\t\t\tif (this.resize) {\n\t\t\t\tthis.sizeToScale();\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Resizes the widget's node to fill its parent, based on this instance's mode, the current scale, and the\n\t\t * parent's dimensions. When resizing is enabled, this method is called via onResize immediately following\n\t\t * setScale.\n\t\t *\n\t\t */\n\t\tsizeToScale: function() {\n\t\t\tvar node = this.node;\n\t\t\tvar parent = node.parentNode;\n\t\t\tvar landscape = (this.mode === 'landscape');\n\n\t\t\tvar offside = landscape ? 'height' : 'width';\n\t\t\tvar space = landscape ?\n\t\t\t\tparent.offsetHeight / this.scale :\n\t\t\t\tparent.offsetWidth / this.scale;\n\n\t\t\tstyle.set(node, offside, space + 'px');\n\t\t},\n\n\t\t/**\n\t\t * Applies the scale to the widget's node as a CSS scale() transformation.\n\t\t *\n\t\t * @param {number} scale\n\t\t */\n\t\tsetScale: function(scale) {\n\t\t\tthis.scale = scale;\n\t\t\tstyle.setTransform(this.node, 'scale(' + scale + ')');\n\t\t},\n\n\t\t/**\n\t\t * Returns the current scale\n\t\t *\n\t\t * @returns {number} scale\n\t\t */\n\t\tgetScale: function() {\n\t\t\treturn this.scale;\n\t\t},\n\n\t\tcallbacks: [\n\t\t\t'onResize'\n\t\t]\n\t});\n\n\treturn ScalableWidget;\n});\n",
		"playtotv.define('playtotv.widget.ScrollableWidget', [\n\t'playtotv.widget.Widget',\n\t'playtotv.widget.DraggableWidget',\n\t'playtotv.css.Vector',\n\t'playtotv.css.style'\n], function(\n\tWidget,\n\tDraggableWidget,\n\tVector,\n\tstyle\n) {\n\n\t'use strict';\n\n\tvar dom = playtotv.dom;\n\n\t/**\n\t * Creates a scrollable area from a given node and its content childnode (as defined by options.content), that may\n\t * be scrolled by dragging anywhere in the content by either mouse or touch. The root node acts as the viewport and\n\t * must define a hidden overflow in the direction for which scrolling is enabled, in order to hide any content in\n\t * excess of the viewport's dimensions. This requires a block level display value on the viewport. The content\n\t * node's position is updated using CSS translations. This may conflict with transformations that are applied to\n\t * the content node from CSS.\n\t *\n\t * Non-interactive track thumbs indicating the relative size and position of the content in respect to the viewport\n\t * are inserted (by default, see options) as span elements and are updated dynamically while scrolling. Thumbs must\n\t * be styled using CSS. The vertical thumb should be positioned in the top right corner of the viewport and\n\t * minimally define a fixed width to be visible; the height is calculated and applied dynamically. The horizontal\n\t * thumb should be positioned in the bottom left corner and define a fixed height. This may require a position\n\t * value on the viewport other than static (e.g. relative).\n\t *\n\t * Vertical scrolling minimally requires a limited height value for the viewport, and an auto height value for the\n\t * content node. As normal CSS flow is vertically oriented, this doesn't require any styling other than possible\n\t * block display on the content node.\n\t *\n\t * Horizontal scrolling minimally requires a limited width value for the viewport, and either a fixed width value\n\t * or non-wrapping white space for the content node. This may require a block level display value on the content\n\t * node.\n\t *\n\t * Orientation free scrolling requires limited width and height for the viewport, as well as and fixed width and\n\t * height for the content node.\n\t *\n\t * @name ScrollableWidget\n\t * @memberOf playtotv.widget\n\t * @class\n\t * @extends playtotv.widget.Widget\n\t * @param {Node} node\n\t * @param {Object} [options]\n\t * @param {number} [options.orientation=Vector.VERTICAL] Content orientation.\n\t * @param {string} [options.restrict='outside'] DraggableWidget content restriction.\n\t * @param {string} [options.content='.content'] Selector indicating the draggable content node.\n\t * @param {string} [options.thumbH='thumb-horizontal'] Horizontal thumb class, false for no thumb.\n\t * @param {string} [options.thumbV='thumb-vertical'] Vertical thumb class, false for no thumb.\n\t * @param {string} [options.active='scrolling'] Active class when scrolling.\n\t * @param {string} [options.disabled='disabled'] Disabled class for thumbs when view exceeds content.\n\t * @param {boolean} [options.elastic=true] ScrollableWidget is elastic by default.\n\t * @param {boolean} [options.inertia=true] ScrollableWidget has inertia by default.\n\t */\n\tvar ScrollableWidget = new playtotv.Class({\n\t\textend: Widget,\n\n\t\tinitialize: function(node, options) {\n\t\t\tthis._super(node);\n\n\t\t\toptions = playtotv.params(options, {\n\t\t\t\torientation: Vector.VERTICAL,\n\t\t\t\trestrict: 'outside',\n\t\t\t\tcontent: '.content',\n\t\t\t\tthumbH: 'thumb-horizontal',\n\t\t\t\tthumbV: 'thumb-vertical',\n\t\t\t\tactive: 'scrolling',\n\t\t\t\tdisabled: 'disabled',\n\t\t\t\telastic: true,\n\t\t\t\tinertia: true,\n\t\t\t\tfriction: 50,\n\t\t\t\tpriority: false,\n\t\t\t\thandle: null\n\t\t\t});\n\n\t\t\t// draggable content node MUST be present (its actual content may be added dynamically)\n\t\t\tvar content = dom.first(options.content, node);\n\t\t\tif (!content) {\n\t\t\t\tthrow new ReferenceError('Content node \"' + options.content + '\" expected');\n\t\t\t}\n\n\t\t\t// node display SHOULD be set to \"block\" or \"inline-block\"\n\t\t\t// TODO: test more display values including flex types and run-in.\n\t\t\tvar display = style.get(node, 'display');\n\t\t\tif (!/block/i.test(display)) {\n\t\t\t\tthrow new Error('Display \"block\" or \"inline-block\" is required for scrollable nodes');\n\t\t\t}\n\n\t\t\t// node overflow MUST be set to \"hidden\"\n\t\t\tvar overflow = style.get(node, 'overflow');\n\t\t\tif (overflow !== 'hidden') {\n\t\t\t\tthrow new Error('Overflow \"hidden\" is required for scrollable nodes');\n\t\t\t}\n\n\t\t\tthis.content = content;\n\t\t\tthis.activeClass = options.active;\n\t\t\tthis.disabledClass = options.disabled;\n\n\t\t\tvar dir = options.orientation;\n\n\t\t\tthis.pane = new DraggableWidget(content, {\n\t\t\t\torientation: dir,\n\t\t\t\trestrict: options.restrict,\n\t\t\t\telastic: options.elastic,\n\t\t\t\tinertia: options.inertia,\n\t\t\t\tfriction: options.friction,\n\t\t\t\tpriority: options.priority,\n\t\t\t\thandle: options.handle\n\t\t\t});\n\n\t\t\tif (options.thumbH && (dir === Vector.HORIZONTAL || dir === Vector.FREE)) {\n\t\t\t\tthis.thumbH = dom.create('span', { 'class': options.thumbH }, { appendTo: node });\n\t\t\t}\n\n\t\t\tif (options.thumbV && (dir === Vector.VERTICAL || dir === Vector.FREE)) {\n\t\t\t\tthis.thumbV = dom.create('span', { 'class': options.thumbV }, { appendTo: node });\n\t\t\t}\n\n\t\t\tthis.addEventListener(content, 'em:dragstart', this.handleStart);\n\t\t\tthis.addEventListener(content, 'em:dragmove', this.handleDrag);\n\t\t\tthis.addEventListener(content, 'em:dragend', this.handleEnd);\n\n\t\t\tthis.updateThumbs();\n\t\t},\n\n\t\t/** @lends playtotv.widget.ScrollableWidget.prototype */\n\n\t\t/**\n\t\t * Moves and resizes the thumb to reflect the content's position\n\t\t *\n\t\t */\n\t\tupdateThumbs: function() {\n\t\t\tvar pane = this.pane;\n\n\t\t\tvar relative = pane.getRelative();\n\t\t\tvar pos = pane.position;\n\t\t\tvar min = pane.min;\n\t\t\tvar view = pane.view;\n\t\t\tvar content = pane.content;\n\t\t\tvar scale = view.divide(content.max(view));\n\t\t\tvar disabled = this.disabledClass;\n\n\t\t\tvar elasticity = pos.max(min.subtract(pos)).max(Vector.ZERO);\n\t\t\tvar thumbSize = view.multiply(scale).subtract(elasticity);\n\t\t\tvar thumbSpace = view.subtract(thumbSize);\n\t\t\tvar thumbPos = relative.multiply(thumbSpace).limit(Vector.ZERO, thumbSpace);\n\n\t\t\t// If present, update the horizontal thumb's size, positition and state class.\n\t\t\tvar horizontal = this.thumbH;\n\t\t\tif (horizontal) {\n\t\t\t\tstyle.set(horizontal, 'width', thumbSize.x + 'px');\n\t\t\t\tstyle.setTranslate(horizontal, thumbPos.x + 'px, 0');\n\t\t\t\thorizontal.classList.toggle(disabled, scale.x >= 1);\n\t\t\t}\n\n\t\t\t// Same for vertical.\n\t\t\tvar vertical = this.thumbV;\n\t\t\tif (vertical) {\n\t\t\t\tstyle.set(vertical, 'height', thumbSize.y + 'px');\n\t\t\t\tstyle.setTranslate(vertical, '0, ' + thumbPos.y + 'px');\n\t\t\t\tvertical.classList.toggle(disabled, scale.y >= 1);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Toggles the active class when scrolling for styling purposes.\n\t\t * @param {boolean} toggle\n\t\t */\n\t\ttoggleActive: function(toggle) {\n\t\t\tif (toggle !== this.scrolling) {\n\t\t\t\tthis.scrolling = toggle;\n\t\t\t\tthis.node.classList.toggle(this.activeClass, toggle);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Animates the given node into view using {@link playtotv.widget.DraggableWidget#moveIntoView}\n\t\t * @param {Node} target\n\t\t * @param {number} [time=1000]\n\t\t */\n\t\tscrollIntoView: function(target, time) {\n\t\t\tthis.pane.moveIntoView(target, time);\n\t\t},\n\n\t\t/**\n\t\t * Animates the content to align the given point (relative to content) to the top-left edge of the view.\n\t\t *\n\t\t * @param {playtotv.css.Vector} point\n\t\t * @param {number} [time=1000]\n\t\t */\n\t\tscrollTo: function(point, time) {\n\t\t\tthis.pane.swipeTo(Vector.ZERO.subtract(point), time);\n\t\t},\n\n\t\t/**\n\t\t * Internal dragstart handler, checks if thumbs are needed, corrects for native scrolling offsets, and stops\n\t\t * propagation to higher nodes.\n\t\t * @param {Event|playtotv.event.Event} event\n\t\t */\n\t\thandleStart: function(e) {\n\t\t\te.stopPropagation();\n\n\t\t\tvar pane = this.pane;\n\n\t\t\t// check if thumbs are needed\n\t\t\tthis.indicate = pane.content.exceeds(pane.view);\n\n\t\t\t// compensate for anchor jumps\n\t\t\tvar node = this.node;\n\t\t\tvar sx = node.scrollLeft;\n\t\t\tvar sy = node.scrollTop;\n\t\t\tif (sx || sy) {\n\t\t\t\tnode.scrollTop = node.scrollLeft = 0;\n\t\t\t\tpane.moveBy(new Vector(-sx, -sy));\n\t\t\t\tpane.start = pane.position;\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Internal dragmove handler, updates thumb positions, and adds the active class after scrolling at least 20px.\n\t\t * @param {Event|playtotv.event.Event} event\n\t\t */\n\t\thandleDrag: function(e) {\n\t\t\te.stopPropagation();\n\n\t\t\tif (this.indicate) {\n\n\t\t\t\tvar pane = this.pane;\n\t\t\t\tvar start = pane.start;\n\t\t\t\tvar pos = pane.position;\n\t\t\t\tvar magnitude = pos.subtract(start).magnitude();\n\n\t\t\t\tif (!this.scrolling && magnitude > 20) {\n\t\t\t\t\tthis.toggleActive(true);\n\t\t\t\t}\n\n\t\t\t\tthis.updateThumbs();\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Internal dragend handler. Removes the active class.\n\t\t * @param {Event|playtotv.event.Event} event\n\t\t */\n\t\thandleEnd: function(e) {\n\t\t\te.stopPropagation();\n\t\t\tthis.toggleActive(false);\n\t\t},\n\n\t\tcallbacks: [\n\t\t\t'handleStart',\n\t\t\t'handleDrag',\n\t\t\t'handleEnd'\n\t\t]\n\t});\n\n\treturn ScrollableWidget;\n});\n",
		"playtotv.define('playtotv.widget.ThemeWidget', [\n\t'playtotv.widget.Widget'\n], function(\n\tWidget\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar dom = ptv.dom;\n\n\treturn class ThemeWidget extends Widget {\n\t\tconstructor(node, options) {\n\t\t\tptv.params(options, {\n\t\t\t\tapp: null,\n\t\t\t\ttheme: ptv.REQUIRED,\n\t\t\t\ttarget: 'body'\n\t\t\t});\n\n\t\t\tsuper(node);\n\n\t\t\tvar theme = this.theme = options.theme;\n\t\t\tvar target = this.target = dom.first(options.target);\n\t\t\tif (target) {\n\t\t\t\ttarget.classList.add(theme);\n\t\t\t}\n\t\t}\n\n\t\tdispose() {\n\t\t\tif (this.target) {\n\t\t\t\tthis.target.classList.remove(this.theme);\n\t\t\t}\n\n\t\t\tsuper();\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.widget.TimerWidget', [\n\t'playtotv.css.style',\n\t'playtotv.fx.Transition',\n\t'playtotv.widget.Widget'\n], function(\n\tstyle,\n\tTransition,\n\tWidget\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar dom = ptv.dom;\n\n\t/**\n\t * TimerWidget bar that resizes an indicator from 0 to 100% width over the given time.\n\t * Time may be stated using meaningful combinations of start, time and/or end options.\n\t * If no start time is given, the current time is used.\n\t * Also note that the end option takes precedence over the time option when determining duration.\n\t * It IS possible to only specify an end timestamp on a TimerWidget node.\n\t *\n\t * TODO: enable a switch for CSS transitions vs physical width modification.\n\t *\n\t * @class\n\t * @name TimerWidget\n\t * @memberOf playtotv.widget\n\t * @param {Node} node\n\t * @param {Object} [options]\n\t * @param {string} [options.indicator='.indicator'] TimerWidget indicator selector\n\t * @param {string} [options.property='width'] The CSS property to modify, must support a percentage value.\n\t * @param {boolean} [options.inverted=false] Set to true to size down instead of up\n\t * @param {boolean} [options.autoplay=true] Defines whether or not the timer starts automatically\n\t * @param {number} [options.fps=1] Animation fps, should not be too high for mobiles due to reflows\n\t */\n\treturn class TimerWidget extends Widget {\n\n\t\tconstructor(node, options) {\n\t\t\toptions = ptv.params(options, {\n\t\t\t\tapp: null,\n\t\t\t\tindicator: '.indicator',\n\t\t\t\tproperty: 'width',\n\t\t\t\tinverted: false,\n\t\t\t\tautoplay: true,\n\t\t\t\tfps: 1,\n\t\t\t\tstart: 0,\n\t\t\t\ttime: 0,\n\t\t\t\tend: 0\n\t\t\t});\n\n\t\t\tsuper(node);\n\n\t\t\tthis.node = node;\n\t\t\tthis.bar = dom.first(options.indicator, node);\n\t\t\tthis.property = options.property;\n\n\t\t\tvar inv = options.inverted;\n\t\t\tthis.transition = new Transition({\n\t\t\t\tcallback: this.handleFrame.bind(this),\n\t\t\t\tduration: 1000,\n\t\t\t\tfrom: inv ? 1 : 0,\n\t\t\t\tto: inv ? 0 : 1,\n\t\t\t\tfps: options.fps\n\t\t\t});\n\n\t\t\tif (options.autoplay) {\n\t\t\t\tvar { start, time, end } = options;\n\t\t\t\tvar now = Date.now();\n\t\t\t\tstart = start || now;\n\t\t\t\ttime = time;\n\t\t\t\tend = end || (start + time);\n\t\t\t\tthis.start(end - start, start);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Start the timer, running it for the given duration. An optional start time may be given.\n\t\t *\n\t\t * @param {number} duration in ms\n\t\t * @param {number} [start] timestamp\n\t\t */\n\t\tstart(duration, start) {\n\t\t\tif (isNaN(duration)) {\n\t\t\t\tthrow new TypeError('Duration is not a number');\n\t\t\t}\n\n\t\t\tthis.stop();\n\n\t\t\tthis.starttime = start || Date.now();\n\t\t\tthis.duration = duration;\n\n\t\t\tthis.transition.play({\n\t\t\t\tstart: this.starttime,\n\t\t\t\tduration: this.duration\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Stops the timer\n\t\t *\n\t\t */\n\t\tstop() {\n\t\t\tthis.transition.stop();\n\t\t}\n\n\t\treset() {\n\t\t\tthis.stop();\n\t\t\tvar from = this.transition.settings.from * 100;\n\t\t\tstyle.set(this.bar, this.property, from + '%');\n\t\t}\n\n\t\thandleFrame(n) {\n\t\t\tstyle.set(this.bar, this.property, (n * 100) + '%');\n\t\t}\n\n\t\tdispose() {\n\t\t\tthis.stop();\n\n\t\t\tsuper();\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.widget.TimestampWidget', [\n\t'playtotv.widget.Widget'\n], function(\n\tWidget\n) {\n\n\t'use strict';\n\n\tvar DAY_HOURS = 24;\n\tvar HOUR_MINUTES = 60;\n\tvar MINUTE_SECONDS = 60;\n\tvar HOUR_SECONDS = HOUR_MINUTES * MINUTE_SECONDS;\n\tvar DAY_SECONDS = DAY_HOURS * HOUR_SECONDS;\n\n\tvar ptv = playtotv;\n\n\t/**\n\t * Widget that dynamically updates a node's innerHTML with a string representing the amount of time passed since\n\t * the timestamp passed as time option.\n\t *\n\t * TODO: add a dateformat option\n\t *\n\t * @name TimestampWidget\n\t * @memberOf playtotv.widget\n\t * @class\n\t * @extends playtotv.widget.Widget\n\t * @param {Node} node\n\t */\n\treturn class TimestampWidget extends Widget {\n\n\t\tconstructor(node, options) {\n\t\t\tptv.params(options, {\n\t\t\t\tapp: null,\n\t\t\t\ttime: ptv.REQUIRED\n\t\t\t});\n\n\t\t\tsuper(node);\n\n\t\t\tthis.time = options.time;\n\n\t\t\tthis.update();\n\t\t}\n\n\t\tupdate() {\n\t\t\tvar seconds = Math.floor((Date.now() - this.time) / 1000);\n\t\t\tvar text;\n\n\t\t\tif (seconds >= DAY_SECONDS) {\n\t\t\t\ttext = Math.floor(seconds / DAY_SECONDS) + 'd';\n\t\t\t} else if (seconds >= HOUR_SECONDS) {\n\t\t\t\ttext = Math.floor(seconds / HOUR_SECONDS) % DAY_HOURS + 'h';\n\t\t\t} else if (seconds >= MINUTE_SECONDS) {\n\t\t\t\ttext = Math.floor(seconds / MINUTE_SECONDS) % HOUR_MINUTES + 'm';\n\t\t\t} else {\n\t\t\t\ttext = seconds % MINUTE_SECONDS + 's';\n\t\t\t}\n\n\t\t\tif (this.node.innerHTML !== text) {\n\t\t\t\tthis.node.innerHTML = text;\n\t\t\t}\n\n\t\t\tthis.timeout = setTimeout(() => {\n\t\t\t\tthis.update();\n\t\t\t}, seconds > MINUTE_SECONDS ? 60000 : 1000);\n\t\t}\n\n\t\tdispose() {\n\t\t\tclearTimeout(this.timeout);\n\n\t\t\tsuper();\n\t\t}\n\t};\n});\n",
		"playtotv.define('playtotv.widget.TransformableWidget', [\n\t'playtotv.animationFrame',\n\t'playtotv.css.Matrix',\n\t'playtotv.css.style',\n\t'playtotv.css.Vector',\n\t'playtotv.widget.Widget'\n], function(\n\tanimationFrame,\n\tMatrix,\n\tstyle,\n\tVector,\n\tWidget\n) {\n\n\t'use strict';\n\n\tvar log = new playtotv.Logger(this.id);\n\n\tvar STATE_PASSIVE = 1;\n\tvar STATE_ACTIVE = 2;\n\n\treturn new playtotv.Class({\n\t\textend: Widget,\n\t\tinitialize: function(node, options) {\n\t\t\tthis._super(node);\n\n\t\t\toptions = playtotv.params(options, {\n\t\t\t\ttranslate: true,\n\t\t\t\tscale: true,\n\t\t\t\trotate: true\n\t\t\t});\n\n\t\t\tthis.touches = [];\n\t\t\tthis.transform = new Matrix();\n\n\t\t\tthis.translation = new Vector(0, 0);\n\t\t\tthis.scaling = 1;\n\t\t\tthis.rotation = 0;\n\n\t\t\tthis.deltaMove = new Vector(0, 0);\n\t\t\tthis.deltaAngle = 0;\n\t\t\tthis.deltaScale = 1;\n\n\t\t\tthis.addEventListener(node, 'em:touchstart', this.touchStart);\n\t\t\tthis.addEventListener(node, 'em:touchmove', this.touchMove);\n\t\t\tthis.addEventListener(node, 'em:touchend', this.touchEnd);\n\t\t},\n\n\t\tsetState: function(state) {\n\t\t\tthis.state = state;\n\t\t},\n\n\t\tgetState: function() {\n\t\t\treturn this.state;\n\t\t},\n\n\t\trequestFrame: function() {\n\t\t\tthis.request = animationFrame.request(this.handleFrame);\n\t\t},\n\n\t\tcancelFrame: function() {\n\t\t\tif (this.request) {\n\t\t\t\tanimationFrame.cancel(this.request);\n\t\t\t\tdelete this.request;\n\t\t\t}\n\t\t},\n\n\t\ttouchStart: function(e) {\n\t\t\te.preventDefault();\n\t\t\tthis.touches.push(e.detail.sequence.id);\n\t\t},\n\n\t\ttouchMove: function(e) {\n\t\t\te.preventDefault();\n\n\t\t\tvar proxy = e.detail.proxy;\n\t\t\tvar touches = this.touches;\n\t\t\tif (touches.length > 0) {\n\n\t\t\t\tvar begin = proxy.getSequence(touches[0]);\n\t\t\t\tvar translate = Vector.ZERO; // begin.offset; // TODO: unbug single-finger dragging\n\t\t\t\tvar angle = 0;\n\t\t\t\tvar scale = 1;\n\n\t\t\t\tif (touches.length > 1) {\n\t\t\t\t\tvar end = proxy.getSequence(touches[1]);\n\t\t\t\t\tvar origin = end.start.subtract(begin.start);\n\t\t\t\t\tvar current = end.point.subtract(begin.point);\n\n\t\t\t\t\tangle = Math.atan2(-current.y, current.x) - Math.atan2(-origin.y, origin.x);\n\t\t\t\t\tscale = current.magnitude() / origin.magnitude();\n\t\t\t\t\ttranslate = begin.offset.add(end.offset).divideBy(2);\n\t\t\t\t}\n\n\t\t\t\tthis.deltaAngle = angle;\n\t\t\t\tthis.deltaScale = scale;\n\t\t\t\tthis.deltaMove = translate;\n\n\t\t\t\t// start animating when actual dragging starts\n\t\t\t\tif (this.getState() !== STATE_ACTIVE) {\n\t\t\t\t\tthis.setState(STATE_ACTIVE);\n\t\t\t\t\tthis.requestFrame();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\ttouchEnd: function(e) {\n\t\t\tlog.d(e);\n\t\t\te.preventDefault();\n\n\t\t\tvar touches = this.touches;\n\t\t\tvar removed = e.detail.sequence.id;\n\t\t\tvar index = touches.indexOf(removed);\n\t\t\tif (index > -1) {\n\t\t\t\ttouches.splice(index, 1);\n\t\t\t}\n\n\t\t\tthis.translation = this.getTranslation();\n\t\t\tthis.rotation = this.getRotation();\n\t\t\tthis.scaling = this.getScaling();\n\n\t\t\tthis.cancelFrame();\n\t\t\tthis.setState(STATE_PASSIVE);\n\t\t},\n\n\t\tgetTranslation: function() {\n\t\t\treturn this.translation.add(this.deltaMove);\n\t\t},\n\n\t\tgetRotation: function() {\n\t\t\treturn this.rotation + this.deltaAngle;\n\t\t},\n\n\t\tgetScaling: function() {\n\t\t\treturn this.scaling * this.deltaScale;\n\t\t},\n\n\t\thandleFrame: function() {\n\t\t\tvar translate = this.getTranslation();\n\t\t\tvar rotation = this.getRotation();\n\t\t\tvar scale = this.getScaling();\n\n\t\t\tvar transform = this.transform.\n\t\t\t\trotateZ(rotation).\n\t\t\t\tscale(scale).\n\t\t\t\ttranslate(translate);\n\n\t\t\tstyle.setTransform(this.node, transform);\n\n\t\t\tthis.requestFrame();\n\t\t},\n\n\t\tcallbacks: [\n\t\t\t'handleFrame',\n\t\t\t'touchStart',\n\t\t\t'touchMove',\n\t\t\t'touchEnd'\n\t\t]\n\t});\n});\n",
		"playtotv.define('playtotv.widget.VisualWidget', [\n\t'playtotv.widget.Widget'\n], function(Widget) {\n\n\t'use strict';\n\n\tvar dom = playtotv.dom;\n\n\t/**\n\t * Scales a contained image like background-size: cover or contain; The container must have (fixed or scaling)\n\t * dimensions in both width and height for the image to resize itself correctly. The container should have its\n\t * overflow set to hidden for optimal effect, but this is not required per se. Positioning is done using top\n\t * and/or left margins on the image.\n\t *\n\t * @class\n\t * @name VisualWidget\n\t * @memberOf playtotv.widget\n\t * @extends playtotv.widget.Widget\n\t * @param {Node} node\n\t * @param {object} [options]\n\t * @param {string} [options.mode='cover'] Sizing mode, either cover or contain\n\t * @param {string} [options.image='img'] Image selector\n\t */\n\tvar VisualWidget = new playtotv.Class({\n\t\textend: Widget,\n\n\t\tinitialize: function(node, options) {\n\t\t\tthis._super(node);\n\n\t\t\toptions = playtotv.params(options, {\n\t\t\t\tmode: 'cover',\n\t\t\t\timage: 'img'\n\t\t\t});\n\n\t\t\tthis.image = dom.first(options.image, node);\n\t\t\tthis.mode = options.mode;\n\n\t\t\tif (this.image) {\n\t\t\t\tthis.addEventListener(window, 'resize', this.handleResize);\n\t\t\t\tthis.addEventListener(this.image, 'load', this.handleResize);\n\t\t\t\tthis.handleResize();\n\t\t\t}\n\t\t},\n\n\t\t/** @lends playtotv.widget.VisualWidget.prototype */\n\n\t\t/**\n\t\t * Resize handler, automatically called onload of the image, and onresize of the window.\n\t\t * @param {Event} event\n\t\t */\n\t\thandleResize: function() {\n\t\t\tif (!this.node) {\n\t\t\t\treturn; // widget already exited in the mean while\n\t\t\t}\n\n\t\t\tvar node = this.node;\n\t\t\tvar img = this.image;\n\t\t\tvar mode = this.mode;\n\t\t\tvar css = img.style;\n\n\t\t\timg.removeAttribute('width');\n\t\t\timg.removeAttribute('height');\n\t\t\tcss.margin = 0;\n\n\t\t\tvar width = node.offsetWidth;\n\t\t\tvar height = node.offsetHeight;\n\n\t\t\tvar imageRatio = img.offsetWidth / img.offsetHeight;\n\t\t\tvar viewRatio = width / height;\n\n\t\t\tif ((viewRatio < imageRatio && mode === 'contain') ||\n\t\t\t\t(viewRatio > imageRatio && mode === 'cover')) {\n\n\t\t\t\tcss.marginTop = -((width / imageRatio) - height) / 2 + 'px';\n\t\t\t\timg.setAttribute('width', '100%');\n\n\t\t\t} else {\n\t\t\t\tcss.marginLeft = -((height * imageRatio) - width) / 2 + 'px';\n\t\t\t\timg.setAttribute('height', '100%');\n\t\t\t}\n\t\t},\n\n\t\tcallbacks: [\n\t\t\t'handleResize'\n\t\t]\n\t});\n\n\treturn VisualWidget;\n});\n",
		"playtotv.define('playtotv.widget.WidgetManager', [\n\t// 'playtotv.MutationObserver'\n], function(\n\t// MutationObserver\n) {\n\n\t'use strict';\n\n\tvar ptv = playtotv;\n\tvar dom = ptv.dom;\n\n\t/**\n\t * Monitors childList mutations to the DOM within a given node, and creates and removes widget instances for\n\t * encountered nodes matching registered widget types. Widgets are registered either using CSS selectors, or if\n\t * specified to the constructor, by attribute word value of the given attribute.\n\t *\n\t * @name WidgetManager\n\t * @class\n\t * @memberOf playtotv.widget\n\t * @param {Node} node Node to monitor and manage instances for\n\t * @param {string} [attr] Optional attribute to register widgets under rather than CSS selectors\n\t */\n\tvar WidgetManager = new ptv.Class({\n\n\t\tinitialize: function(node, attr) {\n\t\t\tthis.node = node || document;\n\t\t\tthis.attr = attr;\n\t\t\tthis.definitions = [];\n\t\t\tthis.instances = [];\n\n\t\t\t// TODO: Replace this by something simpler and better integrated with App\n\t\t\t// TODO: Replace data-widget=\"..\" data-...=\"[json]\" by widget=\"[json]\" like with on-event=\"[json]\"\n\t\t\t//\n\t\t\t// this.observer = new MutationObserver(this.onMutations);\n\t\t\t// this.observer.observe(this.node, {\n\t\t\t// \tchildList: true,\n\t\t\t// \tsubtree: true\n\t\t\t// });\n\t\t},\n\n\t\t/** @lends playtotv.widget.WidgetManager.prototype */\n\n\t\t/**\n\t\t * Registers a class under a given selector or attribute value with options for future class instances.\n\t\t *\n\t\t * @param {string} selector\n\t\t * @param {Function} Class\n\t\t * @param {Object|Function} [options]\n\t\t * @returns {Object} definition\n\t\t */\n\t\tregister: function(selector, Class, options) {\n\t\t\tvar proto = Class.prototype;\n\t\t\tif (!proto.getNode || !proto.dispose) {\n\t\t\t\tthrow new ReferenceError('Class must define getNode() and dispose() methods');\n\t\t\t}\n\n\t\t\tvar definition = {\n\t\t\t\tselector: this.attr ? '[' + this.attr + '~=\"' + selector + '\"]' : selector,\n\t\t\t\tClass: Class,\n\t\t\t\toptions: options\n\t\t\t};\n\n\t\t\tthis.definitions.push(definition);\n\t\t\tthis.createInstances(this.node, definition);\n\n\t\t\treturn definition;\n\t\t},\n\n\t\t/**\n\t\t * Unregisters a previously registered definition and disposes any existing instances\n\t\t *\n\t\t * @param {Object} definition\n\t\t */\n\t\tunregister: function(definition) {\n\t\t\tif (typeof definition !== 'object') {\n\t\t\t\tthrow new TypeError('Object expected');\n\t\t\t}\n\n\t\t\tvar definitions = this.definitions;\n\t\t\tvar index = definitions.indexOf(definition);\n\t\t\tif (index > -1) {\n\t\t\t\tthis.disposeInstances(this.node, definition);\n\t\t\t\tdefinitions.splice(index, 1);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Mutation observer callback, splits added and removed nodes to onNodeAdded and -removed.\n\t\t * @param {Array} mutations Array of mutation records, see {@link playtotv.MutationRecord}.\n\t\t */\n\t\tonMutations: function(mutations) {\n\t\t\tptv.each(mutations, function(mutation) {\n\t\t\t\tvar removed = mutation.removedNodes;\n\t\t\t\tif (removed.length) {\n\t\t\t\t\t// onMutations > onNodeRemoved > disposeInstances\n\t\t\t\t\tptv.each(removed, this.onNodeRemoved, this);\n\t\t\t\t}\n\n\t\t\t\tvar added = mutation.addedNodes;\n\t\t\t\tif (added.length) {\n\t\t\t\t\t// onMutations > onNodeAdded > createInstances\n\t\t\t\t\tptv.each(added, this.onNodeAdded, this);\n\t\t\t\t}\n\t\t\t}, this);\n\t\t},\n\n\t\t/**\n\t\t * Mutation handler for added nodes\n\t\t */\n\t\tonNodeAdded: function(node) {\n\t\t\tif (dom.isNode(node)) {\n\t\t\t\tthis.definitions.forEach(function(definition) {\n\t\t\t\t\tthis.createInstances(node, definition);\n\t\t\t\t}, this);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Mutation handler for removed nodes.\n\t\t */\n\t\tonNodeRemoved: function(node) {\n\t\t\tif (dom.isNode(node)) {\n\t\t\t\t// disposal checks current instances rather than known definitions, no need to forEach them.\n\t\t\t\tthis.disposeInstances(node);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Creates instances for and within the given node using the given definition's selector, Class and options.\n\t\t */\n\t\tcreateInstances: function(node, definition) {\n\t\t\tvar nodes = dom.any(definition.selector, node);\n\t\t\tnodes.forEach(function(item) {\n\t\t\t\tvar Class = definition.Class;\n\t\t\t\tif (!this.getWidget(item, Class)) {\n\t\t\t\t\tvar options = definition.options;\n\t\t\t\t\toptions = options instanceof Function ? options(item) : options;\n\t\t\t\t\tthis.instances.push(\n\t\t\t\t\t\tnew Class(item, options)\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}, this);\n\t\t},\n\n\t\t/**\n\t\t * Disposes any instances on and within the given node that were created by this WidgetManager.\n\t\t * A definition may be given to dispose only a subset of instances.\n\t\t */\n\t\tdisposeInstances: function(node, definition) {\n\t\t\tif (definition && !definition.Class) {\n\t\t\t\tthrow new TypeError('Illegal definition');\n\t\t\t}\n\n\t\t\tvar instances = this.instances;\n\t\t\tvar last = instances.length - 1;\n\t\t\tvar global = arguments.length < 2;\n\n\t\t\tfor (var instance, target, i = last; i >= 0; i--) {\n\t\t\t\tinstance = instances[i];\n\t\t\t\ttarget = instance.getNode();\n\t\t\t\tif (\n\t\t\t\t\ttarget &&\n\t\t\t\t\t(node.contains(target) || node === target) &&\n\t\t\t\t\t(global || instance.constructor === definition.Class)\n\t\t\t\t) {\n\t\t\t\t\tinstance.dispose();\n\t\t\t\t\tinstances.splice(i, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Returns the instance of the given class on the given node.\n\t\t */\n\t\tgetWidget: function(node, Class) {\n\t\t\tif (!Class) {\n\t\t\t\tthrow new ReferenceError('Class expected');\n\t\t\t}\n\n\t\t\treturn ptv.find(this.instances, function(instance) {\n\t\t\t\treturn (instance.getNode() === node && instance.constructor === Class);\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Disposes this widgetManager and exits all instances for memory and -leaking purposes, and should be called\n\t\t * beforeUnload of the document, or at the time the widgetManager's own node is removed.\n\t\t */\n\t\tdispose: function() {\n\t\t\t// this.observer.disconnect();\n\t\t\tthis.disposeInstances(this.node);\n\n\t\t\tptv.dispose(this);\n\t\t},\n\n\t\tcallbacks: [\n\t\t\t'onMutations',\n\t\t\t'onNodeAdded',\n\t\t\t'onNodeRemoved'\n\t\t]\n\t});\n\n\treturn WidgetManager;\n});\n"
	]
}